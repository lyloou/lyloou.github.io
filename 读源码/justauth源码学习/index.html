<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"lyloou.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"default"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="JustAuth ç®€ä»‹ ğŸ†Gitee æœ€æœ‰ä»·å€¼å¼€æºé¡¹ç›® ğŸš€ğŸ’¯ å°è€Œå…¨è€Œç¾çš„ç¬¬ä¸‰æ–¹ç™»å½•å¼€æºç»„ä»¶ã€‚ç›®å‰å·²æ”¯æŒ Githubã€Giteeã€å¾®åšã€é’‰é’‰ã€ç™¾åº¦ã€Codingã€è…¾è®¯äº‘å¼€å‘è€…å¹³å°ã€OSChinaã€æ”¯ä»˜å®ã€QQã€å¾®ä¿¡ã€æ·˜å®ã€Googleã€Facebookã€æŠ–éŸ³ã€é¢†è‹±ã€å°ç±³ã€å¾®è½¯ã€ä»Šæ—¥å¤´æ¡ã€Teambitionã€StackOverflowã€Pinterestã€äººäººã€åä¸ºã€ä¼ä¸šå¾®ä¿¡ã€é…·å®¶ä¹ã€Gi">
<meta property="og:type" content="article">
<meta property="og:title" content="Justauthæºç å­¦ä¹ ">
<meta property="og:url" content="https://lyloou.com/%E8%AF%BB%E6%BA%90%E7%A0%81/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="lyloou">
<meta property="og:description" content="JustAuth ç®€ä»‹ ğŸ†Gitee æœ€æœ‰ä»·å€¼å¼€æºé¡¹ç›® ğŸš€ğŸ’¯ å°è€Œå…¨è€Œç¾çš„ç¬¬ä¸‰æ–¹ç™»å½•å¼€æºç»„ä»¶ã€‚ç›®å‰å·²æ”¯æŒ Githubã€Giteeã€å¾®åšã€é’‰é’‰ã€ç™¾åº¦ã€Codingã€è…¾è®¯äº‘å¼€å‘è€…å¹³å°ã€OSChinaã€æ”¯ä»˜å®ã€QQã€å¾®ä¿¡ã€æ·˜å®ã€Googleã€Facebookã€æŠ–éŸ³ã€é¢†è‹±ã€å°ç±³ã€å¾®è½¯ã€ä»Šæ—¥å¤´æ¡ã€Teambitionã€StackOverflowã€Pinterestã€äººäººã€åä¸ºã€ä¼ä¸šå¾®ä¿¡ã€é…·å®¶ä¹ã€Gi">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://cdn.lyloou.com/img/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0-2021-06-29-17-22-17.png">
<meta property="og:image" content="http://cdn.lyloou.com/img/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0-2021-06-29-17-10-59.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/lyloou/img/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0-2021-07-02-10-50-48.png">
<meta property="og:image" content="http://cdn.lyloou.com/img/20210625112103.png">
<meta property="article:published_time" content="2021-06-25T02:44:54.000Z">
<meta property="article:modified_time" content="2021-06-25T02:44:54.000Z">
<meta property="article:author" content="lyloou">
<meta property="article:tag" content="java">
<meta property="article:tag" content="æºç ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://cdn.lyloou.com/img/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0-2021-06-29-17-22-17.png">


<link rel="canonical" href="https://lyloou.com/%E8%AF%BB%E6%BA%90%E7%A0%81/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://lyloou.com/%E8%AF%BB%E6%BA%90%E7%A0%81/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/","path":"è¯»æºç /justauthæºç å­¦ä¹ /","title":"Justauthæºç å­¦ä¹ "}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Justauthæºç å­¦ä¹  | lyloou</title>
  
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-80542932-1","only_pageview":true}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">lyloou</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#JustAuth-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">JustAuth ç®€ä»‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8E%E4%BB%A5%E4%B8%8B%E5%87%A0%E4%B8%AA%E9%97%AE%E9%A2%98%E6%9D%A5%E7%9C%8B%E4%BB%A3%E7%A0%81"><span class="nav-number">2.</span> <span class="nav-text">ä»ä»¥ä¸‹å‡ ä¸ªé—®é¢˜æ¥çœ‹ä»£ç </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Q-%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%A4%9A%E5%AE%B6%E7%9A%84%EF%BC%9F"><span class="nav-number">2.0.1.</span> <span class="nav-text">Q: å¦‚ä½•é›†æˆå¤šå®¶çš„ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Q-State-%E7%BC%93%E5%AD%98%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%EF%BC%9F"><span class="nav-number">2.0.2.</span> <span class="nav-text">Q: State ç¼“å­˜å¦‚ä½•å®ç°ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Q-%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E9%80%82%E9%85%8D%E8%87%AA%E6%9C%89%E7%9A%84-OAuth-%E6%9C%8D%E5%8A%A1%EF%BC%9F"><span class="nav-number">2.0.3.</span> <span class="nav-text">Q: å¦‚ä½•åšåˆ°é€‚é…è‡ªæœ‰çš„ OAuth æœåŠ¡ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Q-%E5%A6%82%E4%BD%95%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89-Scope%EF%BC%9F"><span class="nav-number">2.0.4.</span> <span class="nav-text">Q: å¦‚ä½•æ”¯æŒè‡ªå®šä¹‰ Scopeï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Q-http-%E5%B7%A5%E5%85%B7%E5%A6%82%E4%BD%95%E8%A7%A3%E8%80%A6%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%B0%86%E9%80%89%E6%8B%A9%E6%9D%83%E4%BA%A4%E7%BB%99%E5%BC%80%E5%8F%91%E8%80%85%EF%BC%9F"><span class="nav-number">2.0.5.</span> <span class="nav-text">Q: http å·¥å…·å¦‚ä½•è§£è€¦ï¼Œå¯ä»¥å°†é€‰æ‹©æƒäº¤ç»™å¼€å‘è€…ï¼Ÿ</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lyloou"
      src="/assets/images/avatar.png">
  <p class="site-author-name" itemprop="name">lyloou</p>
  <div class="site-description" itemprop="description">/* Better than last best */</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">312</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/lyloou" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;lyloou" rel="noopener me" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:lyloou6@gmail.com" title="E-Mail â†’ mailto:lyloou6@gmail.com" rel="noopener me" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/lyloou" title="Weibo â†’ https:&#x2F;&#x2F;weibo.com&#x2F;lyloou" rel="noopener me" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/ly1414725328" title="CSDN â†’ https:&#x2F;&#x2F;blog.csdn.net&#x2F;ly1414725328" rel="noopener me" target="_blank"><i class="csdn fa-fw"></i>CSDN</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lyloou.com/%E8%AF%BB%E6%BA%90%E7%A0%81/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/images/avatar.png">
      <meta itemprop="name" content="lyloou">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyloou">
      <meta itemprop="description" content="/* Better than last best */">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Justauthæºç å­¦ä¹  | lyloou">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Justauthæºç å­¦ä¹ 
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-06-25 10:44:54" itemprop="dateCreated datePublished" datetime="2021-06-25T10:44:54+08:00">2021-06-25</time>
    </span>

  
    <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="JustAuth-ç®€ä»‹"><a href="#JustAuth-ç®€ä»‹" class="headerlink" title="JustAuth ç®€ä»‹"></a>JustAuth ç®€ä»‹</h2><blockquote>
<p>ğŸ†Gitee æœ€æœ‰ä»·å€¼å¼€æºé¡¹ç›® ğŸš€ğŸ’¯ å°è€Œå…¨è€Œç¾çš„ç¬¬ä¸‰æ–¹ç™»å½•å¼€æºç»„ä»¶ã€‚ç›®å‰å·²æ”¯æŒ Githubã€Giteeã€å¾®åšã€é’‰é’‰ã€ç™¾åº¦ã€Codingã€è…¾è®¯äº‘å¼€å‘è€…å¹³å°ã€OSChinaã€æ”¯ä»˜å®ã€QQã€å¾®ä¿¡ã€æ·˜å®ã€Googleã€Facebookã€æŠ–éŸ³ã€é¢†è‹±ã€å°ç±³ã€å¾®è½¯ã€ä»Šæ—¥å¤´æ¡ã€Teambitionã€StackOverflowã€Pinterestã€äººäººã€åä¸ºã€ä¼ä¸šå¾®ä¿¡ã€é…·å®¶ä¹ã€Gitlabã€ç¾å›¢ã€é¥¿äº†ä¹ˆã€æ¨ç‰¹ã€é£ä¹¦ã€äº¬ä¸œã€é˜¿é‡Œäº‘ã€å–œé©¬æ‹‰é›…ã€Amazonã€Slack å’Œ Line ç­‰ç¬¬ä¸‰æ–¹å¹³å°çš„æˆæƒç™»å½•ã€‚ Login, so easy!<br>ç½‘å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/justauth/JustAuth">justauth/JustAuth</a></p>
</blockquote>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">1.1.  Roles</span><br><span class="line"></span><br><span class="line">   OAuth defines four roles:</span><br><span class="line"></span><br><span class="line">   resource owner</span><br><span class="line">      An entity capable of granting access to a protected resource.</span><br><span class="line">      <span class="keyword">When</span> the resource owner is a person, it is referred to as an</span><br><span class="line">      end-user.</span><br><span class="line"></span><br><span class="line">   resource server</span><br><span class="line">      The server hosting the protected resources, capable of accepting</span><br><span class="line">      and responding to protected resource requests using access tokens.</span><br><span class="line"></span><br><span class="line">   client</span><br><span class="line">      An application making protected resource requests on behalf of the</span><br><span class="line">      resource owner and with its authorization.  The term <span class="string">&quot;client&quot;</span> does</span><br><span class="line">      not imply any particular implementation characteristics (e.g.,</span><br><span class="line">      whether the application executes on a server, a desktop, or other</span><br><span class="line">      devices).</span><br><span class="line"></span><br><span class="line">   authorization server</span><br><span class="line">      The server issuing access tokens to the client after successfully</span><br><span class="line">      authenticating the resource owner and obtaining authorization.</span><br><span class="line"></span><br><span class="line">   The interaction between the authorization server and resource server</span><br><span class="line">   is beyond the scope of this specification.  The authorization server</span><br><span class="line">   may be the same server as the resource server or a separate entity.</span><br><span class="line">   A single authorization server may issue access tokens accepted by</span><br><span class="line">   multiple resource servers.</span><br><span class="line"></span><br><span class="line">1.2.  Protocol Flow</span><br><span class="line"></span><br><span class="line">     +--------+                               +---------------+</span><br><span class="line">     |<span class="string">        </span>|<span class="string">--(A)- Authorization Request -&gt;</span>|<span class="string">   Resource    </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">                               </span>|<span class="string">     Owner     </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">&lt;-(B)-- Authorization Grant ---</span>|<span class="string">               </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string">     </span>|<span class="string">        </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string">     </span>|<span class="string">        </span>|<span class="string">--(C)-- Authorization Grant --&gt;</span>|<span class="string"> Authorization </span>|</span><br><span class="line">     |<span class="string"> Client </span>|<span class="string">                               </span>|<span class="string">     Server    </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">&lt;-(D)----- Access Token -------</span>|<span class="string">               </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string">     </span>|<span class="string">        </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string">     </span>|<span class="string">        </span>|<span class="string">--(E)----- Access Token ------&gt;</span>|<span class="string">    Resource   </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">                               </span>|<span class="string">     Server    </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">&lt;-(F)--- Protected Resource ---</span>|<span class="string">               </span>|</span><br><span class="line">     +--------+                               +---------------+</span><br><span class="line"></span><br><span class="line">                     Figure 1: Abstract Protocol Flow</span><br><span class="line"></span><br><span class="line">   The abstract OAuth 2.0 flow illustrated in Figure 1 describes the</span><br><span class="line">   interaction between the four roles and includes the following steps:</span><br><span class="line"></span><br><span class="line">   (A)  The client requests authorization from the resource owner.  The</span><br><span class="line">        authorization request can be made directly to the resource owner</span><br><span class="line">        (as shown), or preferably indirectly via the authorization</span><br><span class="line">        server as an intermediary.</span><br><span class="line">		ç”¨æˆ·æ‰“å¼€å®¢æˆ·ç«¯ä»¥åï¼Œå®¢æˆ·ç«¯è¦æ±‚ç”¨æˆ·ç»™äºˆæˆæƒã€‚</span><br><span class="line">   (B)  The client receives an authorization grant, which is a</span><br><span class="line">        credential representing the resource owner&#x27;s authorization,</span><br><span class="line">        expressed using one of four grant types defined in this</span><br><span class="line">        specification or using an extension grant type.  The</span><br><span class="line">        authorization grant type depends on the method used by the</span><br><span class="line">        client to request authorization and the types supported by the</span><br><span class="line">        authorization server.</span><br><span class="line">		ç”¨æˆ·åŒæ„ç»™äºˆå®¢æˆ·ç«¯æˆæƒã€‚</span><br><span class="line"></span><br><span class="line">   (C)  The client requests an access token by authenticating with the</span><br><span class="line">        authorization server and presenting the authorization grant.</span><br><span class="line">		å®¢æˆ·ç«¯ä½¿ç”¨ä¸Šä¸€æ­¥è·å¾—çš„æˆæƒï¼Œå‘è®¤è¯æœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œã€‚</span><br><span class="line">   (D)  The authorization server authenticates the client and validates</span><br><span class="line">        the authorization grant, and if valid, issues an access token.</span><br><span class="line">		è®¤è¯æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯ä»¥åï¼Œç¡®è®¤æ— è¯¯ï¼ŒåŒæ„å‘æ”¾ä»¤ç‰Œ</span><br><span class="line"></span><br><span class="line">   (E)  The client requests the protected resource from the resource</span><br><span class="line">        server and authenticates by presenting the access token.</span><br><span class="line">		å®¢æˆ·ç«¯ä½¿ç”¨ä»¤ç‰Œï¼Œå‘èµ„æºæœåŠ¡å™¨ç”³è¯·è·å–èµ„æºã€‚</span><br><span class="line">   (F)  The resource server validates the access token, and if valid,</span><br><span class="line">        serves the request.</span><br><span class="line">		èµ„æºæœåŠ¡å™¨ç¡®è®¤ä»¤ç‰Œæ— è¯¯ï¼ŒåŒæ„å‘å®¢æˆ·ç«¯å¼€æ”¾èµ„æºã€‚</span><br><span class="line">https://datatracker.ietf.org/doc/html/rfc6749<span class="comment">#section-1.2</span></span><br></pre></td></tr></table></figure>

<p><img src="http://cdn.lyloou.com/img/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0-2021-06-29-17-22-17.png" alt="justauthæºç å­¦ä¹ -2021-06-29-17-22-17"></p>
<h2 id="ä»ä»¥ä¸‹å‡ ä¸ªé—®é¢˜æ¥çœ‹ä»£ç "><a href="#ä»ä»¥ä¸‹å‡ ä¸ªé—®é¢˜æ¥çœ‹ä»£ç " class="headerlink" title="ä»ä»¥ä¸‹å‡ ä¸ªé—®é¢˜æ¥çœ‹ä»£ç "></a>ä»ä»¥ä¸‹å‡ ä¸ªé—®é¢˜æ¥çœ‹ä»£ç </h2><h4 id="Q-å¦‚ä½•é›†æˆå¤šå®¶çš„ï¼Ÿ"><a href="#Q-å¦‚ä½•é›†æˆå¤šå®¶çš„ï¼Ÿ" class="headerlink" title="Q: å¦‚ä½•é›†æˆå¤šå®¶çš„ï¼Ÿ"></a>Q: å¦‚ä½•é›†æˆå¤šå®¶çš„ï¼Ÿ</h4><p>è¿™ä¸€å—ï¼Œä¸»è¦æ˜¯å·¥å‚æ¨¡å¼å’Œæ¨¡æ¿æ¨¡å¼çš„åº”ç”¨ã€‚</p>
<p>å·¥å‚æ¨¡å¼</p>
<figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AuthRequestFactory<span class="function"><span class="keyword">#</span><span class="title">get</span><span class="params">(<span class="variable">String</span> <span class="variable">source</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>æ¨¡æ¿æ¨¡å¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AuthDefaultRequest</span> <span class="keyword">implements</span> <span class="title class_">AuthRequest</span>&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">abstract</span> AuthToken <span class="title function_">getAccessToken</span><span class="params">(AuthCallback var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> AuthUser <span class="title function_">getUserInfo</span><span class="params">(AuthToken var1)</span>;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cdn.lyloou.com/img/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0-2021-06-29-17-10-59.png" alt="justauthæºç å­¦ä¹ -2021-06-29-17-10-59"></p>
<p><strong>é’ˆå¯¹æˆæƒã€è·å–ç”¨æˆ·ä¿¡æ¯ç­‰æ“ä½œï¼Œç”±å…·ä½“çš„ source ç±»æ¥å®ç°</strong><br>å› ä¸ºéƒ½æ˜¯åŸºäº OAuth2 æ¥å®ç°çš„ï¼Œæ‰€ä»¥éƒ½æœ‰ authorize åœ°å€ã€accessToken åœ°å€ã€userInfo åœ°å€ ç­‰æ¦‚å¿µ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthSource</span> &#123;</span><br><span class="line">    String <span class="title function_">authorize</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">accessToken</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">userInfo</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">revoke</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AuthException</span>(AuthResponseStatus.UNSUPPORTED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">refresh</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AuthException</span>(AuthResponseStatus.UNSUPPORTED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span> <span class="keyword">instanceof</span> Enum ? String.valueOf(<span class="built_in">this</span>) : <span class="built_in">this</span>.getClass().getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">AuthDefaultSource</span> <span class="keyword">implements</span> <span class="title class_">AuthSource</span> &#123;</span><br><span class="line">    GITHUB &#123;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">authorize</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://github.com/login/oauth/authorize&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">accessToken</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://github.com/login/oauth/access_token&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">userInfo</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://api.github.com/user&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    WEIBO &#123;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">authorize</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://api.weibo.com/oauth2/authorize&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">accessToken</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://api.weibo.com/oauth2/access_token&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">userInfo</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://api.weibo.com/2/users/show.json&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">revoke</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://api.weibo.com/oauth2/revokeoauth2&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¤šå®¶é…ç½®</strong><br>JustAuthPropertiesï¼Œå…¶ type æ˜¯ map ç±»å‹çš„ï¼Œå¯ä»¥è‡ªå®šä¹‰ä»»æ„å¤šä¸ªçš„ sourceã€‚</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">justauth:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">type:</span></span><br><span class="line">    <span class="attr">QQ:</span></span><br><span class="line">      <span class="attr">client-id:</span> <span class="number">10</span><span class="string">**********6</span></span><br><span class="line">      <span class="attr">client-secret:</span> <span class="string">1f7d08**********5b7**********29e</span></span><br><span class="line">      <span class="attr">redirect-uri:</span> <span class="string">http://x.lyloou.com/oauth/qq/callback</span></span><br><span class="line">      <span class="attr">union-id:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">WEIBO:</span></span><br><span class="line">      <span class="attr">client-id:</span> <span class="number">10</span><span class="string">**********6</span></span><br><span class="line">      <span class="attr">client-secret:</span> <span class="string">1f7d08**********5b7**********29e</span></span><br><span class="line">      <span class="attr">redirect-uri:</span> <span class="string">http://x.lyloou.com/oauth/weibo/callback</span></span><br></pre></td></tr></table></figure>

<h4 id="Q-State-ç¼“å­˜å¦‚ä½•å®ç°ï¼Ÿ"><a href="#Q-State-ç¼“å­˜å¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="Q: State ç¼“å­˜å¦‚ä½•å®ç°ï¼Ÿ"></a>Q: State ç¼“å­˜å¦‚ä½•å®ç°ï¼Ÿ</h4><p><code>state</code> æ˜¯ ç”¨æ¥ä¿æŒæˆæƒä¼šè¯æµç¨‹å®Œæ•´æ€§ï¼Œé˜²æ­¢ CSRF æ”»å‡»çš„å®‰å…¨çš„éšæœºçš„å‚æ•°ï¼Œç”±å¼€å‘è€…ç”Ÿæˆ</p>
<p><strong>è‡ªåŠ¨é…ç½®</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// justauth-spring-boot-starter JustAuthStateCacheConfiguration</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(&#123;AuthStateCache.class&#125;)</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty(</span></span><br><span class="line"><span class="meta">        name = &#123;&quot;justauth.cache.type&quot;&#125;,</span></span><br><span class="line"><span class="meta">        havingValue = &quot;default&quot;,</span></span><br><span class="line"><span class="meta">        matchIfMissing = true  // é»˜è®¤</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Default</span> &#123;</span><br><span class="line">        Default() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> AuthStateCache <span class="title function_">authStateCache</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> AuthDefaultStateCache.INSTANCE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            JustAuthStateCacheConfiguration.log.debug(<span class="string">&quot;JustAuth ä½¿ç”¨ é»˜è®¤ç¼“å­˜å­˜å‚¨ state æ•°æ®&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>é…ç½®</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">justauth:</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">default</span></span><br><span class="line"><span class="string">```</span></span><br><span class="line"></span><br><span class="line"><span class="string">**å®ç°**</span></span><br><span class="line"></span><br><span class="line"><span class="string">**æ¸…ç†**</span></span><br><span class="line"></span><br><span class="line"><span class="string">é€šè¿‡</span> <span class="string">ScheduledThreadPoolExecutor</span> <span class="string">æ¯éš”</span> <span class="string">AuthCacheConfig.timeout</span> <span class="string">æ¥å®šæ—¶æ¸…ç†</span> <span class="string">CacheState</span></span><br><span class="line"></span><br><span class="line"><span class="string">```java</span></span><br><span class="line"><span class="string">public</span> <span class="string">void</span> <span class="string">schedulePrune(long</span> <span class="string">delay)</span> &#123;</span><br><span class="line">	<span class="string">AuthCacheScheduler.INSTANCE.schedule(this::pruneCache</span>, <span class="string">delay);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">public</span> <span class="string">enum</span> <span class="string">AuthCacheScheduler</span> &#123;</span><br><span class="line">    <span class="string">INSTANCE;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">private</span> <span class="string">AtomicInteger</span> <span class="string">cacheTaskNumber</span> <span class="string">=</span> <span class="string">new</span> <span class="string">AtomicInteger(1);</span></span><br><span class="line">    <span class="string">private</span> <span class="string">ScheduledExecutorService</span> <span class="string">scheduler;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">private</span> <span class="string">AuthCacheScheduler()</span> &#123;</span><br><span class="line">        <span class="string">this.create();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">private</span> <span class="string">void</span> <span class="string">create()</span> &#123;</span><br><span class="line">        <span class="string">this.shutdown();</span></span><br><span class="line">        <span class="string">this.scheduler</span> <span class="string">=</span> <span class="string">new</span> <span class="string">ScheduledThreadPoolExecutor(10</span>, <span class="string">(r)</span> <span class="string">-&gt;</span> &#123;</span><br><span class="line">            <span class="string">return</span> <span class="string">new</span> <span class="string">Thread(r</span>, <span class="string">String.format(&quot;JustAuth-Task-%s&quot;</span>, <span class="string">this.cacheTaskNumber.getAndIncrement()));</span></span><br><span class="line">        &#125;<span class="string">);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">public</span> <span class="string">void</span> <span class="string">shutdown()</span> &#123;</span><br><span class="line">        <span class="string">if</span> <span class="string">(null</span> <span class="type">!=</span> <span class="string">this.scheduler)</span> &#123;</span><br><span class="line">            <span class="string">this.scheduler.shutdown();</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">public</span> <span class="string">void</span> <span class="string">schedule(Runnable</span> <span class="string">task</span>, <span class="string">long</span> <span class="string">delay)</span> &#123;</span><br><span class="line">        <span class="string">this.scheduler.scheduleAtFixedRate(task</span>, <span class="string">delay</span>, <span class="string">delay</span>, <span class="string">TimeUnit.MILLISECONDS);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Q-å¦‚ä½•åšåˆ°é€‚é…è‡ªæœ‰çš„-OAuth-æœåŠ¡ï¼Ÿ"><a href="#Q-å¦‚ä½•åšåˆ°é€‚é…è‡ªæœ‰çš„-OAuth-æœåŠ¡ï¼Ÿ" class="headerlink" title="Q: å¦‚ä½•åšåˆ°é€‚é…è‡ªæœ‰çš„ OAuth æœåŠ¡ï¼Ÿ"></a>Q: å¦‚ä½•åšåˆ°é€‚é…è‡ªæœ‰çš„ OAuth æœåŠ¡ï¼Ÿ</h4><p>å’Œä¸Šé¢å…¶ä»–å¹³å°çš„ä¸€æ ·ï¼Œå¯ä»¥è‡ªå®šä¹‰æ¥é€‚é…æ–°çš„å¹³å°ã€‚</p>
<ol>
<li><p>ç»§æ‰¿ AuthSourceï¼ŒåŠ å…¥ authorizeã€accessTokenã€userInfo åœ°å€</p>
</li>
<li><p>å®ç° AuthDefaultRequestï¼Œé‡å†™å‡ ä¸ªåŸºæœ¬çš„ oauth æœåŠ¡æ¥å£ï¼šgetAccessTokenã€getUserInfoã€authorizeã€‚</p>
</li>
<li><p>æµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AuthRequest</span> <span class="variable">authRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AuthMyGitlabRequest</span>(AuthConfig.builder()</span><br><span class="line">    .clientId(<span class="string">&quot;63398e403231d4aa7e856cf5413620d536a876cb94e8d10ced0d3191b5d1d246&quot;</span>)</span><br><span class="line">    .clientSecret(<span class="string">&quot;65b0eba68fff019e682e6755882a24dfdbf0a61be55de119cb8970320186c8eb&quot;</span>)</span><br><span class="line">    .redirectUri(<span class="string">&quot;http://127.0.0.1:8443/oauth/callback/mygitlab&quot;</span>)</span><br><span class="line">    .build())</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="Q-å¦‚ä½•æ”¯æŒè‡ªå®šä¹‰-Scopeï¼Ÿ"><a href="#Q-å¦‚ä½•æ”¯æŒè‡ªå®šä¹‰-Scopeï¼Ÿ" class="headerlink" title="Q: å¦‚ä½•æ”¯æŒè‡ªå®šä¹‰ Scopeï¼Ÿ"></a>Q: å¦‚ä½•æ”¯æŒè‡ªå®šä¹‰ Scopeï¼Ÿ</h4><p><a target="_blank" rel="noopener" href="https://justauth.wiki/features/customize-scopes.html#%E8%87%AA%E5%AE%9A%E4%B9%89-scope-%E6%8E%A5%E5%85%A5-google-%E5%B9%B3%E5%8F%B0">è‡ªå®šä¹‰-scope-æ¥å…¥-google-å¹³å°</a></p>
<p><code>scope</code> ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç”³è¯·å¾—åˆ°æŸä¸ªï¼ˆæŸäº›ï¼‰èŒƒå›´çš„èµ„æºï¼Œè¶…è¿‡æ­¤èŒƒå›´çš„èµ„æºé™åˆ¶è®¿é—®ã€‚</p>
<blockquote>
<p>Scope is a mechanism in OAuth 2.0 to limit an applicationâ€™s access to a userâ€™s account. An application can request one or more scopes, this information is then presented to the user in the consent screen, and the access token issued to the application will be limited to the scopes granted.</p>
<p>â€”â€” ä»¥ä¸Šå†…å®¹èŠ‚é€‰è‡ª<a target="_blank" rel="noopener" href="https://oauth.net/">oauth.net</a><a target="_blank" rel="noopener" href="https://oauth.net/"> (opens new window)</a></p>
</blockquote>
<p>æä¾› AuthScope ç»Ÿä¸€æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å„ä¸ªå¹³å° scope ç±»çš„ç»Ÿä¸€æ¥å£</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yadong.zhang (yadong.zhang0415(a)gmail.com)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.15.7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthScope</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å­—ç¬¦ä¸² &#123;<span class="doctag">@code</span> scope&#125;ï¼Œå¯¹åº”ä¸ºå„å¹³å°å®é™…ä½¿ç”¨çš„ &#123;<span class="doctag">@code</span> scope&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getScope</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­å½“å‰ &#123;<span class="doctag">@code</span> scope&#125; æ˜¯å¦ä¸ºå„å¹³å°é»˜è®¤å¯ç”¨çš„</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isDefault</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å„ä¸ªå¹³å°å®ç°æ­¤æ¥å£ï¼Œå¦‚ google</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Google å¹³å° OAuth æˆæƒèŒƒå›´</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yadong.zhang (yadong.zhang0415(a)gmail.com)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">AuthGoogleScope</span> <span class="keyword">implements</span> <span class="title class_">AuthScope</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> scope&#125; å«ä¹‰ï¼Œä»¥&#123;<span class="doctag">@code</span> description&#125; ä¸ºå‡†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    USER_OPENID(<span class="string">&quot;openid&quot;</span>, <span class="string">&quot;Associate you with your personal info on Google&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">    USER_EMAIL(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;View your email address&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">    USER_PROFILE(<span class="string">&quot;profile&quot;</span>, <span class="string">&quot;View your basic profile info&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">    USER_PHONENUMBERS_READ(<span class="string">&quot;https://www.googleapis.com/auth/user.phonenumbers.read&quot;</span>, <span class="string">&quot;View your phone numbers&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">    USER_ORGANIZATION_READ(<span class="string">&quot;https://www.googleapis.com/auth/user.organization.read&quot;</span>, <span class="string">&quot;See your education, work history and org info&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">    USER_GENDER_READ(<span class="string">&quot;https://www.googleapis.com/auth/user.gender.read&quot;</span>, <span class="string">&quot;See your gender&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">    USER_EMAILS_READ(<span class="string">&quot;https://www.googleapis.com/auth/user.emails.read&quot;</span>, <span class="string">&quot;View your email addresses&quot;</span>, <span class="literal">false</span>),</span><br><span class="line"></span><br><span class="line">    USER_BIRTHDAY_READ(<span class="string">&quot;https://www.googleapis.com/auth/user.birthday.read&quot;</span>, <span class="string">&quot;View your complete date of birth&quot;</span>, <span class="literal">false</span>)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“åˆæµç¨‹å›¾æ¥è¯´ï¼Œï¼ˆAï¼‰è¿™é‡Œéœ€è¦å°† scope å¸¦è¿‡å»ï¼Œè¿›å…¥æˆæƒé¡µé¢ã€‚</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+--------+                               +---------------+</span><br><span class="line">|<span class="string">        </span>|<span class="string">--(A)- Authorization Request -&gt;</span>|<span class="string">   Resource    </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               </span>|<span class="string">     Owner     </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">&lt;-(B)-- Authorization Grant ---</span>|<span class="string">               </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string"></span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string"></span>|<span class="string">        </span>|<span class="string">--(C)-- Authorization Grant --&gt;</span>|<span class="string"> Authorization </span>|</span><br><span class="line">|<span class="string"> Client </span>|<span class="string">                               </span>|<span class="string">     Server    </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">&lt;-(D)----- Access Token -------</span>|<span class="string">               </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string"></span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string"></span>|<span class="string">        </span>|<span class="string">--(E)----- Access Token ------&gt;</span>|<span class="string">    Resource   </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               </span>|<span class="string">     Server    </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">&lt;-(F)--- Protected Resource ---</span>|<span class="string">               </span>|</span><br><span class="line">+--------+</span><br></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//</span>accounts.google.com<span class="regexp">/o/</span>oauth2<span class="regexp">/v2/</span>auth?response_type=code&amp;client_id=<span class="number">553817080137</span>-d1pe3asc115tfgo74l8me92dhg4ro9k1.apps.googleusercontent.com&amp;redirect_uri=http:<span class="regexp">//</span>x.lyloou.com<span class="regexp">/oauth/g</span>oogle/callback&amp;state=e829a5725ce69cf1ed7918337caba839&amp;access_type=offline&amp;scope=openid email profile&amp;prompt=select_account</span><br></pre></td></tr></table></figure>

<p>æˆæƒé¡µé¢çš„é“¾æ¥æ˜¯é€šè¿‡ <code>AuthDefaultRequest.authorize</code> æ¥æ‹¼æ¥å¾—åˆ°çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AuthDefaultRequest.java</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›å¸¦&#123;<span class="doctag">@code</span> state&#125;å‚æ•°çš„æˆæƒurlï¼Œæˆæƒå›è°ƒæ—¶ä¼šå¸¦ä¸Šè¿™ä¸ª&#123;<span class="doctag">@code</span> state&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> state state éªŒè¯æˆæƒæµç¨‹çš„å‚æ•°ï¼Œå¯ä»¥é˜²æ­¢csrf</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿”å›æˆæƒåœ°å€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.9.3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">authorize</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UrlBuilder.fromBaseUrl(<span class="built_in">super</span>.authorize(state))</span><br><span class="line">            .queryParam(<span class="string">&quot;access_type&quot;</span>, <span class="string">&quot;offline&quot;</span>)</span><br><span class="line">            .queryParam(<span class="string">&quot;scope&quot;</span>, <span class="built_in">this</span>.getScopes(<span class="string">&quot; &quot;</span>, <span class="literal">false</span>, AuthScopeUtils.getDefaultScopes(AuthGoogleScope.values())))</span><br><span class="line">            .queryParam(<span class="string">&quot;prompt&quot;</span>,<span class="string">&quot;select_account&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä»¥ &#123;<span class="doctag">@code</span> separator&#125;åˆ†å‰²è¿‡åçš„ scope ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> separator     å¤šä¸ª &#123;<span class="doctag">@code</span> scope&#125; é—´çš„åˆ†éš”ç¬¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encode        æ˜¯å¦ encode ç¼–ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defaultScopes é»˜è®¤çš„ scopeï¼Œ å½“å®¢æˆ·ç«¯æ²¡æœ‰é…ç½® &#123;<span class="doctag">@code</span> scopes&#125; æ—¶å¯ç”¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.16.7</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getScopes</span><span class="params">(String separator, <span class="type">boolean</span> encode, List&lt;String&gt; defaultScopes)</span> &#123;</span><br><span class="line">        List&lt;String&gt; scopes = config.getScopes();</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == scopes || scopes.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> == defaultScopes || defaultScopes.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            scopes = defaultScopes;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == separator) &#123;</span><br><span class="line">            <span class="comment">// é»˜è®¤ä¸ºç©ºæ ¼</span></span><br><span class="line">            separator = <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">scopeStr</span> <span class="operator">=</span> String.join(separator, scopes);</span><br><span class="line">        <span class="keyword">return</span> encode ? UrlUtil.urlEncode(scopeStr) : scopeStr;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>getScopes</code> è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼Œå¦‚æœæ²¡æœ‰ä¼ å…¥ scope å‚æ•°ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨é»˜è®¤çš„ scope å‚æ•°ï¼Œå³<code>openid email profile</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">USER_OPENID(<span class="string">&quot;openid&quot;</span>, <span class="string">&quot;Associate you with your personal info on Google&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">USER_EMAIL(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;View your email address&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">USER_PROFILE(<span class="string">&quot;profile&quot;</span>, <span class="string">&quot;View your basic profile info&quot;</span>, <span class="literal">true</span>),</span><br></pre></td></tr></table></figure>

<p>æ’æ›²ï¼šå¦‚æœä½ æŠŠ email å’Œ profile å–æ¶ˆæ‰ï¼Œè·å–åˆ°ç”¨æˆ·ä¿¡æ¯æ—¶ä¼šå‘ç°å°‘äº† email,profile è¿™äº›ä¿¡æ¯</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scope=openid</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;113911973270419053931&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://lh3.googleusercontent.com/a-/AOh14GgncI8eYK_uG119BDclub5LNGDn57G_GI4OLZeOBA=s96-c&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;blog&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;company&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UNKNOWN&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GOOGLE&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;accessToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ya29.a0ARrdaM-dddddd-MPjpVj6xJAJP0zZFb396tpmi6BkS_Uom1G7DGTvSaWdJwwOzCXC5Bus-xQjq9JdGfNKWylhl029LMtuyZVT7lKzquGvUFePmellmRoY2Or6RgjS-TwKHzSviQoqEFBcYlQ&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;expireIn&quot;</span><span class="punctuation">:</span> <span class="number">3592</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;refreshToken&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;refreshTokenExpireIn&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;openId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;accessCode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;unionId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;scope&quot;</span><span class="punctuation">:</span> <span class="string">&quot;openid&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tokenType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bearer&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;idToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJSUzI1NiIsImtpZCI6ImI2ZjhkNTVkYTUzNGVhOTFjYjJjYjAwZTFhZjRlOGUwY2RlY2E5M2QiLCJ0eXAiOiJKV1QifQ.dddddd.yYUcU9VMwrF3vGXfmR4bsJDeQSjl_msow9eCARiV8HYIyjWDyZUM0ihOqxQzunWUT0W3nRVWxFw4oeN9bhZxIU9jBpW600eJRyDZ6BgJs0QEmC4sjJ4rWPp_P6OFo6b4HEM9Cl5i4ix-cJV18-4BxWhM6WbuC09F3a5RVvp7YGzYhMDRK4fecDpy-7q5wFZws3oYOrjCK5rVu4lioLMTJHCV-THbWImZTrEiuiLxw6onvKwhDa2FfLGbO3tei0EoVTvxJJwi18K-5TzcNySb8yBA-NYTXmlLZ9iWb7NNa7IXqKI1qt0VYm7xUUY4r3G14tZKU6JKkuz07RVx-4zxMw&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;macAlgorithm&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;macKey&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;oauthToken&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;oauthTokenSecret&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;screenName&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;oauthCallbackConfirmed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rawUserInfo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ddd&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://lh3.googleusercontent.com/a-/AOh14GgncI8eYK_uG119BDclub5LNGDn57G_GI4OLZeOBA=s96-c&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scope=openid email profile</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;113911973270419053931&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lyloou6@gmail.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Lou&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://lh3.googleusercontent.com/a-/AOh14GgncI8eYK_uG119BDclub5LNGDn57G_GI4OLZeOBA=s96-c&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;blog&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;company&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zh-CN&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lyloou6@gmail.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UNKNOWN&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GOOGLE&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;accessToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ya29.dd-dddd-eplbTCCWb55DHRZeAGDqDvk5RADufWREONGgKhdtCLa3yWKp4TxTJsyPi2EXYhgmMqV4yVV-NX6swbc38hMXKKGzsTnW4UVaiSOklQ-C1B_af&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;expireIn&quot;</span><span class="punctuation">:</span> <span class="number">3599</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;refreshToken&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;refreshTokenExpireIn&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;openId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;accessCode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;unionId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;scope&quot;</span><span class="punctuation">:</span> <span class="string">&quot;openid https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tokenType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bearer&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;idToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dddddddddd&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;macAlgorithm&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;macKey&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;oauthToken&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;oauthTokenSecret&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;screenName&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;oauthCallbackConfirmed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rawUserInfo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;113911973270419053931&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;email_verified&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Lou&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;given_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Lou&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;locale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zh-CN&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://lh3.googleusercontent.com/a-/AOh14GgncI8eYK_uG119BDclub5LNGDn57G_GI4OLZeOBA=s96-c&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lyloou6@gmail.com&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/lyloou/img/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0-2021-07-02-10-50-48.png" alt="justauthæºç å­¦ä¹ -2021-07-02-10-50-48"><br>åé¢è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¸¦ä¸Š accessToken æ¥å°±å¯ä»¥è·å–äº†ã€‚</p>
<h4 id="Q-http-å·¥å…·å¦‚ä½•è§£è€¦ï¼Œå¯ä»¥å°†é€‰æ‹©æƒäº¤ç»™å¼€å‘è€…ï¼Ÿ"><a href="#Q-http-å·¥å…·å¦‚ä½•è§£è€¦ï¼Œå¯ä»¥å°†é€‰æ‹©æƒäº¤ç»™å¼€å‘è€…ï¼Ÿ" class="headerlink" title="Q: http å·¥å…·å¦‚ä½•è§£è€¦ï¼Œå¯ä»¥å°†é€‰æ‹©æƒäº¤ç»™å¼€å‘è€…ï¼Ÿ"></a>Q: http å·¥å…·å¦‚ä½•è§£è€¦ï¼Œå¯ä»¥å°†é€‰æ‹©æƒäº¤ç»™å¼€å‘è€…ï¼Ÿ</h4><p>ä½œè€…å¼•å…¥äº†è‡ªå·±å®ç°çš„ <code>simple-http</code> å·¥å…·åŒ… <a target="_blank" rel="noopener" href="https://github.com/xkcoding/simple-http">xkcoding/simple-http: æŠ½å–ä¸€ä¸ªç®€å• HTTP çš„é€šç”¨æ¥å£ï¼Œåº•å±‚å®ç°æ ¹æ®å…·ä½“å¼•å…¥ä¾èµ–æŒ‡å®šã€‚</a></p>
<p>ä» <code>AuthGithubRequest#getUserInfo</code> å¼€å§‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> AuthUser <span class="title function_">getUserInfo</span><span class="params">(AuthToken authToken)</span> &#123;</span><br><span class="line">    <span class="type">HttpHeader</span> <span class="variable">header</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeader</span>();</span><br><span class="line">    header.add(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;token &quot;</span> + authToken.getAccessToken());</span><br><span class="line">    <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> (<span class="keyword">new</span> <span class="title class_">HttpUtils</span>(<span class="built_in">this</span>.config.getHttpConfig())).get(UrlBuilder.fromBaseUrl(<span class="built_in">this</span>.source.userInfo()).build(), (Map)<span class="literal">null</span>, header, <span class="literal">false</span>);</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">object</span> <span class="operator">=</span> JSONObject.parseObject(response);</span><br><span class="line">    <span class="built_in">this</span>.checkResponse(object.containsKey(<span class="string">&quot;error&quot;</span>), object.getString(<span class="string">&quot;error_description&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> AuthUser.builder().rawUserInfo(object).uuid(object.getString(<span class="string">&quot;id&quot;</span>)).username(object.getString(<span class="string">&quot;login&quot;</span>)).avatar(object.getString(<span class="string">&quot;avatar_url&quot;</span>)).blog(object.getString(<span class="string">&quot;blog&quot;</span>)).nickname(object.getString(<span class="string">&quot;name&quot;</span>)).company(object.getString(<span class="string">&quot;company&quot;</span>)).location(object.getString(<span class="string">&quot;location&quot;</span>)).email(object.getString(<span class="string">&quot;email&quot;</span>)).remark(object.getString(<span class="string">&quot;bio&quot;</span>)).gender(AuthUserGender.UNKNOWN).token(authToken).source(<span class="built_in">this</span>.source.toString()).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå®ä¾‹åŒ–äº†ä¸€ä¸ª HttpUtils å·¥å…·ç±» <code>new HttpUtils(this.config.getHttpConfig())</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HttpUtils</span><span class="params">(HttpConfig config)</span> &#123;</span><br><span class="line">        HttpUtil.setConfig(config);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpUtil</span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConfig</span><span class="params">(HttpConfig httpConfig)</span> &#123;</span><br><span class="line">		checkHttpNotNull(proxy);</span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">null</span> == httpConfig) &#123;</span><br><span class="line">			httpConfig = HttpConfig.builder().timeout(Constants.DEFAULT_TIMEOUT).build();</span><br><span class="line">		&#125;</span><br><span class="line">		proxy.setHttpConfig(httpConfig);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkHttpNotNull</span><span class="params">(Http proxy)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">null</span> == proxy) &#123;</span><br><span class="line">			selectHttpProxy();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ° <code>selectHttpProxy()</code>è¿™é‡Œæ˜¯å…³é”®ï¼Œé€šè¿‡ <code>ClassUtil.isPresent</code>çš„æ–¹å¼ï¼ˆå³<code>Class.forName</code>ï¼‰æ¥ç¡®å®š class æ˜¯å¦å¯ä»¥è¢«åŠ è½½ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œå¦‚æœå¯ä»¥è¢«åŠ è½½ï¼Œå°±ä½œä¸º http çš„å…·ä½“ä»£ç†ã€‚ï¼ˆæ‰€ä»¥å¼•å…¥äº†ç›¸å…³çš„ http ä¾èµ–ï¼Œ<code>HttpUtils</code> å°±å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨äº†ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpUtil</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> AbstractHttp proxy;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">selectHttpProxy</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">AbstractHttp</span> <span class="variable">defaultProxy</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">		<span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> HttpUtil.class.getClassLoader();</span><br><span class="line">		<span class="comment">// åŸºäº java 11 HttpClient</span></span><br><span class="line">		<span class="keyword">if</span> (ClassUtil.isPresent(<span class="string">&quot;java.net.http.HttpClient&quot;</span>, classLoader)) &#123;</span><br><span class="line">			defaultProxy = getHttpProxy(com.xkcoding.http.support.java11.HttpClientImpl.class);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// åŸºäº okhttp3</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">null</span> == defaultProxy &amp;&amp; ClassUtil.isPresent(<span class="string">&quot;okhttp3.OkHttpClient&quot;</span>, classLoader)) &#123;</span><br><span class="line">			defaultProxy = getHttpProxy(com.xkcoding.http.support.okhttp3.OkHttp3Impl.class);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// åŸºäº httpclient</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">null</span> == defaultProxy &amp;&amp; ClassUtil.isPresent(<span class="string">&quot;org.apache.http.impl.client.HttpClients&quot;</span>, classLoader)) &#123;</span><br><span class="line">			defaultProxy = getHttpProxy(com.xkcoding.http.support.httpclient.HttpClientImpl.class);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// åŸºäº hutool</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">null</span> == defaultProxy &amp;&amp; ClassUtil.isPresent(<span class="string">&quot;cn.hutool.http.HttpRequest&quot;</span>, classLoader)) &#123;</span><br><span class="line">			defaultProxy = getHttpProxy(com.xkcoding.http.support.hutool.HutoolImpl.class);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (defaultProxy == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SimpleHttpException</span>(<span class="string">&quot;Has no HttpImpl defined in environment!&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		proxy = defaultProxy;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸‹å›¾ï¼Œæ˜¯ <code>simpleHttp</code> é»˜è®¤æ”¯æŒçš„ Http å·¥å…·ã€‚</p>
<p><img src="http://cdn.lyloou.com/img/20210625112103.png" alt="image-20210625112056585"></p>
<p>ä¹Ÿå¯ä»¥è‡ªå·±ç»§æ‰¿ <code>AbstractHttp</code>ï¼Œç„¶åè°ƒç”¨ <code>HttpUtil#setHttp(AbstractHttp http)</code> æ–¹æ³•æ¥æ¥å…¥è‡ªå·±å®ç°çš„ http å·¥å…·ã€‚</p>
<p>æ‰€æœ‰å®ç° AbstractHttp å’Œ Http çš„ç±»ï¼Œéœ€è¦è‡ªå·±å®ç° ä¸€ç³»åˆ—çš„<code>get</code>ã€ <code>post</code> æ–¹æ³•ï¼ˆå³å°è£…ï¼‰ã€‚è¿è¡Œæ—¶é€šè¿‡é¢å‘å¯¹è±¡ä¸­çš„å¤šæ€æ¥å†³å®šå…·ä½“çš„å®ç°è€…ã€‚</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/java/" rel="tag"># java</a>
              <a href="/tags/%E6%BA%90%E7%A0%81/" rel="tag"># æºç </a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/business/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" rel="prev" title="åˆ†å¸ƒå¼äº‹åŠ¡">
                  <i class="fa fa-chevron-left"></i> åˆ†å¸ƒå¼äº‹åŠ¡
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/business/%E7%AD%BE%E5%90%8D%E8%AE%BE%E8%AE%A1/" rel="next" title="æ¥å£ç­¾åæ ¡éªŒè®¾è®¡">
                  æ¥å£ç­¾åæ ¡éªŒè®¾è®¡ <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  
  <div class="comments giscus-container">
  </div>
  
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">ç²¤ICPå¤‡18151128å· </a>
  </div>

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lyloou</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>






  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<script class="next-config" data-name="giscus" type="application/json">{"enable":true,"repo":"lyloou/lyloou.github.io","repo_id":"MDEwOlJlcG9zaXRvcnkxMDk1NzkyNzA=","category":"Announcements","category_id":"DIC_kwDOBogMBs4CWdfR","mapping":"pathname","reactions_enabled":1,"emit_metadata":1,"theme":"light","lang":"zh-CN","input_position":"bottom","loading":"lazy"}</script>

<script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.page.comments) return;

  NexT.utils.loadComments('.giscus-container')
    .then(() => NexT.utils.getScript('https://giscus.app/client.js', {
      attributes: {
        async                   : true,
        crossOrigin             : 'anonymous',
        'data-repo'             : CONFIG.giscus.repo,
        'data-repo-id'          : CONFIG.giscus.repo_id,
        'data-category'         : CONFIG.giscus.category,
        'data-category-id'      : CONFIG.giscus.category_id,
        'data-mapping'          : CONFIG.giscus.mapping,
        'data-reactions-enabled': CONFIG.giscus.reactions_enabled,
        'data-emit-metadata'    : CONFIG.giscus.emit_metadata,
        'data-theme'            : CONFIG.giscus.theme,
        'data-lang'             : CONFIG.giscus.lang,
        'data-input-position'   : CONFIG.giscus.input_position,
        'data-loading'          : CONFIG.giscus.loading
      },
      parentNode: document.querySelector('.giscus-container')
    }));
});
</script>

</body>
</html>
