<!DOCTYPE html>
<html lang="zh-CN,zh-HK,zh-TW,en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lyloou.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":{"gitalk":{"order":-2}}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="&#x2F;* Better than last best *&#x2F;">
<meta property="og:type" content="website">
<meta property="og:title" content="lyloou">
<meta property="og:url" content="https://lyloou.github.io/page/17/index.html">
<meta property="og:site_name" content="lyloou">
<meta property="og:description" content="&#x2F;* Better than last best *&#x2F;">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lyloou">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://lyloou.github.io/page/17/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>lyloou</title>
  
    <script>
      function sendPageView() {
        if (CONFIG.hostname !== location.hostname) return;
        var uid = localStorage.getItem('uid') || (Math.random() + '.' + Math.random());
        localStorage.setItem('uid', uid);
        navigator.sendBeacon('https://www.google-analytics.com/collect', new URLSearchParams({
          v  : 1,
          tid: 'UA-80542932-1',
          cid: uid,
          t  : 'pageview',
          dp : encodeURIComponent(location.pathname)
        }));
      }
      document.addEventListener('pjax:complete', sendPageView);
      sendPageView();
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta custom-logo">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">lyloou</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lyloou.github.io/ssm/mybatis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/images/avatar.png">
      <meta itemprop="name" content="lyloou">
      <meta itemprop="description" content="/* Better than last best */">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyloou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ssm/mybatis/" class="post-title-link" itemprop="url">Mybatis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-12 19:47:02" itemprop="dateCreated datePublished" datetime="2018-09-12T19:47:02+08:00">2018-09-12</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><ul>
<li><p><a href="http://www.mybatis.org/spring/factorybean.html" target="_blank" rel="noopener">mybatis-spring – MyBatis-Spring | SqlSessionFactoryBean</a></p>
<blockquote>
<p>In normal MyBatis-Spring usage, you will not need to use SqlSessionFactoryBean or the corresponding SqlSessionFactory directly. Instead, the session factory will be injected into MapperFactoryBeans or other DAOs that extend SqlSessionDaoSupport .</p>
</blockquote>
</li>
<li><p><a href="https://blog.csdn.net/techbirds_bao/article/details/9235547" target="_blank" rel="noopener">Myibatis 和 spring(mvc)的集成 - CSDN 博客</a></p>
</li>
</ul>
<h2 id="nested-exception-is-org-apache-ibatis-reflection-ReflectionException-There-is-no-getter-for-property-named"><a href="#nested-exception-is-org-apache-ibatis-reflection-ReflectionException-There-is-no-getter-for-property-named" class="headerlink" title="nested exception is org.apache.ibatis.reflection.ReflectionException: There is no getter for property named"></a>nested exception is org.apache.ibatis.reflection.ReflectionException: There is no getter for property named</h2><p>2020-01-02 19:01:21 [WARN] ExceptionHandlerExceptionResolver:194 - Resolved [org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.reflection.ReflectionException: There is no getter for property named ‘is_disabled’ in ‘class com.lyloou.flow.model.flow.Flow’]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 错误的</span><br><span class="hljs-meta">@Update</span>(<span class="hljs-string">"insert into flow (day,item,is_disabled,is_archived) values (#&#123;day&#125;,#&#123;item&#125;,#&#123;is_disabled&#125;,#&#123;is_archived&#125;) on duplicate key update"</span> +<br>            <span class="hljs-string">" item=values(item),is_disabled=values(is_disabled),is_archived=values(is_archived)"</span>)<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insertOrUpdateFlow</span><span class="hljs-params">(Flow flow)</span></span>;<br><br><span class="hljs-comment">// 正确的</span><br><span class="hljs-meta">@Update</span>(<span class="hljs-string">"insert into flow (day,item,is_disabled,is_archived) values (#&#123;day&#125;,#&#123;item&#125;,#&#123;isDisabled&#125;,#&#123;isArchived&#125;) on duplicate key update"</span> +<br>            <span class="hljs-string">" item=values(item),is_disabled=values(is_disabled),is_archived=values(is_archived)"</span>)<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insertOrUpdateFlow</span><span class="hljs-params">(Flow flow)</span></span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Builder</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flow</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-keyword">private</span> Date gmtCreate;<br><br>    <span class="hljs-keyword">private</span> Date gmtModified;<br><br>    <span class="hljs-keyword">private</span> String day;<br><br>    <span class="hljs-keyword">private</span> String item;<br><br>    <span class="hljs-keyword">private</span> Boolean isArchived;<br><br>    <span class="hljs-keyword">private</span> Boolean isDisabled;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs md">2020-01-02 19:01:21 [WARN] ExceptionHandlerExceptionResolver:194 - Resolved [org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.reflection.ReflectionException: There is no getter for property named 'is_disabled' in 'class com.lyloou.flow.model.flow.Flow']<br><br>答案：因为解决的时候用到的是 <span class="hljs-code">`flow.isDisabled`</span> 属性，因为传递的是 <span class="hljs-code">`flow.is_disabled`</span> 所以不行<br></code></pre></td></tr></table></figure>

<h2 id="按照输入-id-顺序来返回数据"><a href="#按照输入-id-顺序来返回数据" class="headerlink" title="按照输入 id 顺序来返回数据"></a>按照输入 id 顺序来返回数据</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"queryOrderedAuthorByauthorIds"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"BaseResultMap"</span>&gt;</span><br>  select * from video_author a<br>  where a.user_id in<br>    <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">"authorIds"</span> <span class="hljs-attr">item</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"index"</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">","</span> <span class="hljs-attr">open</span>=<span class="hljs-string">"("</span> <span class="hljs-attr">close</span>=<span class="hljs-string">")"</span>&gt;</span><br>      #&#123;item&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>  and a.user_status=0<br>  -- 按照输入的顺序来返回排序<br>  order by field(a.user_id,<br>    <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">"authorIds"</span> <span class="hljs-attr">item</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"index"</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">","</span>&gt;</span><br>      #&#123;item&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>  )<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="自动填充字段"><a href="#自动填充字段" class="headerlink" title="自动填充字段"></a>自动填充字段</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Person.java</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Accessors</span>(chain = <span class="hljs-keyword">true</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>  <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-meta">@TableId</span>(type = IdType.AUTO)<br>    <span class="hljs-meta">@ApiModelProperty</span>(value = <span class="hljs-string">"实体ID"</span>)<br>    <span class="hljs-keyword">private</span> Integer id;<br><br>    <span class="hljs-meta">@ApiModelProperty</span>(value = <span class="hljs-string">"创建时间"</span>)<br>    <span class="hljs-meta">@TableField</span>(fill = FieldFill.INSERT)<br>    <span class="hljs-keyword">private</span> Date createdTime;<br><br>    <span class="hljs-meta">@ApiModelProperty</span>(value = <span class="hljs-string">"更新时间"</span>)<br>    <span class="hljs-meta">@TableField</span>(fill = FieldFill.INSERT_UPDATE)<br>    <span class="hljs-keyword">private</span> Date updatedTime;<br><br>    <span class="hljs-meta">@ApiModelProperty</span>(value = <span class="hljs-string">"创建人"</span>)<br>    <span class="hljs-meta">@TableField</span>(value = <span class="hljs-string">"creator"</span>, fill = FieldFill.INSERT)<br>    <span class="hljs-keyword">private</span> String creator;<br><br>    <span class="hljs-meta">@ApiModelProperty</span>(value = <span class="hljs-string">"修改人"</span>)<br>    <span class="hljs-meta">@TableField</span>(value = <span class="hljs-string">"modifier"</span>, fill = FieldFill.INSERT_UPDATE)<br>    <span class="hljs-keyword">private</span> String modifier;<br>&#125;<br><br><span class="hljs-comment">// MybatisObjectHandler.java</span><br><span class="hljs-comment">// [自动填充功能 | MyBatis-Plus](https://baomidou.com/guide/auto-fill-metainfo.html)</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MybatisObjectHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MetaObjectHandler</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> </span>&#123;<br>        Integer userId = AuthenticationService.getUserId();<br>        <span class="hljs-keyword">if</span> (userId != <span class="hljs-keyword">null</span>) &#123;<br>            Stream.of(<span class="hljs-string">"createdBy"</span>, <span class="hljs-string">"updatedBy"</span>, <span class="hljs-string">"modifier"</span>, <span class="hljs-string">"creator"</span>)<br>                    .forEach(s -&gt; setFieldValIfNull(s, userId.toString(), metaObject));<br>        &#125;<br><br>        Stream.of(<span class="hljs-string">"createdTime"</span>, <span class="hljs-string">"updatedTime"</span>)<br>                .forEach(s -&gt; setFieldValIfNull(s, <span class="hljs-keyword">new</span> Date(), metaObject));<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setFieldValIfNull</span><span class="hljs-params">(String field, Object fieldVal, MetaObject metaObject)</span> </span>&#123;<br>        <span class="hljs-keyword">final</span> Object value = getFieldValByName(field, metaObject);<br>        <span class="hljs-keyword">if</span> (value != <span class="hljs-keyword">null</span>) &#123;<br>            setFieldValByName(field, fieldVal, metaObject);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> </span>&#123;<br>        <span class="hljs-comment">//更新时 需要填充字段</span><br>        Stream.of(<span class="hljs-string">"updatedTime"</span>)<br>                .forEach(s -&gt; setFieldValIfNull(s, <span class="hljs-keyword">new</span> Date(), metaObject));<br>        setFieldValByName(<span class="hljs-string">"updatedTime"</span>, <span class="hljs-keyword">new</span> Date(), metaObject);<br>        Integer userId = AuthenticationService.getUserId();<br>        <span class="hljs-keyword">if</span> (userId != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">//更新时填充的字段</span><br>            Stream.of(<span class="hljs-string">"updatedBy"</span>, <span class="hljs-string">"modifier"</span>)<br>                    .forEach(s -&gt; setFieldValIfNull(s, userId.toString(), metaObject));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="mybatis-深入理解-一-之-与-区别以及-sql-预编译-SegmentFault-思否"><a href="#mybatis-深入理解-一-之-与-区别以及-sql-预编译-SegmentFault-思否" class="headerlink" title="mybatis 深入理解(一)之 # 与 $ 区别以及 sql 预编译 - SegmentFault 思否"></a><a href="https://segmentfault.com/a/1190000004617028" target="_blank" rel="noopener">mybatis 深入理解(一)之 # 与 $ 区别以及 sql 预编译 - SegmentFault 思否</a></h2><p>mybatis 中使用 sqlMap 进行 sql 查询时，经常需要动态传递参数，例如我们需要根据用户的姓名来筛选用户时，sql 如下：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> = "ruhua";<br></code></pre></td></tr></table></figure>

<p>上述 sql 中，我们希望 name 后的参数 “ruhua” 是动态可变的，即不同的时刻根据不同的姓名来查询用户。在 sqlMap 的 xml 文件中使用如下的 sql 可以实现动态传递参数 name：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> = #&#123;<span class="hljs-type">name</span>&#125;;<br></code></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> = <span class="hljs-string">'$&#123;name&#125;'</span>;<br></code></pre></td></tr></table></figure>

<p>对于上述这种查询情况来说，使用 #{ } 和 ${ } 的结果是相同的，但是在某些情况下，我们只能使用二者其一。</p>
<h2 id="‘-’-与-‘-’"><a href="#‘-’-与-‘-’" class="headerlink" title="‘#’ 与 ‘$’"></a>‘#’ 与 ‘$’</h2><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p><strong>动态 SQL</strong> 是 mybatis 的强大特性之一，也是它优于其他 ORM 框架的一个重要原因。mybatis 在对 sql 语句进行预编译之前，会对 sql 进行动态解析，解析为一个 BoundSql 对象，也是在此处对动态 SQL 进行处理的。</p>
<p>在动态 SQL 解析阶段， #{ } 和 ${ } 会有不同的表现：</p>
<blockquote>
<p><strong>#{ } 解析为一个 JDBC 预编译语句（prepared statement）的参数标记符。</strong></p>
</blockquote>
<p>例如，sqlMap 中如下的 sql 语句</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> = #&#123;<span class="hljs-type">name</span>&#125;;<br></code></pre></td></tr></table></figure>

<p>解析为：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> = ?;<br></code></pre></td></tr></table></figure>

<p>一个 #{ } 被解析为一个参数占位符 <code>?</code> 。</p>
<p>而，</p>
<blockquote>
<p><strong>${ } 仅仅为一个纯碎的 string 替换，在动态 SQL 解析阶段将会进行变量替换</strong></p>
</blockquote>
<p>例如，sqlMap 中如下的 sql</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> = <span class="hljs-string">'$&#123;name&#125;'</span>;<br></code></pre></td></tr></table></figure>

<p>当我们传递的参数为 “ruhua” 时，上述 sql 的解析为：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> = "ruhua";<br></code></pre></td></tr></table></figure>

<p>预编译之前的 SQL 语句已经不包含变量 name 了。</p>
<p>综上所得， ${ } 的变量的替换阶段是在动态 SQL 解析阶段，而 #{ }的变量的替换是在 DBMS 中。</p>
<h3 id="用法-tips"><a href="#用法-tips" class="headerlink" title="用法 tips"></a>用法 tips</h3><blockquote>
<p>1、能使用 #{ } 的地方就用 #{ }</p>
</blockquote>
<p>首先这是为了性能考虑的，相同的预编译 sql 可以重复利用。</p>
<p>其次，<strong>${ } 在预编译之前已经被变量替换了，这会存在 sql 注入问题</strong>。例如，如下的 sql，</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> $&#123;tableName&#125; <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> = #&#123;<span class="hljs-type">name</span>&#125;<br></code></pre></td></tr></table></figure>

<p>假如，我们的参数 tableName 为 <code>user; delete user; --</code>，那么 SQL 动态解析阶段之后，预编译之前的 sql 将变为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>; <span class="hljs-keyword">delete</span> <span class="hljs-keyword">user</span>; <span class="hljs-comment">-- where name = ?;</span><br></code></pre></td></tr></table></figure>

<p><code>--</code> 之后的语句将作为注释，不起作用，因此本来的一条查询语句偷偷的包含了一个删除表数据的 SQL！</p>
<blockquote>
<p>2、表名作为变量时，必须使用 ${ }</p>
</blockquote>
<p>这是因为，表名是字符串，使用 sql 占位符替换字符串时会带上单引号 <code>&#39;&#39;</code>，这会导致 sql 语法错误，例如：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> #&#123;tableName&#125; <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> = #&#123;<span class="hljs-type">name</span>&#125;;<br></code></pre></td></tr></table></figure>

<p>预编译之后的 sql 变为：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> ? <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> = ?;<br></code></pre></td></tr></table></figure>

<p>假设我们传入的参数为 tableName = “user” , name = “ruhua”，那么在占位符进行变量替换后，sql 语句变为</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'user'</span> <span class="hljs-keyword">where</span> <span class="hljs-type">name</span>=<span class="hljs-string">'ruhua'</span>;<br></code></pre></td></tr></table></figure>

<p>上述 sql 语句是存在语法错误的，表名不能加单引号 <code>&#39;&#39;</code>（注意，反引号 ``是可以的）。</p>
<h2 id="sql-预编译"><a href="#sql-预编译" class="headerlink" title="sql 预编译"></a>sql 预编译</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><blockquote>
<p>sql 预编译指的是数据库驱动在发送 sql 语句和参数给 DBMS 之前对 sql 语句进行编译，这样 DBMS 执行 sql 时，就不需要重新编译。</p>
</blockquote>
<h3 id="为什么需要预编译"><a href="#为什么需要预编译" class="headerlink" title="为什么需要预编译"></a>为什么需要预编译</h3><p>JDBC 中使用对象 PreparedStatement 来抽象预编译语句，使用预编译</p>
<ol>
<li><strong>预编译阶段可以优化 sql 的执行</strong>。<br>预编译之后的 sql 多数情况下可以直接执行，DBMS 不需要再次编译，越复杂的 sql，编译的复杂度将越大，预编译阶段可以合并多次操作为一个操作。</li>
<li><strong>预编译语句对象可以重复利用</strong>。<br>把一个 sql 预编译后产生的 PreparedStatement 对象缓存下来，下次对于同一个 sql，可以直接使用这个缓存的 PreparedState 对象。</li>
</ol>
<p>mybatis 默认情况下，将对所有的 sql 进行预编译。</p>
<h3 id="mysql-预编译源码解析"><a href="#mysql-预编译源码解析" class="headerlink" title="mysql 预编译源码解析"></a>mysql 预编译源码解析</h3><p>mysql 的预编译源码在 <code>com.mysql.jdbc.ConnectionImpl</code> 类中，如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> synchronized java.sql.PreparedStatement prepareStatement(String sql,<br>            int resultSetType, int resultSetConcurrency) throws SQLException &#123;<br>        checkClosed();<br><br>        <span class="hljs-comment">//</span><br>        <span class="hljs-comment">// <span class="hljs-doctag">FIXME:</span> Create warnings if can't create results of the given</span><br>        <span class="hljs-comment">// type or concurrency</span><br>        <span class="hljs-comment">//</span><br>        PreparedStatement pStmt = <span class="hljs-literal">null</span>;<br><br>        boolean canServerPrepare = <span class="hljs-literal">true</span>;<br><br>        <span class="hljs-comment">// 不同的数据库系统对sql进行语法转换</span><br>        String nativeSql = getProcessEscapeCodesForPrepStmts() ? nativeSQL(sql): sql;<br><br>        <span class="hljs-comment">// 判断是否可以进行服务器端预编译</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.useServerPreparedStmts &amp;&amp; getEmulateUnsupportedPstmts()) &#123;<br>            canServerPrepare = canHandleAsServerPreparedStatement(nativeSql);<br>        &#125;<br><br>        <span class="hljs-comment">// 如果可以进行服务器端预编译</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.useServerPreparedStmts &amp;&amp; canServerPrepare) &#123;<br><br>            <span class="hljs-comment">// 是否缓存了PreparedStatement对象</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.getCachePreparedStatements()) &#123;<br>                synchronized (<span class="hljs-keyword">this</span>.serverSideStatementCache) &#123;<br><br>                    <span class="hljs-comment">// 从缓存中获取缓存的PreparedStatement对象</span><br>                    pStmt = (com.mysql.jdbc.ServerPreparedStatement)<span class="hljs-keyword">this</span>.serverSideStatementCache.remove(sql);<br><br>                    <span class="hljs-keyword">if</span> (pStmt != <span class="hljs-literal">null</span>) &#123;<br>                        <span class="hljs-comment">// 缓存中存在对象时对原 sqlStatement 进行参数清空等</span><br>                        ((com.mysql.jdbc.ServerPreparedStatement)pStmt).setClosed(<span class="hljs-literal">false</span>);<br>                        pStmt.clearParameters();<br>                    &#125;<br><br>                    <span class="hljs-keyword">if</span> (pStmt == <span class="hljs-literal">null</span>) &#123;<br>                        <span class="hljs-keyword">try</span> &#123;<br>                            <span class="hljs-comment">// 如果缓存中不存在，则调用服务器端(数据库)进行预编译</span><br>                            pStmt = ServerPreparedStatement.getInstance(getLoadBalanceSafeProxy(), nativeSql,<br>                                    <span class="hljs-keyword">this</span>.database, resultSetType, resultSetConcurrency);<br>                            <span class="hljs-keyword">if</span> (sql.length() &lt; getPreparedStatementCacheSqlLimit()) &#123;<br>                                ((com.mysql.jdbc.ServerPreparedStatement)pStmt).isCached = <span class="hljs-literal">true</span>;<br>                            &#125;<br><br>                            <span class="hljs-comment">// 设置返回类型以及并发类型</span><br>                            pStmt.setResultSetType(resultSetType);<br>                            pStmt.setResultSetConcurrency(resultSetConcurrency);<br>                        &#125; <span class="hljs-keyword">catch</span> (SQLException sqlEx) &#123;<br>                            <span class="hljs-comment">// Punt, if necessary</span><br>                            <span class="hljs-keyword">if</span> (getEmulateUnsupportedPstmts()) &#123;<br>                                pStmt = (PreparedStatement) clientPrepareStatement(nativeSql, resultSetType, resultSetConcurrency, <span class="hljs-literal">false</span>);<br><br>                                <span class="hljs-keyword">if</span> (sql.length() &lt; getPreparedStatementCacheSqlLimit()) &#123;<br>                                    <span class="hljs-keyword">this</span>.serverSideStatementCheckCache.put(sql, <span class="hljs-built_in">Boolean</span>.FALSE);<br>                                &#125;<br>                            &#125; <span class="hljs-keyword">else</span> &#123;<br>                                <span class="hljs-keyword">throw</span> sqlEx;<br>                            &#125;<br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br><br>                <span class="hljs-comment">// 未启用缓存时，直接调用服务器端进行预编译</span><br>                <span class="hljs-keyword">try</span> &#123;<br>                    pStmt = ServerPreparedStatement.getInstance(getLoadBalanceSafeProxy(), nativeSql,<br>                            <span class="hljs-keyword">this</span>.database, resultSetType, resultSetConcurrency);<br><br>                    pStmt.setResultSetType(resultSetType);<br>                    pStmt.setResultSetConcurrency(resultSetConcurrency);<br>                &#125; <span class="hljs-keyword">catch</span> (SQLException sqlEx) &#123;<br>                    <span class="hljs-comment">// Punt, if necessary</span><br>                    <span class="hljs-keyword">if</span> (getEmulateUnsupportedPstmts()) &#123;<br>                        pStmt = (PreparedStatement) clientPrepareStatement(nativeSql, resultSetType, resultSetConcurrency, <span class="hljs-literal">false</span>);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        <span class="hljs-keyword">throw</span> sqlEx;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// 不支持服务器端预编译时调用客户端预编译（不需要数据库 connection ）</span><br>            pStmt = (PreparedStatement) clientPrepareStatement(nativeSql, resultSetType, resultSetConcurrency, <span class="hljs-literal">false</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> pStmt;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>流程图如下所示：</p>
<p><img src="https://segmentfault.com/img/bVtwuY" alt="图片描述"></p>
<h2 id="mybatis-之-sql-动态解析以及预编译源码"><a href="#mybatis-之-sql-动态解析以及预编译源码" class="headerlink" title="mybatis 之 sql 动态解析以及预编译源码"></a>mybatis 之 sql 动态解析以及预编译源码</h2><h3 id="mybatis-sql-动态解析"><a href="#mybatis-sql-动态解析" class="headerlink" title="mybatis sql 动态解析"></a>mybatis sql 动态解析</h3><p>mybatis 在调用 connection 进行 sql 预编译之前，会对 sql 语句进行动态解析，动态解析主要包含如下的功能：</p>
<ul>
<li>占位符的处理</li>
<li>动态 sql 的处理</li>
<li>参数类型校验</li>
</ul>
<p>mybatis 强大的动态 SQL 功能的具体实现就在此。动态解析涉及的东西太多，以后再讨论。</p>
<h2 id="批量处理示例（修复歌手名称）"><a href="#批量处理示例（修复歌手名称）" class="headerlink" title="批量处理示例（修复歌手名称）"></a>批量处理示例（修复歌手名称）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fixSongSingleName</span><span class="hljs-params">()</span> </span>&#123;<br>     <span class="hljs-comment">// 从0开始</span><br>     <span class="hljs-keyword">int</span> id = <span class="hljs-number">0</span>;<br>     <span class="hljs-comment">// 每次查询100条</span><br>     <span class="hljs-keyword">int</span> limit = <span class="hljs-number">100</span>;<br>     List&lt;CcMusicInfoEntity&gt; list;<br>     <span class="hljs-keyword">do</span> &#123;<br>         list = ccMusicInfoMapper.queryListByLastIdWithLimit(id, limit);<br>         <span class="hljs-keyword">if</span> (CollUtil.isEmpty(list)) &#123;<br>             <span class="hljs-keyword">break</span>;<br>         &#125;<br><br>         <span class="hljs-comment">// 记录下一次的开始的id</span><br>         id = list.get(list.size() - <span class="hljs-number">1</span>).getId();<br><br>         <span class="hljs-comment">// 找到需要更新的实体</span><br>         <span class="hljs-keyword">final</span> List&lt;CcMusicInfoEntity&gt; needUpdateList = list.stream()<br>                 .filter(Objects::nonNull)<br>                 .filter(it -&gt; SingerNameUtil.isContainCombinedSeparator(it.getSingerName()))<br>                 .collect(Collectors.toList());<br><br>         <span class="hljs-comment">// 在db中更新实体</span><br>         <span class="hljs-keyword">if</span> (CollUtil.isNotEmpty(needUpdateList)) &#123;<br>             <span class="hljs-keyword">final</span> List&lt;String&gt; originSingerNameList = needUpdateList.stream().map(CcMusicInfoEntity::getSingerName).collect(Collectors.toList());<br>             updateSongSingerInfo(needUpdateList);<br><br>             Map&lt;Integer, String&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;(needUpdateList.size());<br>             <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; needUpdateList.size(); i++) &#123;<br>                 <span class="hljs-keyword">final</span> CcMusicInfoEntity entity = needUpdateList.get(i);<br>                 <span class="hljs-keyword">final</span> String originSingerName = originSingerNameList.get(i);<br>                 map.put(entity.getId(), StrUtil.format(<span class="hljs-string">"更新前:&#123;&#125;，更新后:&#123;&#125;"</span>, originSingerName, entity.getSingerName()));<br>             &#125;<br>             logger.info(StrUtil.format(<span class="hljs-string">"fixSongSingleName 本次更新数量，&#123;&#125;，修改数据：&#123;&#125;"</span>, needUpdateList.size(), map));<br>         &#125;<br>         logger.info(<span class="hljs-string">"fixSongSingleName: 本次更新到ID，"</span> + id);<br>         <span class="hljs-comment">// break;</span><br>     &#125; <span class="hljs-keyword">while</span> (CollUtil.isNotEmpty(list));<br>     logger.info(<span class="hljs-string">"fixSongSingleName: 本次更新完成"</span>);<br> &#125;<br><br> <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateSongSingerInfo</span><span class="hljs-params">(List&lt;MusicInfoEntity&gt; needUpdateList)</span> </span>&#123;<br>     List&lt;MusicInfoEntity&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(needUpdateList.size());<br>     <span class="hljs-keyword">for</span> (MusicInfoEntity entity : needUpdateList) &#123;<br>         <span class="hljs-keyword">final</span> String originSingerName = entity.getSingerName();<br>         <span class="hljs-keyword">final</span> String calculateSingerName = SingerNameUtil.calculate(originSingerName);<br><br>         <span class="hljs-comment">// 一样的情况，不用处理</span><br>         <span class="hljs-keyword">if</span> (Objects.equals(originSingerName, calculateSingerName)) &#123;<br>             <span class="hljs-keyword">continue</span>;<br>         &#125;<br>         MusicInfoEntity newCcMusicInfoEntity = <span class="hljs-keyword">new</span> MusicInfoEntity();<br>         newCcMusicInfoEntity.setId(entity.getId());<br>         newCcMusicInfoEntity.setLastUpdateDate(<span class="hljs-keyword">new</span> Date());<br>         newCcMusicInfoEntity.setSingerName(calculateSingerName);<br>         list.add(newCcMusicInfoEntity);<br>     &#125;<br>     <span class="hljs-keyword">if</span> (CollUtil.isNotEmpty(list)) &#123;<br>         musicInfoMapper.updateByList(list);<br>     &#125;<br> &#125;<br></code></pre></td></tr></table></figure>

<p><strong>批量查询：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// MusicInfoMapper.java</span><br><span class="hljs-function">List&lt;MusicInfoEntity&gt; <span class="hljs-title">queryListByLastIdWithLimit</span><span class="hljs-params">(@Param(<span class="hljs-string">"id"</span>)</span> <span class="hljs-keyword">int</span> id, @<span class="hljs-title">Param</span><span class="hljs-params">(<span class="hljs-string">"limit"</span>)</span> <span class="hljs-keyword">int</span> limit)</span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">updateByList</span><span class="hljs-params">(List&lt;MusicInfoEntity&gt; list)</span></span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- MusicInfoMapper.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"queryListByLastIdWithLimit"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"BaseResultMap"</span>&gt;</span><br>    SELECT<br>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">"Base_Column_List"</span> /&gt;</span><br>    FROM t_music_info a<br>    where a.id &gt; #&#123;id&#125; limit #&#123;limit&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p><strong>批量插入：</strong></p>
<p><a href="https://blog.csdn.net/chijiaodaxie/article/details/50210337" target="_blank" rel="noopener">mysql 一条语句 update 多条记录_chijiaodaxie 的博客-CSDN 博客_mysql update 多条数据</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--    原文链接：https://blog.csdn.net/u013506626/article/details/121229892 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateByList"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"object"</span>&gt;</span><br>    update music_info<br>    <span class="hljs-tag">&lt;<span class="hljs-name">trim</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"set"</span> <span class="hljs-attr">suffixOverrides</span>=<span class="hljs-string">","</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">trim</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"singer_name=case"</span> <span class="hljs-attr">suffix</span>=<span class="hljs-string">"end,"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> <span class="hljs-attr">item</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"index"</span>&gt;</span><br>                WHEN id=#&#123;item.id&#125; THEN #&#123;item.singerName&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">trim</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">trim</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"last_update_date=case"</span> <span class="hljs-attr">suffix</span>=<span class="hljs-string">"end,"</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> <span class="hljs-attr">item</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"index"</span>&gt;</span><br>                WHEN id=#&#123;item.id&#125; THEN #&#123;item.lastUpdateDate&#125;<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">trim</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">trim</span>&gt;</span><br><br>    WHERE id IN<br>    <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> <span class="hljs-attr">item</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">open</span>=<span class="hljs-string">"("</span> <span class="hljs-attr">close</span>=<span class="hljs-string">")"</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">","</span>&gt;</span><br>        #&#123;item.id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文主要深入探究了 mybatis 对 #{ } 和 ${ }的不同处理方式，并了解了 sql 预编译。</p>
<h2 id="Mybatis-Mapper-xml-继承机制-SegmentFault-思否"><a href="#Mybatis-Mapper-xml-继承机制-SegmentFault-思否" class="headerlink" title="Mybatis Mapper.xml 继承机制 - SegmentFault 思否"></a><a href="https://segmentfault.com/a/1190000012470056" target="_blank" rel="noopener">Mybatis Mapper.xml 继承机制 - SegmentFault 思否</a></h2><h2 id="mybatis-中大于等于小于等于的写法"><a href="#mybatis-中大于等于小于等于的写法" class="headerlink" title="mybatis 中大于等于小于等于的写法"></a><a href="https://blog.csdn.net/xuanzhangran/article/details/60329357" target="_blank" rel="noopener">mybatis 中大于等于小于等于的写法</a></h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs ini">第一种写法（1）：<br><br>原符号       &lt;        &lt;=      &gt;       &gt;=       &amp;        '        "<br>替换符号    &amp;lt;    &amp;lt;=   &amp;gt;    &amp;gt;=   &amp;amp;   &amp;apos;  &amp;quot;<br>例如：sql如下：<br>create_date_time &amp;gt;= #&#123;startTime&#125; and  create_date_time &amp;lt;= #&#123;endTime&#125;<br><br>第二种写法（2）：<br>大于等于<br>&lt;![CDATA[ &gt;= ]]&gt;<br>小于等于<br>&lt;![CDATA[ &lt;= ]]&gt;<br>例如：sql如下：<br>create_date_time &lt;![CDATA[ &gt;= ]]&gt; #&#123;startTime&#125; and  create_date_time &lt;![CDATA[ &lt;= ]]&gt; #&#123;endTime&#125;<br></code></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lyloou.github.io/ssm/spring-mvc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/images/avatar.png">
      <meta itemprop="name" content="lyloou">
      <meta itemprop="description" content="/* Better than last best */">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyloou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ssm/spring-mvc/" class="post-title-link" itemprop="url">Spring-Mvc</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-10 18:28:02" itemprop="dateCreated datePublished" datetime="2018-09-10T18:28:02+08:00">2018-09-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p><img src="/.io//mvc_flow.png" alt="mvc 流程"></p>
<h2 id="处理器是如何-JSON-转换成-Java-对象"><a href="#处理器是如何-JSON-转换成-Java-对象" class="headerlink" title="处理器是如何 JSON 转换成 Java 对象"></a>处理器是如何 JSON 转换成 Java 对象</h2><p>使用的是 HttpMessageConverter 机制<br>在这个接口里面有 5 个方法，canRead, canWrite, write, read, getSupportMediaTypes<br>在发起 http 请求的时候，先读取 HTTP 请求的请求体；<br>然后在 HttpMessageConverter 众多实例中（由 Spring MVC 组织成一条链存放）根据 canRead 方法来判断实例能否转换，<br>这样就找到了 MappingJackson2HttpMessageConverter 实例了，<br>接着执行 read 方法，将请求体转换成 Java 对象。<br><a href="https://m.imooc.com/collector/read/62" target="_blank" rel="noopener">https://m.imooc.com/collector/read/62</a></p>
<h2 id="IDEA-配置-tomcat"><a href="#IDEA-配置-tomcat" class="headerlink" title="IDEA 配置 tomcat"></a>IDEA 配置 tomcat</h2><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/202203021514358.png" alt="202203021514358"><br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/202203021515228.png" alt="202203021515228"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://iamsaurabh.wordpress.com/2017/02/11/configure-a-spring-mvc-project-with-intellij-idea/" target="_blank" rel="noopener">Configure a Spring MVC Project with Intellij IDEA | In My Own Write</a></li>
<li><a href="https://www.jianshu.com/p/bae8f30300c5" target="_blank" rel="noopener">Maven + Spring mvc 配置 webApp</a></li>
<li><a href="https://github.com/lyloou/spring-mvc-simple-demo" target="_blank" rel="noopener">spring-mvc-simple-demo</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lyloou.github.io/android/%E6%9D%83%E9%99%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/images/avatar.png">
      <meta itemprop="name" content="lyloou">
      <meta itemprop="description" content="/* Better than last best */">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyloou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/android/%E6%9D%83%E9%99%90/" class="post-title-link" itemprop="url">权限问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-30 11:58:08" itemprop="dateCreated datePublished" datetime="2018-08-30T11:58:08+08:00">2018-08-30</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考资料：<a href="https://www.2cto.com/kf/201611/561860.html" target="_blank" rel="noopener">Android 6.0 动态权限申请详解 - Android移动开发技术文章_手机开发 - 红黑联盟</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-meta">@TargetApi</span>(Build.VERSION_CODES.M)<br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">requestPermission</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (ContextCompat.checkSelfPermission(mContext, Manifest.permission.CAMERA)<br>            == PackageManager.PERMISSION_GRANTED<br>            &amp;&amp; ContextCompat.checkSelfPermission(mContext, Manifest.permission.WRITE_EXTERNAL_STORAGE)<br>            == PackageManager.PERMISSION_GRANTED<br>            &amp;&amp; ContextCompat.checkSelfPermission(mContext, Manifest.permission.READ_EXTERNAL_STORAGE)<br>            == PackageManager.PERMISSION_GRANTED) &#123;<br>        <span class="hljs-comment">// doSthHere();</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">//申请相机权限和STORAGE权限</span><br>        ActivityCompat.requestPermissions(<br>                mContext,<br>                <span class="hljs-keyword">new</span> String[]&#123;Manifest.permission.CAMERA,<br>                        Manifest.permission.WRITE_EXTERNAL_STORAGE,<br>                        Manifest.permission.READ_EXTERNAL_STORAGE<br>                &#125;,<br>                CAMERA_REQUEST_CODE);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onRequestPermissionsResult</span><span class="hljs-params">(<span class="hljs-keyword">int</span> requestCode, String[] permissions, <span class="hljs-keyword">int</span>[] grantResults)</span> </span>&#123;<br>    <span class="hljs-keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);<br>    <span class="hljs-keyword">if</span> (requestCode == CAMERA_REQUEST_CODE) &#123;<br>        <span class="hljs-keyword">if</span> (grantResults[<span class="hljs-number">0</span>] == PackageManager.PERMISSION_GRANTED<br>                &amp;&amp; grantResults[<span class="hljs-number">1</span>] == PackageManager.PERMISSION_GRANTED<br>                &amp;&amp; grantResults[<span class="hljs-number">2</span>] == PackageManager.PERMISSION_GRANTED) &#123;<br>            <span class="hljs-comment">// doSthHere();</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            String msg = <span class="hljs-string">"没有相关运行权限"</span>;<br>            Toast.makeText(mContext, msg, Toast.LENGTH_SHORT).show();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lyloou.github.io/linux/interview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/images/avatar.png">
      <meta itemprop="name" content="lyloou">
      <meta itemprop="description" content="/* Better than last best */">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyloou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/linux/interview/" class="post-title-link" itemprop="url">【Linux】interview</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-23 16:53:15" itemprop="dateCreated datePublished" datetime="2018-08-23T16:53:15+08:00">2018-08-23</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="3-Top-10-Linux-Job-Interview-Questions-YouTube"><a href="#3-Top-10-Linux-Job-Interview-Questions-YouTube" class="headerlink" title="(3) Top 10 Linux Job Interview Questions - YouTube"></a><a href="https://www.youtube.com/watch?v=l0QGLMwR-lY" target="_blank" rel="noopener">(3) Top 10 Linux Job Interview Questions - YouTube</a></h2><p>Can you answer the 10 most popular Linux tech job interview questions?<br>0:00 Introduction<br>0:53 Tech Phone screens<br>1:50 How to check the kernel version of a Linux system?</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">man uname<br><br>uname -a <span class="hljs-comment"># everything</span><br>uname -rsm<br></code></pre></td></tr></table></figure>

<p>2:50 How to see the current IP address on Linux?</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh">ifconfig<br><br>ip addr<br>ip addr show eth0<br></code></pre></td></tr></table></figure>

<p>4:03 How to check for free disk space in Linux?</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">man df<br>df -ah<br><br>df -T -h<br><span class="hljs-comment"># ?????</span><br>du -sh * | grep G<br></code></pre></td></tr></table></figure>

<p>6:33 How to check the size of a directory in Linux?</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">man du<br>du -sh directory_name/<br></code></pre></td></tr></table></figure>

<p>4:55 How to see if a Linux service is running?</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">service udev status<br>systemctl status udev<br></code></pre></td></tr></table></figure>

<p>7:02 How to check for open ports in Linux?</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">man netstat<br>netstat -tulpn<br>sudo !! <span class="hljs-comment"># show PID/Program name</span><br></code></pre></td></tr></table></figure>

<p>9:48 How to check Linux process information (CPU usage, memory, user information, etc.)?</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">ps -aux | grep ngrok<br>top<br>htop<br></code></pre></td></tr></table></figure>

<p>11:49 How to deal with mounts in Linux</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">ls /mnt<br>mount /dev/sdb2 /mnt<br>less /etc/fstab<br></code></pre></td></tr></table></figure>

<p>13:51 Man pages<br>15:04 Other resources</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lyloou.github.io/android/%E7%BD%91%E7%BB%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/images/avatar.png">
      <meta itemprop="name" content="lyloou">
      <meta itemprop="description" content="/* Better than last best */">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyloou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/android/%E7%BD%91%E7%BB%9C/" class="post-title-link" itemprop="url">Android网络相关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-23 13:50:00" itemprop="dateCreated datePublished" datetime="2018-08-23T13:50:00+08:00">2018-08-23</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="抓包工具"><a href="#抓包工具" class="headerlink" title="抓包工具"></a>抓包工具</h2><ul>
<li><a href="https://play.google.com/store/apps/details?id=app.greyshirts.sslcapture" target="_blank" rel="noopener">Packet Capture - Google Play 上的应用</a></li>
<li>fiddle</li>
</ul>
<h2 id="okhttp3-set-cookie"><a href="#okhttp3-set-cookie" class="headerlink" title="okhttp3 set cookie"></a>okhttp3 set cookie</h2><h3 id="从-webview-中获取-cookie"><a href="#从-webview-中获取-cookie" class="headerlink" title="从 webview 中获取 cookie"></a>从 webview 中获取 cookie</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// https://stackoverflow.com/questions/17654631/android-webview-read-cookies/20241864</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getCookie</span><span class="hljs-params">(String siteName, String cookieName)</span> </span>&#123;<br>    String cookieValue = <span class="hljs-keyword">null</span>;<br><br>    CookieManager cookieManager = CookieManager.getInstance();<br>    String cookies = cookieManager.getCookie(siteName);<br>    <span class="hljs-keyword">if</span> (cookies != <span class="hljs-keyword">null</span>) &#123;<br>        String[] temp = cookies.split(<span class="hljs-string">";"</span>);<br>        <span class="hljs-keyword">for</span> (String ar1 : temp) &#123;<br>            <span class="hljs-keyword">if</span> (ar1.contains(cookieName)) &#123;<br>                String[] temp1 = ar1.split(<span class="hljs-string">"="</span>);<br>                cookieValue = temp1[<span class="hljs-number">1</span>];<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> cookieValue;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br>File file = <span class="hljs-keyword">new</span> File(filePath);<br>RequestBody requestBody = <span class="hljs-keyword">new</span> MultipartBody.Builder()<br>        .setType(MultipartBody.FORM)<br>        .addFormDataPart(<span class="hljs-string">"file"</span>, file.getName(), RequestBody.create(MediaType.parse(<span class="hljs-string">"image/*"</span>), file))<br>        .build();<br><br>Request request = <span class="hljs-keyword">new</span> Request.Builder()<br>        .url(callBack.getUrl())<br>        .post(requestBody)<br>        .addHeader(<span class="hljs-string">"Accept"</span>, <span class="hljs-string">"*/*"</span>)<br>        .addHeader(<span class="hljs-string">"cookie"</span>, <span class="hljs-string">"ci_session="</span> + getCookie(APP_URL, <span class="hljs-string">"ci_session"</span>))<br>        .build();<br>client.newCall(request).enqueue(callBack);<br></code></pre></td></tr></table></figure>

<h3 id="Automatic-cookie-handling-with-OkHttp-3"><a href="#Automatic-cookie-handling-with-OkHttp-3" class="headerlink" title="Automatic cookie handling with OkHttp 3"></a>Automatic cookie handling with OkHttp 3</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// https://stackoverflow.com/questions/34881775/automatic-cookie-handling-with-okhttp-3/35346473</span><br><span class="hljs-comment">// https://github.com/franmontiel/PersistentCookieJar</span><br>CookieJar cookieJar = <span class="hljs-keyword">new</span> PersistentCookieJar(<span class="hljs-keyword">new</span> SetCookieCache(),<br>                     <span class="hljs-keyword">new</span> SharedPrefsCookiePersistor(context));<br>OkHttpClient okHttpClient = <span class="hljs-keyword">new</span> OkHttpClient.Builder()<br>                    .cookieJar(cookieJar)<br>                    .build();<br></code></pre></td></tr></table></figure>

<h2 id="获取网络时间"><a href="#获取网络时间" class="headerlink" title="获取网络时间"></a>获取网络时间</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Utime</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String URL_DEFAULT = <span class="hljs-string">"http://lyloou.com"</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * 获取时间戳（始终使用网络时间，如果获取网络时间失败，才使用本地时间）</span><br><span class="hljs-comment">     * 注意该方法涉及网络操作，不要在主线程中调用</span><br><span class="hljs-comment">     * 返回的是以秒为单位的时间字符串</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getTimeStamp</span><span class="hljs-params">(String url)</span> </span>&#123;<br><br>        <span class="hljs-keyword">final</span> String urlRrBase = getBaseUrl(url);<br>        <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> phoneTime = System.currentTimeMillis() / <span class="hljs-number">1000</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 生成连接对象</span><br>            URLConnection uc = <span class="hljs-keyword">new</span> URL(urlRrBase).openConnection();<br>            <span class="hljs-comment">// 发出连接</span><br>            uc.connect();<br>            <span class="hljs-keyword">long</span> webTimeMillis = uc.getDate();<br>            <span class="hljs-comment">// 读取网站日期时间</span><br>            <span class="hljs-keyword">long</span> webTime = webTimeMillis / <span class="hljs-number">1000</span>;<br>            <span class="hljs-keyword">return</span> String.valueOf(webTime);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">return</span> String.valueOf(phoneTime);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getBaseUrl</span><span class="hljs-params">(String url)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (TextUtils.isEmpty(url)) &#123;<br>            <span class="hljs-keyword">return</span> URL_DEFAULT;<br>        &#125;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            URI uri = <span class="hljs-keyword">new</span> URI(url);<br>            <span class="hljs-keyword">return</span> uri.getScheme() + <span class="hljs-string">"://"</span> + uri.getHost();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">return</span> URL_DEFAULT;<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lyloou.github.io/android/%E9%80%9A%E7%9F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/images/avatar.png">
      <meta itemprop="name" content="lyloou">
      <meta itemprop="description" content="/* Better than last best */">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyloou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/android/%E9%80%9A%E7%9F%A5/" class="post-title-link" itemprop="url">Android通知相关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-21 15:17:00" itemprop="dateCreated datePublished" datetime="2018-08-21T15:17:00+08:00">2018-08-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>有些手机默认不开启通知权限，需要我们自己来检测和提示用户开启。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">enableNotificationPermission</span><span class="hljs-params">(Context context)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.KITKAT) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (Uapp.isNotificationEnabled(context)) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">final</span> String KEY_SP_CLOSE_NOTIFICATION = <span class="hljs-string">"KEY_SP_CLOSE_NOTIFICATION"</span>;<br>    <span class="hljs-keyword">if</span> (Usp.init(context).getBoolean(KEY_SP_CLOSE_NOTIFICATION, <span class="hljs-keyword">false</span>)) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">new</span> AlertDialog.Builder(context,<br>            android.R.style.Theme_DeviceDefault_Light_Dialog)<br>            .setTitle(<span class="hljs-string">"友情提示"</span>).setMessage(<span class="hljs-string">"为了给您提供更好的服务，请开启应用通知权限"</span>)<br>            .setNegativeButton(<span class="hljs-string">"不用了"</span>, (dialog, which) -&gt; Usp.init(context)<br>                    .putBoolean(KEY_SP_CLOSE_NOTIFICATION, <span class="hljs-keyword">true</span>)<br>                    .commit())<br>            .setNeutralButton(<span class="hljs-string">"下次再说"</span>, (dialog, which) -&gt; &#123;<br>                <span class="hljs-comment">// do nothing</span><br>            &#125;)<br>            .setPositiveButton(<span class="hljs-string">"去开启"</span>, (dialog, which) -&gt; &#123;<br>                Uapp.openAppDetailSettings(context);<br>            &#125;)<br>            .setCancelable(<span class="hljs-keyword">false</span>)<br>            .create()<br>            .show();<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Uapp</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 判断是否开启通知权限</span><br><span class="hljs-comment">     * (https://blog.csdn.net/reglog/article/details/79863751)</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> context</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@RequiresApi</span>(api = Build.VERSION_CODES.KITKAT)<br>    <span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isNotificationEnabled</span><span class="hljs-params">(Context context)</span> </span>&#123;<br>        String CHECK_OP_NO_THROW = <span class="hljs-string">"checkOpNoThrow"</span>;<br>        String OP_POST_NOTIFICATION = <span class="hljs-string">"OP_POST_NOTIFICATION"</span>;<br><br>        AppOpsManager mAppOps = (AppOpsManager) context.getSystemService(Context.APP_OPS_SERVICE);<br>        ApplicationInfo appInfo = context.getApplicationInfo();<br>        String pkg = context.getApplicationContext().getPackageName();<br>        <span class="hljs-keyword">int</span> uid = appInfo.uid;<br><br>        <span class="hljs-comment">/* Context.APP_OPS_MANAGER */</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            Class appOpsClass = Class.forName(AppOpsManager<span class="hljs-class">.<span class="hljs-keyword">class</span>.<span class="hljs-title">getName</span>())</span>;<br><br>            Method checkOpNoThrowMethod = appOpsClass.getMethod(CHECK_OP_NO_THROW, Integer.TYPE, Integer.TYPE,<br>                    String<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;<br>            Field opPostNotificationValue = appOpsClass.getDeclaredField(OP_POST_NOTIFICATION);<br><br>            <span class="hljs-keyword">int</span> value = (Integer) opPostNotificationValue.get(Integer<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;<br>            <span class="hljs-keyword">return</span> ((Integer) checkOpNoThrowMethod.invoke(mAppOps, value, uid, pkg) == AppOpsManager.MODE_ALLOWED);<br><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br><br>    &#125;<br><br>    <span class="hljs-comment">// 跳转APP设置界面</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">openAppDetailSettings</span><span class="hljs-params">(Context context)</span> </span>&#123;<br>        <span class="hljs-comment">//跳转设置界面</span><br>        Intent intent = <span class="hljs-keyword">new</span> Intent();<br>        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);<br>        <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number">9</span>) &#123;<br>            intent.setAction(<span class="hljs-string">"android.settings.APPLICATION_DETAILS_SETTINGS"</span>);<br>            intent.setData(Uri.fromParts(<span class="hljs-string">"package"</span>, context.getPackageName(), <span class="hljs-keyword">null</span>));<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &lt;= <span class="hljs-number">8</span>) &#123;<br>            intent.setAction(Intent.ACTION_VIEW);<br>            intent.setClassName(<span class="hljs-string">"com.android.settings"</span>, <span class="hljs-string">"com.android.setting.InstalledAppDetails"</span>);<br>            intent.putExtra(<span class="hljs-string">"com.android.settings.ApplicationPkgName"</span>, context.getPackageName());<br>        &#125;<br><br>        context.startActivity(intent);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lyloou.github.io/lua/config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/images/avatar.png">
      <meta itemprop="name" content="lyloou">
      <meta itemprop="description" content="/* Better than last best */">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyloou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/lua/config/" class="post-title-link" itemprop="url">Lua配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-18 20:17:54" itemprop="dateCreated datePublished" datetime="2018-08-18T20:17:54+08:00">2018-08-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># c</span><br><span class="hljs-comment"># https://askubuntu.com/questions/194523/how-do-i-install-gnu-readline</span><br>    sudo apt-get install libreadline6 libreadline6-dev<br><br>curl -R -O http://www.lua.org/ftp/lua-5.3.5.tar.gz<br>tar zxf lua-5.3.5.tar.gz<br><span class="hljs-built_in">cd</span> lua-5.3.5<br>make linux <span class="hljs-built_in">test</span><br></code></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lyloou.github.io/android/%E5%8D%95%E5%9B%BE%E5%88%86%E4%BA%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/images/avatar.png">
      <meta itemprop="name" content="lyloou">
      <meta itemprop="description" content="/* Better than last best */">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyloou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/android/%E5%8D%95%E5%9B%BE%E5%88%86%E4%BA%AB/" class="post-title-link" itemprop="url">android中单图分享：微信好友、QQ好友、微博、本地</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-18 14:21:05" itemprop="dateCreated datePublished" datetime="2018-08-18T14:21:05+08:00">2018-08-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>qq 需要添加 lib 库：<code>open_sdk_r6008_lite.jar</code></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// qq</span><br>implementation files(<span class="hljs-string">'../libs/open_sdk_r6008_lite.jar'</span>)<br><span class="hljs-comment">// 微博</span><br>implementation <span class="hljs-string">"com.sina.weibo.sdk:core:$WEIBO_VERSION"</span><br><span class="hljs-comment">// wechat</span><br>implementation <span class="hljs-string">"com.tencent.mm.opensdk:wechat-sdk-android-without-mta:$WECHAT_VERSION"</span><br></code></pre></td></tr></table></figure>

<h2 id="方案-1"><a href="#方案-1" class="headerlink" title="方案 1"></a>方案 1</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Uposter</span> </span>&#123;<br><br>    <span class="hljs-comment">// [Android 分享功能之 微信 图片分享 - 陈三哥 - CSDN博客](https://blog.csdn.net/brokge/article/details/51851625)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">shareWeChatFriend</span><span class="hljs-params">(Activity context, String path)</span> </span>&#123;<br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            <span class="hljs-comment">// [java - exposed beyond app through ClipData.Item.getUri - Stack Overflow](https://stackoverflow.com/questions/48117511/exposed-beyond-app-through-clipdata-item-geturi)</span><br>            Uri uri = FileProvider.getUriForFile(context.getApplicationContext(), context.getPackageName() + <span class="hljs-string">".provider"</span>, <span class="hljs-keyword">new</span> File(path));<br><br>            Intent shareIntent = <span class="hljs-keyword">new</span> Intent();<br>            <span class="hljs-comment">//发送图片到朋友圈</span><br>            <span class="hljs-comment">//ComponentName comp = new ComponentName("com.tencent.mm", "com.tencent.mm.ui.tools.ShareToTimeLineUI");</span><br>            <span class="hljs-comment">//发送图片给好友。</span><br>            ComponentName comp = <span class="hljs-keyword">new</span> ComponentName(<span class="hljs-string">"com.tencent.mm"</span>, <span class="hljs-string">"com.tencent.mm.ui.tools.ShareImgUI"</span>);<br>            shareIntent.setComponent(comp);<br>            shareIntent.setAction(Intent.ACTION_SEND);<br>            shareIntent.putExtra(Intent.EXTRA_STREAM, uri);<br>            shareIntent.setType(<span class="hljs-string">"image/jpeg"</span>);<br>            context.startActivity(Intent.createChooser(shareIntent, <span class="hljs-string">"分享图片"</span>));<br>        &#125;).start();<br>    &#125;<br><br>    <span class="hljs-comment">// [QQ分享官方第三方接入（分享纯图片及截取view的bitmap图） - haibo_bear的博客 - CSDN博客](https://blog.csdn.net/haibo_bear/article/details/51321204)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">shareToQQFriend</span><span class="hljs-params">(Activity context, String path)</span> </span>&#123;<br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            Tencent tencent = Tencent.createInstance(QQ_APP_ID, context);<br>            Bundle shareParams = <span class="hljs-keyword">new</span> Bundle();<br>            shareParams.putInt(QQShare.SHARE_TO_QQ_KEY_TYPE, QQShare.SHARE_TO_QQ_TYPE_IMAGE);<br>            shareParams.putString(QQShare.SHARE_TO_QQ_IMAGE_LOCAL_URL, path);<br>            shareParams.putString(QQShare.SHARE_TO_QQ_APP_NAME, context.getResources().getString(R.string.app_name));<br>            shareParams.putInt(QQShare.SHARE_TO_QQ_EXT_INT, QQShare.SHARE_TO_QQ_FLAG_QZONE_ITEM_HIDE);<br>            tencent.shareToQQ(context, shareParams, <span class="hljs-keyword">null</span>);<br>        &#125;).start();<br>    &#125;<br><br>    <span class="hljs-comment">// [Android 调用系统分享文字、图片、文件，可直达微信、朋友圈、QQ、QQ空间、微博 - 她叫我小渝的个人空间 - OSCHINA](https://my.oschina.net/u/1462828/blog/2086000)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">shareToWeiboFriend</span><span class="hljs-params">(Activity context, String path)</span> </span>&#123;<br><br>        <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            Intent intent = <span class="hljs-keyword">new</span> Intent();<br>            intent.setPackage(<span class="hljs-string">"com.sina.weibo"</span>);<br>            intent.setAction(Intent.ACTION_SEND);<br>            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);<br>            Uri uri = FileProvider.getUriForFile(context.getApplicationContext(), context.getPackageName() + <span class="hljs-string">".provider"</span>, <span class="hljs-keyword">new</span> File(path));<br>            intent.putExtra(Intent.EXTRA_STREAM, uri);<br>            intent.setType(<span class="hljs-string">"image/*"</span>);   <span class="hljs-comment">//分享文件</span><br>            context.startActivity(Intent.createChooser(intent, <span class="hljs-string">"分享"</span>));<br>        &#125;).start();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveImage</span><span class="hljs-params">(Activity context, String path)</span> </span>&#123;<br>        <span class="hljs-comment">// [How can I display images from a specific folder on android gallery - Stack Overflow](https://stackoverflow.com/questions/13418807/how-can-i-display-images-from-a-specific-folder-on-android-gallery)</span><br>        <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SingleMediaScanner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MediaScannerConnection</span>.<span class="hljs-title">MediaScannerConnectionClient</span> </span>&#123;<br><br>            <span class="hljs-keyword">private</span> MediaScannerConnection mMs;<br>            <span class="hljs-keyword">private</span> File mFile;<br>            <span class="hljs-keyword">private</span> Context mContext;<br><br>            <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingleMediaScanner</span><span class="hljs-params">(Context context, File f)</span> </span>&#123;<br>                mFile = f;<br>                mContext = context;<br>                mMs = <span class="hljs-keyword">new</span> MediaScannerConnection(context, <span class="hljs-keyword">this</span>);<br>                mMs.connect();<br>            &#125;<br><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onMediaScannerConnected</span><span class="hljs-params">()</span> </span>&#123;<br>                mMs.scanFile(mFile.getAbsolutePath(), <span class="hljs-keyword">null</span>);<br>            &#125;<br><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onScanCompleted</span><span class="hljs-params">(String path, Uri uri)</span> </span>&#123;<br>                Intent intent = <span class="hljs-keyword">new</span> Intent(Intent.ACTION_VIEW);<br>                intent.setData(uri);<br>                mContext.startActivity(intent);<br>                mMs.disconnect();<br>            &#125;<br><br>        &#125;<br>        View v = context.findViewById(android.R.id.content);<br>        Snackbar snackbar = Snackbar.make(v, <span class="hljs-string">"保存成功"</span>, Snackbar.LENGTH_LONG);<br>        snackbar.setAction(<span class="hljs-string">"点击查看"</span>, v1 -&gt; &#123;<br>            <span class="hljs-comment">// showGallery(context);</span><br>            <span class="hljs-keyword">new</span> SingleMediaScanner(context, <span class="hljs-keyword">new</span> File(path));<br>        &#125;);<br>        snackbar.show();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showGallery</span><span class="hljs-params">(Context context)</span> </span>&#123;<br>        context.startActivity(<span class="hljs-keyword">new</span> Intent(Intent.ACTION_VIEW,<br>            Uri.parse(<span class="hljs-string">"content://media/internal/images/media"</span>)));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>调用方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Uposter.saveImage(mContext, <span class="hljs-string">"/sotrage/0/a.jpg"</span>)<br></code></pre></td></tr></table></figure>

<h2 id="方案-2"><a href="#方案-2" class="headerlink" title="方案 2"></a>方案 2</h2><p>或者通过面向对象的方式来实现：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> interface Share &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(Activity context)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isInstall</span><span class="hljs-params">()</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(<span class="hljs-keyword">String</span> path)</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">String</span> <span class="hljs-title">getNotInstallTip</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>其他类实现上面的接口，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PosterShareWechat</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">PosterShare</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Activity context;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(Activity context)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.context = context;<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isInstall</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> Uapp.isWechatAvilible(context);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(String path)</span> </span>&#123;<br>        <span class="hljs-comment">// [Android 分享功能之 微信 图片分享 - 陈三哥 - CSDN博客](https://blog.csdn.net/brokge/article/details/51851625)</span><br>        <span class="hljs-comment">// [java - exposed beyond app through ClipData.Item.getUri - Stack Overflow](https://stackoverflow.com/questions/48117511/exposed-beyond-app-through-clipdata-item-geturi)</span><br>        Uri uri = FileProvider.getUriForFile(context.getApplicationContext(), context.getPackageName() + <span class="hljs-string">".provider"</span>, <span class="hljs-keyword">new</span> File(path));<br><br>        Intent shareIntent = <span class="hljs-keyword">new</span> Intent();<br>        <span class="hljs-comment">//发送图片到朋友圈</span><br>        <span class="hljs-comment">//ComponentName comp = new ComponentName("com.tencent.mm", "com.tencent.mm.ui.tools.ShareToTimeLineUI");</span><br>        <span class="hljs-comment">//发送图片给好友。</span><br>        ComponentName comp = <span class="hljs-keyword">new</span> ComponentName(<span class="hljs-string">"com.tencent.mm"</span>, <span class="hljs-string">"com.tencent.mm.ui.tools.ShareImgUI"</span>);<br>        shareIntent.setComponent(comp);<br>        shareIntent.setAction(Intent.ACTION_SEND);<br>        shareIntent.putExtra(Intent.EXTRA_STREAM, uri);<br>        shareIntent.setType(<span class="hljs-string">"image/jpeg"</span>);<br>        context.startActivity(Intent.createChooser(shareIntent, <span class="hljs-string">"分享图片"</span>));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getNotInstallTip</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"您没有安装微信"</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>调用方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">posterShare = <span class="hljs-keyword">new</span> PosterShareWechat();<br>posterShare.init(context);<br><span class="hljs-keyword">if</span> (!posterShare.isInstall()) &#123;<br>    Utoast.show(posterShare.getNotInstallTip());<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br>posterShare.execute(path);<br></code></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lyloou.github.io/linux/%E6%8A%80%E5%B7%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/images/avatar.png">
      <meta itemprop="name" content="lyloou">
      <meta itemprop="description" content="/* Better than last best */">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyloou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/linux/%E6%8A%80%E5%B7%A7/" class="post-title-link" itemprop="url">【Linux】技巧</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-16 16:39:15" itemprop="dateCreated datePublished" datetime="2018-08-16T16:39:15+08:00">2018-08-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="https-www-youtube-com-watch-v-V8EUdia-kOE"><a href="#https-www-youtube-com-watch-v-V8EUdia-kOE" class="headerlink" title="https://www.youtube.com/watch?v=V8EUdia_kOE"></a><a href="https://www.youtube.com/watch?v=V8EUdia_kOE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=V8EUdia_kOE</a></h2><ul>
<li>sudo !!</li>
<li>ctrl-k, ctrl-u, ctrl-w, ctrl-y - cutting and pasting text in the command line</li>
<li>practical kill/yank example</li>
<li>use ‘less +F’ to view logfiles, instead of ‘tail’ (ctrl-c, shift-f, q to quit)</li>
<li>ctrl-x-e - continue editing your current shell line in a text editor (uses $EDITOR)</li>
<li>alt-. - paste previous command’s argument (useful for running multiple commands on the same resource)</li>
<li>reset - resets/unborks your terminal</li>
</ul>
<h2 id="linux-kill-某个端口对应的进程"><a href="#linux-kill-某个端口对应的进程" class="headerlink" title="linux kill 某个端口对应的进程"></a>linux kill 某个端口对应的进程</h2><ul>
<li><a href="https://blog.csdn.net/gq__97/article/details/80487588" target="_blank" rel="noopener">Linux 一条命令杀死占用端口的所有进程 - gq__97 的博客 - CSDN 博客</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">kill</span> -9 $(lsof -i:端口号 -t)<br></code></pre></td></tr></table></figure>

<ul>
<li><a href="https://blog.csdn.net/shengzhu1/article/details/54138419" target="_blank" rel="noopener">linux 下怎么根据端口号杀死进程 - shengzhu1 的博客 - CSDN 博客</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">kill</span> [<span class="hljs-string">']netstat -nlp | grep :3306 | awk '</span>&#123;<span class="hljs-built_in">print</span> <span class="hljs-variable">$7</span>&#125;<span class="hljs-string">' | awk -F"/" '</span>&#123; <span class="hljs-built_in">print</span> <span class="hljs-variable">$1</span> &#125;<span class="hljs-string">'['</span>]<br></code></pre></td></tr></table></figure>

<h2 id="根据启动的应用名称来杀死进程"><a href="#根据启动的应用名称来杀死进程" class="headerlink" title="根据启动的应用名称来杀死进程"></a>根据启动的应用名称来杀死进程</h2><p><strong>获取所有该应用名称的进程</strong><br><code>ps -aux | grep user-0.0.1.jar</code></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">lilou     <span class="hljs-number">2676</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">21536</span>   <span class="hljs-number">980</span> pts/<span class="hljs-number">18</span>   S+   <span class="hljs-number">09</span>:<span class="hljs-number">49</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> grep --color=<span class="hljs-built_in">auto</span> --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn user<span class="hljs-number">-0.0</span><span class="hljs-number">.1</span>.jar<br>lilou     <span class="hljs-number">4353</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">2.0</span> <span class="hljs-number">8230288</span> <span class="hljs-number">339332</span> pts/<span class="hljs-number">21</span> Sl+  <span class="hljs-number">5</span>月<span class="hljs-number">28</span>   <span class="hljs-number">0</span>:<span class="hljs-number">43</span> java -jar user<span class="hljs-number">-0.0</span><span class="hljs-number">.1</span>.jar<br></code></pre></td></tr></table></figure>

<p><strong>排除含有 grep 的行</strong><br><code>ps -aux | grep user-0.0.1.jar | grep -v grep</code></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">lilou     <span class="hljs-number">4353</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">2.0</span> <span class="hljs-number">8230288</span> <span class="hljs-number">339332</span> pts/<span class="hljs-number">21</span> Sl+  <span class="hljs-number">5</span>月<span class="hljs-number">28</span>   <span class="hljs-number">0</span>:<span class="hljs-number">43</span> java -jar user<span class="hljs-number">-0.0</span><span class="hljs-number">.1</span>.jar<br></code></pre></td></tr></table></figure>

<p><strong>获取进程号</strong><br><code>ps -aux | grep user-0.0.1.jar | grep -v grep | cut -c 9-15</code></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-number">4353</span><br></code></pre></td></tr></table></figure>

<p><strong>使用 kill 命令杀死进程</strong><br><code>ps -aux | grep user-0.0.1.jar | grep -v grep | cut -c 9-15 | xargs kill -15</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">该进程已经被杀死<br></code></pre></td></tr></table></figure>

<h2 id="java-项目启动和停止脚本"><a href="#java-项目启动和停止脚本" class="headerlink" title="java 项目启动和停止脚本"></a>java 项目启动和停止脚本</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vim">➜ <span class="hljs-keyword">cat</span> env.<span class="hljs-keyword">sh</span><br>NAME=<span class="hljs-string">"user-0.0.1.jar"</span><br>➜ <span class="hljs-keyword">cat</span> start.<span class="hljs-keyword">sh</span><br>. ./env.<span class="hljs-keyword">sh</span><br>nohup java -Duser.timezone=GMT+<span class="hljs-number">08</span> -Xmx1G -Xms1G -jar $NAME &gt; /dev/null &amp;<br>➜ <span class="hljs-keyword">cat</span> <span class="hljs-keyword">stop</span>.<span class="hljs-keyword">sh</span><br>. ./env.<span class="hljs-keyword">sh</span><br><span class="hljs-keyword">ps</span> -aux | <span class="hljs-keyword">grep</span> $NAME | <span class="hljs-keyword">grep</span> -v <span class="hljs-keyword">grep</span> | cut -<span class="hljs-keyword">c</span> <span class="hljs-number">9</span>-<span class="hljs-number">15</span> | xargs kill -<span class="hljs-number">15</span><br>➜ <span class="hljs-keyword">cat</span> restart.<span class="hljs-keyword">sh</span><br>./<span class="hljs-keyword">stop</span>.<span class="hljs-keyword">sh</span><br><span class="hljs-keyword">sleep</span> <span class="hljs-number">8</span><br>./start.<span class="hljs-keyword">sh</span><br>➜<br></code></pre></td></tr></table></figure>

<p>ps -aux | grep python | grep 9090 | cut -c 9-15 | xargs kill -15<br>cd /www/smbshare &amp;&amp; python -m SimpleHTTPServer 9090 &gt; /dev/null 2&gt;&amp;1 &amp;</p>
<h2 id="根据端口来-kill-进程"><a href="#根据端口来-kill-进程" class="headerlink" title="根据端口来 kill 进程"></a>根据端口来 kill 进程</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-built_in">cd</span> $(dirname <span class="hljs-variable">$0</span>)<br>lsof -i :21001 |grep <span class="hljs-string">"\(LISTEN\)"</span>|awk -F <span class="hljs-string">' '</span> <span class="hljs-string">'&#123;print "kill -15 " $2&#125;'</span>|sh<br></code></pre></td></tr></table></figure>

<p>具体参考： <code>man lsof</code></p>
<h2 id="递归删除文件和目录"><a href="#递归删除文件和目录" class="headerlink" title="递归删除文件和目录"></a>递归删除文件和目录</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment"># 递归清除不必要的文件</span><br><span class="hljs-comment"># https://blog.csdn.net/skylin19840101/article/details/75099240</span><br><br><span class="hljs-comment"># 删除文件</span><br>find . -name .flattened-pom.xml | xargs rm -f<br>find . -name .project | xargs rm -f<br><br><span class="hljs-comment"># 删除目录</span><br>find . -name <span class="hljs-string">".settings"</span> | xargs rm -rf<br>find . -name <span class="hljs-string">"target"</span> | xargs rm -rf<br></code></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lyloou.github.io/android/lanchMode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/images/avatar.png">
      <meta itemprop="name" content="lyloou">
      <meta itemprop="description" content="/* Better than last best */">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lyloou">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/android/lanchMode/" class="post-title-link" itemprop="url">Android启动模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-06 20:04:15" itemprop="dateCreated datePublished" datetime="2018-08-06T20:04:15+08:00">2018-08-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Android-Understanding-Activity-launch-mode"><a href="#Android-Understanding-Activity-launch-mode" class="headerlink" title="Android: Understanding Activity launch mode"></a><a href="https://www.mobomo.com/2011/06/android-understanding-activity-launchmode/" target="_blank" rel="noopener">Android: Understanding Activity launch mode</a></h2><blockquote>
<ul>
<li>‘standard’ and ‘singleTop’ can instantiate multiple activity instances and the instance will stay in the same task.</li>
<li>For ‘singleTask’ or ‘singleInstance’, the activity class uses the singleton pattern, and that instance will be the root activity of a new task. Let’s examine each value:</li>
</ul>
</blockquote>
<h2 id="the-weird-launch-mode"><a href="#the-weird-launch-mode" class="headerlink" title="the weird launch mode"></a>the weird launch mode</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">https://stackoverflow.com/questions/9363200/android-singletask-singletop-and-home-button<br>The behaviour of activity back stack becomes quit weird when define main activity <span class="hljs-keyword">with</span> singleTask <span class="hljs-keyword">at</span> the same <span class="hljs-built_in">time</span>:<br><br>    &lt;activity android:<span class="hljs-keyword">name</span>=<span class="hljs-string">".MainActivity"</span><br>        android:launchMode=<span class="hljs-string">"singleTask"</span>&gt;<br>        &lt;intent-filter&gt;<br>            &lt;<span class="hljs-keyword">action</span> android:<span class="hljs-keyword">name</span>=<span class="hljs-string">"android.intent.action.MAIN"</span> /&gt;<br>            &lt;<span class="hljs-keyword">category</span> android:<span class="hljs-keyword">name</span>=<span class="hljs-string">"android.intent.category.LAUNCHER"</span> /&gt;<br>        &lt;/intent-filter&gt;<br>    &lt;/activity&gt;<br>    <br>What even worse <span class="hljs-keyword">is</span> there <span class="hljs-keyword">is</span> <span class="hljs-keyword">no</span> <span class="hljs-keyword">clear</span> explanation <span class="hljs-keyword">in</span> the official dev guide regarding <span class="hljs-keyword">to</span> this special <span class="hljs-keyword">use</span> case. <span class="hljs-keyword">Some</span> sections related <span class="hljs-keyword">to</span> this topic <span class="hljs-keyword">are</span> even <span class="hljs-keyword">self</span>-contradictory.<br><br>Try <span class="hljs-keyword">using</span> launchMode=<span class="hljs-string">"standard"</span> <span class="hljs-keyword">on</span> your MainActivity A, <span class="hljs-keyword">and</span> launchMode=<span class="hljs-string">"singleTask"</span> <span class="hljs-keyword">on</span> your Activity B, which will give the expect behaviour you described.<br></code></pre></td></tr></table></figure>

<h2 id="自学笔记：Activity的启动模式-FLAG-ACTIVITY-CLEAR-TOP和FLAG-ACTIVITY-REORDER-TO-FRONT"><a href="#自学笔记：Activity的启动模式-FLAG-ACTIVITY-CLEAR-TOP和FLAG-ACTIVITY-REORDER-TO-FRONT" class="headerlink" title="自学笔记：Activity的启动模式:FLAG_ACTIVITY_CLEAR_TOP和FLAG_ACTIVITY_REORDER_TO_FRONT"></a><a href="http://blog.51cto.com/glblong/1209829" target="_blank" rel="noopener">自学笔记：Activity的启动模式:FLAG_ACTIVITY_CLEAR_TOP和FLAG_ACTIVITY_REORDER_TO_FRONT</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// A, B, C 和 D ==&gt; A, B</span><br>Intent intent = <span class="hljs-keyword">new</span> Intent(<span class="hljs-keyword">this</span>, B<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;<br>intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);<br>startActivity(intent);<br><br><span class="hljs-comment">// add below code , B will be reused.</span><br>intent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// A，B，C和D ==&gt; A,C,D,B，</span><br>Intent intent = <span class="hljs-keyword">new</span> Intent(<span class="hljs-keyword">this</span>, MainActivity<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;<br>intent.addFlags(Intent.FLAG_ACTIVITY_REORDER_TO_FRONT);<br>startActivity(intent);<br></code></pre></td></tr></table></figure>

<h2 id="深入讲解Android中Activity-launchMode-技术小黑屋"><a href="#深入讲解Android中Activity-launchMode-技术小黑屋" class="headerlink" title="深入讲解Android中Activity launchMode - 技术小黑屋"></a><a href="https://droidyue.com/blog/2015/08/16/dive-into-android-activity-launchmode/" target="_blank" rel="noopener">深入讲解Android中Activity launchMode - 技术小黑屋</a></h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lyloou"
      src="/assets/images/avatar.png">
  <p class="site-author-name" itemprop="name">lyloou</p>
  <div class="site-description" itemprop="description">/* Better than last best */</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">313</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/lyloou" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lyloou" rel="noopener" target="_blank">GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:lyloou6@gmail.com" title="E-Mail → mailto:lyloou6@gmail.com" rel="noopener" target="_blank">E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/lyloou" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;lyloou" rel="noopener" target="_blank">Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/ly1414725328" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;ly1414725328" rel="noopener" target="_blank">CSDN</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备18151128号 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lyloou</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  


</body>
</html>
