<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Android和JavaScript交互</title>
    <url>/android/Android%E5%92%8CJavaScript%E4%BA%A4%E4%BA%92/</url>
    <content><![CDATA[<ul>
<li><a href="https://www.jianshu.com/p/3c94ae673e2a">Android：这是一份全面 &amp; 详细的Webview使用攻略 - 简书</a></li>
<li><a href="https://www.jianshu.com/p/345f4d8a5cfa">最全面总结 Android WebView与 JS 的交互方式 - 简书</a></li>
<li><a href="https://github.com/marcuswestin/WebViewJavascriptBridge">WebViewJavascriptBridge</a></li>
<li><a href="https://github.com/wendux/WebViewJavascriptBridge">wendux/WebViewJavascriptBridge</a></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//: MainActivity.java</span></span><br><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</span><br><span class="line">    WebView.setWebContentsDebuggingEnabled(BuildConfig.TEST_ENV);</span><br><span class="line">&#125;</span><br><span class="line">mWvContent = (WebView) findViewById(R.id.wv_content);</span><br><span class="line">mWvContent.setScrollbarFadingEnabled(<span class="literal">true</span>);</span><br><span class="line">mWvContent.addJavascriptInterface(<span class="keyword">new</span> <span class="title class_">JavaScriptInterface</span>(mWvContent), <span class="string">&quot;android&quot;</span>);</span><br><span class="line"><span class="type">WebSettings</span> <span class="variable">settings</span> <span class="operator">=</span> mWvContent.getSettings();</span><br><span class="line">settings.setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line">settings.setBuiltInZoomControls(<span class="literal">true</span>);</span><br><span class="line">settings.setDisplayZoomControls(<span class="literal">false</span>);</span><br><span class="line">settings.setDatabaseEnabled(<span class="literal">true</span>);</span><br><span class="line">settings.setCacheMode(WebSettings.LOAD_NO_CACHE);</span><br><span class="line">settings.setDomStorageEnabled(<span class="literal">true</span>);</span><br><span class="line">settings.setAllowFileAccess(<span class="literal">true</span>);</span><br><span class="line">settings.setAppCacheEnabled(<span class="literal">true</span>);</span><br><span class="line">settings.setAppCachePath(mWvContent.getContext().getCacheDir().getAbsolutePath());</span><br><span class="line">settings.setJavaScriptCanOpenWindowsAutomatically(<span class="literal">true</span>);</span><br><span class="line">settings.setBlockNetworkImage(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">mWvContent.setWebViewClient(<span class="keyword">new</span> <span class="title class_">WebViewClient</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> &#123;</span><br><span class="line">        view.loadUrl(url);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPageFinished</span><span class="params">(WebView view, String url)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onPageFinished(view, url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">mWvContent.setWebChromeClient(<span class="keyword">new</span> <span class="title class_">WebChromeClient</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceivedTitle</span><span class="params">(WebView view, String title)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onReceivedTitle(view, title);</span><br><span class="line">        <span class="type">TextView</span> <span class="variable">tvTitle</span> <span class="operator">=</span> toolbar.findViewById(R.id.tv_top_title);</span><br><span class="line">        tvTitle.setTextColor(Color.WHITE);</span><br><span class="line">        tvTitle.setText(title);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onProgressChanged</span><span class="params">(WebView view, <span class="type">int</span> newProgress)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onProgressChanged(view, newProgress);</span><br><span class="line">        <span class="keyword">if</span> (!isScrolled &amp;&amp; newProgress &gt; <span class="number">50</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">lastPosition</span> <span class="operator">=</span> Usp.getInstance().getInt(sKey + <span class="string">&quot;position&quot;</span>, <span class="number">0</span>);</span><br><span class="line">            view.scrollTo(<span class="number">0</span>, lastPosition);</span><br><span class="line">            isScrolled = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onConsoleMessage</span><span class="params">(ConsoleMessage consoleMessage)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> <span class="built_in">super</span>.onConsoleMessage(consoleMessage);</span><br><span class="line">        System.out.println(<span class="string">&quot;|&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;============console==========&quot;</span>);</span><br><span class="line">        System.out.println(consoleMessage.message());</span><br><span class="line">        System.out.println(<span class="string">&quot;===========console===========&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">mWvContent.loadUrl(mUrl);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//: JavaScriptInterface.java</span></span><br><span class="line"><span class="comment">// https://blog.csdn.net/FDoubleman/article/details/78189332</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaScriptInterface</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Context mContext;</span><br><span class="line">    <span class="keyword">private</span> WebView mWebView;</span><br><span class="line"></span><br><span class="line">    JavaScriptInterface(WebView webView) &#123;</span><br><span class="line">        mContext = webView.getContext();</span><br><span class="line">        mWebView = webView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JavascriptInterface</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">showToast</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">IWXAPI</span> <span class="variable">api</span> <span class="operator">=</span> WXApiModule.getInstans().getWXApi();</span><br><span class="line">        Toast.makeText(mContext, str, Toast.LENGTH_LONG).show();</span><br><span class="line">        <span class="comment">//WebActivity.newInstance(mContext, &quot;https://m3.renrenyoupin.com&quot;, &quot;tag&quot;);</span></span><br><span class="line">        <span class="keyword">return</span> Uresult.newInstance().status(<span class="number">0</span>).msg(String.valueOf(api.isWXAppInstalled())).toMap().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JavascriptInterface</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeJs</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        mWebView.post(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</span><br><span class="line">                mWebView.evaluateJavascript(str, value -&gt; &#123;</span><br><span class="line">                    System.out.println(value);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                mWebView.loadUrl(str);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android中app响应浏览器链接</title>
    <url>/android/ApplicationContext%E4%B8%AD%E5%BC%B9%E5%87%BA%E5%AF%B9%E8%AF%9D%E6%A1%86/</url>
    <content><![CDATA[<h2 id="ApplicationContext中弹出对话框"><a href="#ApplicationContext中弹出对话框" class="headerlink" title="ApplicationContext中弹出对话框"></a>ApplicationContext中弹出对话框</h2><ol>
<li><p>添加权限</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>显示对话框</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showRestartDialog</span><span class="params">(<span class="keyword">final</span> Context context)</span> &#123;</span><br><span class="line">    AlertDialog.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(context, R.style.Theme_AppCompat_Light_Dialog);</span><br><span class="line">    builder.setMessage(<span class="string">&quot;应用已更新完毕，是否立即重启 ?&quot;</span>).setCancelable(<span class="literal">false</span>)</span><br><span class="line">        .setPositiveButton(<span class="string">&quot;是&quot;</span>, <span class="keyword">new</span> <span class="title class_">DialogInterface</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(DialogInterface dialog, <span class="type">int</span> id)</span> &#123;</span><br><span class="line">                <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> context.getPackageManager().getLaunchIntentForPackage(context.getPackageName());</span><br><span class="line">                intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);</span><br><span class="line">                context.startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .setNegativeButton(<span class="string">&quot;否&quot;</span>, <span class="keyword">new</span> <span class="title class_">DialogInterface</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(DialogInterface dialog, <span class="type">int</span> id)</span> &#123;</span><br><span class="line">                dialog.cancel();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="type">AlertDialog</span> <span class="variable">alert</span> <span class="operator">=</span> builder.create();</span><br><span class="line">    alert.setCancelable(<span class="literal">false</span>);</span><br><span class="line">    alert.getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ALERT); <span class="comment">// Attention it!</span></span><br><span class="line">    alert.show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://blog.csdn.net/guchuanhang/article/details/44750545">Application中弹出Dialog - CSDN博客</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>IME输入法</title>
    <url>/android/IME%E8%BE%93%E5%85%A5%E6%B3%95/</url>
    <content><![CDATA[<h2 id="输入法遮盖-EditText-问题"><a href="#输入法遮盖-EditText-问题" class="headerlink" title="输入法遮盖 EditText 问题"></a>输入法遮盖 EditText 问题</h2><p>修复弹框不能被顶上去的问题： AndroidBug5497Workaround，<br>原代码在部分手机上会有底部导航栏被遮盖的问题，下面的代码可兼容华为、小米，三星等机型。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Rect;</span><br><span class="line"><span class="keyword">import</span> android.os.Build;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.FrameLayout;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AndroidBug5497Workaround</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">assistActivity</span><span class="params">(Activity activity)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">AndroidBug5497Workaround</span>(activity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> View mChildOfContent;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> usableHeightPrevious;</span><br><span class="line">    <span class="keyword">private</span> FrameLayout.LayoutParams frameLayoutParams;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> contentHeight;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">isfirst</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">private</span> Activity activity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> statusBarHeight;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">AndroidBug5497Workaround</span><span class="params">(Activity activity)</span> &#123;</span><br><span class="line">        <span class="comment">//获取状态栏的高度</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">resourceId</span> <span class="operator">=</span> activity.getResources().getIdentifier(<span class="string">&quot;status_bar_height&quot;</span>, <span class="string">&quot;dimen&quot;</span>, <span class="string">&quot;android&quot;</span>);</span><br><span class="line">        statusBarHeight = activity.getResources().getDimensionPixelSize(resourceId);</span><br><span class="line">        <span class="built_in">this</span>.activity = activity;</span><br><span class="line">        <span class="type">FrameLayout</span> <span class="variable">content</span> <span class="operator">=</span> (FrameLayout) activity.findViewById(android.R.id.content);</span><br><span class="line">        mChildOfContent = content.getChildAt(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//界面出现变动都会调用这个监听事件</span></span><br><span class="line">        mChildOfContent.getViewTreeObserver().addOnGlobalLayoutListener(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (isfirst) &#123;</span><br><span class="line">                contentHeight = mChildOfContent.getHeight();<span class="comment">//兼容华为等机型</span></span><br><span class="line">                isfirst = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            possiblyResizeChildOfContent();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        frameLayoutParams = (FrameLayout.LayoutParams)</span><br><span class="line">            mChildOfContent.getLayoutParams();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//重新调整跟布局的高度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">possiblyResizeChildOfContent</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">usableHeightNow</span> <span class="operator">=</span> computeUsableHeight();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//当前可见高度和上一次可见高度不一致 布局变动</span></span><br><span class="line">        <span class="keyword">if</span> (usableHeightNow != usableHeightPrevious) &#123;</span><br><span class="line">            <span class="comment">//int usableHeightSansKeyboard2 = mChildOfContent.getHeight();//兼容华为等机型</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">usableHeightSansKeyboard</span> <span class="operator">=</span> mChildOfContent.getRootView().getHeight();</span><br><span class="line">            <span class="type">int</span> <span class="variable">heightDifference</span> <span class="operator">=</span> usableHeightSansKeyboard - usableHeightNow;</span><br><span class="line">            <span class="keyword">if</span> (heightDifference &gt; (usableHeightSansKeyboard / <span class="number">4</span>)) &#123;</span><br><span class="line">                <span class="comment">// keyboard probably just became visible</span></span><br><span class="line">                <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</span><br><span class="line">                    <span class="comment">//frameLayoutParams.height = usableHeightSansKeyboard - heightDifference;</span></span><br><span class="line">                    frameLayoutParams.height = usableHeightSansKeyboard - heightDifference + statusBarHeight;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    frameLayoutParams.height = usableHeightSansKeyboard - heightDifference;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                frameLayoutParams.height = contentHeight;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            mChildOfContent.requestLayout();</span><br><span class="line">            usableHeightPrevious = usableHeightNow;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 计算mChildOfContent可见高度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">computeUsableHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Rect</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rect</span>();</span><br><span class="line">        mChildOfContent.getWindowVisibleDisplayFrame(r);</span><br><span class="line">        <span class="keyword">return</span> (r.bottom - r.top);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">setContentView(R.layout.xxx);</span><br><span class="line">AndroidBug5497Workaround.assistActivity(<span class="built_in">this</span>);</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://blog.csdn.net/tyk9999tyk/article/details/78457372">android 显示内容被底部导航栏遮挡 - 菜鸟的 android 晋级之路 - CSDN 博客</a></li>
<li><a href="https://www.jianshu.com/p/a95a1b84da11">关于 AndroidBug5497Workaround 的兼容性问题 - 简书</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLite封装</title>
    <url>/android/SQLite%E5%B0%81%E8%A3%85/</url>
    <content><![CDATA[<h2 id="摘要："><a href="#摘要：" class="headerlink" title="摘要："></a>摘要：</h2><blockquote>
<p>主要内容：<br>本文介绍了封装后的SQLite，以便快速开发；<br>只保留必要的定制，重复的代码封装到一个通用类中；</p>
</blockquote>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li><code>LouSQLite.java</code>文件为通用的代码，所有项目中不需要修改即可使用；</li>
<li><code>MyCallBack.java</code>文件是自定义的文件，关于项目的数据库配置都在这里进行，例如：数据库名称、数据库版本号、table语句等；</li>
<li><code>LouSQLite.java</code>支持常用的CRUD操作（支持事务）；</li>
</ul>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><script src="https://gist.github.com/lyloou/9974be6cce20a32144c8dfb9aa296ec0.js"></script>
]]></content>
      <tags>
        <tag>android</tag>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>SharedPreference封装</title>
    <url>/android/SharedPreference%E5%B0%81%E8%A3%85/</url>
    <content><![CDATA[<h2 id="摘要："><a href="#摘要：" class="headerlink" title="摘要："></a>摘要：</h2><blockquote>
<p>主要内容：<br>本文介绍了封装后的SharedPreference，以便快速开发；<br>只保留必要的定制，重复的代码封装到一个通用类中；</p>
</blockquote>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>具体用法参照<code>UspDemo.java</code>文件；</li>
<li>通用源文件为<code>Usp.java</code></li>
</ul>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><script src="https://gist.github.com/lyloou/695fa3c371a4702bcaeeaa7fa3d3feaf.js"></script>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>UnsupportedOperationException at java.util.AbstractList.remove</title>
    <url>/android/UnsupportedOperationException/</url>
    <content><![CDATA[<h2 id="UnsupportedOperationException-at-java-util-AbstractList-remove-AbstractList-java-638"><a href="#UnsupportedOperationException-at-java-util-AbstractList-remove-AbstractList-java-638" class="headerlink" title="UnsupportedOperationException at java.util.AbstractList.remove(AbstractList.java:638)"></a>UnsupportedOperationException at java.util.AbstractList.remove(AbstractList.java:638)</h2><p>【问题场景】</p>
<ul>
<li>在给<code>RecyclerView.Adapter</code>传递数据源的时候，<br>我传递进去了<code>Arrays.asList</code>构成的列表，在调用<code>lists.remove()</code>方法删除某个元素的时候，出现了这个异常；</li>
</ul>
<p>【解答】</p>
<ul>
<li>我使用了<code>Arrays.asList()</code>方法，通过查看源码知道，这个方法调用了<code>Arras.ArrayList(E[])</code>来构建列表，<br>而这个列表是<code>final</code>的，不可modify的，所以会出现<code>UnsupportedOperationException</code>异常；</li>
<li>解决办法1：使用<code>new ArrayList&lt;&gt;();</code>的方式来新建列表，而不是<code>Arrays.asList</code>或数组的方式；</li>
<li>解决方法2：new ArrayList&lt;&gt;(Arrays.asList(“1”,”2”)); // 即封装下就可；</li>
</ul>
<p>【外部链接】</p>
<ul>
<li><a href="http://stackoverflow.com/questions/3200551/unable-to-modify-arrayadapter-in-listview-unsupportedoperationexception">Unable to modify ArrayAdapter in ListView: UnsupportedOperationException</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android中app响应浏览器链接</title>
    <url>/android/app%E5%93%8D%E5%BA%94%E6%B5%8F%E8%A7%88%E5%99%A8%E9%93%BE%E6%8E%A5/</url>
    <content><![CDATA[<h2 id="App响应外部链接（类似：http-https-tel-mailto）"><a href="#App响应外部链接（类似：http-https-tel-mailto）" class="headerlink" title="App响应外部链接（类似：http, https, tel, mailto）"></a>App响应外部链接（类似：http, https, tel, mailto）</h2><p>主要步骤是，配置、使用、获取数据；</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">在自定义的 webview中点击<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;lyloou://...&quot;</span>&gt;</span>链接，可以跳转到app。</span><br><span class="line">在系统浏览器中（魅族）打开一个页面，页面中包含<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;lyloou://...&quot;</span>&gt;</span>链接，可以跳转</span><br><span class="line">在chrome浏览器中打开一个页面，页面中包含<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;lyloou://...&quot;</span>&gt;</span>链接，可以跳转</span><br><span class="line">在qq浏览器中打开一个页面，页面中包含<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;lyloou://...&quot;</span>&gt;</span>链接，可以跳转</span><br><span class="line"></span><br><span class="line">直接通过浏览器的地址栏输入，不可以跳转到app。</span><br><span class="line">微信对话中点击，不可以跳转app。</span><br><span class="line">qq对话中点击，不可以跳转app。</span><br><span class="line"></span><br><span class="line">app没有安装的时候，点击链接都没有任何反应。</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 必要的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.VIEW&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.BROWSABLE&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:host</span>=<span class="string">&quot;lou.app&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:pathPrefix</span>=<span class="string">&quot;/openwith&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:scheme</span>=<span class="string">&quot;lyloou&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="在html中使用"><a href="#在html中使用" class="headerlink" title="在html中使用"></a>在html中使用</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    如果把html代码放在了 WebView中，如果设置了setWebViewClient()，</span></span><br><span class="line"><span class="comment">    其中重写的方法不要拦截，否则app无法响应； （即，重写shouldOverrideUrlLoading方法时需要小心，不设置webviewClient为妙）</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;lyloou://lou.app/openwith?name=zhangsan&amp;age=26&quot;</span>&gt;</span>启动应用程序<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Intent</span> <span class="variable">i_getvalue</span> <span class="operator">=</span> getIntent();</span><br><span class="line">    <span class="type">String</span> <span class="variable">action</span> <span class="operator">=</span> i_getvalue.getAction();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Intent.ACTION_VIEW.equals(action)) &#123;</span><br><span class="line">        <span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> i_getvalue.getData();</span><br><span class="line">        <span class="keyword">if</span> (uri != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> uri.getQueryParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">age</span> <span class="operator">=</span> uri.getQueryParameter(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">            Log.i(TAG, <span class="string">&quot;getData: name=&quot;</span> + name);</span><br><span class="line">            Log.i(TAG, <span class="string">&quot;getData: age=&quot;</span> + age);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h2><ul>
<li><a href="http://blog.csdn.net/geekpark/article/details/16118457">android实现通过浏览器点击链接打开本地应用（APP）并拿到浏览器传递的数据 - 极客公园 - CSDN博客</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>build.gradle配置</title>
    <url>/android/build.gradle%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="bulid-gradle-文件"><a href="#bulid-gradle-文件" class="headerlink" title="bulid.gradle 文件"></a>bulid.gradle 文件</h1><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">  signingConfigs &#123;</span><br><span class="line">    renrenDebug &#123;</span><br><span class="line">        keyAlias <span class="string">&#x27;test&#x27;</span></span><br><span class="line">        keyPassword <span class="string">&#x27;test&#x27;</span></span><br><span class="line">        storeFile file(<span class="string">&#x27;../tool/test.key&#x27;</span>)</span><br><span class="line">        storePassword <span class="string">&#x27;test&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sourceSets &#123;</span><br><span class="line">      main &#123;</span><br><span class="line">          manifest.srcFile <span class="string">&#x27;AndroidManifest.xml&#x27;</span></span><br><span class="line">          java.srcDirs = [<span class="string">&#x27;src&#x27;</span>]</span><br><span class="line">          resources.srcDirs = [<span class="string">&#x27;src&#x27;</span>]</span><br><span class="line">          aidl.srcDirs = [<span class="string">&#x27;src&#x27;</span>]</span><br><span class="line">          renderscript.srcDirs = [<span class="string">&#x27;src&#x27;</span>]</span><br><span class="line">          res.srcDirs = [<span class="string">&#x27;res&#x27;</span>]</span><br><span class="line">          assets.srcDirs = [<span class="string">&#x27;assets&#x27;</span>]</span><br><span class="line">          jniLibs.srcDirs = [<span class="string">&#x27;libs&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  lintOptions &#123;</span><br><span class="line">      abortOnError <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  buildTypes &#123;</span><br><span class="line">    debug &#123;</span><br><span class="line">        signingConfig signingConfigs.debug</span><br><span class="line">        shrinkResources <span class="literal">false</span></span><br><span class="line">        zipAlignEnabled <span class="literal">false</span></span><br><span class="line">        minifyEnabled <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试</span></span><br><span class="line">        buildConfigField <span class="string">&quot;boolean&quot;</span>, <span class="string">&quot;TEST_ENV&quot;</span>, <span class="string">&quot;true&quot;</span></span><br><span class="line">        manifestPlaceholders = [<span class="attr">WECHATAPPID:</span> <span class="string">&quot;wxea2b67dxxxxxx&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    release &#123;</span><br><span class="line">        signingConfig signingConfigs.release <span class="comment">// 密钥配置</span></span><br><span class="line">        shrinkResources <span class="literal">true</span> <span class="comment">// 删除不必要的源文件</span></span><br><span class="line">        zipAlignEnabled <span class="literal">true</span> <span class="comment">// 压缩对齐</span></span><br><span class="line">        minifyEnabled <span class="literal">true</span></span><br><span class="line">        proguardFiles getDefaultProguardFile(<span class="string">&#x27;proguard-android-optimize.txt&#x27;</span>), <span class="string">&#x27;proguard-rules.pro&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 正式</span></span><br><span class="line">        buildConfigField <span class="string">&quot;boolean&quot;</span>, <span class="string">&quot;TEST_ENV&quot;</span>, <span class="string">&quot;false&quot;</span></span><br><span class="line">        manifestPlaceholders = [<span class="attr">WECHATAPPID:</span> <span class="string">&quot;wxb093774eaxxxxxx&quot;</span>]</span><br><span class="line"></span><br><span class="line">        applicationVariants.all &#123; variant -&gt;</span><br><span class="line">            variant.outputs.each &#123; output -&gt;</span><br><span class="line">                <span class="keyword">def</span> outputFile = output.outputFile</span><br><span class="line">                <span class="keyword">if</span> (outputFile != <span class="literal">null</span> &amp;&amp; outputFile.name.endsWith(<span class="string">&#x27;.apk&#x27;</span>)) &#123;</span><br><span class="line">                    <span class="comment">// 输出apk名称为 LOU_20161101_V0.2.0.apk</span></span><br><span class="line">                    <span class="keyword">def</span> fileName = <span class="string">&quot;LOU_$&#123;releaseTime()&#125;_V$&#123;defaultConfig.versionName&#125;.apk&quot;</span></span><br><span class="line">                    output.outputFile = <span class="keyword">new</span> File(outputFile.parent, fileName)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    AndroidManifest的application标签下添加： &lt;meta-data android:name=&quot;UMENG_CHANNEL&quot; android:value=&quot;$&#123;UMENG_CHANNEL_VALUE&#125;&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    productFlavors &#123;</span></span><br><span class="line"><span class="comment">//        yingyongbao &#123;&#125;</span></span><br><span class="line"><span class="comment">//        wandoujia &#123;&#125;</span></span><br><span class="line"><span class="comment">//        xiaomi &#123;&#125;</span></span><br><span class="line"><span class="comment">//        qihu360 &#123;&#125;</span></span><br><span class="line"><span class="comment">//        baidu &#123;&#125;</span></span><br><span class="line"><span class="comment">//        meizu &#123;&#125;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    productFlavors.all &#123;</span></span><br><span class="line"><span class="comment">//        flavor -&gt; flavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name]</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> releaseTime() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Date().format(<span class="string">&quot;yyyMMdd&quot;</span>, TimeZone.getTimeZone(<span class="string">&quot;UTC&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="proguard-混淆配置"><a href="#proguard-混淆配置" class="headerlink" title="proguard 混淆配置"></a>proguard 混淆配置</h1><h2 id="为什么要过滤混淆"><a href="#为什么要过滤混淆" class="headerlink" title="为什么要过滤混淆"></a>为什么要过滤混淆</h2><blockquote>
<p>（<a href="http://blog.csdn.net/fengyuzhengfan/article/details/43876197%EF%BC%89">http://blog.csdn.net/fengyuzhengfan/article/details/43876197）</a><br>ProGuard 默认会对第三方库也进行混淆的，而第三方库有的已经混淆过了，有的使用了 Java 反射技术，所以我们在进行代码混淆的时候要排除这些第三方库。排除对第三方库的混淆需要在混淆规则文件（通常是：proguard-project.txt 或 proguard.cfg 或 proguard-rules.pro 或 proguard-rules.txt 也可以是其它的文件名只要在配置文件中将含有混淆规则的文件名配置进去就行了）中添加如下规则： 1.如果使用了 Gson 之类的工具要使 JavaBean 类即实体类不被混淆。 2.如果使用了自定义控件那么要保证它们不参与混淆。 3.如果使用了枚举要保证枚举不被混淆。 4.对第三方库中的类不进行混淆</p>
</blockquote>
<h2 id="proguard-rules-pro-文件"><a href="#proguard-rules-pro-文件" class="headerlink" title="proguard-rules.pro 文件"></a>proguard-rules.pro 文件</h2><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># If your project uses WebView with JS, uncomment the following</span></span><br><span class="line"><span class="comment"># and specify the fully qualified class name to the JavaScript interface</span></span><br><span class="line"><span class="comment"># class:</span></span><br><span class="line">-keepclassmembers class fqcn.of.javascript.interface.for.webview &#123;</span><br><span class="line">  public *<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略警告</span></span><br><span class="line">-ignorewarning</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除日志</span></span><br><span class="line">-assumenosideeffects class android.util.Log &#123;</span><br><span class="line">    public static *** d(...)<span class="comment">;</span></span><br><span class="line">    public static *** i(...)<span class="comment">;</span></span><br><span class="line">    public static *** w(...)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://as.quanke.name/%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86%E8%A7%84%E5%88%99%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6proguard-rulespro.html">代码混淆规则配置文件:proguard-rules.pro</a></li>
</ul>
<h1 id="Avoid-Maven-dynamic-dependency-resolution-such-as-2-1"><a href="#Avoid-Maven-dynamic-dependency-resolution-such-as-2-1" class="headerlink" title="Avoid Maven dynamic dependency resolution. (such as 2.1.+)"></a>Avoid Maven dynamic dependency resolution. (such as <code>2.1.+</code>)</h1><p>this result in different and unstable builds or subtle, untracked difference<br>in behavior between builds.</p>
<h1 id="在配置-build-gradle-的时候，避免直接写入敏感信息（例如：密码），而是写入到版本控制工具"><a href="#在配置-build-gradle-的时候，避免直接写入敏感信息（例如：密码），而是写入到版本控制工具" class="headerlink" title="在配置 build.gradle 的时候，避免直接写入敏感信息（例如：密码），而是写入到版本控制工具"></a>在配置 <code>build.gradle</code> 的时候，避免直接写入敏感信息（例如：密码），而是写入到版本控制工具</h1><p>忽略的文件<code>gradle.properties</code>中。</p>
<blockquote>
<p><a href="https://github.com/futurice/android-best-practices#gradle-configuration">https://github.com/futurice/android-best-practices#gradle-configuration</a></p>
</blockquote>
<h1 id="针对测试版本和发布版本使用不同的-appId-这样两个版本就可以同时存在在一个设备上了。"><a href="#针对测试版本和发布版本使用不同的-appId-这样两个版本就可以同时存在在一个设备上了。" class="headerlink" title="针对测试版本和发布版本使用不同的 appId, 这样两个版本就可以同时存在在一个设备上了。"></a>针对测试版本和发布版本使用不同的 appId, 这样两个版本就可以同时存在在一个设备上了。</h1><p>可以通过前缀或后缀的方式来区分。</p>
<blockquote>
<p><a href="https://github.com/futurice/android-best-practices#gradle-configuration">https://github.com/futurice/android-best-practices#gradle-configuration</a></p>
</blockquote>
<h1 id="使用-Maven-依赖方案代替使用导入-jar-包方案"><a href="#使用-Maven-依赖方案代替使用导入-jar-包方案" class="headerlink" title="使用 Maven 依赖方案代替使用导入 jar 包方案"></a>使用 Maven 依赖方案代替使用导入 jar 包方案</h1><p>如果在你的项目中你明确使用率 jar 文件，那么它们可能成为永久的版本，如 2.1.1.下载 jar 包更新他们是很繁琐的， 这个问题 Maven 很好的解决了，这在 Android Gradle 构建中也是推荐的方法。你可以指定版本的一个范围，如 2.1.+,然后 Maven 会自动升级到制定的最新版本，例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">&#x27;com.netflix.rxjava:rxjava-core:0.19.+&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;com.netflix.rxjava:rxjava-android:0.19.+&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;com.fasterxml.jackson.core:jackson-databind:2.4.+&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;com.fasterxml.jackson.core:jackson-core:2.4.+&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;com.fasterxml.jackson.core:jackson-annotations:2.4.+&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;com.squareup.okhttp:okhttp:2.0.+&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;com.squareup.okhttp:okhttp-urlconnection:2.0.+&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考资料-1"><a href="#参考资料-1" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://www.kancloud.cn/thinkphp/android-best-practices/42169">Gradle 配置</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
        <tag>gradle</tag>
      </tags>
  </entry>
  <entry>
    <title>Drawable相关</title>
    <url>/android/drawable/</url>
    <content><![CDATA[<h2 id="动态修改-shape-中的颜色"><a href="#动态修改-shape-中的颜色" class="headerlink" title="动态修改 shape 中的颜色"></a>动态修改 shape 中的颜色</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- drawable/opera_circle.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> <span class="attr">android:shape</span>=<span class="string">&quot;oval&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;#fff002&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">size</span> <span class="attr">android:height</span>=<span class="string">&quot;64dp&quot;</span> <span class="attr">android:width</span>=<span class="string">&quot;64dp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- layout/ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/item_mode_list_iv_color&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;28dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">&quot;@drawable/opera_circle&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ImageView</span> <span class="variable">ivColor</span> <span class="operator">=</span> getView(R.id.item_mode_list_iv_color);</span><br><span class="line"><span class="type">GradientDrawable</span> <span class="variable">drawable</span> <span class="operator">=</span> (GradientDrawable) ivColor.getDrawable();</span><br><span class="line">drawable.setColor(Color.parseColor(<span class="string">&quot;#2b3c89&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="动态修改-Selector-–-gt-layer-list-–-gt-shape-中的颜色"><a href="#动态修改-Selector-–-gt-layer-list-–-gt-shape-中的颜色" class="headerlink" title="动态修改 Selector –&gt; layer-list –&gt; shape 中的颜色"></a>动态修改 Selector –&gt; layer-list –&gt; shape 中的颜色</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- drawable/selector_skin_color.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_checked</span>=<span class="string">&quot;true&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer-list</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:left</span>=<span class="string">&quot;4dp&quot;</span> <span class="attr">android:top</span>=<span class="string">&quot;4dp&quot;</span> <span class="attr">android:right</span>=<span class="string">&quot;4dp&quot;</span> <span class="attr">android:bottom</span>=<span class="string">&quot;4dp&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">shape</span> <span class="attr">android:shape</span>=<span class="string">&quot;oval&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;@android:color/transparent&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_checked</span>=<span class="string">&quot;false&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer-list</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:left</span>=<span class="string">&quot;12dp&quot;</span> <span class="attr">android:top</span>=<span class="string">&quot;12dp&quot;</span> <span class="attr">android:right</span>=<span class="string">&quot;12dp&quot;</span> <span class="attr">android:bottom</span>=<span class="string">&quot;12dp&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">shape</span> <span class="attr">android:shape</span>=<span class="string">&quot;oval&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;@android:color/transparent&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> RadioButton <span class="title function_">getCircleRadioButton</span><span class="params">(<span class="type">int</span> color)</span> &#123;</span><br><span class="line">    <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> getContext();</span><br><span class="line">    <span class="type">int</span> <span class="variable">w</span> <span class="operator">=</span> Uscreen.dp2Px(context, <span class="number">48</span>);</span><br><span class="line">    <span class="type">RadioButton</span> <span class="variable">rbtn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RadioButton</span>(context);</span><br><span class="line">    rbtn.setLayoutParams(<span class="keyword">new</span> <span class="title class_">RadioGroup</span>.LayoutParams(w, w));</span><br><span class="line">    rbtn.setButtonDrawable(<span class="keyword">new</span> <span class="title class_">ColorDrawable</span>(Color.TRANSPARENT));</span><br><span class="line">    rbtn.setBackgroundResource(R.drawable.selector_skin_color);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态修改颜色；</span></span><br><span class="line">    <span class="type">Drawable</span> <span class="variable">drawable</span> <span class="operator">=</span> rbtn.getBackground();</span><br><span class="line">    <span class="keyword">if</span>(drawable  <span class="keyword">instanceof</span> StateListDrawable)&#123;</span><br><span class="line">        <span class="type">StateListDrawable</span> <span class="variable">gradientDrawable</span> <span class="operator">=</span> (StateListDrawable) drawable;</span><br><span class="line">        <span class="type">ConstantState</span> <span class="variable">constantState</span> <span class="operator">=</span> gradientDrawable.getConstantState();</span><br><span class="line">        <span class="keyword">if</span>(constantState <span class="keyword">instanceof</span> DrawableContainerState)&#123;</span><br><span class="line">            <span class="type">DrawableContainerState</span> <span class="variable">drawableContainerState</span> <span class="operator">=</span> (DrawableContainerState)constantState;</span><br><span class="line">            Drawable[] children = drawableContainerState.getChildren();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; children.length; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (children[i] <span class="keyword">instanceof</span> LayerDrawable) &#123;</span><br><span class="line">                    <span class="type">LayerDrawable</span> <span class="variable">selectedItem</span> <span class="operator">=</span> (LayerDrawable) children[i];</span><br><span class="line">                    <span class="type">GradientDrawable</span> <span class="variable">selectedDrawable</span> <span class="operator">=</span> (GradientDrawable) selectedItem.getDrawable(<span class="number">0</span>);</span><br><span class="line">                    selectedDrawable.mutate();</span><br><span class="line">                    selectedDrawable.setColor(color);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rbtn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体应用参考：<a href="http://blog.csdn.net/ly1414725328/article/details/51386418">【Android】自定义 View —— 设置中的选择皮肤项</a></p>
<h2 id="让-Selector-中的图片居右对齐"><a href="#让-Selector-中的图片居右对齐" class="headerlink" title="让 Selector 中的图片居右对齐"></a>让 Selector 中的图片居右对齐</h2><p>抛出问题：<br>实现如图的效果和功能，当选中时后面有一个对勾，当非选中时没有对勾，点击「发送」的时候给所有选中的 item 发送消息。<br><img src="https://github.com/lyloou/img/raw/develop/z/20191211143106.jpg" alt="让Selector中的图片居右对齐"></p>
<p>复杂的做法是：<br>通过自定义一个实体类，每个对象都有一个名称属性和一个表示是否是选中状态属性；<br>给 ListView 设置 item 监听，点击 item 的时候，改变其状态然后刷新列表 ……</p>
<p>简单的做法：<br>因为这里只是为了获取到所有选中的 item，并没有其他的功能需求，我们可以充分利用 ListView 的 choice 功能，<br>（即通过设置 ListView 的多选模式<code>android:choiceMode=&quot;multipleChoice&quot;</code>）；</p>
<p>为了使用简单的做法，我们可能会遇到这样的问题：在哪里设置选中和没选中两种状态；<br>解决办法就是给 item 的根布局设置 selector，根据是否处于激活状态来区分；</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- layout/item_lv--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;@drawable/llyt_bg_selector&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingBottom</span>=<span class="string">&quot;8dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingTop</span>=<span class="string">&quot;8dp&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;浩南&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如何让 selector 中的图片居右对齐：<br>简单来说，就是利用 bitmap 标签的 gravity 属性和 titleMode 属性来控制。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- drawable/llyt_bg_selector.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_activated</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bitmap</span> <span class="attr">android:src</span>=<span class="string">&quot;@drawable/img_checked&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:tileMode</span>=<span class="string">&quot;disabled&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:dither</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:antialias</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:gravity</span>=<span class="string">&quot;end|center_vertical&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如何获取所有选中的条目：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">SparseBooleanArray</span> <span class="variable">sba</span> <span class="operator">=</span> listView.getCheckedItemPositions();</span><br><span class="line">ArrayList&lt;Friend&gt; checkedLists = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; friendAdapter.getCount(); i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (sba.get(i)) &#123;</span><br><span class="line">        checkedLists.add(adapter.getItem(i));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Log.e(<span class="string">&quot;Lou&quot;</span>, <span class="string">&quot;Get checked items :&quot;</span> + checkedLists);</span><br></pre></td></tr></table></figure>

<p>还有一种思路：<br>通过「点 9」图来实现让图片居右对齐的目的；</p>
<p>外部链接：</p>
<ul>
<li><a href="http://stackoverflow.com/questions/13634259/explanation-of-state-activated-state-selected-state-pressed-state-focused-for">Explanation of state_activated, state_selected, state_pressed, state_focused for ListView</a></li>
</ul>
<h2 id="背景图片平铺"><a href="#背景图片平铺" class="headerlink" title="背景图片平铺"></a>背景图片平铺</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bitmap</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:src</span>=<span class="string">&quot;@drawable/stripes&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:tileMode</span>=<span class="string">&quot;repeat&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="推荐教程"><a href="#推荐教程" class="headerlink" title="推荐教程"></a>推荐教程</h2><ul>
<li><a href="https://github.com/keeganlee/kstyle">KStyle 是一个 Android 的样式开发的学习项目。</a></li>
</ul>
<h2 id="点-9-图-点九图"><a href="#点-9-图-点九图" class="headerlink" title="点 9 图-点九图"></a>点 9 图-点九图</h2><p>我们可以在图片的四个边框绘制一个个的小黑点，<br>在上边框和左边框绘制的部分就表示<strong>当图片需要拉伸时就拉伸黑点标记的区域</strong>，<br>在下边框和右边框绘制的部分则表示<strong>内容会被放置的区域</strong>。</p>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Context上下文</title>
    <url>/android/context/</url>
    <content><![CDATA[<h2 id="添加mContext"><a href="#添加mContext" class="headerlink" title="添加mContext"></a>添加<code>mContext</code></h2><ul>
<li><p>在Activity和Fragment中，经常需要用到上下文信息；<br>虽然通过<code>类名.this</code>的方式虽然也可以，但是<code>mContext</code>将更方便易懂，尤其是将代码拷贝来拷贝去时；</p>
</li>
<li><p>将<code>mContext</code>声明在基类中（例如：<code>BaseActivity</code>、<code>BaseFragment</code>）：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Activity mContext;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>在BaseActivity的<code>onCreate</code>方法中添加：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mContext = <span class="built_in">this</span>;</span><br></pre></td></tr></table></figure>

<p>或者在BaseFragment中的<code>onCreate</code>中添加：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mContext = getActivity();</span><br></pre></td></tr></table></figure>
<p>这样所有继承自<code>BaseActivity</code>和<code>BaseFragment</code>的类，均可以直接使用<code>mContext</code>了；</p>
<ul>
<li>扩展：类似的方法，可以让所有的子类直接使用<code>TAG</code>，而不需要在自己的类中声明和初始化；<br>在<code>BaseActivity</code>中添加：<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> getClass().getSimpleName();</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="https://possiblemobile.com/2013/06/context/">Context, What Context?</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Adb相关</title>
    <url>/android/adb/</url>
    <content><![CDATA[<h2 id="restart-adb"><a href="#restart-adb" class="headerlink" title="restart adb"></a>restart adb</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">adb kill-server &amp;&amp; adb start-server</span><br></pre></td></tr></table></figure>

<h2 id="判断当前界面的所属-activity"><a href="#判断当前界面的所属-activity" class="headerlink" title="判断当前界面的所属 activity"></a>判断当前界面的所属 activity</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys activity <span class="comment"># 加上 -h 可以获取帮助信息</span></span><br><span class="line">adb shell dumpsys activity top</span><br><span class="line">adb shell dumpsys activity top | grep ACTIVITY</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://testerhome.com/topics/1462">移动测试基础 android 中 dumpsys 命令使用</a></li>
</ul>
<p><a href="https://blog.csdn.net/qq_31028313/article/details/79679355">https://blog.csdn.net/qq_31028313/article/details/79679355</a><br>(1)查看当前 Activity ：<br>adb shell “dumpsys window w | grep name=”<br>(2)查看当前栈顶的 Activity ：<br>adb shell “dumpsys activity | grep mFocusedActivity”<br>(3)查看当前栈顶的 Activity 的 Fragment ：<br>adb shell dumpsys activity your.package.name</p>
<h2 id="启动程序"><a href="#启动程序" class="headerlink" title="启动程序"></a>启动程序</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">adb shell am start -n com.tencent.mm/.ui.LauncherUI</span><br></pre></td></tr></table></figure>

<h2 id="停止程序"><a href="#停止程序" class="headerlink" title="停止程序"></a>停止程序</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">adb shell am force-stop com.tencent.mm</span><br></pre></td></tr></table></figure>

<h2 id="wifi-连接手机"><a href="#wifi-连接手机" class="headerlink" title="wifi 连接手机"></a>wifi 连接手机</h2><p><a href="https://blog.csdn.net/u013250071/article/details/80527993">https://blog.csdn.net/u013250071/article/details/80527993</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">1.手机打开开发者模式，然后打开USB调试</span><br><span class="line"></span><br><span class="line">2.使用USB数据线连接手机和电脑</span><br><span class="line"></span><br><span class="line">3.在PC端打开cmd命令窗口，输入adb devices ，可以看到已经连接的设备</span><br><span class="line"></span><br><span class="line">4.输入adb tcpip 8888   （设置端口号为8888）</span><br><span class="line"></span><br><span class="line">5.断开手机和电脑的连接</span><br><span class="line"></span><br><span class="line">6.输入adb connect 10.67.161.8:8888，连接成功</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>JetPack</title>
    <url>/android/jetPack/</url>
    <content><![CDATA[<ul>
<li><p><a href="https://www.bilibili.com/video/av53400133/?spm_id_from=333.788.videocard.12">Android 开发基础教程（2019）第 10 集 ViewModel_哔哩哔哩 (゜-゜)つロ 干杯~-bilibili</a></p>
</li>
<li><p><a href="https://github.com/android/sunflower">android/sunflower: A gardening app illustrating Android development best practices with Android Jetpack.</a></p>
</li>
</ul>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzAxMTI4MTkwNQ==&amp;mid=2650826588&amp;idx=1&amp;sn=21288ece071c7c0d1ead1d4cd8a95c67&amp;chksm=80b7b3c2b7c03ad4877d1204f27734b7b5f13990d2af774df5b96f699cc28778e43843d007b2&amp;scene=0#rd">https://mp.weixin.qq.com/s?__biz=MzAxMTI4MTkwNQ==&amp;mid=2650826588&amp;idx=1&amp;sn=21288ece071c7c0d1ead1d4cd8a95c67&amp;chksm=80b7b3c2b7c03ad4877d1204f27734b7b5f13990d2af774df5b96f699cc28778e43843d007b2&amp;scene=0#rd</a></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">1. Android Jetpack 架构组件之 Lifecycle（使用篇）</span><br><span class="line">https://blog.csdn.net/Alexwll/article/details/80638905</span><br><span class="line"></span><br><span class="line">2. Android Jetpack 架构组件之 Lifecycle（源码篇）</span><br><span class="line">https://blog.csdn.net/Alexwll/article/details/82491901</span><br><span class="line"></span><br><span class="line">3. Android Jetpack 架构组件之 ViewModel （源码篇）</span><br><span class="line">https://blog.csdn.net/Alexwll/article/details/82459614</span><br><span class="line"></span><br><span class="line">4. Android Jetpack 架构组件之 LiveData（使用、源码篇）</span><br><span class="line">https://blog.csdn.net/Alexwll/article/details/82996003</span><br><span class="line"></span><br><span class="line">5. Android Jetpack架构组件之 Paging（使用、源码篇）</span><br><span class="line">https://blog.csdn.net/Alexwll/article/details/83246201</span><br><span class="line"></span><br><span class="line">6. Android Jetpack 架构组件之 Room（使用、源码篇）</span><br><span class="line">https://blog.csdn.net/Alexwll/article/details/83033460</span><br><span class="line"></span><br><span class="line">7. Android Jetpack 架构组件之Navigation</span><br><span class="line">https://blog.csdn.net/Alexwll/article/details/83244004</span><br><span class="line"></span><br><span class="line">8. Android Jetpack架构组件之WorkManger</span><br><span class="line">https://blog.csdn.net/Alexwll/article/details/83244871</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="https://www.jianshu.com/p/81a284969f03">即学即用 Android Jetpack - ViewModel &amp; LiveData - 简书</a></p>
<blockquote>
<p>LiveData is an observable data holder class. Unlike a regular observable, LiveData is lifecycle-aware, meaning it respects the lifecycle of other app components, such as activities, fragments, or services.</p>
</blockquote>
<blockquote>
<p>The ViewModel class is designed to store and manage UI-related data in a lifecycle conscious way. The ViewModel class allows data to survive configuration changes such as screen rotations.</p>
</blockquote>
<p>可以通过下面的图来看 <code>ViewModel</code> 和 <code>LiveData</code> 之间的关系<br><img src="https://upload-images.jianshu.io/upload_images/9271486-93980cb4a2458d6d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/803"><br>还可以通过下面的代码来看 <code>ViewModel</code> 和 <code>LiveData</code> 之间的关系</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ShoeModel</span> <span class="keyword">constructor</span>(shoeRepository: ShoeRepository) : ViewModel() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 品牌的观察对象 默认观察所有的品牌</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> brand = MutableLiveData&lt;String&gt;().apply &#123;</span><br><span class="line">        value = ALL</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 鞋子集合的观察类</span></span><br><span class="line">    <span class="keyword">val</span> shoes: LiveData&lt;List&lt;Shoe&gt;&gt; = brand.switchMap &#123;</span><br><span class="line">        <span class="comment">// Room数据库查询，只要知道返回的是LiveData&lt;List&lt;Shoe&gt;&gt;即可</span></span><br><span class="line">        <span class="keyword">if</span> (it == ALL) &#123;</span><br><span class="line">            shoeRepository.getAllShoes()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            shoeRepository.getShoesByBrand(it)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">setBrand</span><span class="params">(brand:<span class="type">String</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.brand.value = brand</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.brand.map &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">clearBrand</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.brand.value = ALL</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> ALL = <span class="string">&quot;所有&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="验证-LiveData-的在两个-fragments-上共享数据"><a href="#验证-LiveData-的在两个-fragments-上共享数据" class="headerlink" title="验证 LiveData 的在两个 fragments 上共享数据"></a>验证 LiveData 的在两个 fragments 上共享数据</h2><ul>
<li><a href="https://www.jianshu.com/p/81a284969f03">即学即用 Android Jetpack - ViewModel &amp; LiveData - 简书</a></li>
</ul>
<p><strong>源码</strong></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// LoginLiveData</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginLiveData</span> : <span class="type">MutableLiveData</span>&lt;<span class="type">LoginInfo</span>&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> sInstance: LoginLiveData</span><br><span class="line"></span><br><span class="line">        <span class="meta">@MainThread</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">get</span><span class="params">()</span></span>: LoginLiveData &#123;</span><br><span class="line">            sInstance = <span class="keyword">if</span> (::sInstance.isInitialized) sInstance <span class="keyword">else</span> LoginLiveData()</span><br><span class="line">            <span class="keyword">return</span> sInstance</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LoginFragment.onViewCreated</span></span><br><span class="line">Log.e(<span class="string">&quot;TTAG&quot;</span>, <span class="string">&quot;from LoginFragment, the init liveData is: <span class="subst">$&#123;LoginLiveData.get().value&#125;</span>&quot;</span>)</span><br><span class="line">LoginLiveData.<span class="keyword">get</span>().observe(viewLifecycleOwner, Observer &#123;</span><br><span class="line">    Log.e(<span class="string">&quot;TTAG&quot;</span>, <span class="string">&quot;from LoginFragment, the liveData changed: <span class="variable">$it</span>&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">Handler().postDelayed(&#123;</span><br><span class="line">    LoginLiveData.<span class="keyword">get</span>().apply &#123;</span><br><span class="line">        value = LoginInfo(<span class="string">&quot;login&quot;</span>, <span class="string">&quot;login&quot;</span>, <span class="string">&quot;login@qq.com&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// WelcomeFragment.onViewCreated</span></span><br><span class="line">Log.e(<span class="string">&quot;TTAG&quot;</span>, <span class="string">&quot;from LoginFragment, the init liveData is: <span class="subst">$&#123;LoginLiveData.get().value&#125;</span>&quot;</span>)</span><br><span class="line">LoginLiveData.<span class="keyword">get</span>().observe(viewLifecycleOwner, Observer &#123;</span><br><span class="line">    Log.e(<span class="string">&quot;TTAG&quot;</span>, <span class="string">&quot;from LoginFragment, the liveData changed: <span class="variable">$it</span>&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">Handler().postDelayed(&#123;</span><br><span class="line">    LoginLiveData.<span class="keyword">get</span>().apply &#123;</span><br><span class="line">        value = LoginInfo(<span class="string">&quot;login&quot;</span>, <span class="string">&quot;login&quot;</span>, <span class="string">&quot;login@qq.com&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>日志</strong></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 首次进入welcome</span></span><br><span class="line">E/TTAG: from WelcomeFragment, the init liveData is: null</span><br><span class="line">E/TTAG: from WelcomeFragment, the liveData changed:LoginInfo(<span class="attr">account</span>=welcome, pwd=welcome, email=welcome@qq.com)</span><br><span class="line"><span class="comment"># 点击进入login</span></span><br><span class="line">E/TTAG: from LoginFragment, the init liveData is: LoginInfo(<span class="attr">account</span>=welcome, pwd=welcome, email=welcome@qq.com)</span><br><span class="line">E/TTAG: from LoginFragment, the liveData changed: LoginInfo(<span class="attr">account</span>=welcome, pwd=welcome, email=welcome@qq.com)</span><br><span class="line">E/TTAG: from LoginFragment, the liveData changed: LoginInfo(<span class="attr">account</span>=login, pwd=login, email=login@qq.com)</span><br></pre></td></tr></table></figure>

<h2 id="Room"><a href="#Room" class="headerlink" title="Room"></a>Room</h2><p><a href="https://www.jianshu.com/p/815c7db24b6d">即学即用 Android Jetpack - Room - 简书</a></p>
<p><a href="https://www.jianshu.com/p/3e358eb9ac43">Android Room 框架学习 - 简书</a></p>
<h2 id="Paging"><a href="#Paging" class="headerlink" title="Paging"></a>Paging</h2><h4 id="问题：-Jetpack-Paging-闪烁"><a href="#问题：-Jetpack-Paging-闪烁" class="headerlink" title="问题： Jetpack Paging 闪烁"></a>问题： Jetpack Paging 闪烁</h4><p>描述： 一点点的不相关的修改都会导致列表刷新，源码如下</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> DIFF_CALLBACK = <span class="keyword">object</span> : DiffUtil.ItemCallback&lt;DbFlowDay&gt;() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">areItemsTheSame</span><span class="params">(oldItem: <span class="type">DbFlowDay</span>, newItem: <span class="type">DbFlowDay</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> oldItem === newItem</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">areContentsTheSame</span><span class="params">(oldItem: <span class="type">DbFlowDay</span>, newItem: <span class="type">DbFlowDay</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> oldItem.day == newItem.day</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决，如下源码：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> DIFF_CALLBACK = <span class="keyword">object</span> : DiffUtil.ItemCallback&lt;DbFlowDay&gt;() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">areItemsTheSame</span><span class="params">(oldItem: <span class="type">DbFlowDay</span>, newItem: <span class="type">DbFlowDay</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> oldItem.id == newItem.id <span class="comment">// ！！！ 这里，比较id，而不是对象</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">areContentsTheSame</span><span class="params">(oldItem: <span class="type">DbFlowDay</span>, newItem: <span class="type">DbFlowDay</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> oldItem.day == newItem.day</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="databinding-recyclerView"><a href="#databinding-recyclerView" class="headerlink" title="databinding recyclerView"></a>databinding recyclerView</h2><p><a href="https://www.jianshu.com/p/379a8f5347de">DataBinding 在 RecyclerView 中的使用 - 简书</a></p>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Gradle</title>
    <url>/android/gradle/</url>
    <content><![CDATA[<ul>
<li><p><a href="https://medium.com/@prathanbomb/tips-auto-increment-versioncode-of-android-using-gradle-dba0425af97c">[Tips] Auto-increment versionCode using Gradle – Supitsara Prathan – Medium</a></p>
</li>
<li><p><a href="http://www.infoq.com/cn/articles/android-in-depth-gradle">深入理解 Android（一）：Gradle 详解</a></p>
</li>
<li><p><a href="https://zllbird.github.io/2016/01/14/android%E4%BD%BF%E7%94%A8gradle%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE/">【Android】使用 Gradle 进行配置 · 诸隆隆</a></p>
</li>
<li><p><a href="http://www.groovy-lang.org/api.html">The Apache Groovy programming language - Groovy Development Kit</a></p>
</li>
<li><p><a href="https://docs.gradle.org/current/dsl/">Gradle DSL Version 4.8</a></p>
</li>
<li><p><a href="https://developer.android.com/studio/build/">配置构建  |  Android Developers</a></p>
</li>
<li><p><a href="https://developer.android.com/studio/build/building-cmdline">从命令行构建您的应用  |  Android Developers</a></p>
</li>
</ul>
<h2 id="Plugin-version-VS-Required-Gradle-version"><a href="#Plugin-version-VS-Required-Gradle-version" class="headerlink" title="(Plugin version) VS (Required Gradle version)"></a>(Plugin version) VS (Required Gradle version)</h2><p><a href="https://developer.android.com/studio/releases/gradle-plugin">Android Gradle plugin release notes | Android Developers</a></p>
<h2 id="了解在构建生命周期的各个阶段所花费的时间"><a href="#了解在构建生命周期的各个阶段所花费的时间" class="headerlink" title="了解在构建生命周期的各个阶段所花费的时间"></a>了解在构建生命周期的各个阶段所花费的时间</h2><p>通过 <code>--profile</code> 来生成报告</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./gradlew assembleDebug --profile</span><br></pre></td></tr></table></figure>

<h2 id="android-studio-error-mixing-versions-can-lead-to-run-time-crashes"><a href="#android-studio-error-mixing-versions-can-lead-to-run-time-crashes" class="headerlink" title="android studio error- mixing versions can lead to run-time crashes"></a><a href="https://stackoverflow.com/questions/42960731/android-studio-error-mixing-versions-can-lead-to-run-time-crashes">android studio error- mixing versions can lead to run-time crashes</a></h2><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Add these lines of code in your build.gradle (Module:app) file at end:</span></span><br><span class="line">configurations.all &#123;</span><br><span class="line">    resolutionStrategy.eachDependency &#123; DependencyResolveDetails details -&gt;</span><br><span class="line">        <span class="keyword">def</span> requested = details.requested</span><br><span class="line">        <span class="keyword">if</span> (requested.group == <span class="string">&#x27;com.android.support&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!requested.name.startsWith(<span class="string">&quot;multidex&quot;</span>)) &#123;</span><br><span class="line">                details.useVersion <span class="string">&#x27;27.1.1&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
<h2 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h2><p>java -DsocksProxyHost=10.1.1.2 -DsocksProxyPort=8877 -Djava.net.socks.username=alibaba -Djava.net.socks.password=secret</p>
<p><a href="https://blog.csdn.net/qq_29033193/article/details/84985536">AndroidStudio 彻底关闭 http 网络代理方法 - Mr.Liu - CSDN 博客</a></p>
<p><a href="https://blog.csdn.net/WittyCollegeStudent/article/details/78954200">AndroidStudio 中 Gradle 的 Socks 代理设置 - WittyCollegeStudent 的博客 - CSDN 博客</a></p>
<p><a href="https://blog.boileryao.com/2019/01/config-android-studio-proxy/">Android Studio 代理配置指南 · 奔跑的锅炉</a></p>
<h2 id="Android-Gradle-下载的依赖包位置"><a href="#Android-Gradle-下载的依赖包位置" class="headerlink" title="Android Gradle 下载的依赖包位置"></a>Android Gradle 下载的依赖包位置</h2><p><a href="https://www.jianshu.com/p/e8db626d768f">Android Gradle 下载的依赖包位置 - 简书</a></p>
<p>Mac 系统默认下载到：/Users/(用户名)/.gradle/caches/modules-2/files-2.1</p>
<p>Windows 系统默认下载到：C:\Users(用户名).gradle\caches\modules-2\files-2.1</p>
<p>举个例子：<br>错误如下： Download Failed ：<a href="https://jcenter.bintray.com/org/jetbrains/kotlin/kotlin-compiler-embeddable/1.2.31/kotlin-compiler-embeddable-1.2.31.jar">https://jcenter.bintray.com/org/jetbrains/kotlin/kotlin-compiler-embeddable/1.2.31/kotlin-compiler-embeddable-1.2.31.jar</a><br>文件夹生成的规律是根据依赖中的组织名称，classpath”org.jetbrains.kotlin:kotlin-gradle-plugin<br>地址路径则查找位置是：<br>C:\Users\Administrator.gradle\caches\modules-2\files-2.1\org.jetbrains.kotlin\kotlin-compiler-embeddable\1.2.71\b394ac31590bff78aea6619b8dc0e2c0958aa599</p>
<h1 id="还有一种方式：使用-everything-软件来搜索关键字，找到对应目录；"><a href="#还有一种方式：使用-everything-软件来搜索关键字，找到对应目录；" class="headerlink" title="还有一种方式：使用 everything 软件来搜索关键字，找到对应目录；"></a>还有一种方式：使用 <code>everything</code> 软件来搜索关键字，找到对应目录；</h1><h2 id="多渠道打包"><a href="#多渠道打包" class="headerlink" title="多渠道打包"></a>多渠道打包</h2><p><img src="https://github.com/lyloou/img/raw/develop/z/20190829145438.png"></p>
<ul>
<li><a href="https://stackoverflow.com/questions/31538924/android-build-gradle-importing-flavors-from-another-file">Android build.gradle importing flavors from another file - Stack Overflow</a><br>The build flavors could be defined in a separate file (<code>build_flavors.gradle</code>) like this:</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        flavorA &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">        flavorB &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and then imported into <code>build.gradle</code>:</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;com.android.application&#x27;</span></span><br><span class="line">apply <span class="attr">from:</span> <span class="string">&#x27;./build_flavors.gradle&#x27;</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    <span class="comment">// the rest of your android configuration</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://stackoverflow.com/questions/49815655/include-library-with-flavor-android">gradle - Include library with flavor android - Stack Overflow</a></li>
</ul>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//flavorDimensions is mandatory with flavors. Use the same name on your 2 files to avoid other conflicts.</span></span><br><span class="line">    flavorDimensions <span class="string">&quot;dim&quot;</span></span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        nocustomer&#123;</span><br><span class="line">            dimension <span class="string">&quot;dim&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// App and library&#x27;s flavor have the same name.</span></span><br><span class="line">            <span class="comment">// MatchingFallbacks can be omitted</span></span><br><span class="line">            matchingFallbacks = [<span class="string">&quot;nocustomer&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        customerNb&#123;</span><br><span class="line">            dimension <span class="string">&quot;dim&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// Here the app and library&#x27;s flavor are different</span></span><br><span class="line">            <span class="comment">// Matching fallbacks will select the library&#x27;s flavor &#x27;customer001&#x27;</span></span><br><span class="line">            matchingFallbacks = [<span class="string">&quot;customer001&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation project(<span class="string">&#x27;:zblelib&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>《Gradle 权威指南》 dimension</li>
</ul>
<p>多个 dimension 的前后关系是有优先级顺序的，越靠前的优先级越高：<br><img src="https://github.com/lyloou/img/raw/develop/z/20190830135419.png"><br><img src="https://github.com/lyloou/img/raw/develop/z/20190830135528.png"></p>
<h2 id="查找冲突的版本号技巧"><a href="#查找冲突的版本号技巧" class="headerlink" title="查找冲突的版本号技巧"></a>查找冲突的版本号技巧</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./gradlew lib1:dependencies | grep -C 3 com.android.support:appcompat-v7:27.1.1</span><br><span class="line">./gradlew app:dependencies | grep -C 3 com.android.support:appcompat-v7:27.1.1</span><br></pre></td></tr></table></figure>

<p>通过上面的方式，可以看到哪个依赖使用了不同的版本号，接着就可以排除方法：</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">implementation (<span class="string">&quot;org.kie.modules:com-google-code-gson:6.5.0.Final&quot;</span>)&#123;</span><br><span class="line">    exclude <span class="attr">group:</span> <span class="string">&#x27;com.google.code.gson&#x27;</span>, <span class="attr">module:</span> <span class="string">&#x27;gson&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用自己版本的,其中在 gradle.properties中声明 GSON_VERSION=2.8.5</span></span><br><span class="line">implementation <span class="string">&quot;com.google.code.gson:gson:$GSON_VERSION&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>75ce2b45ad080aeaf919f35ffb1afa47ad0b6cac</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Fragment相关</title>
    <url>/android/fragment/</url>
    <content><![CDATA[<h2 id="Fragment中监听返回键"><a href="#Fragment中监听返回键" class="headerlink" title="Fragment中监听返回键"></a>Fragment中监听返回键</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//主界面获取焦点,用来监听返回键</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getFocus</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> getView();</span><br><span class="line">    <span class="keyword">if</span> (view == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    view.setFocusableInTouchMode(<span class="literal">true</span>);</span><br><span class="line">    view.requestFocus();</span><br><span class="line">    view.setOnKeyListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnKeyListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onKey</span><span class="params">(View v, <span class="type">int</span> keyCode, KeyEvent event)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (event.getAction() == KeyEvent.ACTION_UP &amp;&amp; keyCode == KeyEvent.KEYCODE_BACK) &#123;</span><br><span class="line">                <span class="comment">// 监听到返回按钮点击事件</span></span><br><span class="line">                <span class="keyword">if</span> (mCbControlSelectAll.getVisibility() == View.VISIBLE) &#123;</span><br><span class="line">                    sync(<span class="literal">false</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="http://blog.csdn.net/ys743276112/article/details/51205227">Android必知必会-Fragment监听返回键事件</a></li>
</ul>
<h2 id="通过调用-fragment-的-isAdded-方法，来判断当前的-fragment-是否阵亡。"><a href="#通过调用-fragment-的-isAdded-方法，来判断当前的-fragment-是否阵亡。" class="headerlink" title="通过调用 fragment 的 isAdded() 方法，来判断当前的 fragment 是否阵亡。"></a>通过调用 fragment 的 <code>isAdded()</code> 方法，来判断当前的 fragment 是否阵亡。</h2><ul>
<li>具体用法参考：<code>com.example.android.architecture.blueprints.todoapp.tasks.TasksContract.isActive();</code></li>
<li><code>isAdded()</code>文档：Return true if the fragment is currently added to its activity.</li>
</ul>
<h2 id="How-to-implement-onBackPressed-in-Fragments"><a href="#How-to-implement-onBackPressed-in-Fragments" class="headerlink" title="How to implement onBackPressed() in Fragments?"></a><a href="https://stackoverflow.com/questions/5448653/how-to-implement-onbackpressed-in-fragments">How to implement onBackPressed() in Fragments?</a></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OnBackPressedListener</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBack</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create method to set listener in CustomActivity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOnBackPressedListener</span><span class="params">(OnBackPressedListener onBackPressedListener)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.onBackPressedListener = onBackPressedListener;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// in override onBackPressed implement something like that</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onBackPressed</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (onBackPressedListener != <span class="literal">null</span>)</span><br><span class="line">        onBackPressedListener.doBack();</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">super</span>.onBackPressed();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// in your fragment in onCreateView you should add our listener</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> View <span class="title function_">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    activity = getActivity();</span><br><span class="line">    ((CustomActivity)activity).setOnBackPressedListener(<span class="keyword">new</span> <span class="title class_">OnBackPressedListener</span>()&#123;</span><br><span class="line">        <span class="meta">@override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBack</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="comment">// do your logic</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> view;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Jni实现步骤</title>
    <url>/android/jni%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4/</url>
    <content><![CDATA[<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li><p>配置ndk路径<br><code>ctrl+shift+alt+s</code>,ndk location</p>
</li>
<li><p>配置app下 build.gradle  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 指定生成lib so文件的名称</span></span><br><span class="line">defaultConfig&#123;</span><br><span class="line">    ndk&#123;</span><br><span class="line">        moduleName <span class="string">&quot;MyJniLib&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 指定jni路径</span></span><br><span class="line">sourceSets&#123;</span><br><span class="line">    main&#123;</span><br><span class="line">        jni.srcDirs = [<span class="string">&#x27;src/main/jni&#x27;</span>,<span class="string">&#x27;src/main/jni/&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>修改gradle.properties文件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">android.userDeprecatedNdk=<span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
<li><p>设置native接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyloou.secretjni;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ujni</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;MyJniLib&quot;</span>);<span class="comment">//之前在build.gradle里面设置的so名字，必须一致</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title function_">getSec</span><span class="params">(<span class="type">int</span> type, <span class="type">int</span> hashcode)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>build项目，生成Ujni.class文件</p>
</li>
<li><p>通过Ujni.class文件生成头文件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">javah -d jni -classpath MyProject/app/build/intermediates/classes/debug/com.lyloou.secretjni.Ujni</span><br></pre></td></tr></table></figure></li>
<li><p>编写c文件<br>将上一步骤生成的头文件，放在main/jni文件夹下<br>另外新建一个cpp文件实现业务逻辑。</p>
</li>
<li><p>获取so文件<br>编译运行后，在build/intermediates/ndk/debug/lib文件夹下得到一系列包含so文件的文件夹。</p>
</li>
<li><p>只需要保留so文件即可运行项目，jni文件备份起来吧。</p>
</li>
</ol>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><p><a href="http://blog.csdn.net/feipeng_/article/details/73554777">Android Studio jni开发之经典入门demo - FeiPeng_的博客 - CSDN博客</a></p>
</li>
<li><p><a href="http://wxmylife.com/2017/03/22/Android%E9%80%9A%E8%BF%87JNI%E5%8A%A0%E5%AF%86%EF%BC%8C%E5%B9%B6%E5%AE%9E%E7%8E%B0APP%E7%AD%BE%E5%90%8D%E9%AA%8C%E8%AF%81/">Android通过JNI加密，并实现APP签名验证 | wxmylife</a></p>
</li>
<li><p><a href="http://www.jianshu.com/p/2a27ad45e023">Android 密钥保护 - 简书</a></p>
</li>
<li><p><a href="https://www.zhihu.com/question/35136485">android开发如何保障本地加密密钥的安全？ - 知乎</a></p>
</li>
<li><p><a href="https://blog.csdn.net/yy1300326388/article/details/46291417">Android NDK 运行错误：java.lang.UnsatisfiedLinkError: Couldn’t load XXX indLibrary returned null</a></p>
<h3 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">//目录结构一定要改成这个样子</span></span><br><span class="line">|---src</span><br><span class="line">     |---main</span><br><span class="line">           |---jniLibs</span><br><span class="line">                  |---arm64-v8a</span><br><span class="line">                         |---libhello-jni.so</span><br><span class="line">                  |---armeabi</span><br><span class="line">                         |---libhello-jni.so</span><br><span class="line">                  |---armeabi-v7a</span><br><span class="line">                         |---libhello-jni.so</span><br><span class="line">                  |---x86</span><br><span class="line">                         |---libhello-jni.so</span><br><span class="line">                  |---x86_64</span><br><span class="line">                         |---libhello-jni.so</span><br><span class="line">                  |---mips</span><br><span class="line">                         |---libhello-jni.so</span><br><span class="line">                  |---mips64</span><br><span class="line">                         |---libhello-jni.so</span><br></pre></td></tr></table></figure>
<h3 id="方法2［推荐］"><a href="#方法2［推荐］" class="headerlink" title="方法2［推荐］"></a>方法2［推荐］</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  android &#123;</span><br><span class="line">    sourceSets &#123;</span><br><span class="line">        main &#123;</span><br><span class="line">            jniLibs.srcDirs = [<span class="string">&#x27;libs&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android启动模式</title>
    <url>/android/lanchMode/</url>
    <content><![CDATA[<h2 id="Android-Understanding-Activity-launch-mode"><a href="#Android-Understanding-Activity-launch-mode" class="headerlink" title="Android: Understanding Activity launch mode"></a><a href="https://www.mobomo.com/2011/06/android-understanding-activity-launchmode/">Android: Understanding Activity launch mode</a></h2><blockquote>
<ul>
<li>‘standard’ and ‘singleTop’ can instantiate multiple activity instances and the instance will stay in the same task.</li>
<li>For ‘singleTask’ or ‘singleInstance’, the activity class uses the singleton pattern, and that instance will be the root activity of a new task. Let’s examine each value:</li>
</ul>
</blockquote>
<h2 id="the-weird-launch-mode"><a href="#the-weird-launch-mode" class="headerlink" title="the weird launch mode"></a>the weird launch mode</h2><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">https://stackoverflow.com/questions/<span class="number">9363200</span>/android-singletask-singletop-<span class="keyword">and</span>-home-button</span><br><span class="line">The behaviour <span class="keyword">of</span> activity back stack becomes quit weird <span class="keyword">when</span> define main activity <span class="keyword">with</span> singleTask at the same <span class="type">time</span>:</span><br><span class="line"></span><br><span class="line">    &lt;activity android:<span class="type">name</span>=&quot;.MainActivity&quot;</span><br><span class="line">        android:launchMode=&quot;singleTask&quot;&gt;</span><br><span class="line">        &lt;intent-<span class="keyword">filter</span>&gt;</span><br><span class="line">            &lt;action android:<span class="type">name</span>=&quot;android.intent.action.MAIN&quot; /&gt;</span><br><span class="line">            &lt;category android:<span class="type">name</span>=&quot;android.intent.category.LAUNCHER&quot; /&gt;</span><br><span class="line">        &lt;/intent-<span class="keyword">filter</span>&gt;</span><br><span class="line">    &lt;/activity&gt;</span><br><span class="line">    </span><br><span class="line">What even worse <span class="keyword">is</span> there <span class="keyword">is</span> <span class="keyword">no</span> clear explanation <span class="keyword">in</span> the official dev guide regarding <span class="keyword">to</span> this special use <span class="keyword">case</span>. <span class="keyword">Some</span> sections related <span class="keyword">to</span> this topic are even self-contradictory.</span><br><span class="line"></span><br><span class="line">Try <span class="keyword">using</span> launchMode=&quot;standard&quot; <span class="keyword">on</span> your MainActivity A, <span class="keyword">and</span> launchMode=&quot;singleTask&quot; <span class="keyword">on</span> your Activity B, which will give the expect behaviour you described.</span><br></pre></td></tr></table></figure>

<h2 id="自学笔记：Activity的启动模式-FLAG-ACTIVITY-CLEAR-TOP和FLAG-ACTIVITY-REORDER-TO-FRONT"><a href="#自学笔记：Activity的启动模式-FLAG-ACTIVITY-CLEAR-TOP和FLAG-ACTIVITY-REORDER-TO-FRONT" class="headerlink" title="自学笔记：Activity的启动模式:FLAG_ACTIVITY_CLEAR_TOP和FLAG_ACTIVITY_REORDER_TO_FRONT"></a><a href="http://blog.51cto.com/glblong/1209829">自学笔记：Activity的启动模式:FLAG_ACTIVITY_CLEAR_TOP和FLAG_ACTIVITY_REORDER_TO_FRONT</a></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// A, B, C 和 D ==&gt; A, B</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>, B.class);</span><br><span class="line">intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);</span><br><span class="line">startActivity(intent);</span><br><span class="line"></span><br><span class="line"><span class="comment">// add below code , B will be reused.</span></span><br><span class="line">intent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// A，B，C和D ==&gt; A,C,D,B，</span></span><br><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>, MainActivity.class);</span><br><span class="line">intent.addFlags(Intent.FLAG_ACTIVITY_REORDER_TO_FRONT);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>

<h2 id="深入讲解Android中Activity-launchMode-技术小黑屋"><a href="#深入讲解Android中Activity-launchMode-技术小黑屋" class="headerlink" title="深入讲解Android中Activity launchMode - 技术小黑屋"></a><a href="https://droidyue.com/blog/2015/08/16/dive-into-android-activity-launchmode/">深入讲解Android中Activity launchMode - 技术小黑屋</a></h2>]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Glide库</title>
    <url>/android/lib-glide/</url>
    <content><![CDATA[<h2 id="根据图片的文件路径，显示给ImageView"><a href="#根据图片的文件路径，显示给ImageView" class="headerlink" title="根据图片的文件路径，显示给ImageView"></a>根据图片的文件路径，显示给ImageView</h2><p>原理：借助 Glide 库来实现；<br>    <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">pathname</span> <span class="operator">=</span> <span class="string">&quot;/storage/emulated/0/lyloou/image/hello_world.png&quot;</span>;</span><br><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(pathname);</span><br><span class="line">Glide.with(mContext).load(file).asBitmap().into(mIvHi);</span><br></pre></td></tr></table></figure></p>
<h2 id="通过图像-URL-设置圆角图像："><a href="#通过图像-URL-设置圆角图像：" class="headerlink" title="通过图像 URL 设置圆角图像："></a>通过图像 URL 设置圆角图像：</h2><pre><code><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setCircleIcon</span><span class="params">(ImageView view)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://img.gcall.com/dca5/M00/10/8E/wKhoNlggetaENWylAAAAAAAAAAA457.jpg&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">w</span> <span class="operator">=</span> Uscreen.dp2Px(mContext, <span class="number">48</span>);</span><br><span class="line">    Glide.with(mContext)</span><br><span class="line">            .load(url)</span><br><span class="line">            .centerCrop()</span><br><span class="line">            .fitCenter()</span><br><span class="line">            .thumbnail(<span class="number">0.1f</span>)</span><br><span class="line">            .placeholder(R.mipmap.ic_launcher)</span><br><span class="line">            .crossFade()</span><br><span class="line">            .override(w, w)</span><br><span class="line">            .transform(<span class="keyword">new</span> <span class="title class_">BitmapTransformation</span>(mContext) &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> Bitmap <span class="title function_">transform</span><span class="params">(BitmapPool pool, Bitmap toTransform, <span class="type">int</span> outWidth, <span class="type">int</span> outHeight)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> Uview.getBitmapByXfermode(mContext, toTransform,</span><br><span class="line">                            Color.parseColor(<span class="string">&quot;#dddddd&quot;</span>),</span><br><span class="line">                            w,</span><br><span class="line">                            w, PorterDuff.Mode.SRC_IN);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> getClass().getName();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .into(view);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>【Android】logcat</title>
    <url>/android/logcat/</url>
    <content><![CDATA[<h2 id="android-调试时，logcat-错误信息一闪而过"><a href="#android-调试时，logcat-错误信息一闪而过" class="headerlink" title="android 调试时，logcat 错误信息一闪而过"></a>android 调试时，logcat 错误信息一闪而过</h2><ul>
<li><p><a href="https://blog.csdn.net/liaoyi_/article/details/53377425">Android 手机调试不输出错误日志与错误日志一闪而过的问题 - liaoyi 的博客 - CSDN 博客</a></p>
<blockquote>
<p>原来是华为手机（有可能其他手机也有类似的问题）关闭了输出错误日志的功能。现在我们就需要打开这个功能</p>
<ol>
<li> 进入拨号界面输入：_#_#2846579#*# （当你输入完了之后会自动打开 手机的另外一个设置的板块界面）</li>
<li> 依次选择 —&gt; 后台设置 —&gt; LOG 设置 —&gt; LOG 开关 点击打开（手机版本不同界面选项也不同，有的选择 AP 日志勾选，但是大致内容都一样）</li>
<li> 重新启动手机（比较新的版本不需要重启）</li>
</ol>
</blockquote>
<blockquote>
<p>同时你可能会遇到错误日志一闪而过的问题，这个可能是华为手机在手机程序崩溃之后系统调用了一些程序，做了一些操作吧，我们没办法去禁止系统做这些操作但是我们可以在</p>
<p>点击设置 —&gt; 进入手机开发者选项 —&gt; 打开手机 USB 调试功能 —&gt; （在此功能模块里面）选择日志记录器缓冲区大小<br>选择一个大一点的缓冲区（具体自己看手机情况选择）</p>
</blockquote>
</li>
<li><p><a href="https://blog.csdn.net/z736232402/article/details/51576963">android studio logcat 一闪而过 - z736232402 的博客 - CSDN 博客</a></p>
<blockquote>
<p>as 默认选择当前进程，简单点说就是当前进程，我的理解是，如果崩溃了，进程就结束了，所以，就闪过了<br>解决也很简单，第一种就是出现的时候点击下鼠标，logcat 就会停留。第二种就是不要用选择当前的，选择 no filter，如果东西太多，就加过滤，加上包名即可。</p>
</blockquote>
</li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Manifest相关</title>
    <url>/android/manifest/</url>
    <content><![CDATA[<h1 id="Manifest-中注册以内部类形式存在的-Activity"><a href="#Manifest-中注册以内部类形式存在的-Activity" class="headerlink" title="Manifest 中注册以内部类形式存在的 Activity"></a>Manifest 中注册以内部类形式存在的 Activity</h1><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ul>
<li>在《Android 编程权威指南》P127 中，作者建议我们坚持 AUF(Always Use Fragments)原则，即“总是使用 fragment”；<br>另外作者封装了一个很好用的<code>SingleFragmentActivity</code>类，但是这个类通常只有一句话，。<br>个人觉得，为每一个 Activity 都建立一个文件有点浪费。<br>可是使用 Activity（四大组件之一），必须在 Manifest 中注册。<br>那么能不能将所有这类 Activity 放在一个类中进行管理呢？<br>通过搜索关键字：<code>android manifest innerclass</code> 找到了方法；</li>
</ul>
<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><blockquote>
<ol>
<li>As someone pointed out, in AndroidManifest, use the $ sign, like:<br><code>&lt;activity android:name=&quot;.A$B&quot;&gt;</code></li>
<li>Declare class B as static:<br><code>public static class B</code></li>
</ol>
</blockquote>
<h2 id="例如"><a href="#例如" class="headerlink" title="例如"></a>例如</h2><p><strong>【Activity 管理类】</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//: .../activity/ActivityMgr.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityMgr</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">(Activity context, Class clazz)</span>&#123;</span><br><span class="line">        <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(context, clazz);</span><br><span class="line">        context.startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LoginActivity</span> <span class="keyword">extends</span> <span class="title class_">SingleFragmentActivity</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Fragment <span class="title function_">createFragment</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginFragment</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ForgetPasswordActivity</span> <span class="keyword">extends</span> <span class="title class_">SingleFragmentActivity</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Fragment <span class="title function_">createFragment</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ForgetPasswordFragment</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">RegisterActivity</span> <span class="keyword">extends</span> <span class="title class_">SingleFragmentActivity</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Fragment <span class="title function_">createFragment</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RegisterFragment</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AddDeviceActivity</span> <span class="keyword">extends</span> <span class="title class_">SingleFragmentActivity</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Fragment <span class="title function_">createFragment</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AddDeviceFragment</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>【Activity 注册】</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.activity.ActivityMgr$LoginActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:clearTaskOnLaunch</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:launchMode</span>=<span class="string">&quot;singleTask&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme.NoActionBar&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.activity.ActivityMgr$RegisterActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme.NoActionBar&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.activity.ActivityMgr$ForgetPasswordActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme.NoActionBar&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.activity.ActivityMgr$AddDeviceActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme.NoActionBar&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>【启动对应 Activity】</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 启动忘记密码Activity</span></span><br><span class="line">ActivityMgr.start(mContext, ActivityMgr.ForgetPasswordActivity.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动注册Activity</span></span><br><span class="line">ActivityMgr.start(mContext, ActivityMgr.RegisterActivity.class);</span><br></pre></td></tr></table></figure>

<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><ul>
<li>同样的方式也可以用于 Receiver 的注册；</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://stackoverflow.com/questions/3687661/declare-inner-activity-in-the-android-manifest">Declare Inner Activity In The Android Manifest</a></li>
<li><a href="http://stackoverflow.com/questions/3608955/receiver-as-inner-class-in-android">Receiver as inner class in Android</a></li>
</ul>
<h1 id="Android-Material-and-appcompat-Manifest-merger-failed-Stack-Overflow"><a href="#Android-Material-and-appcompat-Manifest-merger-failed-Stack-Overflow" class="headerlink" title="Android Material and appcompat Manifest merger failed - Stack Overflow"></a><a href="https://stackoverflow.com/questions/51793345/android-material-and-appcompat-manifest-merger-failed/53202089">Android Material and appcompat Manifest merger failed - Stack Overflow</a></h1><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- In my case, this is working perfectly.. I have added below two line codes inside manifest file --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:replace</span>=<span class="string">&quot;android:appComponentFactory&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:appComponentFactory</span>=<span class="string">&quot;whateverString&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android中常见问题及解答</title>
    <url>/android/qa/</url>
    <content><![CDATA[<h2 id="assets文件夹和raw文件夹的区别"><a href="#assets文件夹和raw文件夹的区别" class="headerlink" title="assets文件夹和raw文件夹的区别"></a>assets文件夹和raw文件夹的区别</h2><p>【解答】</p>
<ul>
<li>相同点：以原有形式保存到apk中，均不会被编译成二进制文件；</li>
<li>raw里的文件会被映射到R.id中，assets不会；</li>
<li>assets文件夹里面可以包含目录结构，raw不可；</li>
<li>引用方式不同：参考下面的外部链接；</li>
</ul>
<p>【外部链接】</p>
<ul>
<li><a href="Android%E4%B8%ADasset%E6%96%87%E4%BB%B6%E5%A4%B9%E5%92%8Craw%E6%96%87%E4%BB%B6%E5%A4%B9%E5%8C%BA%E5%88%AB">Android中asset文件夹和raw文件夹区别</a></li>
</ul>
<h2 id="invalidate和postInvalidate的区别"><a href="#invalidate和postInvalidate的区别" class="headerlink" title="invalidate和postInvalidate的区别"></a>invalidate和postInvalidate的区别</h2><p>【解答】</p>
<ul>
<li>invalidate必须在主线程中调用，变量发生改变时用来刷新界面；</li>
<li>postInvalidate可以在非主线程中调，用来刷新界面；</li>
<li>通过查看源码发现：postInvalidate是通过Handler间接调用了invalidate;</li>
</ul>
<p>【外部链接】</p>
<ul>
<li><a href="http://blog.csdn.net/mars2639/article/details/6650876">Android笔记：invalidate()和postInvalidate() 的区别及使用</a></li>
</ul>
<h2 id="java-lang-RuntimeException-Performing-stop-of-activity-that-is-not-resumed"><a href="#java-lang-RuntimeException-Performing-stop-of-activity-that-is-not-resumed" class="headerlink" title="java.lang.RuntimeException: Performing stop of activity that is not resumed"></a>java.lang.RuntimeException: Performing stop of activity that is not resumed</h2><ul>
<li><a href="http://www.aichengxu.com/java/6992563.htm">http://www.aichengxu.com/java/6992563.htm</a></li>
<li><a href="https://stackoverflow.com/questions/21947675/android-4-4-2-java-lang-runtimeexception-performing-stop-of-activity-that-is/23246159#23246159">https://stackoverflow.com/questions/21947675/android-4-4-2-java-lang-runtimeexception-performing-stop-of-activity-that-is/23246159#23246159</a><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方案1：</span></span><br><span class="line"><span class="type">Handler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Handler</span>(<span class="keyword">new</span> <span class="title class_">Handler</span>.Callback() &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">handleMessage</span><span class="params">(Message msg)</span> &#123;</span><br><span class="line">       <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">           <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">             <span class="comment">//Start another Activity Here</span></span><br><span class="line">           <span class="keyword">default</span>:</span><br><span class="line">           <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">handler.sendEmptyMessageDelayed(<span class="number">1</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方案2：</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Handler</span>().postDelay(()-&gt;&#123;doSomething()&#125;, <span class="number">100</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>MaterialDesign(材料设计)</title>
    <url>/android/material-design/</url>
    <content><![CDATA[<h2 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h2><ul>
<li><a href="http://code.hootsuite.com/tips-and-tricks-for-android-material-support-library-2-electric-boogaloo/">TIPS AND TRICKS FOR ANDROID MATERIAL SUPPORT LIBRARY 2: ELECTRIC BOOGALOO</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Retrofit</title>
    <url>/android/retrofit/</url>
    <content><![CDATA[<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">ext &#123;</span><br><span class="line">    rxjavaVersion = <span class="string">&#x27;2.1.1&#x27;</span></span><br><span class="line">    rxandroidVersion = <span class="string">&#x27;2.0.1&#x27;</span></span><br><span class="line">    retrofitVersion = <span class="string">&#x27;2.3.0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">implementation <span class="string">&quot;io.reactivex.rxjava2:rxandroid:$rxandroidVersion&quot;</span></span><br><span class="line">implementation <span class="string">&quot;io.reactivex.rxjava2:rxjava:$rxjavaVersion&quot;</span></span><br><span class="line">implementation <span class="string">&quot;com.squareup.retrofit2:retrofit:$retrofitVersion&quot;</span></span><br><span class="line">implementation <span class="string">&quot;com.squareup.retrofit2:adapter-rxjava2:$retrofitVersion&quot;</span></span><br><span class="line">implementation <span class="string">&quot;com.squareup.retrofit2:converter-gson:$retrofitVersion&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NetWork</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">get</span><span class="params">(<span class="meta">@NonNull</span> String baseUrl, <span class="meta">@NonNull</span> Class&lt;T&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> clazz.getSimpleName().concat(baseUrl);</span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) &#123;</span><br><span class="line">            <span class="comment">//noinspection unchecked</span></span><br><span class="line">            <span class="keyword">return</span> (T) map.get(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Retrofit</span> <span class="variable">retrofit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Retrofit</span>.Builder()</span><br><span class="line">                .baseUrl(baseUrl)</span><br><span class="line">                .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">                .addCallAdapterFactory(RxJava2CallAdapterFactory.create())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> retrofit.create(clazz);</span><br><span class="line">        map.put(key, t);</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NetWorkTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIp</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; ips = Arrays.asList(</span><br><span class="line">                <span class="string">&quot;104.194.84.57&quot;</span></span><br><span class="line">                , <span class="string">&quot;14.194.84.55&quot;</span></span><br><span class="line">                , <span class="string">&quot;13.194.84.55&quot;</span></span><br><span class="line">        );</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(ips.size());</span><br><span class="line">        <span class="type">CompositeDisposable</span> <span class="variable">compositeDisposable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CompositeDisposable</span>();</span><br><span class="line"></span><br><span class="line">        compositeDisposable.addAll(ips.stream()</span><br><span class="line">                .map(s -&gt; getDisposable(latch, s))</span><br><span class="line">                .toArray(Disposable[]::<span class="keyword">new</span>));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            latch.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Disposable <span class="title function_">getDisposable</span><span class="params">(CountDownLatch latch, String ip)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> NetWork.get(<span class="string">&quot;http://ip-api.com/&quot;</span>, IpService.class)</span><br><span class="line">                .getIpDetail(ip)</span><br><span class="line">                .subscribeOn(Schedulers.io())</span><br><span class="line">                .observeOn(Schedulers.computation())</span><br><span class="line">                .subscribe(ipDetail -&gt; &#123;</span><br><span class="line">                    latch.countDown();</span><br><span class="line">                    System.out.println(<span class="string">&quot;city:&quot;</span> + ipDetail.getCity());</span><br><span class="line">                &#125;, throwable -&gt; &#123;</span><br><span class="line">                    latch.countDown();</span><br><span class="line">                    System.out.println(<span class="string">&quot;error:&quot;</span> + throwable);</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IpService</span> &#123;</span><br><span class="line">     <span class="meta">@GET(&quot;json/&#123;ip&#125;&quot;)</span></span><br><span class="line">    Observable&lt;IpDetail&gt; <span class="title function_">getIpDetail</span><span class="params">(<span class="meta">@Path(&quot;ip&quot;)</span> String ip)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IpDetail</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String as;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String country;</span><br><span class="line">    <span class="keyword">private</span> String countryCode;</span><br><span class="line">    <span class="keyword">private</span> String isp;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> lat;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> lon;</span><br><span class="line">    <span class="keyword">private</span> String org;</span><br><span class="line">    <span class="keyword">private</span> String query;</span><br><span class="line">    <span class="keyword">private</span> String region;</span><br><span class="line">    <span class="keyword">private</span> String regionName;</span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="keyword">private</span> String timezone;</span><br><span class="line">    <span class="keyword">private</span> String zip;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAs</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> as;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAs</span><span class="params">(String as)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.as = as;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCity</span><span class="params">(String city)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.city = city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCountry</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> country;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCountry</span><span class="params">(String country)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.country = country;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCountryCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> countryCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCountryCode</span><span class="params">(String countryCode)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.countryCode = countryCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getIsp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIsp</span><span class="params">(String isp)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.isp = isp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getLat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLat</span><span class="params">(<span class="type">double</span> lat)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.lat = lat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getLon</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lon;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLon</span><span class="params">(<span class="type">double</span> lon)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.lon = lon;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getOrg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> org;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOrg</span><span class="params">(String org)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.org = org;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getQuery</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> query;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setQuery</span><span class="params">(String query)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.query = query;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRegion</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> region;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRegion</span><span class="params">(String region)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.region = region;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRegionName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> regionName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRegionName</span><span class="params">(String regionName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.regionName = regionName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStatus</span><span class="params">(String status)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTimezone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> timezone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTimezone</span><span class="params">(String timezone)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.timezone = timezone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getZip</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> zip;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setZip</span><span class="params">(String zip)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.zip = zip;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android中支持库（Support Library）</title>
    <url>/android/support%20library/</url>
    <content><![CDATA[<h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>支持库，为了开发出兼容低版本设备的应用而存在的。</p>
<h2 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h2><ul>
<li><a href="https://developer.android.com/topic/libraries/support-library/features.html">Support Library Features</a></li>
<li><a href="http://stormzhang.com/android/2015/03/29/android-support-library/">Android Support兼容包详解</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>TBK</title>
    <url>/android/tbk/</url>
    <content><![CDATA[<h2 id="集成依赖"><a href="#集成依赖" class="headerlink" title="集成依赖"></a>集成依赖</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenCentral();</span><br><span class="line">        jcenter()</span><br><span class="line">        maven &#123;</span><br><span class="line">            url <span class="string">&quot;http://repo.baichuan-android.taobao.com/content/groups/BaichuanRepositories/&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//!+Baichuan</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//fastjson</span></span><br><span class="line">compile <span class="string">&#x27;com.alibaba:fastjson:1.2.9&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//支付</span></span><br><span class="line">compile <span class="string">&#x27;com.alibaba.alipay:alipaySingle:20160825@jar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//登陆</span></span><br><span class="line">compile <span class="string">&#x27;com.ali.auth.sdk:alibabauth_core:1.1.4@jar&#x27;</span></span><br><span class="line">compile <span class="string">&#x27;com.ali.auth.sdk:alibabauth_ui:1.1.4@aar&#x27;</span></span><br><span class="line">compile <span class="string">&#x27;com.ali.auth.sdk:alibabauth_ext:1.1.4@jar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//【可选】仅供特殊合作伙伴使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//compile &#x27;com.ali.auth.sdk:alibabauth_accountlink:1.1.4@jar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//安全基础</span></span><br><span class="line">compile <span class="string">&#x27;com.taobao.android:securityguardaar3:5.1.81@aar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//【可选】安全高级，如使用了发放红包、优惠券高级功能，则必须引入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//compile &#x27;com.taobao.android:securitybodyaar3:5.1.25@aar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Mtop网关</span></span><br><span class="line">compile <span class="string">&#x27;com.taobao.android:mtopsdk_allinone_open:1.2.2.4@jar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//applink</span></span><br><span class="line">compile <span class="string">&#x27;com.taobao.android:alibc_applink:2.0.0.9@jar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//UT</span></span><br><span class="line">compile <span class="string">&#x27;com.taobao.android:utdid4all:1.1.5.3_proguard@jar&#x27;</span></span><br><span class="line">compile <span class="string">&#x27;com.alibaba.mtl:app-monitor-sdk:2.5.1.3_for_bc_proguard@jar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//电商SDK</span></span><br><span class="line">compile <span class="string">&#x27;com.alibaba.sdk.android:alibc_trade_sdk:3.1.1.11@aar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//!-Baichuan</span></span><br></pre></td></tr></table></figure>

<h2 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//: Baichuan.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Baichuan</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showDetailPage</span><span class="params">(Activity activity, String id, String pid, CallbackContext callbackContext)</span> &#123;</span><br><span class="line">        <span class="type">AlibcBasePage</span> <span class="variable">alibcBasePage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlibcDetailPage</span>(id);</span><br><span class="line">        <span class="type">AlibcTaokeParams</span> <span class="variable">alibcTaokeParams</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlibcTaokeParams</span>(pid, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!alibcTaokeParams.isValidPid()) &#123;</span><br><span class="line">            callbackContext.error(<span class="string">&quot;pid无效&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        showPage(activity, alibcBasePage, alibcTaokeParams, callbackContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showDetailPageWithUrl</span><span class="params">(Activity activity, String url, CallbackContext callbackContext)</span> &#123;</span><br><span class="line">        <span class="type">AlibcBasePage</span> <span class="variable">alibcBasePage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlibcPage</span>(url);</span><br><span class="line">        showPage(activity, alibcBasePage, <span class="literal">null</span>, callbackContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showPage</span><span class="params">(Activity activity, AlibcBasePage alibcBasePage, AlibcTaokeParams alibcTaokeParams, <span class="keyword">final</span> CallbackContext callbackContext)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">AlibcShowParams</span> <span class="variable">alibcShowParams</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlibcShowParams</span>(OpenType.Native, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;String, String&gt; exParams = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        exParams.put(AlibcConstants.ISV_CODE, <span class="string">&quot;appisvcode&quot;</span>);</span><br><span class="line"></span><br><span class="line">        AlibcTrade.show(activity, alibcBasePage, alibcShowParams, alibcTaokeParams, exParams, <span class="keyword">new</span> <span class="title class_">AlibcTradeCallback</span>() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(<span class="type">int</span> i, String s)</span> &#123;</span><br><span class="line">                callbackContext.error(<span class="string">&quot;导航失败：&quot;</span> + s);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onTradeSuccess</span><span class="params">(TradeResult tradeResult)</span> &#123;</span><br><span class="line">                <span class="keyword">switch</span> (tradeResult.resultType) &#123;</span><br><span class="line">                    <span class="keyword">case</span> TYPEPAY:</span><br><span class="line">                        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            jsonObject.put(<span class="string">&quot;successArr&quot;</span>, tradeResult.payResult.paySuccessOrders);</span><br><span class="line">                            jsonObject.put(<span class="string">&quot;failureArr&quot;</span>, tradeResult.payResult.payFailedOrders);</span><br><span class="line">                            callbackContext.success(jsonObject);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                            callbackContext.error(<span class="string">&quot;json转换异常:&quot;</span> + e.getMessage());</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> TYPECART:</span><br><span class="line">                        callbackContext.success(<span class="string">&quot;您已经将商品添加到购物车了，赶快去购买吧&quot;</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        callbackContext.error(<span class="string">&quot;未知的结果类型&quot;</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(<span class="keyword">final</span> Activity context)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">AlibcLogin</span> <span class="variable">alibcLogin</span> <span class="operator">=</span> AlibcLogin.getInstance();</span><br><span class="line"></span><br><span class="line">        alibcLogin.showLogin(context, <span class="keyword">new</span> <span class="title class_">AlibcLoginCallback</span>() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccess</span><span class="params">()</span> &#123;</span><br><span class="line">                Toast.makeText(context, <span class="string">&quot;登录成功 &quot;</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">                <span class="comment">//获取淘宝用户信息</span></span><br><span class="line">                Log.i(<span class="string">&quot;Baichuan&quot;</span>, <span class="string">&quot;获取淘宝用户信息: &quot;</span> + AlibcLogin.getInstance().getSession());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(<span class="type">int</span> code, String msg)</span> &#123;</span><br><span class="line">                Toast.makeText(context, <span class="string">&quot;登录失败 &quot;</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="cordova调用"><a href="#cordova调用" class="headerlink" title="cordova调用"></a>cordova调用</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">名称: MyPlugin.toDetailPage</span><br><span class="line">描述: 跳转到淘宝商品详情页面</span><br><span class="line">参数: </span><br><span class="line">   JSONParam ——  pid和isCounpons必传，goodsId和couponsUrl对应isCounpons选其一</span><br><span class="line">    &#123;</span><br><span class="line">        pid: <span class="string">&#x27;mm_131641132_33126906_320380416&#x27;</span>, <span class="comment">// 用户对应pid，此参数必传！！！</span></span><br><span class="line">        isCoupons: <span class="number">0</span>, <span class="comment">// 是否有优惠券，传0（无）或者1（有）</span></span><br><span class="line">        goodsId: <span class="string">&#x27;550548242323&#x27;</span>, <span class="comment">// 商品id  </span></span><br><span class="line">        couponsUrl: <span class="string">&#x27;优惠券地址&#x27;</span> <span class="comment">// 优惠券地址</span></span><br><span class="line">     &#125;</span><br><span class="line">   onSuccess —— 成功时的回调，如用户进行购买，则返回&#123;<span class="string">&quot;successArr&quot;</span>:paySuccessOrders, <span class="string">&quot;failureArr&quot;</span>:payFailedOrders&#125;，Dictionary类型;如用户将商品加入购物车，则返回“您已经将商品添加到购物车了，赶快去购买吧”，String类型</span><br><span class="line">   onError —— 失败时的回调，返回失败原因，String类型</span><br><span class="line">使用方法：</span><br><span class="line">MyPlugin.toDetailPage(&#123;goodsId: <span class="string">&#x27;550548242323&#x27;</span>, pid: <span class="string">&#x27;mm_131641136_43126906_310380416&#x27;</span>, isCoupons: <span class="number">0</span>&#125;, function (success)&#123;&#125;,function (error)&#123;&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">toDetailPage</span><span class="params">(CordovaArgs args, CallbackContext callbackContext)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">params</span> <span class="operator">=</span> args.getJSONObject(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (params.has(<span class="string">&quot;isCoupons&quot;</span>) &amp;&amp; params.getInt(<span class="string">&quot;isCoupons&quot;</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">couponsUrl</span> <span class="operator">=</span> params.has(<span class="string">&quot;couponsUrl&quot;</span>) ? params.getString(<span class="string">&quot;couponsUrl&quot;</span>) : <span class="string">&quot;&quot;</span>;</span><br><span class="line">            Baichuan.showDetailPageWithUrl(mContext, couponsUrl, callbackContext);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">pid</span> <span class="operator">=</span> params.has(<span class="string">&quot;pid&quot;</span>) ? params.getString(<span class="string">&quot;pid&quot;</span>) : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(pid)) &#123;</span><br><span class="line">            callbackContext.error(<span class="string">&quot;获取PID参数失败&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// use goodsId and pid</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> params.has(<span class="string">&quot;goodsId&quot;</span>) ? params.getString(<span class="string">&quot;goodsId&quot;</span>) : <span class="string">&quot;&quot;</span>;</span><br><span class="line">        Baichuan.showDetailPage(mContext, id, pid, callbackContext);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (JSONException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        callbackContext.error(<span class="string">&quot;获取参数失败：&quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Tv开发</title>
    <url>/android/tv/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/training/tv/start/">https://developer.android.com/training/tv/start/</a><br><a href="https://developer.android.com/training/tv/playback/">https://developer.android.com/training/tv/playback/</a></p>
<p><a href="https://designguidelines.withgoogle.com/android-tv/android-tv/introduction.html#">https://designguidelines.withgoogle.com/android-tv/android-tv/introduction.html#</a></p>
<p><a href="https://developer.nvidia.com/android-tv-deployment-checklist">https://developer.nvidia.com/android-tv-deployment-checklist</a></p>
<p><a href="http://corochann.com/android-tv-application-hands-on-tutorial-1-45.html">http://corochann.com/android-tv-application-hands-on-tutorial-1-45.html</a><br><a href="https://github.com/corochann/AndroidTVappTutorial">https://github.com/corochann/AndroidTVappTutorial</a></p>
<h2 id="tvheadend"><a href="#tvheadend" class="headerlink" title="tvheadend"></a>tvheadend</h2><p>web: <a href="https://tvheadend.org/">https://tvheadend.org/</a><br>github: <a href="https://github.com/tvheadend/tvheadend">https://github.com/tvheadend/tvheadend</a><br>tv: <a href="https://www.youtube.com/watch?v=rDQyHFZ-l9Y">https://www.youtube.com/watch?v=rDQyHFZ-l9Y</a><br>android: <a href="https://github.com/rsiebert/TVHClient">https://github.com/rsiebert/TVHClient</a></p>
<h3 id="tool"><a href="#tool" class="headerlink" title="tool"></a>tool</h3><p><a href="https://android-developers.googleblog.com/2016/11/adding-tv-channels-to-your-app-with-the-tif-companion-library.html">https://android-developers.googleblog.com/2016/11/adding-tv-channels-to-your-app-with-the-tif-companion-library.html</a></p>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>RecyclerView相关</title>
    <url>/android/view-recyclerview/</url>
    <content><![CDATA[<h2 id="RecyclerView"><a href="#RecyclerView" class="headerlink" title="RecyclerView"></a>RecyclerView</h2><ul>
<li>针对多种类型的情况，可以创建多个 <code>ViewHolder</code>和设置多个 <code>type</code></li>
</ul>
<h3 id="分页加载（加载更多）"><a href="#分页加载（加载更多）" class="headerlink" title="分页加载（加载更多）"></a>分页加载（加载更多）</h3><blockquote>
<p><a href="https://github.com/lyloou/lou/blob/demo/test/src/main/java/com/lyloou/test/gank/GankWelfareActivity.java">https://github.com/lyloou/lou/blob/demo/test/src/main/java/com/lyloou/test/gank/GankWelfareActivity.java</a></p>
</blockquote>
<blockquote>
<p><a href="http://www.gadgetsaint.com/android/recyclerview-header-footer-pagination/#.WRwxJGh96Hs">http://www.gadgetsaint.com/android/recyclerview-header-footer-pagination/#.WRwxJGh96Hs</a></p>
</blockquote>
<p><em>方案一：</em></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mRecyclerView.addOnScrollListener(<span class="keyword">new</span> <span class="title class_">RecyclerView</span>.OnScrollListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onScrollStateChanged</span><span class="params">(RecyclerView recyclerView, <span class="type">int</span> newState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onScrollStateChanged(recyclerView, newState);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">lastvisibleitemposition</span> <span class="operator">=</span> mLayoutManager.findLastVisibleItemPosition();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (lastvisibleitemposition == mAdapter.getItemCount() - <span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!loading &amp;&amp; !isLastPage) &#123;</span><br><span class="line"></span><br><span class="line">                loading = <span class="literal">true</span>;</span><br><span class="line">                fetchData((++pageCount));</span><br><span class="line">                <span class="comment">// Increment the pagecount everytime we scroll to fetch data from the next page</span></span><br><span class="line">                <span class="comment">// make loading = false once the data is loaded</span></span><br><span class="line">                <span class="comment">// call mAdapter.notifyDataSetChanged() to refresh the Adapter and Layout</span></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><em>方案二：</em></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// http://www.jianshu.com/p/4feb0c16d1b5</span></span><br><span class="line"><span class="keyword">private</span> RecyclerView.<span class="type">OnScrollListener</span> <span class="variable">mListener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RecyclerView</span>.OnScrollListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onScrollStateChanged</span><span class="params">(RecyclerView recyclerView, <span class="type">int</span> newState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onScrollStateChanged(recyclerView, newState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onScrolled</span><span class="params">(RecyclerView recyclerView, <span class="type">int</span> dx, <span class="type">int</span> dy)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onScrolled(recyclerView, dx, dy);</span><br><span class="line"></span><br><span class="line">        <span class="type">LinearLayoutManager</span> <span class="variable">layoutManager</span> <span class="operator">=</span> (LinearLayoutManager) recyclerView.getLayoutManager();</span><br><span class="line">        <span class="type">int</span> <span class="variable">lastVisibleItem</span> <span class="operator">=</span> layoutManager.findLastVisibleItemPosition();</span><br><span class="line">        <span class="type">int</span> <span class="variable">totalItemCount</span> <span class="operator">=</span> layoutManager.getItemCount();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (totalItemCount &lt; <span class="number">250</span> &amp;&amp; lastVisibleItem &gt;= totalItemCount - <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="comment">// 注意：要限制请求，否则请求太多次数，导致服务器崩溃或者服务器拒绝请求（罪过，罪过）。</span></span><br><span class="line">            <span class="keyword">if</span> (mIsLoading) &#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;onScrolled: &quot;</span> + <span class="string">&quot;加载中---------&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;onScrolled: &quot;</span> + <span class="string">&quot;加载更多了=======》&quot;</span>);</span><br><span class="line">                loadSubject();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Log.d(TAG, <span class="string">&quot;onScrolled: lastVisibleItem=&quot;</span> + lastVisibleItem);</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;onScrolled: totalItemCount=&quot;</span> + totalItemCount);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="加载更多调用-notifyDataSetChanged-时会白一下屏"><a href="#加载更多调用-notifyDataSetChanged-时会白一下屏" class="headerlink" title="加载更多调用 notifyDataSetChanged 时会白一下屏"></a>加载更多调用 notifyDataSetChanged 时会白一下屏</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getDataListFromNet(++page, dataList-&gt;&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">lastSize</span> <span class="operator">=</span> mAdapter.getList().size();</span><br><span class="line">    mAdapter.getList().addAll(dataList);</span><br><span class="line">    <span class="comment">// mAdapter.notifyDataSetChanged(); // 调用这个方法会白屏，可以用下面的方式解决</span></span><br><span class="line">    mAdapter.notifyItemRangeInserted(lastSize - <span class="number">1</span>, dataList.size());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="GridLayoutManager-均分两列的装饰器-ItemDecoration"><a href="#GridLayoutManager-均分两列的装饰器-ItemDecoration" class="headerlink" title="GridLayoutManager 均分两列的装饰器 ItemDecoration"></a>GridLayoutManager 均分两列的装饰器 ItemDecoration</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoubleItemOffsetDecoration</span> <span class="keyword">extends</span> <span class="title class_">RecyclerView</span>.ItemDecoration &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> offset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DoubleItemOffsetDecoration</span><span class="params">(<span class="type">int</span> offset)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.offset = offset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getItemOffsets</span><span class="params">(Rect outRect, View view, RecyclerView parent, RecyclerView.State state)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> parent.getChildLayoutPosition(view);</span><br><span class="line">        <span class="keyword">if</span> (position == <span class="number">0</span> || position == <span class="number">1</span>) &#123;</span><br><span class="line">            outRect.top = offset;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        outRect.bottom = offset;</span><br><span class="line">        <span class="keyword">if</span> (position % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">            outRect.left = offset / <span class="number">2</span>;</span><br><span class="line">            outRect.right = offset;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            outRect.left = offset;</span><br><span class="line">            outRect.right = offset / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Tab悬浮效果实现</title>
    <url>/android/view-tab%E6%82%AC%E6%B5%AE/</url>
    <content><![CDATA[<h2 id="tab悬浮效果实现"><a href="#tab悬浮效果实现" class="headerlink" title="tab悬浮效果实现"></a>tab悬浮效果实现</h2><p>一种解决方式是使用开源库（如果布局嵌套很复杂，则不一定适合）：<a href="https://github.com/carlonzo/StikkyHeader">https://github.com/carlonzo/StikkyHeader</a></p>
<p>另一种解决思路：</p>
<ul>
<li><p>在布局中，使用一个同tab1完全一样的tab2（并设置显示属性为gone）；</p>
</li>
<li><p>获取 tab1 到外层父视图顶部的距离（通过<code>tab1.getTop()</code>获取）；</p>
</li>
<li><p>当滚动的距离超过这个距离时，让外层的tab2显示出来，否则隐藏tab2；（即：<code>(scrollY - tab1.getTop()) &gt; 0</code>）</p>
</li>
<li><p>tab1 和 tab2 在逻辑上做相同的变化；</p>
  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ScrollTabView</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">        &lt;...&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">tab1</span>&gt;</span></span><br><span class="line">        &lt;...&gt;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ScrollTabView</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tab2</span> <span class="attr">visibility</span>=<span class="string">&quot;gone&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 重写ScrollView</span></span><br><span class="line"><span class="comment">// 参考资料：http://www.jianshu.com/p/8ee4b0896b22</span></span><br><span class="line"><span class="comment">// https://github.com/aohanyao/Advanced/blob/master/code/CustomView/ScollTabView/app/src/main/java/aohanyao/com/scolltabview/ScrollLevitateTabView.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScrollTabView</span> <span class="keyword">extends</span> <span class="title class_">ScrollView</span> &#123;</span><br><span class="line">    OnScrollListener mOnScrollListener;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ScrollTabView</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(context, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ScrollTabView</span><span class="params">(Context context, AttributeSet attrs)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ScrollTabView</span><span class="params">(Context context, AttributeSet attrs, <span class="type">int</span> defStyleAttr)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        setUp();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOnScrollListener</span><span class="params">(OnScrollListener onScrollListener)</span> &#123;</span><br><span class="line">        mOnScrollListener = onScrollListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mOnScrollListener == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        getViewTreeObserver().addOnGlobalLayoutListener(<span class="keyword">new</span> <span class="title class_">ViewTreeObserver</span>.OnGlobalLayoutListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onGlobalLayout</span><span class="params">()</span> &#123;</span><br><span class="line">                mOnScrollListener.onScroll(getScrollY());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onScrollChanged</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> t, <span class="type">int</span> oldl, <span class="type">int</span> oldt)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mOnScrollListener != <span class="literal">null</span>) &#123;</span><br><span class="line">            mOnScrollListener.onScroll(t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">super</span>.onScrollChanged(l, t, oldl, oldt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OnScrollListener</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">onScroll</span><span class="params">(<span class="type">int</span> scrollY)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运用</span></span><br><span class="line"><span class="type">ScrollTabView</span> <span class="variable">scrollTabView</span> <span class="operator">=</span> (ScrollTabView) mView.findViewById(R.id.scroll_tab_view);</span><br><span class="line">scrollTabView.setOnScrollListener(<span class="keyword">new</span> <span class="title class_">ScrollTabView</span>.OnScrollListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onScroll</span><span class="params">(<span class="type">int</span> scrollY)</span> &#123;</span><br><span class="line">        <span class="comment">// ScrollView的高度变化决定了tab2的显示与否</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">deltaY</span> <span class="operator">=</span> scrollY - tab1.getTop();</span><br><span class="line">        tab2.setVisibility(deltaY &gt; <span class="number">0</span> ? View.VISIBLE : View.GONE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Toolbar相关</title>
    <url>/android/view-toolbar/</url>
    <content><![CDATA[<h2 id="设置状态栏透明，并保持住-toolbar-在status之下（支持-API-19-以上）："><a href="#设置状态栏透明，并保持住-toolbar-在status之下（支持-API-19-以上）：" class="headerlink" title="设置状态栏透明，并保持住 toolbar 在status之下（支持 API 19 以上）："></a>设置状态栏透明，并保持住 toolbar 在status之下（支持 API 19 以上）：</h2><ol>
<li>添加到 theme： <code>&lt;item name=&quot;android:windowTranslucentStatus&quot;&gt;true&lt;/item&gt;</code></li>
<li>使 toolbar 的 marginTop 正好等于 statusHeight： <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setToolbarMarginTop</span><span class="params">(Activity activity, Toolbar toolbar)</span>&#123;</span><br><span class="line">   ViewGroup.<span class="type">MarginLayoutParams</span> <span class="variable">params</span> <span class="operator">=</span> (ViewGroup.MarginLayoutParams) toolbar.getLayoutParams();</span><br><span class="line">   params.topMargin = getStatusBarHeight(activity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getStatusBarHeight</span><span class="params">(Activity activity)</span>&#123;</span><br><span class="line">   <span class="type">int</span> <span class="variable">resourceId</span> <span class="operator">=</span> activity.getResources().getIdentifier(<span class="string">&quot;status_bar_height&quot;</span>, <span class="string">&quot;dimen&quot;</span>, <span class="string">&quot;android&quot;</span>);</span><br><span class="line">   <span class="type">int</span> <span class="variable">statusBarHeight</span> <span class="operator">=</span> activity.getResources().getDimensionPixelSize(resourceId);</span><br><span class="line">   <span class="keyword">return</span> statusBarHeight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Webview相关</title>
    <url>/android/view-webview/</url>
    <content><![CDATA[<h1 id="Android-7-0-webview-不自动刷新"><a href="#Android-7-0-webview-不自动刷新" class="headerlink" title="Android 7.0 webview 不自动刷新"></a>Android 7.0 webview 不自动刷新</h1><p>当 webview 所在的 activity 采用了以下主题时，Android7.0 设备将无法正常运行：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;WelcomeBg&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;@android:style/Theme.DeviceDefault.NoActionBar&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowIsTranslucent&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowNoTitle&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowActionBar&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowBackground&quot;</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>之所以有这样的改变，目的是想要提升启动 Activity 的性能，哪里知道 7.0 之后会遇到无法正常渲染 WebView 的问题。</p>
<p>解决办法是：<br>直接使用默认主题，而不再对其包装：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">@android:style/Theme.DeviceDefault.NoActionBar</span><br></pre></td></tr></table></figure>

<h1 id="获取-WebView-的点击元素"><a href="#获取-WebView-的点击元素" class="headerlink" title="获取 WebView 的点击元素"></a>获取 WebView 的点击元素</h1><p>可以通过搜索关键字：<code>HitTestResult getHitTestResult</code>来知道更多内容；</p>
<p>注意：X5WebView，来源于腾讯 TBS 系统，是另外一个继承体系（可以通过打印<code>view.getClass()</code>的方式查看其继承体系）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setLongClick</span><span class="params">(<span class="keyword">final</span> View view)</span> &#123;</span><br><span class="line">    <span class="comment">//长按点击事件</span></span><br><span class="line">    view.setOnLongClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnLongClickListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onLongClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">            <span class="comment">//响应长按事件（如果webview继承自安卓原生系统）</span></span><br><span class="line">            <span class="keyword">if</span> (view <span class="keyword">instanceof</span> WebView) &#123;</span><br><span class="line">                WebView.<span class="type">HitTestResult</span> <span class="variable">result</span> <span class="operator">=</span> ((WebView) view).getHitTestResult();</span><br><span class="line">                <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">type</span> <span class="operator">=</span> result.getType();</span><br><span class="line">                    <span class="comment">//判断点击类型如果是图片</span></span><br><span class="line">                    <span class="keyword">if</span> (type == WebView.HitTestResult.IMAGE_TYPE || type == WebView.HitTestResult.SRC_IMAGE_ANCHOR_TYPE) &#123;</span><br><span class="line">                        <span class="comment">//弹出对话框</span></span><br><span class="line">                        showDialog(result.getExtra());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (view <span class="keyword">instanceof</span> X5WebView) &#123;</span><br><span class="line">                <span class="comment">//响应长按事件（如果webview继承自腾讯的TBS系统）</span></span><br><span class="line">                Log.i(TAG, <span class="string">&quot;onLongClick: x5&quot;</span>);</span><br><span class="line">                com.tencent.smtt.sdk.WebView.<span class="type">HitTestResult</span> <span class="variable">hitTestResult</span> <span class="operator">=</span> ((X5WebView) view).getHitTestResult();</span><br><span class="line">                <span class="keyword">if</span> (hitTestResult != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">type</span> <span class="operator">=</span> hitTestResult.getType();</span><br><span class="line">                    <span class="keyword">if</span> (type == X5WebView.HitTestResult.IMAGE_TYPE || type == X5WebView.HitTestResult.SRC_IMAGE_ANCHOR_TYPE) &#123;</span><br><span class="line">                        showDialog(hitTestResult.getExtra());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>参考资料</strong></p>
<ul>
<li><a href="http://www.cnblogs.com/classloader/p/5302784.html">获取 Android webview 的点击元素</a></li>
<li><a href="https://developer.android.com/reference/android/webkit/WebView.HitTestResult.html">HitTestResult</a></li>
</ul>
<h1 id="需要登录网页授权的页面处理"><a href="#需要登录网页授权的页面处理" class="headerlink" title="需要登录网页授权的页面处理"></a>需要登录网页授权的页面处理</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">webSettings.setLayoutAlgorithm(WebSettings.LayoutAlgorithm.NARROW_COLUMNS);</span><br><span class="line">webSettings.setUseWideViewPort(<span class="literal">true</span>);</span><br><span class="line">webSettings.setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line">webSettings.setDomStorageEnabled(<span class="literal">true</span>);</span><br><span class="line">webSettings.setLoadWithOverviewMode(<span class="literal">true</span>);</span><br><span class="line">webview.setWebViewClient(getWebViewClient());</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> WebViewClient <span class="title function_">getWebViewClient</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebViewClient</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceivedHttpAuthRequest</span><span class="params">(WebView view, HttpAuthHandler handler, String host, String realm)</span> &#123;</span><br><span class="line">            <span class="comment">// [Android-WebView&#x27;s onReceivedHttpAuthRequest() not called again - Stack Overflow](https://stackoverflow.com/questions/20399339/android-webviews-onreceivedhttpauthrequest-not-called-again)</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">EditText</span> <span class="variable">usernameInput</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EditText</span>(mContext);</span><br><span class="line">            usernameInput.setHint(<span class="string">&quot;Username&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> <span class="type">EditText</span> <span class="variable">passwordInput</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EditText</span>(mContext);</span><br><span class="line">            passwordInput.setHint(<span class="string">&quot;Password&quot;</span>);</span><br><span class="line">            passwordInput.setInputType(InputType.TYPE_CLASS_TEXT | InputType.TYPE_TEXT_VARIATION_PASSWORD);</span><br><span class="line"></span><br><span class="line">            <span class="type">LinearLayout</span> <span class="variable">ll</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinearLayout</span>(mContext);</span><br><span class="line">            ll.setOrientation(LinearLayout.VERTICAL);</span><br><span class="line">            ll.addView(usernameInput);</span><br><span class="line">            ll.addView(passwordInput);</span><br><span class="line"></span><br><span class="line">            AlertDialog.<span class="type">Builder</span> <span class="variable">authDialog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlertDialog</span></span><br><span class="line">                    .Builder(mContext)</span><br><span class="line">                    .setTitle(<span class="string">&quot;Authentication&quot;</span>)</span><br><span class="line">                    .setView(ll)</span><br><span class="line">                    .setCancelable(<span class="literal">false</span>)</span><br><span class="line">                    .setPositiveButton(<span class="string">&quot;OK&quot;</span>, (dialog, whichButton) -&gt; &#123;</span><br><span class="line">                        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> usernameInput.getText().toString();</span><br><span class="line">                        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> passwordInput.getText().toString();</span><br><span class="line">                        handler.proceed(username, password);</span><br><span class="line">                        Toast.makeText(mContext, username + <span class="string">&quot;:&quot;</span> + password, Toast.LENGTH_LONG).show();</span><br><span class="line">                        dialog.dismiss();</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .setNegativeButton(<span class="string">&quot;Cancel&quot;</span>, (dialog, whichButton) -&gt; &#123;</span><br><span class="line">                        dialog.dismiss();</span><br><span class="line">                        view.stopLoading();</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">            authDialog.show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android中巧用官方自带View</title>
    <url>/android/view/</url>
    <content><![CDATA[<h2 id="TextView"><a href="#TextView" class="headerlink" title="TextView"></a>TextView</h2><h3 id="字符串资源里的变量替换"><a href="#字符串资源里的变量替换" class="headerlink" title="字符串资源里的变量替换"></a>字符串资源里的变量替换</h3><p>在 xml 中定位占位符（其中<code>1</code>表示第一个变量，多个变量递增表示）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- values/strings.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;replace_str&quot;</span>&gt;</span>你好，%1$s：欢迎您！<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>java 代码中动态指定<code>%1$s</code>处的值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> getString(R.string.replace_str, <span class="string">&quot;小明&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="使用-HTML-格式化文本"><a href="#使用-HTML-格式化文本" class="headerlink" title="使用 HTML 格式化文本"></a>使用 HTML 格式化文本</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">textView.setText(Html.fromHtml(HTML_STR));</span><br></pre></td></tr></table></figure>

<h3 id="跑马灯效果不生效"><a href="#跑马灯效果不生效" class="headerlink" title="跑马灯效果不生效"></a>跑马灯效果不生效</h3><p>需要在代码中设置<code>tv.setSelected(true)</code></p>
<blockquote>
<p><a href="http://stackoverflow.com/questions/3332924/textview-marquee-not-working">TextView Marquee not working</a></p>
</blockquote>
<h3 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="http://blog.csdn.net/sdkfjksf/article/details/51317204">TextView 实战之你真的懂我么？</a></li>
</ul>
<h2 id="TextView-设置空格"><a href="#TextView-设置空格" class="headerlink" title="TextView 设置空格"></a>TextView 设置空格</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="symbol">&amp;#160;</span><span class="symbol">&amp;#160;</span><span class="symbol">&amp;#160;</span><span class="symbol">&amp;#8201;</span><span class="symbol">&amp;#160;</span><span class="symbol">&amp;#160;</span><span class="symbol">&amp;#8201;</span></span><br></pre></td></tr></table></figure>

<h3 id="TextView-html-渲染（注意：html-渲染的方式无法改变字体的大小，可以调整颜色、粗细、斜体等属性）"><a href="#TextView-html-渲染（注意：html-渲染的方式无法改变字体的大小，可以调整颜色、粗细、斜体等属性）" class="headerlink" title="TextView html 渲染（注意：html 渲染的方式无法改变字体的大小，可以调整颜色、粗细、斜体等属性）"></a>TextView html 渲染（注意：html 渲染的方式无法改变字体的大小，可以调整颜色、粗细、斜体等属性）</h3><pre><code><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">renderWithHtml</span><span class="params">(<span class="keyword">final</span> TextView tv, String data)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">        tv.setText(Html.fromHtml(data, Html.FROM_HTML_MODE_COMPACT));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        tv.setText(Html.fromHtml(data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
<h2 id="TextView-渲染字体"><a href="#TextView-渲染字体" class="headerlink" title="TextView 渲染字体"></a>TextView 渲染字体</h2><blockquote>
<p><a href="http://www.jianshu.com/p/2671e78089f9">Android TextView 个别字体格式设置小结 - 简书</a></p>
</blockquote>
<pre><code><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">SpannableString</span> <span class="variable">msp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpannableString</span>(<span class="string">&quot;字体测试字体大小一半两倍前景色背景色正常粗体斜体粗斜体下划线删除线x1x2电话邮件网站短信彩信地图X轴综合&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置字体(default,default-bold,monospace,serif,sans-serif)</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">TypefaceSpan</span>(<span class="string">&quot;monospace&quot;</span>), <span class="number">0</span>, <span class="number">2</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">TypefaceSpan</span>(<span class="string">&quot;serif&quot;</span>), <span class="number">2</span>, <span class="number">4</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置字体大小（绝对值,单位：像素）</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">AbsoluteSizeSpan</span>(<span class="number">20</span>), <span class="number">4</span>, <span class="number">6</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">AbsoluteSizeSpan</span>(<span class="number">20</span>, <span class="literal">true</span>), <span class="number">6</span>, <span class="number">8</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//第二个参数boolean dip，如果为true，表示前面的字体大小单位为dip，否则为像素，同上。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置字体大小（相对值,单位：像素） 参数表示为默认字体大小的多少倍</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">RelativeSizeSpan</span>(<span class="number">0.5f</span>), <span class="number">8</span>, <span class="number">10</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//0.5f表示默认字体大小的一半</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">RelativeSizeSpan</span>(<span class="number">2.0f</span>), <span class="number">10</span>, <span class="number">12</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//2.0f表示默认字体大小的两倍</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置字体前景色</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">ForegroundColorSpan</span>(Color.MAGENTA), <span class="number">12</span>, <span class="number">15</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//设置前景色为洋红色</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置字体背景色</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">BackgroundColorSpan</span>(Color.CYAN), <span class="number">15</span>, <span class="number">18</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//设置背景色为青色</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置字体样式正常，粗体，斜体，粗斜体</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">StyleSpan</span>(android.graphics.Typeface.NORMAL), <span class="number">18</span>, <span class="number">20</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//正常</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">StyleSpan</span>(android.graphics.Typeface.BOLD), <span class="number">20</span>, <span class="number">22</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//粗体</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">StyleSpan</span>(android.graphics.Typeface.ITALIC), <span class="number">22</span>, <span class="number">24</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//斜体</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">StyleSpan</span>(android.graphics.Typeface.BOLD_ITALIC), <span class="number">24</span>, <span class="number">27</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//粗斜体</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置下划线</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">UnderlineSpan</span>(), <span class="number">27</span>, <span class="number">30</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置删除线</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">StrikethroughSpan</span>(), <span class="number">30</span>, <span class="number">33</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置上下标</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">SubscriptSpan</span>(), <span class="number">34</span>, <span class="number">35</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//下标</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">SuperscriptSpan</span>(), <span class="number">36</span>, <span class="number">37</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);   <span class="comment">//上标</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//超级链接（需要添加setMovementMethod方法附加响应）</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">URLSpan</span>(<span class="string">&quot;tel:4155551212&quot;</span>), <span class="number">37</span>, <span class="number">39</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//电话</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">URLSpan</span>(<span class="string">&quot;mailto:webmaster@google.com&quot;</span>), <span class="number">39</span>, <span class="number">41</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//邮件</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">URLSpan</span>(<span class="string">&quot;http://www.baidu.com&quot;</span>), <span class="number">41</span>, <span class="number">43</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//网络</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">URLSpan</span>(<span class="string">&quot;sms:4155551212&quot;</span>), <span class="number">43</span>, <span class="number">45</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//短信   使用sms:或者smsto:</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">URLSpan</span>(<span class="string">&quot;mms:4155551212&quot;</span>), <span class="number">45</span>, <span class="number">47</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//彩信   使用mms:或者mmsto:</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">URLSpan</span>(<span class="string">&quot;geo:38.899533,-77.036476&quot;</span>), <span class="number">47</span>, <span class="number">49</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//地图</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置字体大小（相对值,单位：像素） 参数表示为默认字体宽度的多少倍</span></span><br><span class="line">msp.setSpan(<span class="keyword">new</span> <span class="title class_">ScaleXSpan</span>(<span class="number">2.0f</span>), <span class="number">49</span>, <span class="number">51</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">//2.0f表示默认字体宽度的两倍，即X轴方向放大为默认字体的两倍，而高度不变</span></span><br><span class="line"><span class="comment">//SpannableString对象设置给TextView</span></span><br><span class="line">tokenTv.setText(msp);</span><br><span class="line"><span class="comment">//设置TextView可点击</span></span><br><span class="line">tokenTv.setMovementMethod(LinkMovementMethod.getInstance());</span><br></pre></td></tr></table></figure>
</code></pre>
<h3 id="Android-开发，你遇上-Emoji-头疼吗？-掘金"><a href="#Android-开发，你遇上-Emoji-头疼吗？-掘金" class="headerlink" title="Android 开发，你遇上 Emoji 头疼吗？ - 掘金"></a><a href="https://juejin.im/post/5a45b38451882512d823076a">Android 开发，你遇上 Emoji 头疼吗？ - 掘金</a></h3><h2 id="ImageView"><a href="#ImageView" class="headerlink" title="ImageView"></a>ImageView</h2><h3 id="交叉使用-mipmap-和-drawable"><a href="#交叉使用-mipmap-和-drawable" class="headerlink" title="交叉使用 mipmap 和 drawable"></a>交叉使用 mipmap 和 drawable</h3><p>钻牛角尖：先必须获取到之前的 Drawable，然后将这个 Drawable 进行转换，然后进行图片替换；<br>解决思路：通过覆盖的单向方式，而不用知道之前是图片资源还是 Drawable 资源。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ImageView</span> <span class="variable">ivMain</span> <span class="operator">=</span> findViewById(R.id.iv_main);</span><br><span class="line"><span class="keyword">if</span>(满足条件)&#123;</span><br><span class="line">  ivMain.setBackgroundResource(R.id.selected);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  ivMain.setBackgroundResource(R.id.unselected);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ImageView-加载-GIF-图片"><a href="#ImageView-加载-GIF-图片" class="headerlink" title="ImageView 加载 GIF 图片"></a>ImageView 加载 GIF 图片</h3><p>代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ImageView</span> <span class="variable">iv</span> <span class="operator">=</span> (ImageView) findViewById(R.id.vp_iv);</span><br><span class="line">Glide</span><br><span class="line">  .with(<span class="built_in">this</span>)</span><br><span class="line">  .load(<span class="string">&quot;https://i.imgur.com/l9lffwf.gif&quot;</span>)</span><br><span class="line">  .into(iv);</span><br></pre></td></tr></table></figure>

<p>外部链接</p>
<ul>
<li><a href="https://github.com/bumptech/glide">Glide</a></li>
</ul>
<h3 id="加载网络图片"><a href="#加载网络图片" class="headerlink" title="加载网络图片"></a>加载网络图片</h3><p>代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Picasso</span><br><span class="line">  .with(<span class="built_in">this</span>)</span><br><span class="line">  .load(<span class="string">&quot;https://i.imgur.com/l9lffwf.gif&quot;</span>)</span><br><span class="line">  .placeholder(R.mipmap.ic_launcher)</span><br><span class="line">  .into(iv);</span><br></pre></td></tr></table></figure>

<p>外部链接</p>
<ul>
<li><a href="https://github.com/square/picasso">Picasso</a></li>
</ul>
<hr>
<h2 id="EditText"><a href="#EditText" class="headerlink" title="EditText"></a>EditText</h2><h3 id="定位光标位置："><a href="#定位光标位置：" class="headerlink" title="定位光标位置："></a>定位光标位置：</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;Lou&quot;</span>;</span><br><span class="line"><span class="type">EditText</span> <span class="variable">et</span> <span class="operator">=</span> (EditText)findViewById(R.id.et_name);</span><br><span class="line">et.setSelection(name.length()); <span class="comment">// 将光标至于文字最后</span></span><br></pre></td></tr></table></figure>

<h3 id="使光标颜色和文字颜色保持一致（EditText-不显示光标问题）："><a href="#使光标颜色和文字颜色保持一致（EditText-不显示光标问题）：" class="headerlink" title="使光标颜色和文字颜色保持一致（EditText 不显示光标问题）："></a>使光标颜色和文字颜色保持一致（EditText 不显示光标问题）：</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 有的时候发现EditText里的光标无法显示的问题，很可能是光标的颜色和背景重合了，可以通过设置光标的颜色属性来让其显示 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在EditText标签中添加如下属性 --&gt;</span></span><br><span class="line">android:textCursorDrawable=&quot;@null&quot;</span><br></pre></td></tr></table></figure>

<h3 id="外部链接-1"><a href="#外部链接-1" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2013/0216/858.html">修改 EditText 的光标颜色</a></li>
<li><a href="http://stackoverflow.com/questions/7238450/set-edittext-cursor-color">Set EditText cursor color</a></li>
</ul>
<hr>
<h2 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h2><p>ListView 中不可见的元素，其对应的 view 为 null。这是容易理解的，性能优化。<br>（在 updateItem 的时候要做两方面的处理，即数据(updateItemData)和视图(updateItemView)）</p>
<h3 id="添加空白"><a href="#添加空白" class="headerlink" title="添加空白"></a>添加空白</h3><ul>
<li>在 ListView 的顶部和底部添加空白（见外部链接）</li>
<li>在 Item 之间添加空白（通过 Divider 的方式）</li>
</ul>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;@color/alarm_bg&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/lv_main&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:paddingTop</span>=<span class="string">&quot;16dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:paddingBottom</span>=<span class="string">&quot;16dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:clipToPadding</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:scrollbars</span>=<span class="string">&quot;none&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:divider</span>=<span class="string">&quot;@android:color/transparent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:dividerHeight</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="外部链接-2"><a href="#外部链接-2" class="headerlink" title="外部链接"></a>外部链接</h4><ul>
<li><a href="http://stackoverflow.com/questions/6288167/add-margin-above-top-listview-item-and-below-last-in-android">Add margin above top ListView item (and below last) in Android</a></li>
<li><a href="http://stackoverflow.com/questions/4984313/spacing-between-listview-items-android">Spacing between listView Items Android</a></li>
</ul>
<hr>
<h2 id="修改-DatePicker-日期选择器默认样式（同理适用于-TimePicker）"><a href="#修改-DatePicker-日期选择器默认样式（同理适用于-TimePicker）" class="headerlink" title="修改 DatePicker 日期选择器默认样式（同理适用于 TimePicker）"></a>修改 DatePicker 日期选择器默认样式（同理适用于 TimePicker）</h2><h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h3><p><img src="https://github.com/lyloou/img/raw/develop/z/date_picker.jpg" alt="DatePicker"></p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用Holo样式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">DatePicker</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/dialog_personal_birth_dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;@android:style/Widget.Holo.DatePicker&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">mBirth</span> <span class="operator">=</span> <span class="string">&quot;1981.12.11&quot;</span>;</span><br><span class="line"><span class="keyword">final</span> <span class="type">DatePicker</span> <span class="variable">dp</span> <span class="operator">=</span> dialogBirth.getView(R.id.dialog_personal_birth_dp);</span><br><span class="line">dp.setCalendarViewShown(<span class="literal">false</span>); <span class="comment">// 不要显示Calendar视图</span></span><br><span class="line">Uview.changeTimePickerSepColor(dp, Color.DKGRAY); <span class="comment">// 修改分割线样式</span></span><br><span class="line">String[] birth = mBirth.split(<span class="string">&quot;\\.&quot;</span>);</span><br><span class="line">dp.init(Integer.parseInt(birth[<span class="number">0</span>]),</span><br><span class="line">        Integer.parseInt(birth[<span class="number">1</span>]) - <span class="number">1</span>,</span><br><span class="line">        Integer.parseInt(birth[<span class="number">2</span>]),</span><br><span class="line">        <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//: Uview.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">changeTimePickerSepColor</span><span class="params">(ViewGroup group, <span class="type">int</span> color)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (NumberPicker np : getNumberPickers(group)) &#123;</span><br><span class="line">        changeNumberPickerSepColor(np, color);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;NumberPicker&gt; <span class="title function_">getNumberPickers</span><span class="params">(ViewGroup group)</span> &#123;</span><br><span class="line">    List&lt;NumberPicker&gt; lists = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;NumberPicker&gt;();</span><br><span class="line">    <span class="keyword">if</span> (group == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> lists;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; group.getChildCount(); i++) &#123;</span><br><span class="line">        <span class="type">View</span> <span class="variable">v</span> <span class="operator">=</span> group.getChildAt(i);</span><br><span class="line">        <span class="keyword">if</span> (v <span class="keyword">instanceof</span> NumberPicker) &#123;</span><br><span class="line">            lists.add((NumberPicker) v);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v <span class="keyword">instanceof</span> LinearLayout) &#123;</span><br><span class="line">            List&lt;NumberPicker&gt; ls = getNumberPickers((ViewGroup) v);</span><br><span class="line">            <span class="keyword">if</span> (ls.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> ls;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lists;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">changeNumberPickerSepColor</span><span class="params">(NumberPicker np, <span class="type">int</span> color)</span> &#123;</span><br><span class="line">    Field[] pickerFields = NumberPicker.class.getDeclaredFields();</span><br><span class="line">    <span class="keyword">for</span> (Field f : pickerFields) &#123;</span><br><span class="line">        <span class="keyword">if</span> (f.getName().equals(<span class="string">&quot;mSelectionDivider&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                f.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                f.set(np, <span class="keyword">new</span> <span class="title class_">ColorDrawable</span>(color));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分割线粗细</span></span><br><span class="line">    <span class="keyword">for</span> (Field f : pickerFields) &#123;</span><br><span class="line">        <span class="keyword">if</span> (f.getName().equals(<span class="string">&quot;mSelectionDividerHeight&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                f.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                f.set(np, <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="给-imageview-设置-tag-值来传值"><a href="#给-imageview-设置-tag-值来传值" class="headerlink" title="给 imageview 设置 tag 值来传值"></a>给 imageview 设置 tag 值来传值</h2><p>ivSetting.setTag(room.getId());<br>这样在进入设置界面时，可以通过 getTag 的方式获取到 room 的 id。</p>
<blockquote>
<p><a href="http://www.vogella.com/tutorials/Retrofit/article.html#create-activity">http://www.vogella.com/tutorials/Retrofit/article.html#create-activity</a></p>
</blockquote>
<h2 id="主题中使用-tint-会导致-imageview-显示空白"><a href="#主题中使用-tint-会导致-imageview-显示空白" class="headerlink" title="主题中使用 tint 会导致 imageview 显示空白"></a>主题中使用 tint 会导致 imageview 显示空白</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:tint&quot;</span>&gt;</span>#ffffff<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>《Android群英传》读书笔记</title>
    <url>/android/%E3%80%8AAndroid%E7%BE%A4%E8%8B%B1%E4%BC%A0%E3%80%8B%E7%AC%94%E8%AE%B0%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="《Android群英传》-笔记"><a href="#《Android群英传》-笔记" class="headerlink" title="《Android群英传》 笔记"></a>《Android群英传》 笔记</h2><p>| apk 安装路径： –p220(q1)</p>
<ul>
<li><code>/system/app</code> : 系统及别的 apk;</li>
<li><code>/data/app</code> : 用户安装的 apk;</li>
</ul>
<p>| android 管理器<br>  pm(package manager)： 主宰着应用的包管理；<br>  am(activity manager): 主宰着应用的活动管理； –p210(q1)</p>
<p>| 如果说系统信息好比是国家的 GDP， 那么 Apk 应用信息则像是对个人的经济普查。 –p210(q1)</p>
<p>| 一个 Task 中的 Activity 可以来自不同的 APP，<br>同一个 App 的  Activity 也可能不再一个 Task 中。 –p200(q1)</p>
<p>| 一个合理的任务调度栈不仅是性能的保证，更是提供性能的基础。 –p200(q1)</p>
<p>| 如果你得自定义 View 需要频繁刷新，或者刷新时数据处理量比较大，<br>那么就可以考虑使用 SurfaceView 来取代 View 了。 –p155(q1)</p>
<p>| canvas 的方法： –p118(q1)</p>
<ul>
<li>save(): 保存画布；作用是将之前的所有已绘制图像保存起来，让后续的操作就好像在新图层上操作一样;</li>
<li>restore(): 合并图层；作用是将 save 之后的和 save 之前的图像进行合并；</li>
<li>translate(): 坐标系的平移；</li>
<li>rotate(): 坐标系的翻转；</li>
</ul>
<p>| scrollTo、scrollBy 方法移动的是 View 的 content, 即让 View 的内容移动( content )，<br>如果在 ViewGroup 中使用 scrollTo、 scrollBy 方法，那么移动的将是所有子 View；<br>例如： TextView, content 就是它的文本; ImageView, content 就是它的 drawable. –p95(q1)</p>
<p>| 形象的事件处理机制： –p62(q1)</p>
<ul>
<li>事件的传递顺序：<br>  总经理(MyViewGroupA) –&gt; 部长(MyViewGroupB) –&gt; 你(View)。<br>  事件传递的时候，先执行 dispatchTouchEvent() 方法，再执行 onInterceptTouchEvent()<br>  方法（注意：View 没有 onInterceptTouchEvent方法，只有 ViewGroup 有这个方法）。</li>
<li>事件的处理顺序：<br>  你(View) –&gt; 部长(MyViewGroupB) –&gt; 总经理(MyViewGroupB)。<br>  事件处理都是执行 onTouchEvent() 方法。</li>
<li>事件传递的返回值： true, 拦截；false, 不拦截, 继续流程；    </li>
<li>事件处理的返回值： true, 处理了，不用审核； false, 给上级处理。</li>
<li>初始情况下，返回值都是 false。</li>
</ul>
<p>| 动态控制UI模板的方法：接口回调、提供 public 方法。 –p48(q1)</p>
<ul>
<li>接口回调<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Ilistener</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">click</span><span class="params">(View v)</span>;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">innerMethod</span><span class="params">(View v)</span> &#123;</span><br><span class="line">  mIlistener.click(v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明和初始化</span></span><br><span class="line">Ilistener mIlistener;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(Ilistener listener)</span>&#123;</span><br><span class="line">  mIlistener = listener;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>提供 public 方法<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> String mStr;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">publicMethod</span><span class="params">(String str)</span> &#123;</span><br><span class="line">  mStr = str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>| 解释 bitmap 和 Canvas  –p38(q1)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 装载画布：将 bitmap 装载到画布 canvas 上,</span></span><br><span class="line"><span class="comment">// 这个 bitmap 存储了所有绘制在 Canvas.drawXXX 方法的像素信息</span></span><br><span class="line"><span class="type">Canvas</span> <span class="variable">canvas</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Canvas</span>(bitmap);</span><br></pre></td></tr></table></figure>
<p>代码解释：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Canvas canvas;</span><br><span class="line">Bitmap bitmap1, bitmap2;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initBitmap</span><span class="params">()</span> &#123;</span><br><span class="line">  bitmap1 = <span class="keyword">new</span> <span class="title class_">Bitmap</span>(...);</span><br><span class="line">  bitmap2 = <span class="keyword">new</span> <span class="title class_">Bitmap</span>(...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initCanvas</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.canvas = <span class="keyword">new</span> <span class="title class_">Canvas</span>(bitmap2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onDraw</span><span class="params">(Canvas canvas)</span> &#123;</span><br><span class="line">  canvas.drawBitmap(bitmap1, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">  canvas.drawBitmap(bitmap2, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">changeBitmap2</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>| Canvas 就像一个画板，使用 Paint 就可以在上面作画了。 –p37(q1)</p>
<p>| 其实，Android 就好像那个蒙着眼睛画画的人，你必须精确地告诉它如何去画，<br>它才能绘出你想要的图形；–p34(q1)|</p>
<p>| Intent - Android上的信使，信息传递的载体；<br>–p5(q1)</p>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>《第一行代码》读书笔记</title>
    <url>/android/%E3%80%8A%E7%AC%AC%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81%E3%80%8B%E7%AC%94%E8%AE%B0%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="摘要："><a href="#摘要：" class="headerlink" title="摘要："></a>摘要：</h2><p>主要内容：<br>对书上的重点和难点内容进行总结和回顾；</p>
<p>任务列表：</p>
<ul>
<li><input checked disabled type="checkbox"> 优化文档结构(2016.05.26)</li>
</ul>
<h2 id="第二章"><a href="#第二章" class="headerlink" title="第二章"></a>第二章</h2><blockquote>
<p>每一次学习 ， 都会有新的收获；<br>我相信我看到的奇迹，没有是平白无故产生的，它们是源于环环相扣的逻辑巧妙组合而成。</p>
</blockquote>
<h3 id="隐藏标题栏（p35）"><a href="#隐藏标题栏（p35）" class="headerlink" title="隐藏标题栏（p35）"></a>隐藏标题栏（p35）</h3><p>在调用 setContentView（）之前，写上下面代码：<br><code>requestWindowFeature(Window.FEATURE_NO_TITLE);</code></p>
<p>========== 更新 2016.05.23 10:42:53 =============<br>也可以通过配置主题的方式应用到所有 Activity 中：<br>在<code>AppTheme</code>中添加：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowNoTitle&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowBackground&quot;</span>&gt;</span>@android:color/white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="隐式-Intent（p44）"><a href="#隐式-Intent（p44）" class="headerlink" title="隐式 Intent（p44）"></a>隐式 Intent（p44）</h3><p>隐式里的 category 和 data 就像是更精确的<code>过滤器</code></p>
<h3 id="保存临时数据-（p67）"><a href="#保存临时数据-（p67）" class="headerlink" title="保存临时数据 （p67）"></a>保存临时数据 （p67）</h3><p>当启动新的活动时，当前的活动数据如果不加以保存，那么就会有可能丢失掉数据（系统回收）。<br>这样的用户体验不好，可以通过在<code>onSaveInstanceState()</code>方法中保存数据来解决这个问题。（重要的数据还是在 onPause 中保存的好，在 onPause 中不要进行耗时操作）<br>相应的，在<code>onCreate(Bundle)</code>中进行恢复操作。</p>
<h3 id="活动启动模式（p68）"><a href="#活动启动模式（p68）" class="headerlink" title="活动启动模式（p68）"></a>活动启动模式（p68）</h3><p>使用方式：在 Manifest.xml 的对应 activity 中添加<code>android:launchMode=&quot;standard|singleTop|singleTask|singleInstance&quot;</code><br>参数说明：</p>
<ol>
<li>standard 模式：无论返回栈中是否存在该活动，每次启动都会创建一个新的实例（例如，自己启动自己，也会创建多个实例出来）</li>
<li>singleTop 模式：如果返回栈的栈顶是要启动的活动，则直接使用它，而不是再创建一个新的活动实例出来。</li>
<li>singleTask 模式：使该活动在整个应用程序的上下文中只存在一个实例，如果不在栈顶，则将该活动上面的所有活动出栈，如果没有该活动，则创建一个活动实例。</li>
<li>singleInstance 模式：指定为该模式的活动就启用新的返回栈来管理这个活动。（还不是很了解）</li>
</ol>
<h3 id="技巧："><a href="#技巧：" class="headerlink" title="技巧："></a>技巧：</h3><h4 id="进入某个界面在日志中打印对应的-Activity-的名称（方便定位）-（p77）："><a href="#进入某个界面在日志中打印对应的-Activity-的名称（方便定位）-（p77）：" class="headerlink" title="进入某个界面在日志中打印对应的 Activity 的名称（方便定位） （p77）："></a>进入某个界面在日志中打印对应的 Activity 的名称（方便定位） （p77）：</h4><p>原理： 简单来说是通过 java 的重写机制 。<br>具体步骤：</p>
<ol>
<li>创建一个基类 Activity，例如<code>BaseActivity</code>；</li>
<li>在基类 Activity 的 onCreate()方法中，添加代码<code>Log.d(&quot;BaseActivity&quot;, getClass().getSimpleName())</code></li>
</ol>
<h4 id="随时随地退出程序（p78）："><a href="#随时随地退出程序（p78）：" class="headerlink" title="随时随地退出程序（p78）："></a>随时随地退出程序（p78）：</h4><p>利用 List 作为保存 Activity 的容器：一旦有 Activity 被创建，就加入到容器中；对应的，一旦 Activity 被销毁，就从容器中移除 。在想要退出的地方，逐个结束容器中的 Activity. <code>activity.finish()</code><br>参考网址：<a href="http://book.51cto.com/art/201407/446022.htm"> 2.6.2 　随时随地退出程序 </a></p>
<h4 id="启动活动（p80）："><a href="#启动活动（p80）：" class="headerlink" title="启动活动（p80）："></a>启动活动（p80）：</h4><p>给 Activity 添加一个封装优美的，静态的，清晰的启动方法。<br>步骤：</p>
<ol>
<li>在 Activity 中定义一个静态的方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String mArg0;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Object mArg1;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">startActivity</span><span class="params">(Activity context, String arg0, Object arg1)</span>&#123;</span><br><span class="line">     mArg0 = arg0;</span><br><span class="line">     mArg1 = arg1;</span><br><span class="line">     context.startActivity( <span class="built_in">this</span>.getClass() );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在需要启动 SecondActivity 的地方调用：</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SecondActivity.startActivity(mContext, arg0, arg1);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="第三章"><a href="#第三章" class="headerlink" title="第三章"></a>第三章</h2><blockquote>
<p>从整体到局部，从构架到细节。</p>
</blockquote>
<h3 id="宽度，高度（p84）"><a href="#宽度，高度（p84）" class="headerlink" title="宽度，高度（p84）"></a>宽度，高度（p84）</h3><p>match_parent：表示让当前控件的大小和父控件的大小一样<br>fill_parent：match_parent 的别名<br>wrap_content：使当前控件的大小正好包含住控件的内容（文字，图片 ） 等。</p>
<h3 id="控件可见性（p98）"><a href="#控件可见性（p98）" class="headerlink" title="控件可见性（p98）"></a>控件可见性（p98）</h3><h4 id="在-xml-布局中控制："><a href="#在-xml-布局中控制：" class="headerlink" title="在 xml 布局中控制："></a>在 xml 布局中控制：</h4><p>为控件添加属性（所有控件均支持），<code>android:visibility=&quot;visible|invisible|gone&quot;</code><br>visible 或者不写：可见，占空间<br>invisible：不可见，占空间（透明状态）<br>gone：不可见，不占空间</p>
<h4 id="Java-代码中控制："><a href="#Java-代码中控制：" class="headerlink" title="Java 代码中控制："></a>Java 代码中控制：</h4><p>动态控制可见性：<code>View.setVisibility(View.VISIBLE|View.INVISIBLE|View.GONE)</code><br>效果同 xml<br>另外，可以通过<code>getVisibility()</code>方法获取当前的控件状态，根据比较的结果，可以做一些特定的操作；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> findViewById(R.id.tv_main);</span><br><span class="line"><span class="keyword">if</span>(view.getVisibility() == View.GONE)&#123;</span><br><span class="line">    <span class="comment">// TODO 如果视图是隐藏的，do：</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(view.getVisibility() == View.VISIBLE) &#123;</span><br><span class="line">    <span class="comment">// TODO 如果视图是显示的， do：</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LinearLayout-重要属性说明（p105）"><a href="#LinearLayout-重要属性说明（p105）" class="headerlink" title="LinearLayout 重要属性说明（p105）"></a>LinearLayout 重要属性说明（p105）</h3><ul>
<li>android:orientation=”vertical|horizontal”；控制 LinearLayout 的排列方向 （该属性用在 LinearLayout 本身上）</li>
<li>android:layout_gravity=”left|right|top|bottom|center_vertical|center_horizontal”；控件在父控件中的对齐方式。（该属性用在 LinearLayout 的子控件中）</li>
<li>android:layout_weight=”1”；通过比例的方式控制控件的大小。 （该属性用在 LinearLayout 的子控件中，剩余空间按比例分配。适配方案还得靠它）</li>
</ul>
<p><strong>易混淆的属性（p107）</strong><br><code>android:layout_gravity</code>和<code>android:gravity</code>属性区别：</p>
<ol>
<li><code>android:layout_gravity</code>属性：用于指定该控件在父控件中的对齐方式（可选值：<code>top|bottom|left|right|center|center_vertical|center_horizontal</code> ）</li>
<li><code>android:gravity</code>属性：用于指定控件中的内容在控件中的对齐方式（ 可选值：<code>top|bottom|left|right|center|center_vertical|center_horizontal</code> ）</li>
<li>注意：<span style="color:red">layout_gravity，当父控件 LinearLayout 排列方向是 horizontal 时，<br>只有垂直方向的对齐方式才会生效（bottom, top, center_vertical）；<br>当父控件 LinearLayout 排列方向是 vertical 时，只有水平方向的对齐方式才会生效（left，right，center_horizontal）</span></li>
</ol>
<h3 id="RelaviteLayout-布局"><a href="#RelaviteLayout-布局" class="headerlink" title="RelaviteLayout 布局"></a>RelaviteLayout 布局</h3><p><em>相对于父布局进行定位：</em></p>
<ul>
<li>android:layout_alignParentTop=”true”</li>
<li>android:layout_alignParentBottom=”true”</li>
<li>android:layout_alignParentLeft=”true”</li>
<li>android:layout_alignParentRight=”true”</li>
<li>android:layout_centerInParent=”true”</li>
</ul>
<p><em>相对于其他控件进行布局：</em></p>
<ul>
<li>android:layout_above=”@id/view3”</li>
<li>android:layout_below=”@id/view3”</li>
<li>android:layout_toRightOf=”@id/view3”</li>
<li>android:layout_toLeftOf=”@id/view3”</li>
</ul>
<p><em>相对于其他控件的边缘进行对齐显示：</em></p>
<ul>
<li>android:layout_alignRight= “@id/view3”</li>
<li>android:layout_alignLeft= “@id/view3”</li>
<li>android:layout_alignTop= “@id/view3”</li>
<li>android:layout_alignBottom= “@id/view3”</li>
</ul>
<p><em>其他：</em></p>
<ul>
<li>android:layout_centerVertical=”true”</li>
<li>android:layout_centerHorizontal=”true”</li>
</ul>
<p><strong>注意 1</strong>：通过<code>@id/tv_view</code>引用的控件一定要先定义；而通过<code>@+id/tv_view</code>引用的控件也可以出现在后面。<br><strong>注意 2</strong>：可以在一个控件中使用上面的一个或多个。例如，相对于父布局的“左上”布局，<br>就需要填写两个属性<code>android:layout_alignParentTop=&quot;true&quot;;android:layout_alignParentLeft=&quot;true&quot;</code>。</p>
<h3 id="TableLayout-布局"><a href="#TableLayout-布局" class="headerlink" title="TableLayout 布局"></a>TableLayout 布局</h3><ul>
<li>TableLayout 中的每一个 TableRow 都表示表格中的一行，每一个子控件表示一列。</li>
<li>TableRow 中的控件不可以指定宽度。</li>
<li>在 TableLayout 中添加属性：<ul>
<li><code>android:stretchColumns=&quot;1&quot;</code>，使指定的那一列拉伸，以自动适应屏幕的宽度。（0 表示第一列，1 表示第二列）</li>
<li><code>android:shrinkColumns=&quot;0&quot;</code>，收缩指定的列；</li>
<li><code>android:collapseColumns=&quot;0&quot;</code>，隐藏指定的列；</li>
</ul>
</li>
</ul>
<h3 id="其他布局"><a href="#其他布局" class="headerlink" title="其他布局"></a>其他布局</h3><ul>
<li>FrameLayout 布局<br>（所有控件默认摆放在左上角；多个子控件情况下下面的控件覆盖上面的控件；可通过 gravity 和 layout_gravity 来控制子控件的对齐方式）</li>
<li>AbsoluteLayout 布局（不推荐使用）</li>
</ul>
<h3 id="ListView-控件（p127）"><a href="#ListView-控件（p127）" class="headerlink" title="ListView 控件（p127）"></a>ListView 控件（p127）</h3><p><strong>需要的元素：</strong></p>
<ol>
<li>数据源</li>
<li>单个 item 的 layout 布局</li>
<li>适配器（简单的名称显示可继承自 ArrayAdapter，更丰富的布局可继承自 BaseAdapter）</li>
</ol>
<p>**优化 **</p>
<ol>
<li>利用 android 自带的缓存机制，convertView；</li>
<li>使用 ViewHolder 和 Tag；每一个 View 都可以存储一个 Tag 对象（看源码 mTag），对控件对应的实体进行缓存。当需要实体的时候，从 tag 中获取；</li>
<li>推荐阅读：<a href="http://blog.csdn.net/ly1414725328/article/details/51337043">【Android】通用系列 —— 用简单通用的方式操作 ListView</a></li>
</ol>
<p><strong>其他补充：</strong></p>
<ul>
<li>为 listview 绑定适配器：lv.setAdapter(mAdapter);</li>
<li>数据发生变化，要及时更新界面：mAdapter.notifyDataSetChanged();</li>
<li>定位到某一项（即在屏幕上显示这一项）：lv.setSelection(num);</li>
<li>点击事件：setOnItemClickListener(OnItemClickListener ocl);</li>
<li>给 ListView 项的分割线设置为透明色：android:divider=”@null”</li>
<li>不显示滚动条：<code>android:scrollbars=&quot;none&quot;</code></li>
<li>平滑滚动到指定条目：<code>mLv.smoothScrollToPosition(pItem);</code></li>
<li>设置 ListView 不可用：<code>mLv.setEnable(false)</code></li>
<li>设置 listView 不可滑动（可以通过拦截触摸事件，和<code>mLv.setEnable(false)</code>达到的效果不同）：</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setListViewCannotSlide</span><span class="params">(ListView lv)</span> &#123;</span><br><span class="line">    lv.setOnTouchListener(<span class="keyword">new</span> <span class="title class_">OnTouchListener</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onTouch</span><span class="params">(View v, MotionEvent event)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> event.getAction() == MotionEvent.ACTION_MOVE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>点击效果：设置 listSelector 和设置 item 的 layout 两种方式。(最好不要混用，推荐使用第二种方式)</li>
<li>取消点击效果：<code>andrdoi:listSelector=&quot;@android:color/transparent&quot;</code></li>
<li>动态取消点击效果：<code>mLv.setSelector(new ColorDrawable(Color.TRANSPARENT));</code></li>
<li>动态设置点击效果：<code>mLv.setSelector(R.drawable.item_selector);</code></li>
</ul>
<p><strong>外部链接</strong></p>
<ul>
<li><a href="http://www.cnblogs.com/loulijun/archive/2012/04/15/2450312.html">Android 美工坊–listview 更改选中时 item 背景色</a></li>
<li><a href="http://stackoverflow.com/questions/22422196/android-listview-listselector-not-working">Android ListView listSelector not working</a></li>
</ul>
<hr>
<h2 id="第四章-Fragment-碎片"><a href="#第四章-Fragment-碎片" class="headerlink" title="第四章 Fragment 碎片"></a>第四章 Fragment 碎片</h2><blockquote>
<p>第一遍：不知道自己不知道。<br>第二遍：知道自己不知道，或不知道自己知道。<br>第三遍：知道自己知道。</p>
</blockquote>
<p>简而言之，碎片（Fragment）是一种可以嵌入在活动当中的 UI 片段，它能让程序更加合理和充分地利用大屏幕空间。<br><strong>学习资料：</strong></p>
<ul>
<li><a href="http://blog.csdn.net/guolin_blog/article/details/8881711">Android Fragment 完全解析，关于碎片你所需知道的一切</a></li>
<li><a href="http://blog.csdn.net/lmj623565791/article/details/37970961">Android Fragment 真正的完全解析（上）</a></li>
<li><a href="http://blog.csdn.net/lmj623565791/article/details/37992017"> [Android Fragment 真正的完全解析（下）] </a></li>
<li><a href="http://blog.csdn.net/lmj623565791/article/details/42628537"> Android Fragment 你应该知道的一切 </a></li>
</ul>
<p><strong>要点难点：</strong></p>
<ol>
<li>通信–数据传递。</li>
<li>抽象成一个公用的类。</li>
<li>回退栈（remove，add，hide，show 等方法的区别）</li>
<li>屏幕适配：限定符；</li>
<li>双页单页模式（p182）</li>
</ol>
<hr>
<h2 id="第五章-广播机制"><a href="#第五章-广播机制" class="headerlink" title="第五章 广播机制"></a>第五章 广播机制</h2><h3 id="注册广播："><a href="#注册广播：" class="headerlink" title="注册广播："></a>注册广播：</h3><h4 id="1-动态注册-（p190）"><a href="#1-动态注册-（p190）" class="headerlink" title="1. 动态注册 （p190）"></a>1. 动态注册 （p190）</h4><p>新建一个类，继承 BroadcastReceiver，重写父类的 onReceive 方法。<br>自定义的 MainActivity 中通过 Context 的<code>registerReceiver（BroadCastReceiver bc，IntentFilter if）</code>方法来注册 。<br>说明：其中参数 bc 是刚才新建类的实例，参数 if 是广播发送过来的 action 值包装成 IntentFilter 对象。</p>
<p><strong>注意：</strong> 用完之后需要销毁，在 activity 的 onDestroy()方法中调用 unregisterReceiver()方法。<br><strong>注意：</strong> 当访问的内容涉及到系统的关键性信息，那么需要在配置文件中配置相应的权限 permission （ <a href="http://developer.android.com/reference/android/Manifest.permission.html%EF%BC%89%E3%80%82">http://developer.android.com/reference/android/Manifest.permission.html）。</a><br><strong>注意：</strong> 应用程序发送的广播是可以被其他应用程序接收到的。跨进程通信。</p>
<h4 id="2-静态注册"><a href="#2-静态注册" class="headerlink" title="2. 静态注册"></a>2. 静态注册</h4><ul>
<li>创建一个集成自 BroadCast 的类，并重写 onReceive（）方法</li>
<li>类似于 activity 的注册，使用<receiver>标签，使用 android:name 来指定刚才创建的广播接收器（即实现了 BroadCast 的类的实例）</receiver></li>
<li>在<intent-filter>标签中添加想要接收的广播。</intent-filter></li>
</ul>
<p><strong>另外：</strong> 使用静态注册可以达到开机启动的目的。静态注册在程序未启动的时候也可以接收广播。<br><strong>注意：</strong> 监听某些广播也是需要声明权限的。</p>
<p><strong>注意：</strong> 不要在 onReceive()中添加过多的逻辑或者任何的耗时操作，因为在广播接收器中是不允许开启线程的（如果运行时间较长，程序会报错）。<br><strong>应用场合：</strong> 启动其他组件，例如创建一条状态栏通知，或启动一个服务等。</p>
<h3 id="发送广播"><a href="#发送广播" class="headerlink" title="发送广播"></a>发送广播</h3><p><strong>标准广播</strong><br>例如在 MainActivity 中点击按钮时发送广播：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;com.lyloou.broadcasttest.MY_BROADCAST&quot;</span>);<span class="comment">//还可以绑定一些数据到Intent中供接收者使用；</span></span><br><span class="line">sendBroadcast(intent);</span><br></pre></td></tr></table></figure>

<p><strong>有序广播</strong></p>
<ul>
<li>区别于标准广播的<code>sendBroadcast(Intent intent)</code>, 有序广播是<code>sendOrderedBroadcast(Intent intent, String receiverPermission )</code>。 (可以参考 Context 的 API 文档看更详细内容)</li>
<li>广播接收器的先后顺序，是通过在注册的时候设定的。例如，<code>&lt;intent-filter android:priority=&quot;100&quot;&gt;</code>。</li>
<li>有序广播是可以截断的。在 onRecevie（）中调用<code>abortBroadcast();</code>方法将广播截断，后续的接收器就无法接收到该条广播。<br>（<code>only works with broadcasts sent through Context.sendOrderedBroadcast.</code> ）</li>
</ul>
<h3 id="本地广播（p202）"><a href="#本地广播（p202）" class="headerlink" title="本地广播（p202）"></a>本地广播（p202）</h3><ul>
<li>区别于一般的广播，本地广播只允许本应用程序接收本应用程序发送的广播，解决了广播的安全性问题。<br>其他程序的广播无法发送到我们程序的内部，更安全。比全局广播更高效。</li>
<li>与一般的广播的动态注册方式类似。（一般广播，这里指的是全局广播）</li>
<li>区别于一般广播的接收方式<code>registerReceiver()</code>，本地广播使用：</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">LocalBroadcastManager</span>  <span class="variable">localBroadCastManager</span> <span class="operator">=</span>  LocalBroadcastManager.getInstance(Context c);</span><br><span class="line">localBroadCastManager.registerReceiver(BroadcastReceiver br, Intent i);</span><br></pre></td></tr></table></figure>

<ul>
<li>区别于一般广播的发送方式<code>sendBroadcast(intent)</code>,本地广播使用：<code>localBroadCastManager.sendBroadcast(intent)</code></li>
<li>注意：也需要 unregister 进行注销处理。</li>
<li>注意：本地广播无法通过静态方式注册接收, 静态注册在程序未启动的时候也可以接收广播，而本地广播肯定是在启动程序之后发送，所以不需要静态注册 。</li>
<li>注意：不可以混用系统广播和本地广播，（例如通过 localBroadCastManager.registerReceiver 来注册蓝牙广播，是不对的，<br>如果非得这样做，onReceiver 中将无法接收到蓝牙开启和关闭的广播）</li>
</ul>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>在广播接收器写一个弹框（p210）。<br>从广播接收器中启动活动需要注意的内容（p211）：给 Intent 加入 FLAG_ACTIVITY_NEW_TASK 标识。</p>
<hr>
<h2 id="第六章-数据存储"><a href="#第六章-数据存储" class="headerlink" title="第六章 数据存储"></a>第六章 数据存储</h2><h3 id="持久化的方式"><a href="#持久化的方式" class="headerlink" title="持久化的方式"></a>持久化的方式</h3><ul>
<li>文件存储：存储简单的文本数据和二进制数据。</li>
<li>SharePreference 存储 ：存储的是键值对。</li>
<li>数据库–SQLITE： 存储复杂关系型的数据。</li>
</ul>
<h3 id="文件存储（p221）"><a href="#文件存储（p221）" class="headerlink" title="文件存储（p221）"></a>文件存储（p221）</h3><p>核心方法：Context 提供的 openFileInput()和 openFileOutput()方法；<br>注意：不适用于存储复杂类型的数据。</p>
<h3 id="SharePreference-存储（p228）"><a href="#SharePreference-存储（p228）" class="headerlink" title="SharePreference 存储（p228）"></a>SharePreference 存储（p228）</h3><ul>
<li><p>使用<strong>键值对</strong>的方式存储。</p>
</li>
<li><p>使用 xml 格式来对数据进行管理。</p>
</li>
<li><p>获取 SharePreference（下面三种方法不同之处在于参数和存储地址）</p>
<ol>
<li>Context 类中的 getSharedPreference（String filename, MODE_PRIVATE|MODE_MULTI_PROCESS），<br>在系统中的具体表现：<code>/data/data/&lt;package name&gt;/shared_prefs/filename参数名</code></li>
<li>Activity 类中的 getPreference（MODE_PRIVATE|MODE_MULTI_PROCESS），文件名以当前活动的类名起名。</li>
<li>PreferenceManager 类中的 getDefaultSharedPreference（ MODE_PRIVATE|MODE_MULTI_PROCESS ），文件名以包名起名。</li>
</ol>
</li>
<li><p>保存数据步骤：</p>
<ol>
<li>通过获取到的 SharePreference 对象实例 sp，引用其 edit（）方法，<code>SharedPreferences.Editor editor = sp.edit();</code></li>
<li>editor.putInt(“age”,18);</li>
<li>editor.putString(“name”,”Bob”);</li>
<li>…</li>
<li>editor.commit();</li>
</ol>
</li>
<li><p>获取数据步骤：</p>
<ol>
<li>同样首先获取到 SharePreference 对象实例 sp；</li>
<li>int age = sp.getInt(“age”, 0);</li>
<li>String name = sp.getString(“name”, “”);</li>
<li>…</li>
<li>获取到数据后的其他操作。</li>
</ol>
</li>
</ul>
<h3 id="数据库（SQLITE-p238）"><a href="#数据库（SQLITE-p238）" class="headerlink" title="数据库（SQLITE-p238）"></a>数据库（SQLITE-p238）</h3><ul>
<li>创建一个 继承自 SQLiteOpenHelper 类的帮助类，重写 onCreate()和 onUpgrate()方法，在这两个方法中实现创建表和升级数据库的逻辑。</li>
<li>通过帮助类获取实例：getReadableDatabase()和 getWritableDatabase()方法获取实例。两者的区别是前者在磁盘满的时候以只读方式打开数据库，而后者直接抛出异常。</li>
<li>通过 db.execSQL（）可以直接执行数据库语句。</li>
<li>事务保证数据安全：进行读写操作，要使用事务（读数据就不需要事务了）；</li>
<li>数据库创建后，将不再重新创建，这意味着在客户端，<code>onCreate()</code>方法只执行一次。 除非卸载掉重新安装，<br>如果是覆盖安装的话，修改了了数据库结构，就要通过<code>onUpgrade()</code>方法来控制了。</li>
</ul>
<h4 id="CRUD-–-添加数据"><a href="#CRUD-–-添加数据" class="headerlink" title="CRUD – 添加数据"></a>CRUD – 添加数据</h4><p>利用 ContentValues 组件一组数据，通过 insert 来添加到数据库中。<br>ContentValues 利用键值的方式添加：，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ContentValues</span> <span class="variable">contentValues</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentValues</span>();</span><br><span class="line">contentValues.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;think in java&quot;</span>);</span><br><span class="line">contentValues.put(<span class="string">&quot;version&quot;</span>, <span class="number">3</span>);</span><br><span class="line">db.insert(<span class="string">&quot;Book&quot;</span>, <span class="literal">null</span>, contentValues);</span><br></pre></td></tr></table></figure>

<h4 id="CRUD-–-更改数据"><a href="#CRUD-–-更改数据" class="headerlink" title="CRUD – 更改数据"></a>CRUD – 更改数据</h4><p>利用 ContentValues 组件一组数据，通过 update 来添加到数据库中。<br>ContentValues 利用键值的方式更新：，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ContentValues</span> <span class="variable">contentValues</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentValues</span>();</span><br><span class="line">contentValues.put(<span class="string">&quot;version&quot;</span>, <span class="number">4</span>);</span><br><span class="line">db.update(<span class="string">&quot;Book&quot;</span>, contentValues, <span class="string">&quot;name=?&quot;</span> , <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;think in java&quot;</span>&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="CRUD-–-删除数据"><a href="#CRUD-–-删除数据" class="headerlink" title="CRUD – 删除数据"></a>CRUD – 删除数据</h3><p>获取到 db 实例后，即可执行删除操作</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">SQLiteDatabase</span> <span class="variable">db</span> <span class="operator">=</span> dbHelper.getWritableDatabase();</span><br><span class="line">db.delete(<span class="string">&quot;Book&quot;</span>, <span class="string">&quot;version &lt; ?&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;4&quot;</span>&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="CRUD-–-查询数据"><a href="#CRUD-–-查询数据" class="headerlink" title="CRUD – 查询数据"></a>CRUD – 查询数据</h3><p>利用 db 的 query 方法来得到一个 Cursor 实例。对 Cursor 进行取值操作，即可得到想要的值。<br>cursor.moveToFirst(); 指针移动到第一行；<br>cursor.moveToNext(); 指针移动到下一个；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Cursor</span> <span class="variable">cursor</span> <span class="operator">=</span> db.query(<span class="string">&quot;Book&quot;</span>, <span class="literal">null</span> , <span class="literal">null</span> , <span class="literal">null</span> , <span class="literal">null</span> , <span class="literal">null</span> , <span class="literal">null</span> );</span><br><span class="line">cursor.moveToFirst();</span><br><span class="line">Log.d(<span class="string">&quot;LOU&quot;</span>,cursor.getString(cursor.getColumnIndex( <span class="string">&quot;name&quot;</span> )));</span><br><span class="line">Log.d(<span class="string">&quot;LOU&quot;</span>,cursor.getInt( cursor.getColumnIndex( <span class="string">&quot;version&quot;</span> )) );</span><br><span class="line">cursor.close();</span><br></pre></td></tr></table></figure>

<p><strong>技巧：</strong> 利用 switch 来优化数据库升级（p264）。</p>
<hr>
<h2 id="第七章-内容提供器（p268）"><a href="#第七章-内容提供器（p268）" class="headerlink" title="第七章 内容提供器（p268）"></a>第七章 内容提供器（p268）</h2><blockquote>
<p>首先作为一个客户端程序员，来使用 API，接着创建自己的 API；</p>
</blockquote>
<ul>
<li><p>内容提供器主要用于在不同的应用程序之间实现数据共享，目前内容提供器是 Android 实现跨程序共享数据的标准方式。</p>
</li>
<li><p>ContentProvider 比起文件和 SharedPreference 的 MODE_WORLD_READABLE 和 MODE_WORLD_WRITEABLE 两种操作模式要更安全可靠。<br>因为你只提供想要给其他程序访问的数据，其他数据就不会有任何影响。</p>
</li>
<li><p>ContentResolver 对象获取方式：‘’以通过 Context 的 getContentResolver()来获取。</p>
</li>
<li><p>ContentResolver 提供的一些方法进行 CRUD 操作。<br>（基本类似于数据库的 CRUD，最明显的区别就是：<br>数据库中的 CRUD 方法传入的参数是 <strong>表名</strong>，而 ContentResolver 中的传入的参数是 <strong>Uri</strong>，<br>对应的继承自 ContentProvider 的自定义内容提供器里面的 CRUD 方法设置的参数也是 <strong>Uri</strong>。）</p>
</li>
<li><p>内容提供器的用法有两种：</p>
<ol>
<li>使用现有的提供器来读取和操作某程序的数据。（作为客户端）</li>
<li>自己创建 ContentProvider 给自己的程序或其他程序提供外部访问接口，以供其读取和操作数据。（客户端和 API 端都有）</li>
</ol>
</li>
<li><p>Uri：区别于 SQLiteDatabase 接受的参数<code>table</code>，ContentResolver 接受的参数是“URI”，<br>要对某程序的数据进行读取和操作，需要制定其<code>Uri</code>。</p>
</li>
<li><p>URI 格式：由两部分组成，权限 authority 和路径 path（p269） + 通配符的使用 （p277）</p>
</li>
<li><p>UriMatcher 的使用（p279）</p>
</li>
<li><p>Uri 的 getPathSegments()方法可以将字符串按照“/”分割成字符串列表，通过 get(0)这种方式访问列表中的字符串。</p>
</li>
<li><p>所有内容提供者必须提供的方法（getType()），getType()方法的实现，用于获取 Uri 对象所对应的 MIME 类型；（p280）</p>
</li>
<li><p>自定义的 ContentProvider 需要注册到 Manifest 中（p286）。</p>
</li>
</ul>
<p><strong>注意：</strong> 在每次创建内容提供者的时候，都要提醒自己，是不是真的需要这样做。<br>因为只有真正需要将数据共享出去的时候我们才应该创建内容提供器，<br>仅仅是用于内部程序访问的数据没必要使用内容提供者。</p>
<p><em>Lou:</em> ContentProvider 扮演的是程序和程序之间数据传递的桥梁角色。<br>A 程序规定好自己的哪些数据内容可以访问，并设置好对应的 Uri，<br>B 程序借助 ContentProvider 提供器传入 A 程序规定好的 Uri 来读取和操作 A 程序的数据。<br>在 ContentProvider 中操作数据库，<br>就好像是 ContentProvider 提供了一个包装，<br>在其内根据传入的 Uri 来进行具体的数据库操作，<br>对外只需要提供一个接口即可（接口需要有正确的参数，例如 Uri、过滤条件等）。</p>
<hr>
<h2 id="第八章-多媒体"><a href="#第八章-多媒体" class="headerlink" title="第八章 多媒体"></a>第八章 多媒体</h2><h3 id="通知"><a href="#通知" class="headerlink" title="通知"></a>通知</h3><h4 id="使用步骤："><a href="#使用步骤：" class="headerlink" title="使用步骤："></a>使用步骤：</h4><ol>
<li>得到 manager：<code>NotificationManager manager = (NotificationManager)getSystemService(NOTIFICATION_SERVICE);</code></li>
<li>得到 notification 实例：<code>Notification notification = new Notification(R.drawable.ic_launcher, &quot;This is ticker text&quot;, System.currentTimeMillis());</code></li>
<li>设置通知里的布局：<code>notification.setLatesEventInfor(this, &quot;This is content title&quot;, &quot;This is content text&quot;, null);</code>，<br>其中第四个参数是用来设置点击通知触发的逻辑，用 PendingIntent 来设定。</li>
<li>利用 manager 发出通知：<code>manager.notify(1, notification);</code>，其中 1 是该通知的唯一标志，可以用于之后的取消。</li>
</ol>
<h4 id="取消通知栏的通知"><a href="#取消通知栏的通知" class="headerlink" title="取消通知栏的通知"></a>取消通知栏的通知</h4><figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">NotificationManager manager <span class="operator">=</span> (NotificationManager)getSystemService(NOTIFICATION_SERVICE)<span class="comment">;</span></span><br><span class="line">manager.cancel(<span class="number">1</span>)<span class="comment">; //其中1表示刚才设置的通知唯一标志。</span></span><br></pre></td></tr></table></figure>

<h4 id="通知栏点击事件处理"><a href="#通知栏点击事件处理" class="headerlink" title="通知栏点击事件处理"></a>通知栏点击事件处理</h4><p><strong>使用 PendingIntent（p302）</strong></p>
<ul>
<li>被延迟执行的 Intent。（Intent 倾向于立即执行某个动作，PendingIntent 倾向于在某个合适的时机去执行某个动作）</li>
<li>通过 getActivity()，或 getBroadCast()，或 getService()来获取 PendingIntent 实例，<br>PendingIntent 结合第二个参数 Intent 来构建出“意图”，当被点击时执行相应的逻辑。 （p302） 1. 如果使用的是 getActivity()，那么就执行 startActivity(intent); 其中 intent：<code>Intent intent = new Intent(getActivity(), MyActivity.class)</code>，指定其目标 Activity。 2. 如果使用的是 getBroadCast()，那么就调用 sendBroadCast(intent); 其中 intent：<code>Intent intent = new Intent(&quot;com.example.broadcasttext.MY_BROADCAST&quot;)</code>,指定其 action。 3. 如果使用的是 getService()，那么就调用 startService(intent);其中 intent：<code>Intent intent = new Intent(getActivity(), MyService.class)</code>，指定目标 service。</li>
<li>将得到的实例作为<code>notification.setLatesEvenInfor()</code>的第四个参数以实现点击通知的逻辑（启动一个 Activity、发送一条广播、启动某个服务等等 ）。</li>
</ul>
<h4 id="通知的交互处理（p305）"><a href="#通知的交互处理（p305）" class="headerlink" title="通知的交互处理（p305）"></a>通知的交互处理（p305）</h4><ul>
<li>添加声音：</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Uri</span> <span class="variable">soundUri</span> <span class="operator">=</span> Uri.fromFile(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/system/media/audio/ringtones/Basic_tone.ogg&quot;</span>));</span><br><span class="line">notification.sound = sounUri;</span><br></pre></td></tr></table></figure>

<ul>
<li>添加振动：</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">long</span>[] vibrates = &#123;<span class="number">0</span>, <span class="number">1000</span>, <span class="number">1000</span>, <span class="number">1000</span>&#125;;</span><br><span class="line">notification.vibrate = vibrates;</span><br><span class="line"><span class="comment">// 注意：需要添加震动权限 &lt;uses-permission android:name=&quot;android.permission.VIBRATE&quot;/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>添加 LED 通知</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">notification.ledARGB = Color.GREEN;</span><br><span class="line">notification.ledOnMS = <span class="number">1000</span>;</span><br><span class="line">notification.ledOffMS = <span class="number">1000</span>;</span><br><span class="line">notification.flags = Notification.FLAG_SHOW_LIGHTS;</span><br></pre></td></tr></table></figure>

<ul>
<li>设置默认通知类型：</li>
</ul>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">notification.defaults</span> = Notification.DEFAUT_ALL</span><br></pre></td></tr></table></figure>

<ul>
<li>扩展：<br>点亮屏幕</li>
</ul>
<hr>
<h2 id="第九章-服务"><a href="#第九章-服务" class="headerlink" title="第九章 服务"></a>第九章 服务</h2><h3 id="多线程编程"><a href="#多线程编程" class="headerlink" title="多线程编程"></a>多线程编程</h3><p>子线程中不允许进行 UI 操作。</p>
<p>异步消息处理机制：</p>
<ul>
<li>handler</li>
<li>AsyncTask</li>
<li>Activity.runOnUIThread(Runnable runnable)</li>
<li>IntentService</li>
</ul>
<h4 id="Handler（p348）"><a href="#Handler（p348）" class="headerlink" title="Handler（p348）"></a>Handler（p348）</h4><ol>
<li>在主线程中创建 Handler 实例，并重写 handMessage()方法。</li>
<li>在子线程中通过 handler 发送消息（<code>handler.sendMessage(msg);</code>）</li>
<li>msg 会被添加到 MessageQueue 等待处理。</li>
<li>Looper 不断的监测 MessageQueue 中是否有 Message，如果有那么就取出来分发到 handler 的 handleMessage()方法中处理。</li>
<li>在 handler.handleMessage()方法中进行 UI 操作。</li>
</ol>
<h4 id="AsyncTask（p349）"><a href="#AsyncTask（p349）" class="headerlink" title="AsyncTask（p349）"></a>AsyncTask（p349）</h4><ol>
<li><p>AsyncTask 是一个抽象类，需要去继承才能用。</p>
</li>
<li><p>三个泛型参数</p>
<ul>
<li>Params：执行 AsyncTask 任务需要的参数（例如进行网络操作的 URL 字符串）；</li>
<li>Progress：后台执行任务的百分比；</li>
<li>Result：任务的执行完成后的返回值（例如 Bitmap）</li>
</ul>
</li>
<li><p>常用的方法（重写）</p>
<ul>
<li>onPreExecute()，任务执行之前的初始化操作（可以进行 UI 更新）。</li>
<li>doInBackground(Params…)，耗时操作（不可用进行 UI 更新）</li>
<li>onProgressUpdate(Progress…)，当在 doInBackground 方法里调用 publishProgres(Progress…)时会被调用，用于更新当前的 UI 状态。（可以进行 UI 更新）</li>
<li>onPostExecute(Result)，当执行完 doInBackground()方法之后，返回 Result 值给 onPostExecute()方法。用于善后操作。（可以进行 UI 更新）</li>
</ul>
</li>
<li><p>执行方式：<code>new MyAsyncTask().execute();</code></p>
</li>
</ol>
<h3 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h3><ul>
<li>间接继承自 Context</li>
<li>不要因为服务是后台的概念，就把服务和线程搞混了，服务依然是在主线程中运行（即和活动共用一个线程）<br>外部连接里有不错的解释：<br>如果服务中用到耗时操作，依然需要使用子线程：</li>
<li>外部连接：<ul>
<li><a href="http://blog.csdn.net/jie1991liu/article/details/16105605">Service 和 Thread 的关系</a>。</li>
<li><a href="http://www.360doc.com/content/14/0319/20/12928831_361969514.shtml">android service 与子线程之浅谈</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>既然在 Service 里也要创建一个子线程，那为什么不直接在 Activity 里创建呢？<br>这是因为 Activity 很难对 Thread 进行控制，当 Activity 被销毁之后，<br>就没有任何其它的办法可以再重新获取到之前创建的子线程的实例。<br>而且在一个 Activity 中创建的子线程，另一个 Activity 无法对其进行操作。<br>但是 Service 就不同了，所有的 Activity 都可以与 Service 进行关联，<br>然后可以很方便地操作其中的方法，即使 Activity 被销毁了，之后只要重新与 Service 建立关联，<br>就又能够获取到原有的 Service 中 Binder 的实例。<br>因此，使用 Service 来处理后台任务，Activity 就可以放心地 finish，<br>完全不需要担心无法对后台任务进行控制的情况。</p>
</blockquote>
<h4 id="两种方式创建服务"><a href="#两种方式创建服务" class="headerlink" title="两种方式创建服务"></a>两种方式创建服务</h4><ol>
<li>startService(serviceIntent);</li>
<li>bindService(bindIntent, connection, BIND_AUTO_CREATE);</li>
</ol>
<ul>
<li>我们完全有可能对一个服务既调用了 startService()方法，有调用了 bindService()方法。<br>这种情况如何销毁服务？需要同时调用 stopService()（或者 stopself()）和 unBindService()方法才行。（p364）</li>
<li>stopself()可以在 MyService 的任何位置调用，以停止服务。</li>
<li>stopService()跟 startService()一样，需要根据传入的参数来确定 stop 哪个服务。</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">Intent stopIntent = <span class="keyword">new</span> <span class="constructor">Intent(<span class="params">this</span>, MyService.<span class="params">class</span>)</span>;</span><br><span class="line">stop<span class="constructor">Service(<span class="params">stopIntent</span>)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ul>
<li>需要在 Manifest 中注册服务。</li>
<li>通过 bindService 的方式创建的服务，可以更方便的控制它。</li>
<li>IntentService，一个异步的，可以自动停止的服务。（p367）。<br>在重写的方法 onHandleIntent()里的进行耗时操作；</li>
</ul>
<h4 id="服务的应用"><a href="#服务的应用" class="headerlink" title="服务的应用"></a>服务的应用</h4><p>定时任务（Alarm）</p>
<h4 id="外部连接"><a href="#外部连接" class="headerlink" title="外部连接"></a>外部连接</h4><ul>
<li><a href="http://blog.csdn.net/p106786860/article/details/17885115">Android 基本功：IntentService 的使用</a></li>
<li><a href="http://www.cnblogs.com/mengdd/archive/2013/03/24/2979944.html">Android Service 的生命周期</a></li>
<li><a href="http://www.cnblogs.com/mengdd/archive/2013/03/24/2979903.html">Android Service 的绑定 续篇：关于绑定的补充说明</a></li>
<li><a href="http://www.cnblogs.com/yejiurui/p/3429451.html">深入理解 Android 的 startservice 和 bindservice</a></li>
</ul>
<hr>
<h2 id="第十章-网络技术"><a href="#第十章-网络技术" class="headerlink" title="第十章 网络技术"></a>第十章 网络技术</h2><h3 id="使用-Http-协议访问网络（注意要添加网络权限）"><a href="#使用-Http-协议访问网络（注意要添加网络权限）" class="headerlink" title="使用 Http 协议访问网络（注意要添加网络权限）"></a>使用 Http 协议访问网络（注意要添加网络权限）</h3><h4 id="HttpURLConnection（p380）"><a href="#HttpURLConnection（p380）" class="headerlink" title="HttpURLConnection（p380）"></a>HttpURLConnection（p380）</h4><p><strong>get 数据</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendRequestWithHttpURLConnection</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="type">HttpURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://www.lyloou.com&quot;</span>);</span><br><span class="line">                connection = (HttpURLConnection)url.openConnection();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Get表示希望从服务器获取数据；Post表示希望提交数据给服务器</span></span><br><span class="line">                connection.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 设置连接超时</span></span><br><span class="line">                connection.setConnectionTimeout(<span class="number">8000</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 设置读取超时</span></span><br><span class="line">                connection.setReadTimeout(<span class="number">8000</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 获取输入流</span></span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> connection.getInputStream();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 对输入流进行读取操作</span></span><br><span class="line">                <span class="type">BufferReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(in));</span><br><span class="line">                <span class="type">StringBuilder</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                String line;</span><br><span class="line">                <span class="keyword">while</span>((line=reader.readline()) != <span class="literal">null</span>)&#123;</span><br><span class="line">                    response.append(line);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 将结果返回</span></span><br><span class="line">                <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">                msg.what = <span class="number">1</span>;</span><br><span class="line">                msg.obj = response.toString();</span><br><span class="line">                handler.sendMessage(msg);</span><br><span class="line">            &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(connection != <span class="literal">null</span>)&#123;</span><br><span class="line">                    connection.disconnect();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>post 数据</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取输出流并写出数据。</span></span><br><span class="line"><span class="type">DataOutputStream</span> <span class="variable">out</span> <span class="operator">=</span>  <span class="keyword">new</span>  <span class="title class_">DataOutputStream</span>( connection.getOutputStream());</span><br><span class="line">out.writeBytes(<span class="string">&quot;username=admin&amp;password=123456&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="HttpClient（p385-）"><a href="#HttpClient（p385-）" class="headerlink" title="HttpClient（p385 ）"></a>HttpClient（p385 ）</h4><p><strong>get 数据</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendRequestWithHttpClient</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="type">HttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                httpClient = <span class="keyword">new</span> <span class="title class_">DefaultHttpClient</span>();</span><br><span class="line">                <span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;http://www.baidu.com&quot;</span>);</span><br><span class="line">                <span class="type">HttpResponse</span> <span class="variable">httpResponse</span> <span class="operator">=</span> httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(httpResponse.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="type">HttpEntity</span> <span class="variable">entity</span> <span class="operator">=</span> httpResponse.getEntity();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 将entity转换为字符串，并指定字符集编码</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> EntityUtils.toString(entity, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 将结果返回</span></span><br><span class="line">                    <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">                    msg.what = <span class="number">1</span>;</span><br><span class="line">                    msg.obj = response.toString();</span><br><span class="line">                    handler.sendMessage(msg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(client != <span class="literal">null</span>)&#123;</span><br><span class="line">                    client.disconnect();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>post 数据</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot; http://www.baidu.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">List&lt;NameValuePair&gt; params = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;NameValuePair&gt;();</span><br><span class="line">params.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;admin&quot;</span>));</span><br><span class="line">params.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;123456&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="type">UrlEncodedFormEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlEncodedFormEntity</span>(param, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">httpPost.setEntity(entity);</span><br><span class="line"><span class="type">HttpResponse</span> <span class="variable">httpResponse</span>  <span class="operator">=</span>  httpClient.execute(httpPost);</span><br></pre></td></tr></table></figure>

<h4 id="回调机制（p406，真牛）"><a href="#回调机制（p406，真牛）" class="headerlink" title="回调机制（p406，真牛）"></a>回调机制（p406，真牛）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HttpCallbackListener</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onFinish</span><span class="params">(String response)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Exception e)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendRequest</span><span class="params">(<span class="keyword">final</span> String address, <span class="keyword">final</span> HttpCallbackListener listener)</span>&#123;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Thread</span>(</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">          <span class="type">HttpURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">          <span class="keyword">try</span>&#123;</span><br><span class="line">              <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>( address );</span><br><span class="line">              connection = (HttpURLConnection)url.openConnection();</span><br><span class="line"></span><br><span class="line">              <span class="comment">// Get表示希望从服务器获取数据；Post表示希望提交数据给服务器</span></span><br><span class="line">              connection.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line"></span><br><span class="line">              <span class="comment">// 设置连接超时</span></span><br><span class="line">              connection.setConnectionTimeout(<span class="number">8000</span>);</span><br><span class="line"></span><br><span class="line">              <span class="comment">// 设置读取超时</span></span><br><span class="line">              connection.setReadTimeout(<span class="number">8000</span>);</span><br><span class="line"></span><br><span class="line">              <span class="comment">// 获取输入流</span></span><br><span class="line">              <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> connection.getInputStream();</span><br><span class="line"></span><br><span class="line">              <span class="comment">// 对输入流进行读取操作</span></span><br><span class="line">              <span class="type">BufferReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(in));</span><br><span class="line">              <span class="type">StringBuilder</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">              String line;</span><br><span class="line">              <span class="keyword">while</span>((line=reader.readline()) != <span class="literal">null</span>)&#123;</span><br><span class="line">                  response.append(line);</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">             <span class="comment">// 将结果回调到参数中去处理，而不是return的方式返回数据（return的数据可能因为主线程先执行完而不能接受到，而通过参数就一定会执行了）。</span></span><br><span class="line">             <span class="keyword">if</span>( listener != <span class="literal">null</span>)&#123;</span><br><span class="line">                 listener.onFinish(response.toString());</span><br><span class="line">             &#125;</span><br><span class="line">          &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">             <span class="keyword">if</span>( listener != <span class="literal">null</span>)&#123;</span><br><span class="line">                 listener.onError(e);</span><br><span class="line">             &#125;</span><br><span class="line">          &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">              <span class="keyword">if</span>(connection != <span class="literal">null</span>)&#123;</span><br><span class="line">                  connection.disconnect();</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  ).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="XML-解析"><a href="#XML-解析" class="headerlink" title="XML 解析"></a>XML 解析</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">apps</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">app</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Google Maps<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">app</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">app</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Chrome<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">app</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">app</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>3<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Google Play<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">app</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">apps</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="PULL-方式（p391-）"><a href="#PULL-方式（p391-）" class="headerlink" title="PULL 方式（p391 ）"></a>PULL 方式（p391 ）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">parseXMLWithPull</span><span class="params">(String xmlData)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">XmlPullParserFactory</span> <span class="variable">factory</span> <span class="operator">=</span> XmlPullParserFactory.newInstance();</span><br><span class="line">        <span class="type">XmlPullParser</span> <span class="variable">xmlPullParser</span> <span class="operator">=</span> factory.newPullParser();</span><br><span class="line">        xmlPullParser.setInput(<span class="keyword">new</span> <span class="title class_">StringReader</span>(xmlData));</span><br><span class="line">        <span class="type">int</span> <span class="variable">eventType</span> <span class="operator">=</span> xmlPullParser.getEventType();</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">version</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (eventType != XmlPullParser.END_DOCUMENT) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">nodename</span> <span class="operator">=</span> xmlPullParser.getName();</span><br><span class="line">            <span class="keyword">switch</span>(eventType) &#123;</span><br><span class="line">            <span class="keyword">case</span> XmlPullParser.START_TAG:&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="string">&quot;id&quot;</span>.equals(nodename))&#123;</span><br><span class="line">                    id = xmlPullParser.nextText();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;name&quot;</span>.equals(nodename))&#123;</span><br><span class="line">                    name = xmlPullParser.nextText();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;version&quot;</span>.equals(nodename))&#123;</span><br><span class="line">                    version = xmlPullParser.nextText();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> XmlPullParser.END_TAG:&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="string">&quot;app&quot;</span>.equals(nodename))&#123;</span><br><span class="line">                    Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;id is &quot;</span> + id);</span><br><span class="line">                    Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;name is &quot;</span> + name);</span><br><span class="line">                    Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;version is &quot;</span> + version);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            eventType = xmlPullParser.next();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SAX-方式（p394）"><a href="#SAX-方式（p394）" class="headerlink" title="SAX 方式（p394）"></a>SAX 方式（p394）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">parseXMLWithSAX</span><span class="params">(String xmlData)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">SAXParserFactory</span> <span class="variable">factory</span> <span class="operator">=</span> SAXParserFactory.newInstance();</span><br><span class="line">        <span class="type">XMLReader</span> <span class="variable">xmlReader</span> <span class="operator">=</span> factory.newSAXParser().getXMLReader();</span><br><span class="line">        <span class="type">ContentHandler</span> <span class="variable">contentHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentHandler</span>();</span><br><span class="line"></span><br><span class="line">        xmlReader.setContentHandler(contentHandler);</span><br><span class="line">        xmlReader.parse(<span class="keyword">new</span> <span class="title class_">InputSource</span>(<span class="keyword">new</span> <span class="title class_">StringReader</span>(xmlData)));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentHandler</span> extend DefaultHandler&#123;</span><br><span class="line">    <span class="keyword">private</span> String nodeName;</span><br><span class="line">    <span class="keyword">private</span> StringBuilder id;</span><br><span class="line">    <span class="keyword">private</span> StringBuilder name;</span><br><span class="line">    <span class="keyword">private</span> StringBuilder version;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// startDocument会在开始XML解析的时候调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startDocument</span><span class="params">()</span> <span class="keyword">throws</span> SAXException&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        name = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        version = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// startElement会在解析某个节点的时候调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startElement</span><span class="params">(String uri, String localName, String qName, Attributes attributes)</span> <span class="keyword">throws</span> SAXException&#123;</span><br><span class="line">        nodeName = localName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// characters会在获取节点内容的时候调用，可能会调用多次，需要对澶蠕动char进行控制</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">characters</span><span class="params">(<span class="type">char</span>[] ch, <span class="type">int</span> start, <span class="type">int</span> length)</span> <span class="keyword">throws</span> SAXException&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;id&quot;</span>.equals(nodeName))&#123;</span><br><span class="line">            id.append(ch, start, length);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;name&quot;</span>.equals(nodeName))&#123;</span><br><span class="line">            name.append(ch, start, length);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;version&quot;</span>.equals(nodeName))&#123;</span><br><span class="line">            version.append(ch, start, length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// endElement会在完成解析某个节点的时候调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">endElement</span><span class="params">(String uri, String localName, String qName)</span> <span class="keyword">throws</span> SAXException&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;app&quot;</span>.equals(localName))&#123;</span><br><span class="line">            Log.d(<span class="string">&quot;ContentHandler&quot;</span>, <span class="string">&quot;id is &quot;</span> + id.toString().trim());</span><br><span class="line">            Log.d(<span class="string">&quot;ContentHandler&quot;</span>, <span class="string">&quot;name is &quot;</span> + name.toString().trim());</span><br><span class="line">            Log.d(<span class="string">&quot;ContentHandler&quot;</span>, <span class="string">&quot;version is &quot;</span> + version.toString().trim());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 清空还原数据</span></span><br><span class="line">            id.setLength(<span class="number">0</span>);</span><br><span class="line">            name.setLength(<span class="number">0</span>);</span><br><span class="line">            version.setLength(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// endDocument会在完成解析XML的时候调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">endDocument</span><span class="params">()</span> <span class="keyword">throws</span> SAXException&#123;</span><br><span class="line">        Log.d(<span class="string">&quot;ContentHandler&quot;</span>, <span class="string">&quot;completed!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="扩展：DOM-方式"><a href="#扩展：DOM-方式" class="headerlink" title="扩展：DOM 方式"></a>扩展：DOM 方式</h4><h3 id="解析-JSON"><a href="#解析-JSON" class="headerlink" title="解析 JSON"></a>解析 JSON</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.5&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Angry Birds&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;6&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7.0&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Clash of Clans&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span> <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3.5&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Hey Day&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<h4 id="JSONObject-方式（p399）"><a href="#JSONObject-方式（p399）" class="headerlink" title="JSONObject 方式（p399）"></a>JSONObject 方式（p399）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">parseJSONWithJSONObject</span><span class="params">(String jsonData)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>(jsonData);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i&lt;jsonArray.length(); i++) &#123;</span><br><span class="line">            <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> jsonArray.getJSONObject(i);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> jsonObject.getString(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">version</span> <span class="operator">=</span> jsonObject.getString(<span class="string">&quot;version&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> jsonObject.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">            Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;id is &quot;</span> + id);</span><br><span class="line">            Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;version is &quot;</span> + version);</span><br><span class="line">            Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;name is &quot;</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="GSON-方式（p401）"><a href="#GSON-方式（p401）" class="headerlink" title="GSON 方式（p401）"></a>GSON 方式（p401）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String version;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVersion</span><span class="params">(String version)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.version = version;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getVersion</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.version;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//......</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">parseJSONWithGSON</span><span class="params">(String jsonData)</span>&#123;</span><br><span class="line">    <span class="type">Gson</span> <span class="variable">gson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>();</span><br><span class="line">    List&lt;App&gt; appList = gson.fromJson(jsonData, <span class="keyword">new</span> <span class="title class_">TypeToken</span>&lt;List&lt;App&gt;&gt;()&#123;&#125;.getType());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (App app : appList) &#123;</span><br><span class="line">        Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;id is &quot;</span> + app.getId());</span><br><span class="line">        Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;name is &quot;</span> + app.getName());</span><br><span class="line">        Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;version is &quot;</span> + app.getVersion());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="扩展：Jackson-方式，FastJSON-方式"><a href="#扩展：Jackson-方式，FastJSON-方式" class="headerlink" title="扩展：Jackson 方式，FastJSON 方式"></a>扩展：Jackson 方式，FastJSON 方式</h4>]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>加密</title>
    <url>/android/%E5%8A%A0%E5%AF%86/</url>
    <content><![CDATA[<h2 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h2><ul>
<li><a href="https://www.zhihu.com/question/35136485">android开发如何保障本地加密密钥的安全？ - 知乎</a></li>
<li><a href="http://leehong2005.com/2016/08/08/android-so-signature-check/">Android so库防客户端破解的解决方案</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android下载网络图片</title>
    <url>/android/%E4%B8%8B%E8%BD%BD%E7%BD%91%E7%BB%9C%E5%9B%BE%E7%89%87/</url>
    <content><![CDATA[<h2 id="下载网络图片"><a href="#下载网络图片" class="headerlink" title="下载网络图片"></a>下载网络图片</h2><pre><code><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 第一步：根据流得到bitmap</span></span><br><span class="line"><span class="comment">// 方案1</span></span><br><span class="line"><span class="type">Bitmap</span> <span class="variable">bitmap</span> <span class="operator">=</span> Glide.with(applicationContext)</span><br><span class="line">        .load(url)</span><br><span class="line">        .asBitmap()</span><br><span class="line">        .into(Target.SIZE_ORIGINAL, Target.SIZE_ORIGINAL)</span><br><span class="line">        .get();</span><br><span class="line"><span class="comment">// 方案2</span></span><br><span class="line"><span class="type">Bitmap</span> <span class="variable">bitmap</span> <span class="operator">=</span> BitmapFactory.decodeStream(<span class="keyword">new</span> <span class="title class_">URL</span>(url).openStream());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩图片</span></span><br><span class="line"><span class="comment">// bitmap = Bitmap.createScaledBitmap(bitmap, 120, 120, true);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二步：保存成文件</span></span><br><span class="line"><span class="comment">// 保存图片</span></span><br><span class="line"><span class="type">File</span> <span class="variable">imgDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(getDiskCacheDir(applicationContext), <span class="string">&quot;image_caches&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!imgDir.exists()) &#123;</span><br><span class="line">    imgDir.mkdirs();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">File</span> <span class="variable">imgFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(imgDir, fileName);</span><br><span class="line">fileOutputStream = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(imgFile);</span><br><span class="line">Bitmap.<span class="type">CompressFormat</span> <span class="variable">compressFormat</span> <span class="operator">=</span> Bitmap.CompressFormat.PNG;</span><br><span class="line">bitmap.compress(compressFormat, <span class="number">100</span>, fileOutputStream);</span><br><span class="line">fileOutputStream.flush();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
<h2 id="Glide预加载图片"><a href="#Glide预加载图片" class="headerlink" title="Glide预加载图片"></a>Glide预加载图片</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">preloadImage</span><span class="params">(Context context, AdZone adZone)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (AdZone.Item item : adZone.getItems()) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Glide.with(context.getApplicationContext())</span><br><span class="line">                        .load(item.getPic())</span><br><span class="line">                        .downloadOnly(Target.SIZE_ORIGINAL, Target.SIZE_ORIGINAL)</span><br><span class="line">                        .get();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Glide.with(getApplicationContext())</span><br><span class="line">    .load(pic)</span><br><span class="line">    .diskCacheStrategy(DiskCacheStrategy.ALL)</span><br><span class="line">    .into(<span class="keyword">new</span> <span class="title class_">GlideDrawableImageViewTarget</span>(ivWelcome) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setResource</span><span class="params">(GlideDrawable resource)</span> &#123;</span><br><span class="line">            <span class="comment">// https://github.com/bumptech/glide/issues/275</span></span><br><span class="line">            <span class="built_in">super</span>.setResource(resource);</span><br><span class="line"></span><br><span class="line">            ivWelcome.setOnClickListener(v -&gt; &#123;</span><br><span class="line">                sendAdZoneItemBroadcast(item);</span><br><span class="line">            &#125;);</span><br><span class="line">            ivWelcome.setVisibility(View.VISIBLE);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// set countDown</span></span><br><span class="line">            toCountDown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLoadFailed</span><span class="params">(Exception e, Drawable errorDrawable)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.onLoadFailed(e, errorDrawable);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://blog.csdn.net/qq_30740239/article/details/53466426">Glide下载图片和缓存图片</a></li>
<li><a href="https://stackoverflow.com/questions/37964187/preload-multiple-images-with-glide">java - Preload multiple images with Glide - Stack Overflow</a></li>
</ul>
<h2 id="主要介绍Android图片OutOfMemory异常bitmap-size-exceeds-VM-budget的原因及解决方法，顺带提及Dalvik-heap-size"><a href="#主要介绍Android图片OutOfMemory异常bitmap-size-exceeds-VM-budget的原因及解决方法，顺带提及Dalvik-heap-size" class="headerlink" title="主要介绍Android图片OutOfMemory异常bitmap size exceeds VM budget的原因及解决方法，顺带提及Dalvik heap size"></a><a href="http://www.trinea.cn/android/android-image-outofmemory-bitmap-size-exceeds-vm-budget/">主要介绍Android图片OutOfMemory异常bitmap size exceeds VM budget的原因及解决方法，顺带提及Dalvik heap size</a></h2>]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>android中单图分享：微信好友、QQ好友、微博、本地</title>
    <url>/android/%E5%8D%95%E5%9B%BE%E5%88%86%E4%BA%AB/</url>
    <content><![CDATA[<p>qq 需要添加 lib 库：<code>open_sdk_r6008_lite.jar</code></p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">// qq</span></span><br><span class="line">implementation files(<span class="string">&#x27;../libs/open_sdk_r6008_lite.jar&#x27;</span>)</span><br><span class="line"><span class="comment">// 微博</span></span><br><span class="line">implementation <span class="string">&quot;com.sina.weibo.sdk:core:$WEIBO_VERSION&quot;</span></span><br><span class="line"><span class="comment">// wechat</span></span><br><span class="line">implementation <span class="string">&quot;com.tencent.mm.opensdk:wechat-sdk-android-without-mta:$WECHAT_VERSION&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="方案-1"><a href="#方案-1" class="headerlink" title="方案 1"></a>方案 1</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Uposter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [Android 分享功能之 微信 图片分享 - 陈三哥 - CSDN博客](https://blog.csdn.net/brokge/article/details/51851625)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shareWeChatFriend</span><span class="params">(Activity context, String path)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// [java - exposed beyond app through ClipData.Item.getUri - Stack Overflow](https://stackoverflow.com/questions/48117511/exposed-beyond-app-through-clipdata-item-geturi)</span></span><br><span class="line">            <span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> FileProvider.getUriForFile(context.getApplicationContext(), context.getPackageName() + <span class="string">&quot;.provider&quot;</span>, <span class="keyword">new</span> <span class="title class_">File</span>(path));</span><br><span class="line"></span><br><span class="line">            <span class="type">Intent</span> <span class="variable">shareIntent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">            <span class="comment">//发送图片到朋友圈</span></span><br><span class="line">            <span class="comment">//ComponentName comp = new ComponentName(&quot;com.tencent.mm&quot;, &quot;com.tencent.mm.ui.tools.ShareToTimeLineUI&quot;);</span></span><br><span class="line">            <span class="comment">//发送图片给好友。</span></span><br><span class="line">            <span class="type">ComponentName</span> <span class="variable">comp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComponentName</span>(<span class="string">&quot;com.tencent.mm&quot;</span>, <span class="string">&quot;com.tencent.mm.ui.tools.ShareImgUI&quot;</span>);</span><br><span class="line">            shareIntent.setComponent(comp);</span><br><span class="line">            shareIntent.setAction(Intent.ACTION_SEND);</span><br><span class="line">            shareIntent.putExtra(Intent.EXTRA_STREAM, uri);</span><br><span class="line">            shareIntent.setType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">            context.startActivity(Intent.createChooser(shareIntent, <span class="string">&quot;分享图片&quot;</span>));</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [QQ分享官方第三方接入（分享纯图片及截取view的bitmap图） - haibo_bear的博客 - CSDN博客](https://blog.csdn.net/haibo_bear/article/details/51321204)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shareToQQFriend</span><span class="params">(Activity context, String path)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">Tencent</span> <span class="variable">tencent</span> <span class="operator">=</span> Tencent.createInstance(QQ_APP_ID, context);</span><br><span class="line">            <span class="type">Bundle</span> <span class="variable">shareParams</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bundle</span>();</span><br><span class="line">            shareParams.putInt(QQShare.SHARE_TO_QQ_KEY_TYPE, QQShare.SHARE_TO_QQ_TYPE_IMAGE);</span><br><span class="line">            shareParams.putString(QQShare.SHARE_TO_QQ_IMAGE_LOCAL_URL, path);</span><br><span class="line">            shareParams.putString(QQShare.SHARE_TO_QQ_APP_NAME, context.getResources().getString(R.string.app_name));</span><br><span class="line">            shareParams.putInt(QQShare.SHARE_TO_QQ_EXT_INT, QQShare.SHARE_TO_QQ_FLAG_QZONE_ITEM_HIDE);</span><br><span class="line">            tencent.shareToQQ(context, shareParams, <span class="literal">null</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// [Android 调用系统分享文字、图片、文件，可直达微信、朋友圈、QQ、QQ空间、微博 - 她叫我小渝的个人空间 - OSCHINA](https://my.oschina.net/u/1462828/blog/2086000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shareToWeiboFriend</span><span class="params">(Activity context, String path)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">            intent.setPackage(<span class="string">&quot;com.sina.weibo&quot;</span>);</span><br><span class="line">            intent.setAction(Intent.ACTION_SEND);</span><br><span class="line">            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">            <span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> FileProvider.getUriForFile(context.getApplicationContext(), context.getPackageName() + <span class="string">&quot;.provider&quot;</span>, <span class="keyword">new</span> <span class="title class_">File</span>(path));</span><br><span class="line">            intent.putExtra(Intent.EXTRA_STREAM, uri);</span><br><span class="line">            intent.setType(<span class="string">&quot;image/*&quot;</span>);   <span class="comment">//分享文件</span></span><br><span class="line">            context.startActivity(Intent.createChooser(intent, <span class="string">&quot;分享&quot;</span>));</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">saveImage</span><span class="params">(Activity context, String path)</span> &#123;</span><br><span class="line">        <span class="comment">// [How can I display images from a specific folder on android gallery - Stack Overflow](https://stackoverflow.com/questions/13418807/how-can-i-display-images-from-a-specific-folder-on-android-gallery)</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">SingleMediaScanner</span> <span class="keyword">implements</span> <span class="title class_">MediaScannerConnection</span>.MediaScannerConnectionClient &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> MediaScannerConnection mMs;</span><br><span class="line">            <span class="keyword">private</span> File mFile;</span><br><span class="line">            <span class="keyword">private</span> Context mContext;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> <span class="title function_">SingleMediaScanner</span><span class="params">(Context context, File f)</span> &#123;</span><br><span class="line">                mFile = f;</span><br><span class="line">                mContext = context;</span><br><span class="line">                mMs = <span class="keyword">new</span> <span class="title class_">MediaScannerConnection</span>(context, <span class="built_in">this</span>);</span><br><span class="line">                mMs.connect();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMediaScannerConnected</span><span class="params">()</span> &#123;</span><br><span class="line">                mMs.scanFile(mFile.getAbsolutePath(), <span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onScanCompleted</span><span class="params">(String path, Uri uri)</span> &#123;</span><br><span class="line">                <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW);</span><br><span class="line">                intent.setData(uri);</span><br><span class="line">                mContext.startActivity(intent);</span><br><span class="line">                mMs.disconnect();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">View</span> <span class="variable">v</span> <span class="operator">=</span> context.findViewById(android.R.id.content);</span><br><span class="line">        <span class="type">Snackbar</span> <span class="variable">snackbar</span> <span class="operator">=</span> Snackbar.make(v, <span class="string">&quot;保存成功&quot;</span>, Snackbar.LENGTH_LONG);</span><br><span class="line">        snackbar.setAction(<span class="string">&quot;点击查看&quot;</span>, v1 -&gt; &#123;</span><br><span class="line">            <span class="comment">// showGallery(context);</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">SingleMediaScanner</span>(context, <span class="keyword">new</span> <span class="title class_">File</span>(path));</span><br><span class="line">        &#125;);</span><br><span class="line">        snackbar.show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">showGallery</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        context.startActivity(<span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW,</span><br><span class="line">            Uri.parse(<span class="string">&quot;content://media/internal/images/media&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Uposter.saveImage(mContext, <span class="string">&quot;/sotrage/0/a.jpg&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="方案-2"><a href="#方案-2" class="headerlink" title="方案 2"></a>方案 2</h2><p>或者通过面向对象的方式来实现：</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> interface Share &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(Activity context)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">boolean</span> <span class="title">isInstall</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">execute</span><span class="params">(<span class="type">String</span> path)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">String</span> <span class="title">getNotInstallTip</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其他类实现上面的接口，如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PosterShareWechat</span> <span class="keyword">implements</span> <span class="title class_">PosterShare</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Activity context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(Activity context)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.context = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isInstall</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Uapp.isWechatAvilible(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(String path)</span> &#123;</span><br><span class="line">        <span class="comment">// [Android 分享功能之 微信 图片分享 - 陈三哥 - CSDN博客](https://blog.csdn.net/brokge/article/details/51851625)</span></span><br><span class="line">        <span class="comment">// [java - exposed beyond app through ClipData.Item.getUri - Stack Overflow](https://stackoverflow.com/questions/48117511/exposed-beyond-app-through-clipdata-item-geturi)</span></span><br><span class="line">        <span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> FileProvider.getUriForFile(context.getApplicationContext(), context.getPackageName() + <span class="string">&quot;.provider&quot;</span>, <span class="keyword">new</span> <span class="title class_">File</span>(path));</span><br><span class="line"></span><br><span class="line">        <span class="type">Intent</span> <span class="variable">shareIntent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">        <span class="comment">//发送图片到朋友圈</span></span><br><span class="line">        <span class="comment">//ComponentName comp = new ComponentName(&quot;com.tencent.mm&quot;, &quot;com.tencent.mm.ui.tools.ShareToTimeLineUI&quot;);</span></span><br><span class="line">        <span class="comment">//发送图片给好友。</span></span><br><span class="line">        <span class="type">ComponentName</span> <span class="variable">comp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComponentName</span>(<span class="string">&quot;com.tencent.mm&quot;</span>, <span class="string">&quot;com.tencent.mm.ui.tools.ShareImgUI&quot;</span>);</span><br><span class="line">        shareIntent.setComponent(comp);</span><br><span class="line">        shareIntent.setAction(Intent.ACTION_SEND);</span><br><span class="line">        shareIntent.putExtra(Intent.EXTRA_STREAM, uri);</span><br><span class="line">        shareIntent.setType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">        context.startActivity(Intent.createChooser(shareIntent, <span class="string">&quot;分享图片&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getNotInstallTip</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;您没有安装微信&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>调用方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">posterShare = <span class="keyword">new</span> <span class="title class_">PosterShareWechat</span>();</span><br><span class="line">posterShare.init(context);</span><br><span class="line"><span class="keyword">if</span> (!posterShare.isInstall()) &#123;</span><br><span class="line">    Utoast.show(posterShare.getNotInstallTip());</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">posterShare.execute(path);</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android图片裁剪和上传服务器（含：拍照、图库选取）</title>
    <url>/android/%E5%9B%BE%E7%89%87%E8%A3%81%E5%89%AA%E5%92%8C%E4%B8%8A%E4%BC%A0/</url>
    <content><![CDATA[<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mContext.startActivity(<span class="keyword">new</span> <span class="title class_">Intent</span>(mContext, CropImageActivity.class));</span><br></pre></td></tr></table></figure>

<h2 id="权限声明"><a href="#权限声明" class="headerlink" title="权限声明"></a>权限声明</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.READ_PHONE_STATE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.CAMERA&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.FLASHLIGHT&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="注册Activity"><a href="#注册Activity" class="headerlink" title="注册Activity"></a>注册Activity</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.CropImageActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">&quot;@style/myTransparent&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="注册Provider"><a href="#注册Provider" class="headerlink" title="注册Provider"></a>注册Provider</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;android.support.v4.content.FileProvider&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:authorities</span>=<span class="string">&quot;$&#123;PACKAGE_NAME&#125;.FileProvider&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:grantUriPermissions</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;android.support.FILE_PROVIDER_PATHS&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:resource</span>=<span class="string">&quot;@xml/file_paths&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="透明的theme"><a href="#透明的theme" class="headerlink" title="透明的theme"></a>透明的theme</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;myTransparent&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;@android:style/Theme.DeviceDefault.Light.NoActionBar.Fullscreen&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowBackground&quot;</span>&gt;</span>@color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowNoTitle&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowIsTranslucent&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowAnimationStyle&quot;</span>&gt;</span>@android:style/Animation.Translucent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="xml-file-paths"><a href="#xml-file-paths" class="headerlink" title="xml/file_paths"></a>xml/file_paths</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- res/xml/file_paths --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">paths</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root-path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">path</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">files-path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;files&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">path</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache-path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;cache&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">path</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">external-path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;external&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">path</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">external-files-path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;external_file&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">path</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">external-cache-path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;external_cache&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">path</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="util-uri"><a href="#util-uri" class="headerlink" title="util/uri"></a>util/uri</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 类：SystemProgramUtils 系统程序适配</span></span><br><span class="line"><span class="comment"> * 1. 拍照</span></span><br><span class="line"><span class="comment"> * 2. 相册</span></span><br><span class="line"><span class="comment"> * 3. 裁切</span></span><br><span class="line"><span class="comment"> * 作者： qxc</span></span><br><span class="line"><span class="comment"> * 日期：2018/2/23.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemProgramUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REQUEST_CODE_PAIZHAO</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REQUEST_CODE_ZHAOPIAN</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REQUEST_CODE_CAIQIE</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">paizhao</span><span class="params">(Activity activity, File outputFile)</span> &#123;</span><br><span class="line">        <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">        intent.setAction(<span class="string">&quot;android.media.action.IMAGE_CAPTURE&quot;</span>);</span><br><span class="line">        intent.addCategory(<span class="string">&quot;android.intent.category.DEFAULT&quot;</span>);</span><br><span class="line">        <span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> FileProviderUtils.uriFromFile(activity, outputFile);</span><br><span class="line">        intent.putExtra(MediaStore.EXTRA_OUTPUT, uri);</span><br><span class="line">        activity.startActivityForResult(intent, REQUEST_CODE_PAIZHAO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">zhaopian</span><span class="params">(Activity activity)</span> &#123;</span><br><span class="line">        <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">        intent.setType(<span class="string">&quot;image/*&quot;</span>);</span><br><span class="line">        intent.setAction(<span class="string">&quot;android.intent.action.PICK&quot;</span>);</span><br><span class="line">        intent.addCategory(<span class="string">&quot;android.intent.category.DEFAULT&quot;</span>);</span><br><span class="line">        activity.startActivityForResult(intent, REQUEST_CODE_ZHAOPIAN);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Caiqie</span><span class="params">(Activity activity, Uri uri, File outputFile, <span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;com.android.camera.action.CROP&quot;</span>);</span><br><span class="line">        FileProviderUtils.setIntentDataAndType(activity, intent, <span class="string">&quot;image/*&quot;</span>, uri, <span class="literal">true</span>);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;crop&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;aspectX&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;aspectY&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;outputX&quot;</span>, width);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;outputY&quot;</span>, height);</span><br><span class="line">        <span class="comment">//return-data为true时，直接返回bitmap，可能会很占内存，不建议，小米等个别机型会出异常！！！</span></span><br><span class="line">        <span class="comment">//所以适配小米等个别机型，裁切后的图片，不能直接使用data返回，应使用uri指向</span></span><br><span class="line">        <span class="comment">//裁切后保存的URI，不属于我们向外共享的，所以可以使用fill://类型的URI</span></span><br><span class="line">        <span class="type">Uri</span> <span class="variable">outputUri</span> <span class="operator">=</span> Uri.fromFile(outputFile);</span><br><span class="line">        intent.putExtra(MediaStore.EXTRA_OUTPUT, outputUri);</span><br><span class="line">        intent.putExtra(<span class="string">&quot;return-data&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        intent.putExtra(<span class="string">&quot;outputFormat&quot;</span>, Bitmap.CompressFormat.JPEG.toString());</span><br><span class="line">        intent.putExtra(<span class="string">&quot;noFaceDetection&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        activity.startActivityForResult(intent, REQUEST_CODE_CAIQIE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 类：FileProviderUtils</span></span><br><span class="line"><span class="comment"> * 从APP向外共享的文件URI时，必须使用该类进行适配，否则在7.0以上系统，会报错：FileUriExposedException(文件Uri暴露异常)</span></span><br><span class="line"><span class="comment"> * 作者： qxc</span></span><br><span class="line"><span class="comment"> * 日期：2018/2/23.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileProviderUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从文件获得URI</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activity 上下文</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file     文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文件对应的URI</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Uri <span class="title function_">uriFromFile</span><span class="params">(Activity activity, File file)</span> &#123;</span><br><span class="line">        Uri fileUri;</span><br><span class="line">        <span class="comment">//7.0以上进行适配</span></span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">p</span> <span class="operator">=</span> activity.getPackageName() + <span class="string">&quot;.FileProvider&quot;</span>;</span><br><span class="line">            fileUri = FileProvider.getUriForFile(</span><br><span class="line">                    activity,</span><br><span class="line">                    p,</span><br><span class="line">                    file);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fileUri = Uri.fromFile(file);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fileUri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置Intent的data和类型，并赋予目标程序临时的URI读写权限</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activity  上下文</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> intent    意图</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type      类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file      文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> writeAble 是否赋予可写URI的权限</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setIntentDataAndType</span><span class="params">(Activity activity,</span></span><br><span class="line"><span class="params">                                            Intent intent,</span></span><br><span class="line"><span class="params">                                            String type,</span></span><br><span class="line"><span class="params">                                            File file,</span></span><br><span class="line"><span class="params">                                            <span class="type">boolean</span> writeAble)</span> &#123;</span><br><span class="line">        <span class="comment">//7.0以上进行适配</span></span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">            intent.setDataAndType(uriFromFile(activity, file), type);</span><br><span class="line">            <span class="comment">//临时赋予读写Uri的权限</span></span><br><span class="line">            intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);</span><br><span class="line">            <span class="keyword">if</span> (writeAble) &#123;</span><br><span class="line">                intent.addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            intent.setDataAndType(Uri.fromFile(file), type);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置Intent的data和类型，并赋予目标程序临时的URI读写权限</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context   上下文</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> intent    意图</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type      类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileUri   文件uri</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> writeAble 是否赋予可写URI的权限</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setIntentDataAndType</span><span class="params">(Context context,</span></span><br><span class="line"><span class="params">                                            Intent intent,</span></span><br><span class="line"><span class="params">                                            String type,</span></span><br><span class="line"><span class="params">                                            Uri fileUri,</span></span><br><span class="line"><span class="params">                                            <span class="type">boolean</span> writeAble)</span> &#123;</span><br><span class="line">        <span class="comment">//7.0以上进行适配</span></span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">            intent.setDataAndType(fileUri, type);</span><br><span class="line">            <span class="comment">//临时赋予读写Uri的权限</span></span><br><span class="line">            intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);</span><br><span class="line">            <span class="keyword">if</span> (writeAble) &#123;</span><br><span class="line">                intent.addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            intent.setDataAndType(fileUri, type);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// [Android 拍照，从图库选择照片，并裁剪，上传到服务器 - 简书](https://www.jianshu.com/p/bfd9fe0592cb)</span></span><br><span class="line"><span class="comment">// [拍照/从相册读取图片后进行裁剪的方法 - developer_Kale - 博客园](http://www.cnblogs.com/tianzhijiexian/p/3989296.html)</span></span><br><span class="line"><span class="comment">// [Android 7.0适配 -- FileProvider 拍照、选择相册、裁切图片, 小米机型适配 - 简书](https://www.jianshu.com/p/bec4497c2a63)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CropImageActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> CropImageActivity.class.getSimpleName();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TMP_DIR</span> <span class="operator">=</span> Environment.getExternalStorageDirectory() + <span class="string">&quot;/renrenyoupin/tmp&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> width;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> height;</span><br><span class="line">    <span class="keyword">private</span> File file;</span><br><span class="line">    <span class="keyword">private</span> Activity mContext;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CAMERA_REQUEST_CODE</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        mContext = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (savedInstanceState == <span class="literal">null</span>) &#123;</span><br><span class="line">            initIconFile(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.M) &#123;</span><br><span class="line">                showDialog();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            requestPermission();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initIconFile</span><span class="params">(<span class="type">boolean</span> remove)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">tmpDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(TMP_DIR);</span><br><span class="line">        <span class="keyword">if</span> (!tmpDir.exists()) &#123;</span><br><span class="line">            tmpDir.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        file = <span class="keyword">new</span> <span class="title class_">File</span>(tmpDir.getAbsolutePath(), <span class="string">&quot;icon.png&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (remove &amp;&amp; file.exists()) &#123;</span><br><span class="line">            file.delete();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TargetApi(Build.VERSION_CODES.M)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">requestPermission</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (ContextCompat.checkSelfPermission(mContext, Manifest.permission.CAMERA)</span><br><span class="line">                == PackageManager.PERMISSION_GRANTED</span><br><span class="line">                &amp;&amp; ContextCompat.checkSelfPermission(mContext, Manifest.permission.WRITE_EXTERNAL_STORAGE)</span><br><span class="line">                == PackageManager.PERMISSION_GRANTED</span><br><span class="line">                &amp;&amp; ContextCompat.checkSelfPermission(mContext, Manifest.permission.READ_EXTERNAL_STORAGE)</span><br><span class="line">                == PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">            showDialog();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//申请相机权限和STORAGE权限</span></span><br><span class="line">            ActivityCompat.requestPermissions(</span><br><span class="line">                    mContext,</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;Manifest.permission.CAMERA,</span><br><span class="line">                            Manifest.permission.WRITE_EXTERNAL_STORAGE,</span><br><span class="line">                            Manifest.permission.READ_EXTERNAL_STORAGE</span><br><span class="line">                    &#125;,</span><br><span class="line">                    CAMERA_REQUEST_CODE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onRequestPermissionsResult</span><span class="params">(<span class="type">int</span> requestCode, String[] permissions, <span class="type">int</span>[] grantResults)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line">        <span class="keyword">if</span> (requestCode == CAMERA_REQUEST_CODE) &#123;</span><br><span class="line">            <span class="keyword">if</span> (grantResults[<span class="number">0</span>] == PackageManager.PERMISSION_GRANTED</span><br><span class="line">                    &amp;&amp; grantResults[<span class="number">1</span>] == PackageManager.PERMISSION_GRANTED</span><br><span class="line">                    &amp;&amp; grantResults[<span class="number">2</span>] == PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                showDialog();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;没有相关运行权限&quot;</span>;</span><br><span class="line">                <span class="comment">//Toast.makeText(mContext, msg, Toast.LENGTH_SHORT).show();</span></span><br><span class="line">                backWithError(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">showDialog</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> getIntent();</span><br><span class="line">        width = intent.getIntExtra(<span class="string">&quot;width&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        height = intent.getIntExtra(<span class="string">&quot;height&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (width == <span class="number">0</span>) &#123;</span><br><span class="line">            width = <span class="number">350</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (height == <span class="number">0</span>) &#123;</span><br><span class="line">            height = <span class="number">350</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(<span class="built_in">this</span>)</span><br><span class="line">                .setTitle(<span class="string">&quot;更换头像&quot;</span>)</span><br><span class="line">                .setItems(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;拍照&quot;</span>, <span class="string">&quot;从相册选择&quot;</span>,&#125;, (dialog, which) -&gt; &#123;</span><br><span class="line">                    <span class="keyword">switch</span> (which) &#123;</span><br><span class="line">                        <span class="keyword">case</span> <span class="number">0</span>:<span class="comment">//拍照</span></span><br><span class="line">                            SystemProgramUtils.paizhao(mContext, file);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="number">1</span>:<span class="comment">//从相册选择</span></span><br><span class="line">                            SystemProgramUtils.zhaopian(mContext);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .setOnCancelListener(dialog -&gt; finish())</span><br><span class="line">                .create()</span><br><span class="line">                .show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onActivityResult</span><span class="params">(<span class="type">int</span> requestCode, <span class="type">int</span> resultCode, Intent data)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (requestCode != SystemProgramUtils.REQUEST_CODE_PAIZHAO &amp;&amp; data == <span class="literal">null</span>) &#123;</span><br><span class="line">            finish();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Bitmap bitmap;</span><br><span class="line">        Uri uri;</span><br><span class="line">        <span class="keyword">switch</span> (requestCode) &#123;</span><br><span class="line">            <span class="keyword">case</span> SystemProgramUtils.REQUEST_CODE_PAIZHAO:     <span class="comment">// 从相机跳回来</span></span><br><span class="line">                <span class="keyword">if</span> (resultCode == Activity.RESULT_CANCELED) &#123;</span><br><span class="line">                    finish();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (file == <span class="literal">null</span>) &#123;</span><br><span class="line">                    initIconFile(<span class="literal">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">                    backWithError(<span class="string">&quot;拍照异常&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 启动裁剪器</span></span><br><span class="line">                SystemProgramUtils.Caiqie(mContext, FileProviderUtils.uriFromFile(mContext, file), file, width, height);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> SystemProgramUtils.REQUEST_CODE_ZHAOPIAN:     <span class="comment">// 从图库跳回来</span></span><br><span class="line">                <span class="comment">// 此处的uri 是content类型的。 还有一种是file 型的。应该转换为后者</span></span><br><span class="line">                uri = data.getData();</span><br><span class="line">                <span class="keyword">if</span> (uri == <span class="literal">null</span>) &#123;</span><br><span class="line">                    backWithError(<span class="string">&quot;图片无效&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                SystemProgramUtils.Caiqie(mContext, uri, file, width, height);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> SystemProgramUtils.REQUEST_CODE_CAIQIE:     <span class="comment">// 从裁剪处跳回来</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    uri = Uri.fromFile(file);</span><br><span class="line">                    bitmap = BitmapFactory.decodeStream(getContentResolver().openInputStream(uri));</span><br><span class="line">                    <span class="comment">// 方法1</span></span><br><span class="line">                    uri = saveBitmap(bitmap);</span><br><span class="line">                    <span class="keyword">if</span> (uri == <span class="literal">null</span>) &#123;</span><br><span class="line">                        backWithError(<span class="string">&quot;裁剪失败&quot;</span>);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    sentImage(uri.getPath());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sentImage</span><span class="params">(String path)</span> &#123;</span><br><span class="line">        UokHttp.init().postImageFile(<span class="keyword">new</span> <span class="title class_">ICallBack</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">getUrl</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> APP_URL + <span class="string">&quot;/android/user_center/person/edit_avatar&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doResponse</span><span class="params">(JSONObject responseInfo)</span> &#123;</span><br><span class="line">                backWithSuccess(responseInfo);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doError</span><span class="params">(String errorMsg)</span> &#123;</span><br><span class="line">                backWithError(errorMsg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">backWithSuccess</span><span class="params">(JSONObject responseInfo)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (Rryp.instance != <span class="literal">null</span> &amp;&amp; Rryp.instance.getCurrentCallbackContext() != <span class="literal">null</span>) &#123;</span><br><span class="line">            Rryp.instance.getCurrentCallbackContext().success(responseInfo);</span><br><span class="line">        &#125;</span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">backWithError</span><span class="params">(String errorMsg)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (Rryp.instance != <span class="literal">null</span> &amp;&amp; Rryp.instance.getCurrentCallbackContext() != <span class="literal">null</span>) &#123;</span><br><span class="line">            Rryp.instance.getCurrentCallbackContext().error(errorMsg);</span><br><span class="line">        &#125;</span><br><span class="line">        finish();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把 Bitmap 保存在SD卡路径后，返回file 类型的 uri</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bm</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Uri <span class="title function_">saveBitmap</span><span class="params">(Bitmap bm)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (bm == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line">            bm.compress(Bitmap.CompressFormat.PNG, <span class="number">80</span>, fos);</span><br><span class="line">            fos.flush();</span><br><span class="line">            fos.close();</span><br><span class="line">            <span class="keyword">return</span> Uri.fromFile(file);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://www.jianshu.com/p/bfd9fe0592cb">Android 拍照，从图库选择照片，并裁剪，上传到服务器 - 简书</a></li>
<li><a href="http://www.cnblogs.com/tianzhijiexian/p/3989296.html">拍照/从相册读取图片后进行裁剪的方法 - developer_Kale - 博客园</a></li>
<li><a href="https://www.jianshu.com/p/bec4497c2a63">Android 7.0适配 – FileProvider 拍照、选择相册、裁切图片, 小米机型适配 - 简书</a></li>
</ul>
]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>基于委托的SharedPreference封装</title>
    <url>/android/%E5%9F%BA%E4%BA%8E%E5%A7%94%E6%89%98%E7%9A%84SharedPreference%E5%B0%81%E8%A3%85/</url>
    <content><![CDATA[<h2 id="委托教程"><a href="#委托教程" class="headerlink" title="委托教程"></a>委托教程</h2><ul>
<li><a href="https://www.kotlincn.net/docs/reference/delegated-properties.html">委托属性 - Kotlin 语言中文站</a></li>
</ul>
<p>关于委托的教程，具体参考上面链接即可，下面直接给出<code>SharedPreferences</code>封装的代码。</p>
<h2 id="SharedPreference-封装"><a href="#SharedPreference-封装" class="headerlink" title="SharedPreference 封装"></a>SharedPreference 封装</h2><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DefaultSPreference</span>&lt;<span class="type">T</span>&gt;(key: String, defaultValue: T) :</span><br><span class="line">    SPreference&lt;T&gt;(<span class="string">&quot;default&quot;</span>, key, defaultValue)</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">SPreference</span>&lt;<span class="type">T</span>&gt;(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> spName: String,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> key: String,</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> defaultValue: T</span><br><span class="line">) : ReadWriteProperty&lt;Any?, T&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> prefs: SharedPreferences <span class="keyword">by</span> lazy &#123;</span><br><span class="line">        App.instance.getSharedPreferences(spName, Context.MODE_PRIVATE)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(thisRef: <span class="type">Any</span>?, property: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: T &#123;</span><br><span class="line">        <span class="keyword">return</span> findPreference(key, defaultValue)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(thisRef: <span class="type">Any</span>?, property: <span class="type">KProperty</span>&lt;*&gt;, value: <span class="type">T</span>)</span></span> &#123;</span><br><span class="line">        putPreference(key, value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">findPreference</span><span class="params">(name: <span class="type">String</span>, default: <span class="type">T</span>)</span></span>: T = with(prefs) &#123;</span><br><span class="line">        <span class="keyword">val</span> res: Any = <span class="keyword">when</span> (default) &#123;</span><br><span class="line">            <span class="keyword">is</span> <span class="built_in">Long</span> -&gt; getLong(name, default)</span><br><span class="line">            <span class="keyword">is</span> String -&gt; getString(name, default) ?: default</span><br><span class="line">            <span class="keyword">is</span> <span class="built_in">Int</span> -&gt; getInt(name, default)</span><br><span class="line">            <span class="keyword">is</span> <span class="built_in">Boolean</span> -&gt; getBoolean(name, default)</span><br><span class="line">            <span class="keyword">is</span> <span class="built_in">Float</span> -&gt; getFloat(name, default)</span><br><span class="line">            <span class="keyword">else</span> -&gt; <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;This type can not be resolved in SpPreferences&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Suppress(<span class="string">&quot;UNCHECKED_CAST&quot;</span>)</span></span><br><span class="line">        res <span class="keyword">as</span> T</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;U&gt;</span> <span class="title">putPreference</span><span class="params">(name: <span class="type">String</span>, value: <span class="type">U</span>)</span></span> = with(prefs.edit()) &#123;</span><br><span class="line">        <span class="keyword">when</span> (value) &#123;</span><br><span class="line">            <span class="keyword">is</span> <span class="built_in">Long</span> -&gt; putLong(name, value)</span><br><span class="line">            <span class="keyword">is</span> String -&gt; putString(name, value)</span><br><span class="line">            <span class="keyword">is</span> <span class="built_in">Int</span> -&gt; putInt(name, value)</span><br><span class="line">            <span class="keyword">is</span> <span class="built_in">Boolean</span> -&gt; putBoolean(name, value)</span><br><span class="line">            <span class="keyword">is</span> <span class="built_in">Float</span> -&gt; putFloat(name, value)</span><br><span class="line">            <span class="keyword">else</span> -&gt; <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;This type can not be saved into SpPreferences&quot;</span>)</span><br><span class="line">        &#125;.apply()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> SPreference<span class="type">&lt;T&gt;</span>.<span class="title">remove</span><span class="params">(key: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    prefs.edit().remove(key).apply()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> SPreference<span class="type">&lt;T&gt;</span>.<span class="title">clear</span><span class="params">()</span></span> &#123;</span><br><span class="line">    prefs.edit().clear().apply()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a: String <span class="keyword">by</span> DefaultSPreference(Key.SCHEDULE_ITEM_A.name, <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>通过上面的委托，给 <code>a</code> 赋值就直接保存到 SharedPreferences 文件中了。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">a = <span class="string">&quot;your value here&quot;</span></span><br></pre></td></tr></table></figure>

<p>当获取 <code>a</code> 的值时，实际调用的就是 SharedPreferences 中<code>key</code>对应的值</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">toast(a)</span><br></pre></td></tr></table></figure>

<p>如果使用了 data-binding，可以直接把 <code>a</code>，传递给 <code>EditText</code>，<br>当页面加载后， <code>EditText</code> 中的值就会被 <code>a</code> 填充；<br>当 <code>EditText</code> 中的文字变化时，就会存到 SharedPreferences 中。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/editTextA&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:inputType</span>=<span class="string">&quot;none&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">&quot;10dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;@=&#123;data.a&#125;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h2><p>可以在<code>flow</code>项目中查看更多细节 <code>https://github.com/lyloou/flow</code></p>
<p>参考资料：《kotlin for android developers》中文版——泛型 preference 委托</p>
]]></content>
      <tags>
        <tag>android</tag>
        <tag>kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>Android启动屏和引导页</title>
    <url>/android/%E5%90%AF%E5%8A%A8%E5%B1%8F%E5%92%8C%E5%BC%95%E5%AF%BC%E9%A1%B5/</url>
    <content><![CDATA[<ul>
<li><a href="https://www.jianshu.com/p/2368218b60b6">Android技巧1：启动屏+功能引导页 - 简书</a></li>
<li><a href="https://github.com/bingoogolapple/BGABanner-Android">BGABanner-Android</a></li>
</ul>
<h2 id="启动app的时候闪黑屏？"><a href="#启动app的时候闪黑屏？" class="headerlink" title="启动app的时候闪黑屏？"></a>启动app的时候闪黑屏？</h2><p>可以用自己app的logo来代替黑屏，且看如下配置：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- res/drawable/welcome_bg --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layer-list</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">color</span> <span class="attr">android:color</span>=<span class="string">&quot;@color/colorPrimary&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bitmap</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:src</span>=<span class="string">&quot;@mipmap/screen&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:tileMode</span>=<span class="string">&quot;disabled&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- add below code to your style.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;WelcomeAppTheme&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;@android:style/Theme.DeviceDefault.NoActionBar.Fullscreen&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowBackground&quot;</span>&gt;</span>@drawable/welcome_bg<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="预加载主内容"><a href="#预加载主内容" class="headerlink" title="预加载主内容"></a>预加载主内容</h2><p>为了在展示欢迎页的时候提前加载，我们调换下MainActivity和WelcomeActivity顺序</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- add below code to your AndroidMainfest.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:configChanges</span>=<span class="string">&quot;orientation|keyboardHidden|keyboard|screenSize|locale&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:launchMode</span>=<span class="string">&quot;singleTop&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.WelcomeActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">&quot;@style/WelcomeAppTheme&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    toNext();</span><br><span class="line"></span><br><span class="line">    initData();</span><br><span class="line">    initView();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">toNext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (MyApplication.sSkipWelcome) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    MyApplication.sSkipWelcome = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>, WelcomeActivity.class);</span><br><span class="line">    startActivity(intent);</span><br><span class="line">    overridePendingTransition(<span class="number">0</span>, <span class="number">0</span>); <span class="comment">// 禁用动画</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以参考： <a href="https://github.com/lyloou/lou/blob/demo/test/src/main/AndroidManifest.xml">https://github.com/lyloou/lou/blob/demo/test/src/main/AndroidManifest.xml</a></p>
<h2 id="启动已经存在的activity栈"><a href="#启动已经存在的activity栈" class="headerlink" title="启动已经存在的activity栈"></a>启动已经存在的<code>activity</code>栈</h2><ul>
<li><a href="https://stackoverflow.com/questions/15359124/resume-the-activity-instead-of-starting-if-already-exists-in-back-stack">android - Resume the Activity instead of Starting if already exists in back stack - Stack Overflow</a><figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">You can<span class="built_in"> add </span>this two lines<span class="built_in"> and </span>try:</span><br><span class="line"></span><br><span class="line">    intent.addFlags(Intent.F<span class="class">LAG_ACTIVITY_CLEAR_TOP);</span></span><br><span class="line">    intent.addFlags(Intent.F<span class="class">LAG_ACTIVITY_NEW_TASK);</span></span><br><span class="line"></span><br><span class="line">Write this in your manifest file inside Activity</span><br><span class="line"></span><br><span class="line">    &lt;activity</span><br><span class="line">        android:name=<span class="string">&quot;.SettingsActivity&quot;</span></span><br><span class="line">        android:launchMode=<span class="string">&quot;singleInstance&quot;</span></span><br><span class="line">        android:screenOrientation=<span class="string">&quot;portrait&quot;</span> &gt;</span><br><span class="line">    &lt;/activity&gt;</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;singleTask&quot;</span><span class="built_in"> and </span><span class="string">&quot;singleInstance&quot;</span> activities can only begin a task. They are always at the root of the activity stack. Moreover, the device can hold only one<span class="built_in"> instance </span>of the activity at a time — only one such task.</span><br><span class="line"></span><br><span class="line">You can use SingleTask<span class="built_in"> or </span>SingleInstance</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;singleTask&quot;</span> - The<span class="keyword"> system</span> creates the activity at the root of a<span class="built_in"> new </span>task<span class="built_in"> and </span>routes the intent to it. However,<span class="built_in"> if </span>an<span class="built_in"> instance </span>of the activity already exists, the<span class="keyword"> system</span> routes the intent to existing<span class="built_in"> instance </span>through a call to its onNewIntent() method, rather than creating a<span class="built_in"> new </span>one.</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;singleInstance&quot;</span> - Same as <span class="string">&quot;singleTask&quot;</span>, except that the<span class="keyword"> system</span> doesn&#x27;t launch any other activities into the task holding the instance. The activity is always the single<span class="built_in"> and </span>only member of its task.</span><br><span class="line"></span><br><span class="line">Refer this link http://developer.android.com/guide/topics/manifest/activity-element.html</span><br></pre></td></tr></table></figure></li>
</ul>
<p>可以参考： <a href="https://github.com/lyloou/lou/blob/demo/test/src/main/java/com/lyloou/test/WelcomeActivity.java">https://github.com/lyloou/lou/blob/demo/test/src/main/java/com/lyloou/test/WelcomeActivity.java</a></p>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android学习资料</title>
    <url>/android/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/</url>
    <content><![CDATA[<h2 id="电子书"><a href="#电子书" class="headerlink" title="电子书"></a>电子书</h2><h3 id="https-github-com-futurice-android-best-practices"><a href="#https-github-com-futurice-android-best-practices" class="headerlink" title="https://github.com/futurice/android-best-practices"></a><a href="https://github.com/futurice/android-best-practices">https://github.com/futurice/android-best-practices</a></h3><h3 id="Android-开发最佳实践"><a href="#Android-开发最佳实践" class="headerlink" title="Android 开发最佳实践"></a><a href="http://www.kancloud.cn/thinkphp/android-best-practices">Android 开发最佳实践</a></h3><ul>
<li>Gradle 配置(例如：使用 Maven 依赖方案代替使用导入jar包方案、通过<code>gradle.properties</code>配置敏感信息)</li>
<li>如何安排包的结构；<a href="https://www.kancloud.cn/thinkphp/android-best-practices/42171">https://www.kancloud.cn/thinkphp/android-best-practices/42171</a></li>
<li>资源文件命名推荐；<a href="https://www.kancloud.cn/thinkphp/android-best-practices/42175">https://www.kancloud.cn/thinkphp/android-best-practices/42175</a></li>
</ul>
<h3 id="Android-Studio-使用艺术"><a href="#Android-Studio-使用艺术" class="headerlink" title="Android Studio 使用艺术"></a><a href="https://www.gitbook.com/book/quanke/android-studio/details">Android Studio 使用艺术</a></h3><h2 id="Android-Best-Practices"><a href="#Android-Best-Practices" class="headerlink" title="Android Best Practices"></a><a href="https://github.com/futurice/android-best-practices">Android Best Practices</a></h2><h2 id="牛人网址"><a href="#牛人网址" class="headerlink" title="牛人网址"></a>牛人网址</h2><ul>
<li><a href="http://keeganlee.me/archive">Keegan小钢</a></li>
<li><a href="http://stormzhang.com/">stormzhang</a></li>
<li><a href="http://droidyue.com/">技术小黑屋</a></li>
<li><a href="http://androiddevtools.cn/">AndroidDevTools</a></li>
<li><a href="http://blog.csdn.net/guolin_blog">郭霖的专栏</a></li>
<li><a href="http://www.importnew.com/">ImportNew</a></li>
<li><a href="http://www.trinea.cn/">Trinea</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Android安全性</title>
    <url>/android/%E5%AE%89%E5%85%A8/</url>
    <content><![CDATA[<h2 id="网络安全性配置"><a href="#网络安全性配置" class="headerlink" title="网络安全性配置"></a>网络安全性配置</h2><ul>
<li><a href="https://developer.android.com/training/articles/security-config">网络安全性配置  |  Android Developers</a></li>
<li><a href="https://www.jianshu.com/p/57047a84e559">Android P(9.0) http 网络请求的问题 - 简书</a></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- res/xml/network_security_config.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">network-security-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base-config</span> <span class="attr">cleartextTrafficPermitted</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">network-security-config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:networkSecurityConfig</span>=<span class="string">&quot;@xml/network_security_config&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android中的小技巧</title>
    <url>/android/%E5%B0%8F%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h2 id="双击-view-执行-runnable"><a href="#双击-view-执行-runnable" class="headerlink" title="双击 view 执行 runnable"></a>双击 view 执行 runnable</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setDoubleClickRunnable</span><span class="params">(View view, Runnable task)</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">DoubleClick</span>().click(view, task);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DoubleClick</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 双击 View 触发 task</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">click</span><span class="params">(View view, Runnable task)</span> &#123;</span><br><span class="line">        view.setOnClickListener(v -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (++count &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">                task.run();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Timer</span>().schedule(<span class="keyword">new</span> <span class="title class_">TimerTask</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                    count = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">500</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如：双击回到顶部</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 双击 toolbar，让 webivew 回到顶部</span></span><br><span class="line">Uview.setDoubleClickRunnable(mToolbar, () -&gt; mWebView.scrollTo(<span class="number">0</span>, <span class="number">0</span>));</span><br></pre></td></tr></table></figure>

<h2 id="按返回键，返回到桌面而不销毁程序"><a href="#按返回键，返回到桌面而不销毁程序" class="headerlink" title="按返回键，返回到桌面而不销毁程序"></a>按返回键，返回到桌面而不销毁程序</h2><p>解决办法：在需要退出的地方，使用<code>Activity.moveTaskToBack(true)</code>方法</p>
<h3 id="具体代码："><a href="#具体代码：" class="headerlink" title="具体代码："></a>具体代码：</h3><figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onKeyDown</span><span class="params">(<span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(keyCode == KeyEvent.KEYCODE_BACK &amp;&amp; mContext.isTaskRoot())&#123;</span><br><span class="line">        moveTaskToBack(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onKeyDown</span><span class="params">(keyCode, event)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="http://blog.csdn.net/nihaoqiulinhe/article/details/16822279">Android 按返回键退出程序但不销毁</a></li>
</ul>
<h2 id="跳过欢迎界面时机"><a href="#跳过欢迎界面时机" class="headerlink" title="跳过欢迎界面时机"></a>跳过欢迎界面时机</h2><p>原理：使用 Application 的生命周期。（在后台未被清理的时候，再次打开程序时 Application 的<code>onCreate()</code>方法不会再执行。）</p>
<p>关于 Application 的 onCreate()方法：<br>在应用的第一个组件启动之前，系统会先调用此方法。</p>
<h3 id="外部链接-1"><a href="#外部链接-1" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="http://blog.csdn.net/ly1414725328/article/details/50752123">【Android】启动时跳过欢迎界面的时机</a></li>
<li><a href="http://www.cnblogs.com/renqingping/archive/2012/10/24/Application.html">Android 中 Application 类用法</a><blockquote>
<p>Application 对象的生命周期是整个程序中最长的，它的生命周期就等于这个程序的生命周期。<br>因为它是全局的单例的，所以在不同的 Activity,Service 中获得的对象都是同一个对象。<br>所以可以通过 Application 来进行一些，<br>如：数据传递、数据共享和数据缓存等操作。</p>
</blockquote>
</li>
<li><a href="http://www.molingyu.com/blog/2015/05/12/application%E4%B8%8Eactivity%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/">Application 与 Activity 的生命周期</a></li>
</ul>
<h2 id="给-Activity-添加快捷方式到桌面"><a href="#给-Activity-添加快捷方式到桌面" class="headerlink" title="给 Activity 添加快捷方式到桌面"></a>给 Activity 添加快捷方式到桌面</h2><h3 id="外部链接-2"><a href="#外部链接-2" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="http://stackoverflow.com/questions/21542409/home-screen-app-shortcut-is-not-working-android-app-isnt-installed">home screen app shortcut is not working android. app isn’t installed</a></li>
<li><a href="http://blog.zanlabs.com/2015/03/14/android-shortcut-summary/">Android 桌面快捷方式那些事与那些坑</a></li>
</ul>
<h2 id="运行-java-文件"><a href="#运行-java-文件" class="headerlink" title="运行 java 文件"></a>运行 java 文件</h2><p>在 Android Studio 中的 app module 中运行 Java 测试代码，会发现很慢；<br>可以尝试创建 java library 模块来运行 java 测试今古代码；</p>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android中布局技巧</title>
    <url>/android/%E5%B8%83%E5%B1%80%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h2 id="使用tools属性"><a href="#使用tools属性" class="headerlink" title="使用tools属性"></a>使用<code>tools</code>属性</h2><h3 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0309/2567.html">android中xml tools属性详解</a></li>
<li><a href="http://tools.android.com/tech-docs/tools-attributes">Tools Attributes</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android中巧用官方自带View —— 导航</title>
    <url>/android/%E5%AF%BC%E8%88%AA/</url>
    <content><![CDATA[<h2 id="TabLayout"><a href="#TabLayout" class="headerlink" title="TabLayout"></a>TabLayout</h2><ul>
<li>步骤：<ol>
<li>布局（TabLayout和ViewPager位置关系）；</li>
<li>自定义Adapter（继承自 FragmentPagerAdapter），并配置Fragment和tab标题内容；</li>
<li>java代码中给ViewPager绑定Adapter；</li>
</ol>
</li>
</ul>
<ol>
<li><p>布局</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">merge</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;0.1dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;@color/tab_sep&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.TabLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/sliding_tabs&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;@style/MyCustomTabLayout&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:tabMode</span>=<span class="string">&quot;fixed&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;0.1dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;@color/tab_sep&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.view.ViewPager</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/viewpager&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;0px&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">merge</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>自定义Adapter</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModeListVpAdapter</span> <span class="keyword">extends</span> <span class="title class_">FragmentPagerAdapter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String mTabTitles[];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Mode.Position[] mPosition = Mode.Position.values();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">PAGE_COUNT</span> <span class="operator">=</span> mPosition.length;</span><br><span class="line">    <span class="keyword">private</span> Context mContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ModeListVpAdapter</span><span class="params">(FragmentManager fm, Context context)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(fm);</span><br><span class="line">        mContext = context;</span><br><span class="line">        mTabTitles = context.getResources().getStringArray(R.array.main_tabs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> PAGE_COUNT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Fragment <span class="title function_">getItem</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ModeListFragment.newInstance(position); <span class="comment">// 根据position返回对应的fragment</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CharSequence <span class="title function_">getPageTitle</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mTabTitles[position]; <span class="comment">// 根据position返回对应的tab标题</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>绑定</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ViewPager</span> <span class="variable">viewPager</span> <span class="operator">=</span> (ViewPager) findViewById(R.id.viewpager);</span><br><span class="line">viewPager.setAdapter(<span class="keyword">new</span> <span class="title class_">ModeListVpAdapter</span>(getSupportFragmentManager(), mContext));</span><br><span class="line"></span><br><span class="line"><span class="type">TabLayout</span> <span class="variable">tabLayout</span> <span class="operator">=</span> (TabLayout) findViewById(R.id.sliding_tabs);</span><br><span class="line">tabLayout.setupWithViewPager(viewPager);</span><br><span class="line">viewPager.setCurrentItem(<span class="number">2</span>); <span class="comment">// 默认选中第二个tab</span></span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><a href="https://guides.codepath.com/android/google-play-style-tabs-using-tablayout">Google Play Style Tabs using TabLayout</a></li>
</ul>
<h2 id="DrawerLayout-amp-NavigationView"><a href="#DrawerLayout-amp-NavigationView" class="headerlink" title="DrawerLayout &amp; NavigationView"></a>DrawerLayout &amp; NavigationView</h2><ul>
<li>NavigationView隐藏menu：不使用app:menu属性即可；</li>
<li>给NavigationView头部布局组件设置点击事件：可以通过<code>mNavView.getHeaderView(0)</code>获取根布局的view引用；</li>
<li>禁用滑动<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// lock</span></span><br><span class="line">mDrawerLayout.setDrawerLockMode(DrawerLayout.LOCK_MODE_LOCKED_CLOSED);</span><br><span class="line"><span class="comment">// unlock</span></span><br><span class="line">mDrawerLayout.setDrawerLockMode(DrawerLayout.LOCK_MODE_UNLOCKED);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="http://stackoverflow.com/questions/17051104/disable-the-swipe-gesture-that-opens-the-navigation-drawer-in-android">disable the swipe gesture that opens the navigation drawer in android</a></li>
<li><a href="http://stackoverflow.com/questions/26440879/how-do-i-use-drawerlayout-to-display-over-the-actionbar-toolbar-and-under-the-st">How do I use DrawerLayout to display over the ActionBar/Toolbar and under the status bar?</a></li>
<li><a href="http://www.jianshu.com/p/3fe2acac0ddb">使用 DrawerLayout 实现 Material Design风格的侧滑</a></li>
</ul>
<h2 id="ToolBar"><a href="#ToolBar" class="headerlink" title="ToolBar"></a>ToolBar</h2><ul>
<li><p>切换fragment时对应显示不同的菜单：<br>通过控制自定义的标志，然后调用<code>invalidateOptionsMenu();</code>刷新菜单即可；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">onPrepareOptionsPanel</span><span class="params">(View view, Menu menu)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mMode == DEVICE_FRAGMENT) &#123;</span><br><span class="line">        menu.findItem(R.id.action_add).setVisible(<span class="literal">true</span>);</span><br><span class="line">        menu.findItem(R.id.action_ok).setVisible(<span class="literal">false</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mMode == SETTING_TIME_FRAGMENT) &#123;</span><br><span class="line">        menu.findItem(R.id.action_add).setVisible(<span class="literal">false</span>);</span><br><span class="line">        menu.findItem(R.id.action_ok).setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.onPrepareOptionsPanel(view, menu);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在Fragment中获取ToolBar对象，并监听点击事件；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Toolbar</span> <span class="variable">toolbar</span> <span class="operator">=</span> (Toolbar) getActivity().findViewById(R.id.toolbar);</span><br><span class="line"><span class="type">TextView</span> <span class="variable">tvTitle</span> <span class="operator">=</span> (TextView) toolbar.findViewById(R.id.tv_nav_title);</span><br><span class="line">tvTitle.setText(<span class="string">&quot;标题1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理toolbar上的菜单点击事件；</span></span><br><span class="line">toolbar.setOnMenuItemClickListener(<span class="keyword">new</span> <span class="title class_">Toolbar</span>.OnMenuItemClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onMenuItemClick</span><span class="params">(MenuItem item)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.action_ok:</span><br><span class="line">                Usp.init(mContext).putInt(CKeys.KEY_TS, indexInTIMES(mRgSettingTime.getCheckedRadioButtonId()));</span><br><span class="line">                Utoast.toastOnMain(mContext, mContext.getString(R.string.time_setting_setted));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="适配"><a href="#适配" class="headerlink" title="适配"></a>适配</h2><blockquote>
<p>Toolbar 里面有两个属性很关键:<br>android:minHeight=”?attr/actionBarSize”,这个表示引用系统 ActionBar 的高度.<br>android:paddingTop=”@dimen/tool_bar_top_padding”这个是来引用资源文件里面的tool_bar_top_padding的高度,这个高度主要是为了对5.0做适配,在5.0 上为24dp,其他版本为0dp</p>
</blockquote>
<h3 id="外部链接-1"><a href="#外部链接-1" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="http://stackoverflow.com/questions/26813991/actionbar-toolbar-not-showing-on-lollipop-version-of-app">ActionBar/Toolbar not showing on Lollipop version of app</a></li>
<li><a href="http://stackoverflow.com/questions/26440879/how-do-i-use-drawerlayout-to-display-over-the-actionbar-toolbar-and-under-the-st">How do I use DrawerLayout to display over the ActionBar/Toolbar and under the status bar?</a></li>
<li><a href="http://www.jianshu.com/p/3fe2acac0ddb">使用 DrawerLayout 实现 Material Design风格的侧滑</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android开源库相关</title>
    <url>/android/%E5%BC%80%E6%BA%90%E5%BA%93/</url>
    <content><![CDATA[<h2 id="ButterKnife注解"><a href="#ButterKnife注解" class="headerlink" title="ButterKnife注解"></a>ButterKnife注解</h2><p><strong>网址</strong>： <a href="https://github.com/JakeWharton/butterknife">https://github.com/JakeWharton/butterknife</a></p>
<p><strong>注意</strong>：如果想要在lib/app中使用Butterknife库，则需要在当前module的build.gradle中添加compile信息;<br>如果你在lib库的build.gradle中引用了Butterknife的compile信息，<br>然后想要在app中直接使用Butterknife，这样的结果是注解失败；就会出现NullpointException;<br><code>https://www.google.com/search?q=NullPointerException+butterknife</code></p>
<p><strong>AS插件</strong>：Android Butterknife Zelezny</p>
<ul>
<li>在使用的时候，注意，把光标放置在<code>R.layout.layout_other</code>上面，点击<code>Alt+Insert</code>，选择<code>Generate ButterKnife Injections</code>；</li>
<li>自定义live template模块：<code>ButterKnife.findById</code> –&gt; <code>fbi</code>。（即按一下fbi，就显示出来<code>ButterKnife.findById(, R.id.)</code>）</li>
</ul>
<p><strong>使用 ButterKnife 可能会让你的IDE编译速度变慢。</strong></p>
<blockquote>
<p>In the initial configuration incremental compilation takes 45s out of 1m 10s, but if Butterknife is removed then project is compiled in 15s only! Three times faster! Whole incremental build without Butterknife is 40s.<br>First and most important, the hypothesis was correct, modularizing project can significantly speed up build process, but not for all configurations.</p>
</blockquote>
<ul>
<li><a href="https://medium.freecodecamp.org/how-modularisation-affects-build-time-of-an-android-application-43a984ce9968">How modularization can speed up your Android app’s built time</a></li>
</ul>
<h2 id="Volley"><a href="#Volley" class="headerlink" title="Volley"></a>Volley</h2><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ul>
<li>依据application上下文，初始化volley组件；</li>
<li>配置参数和请求数据；</li>
<li>添加到请求队列；</li>
<li>结果处理；</li>
</ul>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>一般情况下，用get和post两种请求方式；<br>post请求使用：StringRequest对象；<br>get请求使用：JsonObjectRequest对象；</p>
<h3 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="https://github.com/mcxiaoke/android-volley">android-volley</a></li>
<li><a href="http://bxbxbai.github.io/2014/09/14/android-working-with-volley/">Android库Volley的使用介绍</a></li>
</ul>
<h2 id="Stetho-A-debug-bridge-for-Android-applications"><a href="#Stetho-A-debug-bridge-for-Android-applications" class="headerlink" title="Stetho - A debug bridge for Android applications"></a>Stetho - A debug bridge for Android applications</h2><blockquote>
<p>Stetho is a debug bridge for Android applications from Facebook that integrates with the Chrome desktop browser’s Developer Tools. With Stetho you can easily inspect your application, most notably the network traffic. It also allows you to easily inspect and edit SQLite databases and the shared preferences in your app. You should, however, make sure that Stetho is only enabled in the debug build and not in the release build variant.<br><a href="https://github.com/futurice/android-best-practices#use-stetho">https://github.com/futurice/android-best-practices#use-stetho</a></p>
</blockquote>
<h2 id="AndroidUtilCode"><a href="#AndroidUtilCode" class="headerlink" title="AndroidUtilCode"></a><a href="https://github.com/Blankj/AndroidUtilCode">AndroidUtilCode</a></h2><blockquote>
<p> Android developers should collect the following utils</p>
</blockquote>
<h2 id="BaseMoudle"><a href="#BaseMoudle" class="headerlink" title="BaseMoudle"></a><a href="https://github.com/xiaoxiangyeyuHeaven/BaseMoudle">BaseMoudle</a></h2><blockquote>
<p>BaseMoudle是一个支持rxjava+retrofit2+mvp 同时支持mvc开发的一款框架</p>
</blockquote>
<h2 id="UltimateAndroidReference"><a href="#UltimateAndroidReference" class="headerlink" title="UltimateAndroidReference"></a><a href="https://github.com/aritraroy/UltimateAndroidReference">UltimateAndroidReference</a></h2><blockquote>
<p>Ultimate Android Reference - Your Road to Become a Better Android Developer （学习什么？这里清除了）</p>
</blockquote>
<h2 id="MultiType"><a href="#MultiType" class="headerlink" title="MultiType"></a><a href="https://github.com/drakeet/MultiType">MultiType</a></h2><h2 id="Effective-MultiType"><a href="#Effective-MultiType" class="headerlink" title="Effective-MultiType"></a><a href="https://github.com/drakeet/Effective-MultiType">Effective-MultiType</a></h2><blockquote>
<p>现在好了，我们有了 MultiType，简单来说，MultiType 就是一个多类型列表视图的中间分发框架，它能帮助你快速并且清晰地开发一些复杂的列表页面。 它本是为聊天页面开发的，聊天页面的消息类型也是有大量不同种类，且新增频繁，而 MultiType 能够轻松胜任。</p>
</blockquote>
<h2 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h2><p>引入开源库的时候，注意要及时引入 proguard （以免忘记）</p>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android中的广播</title>
    <url>/android/%E5%B9%BF%E6%92%AD/</url>
    <content><![CDATA[<h2 id="BroadcastReceiver"><a href="#BroadcastReceiver" class="headerlink" title="BroadcastReceiver"></a>BroadcastReceiver</h2><ul>
<li>广播是一种可以跨进程的通信方式。（引用自：《第一行代码》p199）</li>
</ul>
<blockquote>
<p>需要注意的是，不要在<code>onReceiver()</code>中添加过多的逻辑或进行任何耗时操作，因为在广播接收器中是不允许开启线程的，<br>当<code>onReceiver()</code>方法运行了较长时间而没有结束时，程序就会报错。因此，广播接收器更多的是扮演一种打开其他组件的角色，<br>比如创建一条状态栏通知，或者启动一个服务等。（引用自：《第一行代码》p196）</p>
</blockquote>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android 弹窗</title>
    <url>/android/%E5%BC%B9%E7%AA%97/</url>
    <content><![CDATA[<h2 id="弹出和隐藏进度条"><a href="#弹出和隐藏进度条" class="headerlink" title="弹出和隐藏进度条"></a>弹出和隐藏进度条</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Dialog dialog;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">showDialog</span><span class="params">(<span class="keyword">final</span> Context ctx)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ctx <span class="keyword">instanceof</span> Activity) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Activity</span> <span class="variable">context</span> <span class="operator">=</span> (Activity) ctx;</span><br><span class="line">        context.runOnUiThread(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">spacing</span> <span class="operator">=</span> Uscreen.dp2Px(context, <span class="number">16</span>);</span><br><span class="line">                <span class="type">LinearLayout</span> <span class="variable">layout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinearLayout</span>(context);</span><br><span class="line">                LinearLayout.<span class="type">LayoutParams</span> <span class="variable">layoutParams</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinearLayout</span>.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT);</span><br><span class="line">                layout.setLayoutParams(layoutParams);</span><br><span class="line">                layout.setGravity(Gravity.CENTER);</span><br><span class="line">                layout.setPadding(spacing, spacing, spacing, spacing);</span><br><span class="line">                <span class="comment">// add ProgressBar</span></span><br><span class="line">                <span class="type">ProgressBar</span> <span class="variable">bar</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProgressBar</span>(context);</span><br><span class="line">                layout.addView(bar, layoutParams);</span><br><span class="line"></span><br><span class="line">                dialog = <span class="keyword">new</span> <span class="title class_">Dialog</span>(context, android.R.style.Theme_Holo_Dialog_NoActionBar);</span><br><span class="line">                dialog.setCancelable(<span class="literal">false</span>);</span><br><span class="line">                dialog.getWindow().setDimAmount(<span class="number">0.3f</span>);</span><br><span class="line">                dialog.setContentView(layout);</span><br><span class="line">                dialog.show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dismissDialog</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (dialog != <span class="literal">null</span> &amp;&amp; dialog.isShowing()) &#123;</span><br><span class="line">        dialog.dismiss();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="单个操作的-alert"><a href="#单个操作的-alert" class="headerlink" title="单个操作的 alert"></a>单个操作的 alert</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlertOneItem</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> Consumer&lt;Boolean&gt; consumer;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">positiveTips</span> <span class="operator">=</span> <span class="string">&quot;确定&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">negativeTips</span> <span class="operator">=</span> <span class="string">&quot;取消&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">AlertOneItem</span><span class="params">(Context context, Consumer&lt;Boolean&gt; consumer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.context = context;</span><br><span class="line">        <span class="built_in">this</span>.consumer = consumer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AlertOneItem <span class="title function_">builder</span><span class="params">(Context context, Consumer&lt;Boolean&gt; consumer)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AlertOneItem</span>(context, consumer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AlertOneItem <span class="title function_">title</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.title = title;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AlertOneItem <span class="title function_">message</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AlertOneItem <span class="title function_">positiveTips</span><span class="params">(String positiveTips)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.positiveTips = positiveTips;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AlertOneItem <span class="title function_">negativeTips</span><span class="params">(String negativeTips)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.negativeTips = negativeTips;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        AlertDialog.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(context);</span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(title)) &#123;</span><br><span class="line">            builder.setTitle(title);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(message)) &#123;</span><br><span class="line">            builder.setMessage(message);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(negativeTips)) &#123;</span><br><span class="line">            builder.setNegativeButton(negativeTips, (dialog, which) -&gt; consumer.accept(<span class="literal">false</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(positiveTips)) &#123;</span><br><span class="line">            builder.setPositiveButton(positiveTips, (dialog, which) -&gt; consumer.accept(<span class="literal">true</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        builder.setCancelable(<span class="literal">true</span>);</span><br><span class="line">        builder.create();</span><br><span class="line">        builder.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">Udialog.AlertOneItem.builder(context, result -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (result) &#123;</span><br><span class="line">            toSetWallpaperAsync(context, imageView, color);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).message(<span class="string">&quot;设置成壁纸?&quot;</span>).show();</span><br></pre></td></tr></table></figure>

<h2 id="多个操作的-alert-（方案-1）"><a href="#多个操作的-alert-（方案-1）" class="headerlink" title="多个操作的 alert （方案 1）"></a>多个操作的 alert （方案 1）</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">OperateType</span> &#123;</span><br><span class="line">    REFRESH(<span class="string">&quot;刷新&quot;</span>),</span><br><span class="line">    COPY_LINK(<span class="string">&quot;复制链接&quot;</span>),</span><br><span class="line">    COPY_MD_LINK(<span class="string">&quot;复制md链接&quot;</span>),</span><br><span class="line">    OPEN_WITH_BROWSER(<span class="string">&quot;在浏览器中打开&quot;</span>),</span><br><span class="line">    ;</span><br><span class="line">    String title;</span><br><span class="line"></span><br><span class="line">    OperateType(String title) &#123;</span><br><span class="line">        <span class="built_in">this</span>.title = title;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> OperateType <span class="title function_">indexOf</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> OperateType.values()[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] toStrArray() &#123;</span><br><span class="line">        OperateType[] values = OperateType.values();</span><br><span class="line">        String[] result = <span class="keyword">new</span> <span class="title class_">String</span>[values.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; values.length; i++) &#123;</span><br><span class="line">            result[i] = values[i].title;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">onMorePressed</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(mContext)</span><br><span class="line">            .setTitle(<span class="string">&quot;操作&quot;</span>)</span><br><span class="line">            .setItems(OperateType.toStrArray(), (dialog, which) -&gt; &#123;</span><br><span class="line">                <span class="keyword">switch</span> (OperateType.indexOf(which)) &#123;</span><br><span class="line">                    <span class="keyword">case</span> REFRESH:</span><br><span class="line">                        mWvContent.reload();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> COPY_LINK:</span><br><span class="line">                        copyToClipboard(mWvContent.getUrl(), <span class="string">&quot;已复制到剪切板&quot;</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> COPY_MD_LINK:</span><br><span class="line">                        <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> mWvContent.getTitle();</span><br><span class="line">                        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> mWvContent.getUrl();</span><br><span class="line">                        copyToClipboard(<span class="string">&quot;- [&quot;</span> + title + <span class="string">&quot;]&quot;</span> + <span class="string">&quot;(&quot;</span> + url + <span class="string">&quot;)&quot;</span>, <span class="string">&quot;已复制到剪切板&quot;</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> OPEN_WITH_BROWSER:</span><br><span class="line">                        <span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> Uri.parse(mWvContent.getUrl());</span><br><span class="line">                        <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW, uri);</span><br><span class="line">                        startActivity(intent);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .create().show();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="多个操作的-alert（方案-2）"><a href="#多个操作的-alert（方案-2）" class="headerlink" title="多个操作的 alert（方案 2）"></a>多个操作的 alert（方案 2）</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlertMultiItem</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; nameList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> List&lt;Runnable&gt; taskList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">AlertMultiItem</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.context = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AlertMultiItem <span class="title function_">builder</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AlertMultiItem</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AlertMultiItem <span class="title function_">title</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.title = title;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AlertMultiItem <span class="title function_">add</span><span class="params">(String title, Runnable runnable)</span> &#123;</span><br><span class="line">        nameList.add(title);</span><br><span class="line">        taskList.add(runnable);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String[] getItemNames() &#123;</span><br><span class="line">        String[] result = <span class="keyword">new</span> <span class="title class_">String</span>[nameList.size()];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nameList.size(); i++) &#123;</span><br><span class="line">            result[i] = nameList.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        AlertDialog.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(context);</span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(title)) &#123;</span><br><span class="line">            builder.setTitle(title);</span><br><span class="line">        &#125;</span><br><span class="line">        builder.setItems(getItemNames(), (dialog, which) -&gt; taskList.get(which).run());</span><br><span class="line">        builder.create();</span><br><span class="line">        builder.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">Udialog.AlertMultiItem.builder(mContext)</span><br><span class="line">        .add(<span class="string">&quot;复制内容&quot;</span>, () -&gt; copyContent())</span><br><span class="line">        .add(<span class="string">&quot;复制全部&quot;</span>, () -&gt; copyAll())</span><br><span class="line">        .add(<span class="string">&quot;删除此项&quot;</span>, () -&gt; delete())</span><br><span class="line">        .show();</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android中的性能优化</title>
    <url>/android/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<h1 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h1><ul>
<li><a href="http://blog.csdn.net/u010687392/article/details/50035061">Android性能优化之被忽视的优化点</a></li>
<li><a href="http://blog.csdn.net/column/details/best.html">Android性能优化</a></li>
</ul>
<h1 id="在正式环境中关闭日志"><a href="#在正式环境中关闭日志" class="headerlink" title="在正式环境中关闭日志"></a>在正式环境中关闭日志</h1><ul>
<li><a href="https://blog.csdn.net/jiese1990/article/details/21752159">android 代码优化：关闭输出日志 - CSDN博客</a></li>
</ul>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># insert below code to proguard-rules.pro</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除日志</span></span><br><span class="line">-assumenosideeffects class android.util.Log &#123;</span><br><span class="line">    public static *** d(...)<span class="comment">;</span></span><br><span class="line">    public static *** i(...)<span class="comment">;</span></span><br><span class="line">    public static *** w(...)<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># insert below code to build.gradle</span></span><br><span class="line"></span><br><span class="line">release &#123;</span><br><span class="line">    signingConfig signingConfigs.renrenDebug // 密钥配置</span><br><span class="line">    shrinkResources true // 删除不必要的源文件</span><br><span class="line">    zipAlignEnabled true // 压缩对齐</span><br><span class="line">    minifyEnabled true</span><br><span class="line">    proguardFiles getDefaultProguardFile(&#x27;proguard-android-optimize.txt&#x27;), &#x27;proguard-rules.pro&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android渠道打包</title>
    <url>/android/%E6%89%93%E5%8C%85/</url>
    <content><![CDATA[<h1 id="为什么需要渠道打包"><a href="#为什么需要渠道打包" class="headerlink" title="为什么需要渠道打包"></a>为什么需要渠道打包</h1><ul>
<li>为了统计各市场的效果（活跃数、下单数等），需要用某种方式唯一标识它们。</li>
<li>客户端访问API时会在请求参数中带上渠道号，以便后台接下来计算不同渠道的效果。</li>
</ul>
<h1 id="添加渠道方法"><a href="#添加渠道方法" class="headerlink" title="添加渠道方法"></a>添加渠道方法</h1><p>在<code>AndroidManifest.xml</code>中的<code>application</code>标签下添加：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- UMENG配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;UMENG_CHANNEL&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:value</span>=<span class="string">&quot;$&#123;UMENG_CHANNEL_VALUE&#125;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>在<code>build.gradle</code>文件中的<code>android</code>标签下添加：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">productFlavors &#123;</span><br><span class="line">    xiaomi &#123;&#125;</span><br><span class="line">    qihu360 &#123;&#125;</span><br><span class="line">    baidu &#123;&#125;</span><br><span class="line">    wandoujia &#123;&#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">productFlavors.<span class="property">all</span> &#123;</span><br><span class="line">    flavor -&gt; flavor.<span class="property">manifestPlaceholders</span> = [<span class="attr">UMENG_CHANNEL_VALUE</span>: name]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="获取渠道方法"><a href="#获取渠道方法" class="headerlink" title="获取渠道方法"></a>获取渠道方法</h1><p>在java代码中获取：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 调用方式</span></span><br><span class="line">Utoast.show(<span class="built_in">this</span>, <span class="string">&quot;渠道：&quot;</span> + getApplicationMetaValue(<span class="built_in">this</span>, <span class="string">&quot;UMENG_CHANNEL&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getApplicationMetaValue</span><span class="params">(Context context, String name)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">ApplicationInfo</span> <span class="variable">appInfo</span> <span class="operator">=</span> context.getPackageManager()</span><br><span class="line">                .getApplicationInfo(context.getPackageName(),</span><br><span class="line">                        PackageManager.GET_META_DATA);</span><br><span class="line">        value = appInfo.metaData.getString(name);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="扩展（更快速的打包方式）："><a href="#扩展（更快速的打包方式）：" class="headerlink" title="扩展（更快速的打包方式）："></a>扩展（更快速的打包方式）：</h1><p>渠道打包的另一种解决方案：使用python脚本在<code>META-INFO</code>中添加<code>channel_&lt;渠道名&gt;</code>名称的空文件；</p>
<ul>
<li><a href="https://github.com/GavinCT/AndroidMultiChannelBuildTool">AndroidMultiChannelBuildTool</a></li>
</ul>
<h1 id="友盟提供的设置渠道方案"><a href="#友盟提供的设置渠道方案" class="headerlink" title="友盟提供的设置渠道方案"></a>友盟提供的设置渠道方案</h1><ol>
<li><p>就是上面的通过<code>AndroidManifest</code>配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">android:name</span>=<span class="string">&quot;UMENG_CHANNEL&quot;</span> <span class="attr">android:value</span>=<span class="string">&quot;UMeng&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>通过在代码中执行</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">channel</span> <span class="operator">=</span> getApplicationMetaValue(<span class="built_in">this</span>, <span class="string">&quot;UMENG_CHANNEL&quot;</span>);</span><br><span class="line">AnalyticsConfig.setChannel(channel);</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>NOTE1:</strong> 坑，不能同时设置两种方式，友盟技术的解释是优先使用第一次取到了渠道名；如果采用java代码的方式，需要在<code>Application</code>中设置，而不是<code>Activity</code>；</p>
<p><strong>NOTE2:</strong> 也可以通过url将渠道名传递给后台，由后台来做统计；</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="http://www.jianshu.com/p/a9ccdf67ca6c">Android多渠道打包没你想的那么复杂</a></li>
<li><a href="http://tech.meituan.com/mt-apk-packaging.html">美团Android自动化之旅—生成渠道包</a></li>
<li><a href="http://stormzhang.com/devtools/2015/01/15/android-studio-tutorial6/">ANDROID STUDIO系列教程六–GRADLE多渠道打包</a></li>
<li><a href="http://blog.csdn.net/yy1300326388/article/details/48296221">［Android Studio 权威教程］多渠道打包和一键完成（全部产品）打包并签名</a></li>
<li><a href="http://loody.github.io/2016/02/26/2016-02-26-android-multi-%20package/">Android多渠道打包方案介绍</a></li>
</ul>
<h1 id="从keystore中获取md5"><a href="#从keystore中获取md5" class="headerlink" title="从keystore中获取md5"></a>从keystore中获取md5</h1><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">keytool.exe -v -list -keystore lyloou.jks</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>推送</title>
    <url>/android/%E6%8E%A8%E9%80%81/</url>
    <content><![CDATA[<h2 id="问题列表"><a href="#问题列表" class="headerlink" title="问题列表"></a>问题列表</h2><ol>
<li>集成华为推送时出现下面错误<blockquote>
<p>错误:28: 集成HMS需要将证书文件打包到APK中，请直接将assets目录拷贝到应用工程根目录。</p>
</blockquote>
</li>
</ol>
<p>从下面链接下载 hmssdk-gradle-{version}.zip ，将 assets 中的内容拷贝到你自己的 module 的 assets 中。</p>
<p>developer.huawei.com/consumer/cn/service/hms/catalog/huaweipush_agent.html?page=hmssdk_huaweipush_devprepare_agent#4 下载SDK</p>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>推送方案选取</title>
    <url>/android/%E6%8E%A8%E9%80%81%E6%96%B9%E6%A1%88%E9%80%89%E5%8F%96/</url>
    <content><![CDATA[<h1 id="免费"><a href="#免费" class="headerlink" title="免费"></a>免费</h1><ul>
<li>信鸽</li>
</ul>
<h1 id="第三方推送服务"><a href="#第三方推送服务" class="headerlink" title="第三方推送服务"></a>第三方推送服务</h1><ul>
<li>友盟</li>
<li>极光推送</li>
</ul>
<h1 id="手机ROM厂商推送"><a href="#手机ROM厂商推送" class="headerlink" title="手机ROM厂商推送"></a>手机ROM厂商推送</h1><h2 id="Flyme"><a href="#Flyme" class="headerlink" title="Flyme"></a>Flyme</h2><p>Flyme推送目前支持哪些平台？<br>Flyme推送平台目前只支持魅族手机的flyme系统。</p>
<p>Android推送中，多个app都使用推送时，他们会共享连接吗？<br>在Flyme系统（4.0，4.5，5）上，会直接使用系统长连接通道，所有app会和系统共享一个长连接；目前在其他Rom上，没有共享连接。</p>
<p>Flyme推送收费吗？<br>Flyme推送平台的基础推送功能是免费的，但是某些定制功能会考虑收费，在功能和体验上会有不同。</p>
<p>参考资料<br><a href="http://open-wiki.flyme.cn/index.php?title=%E9%AD%85%E6%97%8F%E6%8E%A8%E9%80%81%E5%B9%B3%E5%8F%B0%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">http://open-wiki.flyme.cn/index.php?title=魅族推送平台常见问题</a></p>
<h2 id="MIUI"><a href="#MIUI" class="headerlink" title="MIUI"></a>MIUI</h2><p>小米消息推送服务在MIUI上为系统级通道，并且全<br>平台通用，可以为开发者提供稳定、可靠、高效的<br>推送服务</p>
<p>参考资料</p>
<ul>
<li><a href="http://dev.xiaomi.com/console/appservice/push.html">http://dev.xiaomi.com/console/appservice/push.html</a></li>
</ul>
<h2 id="华为"><a href="#华为" class="headerlink" title="华为"></a>华为</h2><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="http://blog.csdn.net/eclipsexys/article/details/52575602">推送 从入门到放弃</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzA5OTMxMjQzMw==&mid=2648112527&idx=1&sn=b23c1b5f3e32e343ad96d705bd4d63ff">国内Top500Android应用分析报告</a></li>
</ul>
<h1 id="渠道列表"><a href="#渠道列表" class="headerlink" title="渠道列表"></a>渠道列表</h1><figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="number">10086</span><span class="keyword">com</span></span><br><span class="line"><span class="number">189</span>store</span><br><span class="line"><span class="number">360</span>mobile</span><br><span class="line"><span class="number">3</span>gcn</span><br><span class="line"><span class="number">91</span>market</span><br><span class="line">anzhi</span><br><span class="line">appchina</span><br><span class="line">baidu</span><br><span class="line">gfan</span><br><span class="line">googleplay</span><br><span class="line">hicloud</span><br><span class="line">lenovomm</span><br><span class="line">meizu</span><br><span class="line">mumayi</span><br><span class="line">myapp</span><br><span class="line">nduoa</span><br><span class="line">samsungapps</span><br><span class="line">uc</span><br><span class="line">wandoujia</span><br><span class="line">wostore</span><br><span class="line">xiaomi</span><br><span class="line">yingyongbao</span><br><span class="line">yingyonghui</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>支付宝SDK支付</title>
    <url>/android/%E6%94%AF%E4%BB%98%E5%AE%9DSDK%E6%94%AF%E4%BB%98/</url>
    <content><![CDATA[<h1 id="通过本地安装的支付宝支付"><a href="#通过本地安装的支付宝支付" class="headerlink" title="通过本地安装的支付宝支付"></a>通过本地安装的支付宝支付</h1><p>Android端的实现比较简单，</p>
<ol>
<li><a href="https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.8MZxo2&treeId=59&articleId=103662&docType=1">下载SDK和DEMO</a></li>
<li>导入支付宝sdk后，需要注意权限、配置、混淆等；</li>
<li>通过后台获取得到<code>orderInfo</code>字符串</li>
<li>唤起支付宝：【需要在新线程中调用支付接口。（可参考alipay_demo实现）】</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">String</span> <span class="variable">orderInfo</span> <span class="operator">=</span> <span class="string">&quot;从后台获取得到的orderInfo&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">PayTask</span> <span class="variable">alipay</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PayTask</span>(mActivity);</span><br><span class="line">Map&lt;String, String&gt; result = alipay.payV2(orderInfo, <span class="literal">true</span>);</span><br><span class="line"><span class="type">PayResult</span> <span class="variable">payResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PayResult</span>(result);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 对于支付结果，请商户依赖服务端的异步通知结果。同步通知结果，仅作为支付结束的通知。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">String</span> <span class="variable">resultInfo</span> <span class="operator">=</span> payResult.getResult();<span class="comment">// 同步返回需要验证的信息</span></span><br><span class="line"><span class="type">String</span> <span class="variable">resultStatus</span> <span class="operator">=</span> payResult.getResultStatus();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断resultStatus 为9000则代表支付成功</span></span><br><span class="line"><span class="keyword">if</span> (TextUtils.equals(resultStatus, <span class="string">&quot;9000&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// 该笔订单是否真实支付成功，需要依赖服务端的异步通知。</span></span><br><span class="line">    Toast.makeText(mActivity, <span class="string">&quot;支付成功&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 该笔订单真实的支付结果，需要依赖服务端的异步通知。</span></span><br><span class="line">    Toast.makeText(mActivity, <span class="string">&quot;支付失败&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="如果本地没有安装支付宝，就跳转到wap支付"><a href="#如果本地没有安装支付宝，就跳转到wap支付" class="headerlink" title="如果本地没有安装支付宝，就跳转到wap支付"></a>如果本地没有安装支付宝，就跳转到wap支付</h1><p>我相信在<code>PayTask.payV2</code>中，有对是否安装支付宝做判断，<br>我们需要在<code>Manifest</code>中注册<code>H5PayActivity</code>：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.alipay.sdk.app.H5PayActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:configChanges</span>=<span class="string">&quot;orientation|keyboardHidden|navigation&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:screenOrientation</span>=<span class="string">&quot;behind&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:windowSoftInputMode</span>=<span class="string">&quot;adjustResize|stateHidden&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="http://blog.csdn.net/u013067184/article/details/46922997">Android 支付宝 SDK 无法跳转到wap支付</a></li>
<li><a href="https://doc.open.alipay.com/doc2/detail.htm?treeId=59&articleId=103682&docType=1">蚂蚁金服-开发文档——修改Manifest</a></li>
<li><a href="http://blog.csdn.net/ylbf_dev/article/details/50448727">混淆出错-The same input jar is specified twice 解决办法</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>多端登录同步策略</title>
    <url>/android/%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/</url>
    <content><![CDATA[<h2 id="字段表示"><a href="#字段表示" class="headerlink" title="字段表示"></a>字段表示</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">本地列表：local_list；</span><br><span class="line">单项：<span class="keyword">local</span></span><br><span class="line">本地修改时间： <span class="built_in">localTime</span></span><br><span class="line">上次快照时间： snapTime</span><br><span class="line"></span><br><span class="line">远程列表：remote_list；</span><br><span class="line">单项：remote</span><br><span class="line">上次同步时间： syncTime</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="状态判断"><a href="#状态判断" class="headerlink" title="状态判断"></a>状态判断</h2><ol>
<li><p>本地删除的（还没提交到远程，就删除的，针对这种情况可以直接清理掉）</p>
<blockquote>
<p>(local.snapTime == 0L &amp;&amp; local.isDisabled)</p>
</blockquote>
</li>
<li><p>无变化的</p>
<blockquote>
<p>(local.localTime == local.snapTime) &amp;&amp; (local.snapTime == remote.syncTime)</p>
</blockquote>
</li>
<li><p>本地新增的</p>
<blockquote>
<p>((local.snapTime == 0L) &amp;&amp; (local.localTime &gt; 0))</p>
</blockquote>
</li>
<li><p>远程新增的</p>
<blockquote>
<p>(remote_list.subtract(local_list))</p>
</blockquote>
</li>
<li><p>本地修改的</p>
<blockquote>
<p>((local.snapTime == remote.syncTime) &amp;&amp; (local.localTime &gt; local.snapTime))</p>
</blockquote>
</li>
<li><p>远程修改的</p>
<blockquote>
<p>((local.localTime == local.snapTime) &amp;&amp; (remote.syncTime &gt; local.snapTime))</p>
</blockquote>
</li>
<li><p>远程和本地都有修改的</p>
<blockquote>
<p>(local.localTime &gt; local.snapTime) &amp;&amp; (remote.syncTime &gt; local.snapTime)</p>
</blockquote>
</li>
</ol>
<h2 id="冲突解决"><a href="#冲突解决" class="headerlink" title="冲突解决"></a>冲突解决</h2><p>对于前 6 个状态，是不需要处理冲突的， 简单的合并处理即可。</p>
<p>对于第 7 个，是需要手动来解决的。</p>
<h2 id="上传同步"><a href="#上传同步" class="headerlink" title="上传同步"></a>上传同步</h2><ol>
<li>取当前时间：</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> now = Date().time</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>设置修改时间：</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">sync_list.map &#123; it.syncTime=now &#125;</span><br><span class="line">local_list.map &#123; it.localTime=now; it.snapTime=now &#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>上传 sync_list 到服务器</li>
</ol>
<h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><ul>
<li><p><a href="https://www.yinkh.top/article/72/">Android 离线数据同步策略 | YinKH 博客</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/1d889fb14ca3">基于 diff 的文件同步算法（上） - 简书</a></p>
</li>
</ul>
<blockquote>
<p>从客户端的角度来看，文件同步的本质是本地文件集合与云端文件集合的对比。从实现角度来讲，客户端会保存一份云端文件集合的快照，通过将快照和云端集合对比可以计算出云端文件变更，通过将快照和本地集合对比则可以计算出本地文件变更。对于本地文件的变更，需要将文件提交至云端；对于云端文件的变更，需要将文件同步至本地。对于文件同步在云端和本地都有修改的情况下，就需要进行冲突处理。</p>
</blockquote>
<p>为减少内存占用，不采取云端快照到本地的方式；这里换了种方式：在本地数据库中只加了个 snapTime 快照时间 ，来作为参考点；</p>
<h2 id="更多思考"><a href="#更多思考" class="headerlink" title="更多思考"></a>更多思考</h2><ul>
<li>在处理冲突期间，远程数据库已经被另一端上传覆盖了。</li>
<li>本地的修改时间比快照时间还小？</li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>权限问题</title>
    <url>/android/%E6%9D%83%E9%99%90/</url>
    <content><![CDATA[<p>参考资料：<a href="https://www.2cto.com/kf/201611/561860.html">Android 6.0 动态权限申请详解 - Android移动开发技术文章_手机开发 - 红黑联盟</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="meta">@TargetApi(Build.VERSION_CODES.M)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">requestPermission</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ContextCompat.checkSelfPermission(mContext, Manifest.permission.CAMERA)</span><br><span class="line">            == PackageManager.PERMISSION_GRANTED</span><br><span class="line">            &amp;&amp; ContextCompat.checkSelfPermission(mContext, Manifest.permission.WRITE_EXTERNAL_STORAGE)</span><br><span class="line">            == PackageManager.PERMISSION_GRANTED</span><br><span class="line">            &amp;&amp; ContextCompat.checkSelfPermission(mContext, Manifest.permission.READ_EXTERNAL_STORAGE)</span><br><span class="line">            == PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">        <span class="comment">// doSthHere();</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//申请相机权限和STORAGE权限</span></span><br><span class="line">        ActivityCompat.requestPermissions(</span><br><span class="line">                mContext,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;Manifest.permission.CAMERA,</span><br><span class="line">                        Manifest.permission.WRITE_EXTERNAL_STORAGE,</span><br><span class="line">                        Manifest.permission.READ_EXTERNAL_STORAGE</span><br><span class="line">                &#125;,</span><br><span class="line">                CAMERA_REQUEST_CODE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onRequestPermissionsResult</span><span class="params">(<span class="type">int</span> requestCode, String[] permissions, <span class="type">int</span>[] grantResults)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line">    <span class="keyword">if</span> (requestCode == CAMERA_REQUEST_CODE) &#123;</span><br><span class="line">        <span class="keyword">if</span> (grantResults[<span class="number">0</span>] == PackageManager.PERMISSION_GRANTED</span><br><span class="line">                &amp;&amp; grantResults[<span class="number">1</span>] == PackageManager.PERMISSION_GRANTED</span><br><span class="line">                &amp;&amp; grantResults[<span class="number">2</span>] == PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">            <span class="comment">// doSthHere();</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;没有相关运行权限&quot;</span>;</span><br><span class="line">            Toast.makeText(mContext, msg, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android网络相关</title>
    <url>/android/%E7%BD%91%E7%BB%9C/</url>
    <content><![CDATA[<h2 id="抓包工具"><a href="#抓包工具" class="headerlink" title="抓包工具"></a>抓包工具</h2><ul>
<li><a href="https://play.google.com/store/apps/details?id=app.greyshirts.sslcapture">Packet Capture - Google Play 上的应用</a></li>
<li>fiddle</li>
</ul>
<h2 id="okhttp3-set-cookie"><a href="#okhttp3-set-cookie" class="headerlink" title="okhttp3 set cookie"></a>okhttp3 set cookie</h2><h3 id="从-webview-中获取-cookie"><a href="#从-webview-中获取-cookie" class="headerlink" title="从 webview 中获取 cookie"></a>从 webview 中获取 cookie</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://stackoverflow.com/questions/17654631/android-webview-read-cookies/20241864</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getCookie</span><span class="params">(String siteName, String cookieName)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">cookieValue</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">CookieManager</span> <span class="variable">cookieManager</span> <span class="operator">=</span> CookieManager.getInstance();</span><br><span class="line">    <span class="type">String</span> <span class="variable">cookies</span> <span class="operator">=</span> cookieManager.getCookie(siteName);</span><br><span class="line">    <span class="keyword">if</span> (cookies != <span class="literal">null</span>) &#123;</span><br><span class="line">        String[] temp = cookies.split(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String ar1 : temp) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ar1.contains(cookieName)) &#123;</span><br><span class="line">                String[] temp1 = ar1.split(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">                cookieValue = temp1[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cookieValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filePath);</span><br><span class="line"><span class="type">RequestBody</span> <span class="variable">requestBody</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultipartBody</span>.Builder()</span><br><span class="line">        .setType(MultipartBody.FORM)</span><br><span class="line">        .addFormDataPart(<span class="string">&quot;file&quot;</span>, file.getName(), RequestBody.create(MediaType.parse(<span class="string">&quot;image/*&quot;</span>), file))</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line"><span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder()</span><br><span class="line">        .url(callBack.getUrl())</span><br><span class="line">        .post(requestBody)</span><br><span class="line">        .addHeader(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;*/*&quot;</span>)</span><br><span class="line">        .addHeader(<span class="string">&quot;cookie&quot;</span>, <span class="string">&quot;ci_session=&quot;</span> + getCookie(APP_URL, <span class="string">&quot;ci_session&quot;</span>))</span><br><span class="line">        .build();</span><br><span class="line">client.newCall(request).enqueue(callBack);</span><br></pre></td></tr></table></figure>

<h3 id="Automatic-cookie-handling-with-OkHttp-3"><a href="#Automatic-cookie-handling-with-OkHttp-3" class="headerlink" title="Automatic cookie handling with OkHttp 3"></a>Automatic cookie handling with OkHttp 3</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://stackoverflow.com/questions/34881775/automatic-cookie-handling-with-okhttp-3/35346473</span></span><br><span class="line"><span class="comment">// https://github.com/franmontiel/PersistentCookieJar</span></span><br><span class="line"><span class="type">CookieJar</span> <span class="variable">cookieJar</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PersistentCookieJar</span>(<span class="keyword">new</span> <span class="title class_">SetCookieCache</span>(),</span><br><span class="line">                     <span class="keyword">new</span> <span class="title class_">SharedPrefsCookiePersistor</span>(context));</span><br><span class="line"><span class="type">OkHttpClient</span> <span class="variable">okHttpClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>.Builder()</span><br><span class="line">                    .cookieJar(cookieJar)</span><br><span class="line">                    .build();</span><br></pre></td></tr></table></figure>

<h2 id="获取网络时间"><a href="#获取网络时间" class="headerlink" title="获取网络时间"></a>获取网络时间</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Utime</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">URL_DEFAULT</span> <span class="operator">=</span> <span class="string">&quot;http://lyloou.com&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 获取时间戳（始终使用网络时间，如果获取网络时间失败，才使用本地时间）</span></span><br><span class="line"><span class="comment">     * 注意该方法涉及网络操作，不要在主线程中调用</span></span><br><span class="line"><span class="comment">     * 返回的是以秒为单位的时间字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getTimeStamp</span><span class="params">(String url)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">urlRrBase</span> <span class="operator">=</span> getBaseUrl(url);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">long</span> <span class="variable">phoneTime</span> <span class="operator">=</span> System.currentTimeMillis() / <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 生成连接对象</span></span><br><span class="line">            <span class="type">URLConnection</span> <span class="variable">uc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(urlRrBase).openConnection();</span><br><span class="line">            <span class="comment">// 发出连接</span></span><br><span class="line">            uc.connect();</span><br><span class="line">            <span class="type">long</span> <span class="variable">webTimeMillis</span> <span class="operator">=</span> uc.getDate();</span><br><span class="line">            <span class="comment">// 读取网站日期时间</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">webTime</span> <span class="operator">=</span> webTimeMillis / <span class="number">1000</span>;</span><br><span class="line">            <span class="keyword">return</span> String.valueOf(webTime);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> String.valueOf(phoneTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getBaseUrl</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(url)) &#123;</span><br><span class="line">            <span class="keyword">return</span> URL_DEFAULT;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URI</span>(url);</span><br><span class="line">            <span class="keyword">return</span> uri.getScheme() + <span class="string">&quot;://&quot;</span> + uri.getHost();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> URL_DEFAULT;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>编译问题</title>
    <url>/android/%E7%BC%96%E8%AF%91%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>  点击：Refresh all Gradle projects</p>
<ul>
<li><a href="https://blog.csdn.net/longlyboyhe/article/details/51768879">The APK file does not exist on disk.Error while Installing APK</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>网络请求巧用</title>
    <url>/android/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%B7%A7%E7%94%A8/</url>
    <content><![CDATA[<h2 id="用到的库"><a href="#用到的库" class="headerlink" title="用到的库"></a>用到的库</h2><ul>
<li>Retrofit</li>
<li>RxJava2</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">def rxandroidVersion = <span class="string">&#x27;2.0.1&#x27;</span></span><br><span class="line">implementation <span class="string">&quot;io.reactivex.rxjava2:rxandroid:<span class="variable">$rxandroidVersion</span>&quot;</span></span><br><span class="line">def retrofitVersion = <span class="string">&#x27;2.8.0&#x27;</span></span><br><span class="line">implementation <span class="string">&quot;com.squareup.retrofit2:retrofit:<span class="variable">$retrofitVersion</span>&quot;</span></span><br><span class="line">implementation <span class="string">&quot;com.squareup.retrofit2:adapter-rxjava2:<span class="variable">$retrofitVersion</span>&quot;</span></span><br><span class="line">implementation <span class="string">&quot;com.squareup.retrofit2:converter-gson:<span class="variable">$retrofitVersion</span>&quot;</span></span><br><span class="line">implementation <span class="string">&#x27;com.google.code.gson:gson:2.8.5&#x27;</span></span><br><span class="line"></span><br><span class="line">implementation <span class="string">&#x27;androidx.core:core-ktx:1.2.0&#x27;</span></span><br><span class="line">implementation <span class="string">&#x27;androidx.lifecycle:lifecycle-extensions:2.2.0&#x27;</span></span><br><span class="line">implementation <span class="string">&#x27;androidx.lifecycle:lifecycle-viewmodel-ktx:2.2.0&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="服务器统一返回格式"><a href="#服务器统一返回格式" class="headerlink" title="服务器统一返回格式"></a>服务器统一返回格式</h2><p>当 <code>error_code</code> 不为 <code>0</code> 时，就不用解析 <code>data</code>（其值为 <code>null</code>），根据相应的错误码提示给用户；</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;err_code&quot;</span><span class="punctuation">:</span> <span class="number">1101</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;err_msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;参数name不能为空&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>当 <code>error_code</code> 为 <code>0</code> 时，就可以解析 <code>data</code>，这个返回值通过实体类或列表来映射得到。</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;err_code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;err_msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ok&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lyloou&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lyloou@qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;personal_signature&quot;</span><span class="punctuation">:</span> <span class="string">&quot;多么美好的太阳&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gmt_create&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2020-01-16T09:38:18.000+0000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gmt_modified&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2020-03-14T11:27:58.000+0000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;is_disabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="定义返回类"><a href="#定义返回类" class="headerlink" title="定义返回类"></a>定义返回类</h2><p>通过 CResult 来接收返回的数据，<code>data</code> 的通过泛型来映射成对应实体类（用泛型的好处，是不用为每一个返回都建立一个类）；</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://medium.com/@stustirling/responses-errors-with-retrofit-2-rxjava2-6d55eafecf5a</span></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">CResult</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">var</span> err_code: <span class="built_in">Int</span>, <span class="keyword">var</span> err_msg: String, <span class="keyword">var</span> <span class="keyword">data</span>: T?)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Retrofit-简单封装"><a href="#Retrofit-简单封装" class="headerlink" title="Retrofit 简单封装"></a>Retrofit 简单封装</h2><blockquote>
<p>具体用法参考：<a href="https://square.github.io/retrofit/">Retrofit 官网</a></p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Network.kt</span></span><br><span class="line"><span class="keyword">val</span> gson: Gson = GsonBuilder()</span><br><span class="line">    .setDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>)</span><br><span class="line">    .setLenient()</span><br><span class="line">    .create()</span><br><span class="line"><span class="function"><span class="keyword">fun</span> Any.<span class="title">toJsonString</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">return</span> gson.toJson(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> Network &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> headerPairs: (() -&gt; List&lt;Pair&lt;String, String&gt;&gt;)? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> builder = Retrofit.Builder()</span><br><span class="line">        .addConverterFactory(GsonConverterFactory.create(gson))</span><br><span class="line">        .addCallAdapterFactory(RxJava2CallAdapterFactory.create());</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">withHeader</span><span class="params">(pairList: (() -&gt; <span class="type">List</span>&lt;<span class="type">Pair</span>&lt;<span class="type">String</span>, <span class="type">String</span>&gt;&gt;))</span></span>: Network &#123;</span><br><span class="line">        <span class="keyword">this</span>.headerPairs = pairList</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">get</span><span class="params">(baseUrl: <span class="type">String</span>, clazz: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;)</span></span>: T &#123;</span><br><span class="line">        <span class="keyword">val</span> okHttpBuilder = OkHttpClient.Builder()</span><br><span class="line">        headerPairs?.invoke()?.let &#123;</span><br><span class="line">            okHttpBuilder.addInterceptor(interceptor(it))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> builder.baseUrl(baseUrl)</span><br><span class="line">            .client(okHttpBuilder.build())</span><br><span class="line">            .build().create(clazz)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果是需要授权才能获取信息，统一用这个。</span></span><br><span class="line">    <span class="comment">// 把用户信息和授权信息通过 header 的方式发到服务器</span></span><br><span class="line">    <span class="comment">// [Retrofit — Add Custom Request Header](https://futurestud.io/tutorials/retrofit-add-custom-request-header)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">auth</span><span class="params">(userPassword: <span class="type">UserPassword</span>?)</span></span>: List&lt;Pair&lt;String, String&gt;&gt; &#123;</span><br><span class="line">        userPassword?.let &#123;</span><br><span class="line">            <span class="keyword">return</span> listOf(</span><br><span class="line">                <span class="string">&quot;Content-Type&quot;</span> to <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Authorization&quot;</span> to it.password,</span><br><span class="line">                <span class="string">&quot;UserId&quot;</span> to it.userId.toString()</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> emptyList()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">interceptor</span><span class="params">(headers: <span class="type">List</span>&lt;<span class="type">Pair</span>&lt;<span class="type">String</span>, String&gt;&gt;)</span></span>: (Interceptor.Chain) -&gt; Response &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> newBuilder = it.request().newBuilder()</span><br><span class="line">        headers.forEach &#123; header -&gt;</span><br><span class="line">            newBuilder.addHeader(header.first, header.second)</span><br><span class="line">        &#125;</span><br><span class="line">        it.proceed(newBuilder.build())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Observable<span class="type">&lt;T&gt;</span>.<span class="title">defaultScheduler</span><span class="params">()</span></span>: Observable&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.subscribeOn(Schedulers.io())</span><br><span class="line">        .unsubscribeOn(Schedulers.io())</span><br><span class="line">        .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="准备用户的类和-retrofit-接口"><a href="#准备用户的类和-retrofit-接口" class="headerlink" title="准备用户的类和 retrofit 接口"></a>准备用户的类和 retrofit 接口</h2><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// user.kt</span></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">User</span>(</span><br><span class="line">    <span class="keyword">val</span> id: <span class="built_in">Long</span>,</span><br><span class="line">    <span class="keyword">val</span> name: String,</span><br><span class="line">    <span class="keyword">val</span> email: String,</span><br><span class="line">    <span class="meta">@SerializedName(<span class="string">&quot;personal_signature&quot;</span>)</span></span><br><span class="line">    <span class="keyword">val</span> personalSignature: String,</span><br><span class="line">    <span class="meta">@SerializedName(<span class="string">&quot;gmt_create&quot;</span>)</span></span><br><span class="line">    <span class="keyword">val</span> gmtCreate: Date</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">UserPassword</span>(</span><br><span class="line">    <span class="keyword">val</span> userId: <span class="built_in">Long</span>,</span><br><span class="line">    <span class="keyword">val</span> name: String,</span><br><span class="line">    <span class="keyword">val</span> password: String</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title class_">Url</span>(<span class="keyword">val</span> url: String) : Str &#123;</span><br><span class="line">    UserApi(<span class="string">&quot;http://127.0.0.1:8888/api/v1/user/&quot;</span>),</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Network.<span class="title">userApi</span><span class="params">()</span></span>: UserApi &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">get</span>(Url.UserApi.url, UserApi::<span class="keyword">class</span>.java)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建带授权的 userApi</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Network.<span class="title">userWithAuthApi</span><span class="params">(userPassword: <span class="type">UserPassword</span>? = UserPasswordHelper.getUserPassword()</span></span>): UserApi &#123;</span><br><span class="line">    <span class="keyword">return</span> withHeader &#123; auth(userPassword) &#125;</span><br><span class="line">        .<span class="keyword">get</span>(Url.UserApi.url, UserApi::<span class="keyword">class</span>.java);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="使用方法-1-，基于-Observable"><a href="#使用方法-1-，基于-Observable" class="headerlink" title="使用方法 1 ，基于 Observable"></a>使用方法 1 ，基于 Observable</h2><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UserApi</span> &#123;</span><br><span class="line">    <span class="meta">@POST(<span class="string">&quot;login&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">login</span><span class="params">(<span class="meta">@Query(<span class="string">&quot;name&quot;</span>)</span> name: <span class="type">String</span>, <span class="meta">@Query(<span class="string">&quot;password&quot;</span>)</span> password: <span class="type">String</span>)</span></span>: Observable&lt;CResult&lt;User?&gt;&gt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@POST(<span class="string">&quot;update&quot;</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(<span class="meta">@Body</span> user: <span class="type">User</span>)</span></span>: Observable&lt;CResult&lt;String?&gt;&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户登录</span></span><br><span class="line">Network.userApi()</span><br><span class="line">    .login(name, encodedPassword)</span><br><span class="line">    .defaultScheduler()</span><br><span class="line">    .subscribe(&#123;</span><br><span class="line">        <span class="keyword">if</span> (it.err_code == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// save user info to localStorage</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            toast(<span class="string">&quot;错误代码:<span class="subst">$&#123;it.err_code&#125;</span>，错误信息：<span class="subst">$&#123;it.err_msg&#125;</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        toast(<span class="string">&quot;网络异常：<span class="subst">$&#123;it.message&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新用户</span></span><br><span class="line">Network.userApi()</span><br><span class="line">    .update(user)</span><br><span class="line">    .defaultScheduler()</span><br><span class="line">    .subscribe(&#123;</span><br><span class="line">        <span class="keyword">if</span> (it.err_code == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// doSuccess</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// do error</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        toast(<span class="string">&quot;网络异常：<span class="subst">$&#123;it.message&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="使用方法-2，基于-kotlin-的-coroutine"><a href="#使用方法-2，基于-kotlin-的-coroutine" class="headerlink" title="使用方法 2，基于 kotlin 的 coroutine"></a>使用方法 2，基于 kotlin 的 coroutine</h2><p>首先给 ViewModel 添加一个 apiForCResult 扩展</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> ViewModel.<span class="title">apiForCResult</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    block: <span class="type">suspend</span> <span class="type">CoroutineScope</span>.() -&gt; <span class="type">CResult</span>&lt;<span class="type">T</span>?&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    okFun: (<span class="type">T</span>?) -&gt; <span class="type">Unit</span> = &#123;&#125;,</span></span></span><br><span class="line"><span class="params"><span class="function">    failFun: (<span class="type">String</span>) -&gt; <span class="type">Unit</span> = &#123;&#125;</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    viewModelScope.launch &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">val</span> result = withContext(Dispatchers.IO, block)</span><br><span class="line">            <span class="keyword">if</span> (result.err_code == <span class="number">0</span>) &#123;</span><br><span class="line">                okFun(result.<span class="keyword">data</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                failFun(result.err_msg)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">            failFun(<span class="string">&quot;<span class="subst">$&#123;e.message&#125;</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">UserApi</span> &#123;</span><br><span class="line">    <span class="meta">@POST(<span class="string">&quot;login&quot;</span>)</span></span><br><span class="line">    <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">login</span><span class="params">(<span class="meta">@Query(<span class="string">&quot;name&quot;</span>)</span> name: <span class="type">String</span>, <span class="meta">@Query(<span class="string">&quot;password&quot;</span>)</span> password: <span class="type">String</span>)</span></span>: CResult&lt;User?&gt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@POST(<span class="string">&quot;update&quot;</span>)</span></span><br><span class="line">    <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(<span class="meta">@Body</span> user: <span class="type">User</span>)</span></span>: CResult&lt;String?&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 viewModel 中</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginViewModel</span> : <span class="type">ViewModel</span>() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">login</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        name: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        password: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        okFun: (<span class="type">User</span>?) -&gt; <span class="type">Unit</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        failFun: (<span class="type">String</span>) -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;</span><br><span class="line">        apiForCResult(</span><br><span class="line">            &#123; Network.userApi().login(name, password) &#125;,</span><br><span class="line">            okFun,</span><br><span class="line">            failFun</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        user: <span class="type">User</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        okFun: (<span class="type">String</span>?) -&gt; <span class="type">Unit</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        failFun: (<span class="type">String</span>) -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;</span><br><span class="line">        apiForCResult(</span><br><span class="line">            &#123; Network.userWithAuthApi().update(user) &#125;,</span><br><span class="line">            okFun,</span><br><span class="line">            failFun</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserActivity</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onOptionsItemSelected</span><span class="params">(item: <span class="type">MenuItem</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">when</span> (item.itemId) &#123;</span><br><span class="line">            R.id.login -&gt; &#123;</span><br><span class="line">                viewModel.login(name, password, ::doSuccess, ::toast)</span><br><span class="line">            &#125;</span><br><span class="line">            R.id.updaete -&gt; &#123;</span><br><span class="line">                viewModel.update(</span><br><span class="line">                    user,</span><br><span class="line">                    &#123;toast(<span class="string">&quot;更新成功&quot;</span>)&#125;,</span><br><span class="line">                    &#123;toast(it)&#125;</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 在 activity 中</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>结合使用 kotlin 的扩展功能，可以简化许多冗余的代码。</p>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android规范</title>
    <url>/android/%E8%A7%84%E8%8C%83/</url>
    <content><![CDATA[<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><ul>
<li><code>color.xml</code> 由基本色构成，而不是针对每个模块或组件分别设置。</li>
<li><code>dimens.xml</code> 同上。</li>
<li><code>string.xml</code> 由于语言的多样性，属性名具体一点会更好。另外，value 值不要全部使用大写（用<code>textAllCaps</code>）。</li>
<li><code>layout</code> 中的层级不要太多。<blockquote>
<p><a href="https://github.com/futurice/android-best-practices#resources">https://github.com/futurice/android-best-practices#resources</a></p>
</blockquote>
</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://keeganlee.me/post/android/20150709">Android技术积累:开发规范</a></li>
<li><a href="http://www.hawstein.com/posts/google-java-style.html">Google Java编程风格指南</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android中资源文件相关</title>
    <url>/android/%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="resources标签"><a href="#resources标签" class="headerlink" title="resources标签"></a>resources标签</h2><ul>
<li>所有的资源文件，都可以放在同一个<code>&lt;resources&gt;</code>标签下面；但放到不同的文件中，更方便查找<br>例如：<code>color</code>、<code>declare-styleable</code>、<code>dimen</code>、<code>integer</code>、<code>item</code>、<code>string</code>、<code>style</code>。</li>
</ul>
<h2 id="string标签translatable属性"><a href="#string标签translatable属性" class="headerlink" title="string标签translatable属性"></a>string标签translatable属性</h2><p>使用<code>translatable=&quot;false&quot;</code>属性可以让内容直接嵌入到引用的地方，而不做翻译处理。</p>
<ul>
<li>举例来说，下面的用法就可以将<code>android.support.design.widget.AppBarLayout$ScrollingViewBehavior</code>直接嵌入到了<code>ScrollView</code>。</li>
</ul>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ScrollView</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">app:layout_behavior</span>=<span class="string">&quot;@string/appbar_scrolling_view_behavior&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;appbar_scrolling_view_behavior&quot;</span> <span class="attr">translatable</span>=<span class="string">&quot;false&quot;</span>&gt;</span>android.support.design.widget.AppBarLayout$ScrollingViewBehavior<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>另一种方案：<blockquote>
<p>It’s the ignore attribute of the tools namespace in your strings file, as follows:</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">tools:ignore</span>=<span class="string">&quot;MissingTranslation&quot;</span> &gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- your strings here; no need now for the translatable attribute --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="使用场合"><a href="#使用场合" class="headerlink" title="使用场合"></a>使用场合</h3><p>不希望字符串被翻译。</p>
<h3 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="http://tools.android.com/recent/non-translatablestrings">Non-translatable Strings</a></li>
<li><a href="http://stackoverflow.com/questions/3925072/what-is-the-purpose-of-using-translatable-in-android-strings/13688979">What is the purpose of using translatable in Android strings?</a></li>
<li><a href="http://stackoverflow.com/questions/12590739/avoid-android-lint-complains-about-not-translated-string">Avoid Android Lint complains about not-translated string</a><blockquote>
<p>If you don’t want a string to be translated, you should only define it in the “base values/folder”, which means do not enter the string in the translated values/folder.</p>
</blockquote>
</li>
</ul>
<h2 id="string动态设置下划线文本的方案；"><a href="#string动态设置下划线文本的方案；" class="headerlink" title="string动态设置下划线文本的方案；"></a>string动态设置下划线文本的方案；</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 还可以使用：&lt;b&gt;、&lt;i&gt;、&lt;u&gt;等html标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;nav_name&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">u</span>&gt;</span>%1$s<span class="tag">&lt;/<span class="name">u</span>&gt;</span><span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/tv_nav_name&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;@string/nav_name&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:textColor</span>=<span class="string">&quot;@color/colorPrimary&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:textSize</span>=<span class="string">&quot;18sp&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 动态控制带下划线的文本内容</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;昵称&quot;</span>;</span><br><span class="line">tvName.setText(mContext.getString(R.string.nav_name, name));</span><br></pre></td></tr></table></figure>

<h2 id="使用string字符串资源的一些建议"><a href="#使用string字符串资源的一些建议" class="headerlink" title="使用string字符串资源的一些建议"></a>使用string字符串资源的一些建议</h2><ul>
<li>不同模块相同的文字不要复用，最好每个模块都对应自己的字符串资源（否则，牵一发而动全身，除非你就想要这样）；</li>
</ul>
<h2 id="string字符串中的单复数"><a href="#string字符串中的单复数" class="headerlink" title="string字符串中的单复数"></a>string字符串中的单复数</h2><ul>
<li>单纯引用<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plurals</span> <span class="attr">name</span>=<span class="string">&quot;book&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;one&quot;</span>&gt;</span>book<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;others&quot;</span>&gt;</span>books<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plurals</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">bookCount</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">mContext.gerResources().getQuantityString(R.plurals.book, bookCount);</span><br><span class="line"><span class="comment">//~ result: books</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plurals</span> <span class="attr">name</span>=<span class="string">&quot;book&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;one&quot;</span>&gt;</span>%d book found.<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;others&quot;</span>&gt;</span>%d books found.<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plurals</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">bookCount</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line">mContext.gerResources().getQuantityString(R.plurals.book, bookCount, bookCount);</span><br><span class="line"><span class="comment">//~ result: 4 books found.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>When using the getQuantityString() method,<br>you need to pass the count twice if your string includes string formatting with a number.<br>For example, for the string %d songs found,<br>the first count parameter selects the appropriate plural string<br>and the second count parameter is inserted into the %d placeholder.<br>If your plural strings do not include string formatting,<br>you don’t need to pass the third parameter to getQuantityString.</p>
</blockquote>
<h3 id="外部链接-1"><a href="#外部链接-1" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="http://blog.jiguang.cn/android-strings/">不可不知的 Android strings.xml 那些事</a></li>
<li><a href="https://developer.android.com/guide/topics/resources/string-resource.html#StylingWithSpannables">String Resources</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android通知相关</title>
    <url>/android/%E9%80%9A%E7%9F%A5/</url>
    <content><![CDATA[<p>有些手机默认不开启通知权限，需要我们自己来检测和提示用户开启。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">enableNotificationPermission</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.KITKAT) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (Uapp.isNotificationEnabled(context)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_SP_CLOSE_NOTIFICATION</span> <span class="operator">=</span> <span class="string">&quot;KEY_SP_CLOSE_NOTIFICATION&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (Usp.init(context).getBoolean(KEY_SP_CLOSE_NOTIFICATION, <span class="literal">false</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(context,</span><br><span class="line">            android.R.style.Theme_DeviceDefault_Light_Dialog)</span><br><span class="line">            .setTitle(<span class="string">&quot;友情提示&quot;</span>).setMessage(<span class="string">&quot;为了给您提供更好的服务，请开启应用通知权限&quot;</span>)</span><br><span class="line">            .setNegativeButton(<span class="string">&quot;不用了&quot;</span>, (dialog, which) -&gt; Usp.init(context)</span><br><span class="line">                    .putBoolean(KEY_SP_CLOSE_NOTIFICATION, <span class="literal">true</span>)</span><br><span class="line">                    .commit())</span><br><span class="line">            .setNeutralButton(<span class="string">&quot;下次再说&quot;</span>, (dialog, which) -&gt; &#123;</span><br><span class="line">                <span class="comment">// do nothing</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .setPositiveButton(<span class="string">&quot;去开启&quot;</span>, (dialog, which) -&gt; &#123;</span><br><span class="line">                Uapp.openAppDetailSettings(context);</span><br><span class="line">            &#125;)</span><br><span class="line">            .setCancelable(<span class="literal">false</span>)</span><br><span class="line">            .create()</span><br><span class="line">            .show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Uapp</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断是否开启通知权限</span></span><br><span class="line"><span class="comment">     * (https://blog.csdn.net/reglog/article/details/79863751)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequiresApi(api = Build.VERSION_CODES.KITKAT)</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isNotificationEnabled</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">CHECK_OP_NO_THROW</span> <span class="operator">=</span> <span class="string">&quot;checkOpNoThrow&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">OP_POST_NOTIFICATION</span> <span class="operator">=</span> <span class="string">&quot;OP_POST_NOTIFICATION&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">AppOpsManager</span> <span class="variable">mAppOps</span> <span class="operator">=</span> (AppOpsManager) context.getSystemService(Context.APP_OPS_SERVICE);</span><br><span class="line">        <span class="type">ApplicationInfo</span> <span class="variable">appInfo</span> <span class="operator">=</span> context.getApplicationInfo();</span><br><span class="line">        <span class="type">String</span> <span class="variable">pkg</span> <span class="operator">=</span> context.getApplicationContext().getPackageName();</span><br><span class="line">        <span class="type">int</span> <span class="variable">uid</span> <span class="operator">=</span> appInfo.uid;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Context.APP_OPS_MANAGER */</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">appOpsClass</span> <span class="operator">=</span> Class.forName(AppOpsManager.class.getName());</span><br><span class="line"></span><br><span class="line">            <span class="type">Method</span> <span class="variable">checkOpNoThrowMethod</span> <span class="operator">=</span> appOpsClass.getMethod(CHECK_OP_NO_THROW, Integer.TYPE, Integer.TYPE,</span><br><span class="line">                    String.class);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">opPostNotificationValue</span> <span class="operator">=</span> appOpsClass.getDeclaredField(OP_POST_NOTIFICATION);</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> (Integer) opPostNotificationValue.get(Integer.class);</span><br><span class="line">            <span class="keyword">return</span> ((Integer) checkOpNoThrowMethod.invoke(mAppOps, value, uid, pkg) == AppOpsManager.MODE_ALLOWED);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 跳转APP设置界面</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">openAppDetailSettings</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="comment">//跳转设置界面</span></span><br><span class="line">        <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">9</span>) &#123;</span><br><span class="line">            intent.setAction(<span class="string">&quot;android.settings.APPLICATION_DETAILS_SETTINGS&quot;</span>);</span><br><span class="line">            intent.setData(Uri.fromParts(<span class="string">&quot;package&quot;</span>, context.getPackageName(), <span class="literal">null</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt;= <span class="number">8</span>) &#123;</span><br><span class="line">            intent.setAction(Intent.ACTION_VIEW);</span><br><span class="line">            intent.setClassName(<span class="string">&quot;com.android.settings&quot;</span>, <span class="string">&quot;com.android.setting.InstalledAppDetails&quot;</span>);</span><br><span class="line">            intent.putExtra(<span class="string">&quot;com.android.settings.ApplicationPkgName&quot;</span>, context.getPackageName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        context.startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android中布局技巧</title>
    <url>/android/%E9%80%82%E9%85%8D/</url>
    <content><![CDATA[<h2 id="Android-屏幕尺寸对应文件夹"><a href="#Android-屏幕尺寸对应文件夹" class="headerlink" title="Android 屏幕尺寸对应文件夹"></a>Android 屏幕尺寸对应文件夹</h2><figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">HVGA  : <span class="type">mdpi</span></span><br><span class="line">WVGA  : <span class="type">hdpi</span></span><br><span class="line">FWVGA : <span class="type">hdpi</span></span><br><span class="line">QHD   : <span class="type">hdpi</span></span><br><span class="line"><span class="number">720</span>P  : <span class="type">xhdpi</span></span><br><span class="line"><span class="number">1080</span>P : <span class="type">xxhdpi</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="http://blog.csdn.net/sarsscofy/article/details/9249397">android 常见分辨率（mdpi、hdpi 、xhdpi、xxhdpi ）及屏幕适配注意事项</a></li>
</ul>
<h2 id="icon"><a href="#icon" class="headerlink" title="icon"></a>icon</h2><figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">: <span class="number">48</span><span class="keyword">x</span><span class="number">48</span></span><br><span class="line">: <span class="number">72</span><span class="keyword">x</span><span class="number">72</span></span><br><span class="line">: <span class="number">96</span><span class="keyword">x</span><span class="number">96</span></span><br><span class="line">: <span class="number">144</span><span class="keyword">x</span><span class="number">144</span></span><br><span class="line">: <span class="number">192</span><span class="keyword">x</span><span class="number">192</span></span><br></pre></td></tr></table></figure>

<p><a href="https://stackoverflow.com/questions/13639263/whats-the-correct-size-icon-for-drawable-xxhdpi">https://stackoverflow.com/questions/13639263/whats-the-correct-size-icon-for-drawable-xxhdpi</a></p>
<h2 id="更新您的应用以充分利用新款-Android-旗舰设备上更大的纵横比"><a href="#更新您的应用以充分利用新款-Android-旗舰设备上更大的纵横比" class="headerlink" title="更新您的应用以充分利用新款 Android 旗舰设备上更大的纵横比"></a><a href="https://googledeveloperschina.blogspot.com/2017/04/android.html">更新您的应用以充分利用新款 Android 旗舰设备上更大的纵横比</a></h2><ul>
<li><a href="https://www.jianshu.com/p/a386434458be">https://www.jianshu.com/p/a386434458be</a></li>
<li><a href="https://android-developers.googleblog.com/2017/03/update-your-app-to-take-advantage-of.html">https://android-developers.googleblog.com/2017/03/update-your-app-to-take-advantage-of.html</a></li>
</ul>
<h2 id="icon-1"><a href="#icon-1" class="headerlink" title="icon"></a>icon</h2><ul>
<li><a href="https://stackoverflow.com/questions/23935810/mipmap-drawables-for-icons">android - Mipmap drawables for icons - Stack Overflow</a></li>
</ul>
<table>
<thead>
<tr>
<th>名称</th>
<th>尺寸</th>
<th>位置</th>
</tr>
</thead>
<tbody><tr>
<td>MDPI</td>
<td>48x48</td>
<td>mipmap-mdpi/ic_launcher.png</td>
</tr>
<tr>
<td>HDPI</td>
<td>72x72</td>
<td>mipmap-hdpi/ic_launcher.png</td>
</tr>
<tr>
<td>XHDPI</td>
<td>96x96</td>
<td>mipmap-xhdpi/ic_launcher.png</td>
</tr>
<tr>
<td>XXHDPI</td>
<td>144x144</td>
<td>mipmap-xxhdpi/ic_launcher.png</td>
</tr>
<tr>
<td>XXXHDPI</td>
<td>192x192</td>
<td>mipmap-xxxhdpi/ic_launcher.png</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> res &amp;&amp; <span class="built_in">cd</span> res</span><br><span class="line"><span class="built_in">mkdir</span> mipmap-mdpi mipmap-hdpi mipmap-xhdpi mipmap-xxhdpi mipmap-xxxhdpi</span><br><span class="line">ic_launcher.png</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android面试题</title>
    <url>/android/%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
    <content><![CDATA[<blockquote>
<p>看了那么多书，真心发现一个道理：看懂了并不表示会说会用。</p>
</blockquote>
<h1 id="怎样改变-int-的第二个字节；"><a href="#怎样改变-int-的第二个字节；" class="headerlink" title="怎样改变 int 的第二个字节；"></a>怎样改变 int 的第二个字节；</h1><p>答：一种是采用位运算。<br>还可以通过将 int 转换成二进制的字符串，针对字符串进行操作。<br>（可我当时是什么情况呢，我忘了 int 有几个字节了）<br><img src="http://cdn.lyloou.com/img/%E9%9D%A2%E8%AF%95%E9%A2%98-2021-08-23-14-18-06.png" alt="面试题-2021-08-23-14-18-06"></p>
<h1 id="Java-怎么实现乘以-2-的操作；"><a href="#Java-怎么实现乘以-2-的操作；" class="headerlink" title="Java 怎么实现乘以 2 的操作；"></a>Java 怎么实现乘以 2 的操作；</h1><p>答：通过移位操作的左移运算；（这个也要忘掉？）</p>
<h1 id="介绍下二叉树"><a href="#介绍下二叉树" class="headerlink" title="介绍下二叉树"></a>介绍下<code>二叉树</code></h1><p>答： 每个节点最多有 2 个子树的树结构。<br>使用场景：常被用于实现二叉查找树和二元堆积。<br>存储表示：通过数组和链接串列来存储。<br>访问二叉树的方法：前序遍历，中序遍历，后序遍历。<br>参考资料： <a href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%8F%89%E6%A0%91">二叉树-维基百科</a><br>（还是将数据结构和算法恶补下吧，基础太薄弱了）</p>
<h1 id="view-中的draw-和onDraw-区别"><a href="#view-中的draw-和onDraw-区别" class="headerlink" title="view 中的draw()和onDraw()区别"></a>view 中的<code>draw()</code>和<code>onDraw()</code>区别</h1><p>答：</p>
<ul>
<li><code>onDraw()</code>是<code>draw()</code>方法的一部分；</li>
<li>自定义 View 时只需要重写<code>onDraw()</code>方法；<br>（通过源码<code>public void draw(Canvas canvas) </code>,<br>发现在<code>draw()</code>方法中，对<code>onDraw</code>进行了调用）</li>
</ul>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line"><span class="bullet">* </span>Draw traversal performs several drawing steps which must be executed</span><br><span class="line"><span class="bullet">* </span>in the appropriate order:</span><br><span class="line"><span class="bullet">*</span></span><br><span class="line"><span class="bullet"></span><span class="bullet">*      </span>1. Draw the background</span><br><span class="line"><span class="bullet">*      </span>2. If necessary, save the canvas&#x27; layers to prepare for fading</span><br><span class="line"><span class="bullet">*      </span>3. Draw view&#x27;s content</span><br><span class="line"><span class="bullet">*      </span>4. Draw children</span><br><span class="line"><span class="bullet">*      </span>5. If necessary, draw the fading edges and restore layers</span><br><span class="line"><span class="bullet">*      </span>6. Draw decorations (scrollbars for instance)</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<p>When implementing a view, implement onDraw instead of draw(Canvas)</p>
<p>参考资料：</p>
<ul>
<li>View.java 源码的 draw(Canvas)方法；</li>
<li><a href="http://www.eoeandroid.com/thread-98648-1-1.html">[Android 界面] 请教一下 View 中的 draw 和 onDraw 有什么区别</a></li>
</ul>
]]></content>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>【Business】 ID设计</title>
    <url>/business/ID%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://www.zhihu.com/question/20180484">分布式系统里用户 ID 生成有什么好的方法和规则能满足“唯一、尽量短、不能直接看出规则”这几个条件? - 知乎</a></li>
<li><a href="https://tech.meituan.com/2017/04/21/mt-leaf.html">Leaf——美团点评分布式 ID 生成系统 - 美团技术团队</a></li>
</ul>
<h2 id="雪花生成器"><a href="#雪花生成器" class="headerlink" title="雪花生成器"></a>雪花生成器</h2><ul>
<li><a href="https://www.cnblogs.com/relucent/p/4955340.html">Twitter 的分布式自增 ID 算法 snowflake (Java 版) - relucent - 博客园</a></li>
<li><a href="https://blog.csdn.net/weixin_38657051/article/details/94713695?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.nonecase">Mybatis-Plus 雪花 id 的使用以及解析机器 ID 和数据标识 ID_摩羯座 de 杰杰陆的博客-CSDN 博客</a></li>
<li><a href="https://github.com/lyloou/spring-boot-web/">https://github.com/lyloou/spring-boot-web/</a></li>
</ul>
<h4 id="根据不同业务配置成多个生成器"><a href="#根据不同业务配置成多个生成器" class="headerlink" title="根据不同业务配置成多个生成器"></a>根据不同业务配置成多个生成器</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyloou.demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyloou.common.util.SnowflakeIdWorker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SnowflakeConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;snowflake.workerId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long workerId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Type</span> &#123;</span><br><span class="line">        ORDER(<span class="string">&quot;ORD&quot;</span>, <span class="number">0</span>),</span><br><span class="line">        REFUND(<span class="string">&quot;REF&quot;</span>, <span class="number">1</span>),</span><br><span class="line">        RETURN(<span class="string">&quot;RET&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String prefix;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">long</span> datacenterId;</span><br><span class="line"></span><br><span class="line">        Type(String prefix, <span class="type">long</span> datacenterId) &#123;</span><br><span class="line">            <span class="built_in">this</span>.prefix = prefix;</span><br><span class="line">            <span class="built_in">this</span>.datacenterId = datacenterId;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getPrefix</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> prefix;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    SnowflakeIdWorker <span class="title function_">orderWorker</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SnowflakeIdWorker</span>(workerId, Type.ORDER.datacenterId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    SnowflakeIdWorker <span class="title function_">refundWorker</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SnowflakeIdWorker</span>(workerId, Type.REFUND.datacenterId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    SnowflakeIdWorker <span class="title function_">returnWorker</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SnowflakeIdWorker</span>(workerId, Type.RETURN.datacenterId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="生成器的生成逻辑"><a href="#生成器的生成逻辑" class="headerlink" title="生成器的生成逻辑"></a>生成器的生成逻辑</h4><p>依据类型来生成（如，订单流水 ID、退款流水 ID、退货流水 ID）<br>这里，将 dataCenterId 当做类型来使用（还可以再拆分下，适用不同场景）；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyloou.demo.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lyloou.common.exception.CommonException;</span><br><span class="line"><span class="keyword">import</span> com.lyloou.common.util.SnowflakeIdWorker;</span><br><span class="line"><span class="keyword">import</span> com.lyloou.demo.config.SnowflakeConfig;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SnowflakeIdGenerator</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SnowflakeIdWorker orderWorker;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SnowflakeIdWorker refundWorker;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SnowflakeIdWorker returnWorker;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">genId</span><span class="params">(SnowflakeConfig.Type type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> type.getPrefix() + getId(type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="title function_">getId</span><span class="params">(SnowflakeConfig.Type type)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> ORDER:</span><br><span class="line">                <span class="keyword">return</span> orderWorker.nextId();</span><br><span class="line">            <span class="keyword">case</span> REFUND:</span><br><span class="line">                <span class="keyword">return</span> refundWorker.nextId();</span><br><span class="line">            <span class="keyword">case</span> RETURN:</span><br><span class="line">                <span class="keyword">return</span> returnWorker.nextId();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CommonException</span>(<span class="string">&quot;无效的类型&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="配置-workerId"><a href="#配置-workerId" class="headerlink" title="配置 workerId"></a>配置 workerId</h4><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">snowflake:</span></span><br><span class="line">  <span class="attr">workerId:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>或者配置成启动参数： -Dsnowflake.workerId=3</p>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">package</span> com.lyloou.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.RandomUtil;</span><br><span class="line"><span class="keyword">import</span> com.lyloou.demo.config.SnowflakeConfig;</span><br><span class="line"><span class="keyword">import</span> com.lyloou.demo.util.SnowflakeIdGenerator;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SnowflakeIdGenerator generator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSnowflake</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            System.out.println(generator.genId(SnowflakeConfig.Type.values()[RandomUtil.randomInt(<span class="number">0</span>, <span class="number">3</span>)]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">REF722513947651084288</span></span><br><span class="line"><span class="comment">ORD722513947650953217</span></span><br><span class="line"><span class="comment">ORD722513947650953218</span></span><br><span class="line"><span class="comment">RET722513947651215361</span></span><br><span class="line"><span class="comment">REF722513947651084289</span></span><br><span class="line"><span class="comment">ORD722513947650953219</span></span><br><span class="line"><span class="comment">REF722513947651084290</span></span><br><span class="line"><span class="comment">RET722513947651215362</span></span><br><span class="line"><span class="comment">ORD722513947650953220</span></span><br><span class="line"><span class="comment">REF722513947651084291</span></span><br><span class="line"><span class="comment">ORD722513947650953221</span></span><br><span class="line"><span class="comment">RET722513947651215363</span></span><br><span class="line"><span class="comment">REF722513947651084292</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h4 id="雪花算法实现"><a href="#雪花算法实现" class="headerlink" title="雪花算法实现"></a>雪花算法实现</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyloou.common.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONObject;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Twitter_Snowflake&lt;br&gt;</span></span><br><span class="line"><span class="comment"> * SnowFlake的结构如下(每部分用-分开):&lt;br&gt;</span></span><br><span class="line"><span class="comment"> * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 &lt;br&gt;</span></span><br><span class="line"><span class="comment"> * 1位标识，由于long基本类型在Java中是带符号的，最高位是符号位，正数是0，负数是1，所以id一般是正数，最高位是0&lt;br&gt;</span></span><br><span class="line"><span class="comment"> * 41位时间截(毫秒级)，注意，41位时间截不是存储当前时间的时间截，而是存储时间截的差值（当前时间截 - 开始时间截)</span></span><br><span class="line"><span class="comment"> * 得到的值），这里的的开始时间截，一般是我们的id生成器开始使用的时间，由我们程序来指定的（如下下面程序IdWorker类的startTime属性）。41位的时间截，可以使用69年，年T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69&lt;br&gt;</span></span><br><span class="line"><span class="comment"> * 10位的数据机器位，可以部署在1024个节点，包括5位datacenterId和5位workerId&lt;br&gt;</span></span><br><span class="line"><span class="comment"> * 12位序列，毫秒内的计数，12位的计数顺序号支持每个节点每毫秒(同一机器，同一时间截)产生4096个ID序号&lt;br&gt;</span></span><br><span class="line"><span class="comment"> * 加起来刚好64位，为一个Long型。&lt;br&gt;</span></span><br><span class="line"><span class="comment"> * SnowFlake的优点是，整体上按照时间自增排序，并且整个分布式系统内不会产生ID碰撞(由数据中心ID和机器ID作区分)，并且效率较高，经测试，SnowFlake每秒能够产生26万ID左右。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SnowflakeIdWorker</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ==============================Fields===========================================</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 开始时间截 (2015-01-01)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">twepoch</span> <span class="operator">=</span> <span class="number">1420041600000L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 机器id所占的位数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">workerIdBits</span> <span class="operator">=</span> <span class="number">5L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据标识id所占的位数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">datacenterIdBits</span> <span class="operator">=</span> <span class="number">5L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支持的最大机器id，结果是31 (这个移位算法可以很快的计算出几位二进制数所能表示的最大十进制数)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">maxWorkerId</span> <span class="operator">=</span> -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; workerIdBits);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支持的最大数据标识id，结果是31</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">maxDatacenterId</span> <span class="operator">=</span> -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; datacenterIdBits);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 序列在id中占的位数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">sequenceBits</span> <span class="operator">=</span> <span class="number">12L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 机器ID向左移12位</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">workerIdShift</span> <span class="operator">=</span> sequenceBits;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据标识id向左移17位(12+5)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">datacenterIdShift</span> <span class="operator">=</span> sequenceBits + workerIdBits;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 时间截向左移22位(5+5+12)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">timestampLeftShift</span> <span class="operator">=</span> sequenceBits + workerIdBits + datacenterIdBits;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成序列的掩码，这里为4095 (0b111111111111=0xfff=4095)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">sequenceMask</span> <span class="operator">=</span> -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; sequenceBits);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 工作机器ID(0~31)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> workerId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据中心ID(0~31)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> datacenterId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 毫秒内序列(0~4095)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">sequence</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上次生成ID的时间截</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">lastTimestamp</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//==============================Constructors=====================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造函数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workerId     工作ID (0~31)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> datacenterId 数据中心ID (0~31)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SnowflakeIdWorker</span><span class="params">(<span class="type">long</span> workerId, <span class="type">long</span> datacenterId)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (workerId &gt; maxWorkerId || workerId &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(String.format(<span class="string">&quot;worker Id can&#x27;t be greater than %d or less than 0&quot;</span>, maxWorkerId));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (datacenterId &gt; maxDatacenterId || datacenterId &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(String.format(<span class="string">&quot;datacenter Id can&#x27;t be greater than %d or less than 0&quot;</span>, maxDatacenterId));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.workerId = workerId;</span><br><span class="line">        <span class="built_in">this</span>.datacenterId = datacenterId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ==============================Methods==========================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得下一个ID (该方法是线程安全的)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> SnowflakeId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">long</span> <span class="title function_">nextId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> timeGen();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果当前时间小于上一次ID生成的时间戳，说明系统时钟回退过这个时候应当抛出异常</span></span><br><span class="line">        <span class="keyword">if</span> (timestamp &lt; lastTimestamp) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(</span><br><span class="line">                    String.format(<span class="string">&quot;Clock moved backwards.  Refusing to generate id for %d milliseconds&quot;</span>, lastTimestamp - timestamp));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果是同一时间生成的，则进行毫秒内序列</span></span><br><span class="line">        <span class="keyword">if</span> (lastTimestamp == timestamp) &#123;</span><br><span class="line">            sequence = (sequence + <span class="number">1</span>) &amp; sequenceMask;</span><br><span class="line">            <span class="comment">//毫秒内序列溢出</span></span><br><span class="line">            <span class="keyword">if</span> (sequence == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//阻塞到下一个毫秒,获得新的时间戳</span></span><br><span class="line">                timestamp = tilNextMillis(lastTimestamp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//时间戳改变，毫秒内序列重置</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            sequence = <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//上次生成ID的时间截</span></span><br><span class="line">        lastTimestamp = timestamp;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//移位并通过或运算拼到一起组成64位的ID</span></span><br><span class="line">        <span class="keyword">return</span> ((timestamp - twepoch) &lt;&lt; timestampLeftShift) <span class="comment">//</span></span><br><span class="line">                | (datacenterId &lt;&lt; datacenterIdShift) <span class="comment">//</span></span><br><span class="line">                | (workerId &lt;&lt; workerIdShift) <span class="comment">//</span></span><br><span class="line">                | sequence;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 阻塞到下一个毫秒，直到获得新的时间戳</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lastTimestamp 上次生成ID的时间截</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 当前时间戳</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">long</span> <span class="title function_">tilNextMillis</span><span class="params">(<span class="type">long</span> lastTimestamp)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> timeGen();</span><br><span class="line">        <span class="keyword">while</span> (timestamp &lt;= lastTimestamp) &#123;</span><br><span class="line">            timestamp = timeGen();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> timestamp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回以毫秒为单位的当前时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 当前时间(毫秒)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">long</span> <span class="title function_">timeGen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 原文链接：https://blog.csdn.net/jiangzeyin_/article/details/80784979</span></span><br><span class="line">    <span class="comment">// SELECT (1146667501642584065&gt;&gt;12)&amp;0x1f as workerId,(1146667501642584065&gt;&gt;17)&amp;0x1f as datacenterId;</span></span><br><span class="line">    <span class="keyword">public</span> JSONObject <span class="title function_">parseInfo</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        id = Long.toBinaryString(Long.parseLong(id));</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> id.length();</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">sequenceStart</span> <span class="operator">=</span> len &lt; workerIdShift ? <span class="number">0</span> : (<span class="type">int</span>) (len - workerIdShift);</span><br><span class="line">        <span class="type">int</span> <span class="variable">workerStart</span> <span class="operator">=</span> len &lt; datacenterIdShift ? <span class="number">0</span> : (<span class="type">int</span>) (len - datacenterIdShift);</span><br><span class="line">        <span class="type">int</span> <span class="variable">timeStart</span> <span class="operator">=</span> len &lt; timestampLeftShift ? <span class="number">0</span> : (<span class="type">int</span>) (len - timestampLeftShift);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sequence</span> <span class="operator">=</span> id.substring(sequenceStart, len);</span><br><span class="line">        <span class="type">String</span> <span class="variable">workerId</span> <span class="operator">=</span> sequenceStart == <span class="number">0</span> ? <span class="string">&quot;0&quot;</span> : id.substring(workerStart, sequenceStart);</span><br><span class="line">        <span class="type">String</span> <span class="variable">dataCenterId</span> <span class="operator">=</span> workerStart == <span class="number">0</span> ? <span class="string">&quot;0&quot;</span> : id.substring(timeStart, workerStart);</span><br><span class="line">        <span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> timeStart == <span class="number">0</span> ? <span class="string">&quot;0&quot;</span> : id.substring(<span class="number">0</span>, timeStart);</span><br><span class="line">        <span class="type">int</span> <span class="variable">sequenceInt</span> <span class="operator">=</span> Integer.valueOf(sequence, <span class="number">2</span>);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;sequence&quot;</span>, sequenceInt);</span><br><span class="line">        <span class="type">int</span> <span class="variable">workerIdInt</span> <span class="operator">=</span> Integer.valueOf(workerId, <span class="number">2</span>);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;workerId&quot;</span>, workerIdInt);</span><br><span class="line">        <span class="type">int</span> <span class="variable">dataCenterIdInt</span> <span class="operator">=</span> Integer.valueOf(dataCenterId, <span class="number">2</span>);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;dataCenter&quot;</span>, dataCenterIdInt);</span><br><span class="line">        <span class="type">long</span> <span class="variable">diffTime</span> <span class="operator">=</span> Long.parseLong(time, <span class="number">2</span>);</span><br><span class="line">        <span class="type">long</span> <span class="variable">timeLong</span> <span class="operator">=</span> diffTime + timeStart;</span><br><span class="line"></span><br><span class="line">        jsonObject.put(<span class="string">&quot;date&quot;</span>, timeLong);</span><br><span class="line">        <span class="keyword">return</span> jsonObject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//==============================Test=============================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SnowflakeIdWorker</span> <span class="variable">idWorker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SnowflakeIdWorker</span>(<span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (; System.currentTimeMillis() - start &lt; <span class="number">1000</span>; ) &#123;</span><br><span class="line">            idWorker.nextId();</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(count);</span><br><span class="line">        <span class="type">long</span> <span class="variable">nextId</span> <span class="operator">=</span> idWorker.nextId();</span><br><span class="line">        System.out.println(nextId);</span><br><span class="line">        System.out.println(idWorker.parseInfo(nextId + <span class="string">&quot;&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>business</tag>
      </tags>
  </entry>
  <entry>
    <title>基于 AOP 和 JWT 实现的 Token 身份认证组件</title>
    <url>/business/Token%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><blockquote>
<p>基于 AOP 面向切面编程，在执行前后插入身份认证的逻辑。</p>
</blockquote>
<p><strong>原理细节：</strong></p>
<ul>
<li><p>登录过程：这个过程比较简单，将用户 id、用户名、过期时间等属性结合 jwt 工具生成 token，并将用户的信息存入到缓存中，以供后期使用。</p>
</li>
<li><p>验证过程：前端通过 Header 头信息的 Authorization 属性得到 Token，先进行 token 验证，再结合缓存验证，验证成功的话，将用户 id 和用户名等信息存入 <code>ThreadLocal</code> 中，这样在执行切面逻辑的时候。就可以从 <code>ThreadLocal</code> 中获取数据了，如<code>UserManager.getUserId()</code>；执行完成后需要清除 ThreadLocal 中的数据；代码如下</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ValidateLoginAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Around(&quot;pointCutMethod()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">preHandle</span><span class="params">(ProceedingJoinPoint pjp)</span> &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">    UserContextHolder.getInstance().setContext(userMap);</span><br><span class="line">    <span class="keyword">final</span> Object proceed;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      proceed = pjp.proceed();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      UserContextHolder.getInstance().clear();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> proceed;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>认证接口的范围：给 <code>BaseTokenController</code>这个基类添加 <code>@ValidateLogin</code>，<br>可以实现一个效果，只要自己的 <code>Controller</code> 继承了<code>BaseTokenController</code>，那么就不用再声明<code>@ValidateLogin</code>注解，自定义<code>Controller</code>中的 mapping 都需要身份认证。<br>（这样就免去了繁琐配置：在拦截器中通过通配符的方式配置哪些接口需要拦截，哪些接口需要放行）</li>
</ul>
<h2 id="服务端使用方式"><a href="#服务端使用方式" class="headerlink" title="服务端使用方式"></a>服务端使用方式</h2><p><strong>添加依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lyloou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>component-security-loginvalidator-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lyloou.component.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>继承<code>BaseTokenController</code>类。 因为这个类被<code>@ValidateLogin</code>标记，所以其下的所有子类都需要身份认证（具体实现细节，查看<code>ValidateLoginAspect</code>）。</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> <span class="keyword">extends</span> <span class="title class_">BaseTokenController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从父类继承了ValidateLogin，需要身份验证</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/ping&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">ping</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">userId</span> <span class="operator">=</span> currentUserId();</span><br><span class="line">        System.out.println(userId);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;pong&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>如果继承了 <code>BaseTokenController</code> 类，又希望其中的某个方法不要被拦截，可以在方法上标记 <code>@IgnoreValidateLogin</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> <span class="keyword">extends</span> <span class="title class_">BaseTokenController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    TokenService tokenService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 手动忽略身份验证</span></span><br><span class="line">    <span class="meta">@IgnoreValidateLogin</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(String userId, String username)</span> &#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;userId&quot;</span>, userId);</span><br><span class="line">        map.put(<span class="string">&quot;userName&quot;</span>, username);</span><br><span class="line">        map.put(<span class="string">&quot;userAvatar&quot;</span>, <span class="string">&quot;http://cdn.lyloou.com/a.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> tokenService.createToken(userId, username, JSONUtil.toJsonStr(map));</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>如果没有继承 <code>BaseTokenController</code>，又希望在其中某个方法中做身份认证，获取用户 id，可以在方法上标记<code>@ValidateLogin</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 手动添加身份验证</span></span><br><span class="line">    <span class="meta">@ValidateLogin</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;userinfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">userInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(UserManager.X_USER_ID, UserManager.getUserId() + <span class="string">&quot;&quot;</span>);</span><br><span class="line">        map.put(UserManager.X_USER_IP, UserManager.getUserIP());</span><br><span class="line">        map.put(UserManager.X_USER_NAME, UserManager.getUserName());</span><br><span class="line">        map.put(UserManager.X_USER_INFO, UserManager.getUserInfo());</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用自定义的缓存"><a href="#使用自定义的缓存" class="headerlink" title="使用自定义的缓存"></a>使用自定义的缓存</h2><p>默认使用了内存缓存<code>ConcurrentHashMap</code>（单机版本的）</p>
<p>也可以自定义缓存</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lilou</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021/7/14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisCodeCache</span> <span class="keyword">implements</span> <span class="title class_">DataCache</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisService redisService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TokenProperties tokenProperties</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        set(key, value, tokenProperties.getExpireSecond());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, String value, <span class="type">long</span> timeout)</span> &#123;</span><br><span class="line">        redisService.set(key, value, (<span class="type">int</span>) timeout);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisService.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        redisService.del(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">containsKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisService.exists(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h2><p>在 Header 中配置身份认证 Token 的信息：<br>如：<code>Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2Mjg4MzQ3MjQsImV4cCI6MTYyOTQzOTUyNCwieC11c2VyLW5hbWUiOiJhYmNkZSIsIngtdXNlci1pZCI6IjEifQ.x0nIhSUPfxC5FlnzJ-MmJvLnJv7w5ZvFzGlNphdSByE</code></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>登录接口：</p>
<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/20210813155146.png" alt="image-20210813155138945"></p>
<p>获取用户信息接口：</p>
<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/20210813155327.png" alt="image-20210813155327715"></p>
<h2 id="源码实现"><a href="#源码实现" class="headerlink" title="源码实现"></a>源码实现</h2><p><a href="https://github.com/lyloou/component/tree/master/component-security-loginvalidator-starter">component/component-security-loginvalidator-starter at master · lyloou/component</a></p>
]]></content>
      <tags>
        <tag>java</tag>
        <tag>business</tag>
      </tags>
  </entry>
  <entry>
    <title>【Business】 分佣设计</title>
    <url>/business/%E5%88%86%E4%BD%A3%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<ul>
<li><a href="https://www.jianshu.com/p/63115f1631aa">什么？分销系统分佣比例竟然是这样设置的 - 简书</a></li>
</ul>
]]></content>
      <tags>
        <tag>business</tag>
      </tags>
  </entry>
  <entry>
    <title>分布式事务</title>
    <url>/business/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/</url>
    <content><![CDATA[<h3 id="（AT、TCC、Saga、XA）模式分析"><a href="#（AT、TCC、Saga、XA）模式分析" class="headerlink" title="（AT、TCC、Saga、XA）模式分析"></a>（AT、TCC、Saga、XA）模式分析</h3><blockquote>
<p>四种分布式事务模式，分别在不同的时间被提出，每种模式都有它的适用场景</p>
<ul>
<li>AT 模式是无侵入的分布式事务解决方案，适用于不希望对业务进行改造的场景，几乎 0 学习成本。</li>
<li>TCC 模式是高性能分布式事务解决方案，适用于核心系统等对性能有很高要求的场景。</li>
<li>Saga 模式是长事务解决方案，适用于业务流程长且需要保证事务最终一致性的业务系统，Saga 模式一阶段就会提交本地事务，无锁，长流程情况下可以保证性能，多用于渠道层、集成层业务系统。事务参与者可能是其它公司的服务或者是遗留系统的服务，无法进行改造和提供 TCC 要求的接口，也可以使用 Saga 模式。</li>
<li>XA 模式是分布式强一致性的解决方案，但性能低而使用较少。</li>
</ul>
</blockquote>
<ul>
<li><p><a href="https://zhuanlan.zhihu.com/p/78599954">分布式事务的 4 种模式 - 知乎</a></p>
</li>
<li><p><a href="https://juejin.cn/post/6844903913691283469">分布式事务 Seata Saga 模式首秀以及三种模式详解 | Meetup#3 回顾</a></p>
</li>
<li><p><a href="https://tech.antfin.com/community/activities/779/review/901">分布式事务 Seata 三种模式详解 - 活动回顾</a></p>
</li>
<li><p><a href="http://seata.io/zh-cn/docs/overview/what-is-seata.html">Seata 是什么</a></p>
</li>
</ul>
<blockquote>
<p>由于 Saga 不保证隔离性，所以我们在业务设计的时候需要做到“宁可长款，不可短款”的原则，长款是指在出现差错的时候站在我方的角度钱多了的情况，钱少了则是短款，因为如果长款可以给客户退款，而短款则可能钱追不回来了，也就是说在业务设计的时候，一定是先扣客户帐再入帐，如果因为隔离性问题造成覆盖更新，也不会出现钱少了的情况。</p>
</blockquote>
]]></content>
      <tags>
        <tag>business</tag>
      </tags>
  </entry>
  <entry>
    <title>取四个场次</title>
    <url>/business/%E5%8F%96%E5%9B%9B%E4%B8%AA%E5%9C%BA%E6%AC%A1/</url>
    <content><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假设一个活动中，有 n 个<code>（n的范围是 1&lt;n&lt;10）</code>场次，场次按时间顺序依次进行。<br>其中每个场次有三种状态：「未开始」、「进行中」、「已结束」<br>要求：以当前时间点为参考点，从场次列表中获取最多 4 个场次。<br>场次具体要求如下：</p>
<ol>
<li>不满足 4 场次或正好 4 场次的全部返回。</li>
<li>大于 4 场次时，获取的四个场次有下面这些情况（场次充足的情况下，只有一个【已结束】的场次）：<br>【未开始、未开始、未开始、未开始】<br>【已结束、未开始、未开始、未开始】<br>【已结束、进行中、未开始、未开始】<br>…</li>
</ol>
<h2 id="解决文案："><a href="#解决文案：" class="headerlink" title="解决文案："></a>解决文案：</h2><p><strong>突破点</strong></p>
<p>找到【已结束】的下标，并以此下标为中心来推断其它几个场次。</p>
<p><strong>具体解决步骤</strong></p>
<ol>
<li>少于 4 场次，全部返回；</li>
<li>多余 4 场次，按以下规则取<br>设：index 为最后一个已结束的场次下标，size 为场次列表数量，hasNext 为是否有下一个场次<br>&lt;1. 如果：index=-1 时，表示都没结束，取前 4 个；hasNext=true<br>&lt;2. 如果：size-index&lt;=4 时，表示未结束的不多了，取后 4 个；hasNext=false<br>&lt;3. 否则：取 index、index+1、index+2、index+3；hasNext=true</li>
</ol>
<p><strong>示例代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最多展示 4 个场次</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_SCENE_SIZE</span> <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Result <span class="title function_">getResult</span><span class="params">(List&lt;SceneModel&gt; candidateSceneList)</span> &#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> candidateSceneList.size();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 不足4场次全部返回</span></span><br><span class="line">        <span class="keyword">if</span> (size &lt;= MAX_SCENE_SIZE) &#123;</span><br><span class="line">            result.setHasNext(<span class="literal">false</span>);</span><br><span class="line">            result.setSceneList(candidateSceneList);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 多余4场次，按以下规则取</span></span><br><span class="line">        List&lt;SceneModel&gt; resultList;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取最后一个已结束的场次下标</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> getLastFinishedSceneIndex(candidateSceneList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 如果：index=-1 时，表示都没结束，取前4个；hasNext=true</span></span><br><span class="line">        <span class="keyword">if</span> (index == -<span class="number">1</span>) &#123;</span><br><span class="line">            resultList = candidateSceneList.subList(<span class="number">0</span>, MAX_SCENE_SIZE);</span><br><span class="line">            result.setSceneList(resultList);</span><br><span class="line">            result.setHasNext(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 如果：size-index&lt;=4 时，表示未结束的不多了，取后4个；hasNext=false</span></span><br><span class="line">        <span class="keyword">if</span> (size - index &lt;= MAX_SCENE_SIZE) &#123;</span><br><span class="line">            resultList = candidateSceneList.subList(size - MAX_SCENE_SIZE, size);</span><br><span class="line">            result.setSceneList(resultList);</span><br><span class="line">            result.setHasNext(<span class="literal">false</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 否则：取index、index+1、index+2、index+3；hasNext=true</span></span><br><span class="line">        resultList = candidateSceneList.subList(index, index + MAX_SCENE_SIZE);</span><br><span class="line">        result.setSceneList(resultList);</span><br><span class="line">        result.setHasNext(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>business</tag>
      </tags>
  </entry>
  <entry>
    <title>图形验证码解耦设计</title>
    <url>/business/%E5%9B%BE%E5%BD%A2%E9%AA%8C%E8%AF%81%E7%A0%81%E8%A7%A3%E8%80%A6%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>在调用接口时，要求必须有输入正确的图形验证码才能调用（防刷）。<br>但是，看一些代码中将这个功能和其它业务功能耦合在一起。每次有新的接口需要用时，又得重新复制一份，就想到值得优化重构。</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>生成时，从全部字母和数字中随机获取 6 个字符。<br>接着借助 BufferedImage 和 ImageIO 工具生成字节码格式的图形验证码。<br>再将字节码形式的图形验证码转换成 base64 字符串，等待发给前端，前端接收后可以转换并显示出来（这样我们就可以统一用 json 的方式来和前端交互，返回格式是一样的；还有一种方式是通过回传 IMAGE 类型的方式，不过缺点是接口不统一，前端要单独处理）。</p>
<p>我们随机生成一个唯一标识（uniqueId），标识这次图形验证码请求，并将对应的验证码（graphValidateCode）存放到缓存（redis）中，并设置过期时间。<br>下一个请求需要带上这个唯一标识，和验证码。<br>结合过滤器，这样获取验证码的逻辑就可以和其它业务逻辑解耦了。</p>
<p>哪个接口需要有正确的图形验证码才放行，只需要配置上 api 即可。</p>
<h2 id="过滤器配置"><a href="#过滤器配置" class="headerlink" title="过滤器配置"></a>过滤器配置</h2><p>在过滤器中（GraphValidateCodeFilter）验证图形验证码，从缓存中获取，然后比对传入的验证码。<br>如果没传入参数，或者参数不对，就抛出错误，在统一管理错误的地方进行处理。</p>
<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p>一般情况，异常是在定义了 ControllerAdvice 注解 或者 RestControllerAdvice 注解的类中管理的。<br>但是过滤器中的异常是在 Servlet 之前调用的，ControllerAdvice 适用于 Controller。<br>不过可以换个思路，我们写一个类来继承 ErrorController ，重写 handleError 方法，在过滤器中异常发生时，最后也会来到这个 handleError 方法中，<br>我们在这里可以直接返回，也可以继续抛出异常，如果选择了继续抛出，接着就可以在 GlobalExceptionHandler 中进行捕获（统一出错出口），<br>这样就可以解决 filter 在 Servlet 之前调用问题。</p>
<p>参考资料：<br><a href="https://github.com/szerhusenBC/jwt-spring-security-demo/issues/63#issuecomment-346495732">How to ExceptionHandler of type ExpiredJwtException from JwtAuthenticationTokenFilter? · Issue #63 · szerhusenBC/jwt-spring-security-demo</a><br>It’s because the filter comes before Servlet is invoked. ControllerAdvice only applies to the Controller classes.<br>I’m also trying to find the solution to same problem. Been reading some stackoverflow articles, this one seems promising: <a href="https://stackoverflow.com/questions/34595605/how-to-manage-exceptions-thrown-in-filters-in-spring">https://stackoverflow.com/questions/34595605/how-to-manage-exceptions-thrown-in-filters-in-spring</a> @josevlad<br><a href="https://stackoverflow.com/a/50818385">https://stackoverflow.com/a/50818385</a></p>
<h2 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h2><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line">* 先获取图形验证码</span><br><span class="line">* http:<span class="regexp">//</span>localhost:<span class="number">8080</span><span class="regexp">/api/</span>tool/getGraphValidateCode</span><br><span class="line">* &#123;</span><br><span class="line">* <span class="string">&quot;err_code&quot;</span>: <span class="number">200</span>,</span><br><span class="line">* <span class="string">&quot;err_msg&quot;</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">* <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">* <span class="string">&quot;image&quot;</span>: <span class="string">&quot;iVBORw0KGgoAAAANSUhEUgAAAG4AAAAjCAIAAAD6/6geAAABWklEQVR42u2a0RaEIAhE+f8P3d9oX/alzXIYQLBDp8dCveE4YnIcn75dbmkEjbJRNsq+G2WjbJSNEnv0fGnfIh4WzWVpVzv2YVhxjPVKlHijQod7PUpt0+KOIwJldLuEml0fKIry17kaKNHels1KQkzc+6yiKZxevHuCX99FRHkPlAQUGuW0xTsV2ikr45yDi7jLet1R2AvWCS1DeXrFJToqzKko7YO9Nee+WQn6r61RTsblm/PGXQe3guO7HXAImRP8obulzNBmKP/SZF+U6kU8bgUnNn8gSpWWaVFqBW2RGTI2pLLKYJ+Nifm0MO5YGUIWGQtKdKeYVc4gJH+adEQlgtnGAB5zdVZqBY5zo3ZPyhWeV09wxOcXQanuQ1bBaheUU90wVVW9zvByYxpLy4NomQfHAd8yuhr0NKXyT+Jj0jPUb4xneon/GmKkxhhTvS4V+lGkUnoSTL8omDLPAIEmVgAAAABJRU5ErkJggg==&quot;</span>,</span><br><span class="line">* <span class="string">&quot;graphValidateCode&quot;</span>: <span class="string">&quot;fHELQ&quot;</span>,</span><br><span class="line">* <span class="string">&quot;uniqueId&quot;</span>: <span class="string">&quot;d476ef5e8d6b4e34a7dd5fde9fcd3c78&quot;</span></span><br><span class="line">* &#125;</span><br><span class="line">* &#125;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">* 不填写时：</span><br><span class="line">* http:<span class="regexp">//</span>localhost:<span class="number">8080</span><span class="regexp">/api/u</span>ser/login</span><br><span class="line">* &#123;</span><br><span class="line">* <span class="string">&quot;err_code&quot;</span>: <span class="number">400</span>,</span><br><span class="line">* <span class="string">&quot;err_msg&quot;</span>: <span class="string">&quot;缺少参数：uniqueId&quot;</span>,</span><br><span class="line">* <span class="string">&quot;data&quot;</span>: null</span><br><span class="line">* &#125;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">* 错误时：</span><br><span class="line">* http:<span class="regexp">//</span>localhost:<span class="number">8080</span><span class="regexp">/api/u</span>ser/login?uniqueId=bbbb&amp;graphValidateCode=aaaa</span><br><span class="line">* &#123;</span><br><span class="line">* <span class="string">&quot;err_code&quot;</span>: <span class="number">400</span>,</span><br><span class="line">* <span class="string">&quot;err_msg&quot;</span>: <span class="string">&quot;输入的图形验证码不正确&quot;</span>,</span><br><span class="line">* <span class="string">&quot;data&quot;</span>: null</span><br><span class="line">* &#125;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">* 正确时：</span><br><span class="line">* http:<span class="regexp">//</span>localhost:<span class="number">8080</span><span class="regexp">/api/u</span>ser/login?uniqueId=d476ef5e8d6b4e34a7dd5fde9fcd3c78&amp;graphValidateCode=fHELQ</span><br><span class="line">* &#123;</span><br><span class="line">* <span class="string">&quot;err_code&quot;</span>: <span class="number">200</span>,</span><br><span class="line">* <span class="string">&quot;err_msg&quot;</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">* <span class="string">&quot;data&quot;</span>: <span class="string">&quot;验证了图形验证码才能看到我:login&quot;</span></span><br><span class="line">* &#125;</span><br><span class="line">*/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>RuoYi-VUE</p>
<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><p><a href="https://github.com/lyloou/spring-master/tree/master/spring-security-captcha">https://github.com/lyloou/spring-master/tree/master/spring-security-captcha</a></p>
]]></content>
      <tags>
        <tag>business</tag>
      </tags>
  </entry>
  <entry>
    <title>【Business】 权限设计</title>
    <url>/business/%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<h2 id="后台权限设计"><a href="#后台权限设计" class="headerlink" title="后台权限设计"></a>后台权限设计</h2><p>账号： 登录系统的账号；</p>
<p>角色： 运营、商家、财务、客服、管理员；</p>
<p>权限： 页面权限，操作权限，数据权限；</p>
<p><strong>关系</strong>：</p>
<p>一个账号有多个角色；一个角色有多个权限；</p>
<p><strong>参考</strong></p>
<ul>
<li><a href="https://blog.csdn.net/qq_40147863/article/details/85320371">后台权限管理系统设计（图文教程） - 肖朋伟 - CSDN 博客</a></li>
</ul>
<p>ACL</p>
<p>RBAC<br><a href="https://cloud.tencent.com/developer/article/1175271">手撸 Java Web RBAC 权限管理 - 云+社区 - 腾讯云</a><br><a href="https://github.com/zhaojun1998/Premission-Study/blob/master/README.md">Premission-Study/README.md at master · zhaojun1998/Premission-Study</a></p>
]]></content>
      <tags>
        <tag>business</tag>
      </tags>
  </entry>
  <entry>
    <title>定时任务同步设计</title>
    <url>/business/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%90%8C%E6%AD%A5%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<p>需求，将一个表的内容同步到另一个表中，<br>只同步从某个时间段到现在有更新的记录；</p>
<p>解决思路是：</p>
<ul>
<li><p>如果可以修改表结构，可以加一个 【sync_status（同步状态）】 字段：同步完成后，修改下这个记录；有修改时恢复这个记录；</p>
</li>
<li><p>如果无法修改表结构，但是可以通过【update_time（修改时间）】字段来过滤，数据量太多可以分批处理</p>
<ol>
<li>建立一个任务配置表（t_job_config），在这个配置表中，保存上次的同步信息（如：同步名称，同步时间，同步到了哪个 id，等等）</li>
<li>根据名称，从表中获取任务配置，如果没有就为这个名称新建立一条记录；开始时间为 null</li>
<li>记录下当前时间；作为结束时间</li>
<li>取一个最大条数 MAX；从数据库中根据修改时间和 id 获取记录，对这批数据做处理；<br>记录不为空，取上次获得的最后一条 id 做为下次查询的开始 id，如下面代码所示</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SyncStudentJob</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">isSync</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StudentService studentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JobConfigService jobConfigService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/10 * * * * *&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">syncStudent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isSync) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;上次还没同步完成&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            isSync = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            log.info(<span class="string">&quot;【Job syncStudent】， 开始同步&quot;</span>);</span><br><span class="line">            <span class="type">AtomicLong</span> <span class="variable">count</span> <span class="operator">=</span> doSyncStudent();</span><br><span class="line">            <span class="keyword">final</span> <span class="type">long</span> <span class="variable">t2</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            log.info(<span class="string">&quot;【Job syncStudent】， 完成全部同步，耗时：&#123;&#125;ms，数量：&#123;&#125; &quot;</span>, (t2 - t1) / <span class="number">1000</span>, count.get());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            isSync = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AtomicLong <span class="title function_">doSyncStudent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AtomicLong</span> <span class="variable">count</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">500</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">JobConfigEntity</span> <span class="variable">jobConfig</span> <span class="operator">=</span> getOrCreateJobConfig();</span><br><span class="line">        Objects.requireNonNull(jobConfig, <span class="string">&quot;获取或创建jobConfig失败&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">LocalDateTime</span> <span class="variable">endTime</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">LocalDateTime</span> <span class="variable">lastUpdateTime</span> <span class="operator">=</span> getLastUpdateTime(jobConfig);</span><br><span class="line">        <span class="type">String</span> <span class="variable">lastUpdateId</span> <span class="operator">=</span> getLastUpdateId(jobConfig);</span><br><span class="line">        List&lt;StudentEntity&gt; list;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            list = studentService.lambdaQuery()</span><br><span class="line">                    .gt(lastUpdateTime != <span class="literal">null</span>, StudentEntity::getGmtModified, lastUpdateTime)</span><br><span class="line">                    .lt(StudentEntity::getGmtModified, endTime)</span><br><span class="line">                    .gt(StudentEntity::getId, lastUpdateId)</span><br><span class="line">                    .orderByAsc(StudentEntity::getId)</span><br><span class="line">                    .last(String.format(<span class="string">&quot;limit %s&quot;</span>, max))</span><br><span class="line">                    .list();</span><br><span class="line">            <span class="keyword">if</span> (list.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            doList(list);</span><br><span class="line">            count.addAndGet(list.size());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> <span class="type">StudentEntity</span> <span class="variable">lastStudent</span> <span class="operator">=</span> list.get(list.size() - <span class="number">1</span>);</span><br><span class="line">            lastUpdateId = String.valueOf(lastStudent.getId());</span><br><span class="line">            updateJobConfig(jobConfig, lastUpdateTime, lastUpdateId);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            log.info(<span class="string">&quot;【Job syncStudent】， 完成一组同步，耗时：&#123;&#125;ms，数量：&#123;&#125; &quot;</span>, (end - start) / <span class="number">1000</span>, count.get());</span><br><span class="line">        &#125; <span class="keyword">while</span> (list.size() &gt;= max);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新成新的时间</span></span><br><span class="line">        updateJobConfig(jobConfig, endTime, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateJobConfig</span><span class="params">(JobConfigEntity configEntity, LocalDateTime lastUpdateTime, String lastUpdateId)</span> &#123;</span><br><span class="line">        jobConfigService.lambdaUpdate()</span><br><span class="line">                .set(JobConfigEntity::getLastUpdateTime, lastUpdateTime)</span><br><span class="line">                .set(JobConfigEntity::getLastUpdateId, lastUpdateId)</span><br><span class="line">                .eq(JobConfigEntity::getId, configEntity.getId())</span><br><span class="line">                .update();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doList</span><span class="params">(List&lt;StudentEntity&gt; list)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;(&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;</span>);</span><br><span class="line">        log.info(list.toString());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException ignored) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime <span class="title function_">getLastUpdateTime</span><span class="params">(JobConfigEntity jobConfig)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> jobConfig.getLastUpdateTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getLastUpdateId</span><span class="params">(JobConfigEntity jobConfig)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">lastUpdateId</span> <span class="operator">=</span> jobConfig.getLastUpdateId();</span><br><span class="line">        <span class="keyword">if</span> (Strings.isEmpty(lastUpdateId)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lastUpdateId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> JobConfigEntity <span class="title function_">getOrCreateJobConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jobName</span> <span class="operator">=</span> <span class="string">&quot;sync.student.name&quot;</span>;</span><br><span class="line">        <span class="keyword">final</span> Optional&lt;JobConfigEntity&gt; configEntityOptional = jobConfigService.lambdaQuery()</span><br><span class="line">                .eq(JobConfigEntity::getName, jobName)</span><br><span class="line">                .oneOpt();</span><br><span class="line">        <span class="keyword">if</span> (configEntityOptional.isPresent()) &#123;</span><br><span class="line">            <span class="keyword">return</span> configEntityOptional.get();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">JobConfigEntity</span> <span class="variable">configEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JobConfigEntity</span>();</span><br><span class="line">        configEntity.setName(jobName);</span><br><span class="line">        jobConfigService.save(configEntity);</span><br><span class="line">        <span class="keyword">return</span> configEntity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">Source Server : <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">Source Server Type : MySQL</span><br><span class="line">Source Server Version : <span class="number">50731</span></span><br><span class="line">Source Host : <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3306</span></span><br><span class="line">Source Schema : school</span><br><span class="line"></span><br><span class="line">Target Server Type : MySQL</span><br><span class="line">Target Server Version : <span class="number">50731</span></span><br><span class="line">File Encoding : <span class="number">65001</span></span><br><span class="line"></span><br><span class="line"><span class="type">Date</span>: <span class="number">28</span><span class="operator">/</span><span class="number">12</span><span class="operator">/</span><span class="number">2020</span> <span class="number">18</span>:<span class="number">37</span>:<span class="number">34</span></span><br><span class="line">\<span class="operator">*</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">---</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Table structure for t_job_config</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `t_job_config`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_job_config` (</span><br><span class="line">`id` <span class="type">bigint</span>(<span class="number">11</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键 ID&#x27;</span>,</span><br><span class="line">`name` <span class="type">varchar</span>(<span class="number">100</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;要同步的业务名称&#x27;</span>,</span><br><span class="line">`last_update_time` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;上次同步时间&#x27;</span>,</span><br><span class="line">`last_update_id` <span class="type">varchar</span>(<span class="number">100</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;上次同步到了哪里(排序的 id 才有意义，结合 last_update_time 使用)&#x27;</span>,</span><br><span class="line">`memo` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;备注&#x27;</span>,</span><br><span class="line">`ext` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;备用字段&#x27;</span>,</span><br><span class="line">`gmt_create` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">`gmt_modified` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">`disabled` tinyint(<span class="number">1</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;是否已经禁用&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line"><span class="keyword">UNIQUE</span> INDEX `idx_name`(`name`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> MyISAM AUTO_INCREMENT <span class="operator">=</span> <span class="number">7</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">---</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Table structure for t_student</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `t_student`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_student` (</span><br><span class="line">`id` <span class="type">bigint</span>(<span class="number">20</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;学生 ID&#x27;</span>,</span><br><span class="line">`name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;学生名称&#x27;</span>,</span><br><span class="line">`nick_name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;学生昵称&#x27;</span>,</span><br><span class="line">`class_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;班级 ID&#x27;</span>,</span><br><span class="line">`email` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;电子邮件&#x27;</span>,</span><br><span class="line">`phone` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">`avatar` <span class="type">varchar</span>(<span class="number">128</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;大头贴&#x27;</span>,</span><br><span class="line">`gmt_create` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">`gmt_modified` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">0</span>) COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">`disabled` tinyint(<span class="number">1</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;是否已经禁用&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">INDEX `idx_name`(`name`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> MyISAM AUTO_INCREMENT <span class="operator">=</span> <span class="number">1000</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_general_ci COMMENT <span class="operator">=</span> <span class="string">&#x27;学生表&#x27;</span> ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;student001&#x27;</span>, <span class="string">&#x27;学生 001&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;student001@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345001&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-28 15:56:56&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;student002&#x27;</span>, <span class="string">&#x27;学生 002&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;student002@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345002&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;student003&#x27;</span>, <span class="string">&#x27;学生 003&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;student003@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345003&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="string">&#x27;student004&#x27;</span>, <span class="string">&#x27;学生 004&#x27;</span>, <span class="number">9</span>, <span class="string">&#x27;student004@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345004&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">5</span>, <span class="string">&#x27;student005&#x27;</span>, <span class="string">&#x27;学生 005&#x27;</span>, <span class="number">8</span>, <span class="string">&#x27;student005@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345005&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">6</span>, <span class="string">&#x27;student006&#x27;</span>, <span class="string">&#x27;学生 006&#x27;</span>, <span class="number">7</span>, <span class="string">&#x27;student006@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345006&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">7</span>, <span class="string">&#x27;student007&#x27;</span>, <span class="string">&#x27;学生 007&#x27;</span>, <span class="number">6</span>, <span class="string">&#x27;student007@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345007&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">8</span>, <span class="string">&#x27;student008&#x27;</span>, <span class="string">&#x27;学生 008&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;student008@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345008&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">9</span>, <span class="string">&#x27;student009&#x27;</span>, <span class="string">&#x27;学生 009&#x27;</span>, <span class="number">4</span>, <span class="string">&#x27;student009@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345009&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">10</span>, <span class="string">&#x27;student010&#x27;</span>, <span class="string">&#x27;学生 010&#x27;</span>, <span class="number">9</span>, <span class="string">&#x27;student010@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345010&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">11</span>, <span class="string">&#x27;student011&#x27;</span>, <span class="string">&#x27;学生 011&#x27;</span>, <span class="number">8</span>, <span class="string">&#x27;student011@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345011&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">12</span>, <span class="string">&#x27;student012&#x27;</span>, <span class="string">&#x27;学生 012&#x27;</span>, <span class="number">7</span>, <span class="string">&#x27;student012@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345012&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">13</span>, <span class="string">&#x27;student013&#x27;</span>, <span class="string">&#x27;学生 013&#x27;</span>, <span class="number">6</span>, <span class="string">&#x27;student013@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345013&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">14</span>, <span class="string">&#x27;student014&#x27;</span>, <span class="string">&#x27;学生 014&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;student014@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345014&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">15</span>, <span class="string">&#x27;student015&#x27;</span>, <span class="string">&#x27;学生 015&#x27;</span>, <span class="number">4</span>, <span class="string">&#x27;student015@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345015&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">16</span>, <span class="string">&#x27;student016&#x27;</span>, <span class="string">&#x27;学生 016&#x27;</span>, <span class="number">3</span>, <span class="string">&#x27;student016@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345016&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">17</span>, <span class="string">&#x27;student017&#x27;</span>, <span class="string">&#x27;学生 017&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;student017@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345017&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">18</span>, <span class="string">&#x27;student018&#x27;</span>, <span class="string">&#x27;学生 018&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;student018@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345018&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">19</span>, <span class="string">&#x27;student019&#x27;</span>, <span class="string">&#x27;学生 019&#x27;</span>, <span class="number">9</span>, <span class="string">&#x27;student019@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345019&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">20</span>, <span class="string">&#x27;student020&#x27;</span>, <span class="string">&#x27;学生 020&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;student020@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345020&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">21</span>, <span class="string">&#x27;student021&#x27;</span>, <span class="string">&#x27;学生 021&#x27;</span>, <span class="number">4</span>, <span class="string">&#x27;student021@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345021&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">22</span>, <span class="string">&#x27;student022&#x27;</span>, <span class="string">&#x27;学生 022&#x27;</span>, <span class="number">3</span>, <span class="string">&#x27;student022@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345022&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">23</span>, <span class="string">&#x27;student023&#x27;</span>, <span class="string">&#x27;学生 023&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;student023@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345023&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">24</span>, <span class="string">&#x27;student024&#x27;</span>, <span class="string">&#x27;学生 024&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;student024@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345024&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">25</span>, <span class="string">&#x27;student025&#x27;</span>, <span class="string">&#x27;学生 025&#x27;</span>, <span class="number">9</span>, <span class="string">&#x27;student025@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345025&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">26</span>, <span class="string">&#x27;student026&#x27;</span>, <span class="string">&#x27;学生 026&#x27;</span>, <span class="number">8</span>, <span class="string">&#x27;student026@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345026&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">27</span>, <span class="string">&#x27;student027&#x27;</span>, <span class="string">&#x27;学生 027&#x27;</span>, <span class="number">7</span>, <span class="string">&#x27;student027@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345027&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">28</span>, <span class="string">&#x27;student028&#x27;</span>, <span class="string">&#x27;学生 028&#x27;</span>, <span class="number">6</span>, <span class="string">&#x27;student028@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345028&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">29</span>, <span class="string">&#x27;student029&#x27;</span>, <span class="string">&#x27;学生 029&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;student029@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345029&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `school`.`t_student`(`id`, `name`, `nick_name`, `class_id`, `email`, `phone`, `avatar`, `gmt_create`, `gmt_modified`, `disabled`) <span class="keyword">VALUES</span> (<span class="number">30</span>, <span class="string">&#x27;student030&#x27;</span>, <span class="string">&#x27;学生 030&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;student030@coocaa.com&#x27;</span>, <span class="string">&#x27;15212345030&#x27;</span>, <span class="string">&#x27;http://bpic.588ku.com/element_pic/20/06/30/e510dda05e0b09e44cec4e474546a014.jpg&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="string">&#x27;2020-12-22 09:33:35&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>business</tag>
      </tags>
  </entry>
  <entry>
    <title>【Business】 登录设计</title>
    <url>/business/%E7%99%BB%E5%BD%95%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<h2 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h2><h3 id="token-过期重新登录后自动发起上个请求"><a href="#token-过期重新登录后自动发起上个请求" class="headerlink" title="token 过期重新登录后自动发起上个请求"></a>token 过期重新登录后自动发起上个请求</h3><p>举个获取用户的 vip 信息的例子</p>
<h4 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h4><ol>
<li>用户用带<code>token</code>的 Header 头来获取数据：<code>/user/vip/get_info</code>；</li>
<li>后端返回 <code>606, token过期</code>；</li>
<li>前端重新登录，并发起 <code>/user/vip/get_info</code> 来获取数据；（这个过程在 app 后台进行，不要显示给用户）</li>
</ol>
<h4 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 伪代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// reqBackup 可以也可以用 localStorage 来存储</span></span><br><span class="line"><span class="keyword">var</span> reqBackup;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">login</span>(<span class="params">url, param</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> data = http.<span class="title function_">fetch</span>(url, param);</span><br><span class="line">  <span class="keyword">if</span> (data.<span class="property">code</span> === <span class="number">200</span> &amp;&amp; reqBackup.<span class="property">url</span>) &#123;</span><br><span class="line">    reqBackup = &#123;&#125;;</span><br><span class="line">    <span class="title function_">fetchData</span>(reqBackup.<span class="property">url</span>, reqBackup.<span class="property">param</span>, reqBackup.<span class="property">callback</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params">url, param, callback</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> data = http.<span class="title function_">fetch</span>(url, param);</span><br><span class="line">  <span class="comment">// 606, token过期</span></span><br><span class="line">  <span class="keyword">if</span> (data.<span class="property">code</span> === <span class="number">606</span>) &#123;</span><br><span class="line">    reqBackup.<span class="property">url</span> = url;</span><br><span class="line">    reqBackup.<span class="property">param</span> = param;</span><br><span class="line">    reqBackup.<span class="property">callback</span> = callback;</span><br><span class="line">    <span class="title function_">login</span>();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (data.<span class="property">code</span> === <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="title function_">callback</span>(data);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>business</tag>
      </tags>
  </entry>
  <entry>
    <title>接口签名校验设计</title>
    <url>/business/%E7%AD%BE%E5%90%8D%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<h2 id="签名目的"><a href="#签名目的" class="headerlink" title="签名目的"></a>签名目的</h2><ul>
<li>防篡改</li>
<li>防抓包</li>
<li>防刷</li>
<li>更安全</li>
</ul>
<h2 id="签名的主要防御措施："><a href="#签名的主要防御措施：" class="headerlink" title="签名的主要防御措施："></a>签名的主要防御措施：</h2><p>一、 验证签名</p>
<blockquote>
<p>将有效的参数按字典排序，并 md5 或 sha 加密（可以自定义加密算法）得到 param_sign，服务端依据同样的算法得到 server_sign，对比传递过来的 param_sign，不相等断定签名无效。<br>如果请求是 RequestBody ，当作 key 为 “body” ，value 为 json 字符串值传入校验。</p>
</blockquote>
<p>二、 请求的时间是否在限制的时间内（如：1 分钟内）</p>
<blockquote>
<p>判断请求的时间戳是否在允许的范围内</p>
</blockquote>
<p>三、 请求方是否被接口服务注册登记</p>
<blockquote>
<p>判断 clientId 是否有效</p>
</blockquote>
<p>四、 是否重复请求</p>
<blockquote>
<p>通过缓存验证 key (由 clientId+nonce 组成)是否已经存在，nonce 是随机生成的字符串<br>默认开启此功能，并由本地来缓存，可以自定义缓存实现微服务的场景（如 redis 等等）。</p>
</blockquote>
<h2 id="WIKI-文档"><a href="#WIKI-文档" class="headerlink" title="WIKI 文档"></a>WIKI 文档</h2><ul>
<li><a href="https://github.com/lyloou/component/blob/master/component-security-signvalidator-starter/doc/1.1%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.md">1.1 服务端基本使用</a></li>
<li><a href="https://github.com/lyloou/component/blob/master/component-security-signvalidator-starter/doc/1.2%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.md">1.2 客户端基本使用</a></li>
<li><a href="https://github.com/lyloou/component/blob/master/component-security-signvalidator-starter/doc/2.%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E.md">2.配置说明</a></li>
<li><a href="https://github.com/lyloou/component/blob/master/component-security-signvalidator-starter/doc/3.%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BC%93%E5%AD%98.md">3.自定义缓存</a></li>
<li><a href="doc/4.%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AA%8C%E8%AF%81%E5%99%A8.md">4.自定义签名</a></li>
<li><a href="https://github.com/lyloou/component/blob/master/component-security-signvalidator-starter/doc/5.%E7%AD%BE%E5%90%8D%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7.md">5.签名异常捕获</a></li>
</ul>
<h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><p>实现机制：通过拦截器，在真正 handler 之前，对请求拦截后统一处理。</p>
<p>我们可以继承 <code>HandlerInterceptorAdapter</code> 类，然后注册给 WebMvcConfigure，这样我们的拦截器就可以生效了</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SignAutoConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">SignInterceptor</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>签名的原理是：</p>
<ul>
<li>客户端将所有有效参数，将 key 按字典排序，加上密钥，然后 md5 加密得到 sign</li>
<li>服务端用同样的方式得到 sign，比较参数中的 sign 和自己生成的 sign</li>
</ul>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul>
<li>支持上面提到的所有防御措施</li>
<li>支持多客户端</li>
<li>支持自定义缓存</li>
<li>支持自定义验证器</li>
<li>支持全局和局部的开关控制</li>
</ul>
<h2 id="客户端工具"><a href="#客户端工具" class="headerlink" title="客户端工具"></a>客户端工具</h2><p><strong>Java 客户端工具</strong></p>
<blockquote>
<p>SimpleHttpUtil<br>具体见 <a href="https://github.com/lyloou/component/blob/master/component-security-signvalidator-starter/doc/1.2%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.md">1.2 客户端基本使用</a></p>
</blockquote>
<p><strong>Js 客户端工具</strong></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://mp.weixin.qq.com/s/UzEsLtv_ald6Yw1XVAhmwg">再谈前后端 API 签名安全？</a></li>
<li><a href="https://mp.weixin.qq.com/s/ChwFubuX0HcB0DgIEi5Tog">前后端 API 交互如何保证数据安全性？</a></li>
<li><a href="https://blog.51cto.com/u_14888386/2515879">使用 nonce 巩固接口签名安全_猿天地的技术博客_51CTO 博客</a></li>
<li><a href="https://blog.csdn.net/qq_36641443/article/details/108475613">【AOP 实践】接口签名校验<em>Jayin</em>的博客-CSDN 博客</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/112555362">基于 Spring Boot 以及 Redis 使用 Aop 来实现 Api 接口签名验证 - 知乎</a></li>
</ul>
<h2 id="示例源码"><a href="#示例源码" class="headerlink" title="示例源码"></a>示例源码</h2><p><a href="https://github.com/lyloou/component-parent-test/tree/master/component-security-signvalidator-starter-test">https://github.com/lyloou/component-parent-test/tree/master/component-security-signvalidator-starter-test</a></p>
]]></content>
      <tags>
        <tag>java</tag>
        <tag>business</tag>
      </tags>
  </entry>
  <entry>
    <title>订单状态设计</title>
    <url>/business/%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<h2 id="关于数据库‘状态’字段设计的思考与实践-倒骑的驴-博客园"><a href="#关于数据库‘状态’字段设计的思考与实践-倒骑的驴-博客园" class="headerlink" title="关于数据库‘状态’字段设计的思考与实践 - 倒骑的驴 - 博客园"></a><a href="https://www.cnblogs.com/daoqidelv/p/7384648.html">关于数据库‘状态’字段设计的思考与实践 - 倒骑的驴 - 博客园</a></h2><table>
<thead>
<tr>
<th>KEY</th>
<th>VALUE</th>
</tr>
</thead>
<tbody><tr>
<td>CREATE_FAILED</td>
<td>创建订单失败（终态）</td>
</tr>
<tr>
<td>PAY_WAITTING</td>
<td>等待买家付款</td>
</tr>
<tr>
<td>PAY_CONFIRMING</td>
<td>付款确认中</td>
</tr>
<tr>
<td>PAY_FAILED</td>
<td>买家付款失败（终态，依赖需求而定）</td>
</tr>
<tr>
<td>PAY_SUCCESS</td>
<td>买家付款成功</td>
</tr>
<tr>
<td>DELIVERED</td>
<td>卖家已发货</td>
</tr>
<tr>
<td>RECEIVED</td>
<td>买家已收货</td>
</tr>
<tr>
<td>RETURNING</td>
<td>退货中</td>
</tr>
<tr>
<td>RETURN_SUCCESS</td>
<td>退货成功（终态）</td>
</tr>
<tr>
<td>CLOSED</td>
<td>订单关闭（终态）</td>
</tr>
</tbody></table>
<p><img src="https://github.com/lyloou/img/raw/develop/z/20190912144017.png"></p>
<h2 id="拆表"><a href="#拆表" class="headerlink" title="拆表"></a>拆表</h2><p>order: 根据商家(provider_id)的维度来拆单；<br>order_item: 根据规格(product_id)的维度来拆单；</p>
<h2 id="拆状态"><a href="#拆状态" class="headerlink" title="拆状态"></a>拆状态</h2><p>STATUS: ‘PENDING’,’AUTO_CLOSED’,’CLOSED’,’REVIEW_FAIL’,’REVIEWED’,’PICK_FAIL’,’PICKED’,’FINISHED’</p>
<p>PAY_STATUS: ‘PENDING’,’PAYED’,’REFUND_PROCESSING’,’REFUND_SUCCESS’,’PARTIAL_REFUND’</p>
<p>SHIP_STATUS: ‘NOT_SHIPED’,’SENDING’,’DELIVERED’,’PARTIAL_RETURN’,’FULL_RETURN’,’PARTIAL_SENDING’</p>
]]></content>
      <tags>
        <tag>business</tag>
      </tags>
  </entry>
  <entry>
    <title>用户树查找优化</title>
    <url>/business/%E7%94%A8%E6%88%B7%E6%A0%91%E6%9F%A5%E6%89%BE%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<figure class="highlight mathematica"><table><tr><td class="code"><pre><span class="line">    <span class="variable">A</span>                   <span class="variable">B</span></span><br><span class="line">   <span class="operator">/</span> \                 <span class="operator">/|</span>\</span><br><span class="line">  <span class="built_in">C</span>   <span class="built_in">D</span>               <span class="built_in">E</span> <span class="variable">F</span> <span class="variable">G</span></span><br><span class="line"> <span class="operator">/</span> \                 <span class="operator">/</span> \</span><br><span class="line"><span class="variable">H</span>   <span class="built_in">I</span>               <span class="variable">J</span>   <span class="built_in">K</span></span><br><span class="line">   <span class="operator">/</span> \</span><br><span class="line">  <span class="variable">L</span>   <span class="variable">M</span></span><br><span class="line">     <span class="operator">/</span> \</span><br><span class="line">    <span class="built_in">N</span>   <span class="built_in">O</span></span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">id</span>  pid name age  email</span><br><span class="line"><span class="attribute">1</span>	<span class="number">0</span>	A	 <span class="number">18</span>	  A@baomidou.com</span><br><span class="line"><span class="attribute">2</span>	<span class="number">0</span>	B	 <span class="number">20</span>	  B@baomidou.com</span><br><span class="line"><span class="attribute">3</span>	<span class="number">1</span>	C	 <span class="number">28</span>	  C@baomidou.com</span><br><span class="line"><span class="attribute">4</span>	<span class="number">1</span>	D	 <span class="number">21</span>	  D@baomidou.com</span><br><span class="line"><span class="attribute">5</span>	<span class="number">2</span>	E	 <span class="number">24</span>	  E@baomidou.com</span><br><span class="line"><span class="attribute">6</span>	<span class="number">2</span>	F	 <span class="number">18</span>	  F@baomidou.com</span><br><span class="line"><span class="attribute">7</span>	<span class="number">2</span>	G	 <span class="number">10</span>	  G@baomidou.com</span><br><span class="line"><span class="attribute">8</span>	<span class="number">3</span>	H	 <span class="number">35</span>	  H@baomidou.com</span><br><span class="line"><span class="attribute">9</span>	<span class="number">3</span>	I	 <span class="number">21</span>	  I@baomidou.com</span><br><span class="line"><span class="attribute">10</span>	<span class="number">5</span>	J	 <span class="number">18</span>	  J@baomidou.com</span><br><span class="line"><span class="attribute">11</span>	<span class="number">5</span>	K	 <span class="number">23</span>	  K@baomidou.com</span><br><span class="line"><span class="attribute">12</span>	<span class="number">9</span>	L	 <span class="number">18</span>	  L@baomidou.com</span><br><span class="line"><span class="attribute">13</span>	<span class="number">9</span>	M	 <span class="number">33</span>	  M@baomidou.com</span><br><span class="line"><span class="attribute">14</span>	<span class="number">13</span>	N	 <span class="number">22</span>	  N@baomidou.com</span><br><span class="line"><span class="attribute">15</span>	<span class="number">13</span>	O	 <span class="number">11</span>	  O@baomidou.com</span><br></pre></td></tr></table></figure>

<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>节点和父节点之间只有 id 和 pid 上有关联；没有层级字段，没有当前所在的树高度字段，如何在不改变表的情况下，获取所有子节点？；</p>
<p>如果数据库可以重新设计的话，可以用下面的链接介绍的方式来设计：<br><a href="https://segmentfault.com/a/1190000014284076">在数据库中存储一棵树，实现无限级分类 - 个人文章 - SegmentFault 思否</a></p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><h3 id="递归的方式"><a href="#递归的方式" class="headerlink" title="递归的方式"></a>递归的方式</h3><p>找到自己的子节点，再找子子节点，再找子子子节点…<br>这种方式虽能实现，但是如果节点关系复杂越来，因为要每次都要从 sql 中建立连接并查询，就会越来越慢<br>(递归的方式 200 多个后代要 2s 左右才能查出来； 在同样的数据下，用下面介绍的迭代的方式来查不到 100ms)。</p>
<h3 id="迭代的方式"><a href="#迭代的方式" class="headerlink" title="迭代的方式"></a>迭代的方式</h3><ol>
<li>根据 id 查找后代节点时，拼成集合的方式 ids=set(id)，根据 <code>select id,pid from user where pid in (ids)</code> 获取到所有的子节点（拼成实体对象：如具有 id 和 pid 属性的 ParentChild），加入到 ParentChild 列表中；</li>
<li>根据 1 获取的 id 拼成一组新的 ids 获取第二波数据的所有子节点；以此类推，直到 ids 为空为止，说明再无后代了；</li>
<li>根据 ParentChild 列表来构建 map 结构（其中的 key 是节点 ID，value 是直属子节点 ID 列表）</li>
<li>通过在第 3 步获取的 map 缓存，来进行更多的操作，如：查找直属子节点、 查找所有后代；</li>
</ol>
<p>通过迭代的方式，一波一波地获取后代再数据库中进行查询，如果有 10 代，只需要从数据库中，查 10 次即可<br>（用递归的话，可能得成千上万次了），当然如果用户量特别多的时候，就不要用这种只有 id 和 pid 的方式了，得重新设计表了；<br><a href="https://segmentfault.com/a/1190000014284076">在数据库中存储一棵树，实现无限级分类 - 个人文章 - SegmentFault 思否</a></p>
<h4 id="如何查找直属子节点"><a href="#如何查找直属子节点" class="headerlink" title="如何查找直属子节点"></a>如何查找直属子节点</h4><blockquote>
<p>根据节点 id，直接从 map 缓存中获取即可；</p>
</blockquote>
<h4 id="如何查找所有后代"><a href="#如何查找所有后代" class="headerlink" title="如何查找所有后代"></a>如何查找所有后代</h4><blockquote>
<p>第 1 步： 建 1 个 set 集合，用来存储所有的后代；<br>第 2 步： 根据节点 id，从 map 中先找到直属子节点列表，加入到 set 中；<br>第 3 步： 再根据第 2 步得到的子节点列表，遍历这些子节点，从 map 中获取这些子节点的子节点（递归到第 2 步）</p>
</blockquote>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p><strong>service 层实现</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">listDirectChild</span><span class="params">(Integer userId)</span> &#123;</span><br><span class="line">        <span class="type">AbsUserTreeHelper</span> <span class="variable">helper</span> <span class="operator">=</span> newUserTreeHelper(userId);</span><br><span class="line">        <span class="keyword">return</span> getUsers(helper.getDirectChildIds(userId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AbsUserTreeHelper <span class="title function_">newUserTreeHelper</span><span class="params">(Integer userId)</span> &#123;</span><br><span class="line">        checkUserId(userId);</span><br><span class="line">        <span class="type">AbsUserTreeHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserTreeHelper</span>(<span class="built_in">this</span>.baseMapper);</span><br><span class="line">        helper.init(userId);</span><br><span class="line">        <span class="keyword">return</span> helper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkUserId</span><span class="params">(Integer userId)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (userId == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ParamException</span>(<span class="string">&quot;参数无效：userId为&quot;</span> + userId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserTreeHelper</span> <span class="keyword">extends</span> <span class="title class_">AbsUserTreeHelper</span> &#123;</span><br><span class="line">    UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserTreeHelper</span><span class="params">(UserMapper userMapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userMapper = userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> List&lt;ParentChild&gt; <span class="title function_">listParentChild</span><span class="params">(List&lt;Integer&gt; userIdList)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userMapper.listParentChild(userIdList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mapper 层实现</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;ParentChild&gt; <span class="title function_">listParentChild</span><span class="params">(<span class="meta">@Param(&quot;userIdList&quot;)</span> List&lt;Integer&gt; userIdList)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lyloou.demo.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通用查询映射结果 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.lyloou.demo.model.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listParentChild&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lyloou.demo.model.ParentChild&quot;</span>&gt;</span></span><br><span class="line">        select id as childId, pid as parentId from t_user where pid in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;userIdList&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">            #&#123;item&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>UserTreeHelper 源码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// UserTreeHelper.java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取用户的直接下属，或全部下属</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserTreeHelper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, List&lt;Integer&gt;&gt; parentToChildrenMap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取map中的所有用户ID</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户ID集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;Integer&gt; <span class="title function_">getAllIds</span><span class="params">()</span> &#123;</span><br><span class="line">        checkInit();</span><br><span class="line">        Set&lt;Integer&gt; allIds = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        Set&lt;Integer&gt; keySet = parentToChildrenMap.keySet();</span><br><span class="line">        <span class="keyword">for</span> (Integer key : keySet) &#123;</span><br><span class="line">            allIds.add(key);</span><br><span class="line">            allIds.addAll(getAllChildIds(key));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> allIds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取树上的全部用户ID列表（不包含自己）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 全部用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;Integer&gt; <span class="title function_">getAllChildIds</span><span class="params">(Integer userId)</span> &#123;</span><br><span class="line">        checkInit();</span><br><span class="line">        <span class="keyword">return</span> getAllChildIds(userId, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkInit</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (parentToChildrenMap == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;没有调用初始化方法，请调用init方法初始化&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Integer&gt; <span class="title function_">getAllChildIds</span><span class="params">(Integer userId, Set&lt;Integer&gt; idSet)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (idSet == <span class="literal">null</span>) &#123;</span><br><span class="line">            idSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Integer&gt; idList = parentToChildrenMap.getOrDefault(userId, Collections.emptyList());</span><br><span class="line">        <span class="keyword">if</span> (idList.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> idSet;</span><br><span class="line">        &#125;</span><br><span class="line">        idSet.addAll(idList);</span><br><span class="line">        <span class="keyword">for</span> (Integer id : idList) &#123;</span><br><span class="line">            getAllChildIds(id, idSet);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> idSet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取直属用户ID列表 （不包含自己）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户的ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 直属用户ID列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;Integer&gt; <span class="title function_">getDirectChildIds</span><span class="params">(Integer userId)</span> &#123;</span><br><span class="line">        checkInit();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(parentToChildrenMap.getOrDefault(userId, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户ID来初始化 Helper</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(Integer userId)</span> &#123;</span><br><span class="line">        init(Collections.singletonList(userId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把一组用户和它们的后代缓存起来</span></span><br><span class="line"><span class="comment">     * 后面可以通过map.get(userId) 的方式获取userId对应的直接子节点</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userIdList 用户列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(List&lt;Integer&gt; userIdList)</span> &#123;</span><br><span class="line">        parentToChildrenMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        iterateUser(userIdList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过迭代的方式重新实现，一波一波地获取，而不是一个一个地获取</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userIdList 用户列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">iterateUser</span><span class="params">(List&lt;Integer&gt; userIdList)</span> &#123;</span><br><span class="line">        Set&lt;ParentChild&gt; allParentChildren = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        List&lt;ParentChild&gt; parentChildren = listParentChild(userIdList);</span><br><span class="line">        <span class="keyword">while</span> (!parentChildren.isEmpty()) &#123;</span><br><span class="line">            allParentChildren.addAll(parentChildren);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取这一波的id</span></span><br><span class="line">            List&lt;Integer&gt; newRoundIds = parentChildren.stream().map(ParentChild::getChildId).collect(Collectors.toList());</span><br><span class="line">            parentChildren = listParentChild(newRoundIds);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (ParentChild parentChild : allParentChildren) &#123;</span><br><span class="line">            List&lt;Integer&gt; oldList = parentToChildrenMap.getOrDefault(parentChild.getParentId(), <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">            oldList.add(parentChild.getChildId());</span><br><span class="line">            parentToChildrenMap.put(parentChild.getParentId(), oldList);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;ParentChild&gt; <span class="title function_">listParentChild</span><span class="params">(List&lt;Integer&gt; userIdList)</span>&#123;</span><br><span class="line">       <span class="comment">//伪代码 List&lt;ParentChild&gt; list = select id,pid from user where pid in (userIdList);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ParentChild.java</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParentChild</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer pid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Main.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserTreeHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserTreeHelper</span>();</span><br><span class="line">        helper.init(<span class="number">1</span>);</span><br><span class="line">        List&lt;Integer&gt; ids = helper.getAllChildIds(<span class="number">1</span>);</span><br><span class="line">        System.out.println(ids);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更多可查看源码实现"><a href="#更多可查看源码实现" class="headerlink" title="更多可查看源码实现"></a>更多可查看源码实现</h4><p><a href="https://github.com/lyloou/spring-boot-web/blob/v1.1.0/src/main/java/com/lyloou/demo/service/helper/AbsUserTreeHelper.java">https://github.com/lyloou/spring-boot-web/blob/v1.1.0/src/main/java/com/lyloou/demo/service/helper/AbsUserTreeHelper.java</a></p>
]]></content>
      <tags>
        <tag>business</tag>
      </tags>
  </entry>
  <entry>
    <title>C编译</title>
    <url>/c/make%20and%20compile/</url>
    <content><![CDATA[<p><a href="https://www.videolan.org/developers/libdvbcsa.html">https://www.videolan.org/developers/libdvbcsa.html</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/local/lib</span><br><span class="line">sudo ldconfig -v</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># configure.ac</span></span><br><span class="line"><span class="comment"># Makefile.am</span></span><br><span class="line">git <span class="built_in">clone</span> https://code.videolan.org/videolan/libdvbcsa.git</span><br><span class="line"><span class="built_in">cd</span> libdvbcsa</span><br><span class="line"></span><br><span class="line">sudo apt-get install automake autoconf</span><br><span class="line">sudo apt-get install libtool</span><br><span class="line">autoreconf -i</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/bugutian/p/5560548.html">https://www.cnblogs.com/bugutian/p/5560548.html</a><br><a href="http://www.51cos.com/?p=1649">http://www.51cos.com/?p=1649</a></p>
]]></content>
      <tags>
        <tag>c</tag>
      </tags>
  </entry>
  <entry>
    <title>Cordova相关</title>
    <url>/cordova/cordova%E7%9B%B8%E5%85%B3/</url>
    <content><![CDATA[<h2 id="一个坑"><a href="#一个坑" class="headerlink" title="一个坑"></a>一个坑</h2><p>运行环境</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">java</span>: jdk1.<span class="number">8</span></span><br><span class="line"><span class="attribute">cordova</span>: <span class="number">6</span>.<span class="number">4</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>通过<code>cordova build android</code>的方式自动编译打包程序时，<br>Manifest文件会被重新生成。</p>
<p>我给第一个Activity设置了屏幕不反旋转的属性<code>android:screenOrientation=&quot;portrait&quot;</code>，但是自动生成的过程中，总会将这行代码自动删除了。</p>
<p>解决办法是：找一个不含该属性的Activity放在第一个位置。</p>
<h2 id="覆盖安装APP，assets文件不更新问题"><a href="#覆盖安装APP，assets文件不更新问题" class="headerlink" title="覆盖安装APP，assets文件不更新问题"></a>覆盖安装APP，assets文件不更新问题</h2><h3 id="症状"><a href="#症状" class="headerlink" title="症状"></a>症状</h3><p>用cordova生成的app，其中的assets文件夹中保存的是前端文件<code>www</code>。如果修改前端代码，<br>覆盖安装app后，其前端代码未生效（原生代码是生效了的）。</p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><ol>
<li>在activity中调用 <code>getAssets()</code>方法；</li>
<li>更新版本号；（对于有些机型来说，相同version的app不会更新assets文件，也不可降级覆盖安装。）</li>
</ol>
<p>相信通过上面两个步骤可以解决掉大部分机型的覆盖安装问题；</p>
<blockquote>
<p>open file with <code>context.getAssets()</code> on each startup of the app, when upgrade the app,<br>first launch it and after that check if file has change.<br>Its seems that until you access the file, it is not extracted from the apk to<br><code>/data/data/&lt;your-package&gt;/</code></p>
</blockquote>
<ul>
<li><a href="https://stackoverflow.com/questions/30651788/android-asset-file-not-upgraded-on-app-upgrade">Android Asset file not upgraded on app upgrade</a></li>
<li><a href="https://stackoverflow.com/questions/33469330/assets-not-replaced-by-version-upgrade">Assets not replaced by version upgrade?</a></li>
<li><a href="http://www.cnblogs.com/feijian/p/4424923.html">android开发，assets下面的资源文件不会变化/改动</a></li>
</ul>
<h2 id="cordova-后台切换到前台触发back返回按键"><a href="#cordova-后台切换到前台触发back返回按键" class="headerlink" title="cordova 后台切换到前台触发back返回按键"></a>cordova 后台切换到前台触发back返回按键</h2><p>问题描述：<br>现在app处在前台，这时候来了一个qq消息或者微信消息，点击通知后再次回来app的时候，会触发返回按键<br>这样就有可能会莫名其妙地将之前的编辑操作给毁掉了。</p>
<p>解决办法：<br>思路是这样的，当离开app的时候，设置一个标志表示现在处于后台了，<br>当再次返回来的时候，先检测之前的标志是否在后台，如果是，则不处理返回按键的逻辑；<br>如果不是，则正常执行返回按键的逻辑。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> isAppInFront = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;pause&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    isAppInFront = <span class="literal">false</span>;</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resume&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        isAppInFront = <span class="literal">true</span>;</span><br><span class="line">    &#125;, <span class="number">200</span>) <span class="comment">// 注意需要延时，否则拿到的标志一直是true</span></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;backbutton&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 程序不在前台运行，不响应</span></span><br><span class="line">    <span class="keyword">if</span>(!isAppInFront) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 其他点按返回按键的逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考资料：  </p>
<ul>
<li><a href="https://stackoverflow.com/questions/29606012/how-to-check-app-running-in-foreground-or-background-in-ionic-cordova-phonegap">javascript - how to check app running in foreground or background in ionic/cordova/phonegap - Stack Overflow</a></li>
</ul>
<h2 id="cordova插件"><a href="#cordova插件" class="headerlink" title="cordova插件"></a>cordova插件</h2><p>社交类：<br>QQ：<a href="https://github.com/iVanPan/Cordova_QQ">https://github.com/iVanPan/Cordova_QQ</a><br>微信：<a href="https://github.com/xu-li/cordova-plugin-wechat">https://github.com/xu-li/cordova-plugin-wechat</a><br>微博：<a href="https://github.com/iVanPan/cordova_weibo">https://github.com/iVanPan/cordova_weibo</a><br>参考网址：<a href="http://blog.csdn.net/jcy472578/article/details/50718951">http://blog.csdn.net/jcy472578/article/details/50718951</a></p>
<p>二维码扫描：<a href="https://github.com/phonegap/phonegap-plugin-barcodescanner">https://github.com/phonegap/phonegap-plugin-barcodescanner</a><br>热更新插件：<a href="https://github.com/nordnet/cordova-hot-code-push/">https://github.com/nordnet/cordova-hot-code-push/</a></p>
<p>Cordova - 从相册中选择照片并上传，以及拍照上传:<br><a href="http://www.hangge.com/blog/cache/detail_1181.html">http://www.hangge.com/blog/cache/detail_1181.html</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cordova plugin add cordova-plugin-camera</span><br><span class="line">cordova plugin add cordova-plugin-file</span><br><span class="line">cordova plugin add cordova-plugin-file-transfer</span><br></pre></td></tr></table></figure>

<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><p>卸载 cordova: <code>npm uninstall -g cordova</code><br>安装 cordova: <code>npm install -g cordova</code><br>安装指定版本 cordova: <code>npm install -g cordova@6.4.0</code></p>
]]></content>
      <tags>
        <tag>cordova</tag>
      </tags>
  </entry>
  <entry>
    <title>Cola架构</title>
    <url>/design-pattern/cola/</url>
    <content><![CDATA[<p><a href="https://blog.csdn.net/significantfrank/article/details/85785565">复杂度应对之道 - COLA 应用架构_我的新书《代码精进之路：从码农到工匠》-CSDN 博客_cola 架构</a><br><a href="https://www.jianshu.com/p/a20e1793f6d9">扩展点设计 - 简书</a><br><a href="https://blog.csdn.net/significantfrank/article/details/79614915#comments_15943809">复杂性应对之道 - 领域建模_我的新书《代码精进之路：从码农到工匠》-CSDN博客</a><br><a href="https://blog.csdn.net/significantfrank/article/details/79286947">SOFA企业应用框架_我的新书《代码精进之路：从码农到工匠》-CSDN博客_sofa框架</a></p>
<p><a href="https://tech.meituan.com/2017/12/22/ddd-in-practice.html">领域驱动设计在互联网业务开发中的实践 - 美团技术团队</a></p>
]]></content>
      <tags>
        <tag>cola</tag>
        <tag>设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>设计模式-单例</title>
    <url>/design-pattern/%E5%8D%95%E4%BE%8B/</url>
    <content><![CDATA[<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">P66</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String []args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                Singleton.getInstance().doSth(); <span class="comment">// ok, only create one instance</span></span><br><span class="line"><span class="comment">//                Singleton.getInstance2().doSth(); // error, will create more than one instance</span></span><br><span class="line"><span class="comment">//                Singleton.getInstance3().doSth(); // error, will create more than one instance, too</span></span><br><span class="line"><span class="comment">//                Singleton.getInstance4().doSth(); // error, maybe cause NullPointerException</span></span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> count;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">            count = count + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(count);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doSth</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// do something</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// double check</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                        instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance2</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance3</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance4</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> instance;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>面向对象设计原则</title>
    <url>/design-pattern/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/</url>
    <content><![CDATA[<h2 id="面向对象设计原则"><a href="#面向对象设计原则" class="headerlink" title="面向对象设计原则"></a>面向对象设计原则</h2><p>（单开里依接组迪：把<code>蛋</code>打<code>开</code>，<code>里</code>面有 <code>一</code> <code>组</code> <code>姐</code> <code>弟</code> `花）</p>
<ol>
<li>单一职责原则：设计目的单一的类；</li>
<li>开放封闭原则：对扩展开放，对修改关闭；</li>
<li>里氏（Liskov）替换原则：子类可以替换父类；</li>
<li>依赖倒置原则：要依赖抽象，而不是具体实现；针对接口编程，不要针对实现编程；</li>
<li>接口隔离原则：使用多个专门的接口，比使用一个单一的总接口好；</li>
<li>组合重用原则：要尽量使用组合，而不是继承关系达到重用的目的；</li>
<li>迪米特（Demeter）原则（最少知识法则）：一个对象应该对其他对象有尽可能少的了解；</li>
</ol>
]]></content>
      <tags>
        <tag>设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>设计模式-参考资料</title>
    <url>/design-pattern/%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/</url>
    <content><![CDATA[<ul>
<li><p><a href="https://github.com/iluwatar/java-design-patterns">java-design-patterns</a></p>
<blockquote>
<p>Design patterns implemented in Java <a href="http://java-design-patterns.com/">http://java-design-patterns.com</a></p>
</blockquote>
</li>
<li><p><a href="http://c.biancheng.net/design_pattern/">http://c.biancheng.net/design_pattern/</a></p>
</li>
</ul>
]]></content>
      <tags>
        <tag>设计模式</tag>
      </tags>
  </entry>
  <entry>
    <title>Become a Better Developer</title>
    <url>/developer/become%20a%20better%20developer/</url>
    <content><![CDATA[<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>~ 自动化<br>~ 规模化<br>~ 低成本<br>~ 高效率</p>
<h2 id="理论学科"><a href="#理论学科" class="headerlink" title="理论学科"></a>理论学科</h2><figure class="highlight node-repl"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span> <span class="language-javascript"><span class="attr">https</span>:<span class="comment">//time.geekbang.org/column/article/8701</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span> <span class="language-javascript">理论学科。你需要学习像算法、数据结构、网络模型、计算机原理等计算机科学专业需要学习的知识。为什么要学好这些理论上的知识呢？</span></span><br><span class="line"><span class="meta prompt_">&gt;</span> <span class="language-javascript">其一，这些理论知识可以说是计算机科学这门学科最精华的知识了。说得大一点，这些是人类智慧的精华。你只要想成为高手，这些东西是你必需要掌握和学习的。</span></span><br><span class="line"><span class="meta prompt_">&gt;</span> <span class="language-javascript">其二，当你在解决一些很复杂或是很难的问题时，这些基础理论知识可以帮到你很多。我过去这 <span class="number">20</span> 年从这些基础理论知识中受益匪浅。</span></span><br><span class="line"><span class="meta prompt_">&gt;</span> <span class="language-javascript">其三，这些理论知识的思维方式可以让你有触类旁通，一通百通的感觉。虽然知识比较难啃，但啃过以后，你将获益终生。</span></span><br><span class="line"><span class="meta prompt_">&gt;</span> <span class="language-javascript">———— 陈浩</span></span><br></pre></td></tr></table></figure>

<h2 id="become-a-better-developer"><a href="#become-a-better-developer" class="headerlink" title="become a better developer"></a>become a better developer</h2><hr>
<ul>
<li><a href="https://coolshell.cn/articles/4235.html">程序员的谎谬之言还是至理名言？ | | 酷 壳 - CoolShell</a></li>
</ul>
<hr>
<ul>
<li><p>All Developers Should Know How They Learn Best (this post)<br><a href="https://www.skorks.com/2009/08/all-developers-should-know-how-they-learn-best/">https://www.skorks.com/2009/08/all-developers-should-know-how-they-learn-best/</a></p>
</li>
<li><p>The Secret Of Being A Great Mentor<br><a href="https://www.skorks.com/2009/09/the-secret-of-being-a-great-mentor/">https://www.skorks.com/2009/09/the-secret-of-being-a-great-mentor/</a><br><a href="https://www.skorks.com/2009/09/manufacturing-authority-and-trust/">https://www.skorks.com/2009/09/manufacturing-authority-and-trust/</a></p>
</li>
<li><p>The Secret Of Being A Great Apprentice</p>
</li>
<li><p>Become A Better Developer By Indexing Your Brain<br><a href="https://www.skorks.com/2009/09/become-a-better-developer-by-indexing-your-brain/">https://www.skorks.com/2009/09/become-a-better-developer-by-indexing-your-brain/</a></p>
</li>
<li><p>Learn More – Faster By Using The World-Wide Community</p>
</li>
<li><p>What Playing Cards Can Teach Us About Ramping-Up And Transferring Knowledge</p>
</li>
</ul>
<hr>
<ul>
<li>Why Developers Never Use State Machines<br><a href="https://www.skorks.com/2011/09/why-developers-never-use-state-machines/">https://www.skorks.com/2011/09/why-developers-never-use-state-machines/</a></li>
<li>Manufacturing Authority And Trust<br><a href="https://www.skorks.com/2009/09/manufacturing-authority-and-trust/">https://www.skorks.com/2009/09/manufacturing-authority-and-trust/</a></li>
</ul>
<h2 id="How-To-Ask-Questions-The-Smart-Way"><a href="#How-To-Ask-Questions-The-Smart-Way" class="headerlink" title="How To Ask Questions The Smart Way"></a><a href="http://www.catb.org/~esr/faqs/smart-questions.html">How To Ask Questions The Smart Way</a></h2><h2 id="If-you-want-to-improve-your-self-confidence-improve-your-skills"><a href="#If-you-want-to-improve-your-self-confidence-improve-your-skills" class="headerlink" title="If you want to improve your self-confidence, improve your skills"></a>If you want to improve your self-confidence, improve your skills</h2><blockquote>
<p><a href="https://medium.com/darius-foroux/i-have-15-ideas-to-change-your-life-do-you-have-5-minutes-f84c3f99b3c5">https://medium.com/darius-foroux/i-have-15-ideas-to-change-your-life-do-you-have-5-minutes-f84c3f99b3c5</a><br>If you don’t believe in yourself, don’t try to search for it in motivational posts, talks, or books.</p>
</blockquote>
<p><a href="http://dariusforoux.com/build-self-confidence-need-win-life/">You only improve your self-confidence by becoming good at something</a>. How do you get good? By learning, doing, seeing results, and repeating that process for years. Your confidence will grow slowly every day.</p>
<h2 id="How-To-Build-The-Self-Confidence-You-Need-To-Win-At-Life"><a href="#How-To-Build-The-Self-Confidence-You-Need-To-Win-At-Life" class="headerlink" title="How To Build The Self-Confidence You Need To Win At Life"></a><a href="https://dariusforoux.com/build-self-confidence-need-win-life/">How To Build The Self-Confidence You Need To Win At Life</a></h2><figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">- </span>Improve your competencies</span><br><span class="line"><span class="bullet">- </span>Put them into practice</span><br><span class="line"><span class="bullet">- </span>See results</span><br><span class="line"><span class="bullet">- </span>Grow more confident</span><br><span class="line"><span class="bullet">- </span>Repeat</span><br></pre></td></tr></table></figure>

<h2 id="The-Most-Important-Skill-Nobody-Taught-You-–-Personal-Growth-–-Medium"><a href="#The-Most-Important-Skill-Nobody-Taught-You-–-Personal-Growth-–-Medium" class="headerlink" title="The Most Important Skill Nobody Taught You – Personal Growth – Medium"></a><a href="https://medium.com/personal-growth/the-most-important-skill-nobody-taught-you-9b162377ab77">The Most Important Skill Nobody Taught You – Personal Growth – Medium</a></h2><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">Fortunately, there <span class="keyword">is</span> a solution. The only way <span class="keyword">to</span> avoid being ruined <span class="keyword">by</span> this fear — like any fear — <span class="keyword">is</span> <span class="keyword">to</span> face <span class="keyword">it</span>. It’s <span class="keyword">to</span> let <span class="keyword">the</span> boredom take you <span class="keyword">where</span> <span class="keyword">it</span> wants so you can deal <span class="keyword">with</span> whatever <span class="keyword">it</span> <span class="keyword">is</span> <span class="keyword">that</span> <span class="keyword">is</span> really going <span class="keyword">on</span> <span class="keyword">with</span> your sense <span class="keyword">of</span> self. That’s when you’ll hear yourself think, <span class="keyword">and</span> <span class="keyword">that</span>’s when you’ll learn <span class="keyword">to</span> engage <span class="keyword">the</span> parts <span class="keyword">of</span> you <span class="keyword">that</span> are masked <span class="keyword">by</span> distraction.</span><br><span class="line"></span><br><span class="line">The beauty <span class="keyword">of</span> this <span class="keyword">is</span> <span class="keyword">that</span>, once you cross <span class="keyword">that</span> initial barrier, you realize <span class="keyword">that</span> being alone isn’t so bad. Boredom can provide <span class="keyword">its</span> own stimulation.</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">The oldest philosophical wisdom <span class="keyword">in</span> <span class="keyword">the</span> world has one piece <span class="keyword">of</span> advice <span class="keyword">for</span> us:</span><br><span class="line">know yourself. And there <span class="keyword">is</span> a good reason why <span class="keyword">that</span> <span class="keyword">is</span>.</span><br><span class="line"></span><br><span class="line">Without knowing ourselves, <span class="keyword">it</span>’s almost impossible <span class="keyword">to</span> find a healthy way <span class="keyword">to</span> interact <span class="keyword">with</span> <span class="keyword">the</span> world <span class="keyword">around</span> us.</span><br><span class="line">Without taking <span class="built_in">time</span> <span class="keyword">to</span> figure <span class="keyword">it</span> out, we don’t have a foundation <span class="keyword">to</span> built <span class="keyword">the</span> <span class="built_in">rest</span> <span class="keyword">of</span> our lives <span class="keyword">on</span>.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>developer</tag>
      </tags>
  </entry>
  <entry>
    <title>开发流程</title>
    <url>/developer/%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<ol>
<li><p>需求分析的时候，逐个看需求文档，<br>将需求点罗列到思维导图上（便于统筹帷幄），标记关键点、风险点和注意事项<br>（有助记效果，与产品或其他同事交流沟通时，有的放矢）。</p>
</li>
<li><p>概要设计、详细设计（技术选型、）</p>
</li>
<li><p>分析现在代码和数据库对需求的已有支持（不要重新造轮子）。</p>
</li>
<li><p>设计数据库表和字段，设计包结构、类结构和主要方法（类似于列大纲）。</p>
</li>
<li><p>编写接口文档（不是一个人在作战）。</p>
</li>
<li><p>修改配置、开发具体代码，适应新需求。</p>
</li>
<li><p>设计和开发过程中，将数据库、配置等的变动以及上线时的注意事项列一个运维清单（以防上线过程出问题）。</p>
</li>
<li><p>自测，编写单元测试、Postman 测试。</p>
</li>
<li><p>代码优化，魔法数字、命名、结构、注释、算法、设计模式等。</p>
</li>
<li><p>联调。</p>
</li>
<li><p>提测和 bug 修复。</p>
</li>
<li><p>打勾运维清单上线。</p>
</li>
<li><p>项目沉淀、后期优化。</p>
</li>
</ol>
<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><ul>
<li><a href="https://segmentfault.com/a/1190000021831640">阿里等大厂的研发流程，进去前先了解一下 - SegmentFault 思否</a></li>
<li><img src="https://raw.githubusercontent.com/lyloou/img/develop/%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B_20211216143312_2021-12-16-14-33-13.png" alt="开发流程_20211216143312_2021-12-16-14-33-13"></li>
</ul>
]]></content>
      <tags>
        <tag>developer</tag>
      </tags>
  </entry>
  <entry>
    <title>知识点掌握程度</title>
    <url>/developer/%E7%9F%A5%E8%AF%86%E7%82%B9%E6%8E%8C%E6%8F%A1%E7%A8%8B%E5%BA%A6/</url>
    <content><![CDATA[<table>
<thead>
<tr>
<th>类别</th>
<th>描述</th>
<th>开发者所需级别</th>
</tr>
</thead>
<tbody><tr>
<td>基本知识点</td>
<td>熟练掌握</td>
<td>初中级</td>
</tr>
<tr>
<td>深入知识点</td>
<td>熟练掌握</td>
<td>中高级</td>
</tr>
<tr>
<td>基本知识点的细节</td>
<td>掌握</td>
<td>高级</td>
</tr>
<tr>
<td>系统核心机制</td>
<td>熟悉、掌握</td>
<td>高级、资深</td>
</tr>
<tr>
<td>琐碎的知识点</td>
<td>了解</td>
<td>所有级别</td>
</tr>
</tbody></table>
<blockquote>
<p>来源： <a href="http://blog.csdn.net/singwhatiwanna/article/details/49230997">http://blog.csdn.net/singwhatiwanna/article/details/49230997</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>developer</tag>
      </tags>
  </entry>
  <entry>
    <title>酷项目</title>
    <url>/developer/%E9%85%B7%E9%A1%B9%E7%9B%AE/</url>
    <content><![CDATA[<h2 id="Graphviz"><a href="#Graphviz" class="headerlink" title="Graphviz"></a>Graphviz</h2><p>画图工具</p>
<ul>
<li><a href="https://www.google.com/search?client=firefox-b-d&q=graphviz">graphviz - Google 搜索</a></li>
</ul>
<h2 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h2><p>Kibana 是 Elasticsearch 的开源数据可视化仪表板。</p>
<h2 id="nexus"><a href="#nexus" class="headerlink" title="nexus"></a>nexus</h2><p>maven 仓库</p>
<h2 id="PhantomJS"><a href="#PhantomJS" class="headerlink" title="PhantomJS"></a>PhantomJS</h2><p>有时，我们需要浏览器处理网页，但并不需要浏览，比如生成网页的截图、抓取网页数据等操作。PhantomJS 的功能，就是提供一个浏览器环境的命令行接口，你可以把它看作一个“虚拟浏览器”，除了不能浏览，其他与正常浏览器一样。它的内核是 WebKit 引擎，不提供图形界面，只能在命令行下使用，我们可以用它完成一些特殊的用途。</p>
<ul>
<li><a href="http://javascript.ruanyifeng.com/tool/phantomjs.html">PhantomJS – JavaScript 标准参考教程（alpha）</a></li>
<li><a href="https://phantomjs.org/">PhantomJS - Scriptable Headless Browser</a></li>
</ul>
<h2 id="php-tool"><a href="#php-tool" class="headerlink" title="php tool"></a>php tool</h2><ul>
<li>wamp</li>
<li>phpstudy</li>
</ul>
<h2 id="wareshark"><a href="#wareshark" class="headerlink" title="wareshark"></a>wareshark</h2><p>抓包工具</p>
<h2 id="NSSM"><a href="#NSSM" class="headerlink" title="NSSM"></a>NSSM</h2><p>NSSM is a service helper program similar to srvany and cygrunsrv. It can<br>start any application as an NT service and will restart the service if it<br>fails for any reason.</p>
<h2 id="天若-OCR-文字识别"><a href="#天若-OCR-文字识别" class="headerlink" title="天若 OCR 文字识别"></a>天若 OCR 文字识别</h2><h2 id="pxcook"><a href="#pxcook" class="headerlink" title="pxcook"></a>pxcook</h2><p>前端测量工具</p>
<h2 id="apache-jmeter"><a href="#apache-jmeter" class="headerlink" title="apache-jmeter"></a>apache-jmeter</h2><p>性能测试工具</p>
]]></content>
      <tags>
        <tag>developer</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch 相关</title>
    <url>/devops/ElasticSearch%E7%9B%B8%E5%85%B3/</url>
    <content><![CDATA[<h2 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html</a></p>
<h2 id="解决-ElasticSearch-ClusterBlockException-blocked-by-FORBIDDEN-12-index-read-only-allow-delete-api"><a href="#解决-ElasticSearch-ClusterBlockException-blocked-by-FORBIDDEN-12-index-read-only-allow-delete-api" class="headerlink" title="解决 ElasticSearch ClusterBlockException[blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];"></a>解决 ElasticSearch ClusterBlockException[blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];</h2><ol>
<li>查看硬盘是否足够：<code>df -h</code></li>
<li>如果不够的话：可以调整 es 设置：</li>
</ol>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 控制洪水阶段水印。它默认为95％</span></span><br><span class="line">cluster.routing.allocation.disk.watermark.flood_stage: 99%</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">cluster.routing.allocation.disk.threshold_enabled: false</span><br></pre></td></tr></table></figure>

<p>磁盘够了之后需要手动释放 3.</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -XPUT -H <span class="string">&quot;Content-Type: application/json&quot;</span> http://node.com:9200/_all/_settings -d <span class="string">&#x27;&#123;&quot;index.blocks.read_only_allow_delete&quot;: null&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">PUT /all/_settings</span><br><span class="line">&#123;</span><br><span class="line">  &quot;index.blocks.read_only_allow_delete&quot;：null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://blog.csdn.net/mouday/article/details/86557744">ElasticSearch 常见的报错及解决_彭世瑜的博客-CSDN 博客</a></li>
<li>[解决：ElasticSearch ClusterBlockException<a href="https://www.cnblogs.com/hellxz/p/11532652.html">blocked by: [FORBIDDEN/12/index read-only / allow delete (api)]; - 东北小狐狸 - 博客园</a></li>
</ul>
]]></content>
      <tags>
        <tag>es</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker</title>
    <url>/devops/docker/</url>
    <content><![CDATA[<h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p>wget -qO- <a href="https://get.docker.com/">https://get.docker.com</a> | sh</p>
<h2 id="config"><a href="#config" class="headerlink" title="config"></a>config</h2><p><a href="https://www.jianshu.com/p/95e397570896">https://www.jianshu.com/p/95e397570896</a><br>｀｀｀ sh<br>如果还没有 docker group 就添加一个：<br>sudo groupadd docker</p>
<p>将用户加入该 group 内。然后退出并重新登录就生效啦。<br>sudo gpasswd -a ${USER} docker</p>
<p>重启 docker 服务<br>sudo service docker restart</p>
<p>切换当前会话到新 group 或者重启 X 会话<br>newgrp - docker</p>
<p>注意:最后一步是必须的，否则因为 groups 命令获取到的是缓存的组信息，刚添加的组信息未能生效，所以 docker images 执行时同样有错。<br>｀｀｀</p>
<h2 id="加速器"><a href="#加速器" class="headerlink" title="加速器"></a>加速器</h2><p><a href="https://www.daocloud.io/">https://www.daocloud.io</a><br>config docker preference(registry-mirrors) :<br>for ubuntu</p>
<blockquote>
<p>curl -sSL <a href="https://get.daocloud.io/daotools/set_mirror.sh">https://get.daocloud.io/daotools/set_mirror.sh</a> | sh -s <a href="http://6cde3c02.m.daocloud.io/">http://6cde3c02.m.daocloud.io</a><br>sudo systemctl restart docker.service</p>
</blockquote>
<blockquote>
<p>curl -sSL <a href="https://get.daocloud.io/daotools/set_mirror.sh">https://get.daocloud.io/daotools/set_mirror.sh</a> | sh -s <a href="http://d1d9aef0.m.daocloud.io/">http://d1d9aef0.m.daocloud.io</a></p>
</blockquote>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run hello-world</span><br><span class="line"></span><br><span class="line">docker run -it alpine sh</span><br><span class="line"></span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line">docker run -d -p 80:80 nginx</span><br><span class="line">docker ps</span><br><span class="line">docker <span class="built_in">kill</span> __id__</span><br><span class="line"></span><br><span class="line">docker run -d -p 9200:9200 elasticsearch</span><br><span class="line">docker logs __id__</span><br></pre></td></tr></table></figure>

<h2 id="Docker-中文教程-Docker-开发中文手册-PDF-下载-极客学院-Wiki"><a href="#Docker-中文教程-Docker-开发中文手册-PDF-下载-极客学院-Wiki" class="headerlink" title="Docker 中文教程_Docker 开发中文手册[PDF]下载-极客学院 Wiki"></a><a href="http://wiki.jikexueyuan.com/project/docker/">Docker 中文教程_Docker 开发中文手册[PDF]下载-极客学院 Wiki</a></h2><p><code>-d</code>: 标示是让 docker 容器在后台运行。<br><code>-P</code>: 标示 Docker 所需的端口映射从主机映射到我们的容器内。<br><code>-t</code>: 表示在新容器内指定一个伪终端或终端，<br><code>-i</code>: 表示允许我们对容器内的 STDIN 进行交互。<br><code>-p</code>: 标识来指定容器端口绑定到主机端口 &gt; <code>sudo docker run -d -p 5000:5000 training/webapp python app.py</code> &gt; <code>sudo ocker port nostalgic_morse 5000</code> &gt; <a href="https://wiki.jikexueyuan.com/project/docker/userguide/dockerlinks.html">https://wiki.jikexueyuan.com/project/docker/userguide/dockerlinks.html</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo docker run -t -i training/sinatra /bin/bash</span><br><span class="line">sudo docker commit -m=<span class="string">&quot;Added json gem&quot;</span> -a=<span class="string">&quot;Lou Li&quot;</span> \</span><br><span class="line">    9e4dcef3e152 lyloou/sinatra:v2</span><br><span class="line">    4f177bd27a9ff0f6dc2a830403925b5360bfe0b93d476f7fc3231110e7f71b1c</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo docker build -t=<span class="string">&quot;lyloou/sinatra:v2&quot;</span> .</span><br><span class="line">sudo docker tag 5db5f8471261 lyloou/sinatra:devel</span><br><span class="line">sudo docker push lyloou/sinatra</span><br><span class="line">sudo docker rmi lyloou/sinatra</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># http://wiki.jikexueyuan.com/project/docker/examples/nodejs_web_app.html</span></span><br><span class="line"><span class="comment"># run in background</span></span><br><span class="line">sudo docker run -p 49161:8080 -d lyloou/centos-node-hello:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://askubuntu.com/questions/505506/how-to-get-bash-or-ssh-into-a-running-container-in-background-mode</span></span><br><span class="line">sudo docker <span class="built_in">exec</span> -it f3b /bin/bash</span><br></pre></td></tr></table></figure>

<h2 id="数据持久化"><a href="#数据持久化" class="headerlink" title="数据持久化"></a>数据持久化</h2><p>如果需要数据持久化，可以使用数据卷机制。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -p 8080:8080 -p 50000:50000 -v /your/home:/var/jenkins_home jenkins</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker volume create --name jenkins_home</span><br><span class="line">docker run -p 8080:8080 -p 50000:50000 -v jenkins_home:/var/jenkins_home jenkins/jenkins:lts</span><br></pre></td></tr></table></figure>

<h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><h3 id="install-and-run"><a href="#install-and-run" class="headerlink" title="install and run"></a>install and run</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">pip install docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># create file docker-compose.yml</span></span><br><span class="line"><span class="comment"># run</span></span><br><span class="line">docker-compose up</span><br></pre></td></tr></table></figure>

<h3 id="uninstall-and-remove"><a href="#uninstall-and-remove" class="headerlink" title="uninstall and remove"></a>uninstall and remove</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Stop and remove containers, networks, images, and volumes</span></span><br><span class="line">docker-compose down</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 获取docker服务地址</span></span><br><span class="line">[root@iZj6c9zr2mst7l8t6ardbkZ ~]<span class="comment"># cat show_ip.sh</span></span><br><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;.Name&#125;&#125; - &#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> $(docker ps -aq)</span><br><span class="line"></span><br><span class="line">[root@iZj6c9zr2mst7l8t6ardbkZ ~]<span class="comment"># ./show_ip.sh</span></span><br><span class="line">/nginx - 172.18.0.8</span><br><span class="line">/reward - 172.18.0.4</span><br><span class="line">/web - 172.18.0.14</span><br><span class="line">/app - 172.18.0.7</span><br><span class="line">/check - 172.18.0.13</span><br><span class="line">/exapi - 172.18.0.3</span><br><span class="line">/coin - 172.18.0.12</span><br><span class="line">/api - 172.18.0.5</span><br><span class="line">/trade - 172.18.0.9</span><br><span class="line">/admin - 172.18.0.11</span><br><span class="line">/service - 172.18.0.6</span><br><span class="line">/rabbitmq - 172.18.0.17</span><br><span class="line">/redis2 - 172.18.0.2</span><br><span class="line">/zookeeper - 172.18.0.15</span><br><span class="line">/redis1 - 172.18.0.10</span><br><span class="line">/mysql - 172.18.0.16</span><br><span class="line">/nexus3 - 172.17.0.2</span><br></pre></td></tr></table></figure>

<h2 id="网络管理"><a href="#网络管理" class="headerlink" title="网络管理"></a>网络管理</h2><p><a href="https://blog.csdn.net/benpaodelulu_guajian/article/details/90546129">Docker 错误集合_挂件-CSDN 博客_error: pool overlaps with other one on this addres</a><br>查看 docker 网卡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker network <span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<p>查看 docker 网卡的相关详细信息 确认是自己创建的 ip 段 然后在删除相应的网卡</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">docker</span> network inspect <span class="variable">$&#123;containerid&#125;</span></span><br></pre></td></tr></table></figure>

<p>删除 docker 网卡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker network <span class="built_in">rm</span> <span class="variable">$&#123;containerid&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="清除日志"><a href="#清除日志" class="headerlink" title="清除日志"></a>清除日志</h2><p><a href="https://stackoverflow.com/a/43570083">https://stackoverflow.com/a/43570083</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">truncate</span> -s 0 /var/lib/docker/containers/*/*-json.log</span><br></pre></td></tr></table></figure>

<h2 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h2><p><a href="https://blog.csdn.net/jiangyu1013/article/details/96147534">https://blog.csdn.net/jiangyu1013/article/details/96147534</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker logs -f -t --since=<span class="string">&quot;2017-05-31&quot;</span> --<span class="built_in">tail</span>=10 edu_web_1</span><br><span class="line">docker logs --<span class="built_in">tail</span> 1 26b12d17fefc</span><br><span class="line">docker logs -t 26b12d17fefc</span><br><span class="line"></span><br><span class="line">docker logs [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line"></span><br><span class="line">--details 显示更多的信息</span><br><span class="line"></span><br><span class="line">-f, --follow 实时输出日志，最后一行为当前时间戳的日志</span><br><span class="line"></span><br><span class="line">--since string 输出日志开始日期，即只输出指定日期之后的日志。</span><br><span class="line"></span><br><span class="line">--<span class="built_in">tail</span> string 显示最后多少行日志， 默认是all</span><br><span class="line">            （如： -<span class="built_in">tail</span>=10 : 查看最后的 10 行日志。）</span><br><span class="line"></span><br><span class="line">-t, --timestamps 显示时间戳</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="搭建私有仓库"><a href="#搭建私有仓库" class="headerlink" title="搭建私有仓库"></a>搭建私有仓库</h2><p><a href="https://yeasy.gitbook.io/docker_practice/repository/registry">https://yeasy.gitbook.io/docker_practice/repository/registry</a></p>
<h2 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h2><p>docker stop $(docker ps -aq)</p>
<h2 id="docker-compose-1"><a href="#docker-compose-1" class="headerlink" title="docker-compose"></a>docker-compose</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker-compose ps</span><br><span class="line">docker-compose up -d</span><br><span class="line">docker-compose down</span><br><span class="line">docker-compose down -v</span><br><span class="line">docker-compose start ce-kafka</span><br><span class="line">docker-compose <span class="built_in">exec</span> ce-kafka bash</span><br></pre></td></tr></table></figure>

<p><img src="http://cdn.lyloou.com/img/docker-2021-09-17-10-38-19.png" alt="docker-2021-09-17-10-38-19"><br><a href="https://docs.docker.com/compose/reference/down/">https://docs.docker.com/compose/reference/down/</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># rebuild demo-admin</span></span><br><span class="line">docker-compose stop demo-admin &amp;&amp; docker-compose <span class="built_in">rm</span> -f demo-admin</span><br><span class="line">docker-compose build demo-admin &amp;&amp; docker-compose up -d demo-admin</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;rebuild demo-admin success.&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="宿主机与容器之前的复制"><a href="#宿主机与容器之前的复制" class="headerlink" title="宿主机与容器之前的复制"></a>宿主机与容器之前的复制</h2><p>容器到宿主机：<code>docker cp container_name:/opt/abc.txt /tmp/</code><br>宿主机到容器：<code>docker cp /tmp/abc.txt container_name:/opt/</code><br>不论容器是否启动，都可以执行上面的命令</p>
<h2 id="查看容器信息"><a href="#查看容器信息" class="headerlink" title="查看容器信息"></a>查看容器信息</h2><figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">docker inspect aafbdd</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>devops</tag>
      </tags>
  </entry>
  <entry>
    <title>ELK环境部署</title>
    <url>/devops/elk/</url>
    <content><![CDATA[<h2 id="软件和环境："><a href="#软件和环境：" class="headerlink" title="软件和环境："></a>软件和环境：</h2><p>virtual box 6.1<br>centos 7<br>java: jdk1.8.0_171</p>
<p>es: 7.3.0<br>官网地址：<a href="https://www.elastic.co/cn/downloads/elasticsearch">https://www.elastic.co/cn/downloads/elasticsearch</a><br>下载地址：<a href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.3.0-linux-x86_64.tar.gz">https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.3.0-linux-x86_64.tar.gz</a></p>
<p>Kibana: 7.3.0<br>官网地址：<a href="https://www.elastic.co/cn/downloads/kibana">https://www.elastic.co/cn/downloads/kibana</a><br>下载地址：<a href="https://artifacts.elastic.co/downloads/kibana/kibana-7.3.0-linux-x86_64.tar.gz">https://artifacts.elastic.co/downloads/kibana/kibana-7.3.0-linux-x86_64.tar.gz</a></p>
<p>logstash: 7.3.0<br>官网地址：<a href="https://www.elastic.co/cn/downloads/logstash">https://www.elastic.co/cn/downloads/logstash</a><br>下载地址：<a href="https://artifacts.elastic.co/downloads/logstash/logstash-7.3.0.tar.gz">https://artifacts.elastic.co/downloads/logstash/logstash-7.3.0.tar.gz</a></p>
<p>配置 hosts</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vi /etc/hosts</span></span><br><span class="line">172.20.130.84 node.com</span><br></pre></td></tr></table></figure>

<p>关闭防火墙</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld.service <span class="comment">#停止firewall</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service <span class="comment">#禁止firewall开机启动</span></span><br><span class="line">firewall-cmd --state <span class="comment"># 查看防火墙</span></span><br></pre></td></tr></table></figure>

<p>java 环境配置</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vi /etc/profile</span></span><br><span class="line">JAVA_HOME=/usr/java JRE_HOME=/usr/java/jre</span><br><span class="line">CLASS_PATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JRE_HOME</span>/lib PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JRE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME JRE_HOME CLASS_PATH PATH</span><br><span class="line"></span><br><span class="line"><span class="comment"># source /etc/profile</span></span><br></pre></td></tr></table></figure>

<h4 id="es"><a href="#es" class="headerlink" title="es"></a>es</h4><ol>
<li>单机安装请取消注释：node.name: node-1，否则无法正常启动。修改网络和端口，取消注释 master 节点，单机只保留一个 node</li>
</ol>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">node.name:</span> <span class="string">node-1</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="string">node.com</span> <span class="comment">#</span></span><br><span class="line"><span class="comment"># Set a custom port for HTTP: #</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> [<span class="string">&quot;node-1&quot;</span>]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>按需修改 vim /usr/elasticsearch/conﬁg/jvm.options 内存设置</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 根据实际情况修改占用内存，默认都是1G，单机1G内存，启动会占用700m+然后在安装kibana 后，基本上无法运行了，运行了一会就挂了报内存不足。</span></span><br><span class="line"><span class="comment"># 内存设置超出物理内存，也会无法启动，启动报错。</span></span><br><span class="line">-Xms1g</span><br><span class="line">-Xmx1g</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>添加 es 用户，es 默认 root 用户无法启动，需要改为其他用户</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">useradd	estest</span><br><span class="line"><span class="comment"># 修改密码</span></span><br><span class="line">passwd	estest</span><br><span class="line"><span class="built_in">chown</span> -R estest /usr/elasticsearch/</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>修改/etc/sysctl.conf</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vm.max_map_count=655360</span><br><span class="line"><span class="comment"># 是修改生效：sysctl -p</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>修改/etc/security/limits.conf</li>
</ol>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">*	</span>soft	nofile	65536</span><br><span class="line"><span class="bullet">*	</span>hard	nofile	65536</span><br><span class="line"><span class="bullet">*	</span>soft	nproc	4096</span><br><span class="line"><span class="bullet">*	</span>hard	nproc	4096</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>用 estest 用户启动 es</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">su estest</span><br><span class="line">/usr/elasticsearch/bin/elasticsearch</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>测试</li>
</ol>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">curl http:<span class="regexp">//</span>node.com:<span class="number">9200</span></span><br></pre></td></tr></table></figure>

<h4 id="ik-分词器"><a href="#ik-分词器" class="headerlink" title="ik 分词器"></a>ik 分词器</h4><p><a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v7.3.0">https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v7.3.0</a></p>
<ol>
<li>在 elasticsearch 的 bin 目录下执行以下命令,es 插件管理器会自动帮我们安装，然后等待安装完成：</li>
</ol>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>elasticsearch<span class="regexp">/bin/</span>elasticsearch-plugin install https:<span class="regexp">//gi</span>thub.com<span class="regexp">/medcl/</span>elasticsearch-analysis-ik<span class="regexp">/releases/</span>download<span class="regexp">/v7.3.0/</span>elasticsearch-analysis-ik-<span class="number">7.3</span>.<span class="number">0</span>.zip</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>下载完成后会提示 Continue with installation?输入 y 即可完成安装</li>
<li>重启 Elasticsearch 和 Kibana</li>
</ol>
<p>测试</p>
<figure class="highlight fsharp"><table><tr><td class="code"><pre><span class="line">POST	<span class="keyword">_analyze</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;analyzer&quot;</span><span class="operator">:</span> <span class="string">&quot;ik_max_word&quot;</span>, <span class="string">&quot;text&quot;</span><span class="operator">:</span> <span class="string">&quot;南京市长江大桥&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h4><p>最好也用 estest 用户操作<br>解压，修改配置（端口号、es 地址等）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vim /usr/kibana/config/kibana.yml</span></span><br><span class="line">server.port: 5601</span><br><span class="line">server.host: <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="comment"># The URLs of the Elasticsearch instances to use for all your queries.</span></span><br><span class="line">elasticsearch.hosts: [<span class="string">&quot;http://192.168.211.136:9200&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>启动</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./bin/kibana</span><br></pre></td></tr></table></figure>

<h4 id="按照和运行redis"><a href="#按照和运行redis" class="headerlink" title="按照和运行redis:"></a>按照和运行<code>redis</code>:</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install wget -y</span><br><span class="line">wget https://download.redis.io/releases/redis-5.0.8.tar.gz</span><br><span class="line">tar -zxf redis-5.0.8.tar.gz</span><br><span class="line">yum install gcc -y</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> redis-5.0.8</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/local/bin/</span><br><span class="line"><span class="built_in">cp</span> ~/redis-5.0.8/redis.conf .</span><br><span class="line"><span class="comment"># 配置 redis.conf 的密码为123456，ip为 bind 0.0.0.0</span></span><br><span class="line">redis-server redis.conf</span><br></pre></td></tr></table></figure>

<h4 id="Logstash"><a href="#Logstash" class="headerlink" title="Logstash"></a>Logstash</h4><p>配置 shipper-logstash.conf</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  file &#123;</span><br><span class="line">    <span class="attr">path</span> =&gt; [</span><br><span class="line">      <span class="string">&quot;/log/out.log&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  redis &#123;</span><br><span class="line">    <span class="attr">host</span> =&gt; <span class="string">&quot;node.com&quot;</span></span><br><span class="line">    <span class="attr">port</span> =&gt; <span class="number">6379</span></span><br><span class="line">    <span class="attr">db</span> =&gt; <span class="number">0</span></span><br><span class="line">    <span class="attr">password</span> =&gt; <span class="string">&quot;123456&quot;</span></span><br><span class="line">    <span class="attr">data_type</span> =&gt; <span class="string">&quot;channel&quot;</span></span><br><span class="line">    <span class="attr">key</span> =&gt; <span class="string">&quot;sb-logback&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置 indexer-logstash.conf</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">    redis &#123;</span><br><span class="line">        <span class="attr">host</span>      =&gt; <span class="string">&quot;node.com&quot;</span>    <span class="comment"># redis主机地址</span></span><br><span class="line">        <span class="attr">port</span>      =&gt; <span class="number">6379</span>               <span class="comment"># redis端口号</span></span><br><span class="line">        <span class="attr">password</span>  =&gt; <span class="string">&quot;123456&quot;</span></span><br><span class="line">        <span class="attr">db</span>        =&gt; <span class="number">0</span>                  <span class="comment"># redis数据库编号</span></span><br><span class="line">        <span class="attr">data_type</span> =&gt; <span class="string">&quot;channel&quot;</span>          <span class="comment"># 使用发布/订阅模式</span></span><br><span class="line">        <span class="attr">key</span>       =&gt; <span class="string">&quot;sb-logback&quot;</span>  <span class="comment"># 发布通道名称</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">     <span class="comment">#定义数据的格式</span></span><br><span class="line">     grok &#123;</span><br><span class="line">       <span class="attr">match</span> =&gt; &#123; <span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;%&#123;TIMESTAMP_ISO8601:time&#125; \[%&#123;NOTSPACE:threadName&#125;\] %&#123;LOGLEVEL:level&#125;  %&#123;DATA:logger&#125; %&#123;NOTSPACE:applicationName&#125; -(?:.*=%&#123;NUMBER:timetaken&#125;ms|)&quot;</span>&#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">    stdout &#123;&#125;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line">        <span class="attr">hosts</span> =&gt; <span class="string">&quot;node.com:9200&quot;</span></span><br><span class="line">        <span class="attr">index</span> =&gt; <span class="string">&quot;logback&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="运行-jar，指定输出目录"><a href="#运行-jar，指定输出目录" class="headerlink" title="运行 jar，指定输出目录"></a>运行 jar，指定输出目录</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">java -jar spring-api.jar &amp; &gt; /log.out</span><br></pre></td></tr></table></figure>

<h2 id="其他资料"><a href="#其他资料" class="headerlink" title="其他资料"></a>其他资料</h2><ul>
<li><a href="https://mp.weixin.qq.com/s/i1qgONtrtaqHo0o0TcRFGA">ELK 处理 Spring Boot 日志，妙！</a></li>
<li><a href="./ElasticSearch%E7%9B%B8%E5%85%B3">ElasticSearch 相关</a></li>
<li><a href="https://my.oschina.net/u/4342169/blog/4333777/print">Docker 安装及安装单机版 ELK 日志收集系统 - osc_dg0eswo7 的个人空间 - OSCHINA</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1026543">ELK 实时日志分析平台环境部署–完整记录 - 云+社区 - 腾讯云</a></li>
<li><a href="https://wsgzao.github.io/post/elk/">使用 ELK(Elasticsearch + Logstash + Kibana) 搭建日志集中分析平台实践 | HelloDog</a></li>
<li><a href="https://www.cnblogs.com/cjsblog/p/9476813.html">Kibana（一张图片胜过千万行日志） - 废物大师兄 - 博客园</a></li>
<li><a href="https://www.cnblogs.com/cjsblog/p/9495024.html">Filebeat 模块与配置 - 废物大师兄 - 博客园</a></li>
</ul>
]]></content>
      <tags>
        <tag>es</tag>
        <tag>devops</tag>
      </tags>
  </entry>
  <entry>
    <title>Jenkins</title>
    <url>/devops/jenkins/</url>
    <content><![CDATA[<h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><ul>
<li><p><a href="https://jenkins.io/doc/book/installing/#debian-ubuntu">Installing Jenkins</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/yjmyzz/p/jenkins-tutorial-part-1.html">jenkins 入门教程(上) - 菩提树下的杨过 - 博客园</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/yjmyzz/p/jenkins-tutorial-part-2.html">jenkins 入门教程(中) - 菩提树下的杨过 - 博客园</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/yjmyzz/p/jenkins-tutorial-part-3.html">jenkins 入门教程(下) - 菩提树下的杨过 - 博客园</a></p>
</li>
</ul>
<ul>
<li><a href="https://blog.csdn.net/itfootball/article/details/44876517">Jenkins 的关闭、重启 - CSDN 博客</a><ul>
<li>关闭 jenkins 服务: <a href="http://localhost:8080/exit">http://localhost:8080/exit</a></li>
<li>重新启动 jenkins 服务器: <a href="http://localhost:8080/restart">http://localhost:8080/restart</a></li>
<li>重载 jenkins 服务器: <a href="http://localhost:8080/reload">http://localhost:8080/reload</a></li>
</ul>
</li>
</ul>
<p>个人觉得难点在于：密码、授权、密钥的配置。这一步走通了，后面的就好走了。</p>
<h2 id="config"><a href="#config" class="headerlink" title="config"></a>config</h2><ul>
<li><a href="https://stackoverflow.com/questions/31719756/how-to-stop-jenkins-log-from-becoming-huge">How to stop Jenkins log from becoming huge? - Stack Overflow</a></li>
</ul>
<h2 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h2><p>/var/log/jenkins/jenkins.log</p>
]]></content>
      <tags>
        <tag>devops</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx</title>
    <url>/devops/nginx/</url>
    <content><![CDATA[<h1 id="install-nginx"><a href="#install-nginx" class="headerlink" title="install nginx"></a>install nginx</h1><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 启动Nginx</span></span><br><span class="line">/etc/init.d/nginx start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果nginx已经启动，我们修改配置之后，可以用</span></span><br><span class="line">/etc/init.d/nginx reload</span><br></pre></td></tr></table></figure>

<p>在<code>/etc/nginx/nginx.conf</code>末尾有一句：include /etc/nginx/conf.d/*.conf;　　推荐把用户自己的配置放到 conf.d/<br>下面把默认的 server 修改为一个简单的文件服务器，<code>vi /etc/nginx/conf.d/default.conf</code>，修改监听端口 listen 和文件目录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># /etc/nginx/conf.d/default.conf</span><br><span class="line">autoindex on;# 显示目录</span><br><span class="line">autoindex_exact_size on;# 显示文件大小</span><br><span class="line">autoindex_localtime on;# 显示文件时间</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">     listen       8080 default_server;</span><br><span class="line">     listen       [::]:8080 default_server;</span><br><span class="line">     server_name  _;</span><br><span class="line">     #root         /root/share/;</span><br><span class="line">     root         /opt/share/;</span><br><span class="line"></span><br><span class="line">     # Load configuration files for the default server block.</span><br><span class="line">     include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">     location / &#123;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     error_page 404 /404.html;</span><br><span class="line">     location = /40x.html &#123;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     error_page 500 502 503 504 /50x.html;</span><br><span class="line">     location = /50x.html &#123;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 修改/etc/nginx/nginx.conf</span><br><span class="line"># 由于我们使用的是root用户进行的共享，需要修改nginx.conf的用户，否则会出现权限问题，导致访问的时候出现403 Forbidden的错误</span><br><span class="line"></span><br><span class="line">user root;</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://www.jianshu.com/p/95602720e7c8">利用 nginx 搭建小型的文件服务器</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-16-04">How To Install Nginx on Ubuntu 16.04 | DigitalOcean</a></li>
</ul>
<h2 id="nginx-配置（含-ssl）"><a href="#nginx-配置（含-ssl）" class="headerlink" title="nginx 配置（含 ssl）"></a>nginx 配置（含 ssl）</h2><p>取名为 bs.lyloou.com.conf，并放入文件夹： /etc/nginx/conf.d 中，因为 nginx.conf 中会加载此目录下的文件，可以可以得到注册。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    server_name bs.lyloou.com;</span><br><span class="line">    #index index.php index.html index.htm default.php default.htm default.html;</span><br><span class="line">    #root /www/wwwroot/bs.lyloou.com;</span><br><span class="line"></span><br><span class="line">    include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">    #SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则</span><br><span class="line">    #error_page 404/404.html;</span><br><span class="line">    #HTTP_TO_HTTPS_START</span><br><span class="line">    if ($server_port !~ 443)&#123;</span><br><span class="line">        rewrite ^(/.*)$ https://$host$1 permanent;</span><br><span class="line">    &#125;</span><br><span class="line">    #HTTP_TO_HTTPS_END</span><br><span class="line">    ssl_certificate    /root/c/nginx/33333_bs.lyloou.com.pem;</span><br><span class="line">    ssl_certificate_key   /root/c/nginx/33333_bs.lyloou.com.key;</span><br><span class="line">    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;</span><br><span class="line">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line">    ssl_session_cache shared:SSL:10m;</span><br><span class="line">    ssl_session_timeout 10m;</span><br><span class="line">    #error_page 497  https://$host$request_uri;</span><br><span class="line"></span><br><span class="line">    #SSL-END</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://127.0.0.1:8080;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page 404 /404.html;</span><br><span class="line">    location = /40x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Nginx-–-proxy-pass-配置-Bigberg-博客园"><a href="#Nginx-–-proxy-pass-配置-Bigberg-博客园" class="headerlink" title="Nginx – proxy_pass 配置 - Bigberg - 博客园"></a><a href="https://www.cnblogs.com/bigberg/p/7651197.html">Nginx – proxy_pass 配置 - Bigberg - 博客园</a></h2><p>在 proxy_pass 中的代理 url 后加上/，代理转发的 url 中就不会带上 location 中匹配路径；<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/20210702092220.png" alt="nginx_2020-08-19-18-50-37"><br>我们访问 <a href="http://my.yemao.com/proxy/index.html%EF%BC%8C%E5%85%B6%E5%AE%9E%E6%98%AF%E8%AE%BF%E9%97%AE%E5%88%B0%E4%BA%86">http://my.yemao.com/proxy/index.html，其实是访问到了</a> <a href="http://test.yemao.com/index.html">http://test.yemao.com/index.html</a></p>
<blockquote>
<p>在 proxy_pass 中的代理 url 后带 / （则不会加上 location 中的匹配路径）<br>在 proxy_pass 中的代理 url 中不带 / （则会加上 location 中的匹配路径）</p>
</blockquote>
<h2 id="upstream"><a href="#upstream" class="headerlink" title="upstream"></a>upstream</h2><p><a href="https://www.jianshu.com/p/8671c40a5be8">Nginx 的 upstream 详解 - 简书</a></p>
<h2 id="分配方式"><a href="#分配方式" class="headerlink" title="分配方式"></a>分配方式</h2><p>Nginx 的 upstream 支持 5 种 分配方式，<strong>其中 轮询、权重、IP 散列这三种为 Nginx 原生支持的分配方式，fair 和 url_hash 为第三方支持的分配方式。</strong></p>
<h4 id="1，轮询"><a href="#1，轮询" class="headerlink" title="1，轮询"></a>1，轮询</h4><p>轮询是 upstream 的默认分配方式，即每个请求按照时间顺序轮流分配到不同的后端服务器，如果某个后端服务器 down 掉后，能自动剔除。</p>
<blockquote>
<p>upstream zhang21（名称）{</p>
<p>server 192.168.1.11：8888；</p>
<p>server 192.168.1.22：8888；</p>
<p>server 192.168.1.33：8888；</p>
<p>}</p>
</blockquote>
<h4 id><a href="#" class="headerlink" title></a></h4><h4 id="2，weight（权重）"><a href="#2，weight（权重）" class="headerlink" title="2，weight（权重）"></a>2，weight（权重）</h4><p>轮询的加强版，既可以指定轮询比率，weight 和访问几率成正比，主要应用于后端服务器异质的场景下。</p>
<blockquote>
<p>upstream zhang21 {</p>
<p>server 192.168.1.11 weight=1；</p>
<p>server 192.168.1.22 weight=2；</p>
<p>server 192.168.1.33 weight=3；</p>
<p>}</p>
</blockquote>
<h4 id="3，ip-hash"><a href="#3，ip-hash" class="headerlink" title="3，ip_hash"></a>3，ip_hash</h4><p>每个请求按照访问 Ip（即 Nginx 的前置服务器或客户端 IP）的 hash 结果分配，这样每个访客会固定访问一个后端服务器，可以解决 session 一致问题。</p>
<blockquote>
<p>upstream zhang21 {</p>
<p>ip_hash;</p>
<p>server 192.168.1.11:7777;</p>
<p>server 192.168.1.22:8888;</p>
<p>server 192.168.1.33:9999;</p>
<p>}</p>
</blockquote>
<h4 id="4，fair"><a href="#4，fair" class="headerlink" title="4，fair"></a>4，fair</h4><p>fair 顾名思义，公平地按照后端服务器的响应时间（rt）来分配请求，响应时间（rt）小的后端服务器优先分配请求。</p>
<blockquote>
<p>upstream zhang21 {</p>
<p>server 192.168.1.11;</p>
<p>server 192.168.1.22;</p>
<p>server 192.168.1.33;</p>
<p>}</p>
</blockquote>
<h4 id="5，url-hash"><a href="#5，url-hash" class="headerlink" title="5，url_hash"></a>5，url_hash</h4><p>与 ip_hash 类似，但是按照访问 url 的 hash 结果来分配请求，使得每个 url 定向到同一个后端服务器，主要应用于后端服务器为缓存的场景下。</p>
<blockquote>
<p>upstream zhang21 {</p>
<p>server 192.168.1.11;</p>
<p>server 192.168.1.22;</p>
<p>server 192.168.1.33;</p>
<p>hash $request_uri；</p>
<p>hash_method crc32；</p>
<p>}</p>
</blockquote>
<p>其中，hash_method 为使用的 hash 算法，需要注意，此时 server 语句中不能添加 weight 等参数。</p>
<p>作者：Zhang21<br>链接：<a href="https://www.jianshu.com/p/8671c40a5be8">https://www.jianshu.com/p/8671c40a5be8</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<h2 id="nginx-在一个服务器上配置两个项目，并通过两个不同的域名访问-半马-博客园"><a href="#nginx-在一个服务器上配置两个项目，并通过两个不同的域名访问-半马-博客园" class="headerlink" title="nginx 在一个服务器上配置两个项目，并通过两个不同的域名访问 - 半马 - 博客园"></a><a href="https://www.cnblogs.com/banma/p/9069858.html">nginx 在一个服务器上配置两个项目，并通过两个不同的域名访问 - 半马 - 博客园</a></h2><h2 id="nginx-搭建文件服务器"><a href="#nginx-搭建文件服务器" class="headerlink" title="nginx 搭建文件服务器"></a>nginx 搭建文件服务器</h2><ul>
<li><a href="https://www.jianshu.com/p/d9f886a9666a">用 nginx 一分钟实现文件服务器 - 简书</a></li>
<li><a href="https://www.yanxurui.cc/posts/server/2017-03-21-NGINX-as-a-file-server/">NGINX as a file server</a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name file.lyloou.com; # 自己PC的ip或者服务器的域名 charset utf-8; # 避免中文乱码</span><br><span class="line">  root /home/xx/share; # 存放文件的目录</span><br><span class="line">  location / &#123;</span><br><span class="line">    # download</span><br><span class="line">    autoindex on;               # enable directory listing output</span><br><span class="line">    autoindex_exact_size off;   # output file sizes rounded to kilobytes, megabytes, and gigabytes</span><br><span class="line">    autoindex_localtime on;     # output local times in the directory</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="如何为-nginx-配置-https-免费证书-主啊-博客园"><a href="#如何为-nginx-配置-https-免费证书-主啊-博客园" class="headerlink" title="如何为 nginx 配置 https(免费证书) - 主啊~ - 博客园"></a><a href="https://www.cnblogs.com/immense/p/11402157.html">如何为 nginx 配置 https(免费证书) - 主啊~ - 博客园</a></h2><p>注意</p>
<ul>
<li>如果用了 docker 要暴露 443 端口</li>
<li>如果用了服务商服务器，要在安全组中配置 443 入方向</li>
</ul>
<h2 id="nginx-设置-websocket-连接"><a href="#nginx-设置-websocket-连接" class="headerlink" title="nginx 设置 websocket 连接"></a>nginx 设置 websocket 连接</h2><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> /market &#123;</span><br><span class="line">  <span class="attribute">index</span> index.html;</span><br><span class="line">  <span class="attribute">client_max_body_size</span>    <span class="number">5m</span>;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://172.21.90.214:6001;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="无法访问静态资源"><a href="#无法访问静态资源" class="headerlink" title="无法访问静态资源"></a>无法访问静态资源</h2><ul>
<li><a href="https://blog.csdn.net/lwgkzl/article/details/81278985">nginx 找不到静态（css,js,html）文件 404 报错，root 的解析_lwgkzl 的博客-CSDN 博客_nginx 找不到静态文件</a></li>
<li><a href="https://blog.csdn.net/qq_27184497/article/details/82292399">解决 nginx 部署后 css、js、图片等样式不加载的问题_qq_27184497 的博客-CSDN 博客_nginx 无法加载 js 与 css</a></li>
</ul>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">        listen 80<span class="comment">;</span></span><br><span class="line">        location / &#123;</span><br><span class="line">                proxy_pass http://xd-project<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># 添加下面部分</span></span><br><span class="line">        location ~ .* &#123;</span><br><span class="line">                proxy_pass http://xd-project<span class="comment">;</span></span><br><span class="line">                proxy_set_header Host $http_host<span class="comment">;</span></span><br><span class="line">                proxy_set_header X-Real-IP $remote_addr<span class="comment">;</span></span><br><span class="line">                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者使用下面部分：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">location ~.*(js|css|png|gif|jpg|mp3|ogg)$ &#123;</span><br><span class="line">    root /home/kzl/data/app/<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这个 location 说明如果你要访问 js,css,png…结尾的文件，你需要在你的访问路径前加上 root。<br>这个 root 实际上就是替换了网页上的 http:10.10.10.10:5000。如果加了这个 location，那么网页在访问 http:10.10.10.10:5000/static/css/morris.css.这个路径的时候，因为文件结尾是 css 匹配到了这个 location,然后网页就会访问</p>
</blockquote>
<h2 id="替代方案：Caddy"><a href="#替代方案：Caddy" class="headerlink" title="替代方案：Caddy"></a>替代方案：Caddy</h2><ul>
<li><p><a href="https://caddyserver.com/">https://caddyserver.com/</a></p>
</li>
<li><p><a href="https://programmer.help/blogs/5d1a87803e2e9.html">Using Caddy instead of Nginx, the whole station upgrades https, and the configuration is simpler.</a></p>
</li>
</ul>
<h2 id="配置文本"><a href="#配置文本" class="headerlink" title="配置文本"></a>配置文本</h2><p><a href="https://opstrip.com/2017/08/10/some-nginx-configuration-tips/">一些 nginx 配置小技巧 | 石尧的博客</a></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80<span class="comment">;</span></span><br><span class="line">    server_name www.example.com<span class="comment">;</span></span><br><span class="line">    access_log /var/log/nginx/www-example-com.log access<span class="comment">;</span></span><br><span class="line">    root /etc/nginx/html<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Aliyun ssl by txt</span></span><br><span class="line">    <span class="attr">location</span> = /.well-known/pki-validation/fileauth.txt</span><br><span class="line">    &#123;</span><br><span class="line">        default_type text/plain<span class="comment">;</span></span><br><span class="line">        return 200 &#x27;201708090000005cpmpl49g1psxj1r86w70mmpi27g61r4f7u2bthwedki0trwtx&#x27;<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># robots.txt</span></span><br><span class="line">    <span class="attr">location</span> = /robots.txt &#123;</span><br><span class="line">        default_type text/plain<span class="comment">;</span></span><br><span class="line">        return 200 &#x27;User-agent: *\nDisallow: /\n&#x27;<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="生产环境之-Nginx-高可用方案-日落西风又在吹-博客园"><a href="#生产环境之-Nginx-高可用方案-日落西风又在吹-博客园" class="headerlink" title="生产环境之 Nginx 高可用方案 - 日落西风又在吹 - 博客园"></a><a href="https://www.cnblogs.com/SimpleWu/p/11004902.html">生产环境之 Nginx 高可用方案 - 日落西风又在吹 - 博客园</a></h2><p>keepalive+vip+双击主备来实现 nginx 高可用。</p>
<blockquote>
<p>Keepalived 软件起初是专为 LVS 负载均衡软件设计的，用来管理并监控 LVS 集群系统中各个服务节点的状态，后来又加入了可以实现高可用的 VRRP 功能。因此，keepalived 除了能够管理 LVS 软件外，还可以作为其他服务的高可用解决方案软件。</p>
</blockquote>
<blockquote>
<p>keepalived 软件主要是通过 VRRP 协议实现高可用功能的。VRRP 是 Virtual  Router  Redundancy Protocol（虚拟路由冗余协议）的缩写，VRRP 出现的目的就是为了解决静态路由的单点故障问题的，它能保证当个别节点宕机时，整个网络可以不间断地运行。所以，keepalived 一方面具有配置管理 LVS 的功能，同时还具有对 LVS 下面节点进行健康检查的功能，另一方面也可以实现系统网络服务的高可用功能。</p>
</blockquote>
<p>检测 nginx 是否存活：check_nginx_pid.sh</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#检测nginx是否启动了</span></span><br><span class="line">A=`ps -C nginx --no-header |<span class="built_in">wc</span> -l`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$A</span> -eq 0 ];<span class="keyword">then</span>    <span class="comment">#如果nginx没有启动就启动nginx</span></span><br><span class="line">      systemctl start nginx                <span class="comment">#重启nginx</span></span><br><span class="line">      <span class="keyword">if</span> [ `ps -C nginx --no-header |<span class="built_in">wc</span> -l` -eq 0 ];<span class="keyword">then</span>    <span class="comment">#nginx重启失败，则停掉keepalived服务，进行VIP转移</span></span><br><span class="line">              killall keepalived</span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p><a href="https://blog.51cto.com/superpcm/2095395">Nginx+Keepalived 高可用集群_技术博客的技术博客_51CTO 博客_keepalived nginx</a></p>
<p><a href="https://blog.csdn.net/qq_41833549/article/details/108119975">如何给集群设置 VIP（虚拟 IP）_沐瑾儿的博客-CSDN 博客_vip 地址 虚拟地址</a></p>
<p><a href="https://blog.csdn.net/kongxx/article/details/73173762">使用 keepalived 设置虚拟 IP 环境_kongxx 的专栏-CSDN 博客_keepalived virtual_ipaddress</a></p>
<p>阿里云方案：<br><a href="https://help.aliyun.com/document_detail/184485.htm?spm=a2c4g.11186623.0.0.370c3cb3uvYUKS#task-1938181">HaVip 结合 keepalived 实现主备双机高可用</a></p>
<p><a href="https://coolshell.me/articles/public-network-working-tutorial.html">科普一下公有云的网络 – 酷 壳 – CoolShell 3F</a></p>
<h2 id="下载而不显示"><a href="#下载而不显示" class="headerlink" title="下载而不显示"></a>下载而不显示</h2><p>当我们使用 Nginx 时,如果要让一些附件比如 txt,pdf,doc 等不直接在浏览器打开,而弹出另存为的对话框(也就是下载),则可以在 nginx 里添加如下配置:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">location /</span><br><span class="line">&#123;</span><br><span class="line">if ($request_filename ~* ^.*?\.(txt|doc|pdf|rar|gz|zip|docx|exe|xlsx|ppt|pptx)$)&#123;</span><br><span class="line">add_header Content-Disposition: &#x27;attachment<span class="comment">;&#x27;;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="显示而不下载"><a href="#显示而不下载" class="headerlink" title="显示而不下载"></a>显示而不下载</h2><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">//例如</span><br><span class="line"><span class="attr">location</span> = /md/test.txt &#123;</span><br><span class="line">   //匹配到这里，显示文件内容，而不是下载</span><br><span class="line">  root /home/wwwroot/default<span class="comment">;</span></span><br><span class="line">  <span class="comment"># 图片的显示不下载也可以用下面的方式</span></span><br><span class="line">  add_header Content-Type text/plain<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="nginx-无权访问目录"><a href="#nginx-无权访问目录" class="headerlink" title="nginx 无权访问目录"></a>nginx 无权访问目录</h2><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/nginx_20220528122340_2022-05-28-12-23-40.png" alt="nginx_20220528122340_2022-05-28-12-23-40"></p>
<p>设置 nginx user 为 root;</p>
]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Ngrok搭建</title>
    <url>/devops/ngrok/</url>
    <content><![CDATA[<h2 id="配置域名（需支持泛域名功能）"><a href="#配置域名（需支持泛域名功能）" class="headerlink" title="配置域名（需支持泛域名功能）"></a>配置域名（需支持泛域名功能）</h2><table>
<thead>
<tr>
<th>子域名</th>
<th>记录类型</th>
<th>线路类型</th>
<th>记录值</th>
</tr>
</thead>
<tbody><tr>
<td>ngrok</td>
<td>A 记录</td>
<td>通用</td>
<td>170.10.10.100</td>
</tr>
<tr>
<td>*.ngrok</td>
<td>A 记录</td>
<td>通用</td>
<td>170.10.10.100</td>
</tr>
</tbody></table>
<h2 id="安装-git"><a href="#安装-git" class="headerlink" title="安装 git"></a>安装 git</h2><p>…</p>
<h2 id="安装并配置好-go"><a href="#安装并配置好-go" class="headerlink" title="安装并配置好 go"></a>安装并配置好 go</h2><ul>
<li><a href="https://github.com/golang/go/wiki/Ubuntu">https://github.com/golang/go/wiki/Ubuntu</a></li>
</ul>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">add</span>-apt-repository <span class="keyword">pp</span><span class="variable">a:gophers</span>/archive</span><br><span class="line">sudo apt-<span class="built_in">get</span> <span class="keyword">update</span></span><br><span class="line">sudo apt-<span class="built_in">get</span> install golang-<span class="number">1.10</span>-<span class="keyword">go</span> -<span class="keyword">y</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -<span class="keyword">p</span> $HOME/<span class="keyword">c</span></span><br><span class="line"><span class="built_in">mkdir</span> -<span class="keyword">p</span> $HOME/<span class="keyword">w</span></span><br><span class="line"><span class="keyword">ln</span> -<span class="keyword">sf</span> /usr/lib/<span class="keyword">go</span>-<span class="number">1.10</span> $HOME/<span class="keyword">c</span>/<span class="keyword">go</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">export <span class="attr">GOROOT</span>=<span class="variable">$HOME</span>/c/go</span><br><span class="line">export <span class="attr">GOPATH</span>=<span class="variable">$HOME</span>/w/go</span><br><span class="line">export <span class="attr">PATH</span>=<span class="variable">$GOROOT</span>/bin:<span class="variable">$&#123;GOPATH&#125;</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<h2 id="编译生成目标文件"><a href="#编译生成目标文件" class="headerlink" title="编译生成目标文件"></a>编译生成目标文件</h2><p>创建并进入临时目录：<code>mkdir $HOME/t &amp;&amp; cd $_</code><br>创建文件<code>build_ngrok.sh</code>加入以下内容</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Input your domain name:&quot;</span> DOMAIN</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$DOMAIN</span>&quot;</span> = <span class="string">&quot;&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> Please input your domain name.</span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">resultFileName=ngrok_`<span class="built_in">echo</span> <span class="variable">$&#123;DOMAIN&#125;</span> | sed <span class="string">&#x27;s/\./_/g&#x27;</span>`</span><br><span class="line"></span><br><span class="line">currentPwd=$(<span class="built_in">pwd</span>)</span><br><span class="line"><span class="built_in">echo</span> current path: <span class="variable">$currentPwd</span></span><br><span class="line">go get github.com/inconshreveable/ngrok</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/inconshreveable/ngrok</span><br><span class="line">git clean -<span class="built_in">df</span></span><br><span class="line">git checkout -- .</span><br><span class="line"></span><br><span class="line">openssl genrsa -out rootCA.key 2048</span><br><span class="line">openssl req -x509 -new -nodes -key rootCA.key -subj <span class="string">&quot;/CN=<span class="variable">$DOMAIN</span>&quot;</span> -days 5000 -out rootCA.pem</span><br><span class="line">openssl genrsa -out device.key 2048</span><br><span class="line">openssl req -new -key device.key -subj <span class="string">&quot;/CN=<span class="variable">$DOMAIN</span>&quot;</span> -out device.csr</span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> device.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out device.crt -days 5000</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> rootCA.pem assets/client/tls/ngrokroot.crt</span><br><span class="line"><span class="built_in">cp</span> device.crt assets/server/tls/snakeoil.crt</span><br><span class="line"><span class="built_in">cp</span> device.key assets/server/tls/snakeoil.key</span><br><span class="line"></span><br><span class="line">make release-server</span><br><span class="line">GOOS=linux GOARCH=amd64 make release-client</span><br><span class="line">GOOS=windows GOARCH=amd64 make release-client</span><br><span class="line">GOOS=linux GOARCH=arm make release-client</span><br><span class="line">GOOS=darwin GOARCH=amd64 make release-client</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p bin/tls</span><br><span class="line"><span class="built_in">mkdir</span> -p bin/out</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> device.crt bin/tls/snakeoil.crt</span><br><span class="line"><span class="built_in">cp</span> device.key bin/tls/snakeoil.key</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;nohup ./ngrokd -tlsKey=&quot;tls/snakeoil.key&quot; -tlsCrt=&quot;tls/snakeoil.crt&quot; -domain=&#x27;</span><span class="string">&quot;<span class="variable">$DOMAIN</span>&quot;</span><span class="string">&#x27; -httpAddr=&quot;:80&quot; -httpsAddr=&quot;:443&quot; &gt; out/nohupd.out 2&gt;&amp;1 &amp;&#x27;</span> &gt; ./bin/start.sh</span><br><span class="line"><span class="built_in">chmod</span> +x ./bin/start.sh</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;server_addr: <span class="variable">$DOMAIN</span>:4443&quot;</span> &gt; ./bin/ngrok.cfg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;trust_host_root_certs: false&quot;</span> &gt;&gt; ./bin/ngrok.cfg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;nohup ./ngrok -config=./ngrok.cfg -subdomain=blog -proto=http 8078 &gt; /dev/null 2&gt;&amp;1 &amp;&#x27;</span> &gt; ./bin/blog.sh</span><br><span class="line"><span class="built_in">chmod</span> +x ./bin/ngrok_blog.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">mv</span> bin <span class="variable">$&#123;resultFileName&#125;</span></span><br><span class="line">tar -zcvf <span class="variable">$&#123;resultFileName&#125;</span>.tar.gz <span class="variable">$&#123;resultFileName&#125;</span></span><br><span class="line"><span class="built_in">mv</span> <span class="variable">$&#123;resultFileName&#125;</span>.tar.gz <span class="variable">$currentPwd</span>/<span class="variable">$&#123;resultFileName&#125;</span>.tar.gz</span><br><span class="line">git clean -<span class="built_in">df</span></span><br><span class="line">git checkout -- .</span><br><span class="line"><span class="built_in">echo</span> ok! result: <span class="variable">$&#123;resultFileName&#125;</span>.tar.gz</span><br></pre></td></tr></table></figure>

<ul>
<li>运行 <code>sh build_ngrok.sh</code></li>
<li>根据提示输入已经配置好的域名，例如：ngrok.lyloou.com</li>
<li>在域名对应的服务器上运行：<code>./start.sh</code> （这样，服务器端就完成了）</li>
</ul>
<h2 id="打包和解压"><a href="#打包和解压" class="headerlink" title="打包和解压"></a>打包和解压</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tar -zcvf ngrok_lyloou_com.tar.gz bin</span><br><span class="line">tar -zxvf ngrok_lyloou_com.tar.gz</span><br></pre></td></tr></table></figure>

<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>realpath ngrok_lyloou_com.tar.gz # 获取文件路径<br>scp <a href="mailto:&#114;&#111;&#111;&#x74;&#x40;&#x31;&#55;&#x30;&#x2e;&#x31;&#48;&#46;&#48;&#x2e;&#x31;&#x30;&#x30;">&#114;&#111;&#111;&#x74;&#x40;&#x31;&#55;&#x30;&#x2e;&#x31;&#48;&#46;&#48;&#x2e;&#x31;&#x30;&#x30;</a>:/root/t/ngrok_lyloou_com.tar.gz ngrok_lyloou_com.tar.gz # 从服务器拉取文件</p>
<h2 id="运行服务器（已经在上面的build-ngrok-sh中配置过了）"><a href="#运行服务器（已经在上面的build-ngrok-sh中配置过了）" class="headerlink" title="运行服务器（已经在上面的build_ngrok.sh中配置过了）"></a>运行服务器（已经在上面的<code>build_ngrok.sh</code>中配置过了）</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">./ngrokd -domain=<span class="string">&quot;ngrok.lyloou.com&quot;</span> -httpAddr=<span class="string">&quot;:80&quot;</span> -httpsAddr=<span class="string">&quot;:443&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 或者后台运行</span></span><br><span class="line"><span class="built_in">mkdir</span> out</span><br><span class="line"><span class="built_in">chmod</span> +x ngrokd</span><br><span class="line"><span class="built_in">nohup</span> ./ngrokd -domain=<span class="string">&quot;ngrok.lyloou.com&quot;</span> -httpAddr=<span class="string">&quot;:80&quot;</span> -httpsAddr=<span class="string">&quot;:443&quot;</span>  &gt; out/nohup_log.out 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<h2 id="运行客户端（在上面的build-ngrok-sh中配置并生成了一个案例ngrok-blog-sh）"><a href="#运行客户端（在上面的build-ngrok-sh中配置并生成了一个案例ngrok-blog-sh）" class="headerlink" title="运行客户端（在上面的build_ngrok.sh中配置并生成了一个案例ngrok_blog.sh）"></a>运行客户端（在上面的<code>build_ngrok.sh</code>中配置并生成了一个案例<code>ngrok_blog.sh</code>）</h2><p>添加配置 ngrok.cfg：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">server_addr: <span class="string">&quot;ngrok.lyloou.com:4443&quot;</span></span><br><span class="line">trust_host_root_certs: <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">nohup</span> ./ngrok -config=./ngrok.cfg -subdomain=lou -proto=http 80 &gt; /dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>如果在云平台中运行 ngrok 服务, 需要将<code>4443端口</code>和<code>80端口</code>添加到安全组中，如下表：</p>
<table>
<thead>
<tr>
<th>授权策略</th>
<th>协议类型</th>
<th>端口范围</th>
<th>授权类型(全部)</th>
<th>授权对象</th>
</tr>
</thead>
<tbody><tr>
<td>允许</td>
<td>自定义 TCP</td>
<td>4443/4443</td>
<td>IPv4 地址段访问</td>
<td>0.0.0.0/0</td>
</tr>
<tr>
<td>允许</td>
<td>自定义 TCP</td>
<td>80/80</td>
<td>IPv4 地址段访问</td>
<td>0.0.0.0/0</td>
</tr>
</tbody></table>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://morongs.github.io/2016/12/28/dajian-ngrok/">从零教你搭建 ngrok 服务</a></li>
<li><a href="https://blog.csdn.net/cloume/article/details/51209493">Ubuntu 下编译安装 ngrok</a></li>
</ul>
<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><figure class="highlight md"><table><tr><td class="code"><pre><span class="line"><span class="section">#一、系统说明</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> Windows 使用<span class="code">`windows_amd64`</span>版本</span><br><span class="line"><span class="bullet">-</span> Mac 使用<span class="code">`darwin_amd64`</span>版本</span><br><span class="line"><span class="bullet">-</span> Linux 使用<span class="code">`linux`</span>版本</span><br><span class="line"></span><br><span class="line"><span class="section">#二、配置说明</span></span><br><span class="line">.\ngrok.exe -config=.\ngrok.cfg -subdomain=lou -proto=http 80</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> subdomain 指向自定义的子域名</span><br><span class="line"><span class="bullet">-</span> proto 指向使用的协议</span><br><span class="line"><span class="bullet">-</span> 随后的数字表示：准备映射出去的端口号</span><br><span class="line"></span><br><span class="line"><span class="section"># 三、使用方法</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> Windows 系统执行 ngrok.bat</span><br><span class="line"><span class="bullet">-</span> Mac 和 Linux 系统执行 ngrok.sh</span><br><span class="line"></span><br><span class="line"><span class="section"># 四、访问方式</span></span><br><span class="line"></span><br><span class="line">浏览器中打开链接：</span><br><span class="line">[<span class="string">http://lou.ngrok.lyloou.com</span>](<span class="link">http://lou.ngrok.lyloou.com</span>)</span><br></pre></td></tr></table></figure>

<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p><a href="https://github.com/lyloou/build_ngrok">https://github.com/lyloou/build_ngrok</a></p>
]]></content>
      <tags>
        <tag>devops</tag>
      </tags>
  </entry>
  <entry>
    <title>安全</title>
    <url>/devops/security/</url>
    <content><![CDATA[<h2 id="PGP"><a href="#PGP" class="headerlink" title="PGP"></a>PGP</h2><h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>PGP（Pretty Good Privacy），用来提高安全性的软件，可以用来验证文件的合法性；例如常用来给邮件加密、解密及验证,以提高电子邮件交流的安全性；</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 需要安装 rng-tools才能成功生成 gpg 密钥</span></span><br><span class="line">apt install rng-tools</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成gpg密钥</span></span><br><span class="line">gpg --gen-key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看公钥</span></span><br><span class="line">gpg --list-keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看私钥</span></span><br><span class="line">gpg --list-secret-keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传公钥</span></span><br><span class="line">gpg --keyserver hkp://pgp.mit.edu --send-keys FD9EF47E271531EC53C8F6B1EE2E9AE32588D3D8</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">gpg --keyserver hkp://pgp.mit.edu --send-keys EE2E9AE32588D3D8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户下载公钥</span></span><br><span class="line">gpg --keyserver hkp://pgp.mit.edu --recv-keys EE2E9AE32588D3D8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对文件生成 asc 文件（会生成）以 .asc 的后缀文件</span></span><br><span class="line"><span class="comment"># 参数 -a 表示创建 ASCII 的输出；</span></span><br><span class="line"><span class="comment"># 参数 -b 表示创建一个独立的文件；</span></span><br><span class="line">gpg -ab test.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对文件是否被修改进行验证</span></span><br><span class="line">gpg --verify test.sh.asc</span><br></pre></td></tr></table></figure>

<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p>《Maven 实战》——版本管理(C13.6)</p>
]]></content>
      <tags>
        <tag>devops</tag>
      </tags>
  </entry>
  <entry>
    <title>Git Tutor</title>
    <url>/git/git%20tutor/</url>
    <content><![CDATA[<ul>
<li><p><a href="https://marklodato.github.io/visual-git-guide/index-en.html?no-svg">A Visual Git Reference</a></p>
</li>
<li><p><a href="https://backlog.com/git-tutorial/cn/">连猴子都懂的Git入门</a></p>
</li>
</ul>
]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>【开发工具-Git】Git中合并多个项目并保留所有commit提交记录</title>
    <url>/git/Git%E4%B8%AD%E5%90%88%E5%B9%B6%E5%A4%9A%E4%B8%AA%E9%A1%B9%E7%9B%AE%E5%B9%B6%E4%BF%9D%E7%95%99%E6%89%80%E6%9C%89commit%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>通常的合并项目的做法是，将所有项目移动到一个新目录中，并重新生成纳入 git 管理（去掉了.git 文件夹），这样做的弊端是之前的历史提交记录都没有了，想要看之前的记录，还需要再回到旧项目中查看。<br>在本文中，我会介绍怎样完整地保留历史提交记录。</p>
<h2 id="为什么保留提交记录？"><a href="#为什么保留提交记录？" class="headerlink" title="为什么保留提交记录？"></a>为什么保留提交记录？</h2><ol>
<li>可以追踪文件修改历史，方便对比和还原历史。</li>
<li>可以追责，知道之前是谁写的，什么时候写的。</li>
</ol>
<p>拆分</p>
<h2 id="怎样完整地保留提交记录？"><a href="#怎样完整地保留提交记录？" class="headerlink" title="怎样完整地保留提交记录？"></a>怎样完整地保留提交记录？</h2><p>假设有三个项目</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">A：远程地址为：git@github.com:lyloou/merge_a.git ，分支为<span class="keyword">master</span></span><br><span class="line"><span class="title">B</span>：远程地址为：git@github.com:lyloou/merge_b.git ，分支为<span class="keyword">master</span></span><br><span class="line"><span class="title">C</span>：远程地址为：git@github.com:lyloou/merge_c.git ，分支为<span class="literal">master</span></span><br></pre></td></tr></table></figure>

<p>合并结果为：<a href="mailto:&#103;&#x69;&#x74;&#x40;&#x67;&#x69;&#116;&#x68;&#x75;&#98;&#46;&#99;&#111;&#x6d;">&#103;&#x69;&#x74;&#x40;&#x67;&#x69;&#116;&#x68;&#x75;&#98;&#46;&#99;&#111;&#x6d;</a>:lyloou/merge_all.git ，分支为 master</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">merge_all</span><br><span class="line">  -- merge_a</span><br><span class="line">  -- merge_b</span><br><span class="line">  -- merge_c</span><br></pre></td></tr></table></figure>

<p><strong>操作步骤</strong></p>
<ol>
<li>在本地新建 merge_all 目录，并初始化</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> merge_all</span><br><span class="line"><span class="comment"># 将当前目录初始化为git版本管理的目录</span></span><br><span class="line">git init</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 merge_all 中添加 merge_a，merge_b，merge_c 的远程分支。</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git remote add origin_merge_a git@github.com:lyloou/merge_a.git</span><br><span class="line">git remote add origin_merge_b git@github.com:lyloou/merge_b.git</span><br><span class="line">git remote add origin_merge_c git@github.com:lyloou/merge_c.git</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>可以验证是否添加成功<code>git remote -v</code></li>
<li>在 merge_all 目录下，获取 merge_a, merge_b,merge_c 的 master 分支数据</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git fetch origin_merge_a master</span><br><span class="line">git fetch origin_merge_b master</span><br><span class="line">git fetch origin_merge_c master</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>开始合并了，并移动到子目录中</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 合并，并保留历史</span></span><br><span class="line">git merge origin_merge_a/master --allow-unrelated-histories</span><br><span class="line"><span class="comment"># 新建子文件夹，并移动到此文件中（排除需要忽略的文件夹）</span></span><br><span class="line"><span class="built_in">mkdir</span> merge_a</span><br><span class="line"><span class="built_in">mv</span> !(.|..|.git|merge_a) merge_a</span><br><span class="line"><span class="comment"># 生成一条commit日志</span></span><br><span class="line">git add . &amp;&amp; git commit -m <span class="string">&quot;merge merge_a_master and mv to merge_a&quot;</span></span><br><span class="line"></span><br><span class="line">git merge origin_merge_b/master --allow-unrelated-histories</span><br><span class="line"><span class="built_in">mkdir</span> merge_b</span><br><span class="line"><span class="built_in">mv</span> !(.|..|.git|merge_b) merge_b</span><br><span class="line">git add . &amp;&amp; git commit -m <span class="string">&quot;merge merge_b_master and mv to merge_b&quot;</span></span><br><span class="line"></span><br><span class="line">git merge origin_merge_c/master --allow-unrelated-histories</span><br><span class="line"><span class="built_in">mkdir</span> merge_c</span><br><span class="line"><span class="built_in">mv</span> !(.|..|.git|merge_c) merge_c</span><br><span class="line">git add . &amp;&amp; git commit -m <span class="string">&quot;merge merge_c_master and mv to merge_c&quot;</span></span><br><span class="line"><span class="comment"># 注意 1： `--allow-unrelated-histories` 的意思是，允许合并不相关历史</span></span><br><span class="line"><span class="comment"># 注意 2：执行 `mv !(.|..|.git|merge_a) merge_a` 的过程中可能会报错误 `-bash: !: event not`，执行一下命令 `shopt -s extglob`</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>推送 merge_all 的 master 分支到远程</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git remote add origin git@github.com:lyloou/merge_all.git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<p>至此合并多项目操作就完成了。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://0f9de7f3.wiz06.com/wapp/pages/view/share/s/0fDuvP3SO4QS2Hb3sP2Di0ai2_-yc63ErkxP28a9kS3XUYgP">Wiz 原文</a></li>
<li><a href="https://juejin.cn/post/6885549929960472590">git 合并两个项目 - 掘金</a></li>
<li><a href="https://blog.csdn.net/m0_37586991/article/details/88617332">linux mv 命令排除某个文件或文件夹_哪惧明天，风高路斜-CSDN 博客_mv 排除文件</a></li>
<li><a href="https://askubuntu.com/questions/889744/what-is-the-purpose-of-shopt-s-extglob">command line - What is the purpose of shopt -s extglob - Ask Ubuntu</a></li>
</ul>
<blockquote>
<p>As you can guess, it stands for extended globbing. This option allows for more advanced pattern matching.</p>
</blockquote>
<h2 id="一键合并多个项目-shell-脚本"><a href="#一键合并多个项目-shell-脚本" class="headerlink" title="一键合并多个项目 shell 脚本"></a>一键合并多个项目 shell 脚本</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1. 在本地新建 merge_all 目录，并初始化</span></span><br><span class="line"><span class="built_in">mkdir</span> merge_all</span><br><span class="line"><span class="built_in">cd</span> merge_all</span><br><span class="line"><span class="comment"># 将当前目录初始化为git版本管理的目录</span></span><br><span class="line">git init</span><br><span class="line"></span><br><span class="line"><span class="comment">#2. 在 merge_all 中添加 merge_a，merge_b，merge_c 的远程分支。</span></span><br><span class="line">git remote add origin_a git@github.com:lyloou/merge_a.git</span><br><span class="line">git remote add origin_b git@github.com:lyloou/merge_b.git</span><br><span class="line">git remote add origin_c git@github.com:lyloou/merge_c.git</span><br><span class="line"></span><br><span class="line"><span class="comment">#3. 可以验证是否添加成功`git remote -v`</span></span><br><span class="line">git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment">#4. 在 merge_all 目录下，获取 merge_a, merge_b,merge_c 的 master 分支数据</span></span><br><span class="line">git fetch origin_a master</span><br><span class="line">git fetch origin_b master</span><br><span class="line">git fetch origin_c master</span><br><span class="line"></span><br><span class="line"><span class="comment">#5. 开始合并了，并移动到子目录中</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意 执行 `mv !(.|..|.git|merge_a) merge_a` 的过程中可能会报错误 `-bash: !: event not`，执行一下命令 `shopt -s extglob`</span></span><br><span class="line"><span class="built_in">shopt</span> -s extglob</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并，并保留历史</span></span><br><span class="line">git merge origin_a/master --allow-unrelated-histories</span><br><span class="line"><span class="comment"># 新建子文件夹，并移动到此文件中（排除需要忽略的文件夹）</span></span><br><span class="line"><span class="built_in">mkdir</span> merge_a &amp;&amp; <span class="built_in">mv</span> !(.|..|.git|merge_a) merge_a</span><br><span class="line"><span class="comment"># 生成一条commit日志</span></span><br><span class="line">git add . &amp;&amp; git commit -m <span class="string">&quot;merge and mv to merge_a&quot;</span></span><br><span class="line"></span><br><span class="line">git merge origin_b/master --allow-unrelated-histories</span><br><span class="line"><span class="built_in">mkdir</span> merge_b &amp;&amp; <span class="built_in">mv</span> !(.|..|.git|merge_a|merge_b) merge_b</span><br><span class="line">git add . &amp;&amp; git commit -m <span class="string">&quot;merge and mv to merge_b&quot;</span></span><br><span class="line"></span><br><span class="line">git merge origin_c/master --allow-unrelated-histories</span><br><span class="line"><span class="built_in">mkdir</span> merge_c &amp;&amp; <span class="built_in">mv</span> !(.|..|.git|merge_a|merge_b|merge_c) merge_c</span><br><span class="line">git add . &amp;&amp; git commit -m <span class="string">&quot;merge and mv to merge_c&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#6. 推送 merge_all 的 master 分支到远程</span></span><br><span class="line">git remote add origin git@github.com:lyloou/merge_all.git</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="http://lyloou.com/git/Git%E4%B8%AD%E5%90%88%E5%B9%B6%E5%A4%9A%E4%B8%AA%E9%A1%B9%E7%9B%AE%E5%B9%B6%E4%BF%9D%E7%95%99%E6%89%80%E6%9C%89commit%E8%AE%B0%E5%BD%95/">阅读原文</a></p>
]]></content>
      <tags>
        <tag>git</tag>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>Github配置</title>
    <url>/git/github%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h3 id="生成密钥"><a href="#生成密钥" class="headerlink" title="生成密钥"></a>生成密钥</h3><p>密钥是上传到远程库的凭证，是本地与远程库的桥梁；</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>ssh-keygen -t rsa -C <span class="string">&quot;lyloou@qq.com&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="添加密钥"><a href="#添加密钥" class="headerlink" title="添加密钥"></a>添加密钥</h3><p>复制<code>~/.ssh/id_rsa.pub</code>内容到<code>https://github.com/settings/keys</code>的<code>SSH and GPG keys</code></p>
<h3 id="测试连通性"><a href="#测试连通性" class="headerlink" title="测试连通性"></a>测试连通性</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ssh</span> -T git<span class="variable">@github</span>.com</span><br></pre></td></tr></table></figure>

<h2 id="big-file"><a href="#big-file" class="headerlink" title="big file"></a>big file</h2><ul>
<li><a href="https://www.cnblogs.com/guxin/p/github-cannot-push-files-larger-than-100mb.html">GitHub 限制上传单个大于 100M 的大文件 - 霍莉雪特 - 博客园</a></li>
<li><a href="https://blog.csdn.net/tyro_java/article/details/53440666">突破 github 的 100M 单个大文件上传限制 - Johnny 的专栏 - CSDN 博客</a></li>
</ul>
<h2 id="keyboard-shortcuts"><a href="#keyboard-shortcuts" class="headerlink" title="keyboard shortcuts"></a>keyboard shortcuts</h2><p><a href="https://help.github.com/en/articles/keyboard-shortcuts">Keyboard shortcuts - GitHub Help</a></p>
]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>在Github提交pr</title>
    <url>/git/github%E6%8F%90%E4%BA%A4pr/</url>
    <content><![CDATA[<h1 id="在-github-提交-pr"><a href="#在-github-提交-pr" class="headerlink" title="在 github 提交 pr"></a>在 github 提交 pr</h1><ul>
<li>fork 一份到自己的仓库</li>
<li>设置本地的 origin url: <code>git remote set-url origin https://github.com/lyloou/WeexErosFramework.git</code></li>
</ul>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看默认上游的远程信息</span></span><br><span class="line">git remote show origin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加多一个上游</span></span><br><span class="line">git remote add upstream https:<span class="regexp">//gi</span>thub.com<span class="regexp">/bmfe/</span>WeexErosFramework.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看新上游的远程信息</span></span><br><span class="line">git remote show upstream</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将上游upstream的新内容拉取下来</span></span><br><span class="line">git pull upstream master:master</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改提交</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;new feature&quot;</span></span><br><span class="line">git push</span><br></pre></td></tr></table></figure>

<ul>
<li><p>进入自己 fork 的项目</p>
</li>
<li><p>有个<code>new pull request</code>按钮，按照提示进行即可</p>
</li>
</ul>
<h1 id="第一次参与开源"><a href="#第一次参与开源" class="headerlink" title="第一次参与开源"></a>第一次参与开源</h1><p><a href="https://github.com/firstcontributions/first-contributions/blob/master/translations/README.chs.md">first-contributions/README.chs.md at master · firstcontributions/first-contributions</a></p>
<p><a href="https://opensource.guide/zh-hans/how-to-contribute/">如何为开源做贡献 | Open Source Guides</a><br><a href="https://www.erupt.xyz/demo/#/site/aHR0cHM6Ly93d3cueXVxdWUuY29tL3l1ZXBlbmcvZXJ1cHQ%3D">第一次贡献 使用文档 - Erupt Framework</a></p>
]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>Gitlab</title>
    <url>/git/gitlab/</url>
    <content><![CDATA[<h2 id="CI-amp-CD"><a href="#CI-amp-CD" class="headerlink" title="CI &amp; CD"></a>CI &amp; CD</h2><h3 id="gitlab-ci-yml"><a href="#gitlab-ci-yml" class="headerlink" title=".gitlab-ci.yml"></a>.gitlab-ci.yml</h3><ul>
<li><a href="http://gitlab.renrenyoupin.com/help/ci/quick_start/README">Readme · Quick start · Ci · Help · GitLab</a></li>
<li><a href="http://gitlab.renrenyoupin.com/help/ci/yaml/README.md">Configuration of your jobs with .gitlab-ci.yml</a></li>
<li><a href="https://segmentfault.com/a/1190000010442764">Gitlab CI yaml官方配置文件翻译</a></li>
<li><a href="https://scarletsky.github.io/2016/07/29/use-gitlab-ci-for-continuous-integration/">用 GitLab CI 进行持续集成 | Scarletsky</a></li>
</ul>
<h3 id="Runner"><a href="#Runner" class="headerlink" title="Runner"></a>Runner</h3><ul>
<li><p><a href="https://docs.gitlab.com/runner/install/linux-repository.html">Install GitLab Runner using the official GitLab repositories | GitLab</a></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">curl -L https:<span class="regexp">//</span>packages.gitlab.com<span class="regexp">/install/</span>repositories<span class="regexp">/runner/gi</span>tlab-runner/script.deb.sh | sudo bash</span><br><span class="line"></span><br><span class="line">apt-cache madison gitlab-runner</span><br><span class="line">sudo apt-get install gitlab-runner=<span class="number">10.8</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure></li>
<li><p><a href="https://docs.gitlab.com/runner/register/index.html">Registering Runners | GitLab</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo gitlab-runner register \</span><br><span class="line">  --non-interactive \</span><br><span class="line">  --url <span class="string">&quot;http://gitlab.lyloou.com/&quot;</span> \</span><br><span class="line">  --registration-token <span class="string">&quot;xxxxxxxxxxxxx&quot;</span> \</span><br><span class="line">  --executor <span class="string">&quot;shell&quot;</span> \</span><br><span class="line">  --description <span class="string">&quot;shell-runner&quot;</span> \</span><br><span class="line">  --tag-list <span class="string">&quot;shell&quot;</span> \</span><br><span class="line">  --run-untagged=<span class="string">&quot;true&quot;</span> \</span><br><span class="line">  --locked=<span class="string">&quot;false&quot;</span> </span><br></pre></td></tr></table></figure></li>
</ul>
<p>-<a href="https://segmentfault.com/a/1190000013362589">【GITLAB】 服务配置可持续集成部署的项目案例 - 安装篇 - 个人文章 - SegmentFault 思否</a></p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">sudo gitlab-runner list</span><br><span class="line">gitlab-runner unregister <span class="params">--url</span> http:<span class="string">//gitlab.example.com/</span> <span class="params">--token</span> t0k3n</span><br><span class="line">gitlab-runner unregister <span class="params">--name</span> test-runner</span><br><span class="line">gitlab-runner unregister <span class="params">--all-runners</span></span><br></pre></td></tr></table></figure>
<h1 id="ff0000"><a href="#ff0000" class="headerlink" title="!!#ff0000"></a>!!#ff0000</h1><p>Runner的大版本号要和gitlab的在版本号保持一致。<br>如：Runner 10.8.0 ~ gitlab 10.2.4</p>
]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>Git分支管理</title>
    <url>/git/git%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<ul>
<li><p><a href="https://nvie.com/posts/a-successful-git-branching-model/">A successful Git branching model » nvie.com</a><br><img src="https://nvie.com/img/git-model@2x.png" alt="A successful Git branching model"></p>
</li>
<li><p><a href="https://backlog.com/git-tutorial/cn/stepup/stepup1_5.html">topic分支和merge分支的运用实例【分支】| 猴子都能懂的GIT入门| 贝格乐（Backlog）</a><br><img src="https://backlog.com/git-tutorial/cn/img/post/stepup/capture_stepup1_5_6.png" alt="topic分支和merge分支的运用实例"></p>
</li>
<li><p><a href="https://backlog.com/git-tutorial/cn/stepup/stepup2_8.html">用rebase合并【教程1 操作分支】| 猴子都能懂的GIT入门 | 贝格乐（Backlog）</a></p>
</li>
</ul>
]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>Git命令</title>
    <url>/git/git%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="C"><a href="#C" class="headerlink" title="C"></a>C</h3><ul>
<li>添加到版本控制: <code>git add filename.md</code></li>
<li>添加描述并提交： <code>git commit -m &quot;first init&quot;</code></li>
</ul>
<h3 id="R"><a href="#R" class="headerlink" title="R"></a>R</h3><ul>
<li>查看图形 log：<code>git log --graph</code></li>
<li>查看单行 log：<code>git log --pretty=oneline</code></li>
<li>查看分支合并情况：<code>git log --graph --pretty=oneline --abbrev-commit</code></li>
<li>查看工作区和版本库最新版本的区别： <code>git diff HEAD -- test.xml</code></li>
<li><a href="#shortlog">列出每个人的最近 commit 记录：<code>git shortlog</code></a></li>
<li>列出每个人的 commit 次数：<code>git shortlog -sne</code></li>
</ul>
<h3 id="U"><a href="#U" class="headerlink" title="U"></a>U</h3><ul>
<li>修改提交信息：<code>git commit --amend</code></li>
<li>取消添加（git add .）的命令：<code>git reset HEAD test.xml</code></li>
</ul>
<h3 id="D"><a href="#D" class="headerlink" title="D"></a>D</h3><ul>
<li>移除工作空间的文件： <code>git rm test.xml</code></li>
<li>丢弃工作区的修改： <code>git checkout -- test.xml</code>，其中<code>--</code>很重要，没有这个<code>--</code>，就变成了“切换到另一个分支”。</li>
</ul>
<h3 id="RESET"><a href="#RESET" class="headerlink" title="RESET"></a>RESET</h3><ul>
<li><p>将 HEAD 指向到某个版本： <code>git reset --hard commit_id</code></p>
</li>
<li><p>重返未来，用<code>git reflog</code>查看命令历史，以便回到未来的那个版本。</p>
</li>
<li><p>git reset 后丢弃远程的提交</p>
<blockquote>
<p><a href="https://segmentfault.com/q/1010000002898735">github - git 怎样删除远程仓库的某次错误提交？ - SegmentFault</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> <span class="comment"># 获取log的某次提交commit id</span></span><br><span class="line">git reset --hard 0301382 <span class="comment"># 回退到0301382</span></span><br><span class="line">git push --force <span class="comment"># 强制推送到服务器端</span></span><br></pre></td></tr></table></figure></li>
<li><p>Git 撤销 git commit 但是未 git push 的修改<br><code>git reset commit_id </code></p>
<blockquote>
<p><a href="https://blog.csdn.net/winceos/article/details/22797437">Git 撤销 git commit 但是未 git push 的修改</a></p>
</blockquote>
</li>
<li><p><a href="https://blog.csdn.net/a478555/article/details/50970930">撤销一次分支的合并 Merge</a></p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">reset</span> <span class="comment">--hard HEAD~</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>How can I undo those commits from the local repository?<br><a href="https://stackoverflow.com/questions/927358/how-do-i-undo-the-most-recent-local-commits-in-git">https://stackoverflow.com/questions/927358/how-do-i-undo-the-most-recent-local-commits-in-git</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git reset HEAD~</span><br></pre></td></tr></table></figure>

<h2 id="远程仓库"><a href="#远程仓库" class="headerlink" title="远程仓库"></a>远程仓库</h2><ul>
<li><p>移除远程仓库： <code>git remote remove origin</code></p>
</li>
<li><p>添加远程仓库： <code>git remote add origin git@github.com:lyloou/lou.git</code></p>
</li>
<li><p><a href="https://github.com/doggy8088/Learn-Git-in-30-days/blob/master/zh-tw/25.md#%E8%A8%BB%E5%86%8A%E9%81%A0%E7%AB%AF%E5%84%B2%E5%AD%98%E5%BA%AB">添加多个远程仓库： <code>git remote add jquery https://github.com/jquery/jquery.git</code></a></p>
</li>
<li><p>远程主机改名： <code>git remote rename &lt;原主机名&gt; &lt;新主机名&gt;</code></p>
</li>
<li><p>删除远程主机： <code>git remote rm &lt;主机名&gt;</code></p>
</li>
<li><p>显示远程主机详细信息： <code>git remote show &lt;主机名&gt;</code></p>
</li>
<li><p>提交到远程仓库： <code>git push -u origin master</code></p>
<blockquote>
<p>由于远程库是空的，我们第一次推送 master 分支时，加上了-u 参数，Git 不但会把本地的 master 分支内容推送的远程新的<br>master 分支，还会把本地的 master 分支和远程的 master 分支关联起来，在以后的推送或者拉取时就可以简化命令<br>（<code>git push origin master</code>）。<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/0013752340242354807e192f02a44359908df8a5643103a000">http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/0013752340242354807e192f02a44359908df8a5643103a000</a></p>
</blockquote>
</li>
<li><p><a href="https://github.com/doggy8088/Learn-Git-in-30-days/blob/master/zh-tw/24.md#%E7%9B%B4%E6%8E%A5%E5%B0%87%E7%8F%BE%E6%9C%89%E7%9A%84%E6%9C%AC%E5%9C%B0-git-%E5%84%B2%E5%AD%98%E5%BA%AB%E4%B8%8A%E5%82%B3%E5%88%B0%E6%8C%87%E5%AE%9A%E7%9A%84-github-%E5%B0%88%E6%A1%88">拉取并且合并远程分支：<code>git pull origin master --allow-unrelated-histories</code></a></p>
</li>
<li><p>删除远程文件夹或文件，但是本地还保留着： <code>git rm -r --cached dir2</code> (<code>-r</code>参数，表示递归删除文件夹的内容)</p>
<blockquote>
<p><a href="https://stackoverflow.com/questions/1274057/how-to-make-git-forget-about-a-file-that-was-tracked-but-is-now-in-gitignore">https://stackoverflow.com/questions/1274057/how-to-make-git-forget-about-a-file-that-was-tracked-but-is-now-in-gitignore</a></p>
</blockquote>
</li>
<li><p>删除远程文件夹或文件，但是本地还保留着（展示要删除的文件，不是真的删除）： <code>git rm -r -n --cached dir2</code></p>
</li>
<li><p><code>pull = fetch + merge</code></p>
<blockquote>
<p><a href="https://ruby-china.org/topics/15729">git pull 和 git fetch 有什么区别？</a> &gt; <a href="http://blog.kainaodong.com/?p=12">git 查看远程版本库和本地库的差异 | 星辰</a></p>
</blockquote>
</li>
<li><p>直接修改远程仓库 url</p>
<blockquote>
<p><code>git remote set-url origin git:new.url.here</code><br>See this question: <a href="http://stackoverflow.com/questions/16330404/how-to-remove-remote-origin-from-git-repo/16330439">Change the URI (URL) for a remote Git repository - Stack Overflow</a></p>
</blockquote>
</li>
<li><p>clone repo with its submodule (use the –recursive argument)</p>
<blockquote>
<p>git clone –recursive <a href="mailto:&#103;&#x69;&#x74;&#64;&#x67;&#105;&#116;&#104;&#x75;&#x62;&#x2e;&#99;&#111;&#x6d;">&#103;&#x69;&#x74;&#64;&#x67;&#105;&#116;&#104;&#x75;&#x62;&#x2e;&#99;&#111;&#x6d;</a>:rbind/yihui.git<br><a href="https://yihui.name/cn/2017/03/git-submodule/">https://yihui.name/cn/2017/03/git-submodule/</a></p>
</blockquote>
<ul>
<li>如果克隆库的时候要初始化子模块，请加上 –recursive 参数，如：<br>git clone –recursive <a href="mailto:&#x67;&#105;&#116;&#64;&#x67;&#x69;&#x74;&#104;&#117;&#x62;&#x2e;&#99;&#111;&#109;">&#x67;&#105;&#116;&#64;&#x67;&#x69;&#x74;&#104;&#117;&#x62;&#x2e;&#99;&#111;&#109;</a>:rbind/yihui.git</li>
<li>如果已经克隆了主库但没初始化子模块，则用：<br>git submodule update –init –recursive</li>
<li>如果已经克隆并初始化子模块，而需要从子模块的源更新这个子模块，则：<br>git submodule update –recursive –remote</li>
<li>如果要向一个库中添加一个新的子模块，可以用 git submodule add<br>git submodule add <a href="https://github.com/yihui/hugo-lithium-theme.git">https://github.com/yihui/hugo-lithium-theme.git</a> themes/hugo-lithium-theme</li>
</ul>
</li>
</ul>
<h2 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h2><h3 id="创建空白分支"><a href="#创建空白分支" class="headerlink" title="创建空白分支"></a><a href="https://blog.csdn.net/playboyanta123/article/details/48975175">创建空白分支</a></h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git checkout --orphan gh-pages</span><br></pre></td></tr></table></figure>

<h3 id="delete-a-git-branch-both-locally-and-remotely"><a href="#delete-a-git-branch-both-locally-and-remotely" class="headerlink" title="delete a git branch both locally and remotely."></a>delete a git branch both locally and remotely.</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ git push --delete &lt;remote_name&gt; &lt;branch_name&gt;</span><br><span class="line">$ git branch -d &lt;branch_name&gt;</span><br><span class="line"><span class="comment"># (https://stackoverflow.com/questions/2003505/how-do-i-delete-a-git-branch-both-locally-and-remotely)</span></span><br></pre></td></tr></table></figure>

<h3 id="本地分支"><a href="#本地分支" class="headerlink" title="本地分支"></a>本地分支</h3><ul>
<li>删除本地分支：<code>git branch -d &#123;the_local_branch&#125;</code></li>
</ul>
<h3 id="远程分支"><a href="#远程分支" class="headerlink" title="远程分支"></a>远程分支</h3><ul>
<li><p>添加本地分支到远程分支，并关联：<code>git push -u origin develop</code></p>
<blockquote>
<p><a href="https://stackoverflow.com/questions/2765421/how-do-i-push-a-new-local-branch-to-a-remote-git-repository-and-track-it-too">https://stackoverflow.com/questions/2765421/how-do-i-push-a-new-local-branch-to-a-remote-git-repository-and-track-it-too</a></p>
</blockquote>
</li>
<li><p>创建远程 origin 的 dev 分支到本地：<code>git checkout -b dev origin/dev</code></p>
</li>
<li><p>指定本地 dev 分支与远程 origin/dev 分支的链接：<code>git branch --set-upstream dev origin/dev</code></p>
</li>
<li><p><code>git clone</code>默认会把远程仓库整个克隆下来，但只会创建<code>master</code>分支，如果远程还有其他分支，可以通过下面的方式 clone 分支。</p>
<ul>
<li>将远程分支获取至本地仓库：git checkout -b python_mail.skin origin/python_mail.skin</li>
<li>使用-t 参数，它默认会在本地建立一个和远程分支名字一样的分支：git checkout -t origin/python_mail.skin</li>
<li><a href="http://blog.csdn.net/xqs83/article/details/7382074">git clone 远程分支 - xqs83 的专栏 - 博客频道 - CSDN.NET</a></li>
</ul>
</li>
<li><p>在<code>git pull</code>之前，本地分支关联远程分支：<code>git branch --set-upstream feature-A origin/feature-A</code></p>
<ul>
<li><a href="http://blog.csdn.net/xqs83/article/details/17361201">git 新建本地分支自动与远程分支关联 - xqs83 的专栏 - 博客频道 - CSDN.NET</a></li>
</ul>
</li>
<li><p>提交分支：<code>git push origin feature-A:feature-A</code></p>
</li>
<li><p>删除远程分支：<code>git push origin :feature-A</code></p>
</li>
<li><p>删除远程分支：<code>git push --delete &#123;the_remote_branch&#125;</code></p>
</li>
<li><p>克隆指定分支：<code>git clone -b rryp https://github.com/bmfe/eros-nexus.git &quot;nexus&quot; --depth=1</code></p>
</li>
</ul>
<h3 id="合并-merge-amp-rebase"><a href="#合并-merge-amp-rebase" class="headerlink" title="合并 merge &amp; rebase"></a>合并 merge &amp; rebase</h3><ul>
<li><p><a href="https://git-scm.com/docs/git-merge">Git - git-merge Documentation</a></p>
<blockquote>
<p>If there were uncommitted worktree changes present when the merge started,<br><code>git merge --abort</code> will in some cases be unable to reconstruct these changes<br>It is therefore recommended to always commit or stash your changes before running git merge.</p>
</blockquote>
</li>
<li><p><a href="http://lemonup.logdown.com/posts/166352-git-merge-fast-forward-difference">Git merge 時使用 fast-forward 的差別</a></p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 我要新增一個功能，所以在master上開一個branch叫feature1。</span></span><br><span class="line"><span class="comment"># 我在新增功能時，加了3個commit在feature1中。</span></span><br><span class="line"><span class="comment"># 當功能開發完成時，checkout回master，要將 feature1合併回master，這時可以有兩個選擇：</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择1：master會將feature1上的3個commit全視為master的commit，並將HEAD移到跟feature1的HEAD相同的commit上。</span></span><br><span class="line">git merge --ff feature1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择2：master會新增一個commit，內容為feature1上的改變，並將HEAD移到新的commit上。</span></span><br><span class="line">git merge --no-ff feature1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 至於該使用哪種方式，就要看個人需求了，如果是新增功能的branch，個人認為使用non-fast-forward的方式比較好。</span></span><br><span class="line"><span class="comment"># 這樣可以很清楚的看出哪些是新增功能用的commit，哪些是原本master的commit。master才不會有太多不相干的commit交錯在一起。</span></span><br><span class="line"><span class="comment"># 而且master要移除功能時，也只要處理一個commit就可以了。</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://backlog.com/git-tutorial/cn/stepup/stepup1_4.html">分支的合并【分支】| 猴子都能懂的 GIT 入门 | 贝格乐（Backlog）</a></li>
</ul>
<h2 id="remove-untracked-files"><a href="#remove-untracked-files" class="headerlink" title="remove untracked files"></a>remove untracked files</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git clean -d -f</span><br><span class="line">$ git clean --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="https://stackoverflow.com/questions/61212/how-to-remove-local-untracked-files-from-the-current-git-working-tree">branch - How to remove local (untracked) files from the current Git working tree? - Stack Overflow</a></p>
</blockquote>
<h2 id="git-stash"><a href="#git-stash" class="headerlink" title="git stash"></a>git stash</h2><ul>
<li><p>Git 还提供了一个 stash 功能，可以把当前工作状态“储藏”起来，等以后恢复现场后继续工作。</p>
</li>
<li><p>查看 stash 的列表：<code>git stash list</code></p>
</li>
<li><p>恢复：<code>git stash pop</code> 或者 <code>git stash apply</code></p>
<blockquote>
<p>一是用 git stash apply 恢复，但是恢复后，stash 内容并不删除，你需要用 git stash drop 来删除；<br>另一种方式是用 git stash pop，恢复的同时把 stash 内容也删了：</p>
</blockquote>
</li>
<li><p>参考资料：<br><a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/00137602359178794d966923e5c4134bc8bf98dfb03aea3000">Bug 分支</a></p>
</li>
</ul>
<h2 id="添加注释的技巧"><a href="#添加注释的技巧" class="headerlink" title="添加注释的技巧"></a>添加注释的技巧</h2><p>参考<code>golang.org/x/net</code>的提交日志：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">* 92b859f - ipv6: update icmp parameters (4 days ago) &lt;Mikio Hara&gt;</span><br><span class="line">* 344b2e3 - ipv4: update icmp parameters (4 days ago) &lt;Mikio Hara&gt;</span><br><span class="line">* 08b7f81 - internal/iana: add address family number constants (4 days ago) &lt;Mikio Hara&gt;</span><br><span class="line">* a4c73ec - icmp: use subtests (4 days ago) &lt;Mikio Hara&gt;</span><br><span class="line">* 24dd378 - dns/dnsmessage: reject compressed SRV resource records (6 days ago) &lt;Ian Gudger&gt;</span><br><span class="line">* e0c57d8 - CONTRIBUTING.md: remove note about not accepting Pull Requests (9 days ago) &lt;Andrew Bonventre&gt;</span><br><span class="line">* 892bf7b - dns/dnsmessage: correctly handle multiple and &gt;255 byte TXT records (10 days ago) &lt;Ian Gudger&gt;</span><br><span class="line">* 803fdb9 - ipv4, ipv6, icmp, internal/socket: fix build on netbsd/arm (10 days ago) &lt;Mikio Hara&gt;</span><br><span class="line">* ae89d30 - route: avoid unnecessary <span class="built_in">type</span> conversions (12 days ago) &lt;namusyaka&gt;</span><br><span class="line">* d0aafc7 - trace: fix races on concurrent Trace method calls (2 weeks ago) &lt;David Howden&gt;</span><br></pre></td></tr></table></figure>

<p>名称最好简洁、准确，<br>可以总结：<code>模块: 动词 + 名词；</code><br>动词：</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">- </span>add</span><br><span class="line"><span class="bullet">- </span>update</span><br><span class="line"><span class="bullet">- </span>fix</span><br><span class="line"><span class="bullet">- </span>remove</span><br><span class="line"><span class="bullet">- </span>simply</span><br><span class="line"><span class="bullet">- </span>enable</span><br><span class="line"><span class="bullet">- </span>disable</span><br><span class="line"><span class="bullet">- </span>rename</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="delete-all-tags"><a href="#delete-all-tags" class="headerlink" title="delete all tags"></a><a href="https://stackoverflow.com/questions/19542301/delete-all-tags-from-a-git-repository">delete all tags</a></h2><p>To delete remote tags (before deleting local tags) simply do:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">tag</span> <span class="title">-l</span> | grep v2 -v | xargs -n <span class="number">1</span> git push --delete origin</span><br></pre></td></tr></table></figure>

<p>and then delete the local copies:</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">tag</span> <span class="title">-l</span> | grep v2 -v | xargs git <span class="keyword">tag</span> <span class="title">-d</span></span><br></pre></td></tr></table></figure>

<h2 id="How-do-you-rename-a-Git-tag"><a href="#How-do-you-rename-a-Git-tag" class="headerlink" title="How do you rename a Git tag?"></a><a href="https://stackoverflow.com/questions/1028649/how-do-you-rename-a-git-tag">How do you rename a Git tag?</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git tag new old</span><br><span class="line">git tag -d old</span><br><span class="line">git push origin :refs/tags/old</span><br><span class="line">git push --tags</span><br><span class="line"></span><br><span class="line">git pull --prune --tags <span class="comment"># Finally, make sure that the other users remove the deleted tag. Please tell them (co-workers) to run the following command</span></span><br></pre></td></tr></table></figure>

<h2 id="Remove-a-file-from-a-Git-repository-without-deleting-it-from-the-local-filesystem"><a href="#Remove-a-file-from-a-Git-repository-without-deleting-it-from-the-local-filesystem" class="headerlink" title="Remove a file from a Git repository without deleting it from the local filesystem"></a><a href="https://stackoverflow.com/questions/1143796/remove-a-file-from-a-git-repository-without-deleting-it-from-the-local-filesyste">Remove a file from a Git repository without deleting it from the local filesystem</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># For single file:</span></span><br><span class="line">git <span class="built_in">rm</span> --cached mylogfile.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># For single directory:</span></span><br><span class="line">git <span class="built_in">rm</span> --cached -r mydirectory</span><br></pre></td></tr></table></figure>

<h2 id="git-delete-remotes-remote-refs-do-not-exist-Stack-Overflow"><a href="#git-delete-remotes-remote-refs-do-not-exist-Stack-Overflow" class="headerlink" title="git delete remotes: remote refs do not exist - Stack Overflow"></a><a href="https://stackoverflow.com/questions/32147093/git-delete-remotes-remote-refs-do-not-exist">git delete remotes: remote refs do not exist - Stack Overflow</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># You may need to prune your local &quot;cache&quot; of remote branches first. Try running:</span></span><br><span class="line">git fetch -p origin</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">git fetch --prune origin</span><br></pre></td></tr></table></figure>

<h2 id="How-to-revert-multiple-git-commits-Stack-Overflow"><a href="#How-to-revert-multiple-git-commits-Stack-Overflow" class="headerlink" title="How to revert multiple git commits? - Stack Overflow"></a><a href="https://stackoverflow.com/questions/1463340/how-to-revert-multiple-git-commits">How to revert multiple git commits? - Stack Overflow</a></h2><p><em>Expanding what I wrote in a comment</em></p>
<p>The general rule is that you should not rewrite (change) history that you have published, because somebody might have based their work on it. If you rewrite (change) history, you would make problems with merging their changes and with updating for them.</p>
<p>So the solution is to create a <em>new commit</em> which <strong>reverts changes</strong> that you want to get rid of. You can do this using <a href="http://www.kernel.org/pub/software/scm/git/docs/git-revert.html">git revert</a> command.</p>
<p>You have the following situation:</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">A</span> &lt;<span class="literal">--</span> <span class="comment">B</span>  &lt;<span class="literal">--</span> <span class="comment">C</span> &lt;<span class="literal">--</span> <span class="comment">D</span>                                  &lt;<span class="literal">--</span> <span class="comment">master</span> &lt;<span class="literal">--</span> <span class="comment">HEAD</span></span><br></pre></td></tr></table></figure>

<p>(arrows here refers to the direction of the pointer: the “parent” reference in the case of commits, the top commit in the case of branch head (branch ref), and the name of branch in the case of HEAD reference).</p>
<p>What you need to create is the following:</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">A</span> &lt;<span class="literal">--</span> <span class="comment">B</span>  &lt;<span class="literal">--</span> <span class="comment">C</span> &lt;<span class="literal">--</span> <span class="comment">D</span> &lt;<span class="literal">--</span> <span class="title">[</span><span class="comment">(BCD)</span><span class="literal">-</span><span class="comment">1</span><span class="title">]</span>                   &lt;<span class="literal">--</span> <span class="comment">master</span> &lt;<span class="literal">--</span> <span class="comment">HEAD</span></span><br></pre></td></tr></table></figure>

<p>where <code>[(BCD)^-1]</code> means the commit that reverts changes in commits B, C, D. Mathematics tells us that (BCD)-1 = D-1 C-1 B-1, so you can get the required situation using the following commands:</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$</span> git revert --<span class="keyword">no</span>-commit D</span><br><span class="line"><span class="symbol">$</span> git revert --<span class="keyword">no</span>-commit C</span><br><span class="line"><span class="symbol">$</span> git revert --<span class="keyword">no</span>-commit B</span><br><span class="line"><span class="symbol">$</span> git commit -m <span class="string">&quot;the commit message for all of them&quot;</span></span><br></pre></td></tr></table></figure>

<p>Works for everything except merge commits.</p>
<hr>
<p>Alternate solution would be to <a href="http://git-scm.com/docs/git-checkout">checkout</a> <em>contents</em> of commit A, and commit this state. Also works with merge commits. Added files will not be deleted, however. If you have any local changes <code>git stash</code> them first:</p>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>git checkout -f A -- . <span class="comment"># checkout that revision over the top of local files</span></span><br><span class="line"><span class="variable">$ </span>git commit -a</span><br></pre></td></tr></table></figure>

<p>Then you would have the following situation:</p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">A</span> &lt;<span class="literal">--</span> <span class="comment">B</span>  &lt;<span class="literal">--</span> <span class="comment">C</span> &lt;<span class="literal">--</span> <span class="comment">D</span> &lt;<span class="literal">--</span> <span class="comment">A&#x27;</span>                       &lt;<span class="literal">--</span> <span class="comment">master</span> &lt;<span class="literal">--</span> <span class="comment">HEAD</span></span><br></pre></td></tr></table></figure>

<p>The commit A’ has the same contents as commit A, but is a different commit (commit message, parents, commit date).</p>
<hr>
<p>Alternate <a href="https://stackoverflow.com/questions/1463340/revert-multiple-git-commits/1463390#comment1312779_1463390">solution by Jeff Ferland, modified by Charles Bailey</a> builds upon the same idea, but uses <a href="https://www.kernel.org/pub/software/scm/git/docs/git-reset.html">git reset</a>. Here it is slightly modified, this way WORKS FOR EVERYTHING:</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ git <span class="keyword">reset</span> <span class="comment">--hard A</span></span><br><span class="line">$ git <span class="keyword">reset</span> <span class="comment">--soft D # (or ORIG_HEAD or @&#123;1&#125; [previous location of HEAD]), all of which are D</span></span><br><span class="line">$ git <span class="keyword">commit</span></span><br></pre></td></tr></table></figure>

<h2 id="统计"><a href="#统计" class="headerlink" title="统计"></a>统计</h2><p>统计 tag1 和 tag2 之间的行数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> tag1..tag2 --pretty=tformat: --numstat | gawk <span class="string">&#x27;&#123; add += $1 ; subs += $2 ; loc += $1 + $2 &#125; END &#123; printf &quot;added lines: %s removed lines : %s total lines: %s\n&quot;,add,subs,loc &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">git <span class="built_in">log</span> tag1..tag2 --pretty=tformat: --numstat | awk <span class="string">&#x27;&#123; add += $1 ; subs += $2 ; loc += $1 + $2 &#125; END &#123; printf &quot;added lines: %s removed lines : %s total lines: %s\n&quot;,add,subs,loc &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>统计某个人修改的代码行数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 当前作者</span></span><br><span class="line">git <span class="built_in">log</span> --author=<span class="string">&quot;<span class="subst">$(git config --get user.name)</span>&quot;</span> --pretty=tformat: --numstat | gawk <span class="string">&#x27;&#123; add += $1 ; subs += $2 ; loc += $1 + $2 &#125; END &#123; printf &quot;added lines: %s removed lines : %s total lines: %s\n&quot;,add,subs,loc &#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者修改 username 为此人名字</span></span><br><span class="line">git <span class="built_in">log</span> --author=<span class="string">&quot;username&quot;</span> --pretty=tformat: --numstat | awk <span class="string">&#x27;&#123; add += $1; subs += $2; loc += $1 - $2 &#125; END &#123; printf &quot;added lines: %s, removed lines: %s, total lines: %s\n&quot;, add, subs, loc &#125;&#x27;</span> -</span><br></pre></td></tr></table></figure>

<p>按个人分别统计</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> --format=<span class="string">&#x27;%aN&#x27;</span> | <span class="built_in">sort</span> -u | <span class="keyword">while</span> <span class="built_in">read</span> name; <span class="keyword">do</span> <span class="built_in">echo</span> -en <span class="string">&quot;<span class="variable">$name</span>\t&quot;</span>; git <span class="built_in">log</span> --author=<span class="string">&quot;<span class="variable">$name</span>&quot;</span> --pretty=tformat: --numstat | awk <span class="string">&#x27;&#123; add += $1; subs += $2; loc += $1 - $2 &#125; END &#123; printf &quot;added lines: %s, removed lines: %s, total lines: %s\n&quot;, add, subs, loc &#125;&#x27;</span> -; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>统计总行数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span>  --pretty=tformat: --numstat | awk <span class="string">&#x27;&#123; add += $1; subs += $2; loc += $1 - $2 &#125; END &#123; printf &quot;added lines: %s, removed lines: %s, total lines: %s\n&quot;, add, subs, loc &#125;&#x27;</span> -</span><br></pre></td></tr></table></figure>

<p>按时间范围统计个人行数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> --since=<span class="string">&quot;2020-01-08&quot;</span> --before=<span class="string">&quot;2021-11-14&quot;</span> --author=<span class="string">&quot;lilou&quot;</span> \</span><br><span class="line">--pretty=tformat: --numstat | awk <span class="string">&#x27;&#123; add += $1; subs += $2; loc += $1 - $2 &#125; END &#123; printf &quot;新增行数: %s, 移除行数: %s, 总行数: %s\n&quot;, add, subs, loc &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>仓库提交排名</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> --pretty=<span class="string">&#x27;%aN&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -k1 -n -r | <span class="built_in">head</span> -n 5</span><br></pre></td></tr></table></figure>

<p>贡献者统计</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> --pretty=<span class="string">&#x27;%aN&#x27;</span> | <span class="built_in">sort</span> -u | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure>
<p>提交数统计</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> --oneline | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://blog.csdn.net/JiangJsf/article/details/83686749">git 统计两个不同版本代码修改行数_JiangJsf 的博客-CSDN 博客</a></li>
<li><a href="https://blog.csdn.net/qinchao_mei/article/details/112172432">GIT 统计代码量及 IDEA Statistic 统计解析_超人不会飞-CSDN 博客</a></li>
</ul>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><p>《GitHub 入门与实践》</p>
</li>
<li><p><a href="http://mp.weixin.qq.com/s?__biz=MzA4MjU5NTY0NA==&mid=401074259&idx=1&sn=6e69ce5338eb5d9212953068165c1cd0&mpshare=1&scene=23&srcid=1122laeBDuW58x2VncUQ44xs">10 组最常用 Git 命令</a></p>
</li>
<li><p><a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000">Git 教程-廖雪峰</a></p>
</li>
<li><p><a href="http://www.ruanyifeng.com/blog/2014/06/git_remote.html">Git 远程操作详解</a></p>
</li>
<li><p><a href="https://github.com/doggy8088/Learn-Git-in-30-days/blob/master/zh-tw/30.md">第 30 天：分享工作中幾個好用的 Git 操作技巧</a></p>
</li>
<li><p><a href="http://www.cnblogs.com/hutaoer/archive/2013/05/14/3078191.html">^和~的区别</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">- `^`代表父提交,当一个提交有多个父提交时，可以通过在`^`后面跟上一个数字，表示第几个父提交，`^`相当于`^1`</span><br><span class="line">- `~`&lt;n&gt;相当于连续的&lt;n&gt;个`^`.</span><br><span class="line">- checkout只会移动HEAD指针，reset会改变HEAD的引用值</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>Git坑</title>
    <url>/git/git%E5%9D%91/</url>
    <content><![CDATA[<h2 id="上传到远程仓库的文件再次改名-大小写-不生效"><a href="#上传到远程仓库的文件再次改名-大小写-不生效" class="headerlink" title="上传到远程仓库的文件再次改名(大小写)不生效"></a>上传到远程仓库的文件再次改名(大小写)不生效</h2><p><a href="https://juejin.im/post/5bbdc1ff6fb9a05d011cfe66">https://juejin.im/post/5bbdc1ff6fb9a05d011cfe66</a></p>
<p>配置 <code>git config core.ignorecase false --global</code>，大小写默认不敏感</p>
<h2 id="在-gitmodules中找不到路径的子模块映射-缺少-gitmodules文件"><a href="#在-gitmodules中找不到路径的子模块映射-缺少-gitmodules文件" class="headerlink" title="在.gitmodules中找不到路径的子模块映射,缺少.gitmodules文件"></a>在.gitmodules中找不到路径的子模块映射,缺少.gitmodules文件</h2><p><a href="https://codeday.me/bug/20170816/58438.html">https://codeday.me/bug/20170816/58438.html</a><br><a href="https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97">Git - 子模块</a></p>
<p>首先移除模块依赖，<br><code>git rm --cached library/algs4</code><br>其次重新添加模块依赖<br><code>git submodule add https://github.com/lyloou/algs4 library/algs4</code></p>
]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>Git配置</title>
    <url>/git/git%E7%9A%84%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="设置用户名和邮箱"><a href="#设置用户名和邮箱" class="headerlink" title="设置用户名和邮箱"></a>设置用户名和邮箱</h2><figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">$ git <span class="keyword">config</span> --<span class="keyword">global</span> user<span class="variable">.name</span> <span class="string">&quot;Lou&quot;</span></span><br><span class="line">$ git <span class="keyword">config</span> --<span class="keyword">global</span> user<span class="variable">.email</span> <span class="string">&quot;lyloou6@gmail.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看用户的配置信息</span></span><br><span class="line">$ git <span class="keyword">config</span> user<span class="variable">.name</span></span><br><span class="line">$ git <span class="keyword">config</span> user<span class="variable">.email</span></span><br></pre></td></tr></table></figure>

<h2 id="保存-push-时的用户名和密码"><a href="#保存-push-时的用户名和密码" class="headerlink" title="保存 push 时的用户名和密码"></a>保存 push 时的用户名和密码</h2><p>针对 http 协议的也可以不用总是输入用户名密码那么麻烦，如：<code>https://github.com/lyloou/hexo.git</code>，<br>可以通过设置<code>credential.help</code>来保存。</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">git config --<span class="keyword">global</span> credential.helper <span class="keyword">store</span></span><br></pre></td></tr></table></figure>

<h2 id="同时同步多个远程分支"><a href="#同时同步多个远程分支" class="headerlink" title="同时同步多个远程分支"></a>同时同步多个远程分支</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git config -–add remote.all.url  http://domain1.com/repo.git</span><br><span class="line">git config -–add remote.all.url  http://domain2.com/repo.git</span><br><span class="line"></span><br><span class="line">git push all master</span><br><span class="line">git push all develop</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://howto.lintel.in/git-how-to-push-code-to-multiple-remotes-simultaneously/">GIT - How to push code to multiple remotes simultaneously - Lintel Technologies Blog</a></li>
</ul>
<h2 id="网络配置："><a href="#网络配置：" class="headerlink" title="网络配置："></a>网络配置：</h2><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">git config <span class="attr">--global</span> http<span class="selector-class">.proxy</span> <span class="string">&#x27;socks5://127.0.0.1:1080&#x27;</span></span><br><span class="line">git config <span class="attr">--global</span> https<span class="selector-class">.proxy</span> <span class="string">&#x27;socks5://127.0.0.1:1080&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://gist.github.com/laispace/666dd7b27e9116faece6">git 设置和取消代理</a></li>
</ul>
<p>或：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">git config <span class="attr">--global</span> http<span class="selector-class">.proxy</span> http:<span class="comment">//127.0.0.1:8118</span></span><br><span class="line">git config <span class="attr">--global</span> https<span class="selector-class">.proxy</span> https:<span class="comment">//127.0.0.1:8118</span></span><br></pre></td></tr></table></figure>

<p><a href="https://tzrgaga.github.io/2017/04/12/forward-socks-by-privoxy/">Windows 下使用 Privoxy 转换 socks5 代理为 Http 代理 | 小田的 blog</a></p>
<h2 id="配置别名"><a href="#配置别名" class="headerlink" title="配置别名"></a>配置别名</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 显示漂亮的分支日志：git lg</span></span><br><span class="line">git config --<span class="variable language_">global</span> alias.<span class="property">lg</span> <span class="string">&quot;log --color --graph --pretty=format:&#x27;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&#x27; --abbrev-commit&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="解除上传文件大小限制"><a href="#解除上传文件大小限制" class="headerlink" title="解除上传文件大小限制"></a>解除上传文件大小限制</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">git config http.<span class="property">postBuffer</span> <span class="number">524288000</span></span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/zhiyuan_x/article/details/72954729">https://blog.csdn.net/zhiyuan_x/article/details/72954729</a></p>
<h2 id="行尾结束符自动转换问题"><a href="#行尾结束符自动转换问题" class="headerlink" title="行尾结束符自动转换问题"></a>行尾结束符自动转换问题</h2><p><code>warning: LF will be replaced by CRLF in xx.txt</code><br>如果项目的文件是依照文件的 md5 来作为标识，那么提交代码到远程仓库，文件的行尾结束符会自动发生改变，那么之前的 md5 标识就发挥不到作用<br>（这样的 bug 很难找），这时候就需要取消 git 的行尾结束符自动转换功能；</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ git config --global core.autocrlf <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://git-scm.com/book/zh/v1/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-%E9%85%8D%E7%BD%AE-Git#%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8E%E7%A9%BA%E7%99%BD">Git - 配置 Git</a></li>
<li><a href="https://stackoverflow.com/questions/5834014/lf-will-be-replaced-by-crlf-in-git-what-is-that-and-is-it-important">https://stackoverflow.com/questions/5834014/lf-will-be-replaced-by-crlf-in-git-what-is-that-and-is-it-important</a></li>
</ul>
<h2 id="gitignore-文件"><a href="#gitignore-文件" class="headerlink" title=".gitignore 文件"></a>.gitignore 文件</h2><h3 id="package-json和-package-json两种表示方式的区别"><a href="#package-json和-package-json两种表示方式的区别" class="headerlink" title="package.json和/package.json两种表示方式的区别"></a><code>package.json</code>和<code>/package.json</code>两种表示方式的区别</h3><ul>
<li>前者是所有目录中的 <code>package.json</code>文件都被忽略；</li>
<li>后者是只有当前目录的 <code>package.json</code>文件被忽略；</li>
</ul>
<h2 id="Prevent-commits-in-master-or-develop-branch"><a href="#Prevent-commits-in-master-or-develop-branch" class="headerlink" title="Prevent commits in master or develop branch"></a><a href="https://stackoverflow.com/questions/40462111/git-prevent-commits-in-master-branch">Prevent commits in master or develop branch</a></h2><ol>
<li>Go to your repository.</li>
<li>Create file .git/hooks/pre-commit with following content:</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">branch=<span class="string">&quot;<span class="subst">$(git rev-parse --abbrev-ref HEAD)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$branch</span>&quot;</span> = <span class="string">&quot;develop&quot;</span> -o <span class="string">&quot;<span class="variable">$branch</span>&quot;</span> = <span class="string">&quot;master&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;You can&#x27;t commit directly to master or develop branch&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Make it executable (not required on Windows):</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">chmod</span> +x .git/hooks/pre-commit</span></span><br></pre></td></tr></table></figure>

<p>To disable fast-forwad merges you must also add following option to your .git/config file:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[branch &quot;master&quot;]</span></span><br><span class="line">    <span class="attr">mergeoptions</span> = --<span class="literal">no</span>-ff</span><br></pre></td></tr></table></figure>

<p>If you want also protect master branch on your remote, check this answer: <a href="https://stackoverflow.com/questions/38864405/how-to-restrict-access-to-master-branch-on-git">How to restrict access to master branch on git</a></p>
<h2 id="NOTE"><a href="#NOTE" class="headerlink" title="NOTE"></a>NOTE</h2><ul>
<li>配置 Git 的时候，加上–global 是针对当前用户起作用的，如果不加，那只针对当前的仓库起作用。</li>
<li>可以通过配置<code>~/.gitconfig</code>文件来删除和修改配置</li>
</ul>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="https://segmentfault.com/a/1190000002645623">git-ssh 配置和使用</a></li>
<li><a href="https://help.github.com/articles/which-remote-url-should-i-use/">Which remote URL should I use?</a></li>
<li><a href="gitignore.io">gitignore.io</a></li>
</ul>
]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>Git服务器搭建（windows平台）</title>
    <url>/git/git%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%EF%BC%88windows%E5%B9%B3%E5%8F%B0%EF%BC%89/</url>
    <content><![CDATA[<h2 id="以GitBlit来讲解"><a href="#以GitBlit来讲解" class="headerlink" title="以GitBlit来讲解"></a>以GitBlit来讲解</h2><ol>
<li>安装Java；</li>
<li>配置Java的环境变量；</li>
<li>下载并安装<a href="http://www.gitblit.com/">GitBlit</a></li>
<li>配置GitBlit（以1.8.0为例）:</li>
</ol>
<ul>
<li>打开配置文件：<code>C:\Git\gitblit-1.8.0\data\defaults.properties</code></li>
<li>修改资料库路径（也可以使用默认的）：<code>git.repositoriesFolder = C:\\Git\\GitRepository</code></li>
<li>修改http协议端口：<code>server.httpPort = 10108</code></li>
<li>设定服务器http地址：<code>server.httpBindInterface = 192.168.0.30</code></li>
<li>设定服务器https地址：<code>server.httpsBindInterface = localhost</code></li>
<li>保存并关闭文件；</li>
<li>运行服务器，双击打开：<code>gitblit.bat</code></li>
</ul>
<ol start="5">
<li>浏览器中打开GitBlit：<code>http://192.168.0.30:10108</code></li>
<li>作为服务自动运行在后台：</li>
</ol>
<ul>
<li>打开<code>installService.bat</code>文件；</li>
<li>根据系统环境配置ARCH：<code>SET ARCH=amd64</code></li>
<li>设置程序目录：<code>C:\\Git\\gitblit-1.8.0</code></li>
<li>设置启动参数：<code>--StartParams=&quot;&quot;</code></li>
<li>关闭bat文件，并以管理员身份运行；</li>
<li>查看服务是否安装成功：Win+R，输入<code>services.msc</code>，找得到gitbit服务；</li>
<li>启动gitbit服务；</li>
</ul>
<ol start="7">
<li>再次在浏览器中验证是否安装成功；</li>
<li>登陆：账号密码默认均为<code>admin</code></li>
</ol>
<h2 id="其它-git-服务"><a href="#其它-git-服务" class="headerlink" title="其它 git 服务"></a>其它 git 服务</h2><ul>
<li><a href="https://gitlab.com/">gitlab</a></li>
<li><a href="https://github.com/gogits/gogs">gogs</a></li>
</ul>
<hr>
<h2 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h2><ul>
<li><a href="http://www.cnblogs.com/ucos/p/3924720.html">Windows平台下Git服务器搭建</a></li>
</ul>
]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>Beego相关</title>
    <url>/go/beego/</url>
    <content><![CDATA[<p>Go语言里面提供了一个完善的net/http包，通过http包可以很方便的就搭建起来一个可以运行的Web服务。<br>同时使用这个包能很简单地对Web的路由，静态文件，模版，cookie等数据进行设置和操作。</p>
<p>万变不离其宗，Go的Web服务工作也离不开我们第一小节介绍的Web工作方式。</p>
<p>Go为了实现高并发和高性能, 使用了goroutines来处理Conn的读写事件, 这样每个请求都能保持独立，相互不会阻塞，可以高效的响应网络事件。这是Go高效的保证。<br><a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/03.4.md">https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/03.4.md</a></p>
<h2 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line">qs = o.QueryTable(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> pageSize = <span class="number">50</span> <span class="comment">// 一页50条</span></span><br><span class="line"><span class="keyword">var</span> pageNo = <span class="number">3</span> <span class="comment">// 准备取第三页</span></span><br><span class="line"><span class="comment">// qs.Limit(&quot;[取多少个]&quot;,&quot;[偏移行数]&quot;);</span></span><br><span class="line">qs = qs.Limit(pageSize, pageNo*pageSize) <span class="comment">// 请注意和MySQL语法的区别：LIMIT 50*3, 50</span></span><br></pre></td></tr></table></figure>
<ul>
<li><a href="http://qimo601.iteye.com/blog/1634748">Mysql 分页语句Limit用法 - 柳北风儿~~~~~~~欲宇仙炅 - ITeye博客</a></li>
</ul>
<h2 id="解析-orm-Params"><a href="#解析-orm-Params" class="headerlink" title="解析[]orm.Params"></a>解析<code>[]orm.Params</code></h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">analyseParams</span><span class="params">(params *[]orm.Params)</span></span> &#123;</span><br><span class="line">    keyImage := <span class="string">&quot;image&quot;</span></span><br><span class="line">    keyStatus := <span class="string">&quot;status&quot;</span></span><br><span class="line">    keyEndAt := <span class="string">&quot;end_at&quot;</span></span><br><span class="line">    <span class="keyword">for</span> _, param := <span class="keyword">range</span> *params &#123;</span><br><span class="line">        <span class="comment">// replace image</span></span><br><span class="line">        <span class="keyword">if</span> vv, ok := param[keyImage]; ok &#123;</span><br><span class="line">            r := reflect.ValueOf(vv)</span><br><span class="line">            <span class="keyword">if</span> r.Kind() == reflect.String &#123;</span><br><span class="line">                temp_arr := strings.Split(r.String(), <span class="string">&quot;,&quot;</span>)</span><br><span class="line">                param[keyImage] = commons.ImagePath(temp_arr[<span class="number">0</span>])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// add status</span></span><br><span class="line">        <span class="keyword">if</span> vv, ok := param[keyEndAt]; ok &#123;</span><br><span class="line">            r := reflect.ValueOf(vv)</span><br><span class="line">            <span class="keyword">if</span> r.Kind() == reflect.String &#123;</span><br><span class="line">                now := time.Now().UnixNano()</span><br><span class="line">                startTime, err := time.Parse(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>, r.String())</span><br><span class="line">                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">                    logs.Error(<span class="string">&quot;转换时间错误：&quot;</span>, err)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> startTime.UnixNano() &gt; now &#123;</span><br><span class="line">                    param[keyStatus] = <span class="string">&quot;notbegin&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// delete marketable_at</span></span><br><span class="line">        <span class="built_in">delete</span>(params, <span class="string">&quot;marketable_at&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>go</tag>
        <tag>beego</tag>
      </tags>
  </entry>
  <entry>
    <title>Go中的网络请求和数据转发</title>
    <url>/go/get%E5%92%8Cpost/</url>
    <content><![CDATA[<h2 id="GET-amp-POST-请求和转发"><a href="#GET-amp-POST-请求和转发" class="headerlink" title="GET &amp; POST 请求和转发"></a>GET &amp; POST 请求和转发</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> cfg = beego.AppConfig</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> AddressController <span class="keyword">struct</span> &#123;</span><br><span class="line">        baseController</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ac AddressController)</span></span> Address() &#123;</span><br><span class="line">    userId := ac.GetString(<span class="string">&quot;user_id&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> url = cfg.String(<span class="string">&quot;third::user_url&quot;</span>) + <span class="string">&quot;/user/address?user_id=&quot;</span> + userId</span><br><span class="line">    body, err := get(url)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        logs.Error(<span class="string">&quot;get Address error:&quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    ac.Data[<span class="string">&quot;json&quot;</span>] = <span class="type">string</span>(body)</span><br><span class="line">    ac.ServeJSON()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ac AddressController)</span></span> AddAddress() &#123;</span><br><span class="line">    userId := ac.GetString(<span class="string">&quot;user_id&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> url = cfg.String(<span class="string">&quot;third::user_url&quot;</span>) + <span class="string">&quot;/user/add_address?user_id=&quot;</span> + userId</span><br><span class="line"></span><br><span class="line">    body, err := post(url, ac.Ctx.Input.RequestBody)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        logs.Error(<span class="string">&quot;post AddAddress error:&quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    ac.Data[<span class="string">&quot;json&quot;</span>] = <span class="type">string</span>(body)</span><br><span class="line">    ac.ServeJSON()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(url <span class="type">string</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    resp, err := http.Get(url)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">    <span class="keyword">return</span> ioutil.ReadAll(resp.Body)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">post</span><span class="params">(url <span class="type">string</span>, data []<span class="type">byte</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    body := bytes.NewBuffer(data)</span><br><span class="line">    resp, err := http.Post(url, <span class="string">&quot;application/json;charset=utf-8&quot;</span>, body)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">    <span class="keyword">return</span> ioutil.ReadAll(resp.Body)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://blog.csdn.net/typ2004/article/details/38669949">Golang Web编程的Get和Post请求发送与解析</a></li>
</ul>
]]></content>
      <tags>
        <tag>go</tag>
        <tag>beego</tag>
      </tags>
  </entry>
  <entry>
    <title>【Go】三方库</title>
    <url>/go/%E4%B8%89%E6%96%B9%E5%BA%93/</url>
    <content><![CDATA[<ul>
<li><p><a href="https://gorm.io/">GORM - The fantastic ORM library for Golang, aims to be developer friendly.</a></p>
</li>
<li><p>beego</p>
</li>
</ul>
]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>Go代码片段</title>
    <url>/go/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/</url>
    <content><![CDATA[<h2 id="初始值"><a href="#初始值" class="headerlink" title="初始值"></a>初始值</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Na <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Ia <span class="keyword">interface</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> e <span class="type">error</span></span><br><span class="line">    <span class="keyword">var</span> na Na</span><br><span class="line">    <span class="keyword">var</span> ia Ia</span><br><span class="line">    fmt.Println(na, e, ia)</span><br><span class="line"></span><br><span class="line">    n := <span class="built_in">new</span>(Na)</span><br><span class="line">    i := <span class="built_in">new</span>(Ia)</span><br><span class="line">    fmt.Println(n, i)</span><br><span class="line"></span><br><span class="line">    c := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line">    fmt.Println(c)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* output:</span></span><br><span class="line"><span class="comment">&#123;&#125; &lt;nil&gt; &lt;nil&gt;</span></span><br><span class="line"><span class="comment">&amp;&#123;&#125; 0xc042008270</span></span><br><span class="line"><span class="comment">[0 0]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h2 id="make-和-new"><a href="#make-和-new" class="headerlink" title="make 和 new"></a>make 和 new</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> v = <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">v[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">v[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">v[<span class="number">2</span>] = <span class="number">2</span></span><br><span class="line">v[<span class="number">9</span>] = <span class="number">32</span></span><br><span class="line">v = v[:<span class="built_in">cap</span>(v)]  <span class="comment">// We can grow s to its capacity by slicing it again  https://blog.golang.org/go-slices-usage-and-internals</span></span><br><span class="line">v[<span class="number">10</span>] = <span class="number">33</span></span><br><span class="line">fmt.Println(v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> n = <span class="built_in">new</span>([]<span class="type">byte</span>)</span><br><span class="line">n = &amp;v</span><br><span class="line">fmt.Println(*n)</span><br><span class="line"><span class="comment">/* output:</span></span><br><span class="line"><span class="comment">[0 1 2 0 0 0 0 0 0 32 33 0 0 0 0]</span></span><br><span class="line"><span class="comment">[0 1 2 0 0 0 0 0 0 32 33 0 0 0 0]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="How-to-check-if-a-map-contains-a-key-in-go"><a href="#How-to-check-if-a-map-contains-a-key-in-go" class="headerlink" title="How to check if a map contains a key in go?"></a><a href="https://stackoverflow.com/questions/2050391/how-to-check-if-a-map-contains-a-key-in-go">How to check if a map contains a key in go?</a></h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> val, ok := dict[<span class="string">&quot;foo&quot;</span>]; ok &#123;</span><br><span class="line">    <span class="comment">//do something here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Removing-item-s-from-a-slice-while-iterating-in-Go"><a href="#Removing-item-s-from-a-slice-while-iterating-in-Go" class="headerlink" title="Removing item(s) from a slice, while iterating in Go"></a><a href="https://vbauerster.github.io/2017/04/removing-items-from-a-slice-while-iterating-in-go/">Removing item(s) from a slice, while iterating in Go</a></h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    arr := []<span class="type">int64</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">23</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="built_in">len</span>(arr) - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">     <span class="keyword">if</span> arr[i]%<span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">      arr = <span class="built_in">append</span>(arr[:i], arr[i+<span class="number">1</span>:]...)</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(arr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="过滤selected为false的商品规格"><a href="#过滤selected为false的商品规格" class="headerlink" title="过滤selected为false的商品规格"></a>过滤selected为false的商品规格</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方案1 </span></span><br><span class="line">specProps := product.SpecProps</span><br><span class="line">spec := models.Spec&#123;&#125;</span><br><span class="line">err := json.Unmarshal([]<span class="type">byte</span>(specProps), &amp;spec)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">    sItem := <span class="built_in">make</span>([]models.SpecChildren, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> spec.Spec &#123;</span><br><span class="line">        scItem := <span class="built_in">make</span>([]models.SpecChildrenItem, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> _, vv := <span class="keyword">range</span> v.Children &#123;</span><br><span class="line">            <span class="keyword">if</span> vv.Selected &#123;</span><br><span class="line">                vv.Selected = <span class="literal">false</span></span><br><span class="line">                scItem = <span class="built_in">append</span>(scItem, vv)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        v.Children = scItem</span><br><span class="line">        sItem = <span class="built_in">append</span>(sItem, v)</span><br><span class="line">    &#125;</span><br><span class="line">    spec.Spec = sItem</span><br><span class="line"></span><br><span class="line">    data, err := json.Marshal(spec)</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        product.SpecProps = <span class="type">string</span>(data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方案2</span></span><br><span class="line">specProps := product.SpecProps</span><br><span class="line">spec := models.Spec&#123;&#125;</span><br><span class="line">err := json.Unmarshal([]<span class="type">byte</span>(specProps), &amp;spec)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="built_in">len</span>(spec.Spec); j++ &#123;</span><br><span class="line">        v := &amp;spec.Spec[j] <span class="comment">// Note: need pointer</span></span><br><span class="line">        <span class="keyword">for</span> i := <span class="built_in">len</span>(v.Children) - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">            <span class="keyword">if</span> !v.Children[i].Selected &#123;</span><br><span class="line">                <span class="comment">// https://vbauerster.github.io/2017/04/removing-items-from-a-slice-while-iterating-in-go/</span></span><br><span class="line">                v.Children = <span class="built_in">append</span>(v.Children[:i], v.Children[i+<span class="number">1</span>:]...)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    specData, err := json.Marshal(spec)</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        product.SpecProps = <span class="type">string</span>(specData)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Converting-Go-struct-to-JSON"><a href="#Converting-Go-struct-to-JSON" class="headerlink" title="Converting Go struct to JSON"></a><a href="https://stackoverflow.com/questions/8270816/converting-go-struct-to-json">Converting Go struct to JSON</a></h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    user := &amp;User&#123;name:<span class="string">&quot;Frank&quot;</span>&#125;</span><br><span class="line">    b, err := json.Marshal(user)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;Error: %s&quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="type">string</span>(b))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Go-json-Unmarshal-array"><a href="#Go-json-Unmarshal-array" class="headerlink" title="Go json.Unmarshal array"></a>Go json.Unmarshal array</h2><ul>
<li><a href="https://coderwall.com/p/4c2zig/decode-top-level-json-array-into-a-slice-of-structs-in-golang">Decode top level JSON array into a slice of structs in golang</a><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PublicKey <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id <span class="type">int</span></span><br><span class="line">    Key <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> KeysResponse <span class="keyword">struct</span> &#123;</span><br><span class="line">    Collection []PublicKey</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    keysBody := []<span class="type">byte</span>(<span class="string">`[&#123;&quot;id&quot;: 1,&quot;key&quot;: &quot;-&quot;&#125;,&#123;&quot;id&quot;: 2,&quot;key&quot;: &quot;-&quot;&#125;,&#123;&quot;id&quot;: 3,&quot;key&quot;: &quot;-&quot;&#125;]`</span>)</span><br><span class="line">    keys := <span class="built_in">make</span>([]PublicKey,<span class="number">0</span>)</span><br><span class="line">    json.Unmarshal(keysBody, &amp;keys)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%#v&quot;</span>, keys)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>Go命令行工具</title>
    <url>/go/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<h2 id="The-Command"><a href="#The-Command" class="headerlink" title="The Command"></a>The Command</h2><ul>
<li>通过 <code>go build</code> 来编译，<a href="http://wiki.jikexueyuan.com/project/go-command-tutorial/0.1.html">可以来检验 lib 函数是否有错误，不会生成文件到 pkg 中去。</a></li>
<li>在执行 <code>go install</code> 的时候，才会生成到 pkg 中。</li>
<li><code>go env GOPATH</code> prints the effective current GOPATH; it prints the default location if the environment variable is unset.</li>
</ul>
<h2 id="标准命令详解"><a href="#标准命令详解" class="headerlink" title="标准命令详解"></a><a href="http://wiki.jikexueyuan.com/project/go-command-tutorial/0.0.html">标准命令详解</a></h2><h2 id="go-How-to-get-all-dependency-files-for-a-program-using-Golang-Stack-Overflow"><a href="#go-How-to-get-all-dependency-files-for-a-program-using-Golang-Stack-Overflow" class="headerlink" title="go - How to get all dependency files for a program using Golang - Stack Overflow"></a><a href="https://stackoverflow.com/questions/32758235/how-to-get-all-dependency-files-for-a-program-using-golang">go - How to get all dependency files for a program using Golang - Stack Overflow</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go get -d -v ./...</span><br></pre></td></tr></table></figure>
<p><code>...</code> is a special pattern, tells to go down recursively</p>
<h2 id="格式化整个目录"><a href="#格式化整个目录" class="headerlink" title="格式化整个目录"></a>格式化整个目录</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gofmt -w -l src</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>Go基础理论</title>
    <url>/go/%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA/</url>
    <content><![CDATA[<h2 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h2><p>简洁 快速 安全<br>并行 有趣 开源<br>内存管理，数组安全，编译迅速</p>
<h2 id="可执行文件"><a href="#可执行文件" class="headerlink" title="可执行文件"></a>可执行文件</h2><p>Executable commands must always use <code>package main</code>， <a href="https://golang.org/doc/code.html#PackageNames">https://golang.org/doc/code.html#PackageNames</a><br><code>package main</code> 包表示它是一个可独立运行的包，它在编译后会产生可执行文件。<br><a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/02.1.md#%E8%AF%A6%E8%A7%A3">https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/02.1.md#详解</a><br>除了main包之外，其它的包最后都会生成*.a文件（也就是包文件）并放置在$GOPATH/pkg/$GOOS_$GOARCH中</p>
<blockquote>
<p>每一个可独立运行的Go程序，必定包含一个package main，在这个main包中必定包含一个入口函数main，而这个函数既没有参数，也没有返回值。</p>
</blockquote>
<p>Go使用package（和Python的模块类似）来组织代码。main.main()函数(这个函数位于主包）是每一个独立的可运行程序的入口点。Go使用UTF-8字符串和标识符(因为UTF-8的发明者也就是Go的发明者之一)，所以它天生支持多语言。</p>
<h2 id="import"><a href="#import" class="headerlink" title="import"></a><a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/02.3.md#import">import</a></h2><ul>
<li>点操作</li>
<li>别名操作</li>
<li><code>_</code>操作</li>
</ul>
<h2 id="变量和常量"><a href="#变量和常量" class="headerlink" title="变量和常量"></a>变量和常量</h2><p>常量使用关键字<code>const</code>表示，不可用<code>:=</code>语法定义。<br>var 语句定义了一个变量列表；<br>进一步阅读： <a href="https://blog.golang.org/gos-declaration-syntax">https://blog.golang.org/gos-declaration-syntax</a></p>
<p><code>:=</code>这个符号直接取代了var和type,这种形式叫做简短声明。不过它有一个限制，那就是它只能用在函数内部；<br>在函数外部使用则会无法编译通过，所以一般用var方式来定义全局变量。<br><code>_</code>（下划线）是个特殊的变量名，任何赋予它的值都会被丢弃。    </p>
<h2 id="零值："><a href="#零值：" class="headerlink" title="零值："></a>零值：</h2><p>数值：0<br>布尔：false<br>指针：nil</p>
<h2 id="指针："><a href="#指针：" class="headerlink" title="指针："></a>指针：</h2><p><code>&amp;</code> 符号会生成一个指向其作用对象的指针；<br><code>*</code> 符号表示指针指向的底层的值；</p>
<h2 id="那么到底传指针有什么好处呢？"><a href="#那么到底传指针有什么好处呢？" class="headerlink" title="那么到底传指针有什么好处呢？"></a>那么到底传指针有什么好处呢？</h2><p>传指针使得多个函数能操作同一个对象。<br>传指针比较轻量级 (8bytes),只是传内存地址，我们可以用指针传递体积大的结构体。如果用参数值传递的话, 在每次copy上面就会花费相对较多的系统开销（内存和时间）。所以当你要传递大的结构体的时候，用指针是一个明智的选择。<br>Go语言中channel，slice，map这三种类型的实现机制类似指针，所以可以直接传递，而不用取地址后传递指针。（注：若函数需改变slice的长度，则仍需要取地址传递指针）</p>
<h2 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h2><p>slice 只能和nil 进行<code>==</code>比较。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">c := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line">fmt.Println(<span class="built_in">len</span>(c), c == <span class="literal">nil</span>)</span><br><span class="line">c = <span class="literal">nil</span></span><br><span class="line">fmt.Println(<span class="built_in">len</span>(c), c == <span class="literal">nil</span>)</span><br><span class="line"><span class="comment">// Output:</span></span><br><span class="line"><span class="comment">// 0, false</span></span><br><span class="line"><span class="comment">// 0, true</span></span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://yar999.gitbooks.io/gopl-zh/content/ch4/ch4-02.html">https://yar999.gitbooks.io/gopl-zh/content/ch4/ch4-02.html</a></li>
<li><a href="https://github.com/golang/go/wiki/SliceTricks">https://github.com/golang/go/wiki/SliceTricks</a></li>
</ul>
<h2 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h2><p>Go没有类。然而，仍然可以在结构体类型上定义方法。<br>一个结构体（struct）就是一个字段的集合</p>
<p><a href="https://yar999.gitbooks.io/gopl-zh/content/ch4/ch4-04.html">一个命名为S的结构体类型将不能再包含S类型的成员</a></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> S <span class="keyword">struct</span> &#123;</span><br><span class="line">	SS S <span class="comment">// error: invalid recursive type S </span></span><br><span class="line">	II <span class="type">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是S类型的结构体可以包含*S指针类型的成员，这可以让我们创建递归的数据结构，比如链表和树结构等。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> S <span class="keyword">struct</span> &#123;</span><br><span class="line">	SS *S <span class="comment">// ok </span></span><br><span class="line">	II <span class="type">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>匿名结构体中，<br>引用时可以直接访问子属性，而不需要给出完整的路径<br>但结构体字面值必须遵循形状类型声明时的结构</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Point <span class="keyword">struct</span> &#123;</span><br><span class="line">但结构体字面值必须遵循形状类型声明时的结构</span><br><span class="line">    X, Y <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Circle <span class="keyword">struct</span> &#123;</span><br><span class="line">    Center Point</span><br><span class="line">    Radius <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Wheel <span class="keyword">struct</span> &#123;</span><br><span class="line">    Circle Circle</span><br><span class="line">    Spokes <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> w Wheel</span><br><span class="line">w.X = <span class="number">8</span>            <span class="comment">// equivalent to w.Circle.Point.X = 8</span></span><br><span class="line">w.Y = <span class="number">8</span>            <span class="comment">// equivalent to w.Circle.Point.Y = 8</span></span><br><span class="line">w.Radius = <span class="number">5</span>       <span class="comment">// equivalent to w.Circle.Radius = 5</span></span><br><span class="line">w.Spokes = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 但结构体字面值必须遵循形状类型声明时的结构</span></span><br><span class="line">w = Wheel&#123;<span class="number">8</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">20</span>&#125;                       <span class="comment">// compile error: unknown fields</span></span><br><span class="line">w = Wheel&#123;X: <span class="number">8</span>, Y: <span class="number">8</span>, Radius: <span class="number">5</span>, Spokes: <span class="number">20</span>&#125; <span class="comment">// compile error: unknown fields</span></span><br></pre></td></tr></table></figure>

<h2 id="切片-1"><a href="#切片-1" class="headerlink" title="切片"></a>切片</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">b := a[:<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://github.com/golang/go/wiki/SliceTricks">https://github.com/golang/go/wiki/SliceTricks</a></li>
</ul>
<h2 id="可导出的"><a href="#可导出的" class="headerlink" title="可导出的"></a>可导出的</h2><p>这个默认行为类似java中的public。<br>大写字母开头的变量是可导出的，也就是其它包可以读取的，是公有变量；小写字母开头的就是不可导出的，是私有变量。<br>大写字母开头的函数也是一样，相当于class中的带public关键词的公有函数；小写字母开头的就是有private关键词的私有函数。<br><a href="http://go-tour-zh.appspot.com/basics/3">http://go-tour-zh.appspot.com/basics/3</a></p>
<h2 id="匿名字段"><a href="#匿名字段" class="headerlink" title="匿名字段"></a>匿名字段</h2><p>当匿名字段是一个struct的时候，那么这个struct所拥有的全部字段都被隐式地引入了当前定义的这个struct。<br>struct不仅仅能够将struct作为匿名字段、自定义类型、内置类型都可以作为匿名字段，而且可以在相应的字段上面进行函数操作</p>
<p>如果内层与继承层都有相同的字段，则：</p>
<ul>
<li>最外层优先访问； 例如：Bob.phone访问的是 Bob 层的字段</li>
<li>可以通过匿名字段访问继承层；Bob.Human.phone 访问的是Human层的字段</li>
</ul>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>method是附属在一个给定的类型上的，他的语法和函数的声明语法几乎一样，只是在func后面增加了一个receiver(也就是method所依从的主体)。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Rectangle <span class="keyword">struct</span> &#123;</span><br><span class="line">        width, height <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Circle <span class="keyword">struct</span> &#123;</span><br><span class="line">    radius <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r Rectangle)</span></span> area() <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> r.width*r.height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span></span> area() <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c.radius * c.radius * math.Pi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在使用method的时候重要注意几点：  </p>
<ul>
<li>虽然method的名字一模一样，但是如果接收者不一样，那么method就不一样</li>
<li>method里面可以访问接收者的字段</li>
<li>调用method通过<code>.</code>访问，就像struct里面访问字段一样</li>
</ul>
<p>指针作为Receiver会对实例对象的内容发生操作,而普通类型作为Receiver仅仅是以副本作为操作对象,并不对原实例对象发生操作。</p>
<p>那是不是method只能作用在struct上面呢？当然不是咯，他可以定义在任何你自定义的类型、内置类型、struct等各种类型上面。这里你是不是有点迷糊了，什么叫自定义类型，自定义类型不就是struct嘛，不是这样的哦，struct只是自定义类型里面一种比较特殊的类型而已，还有其他自定义类型申明，可以通过如下这样的申明来实现。<br><code>type typeName typeLiteral</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> ages <span class="type">int</span></span><br><span class="line"><span class="keyword">type</span> money <span class="type">float32</span></span><br><span class="line"><span class="keyword">type</span> months <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span></span><br><span class="line">m := months &#123;</span><br><span class="line">    <span class="string">&quot;January&quot;</span>:<span class="number">31</span>,</span><br><span class="line">    <span class="string">&quot;February&quot;</span>:<span class="number">28</span>,</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&quot;December&quot;</span>:<span class="number">31</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="函数作为值、类型"><a href="#函数作为值、类型" class="headerlink" title="函数作为值、类型"></a><a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/02.3.md#%E5%87%BD%E6%95%B0%E4%BD%9C%E4%B8%BA%E5%80%BC%E7%B1%BB%E5%9E%8B">函数作为值、类型</a></h3><blockquote>
<p>在Go中函数也是一种变量，我们可以通过type来定义它，它的类型就是所有拥有相同的参数，相同的返回值的一种类型<br><code>type typeName func(input1 inputType1 , input2 inputType2 [, ...]) (result1 resultType1 [, ...])</code><br>函数作为类型到底有什么好处呢？那就是可以把这个类型的函数当做值来传递</p>
</blockquote>
<ul>
<li><a href="https://blog.learngoprogramming.com/go-functions-overview-anonymous-closures-higher-order-deferred-concurrent-6799008dde7b">First-class funcs</a></li>
</ul>
<p>因此在Go语言里，我们为一些简单的数值、字符串、slice、map来定义一些附加行为很方便。<br>方法可以被声明到任意类型，只要不是一个指针或者一个interface。<br><a href="https://yar999.gitbooks.io/gopl-zh/content/ch6/ch6-01.html">https://yar999.gitbooks.io/gopl-zh/content/ch6/ch6-01.html</a></p>
<p>此外，为了避免歧义，在声明方法时，如果一个类型名本身是一个指针的话，是不允许其出现在接收器中的，比如下面这个例子：<br><a href="https://yar999.gitbooks.io/gopl-zh/content/ch6/ch6-02.html">https://yar999.gitbooks.io/gopl-zh/content/ch6/ch6-02.html</a></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> P *<span class="type">int</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(P)</span></span> f() &#123; <span class="comment">/* ... */</span> &#125; <span class="comment">// compile error: invalid receiver type</span></span><br></pre></td></tr></table></figure>

<h2 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h2><ul>
<li>如果一个method的receiver是*T,你可以在一个T类型的实例变量V上面调用这个method，而不需要&amp;V去调用这个method</li>
<li>如果一个method的receiver是T，你可以在一个*T类型的变量P上面调用这个method，而不需要 *P去调用这个method</li>
</ul>
<p>Go里面的面向对象是如此的简单，没有任何的私有、公有关键字，通过大小写来实现(大写开头的为公有，小写开头的为私有)，方法也同样适用这个原则。</p>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a><a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/02.6.md#26-interface">接口</a></h2><p>空<code>interface</code>在我们需要存储任意类型的数值的时候相当有用，因为他可以存储任意类型的数值。<br>神奇之处：在java中，必须现有interface，然后才有其继承类；而在go中，可以先有类，然后才有接口（当然，先有接口再有类更是可以的）；<a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/02.6.md">https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/02.6.md</a><br>简单的说，interface是一组method 签名的组合，我们通过interface来定义对象的一组行为。</p>
<h2 id="并行"><a href="#并行" class="headerlink" title="并行"></a><a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/02.7.md">并行</a></h2><ul>
<li>必须使用<code>make</code>来创建channel</li>
<li>goroutine是Go并行设计的核心。goroutine说到底其实就是协程，但是它比线程更小，十几个goroutine可能体现在底层就是五六个线程，Go语言内部帮你实现了这些goroutine之间的内存共享。执行goroutine只需极少的栈内存(大概是4~5KB)，当然会根据相应的数据伸缩。也正因为如此，可同时运行成千上万个并发任务。goroutine比thread更易用、更高效、更轻便。</li>
<li>我们可以看到go关键字很方便的就实现了并发编程。 上面的多个goroutine运行在同一个进程里面，共享内存数据，不过设计上我们要遵循：不要通过共享来通信，而要通过通信来共享。<blockquote>
<p><a href="https://www.zhihu.com/question/58004055">如何理解 Golang 中“不要通过共享内存来通信，而应该通过通信来共享内存”？ - 知乎</a></p>
</blockquote>
</li>
<li>runtime.Gosched()表示让CPU把时间片让给别人,下次某个时候继续恢复执行该goroutine。</li>
<li>make和new的区别 <a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/02.2.md#makenew%E6%93%8D%E4%BD%9C">https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/02.2.md#makenew操作</a><blockquote>
<p>make用于内建类型（map、slice 和channel）的内存分配。new用于各种类型的内存分配。</p>
<ol>
<li>new返回指针。<br>new(T)分配了零值填充的T类型的内存空间，并且返回其地址，即一个*T类型的值。用Go的术语说，它返回了一个指针，指向新分配的类型T的零值。</li>
<li>make返回初始化后的（非零）值。<br>make只能创建slice、map和channel，并且返回一个有初始值(非零)的T类型，而不是*T。 在这些项目被初始化之前，slice为nil。</li>
</ol>
</blockquote>
</li>
<li><a href="http://go-tour-zh.appspot.com/concurrency/4">range和close</a></li>
</ul>
<h2 id="正则"><a href="#正则" class="headerlink" title="正则"></a>正则</h2><p>注意：所有字符都是UTF-8处理。  </p>
<p>字符串的处理可以使用<code>strings</code>包来进行搜索（Contains, Index）、替换（Replace）和解析（Split、Join）等操作</p>
<h2 id="反射"><a href="#反射" class="headerlink" title="反射"></a><a href="http://golang.org/doc/articles/laws_of_reflection.html">反射</a></h2><h2 id="包"><a href="#包" class="headerlink" title="[包]"></a>[包]</h2><p>当创建一个包，一般要用短小的包名，但也不能太短导致难以理解。<br>包名一般采用单数的形式。标准库的bytes、errors和strings使用了复数形式，这是为了避免和预定义的类型冲突，同样还有go/types是为了避免和type关键字冲突。<br><a href="https://yar999.gitbooks.io/gopl-zh/content/ch10/ch10-06.html">https://yar999.gitbooks.io/gopl-zh/content/ch10/ch10-06.html</a></p>
]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>Go学习资料</title>
    <url>/go/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/</url>
    <content><![CDATA[<ul>
<li><p><a href="https://coding.imooc.com/class/chapter/180.html#Anchor">Google资深工程师深度讲解Go语言</a></p>
</li>
<li><p><a href="https://tour.golang.org/welcome/1">A Tour of Go</a></p>
</li>
<li><p><a href="https://golang.org/doc/effective_go.html">Effective Go</a></p>
</li>
<li><p><a href="https://peter.bourgon.org/go-best-practices-2016/">Go best practices, six years in</a></p>
</li>
<li><p><a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/preface.md">build-web-application-with-golang</a></p>
</li>
<li><p><a href="https://beego.me/docs/intro/">beego 简介</a></p>
</li>
<li><p><a href="http://go-tour-zh.appspot.com/concurrency/10">where to go from here</a></p>
</li>
<li><p><a href="http://fuxiaohei.me/2016/9/20/go-and-http-server.html">Go 开发 HTTP</a></p>
</li>
</ul>
<h2 id="make-and-new"><a href="#make-and-new" class="headerlink" title="make and new"></a>make and new</h2><table>
<thead>
<tr>
<th>type</th>
<th>object</th>
<th>return</th>
<th>init</th>
</tr>
</thead>
<tbody><tr>
<td>make</td>
<td>channel, slice, map</td>
<td>the relative type</td>
<td>yes</td>
</tr>
<tr>
<td>new</td>
<td>all</td>
<td>pointer</td>
<td>yes</td>
</tr>
</tbody></table>
<ul>
<li><a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/02.2.md">build-web-application-with-golang/02.2.md at master · astaxie/build-web-application-with-golang</a></li>
<li><a href="https://www.godesignpatterns.com/2014/04/new-vs-make.html">new() vs make() | Go Design Patterns</a></li>
</ul>
]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>Go标准库</title>
    <url>/go/%E6%A0%87%E5%87%86%E5%BA%93/</url>
    <content><![CDATA[<h2 id="fmt占位符"><a href="#fmt占位符" class="headerlink" title="fmt占位符"></a>fmt占位符</h2><ul>
<li><a href="https://github.com/polaris1119/The-Golang-Standard-Library-by-Example/blob/master/chapter01/01.3.md">https://github.com/polaris1119/The-Golang-Standard-Library-by-Example/blob/master/chapter01/01.3.md</a></li>
<li><a href="https://golang.org/pkg/fmt/">https://golang.org/pkg/fmt/</a></li>
</ul>
<h2 id="strconv数字转换"><a href="#strconv数字转换" class="headerlink" title="strconv数字转换"></a>strconv数字转换</h2><ul>
<li>strconv.Itoa （数字转换为字符串）</li>
<li>strconv.Atoi （字符串转换为数字）</li>
</ul>
<h2 id="time"><a href="#time" class="headerlink" title="time"></a>time</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">timeStr := time.Now().Format(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>)</span><br><span class="line">timeStr = time.Parse(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>, time.Now)</span><br></pre></td></tr></table></figure>

<h2 id="json"><a href="#json" class="headerlink" title="json"></a>json</h2><ul>
<li><a href="https://yar999.gitbooks.io/gopl-zh/content/ch4/ch4-05.html">https://yar999.gitbooks.io/gopl-zh/content/ch4/ch4-05.html</a><blockquote>
<p>Color成员的Tag还带了一个额外的omitempty选项，表示当Go语言结构体成员为空或零值时不生成JSON对象（这里false为零值）。</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>Go排序</title>
    <url>/go/%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 顺序</span></span><br><span class="line">sort.Ints(a []<span class="type">int</span>);</span><br><span class="line">sort.Strings(a []<span class="type">string</span>);</span><br><span class="line"><span class="comment">// 逆序 https://stackoverflow.com/questions/18343208/how-do-i-reverse-sort-a-slice-of-integer-go</span></span><br><span class="line">sort.Sort(sort.Reverse(sort.IntSlice(keys)))</span><br><span class="line">sort.Sort(sort.Reverse(sort.StringSlice(keys)))</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>Go测试</title>
    <url>/go/%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;errors&quot;</span></span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/lyloou/goer/pkg/basic&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/lyloou/goer/pkg/math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://yar999.gitbooks.io/gopl-zh/content/ch11/ch11-02.html</span></span><br><span class="line"><span class="comment">// 表格驱动测试</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestDivide</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> tests = []<span class="keyword">struct</span> &#123;</span><br><span class="line">        a   <span class="type">int64</span></span><br><span class="line">        b   <span class="type">int64</span></span><br><span class="line">        r   <span class="type">int64</span></span><br><span class="line">        err <span class="type">error</span></span><br><span class="line">    &#125;&#123;</span><br><span class="line">        &#123;<span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="literal">nil</span>&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="literal">nil</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="literal">nil</span>&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, errors.New(<span class="string">&quot;division by zero&quot;</span>)&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, test := <span class="keyword">range</span> tests &#123;</span><br><span class="line">        <span class="keyword">if</span> r, err := math.Divide(test.a, test.b); r != test.r || !basic.IsSameError(err, test.err) &#123;</span><br><span class="line">            t.Errorf(<span class="string">&quot;Divide(%d, %d) got (%d, %v), want (%d, %v)&quot;</span>, test.a, test.b, r, err, test.r, test.err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试扩展包(External test package)：<br>目的：解决包的循环依赖问题。<br>方法：给包名添加<code>_test</code>后缀。<br><a href="https://yar999.gitbooks.io/gopl-zh/content/ch11/ch11-02.html">https://yar999.gitbooks.io/gopl-zh/content/ch11/ch11-02.html</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">// 产品代码</span><br><span class="line">$ go list -f=&#123;&#123;.GoFiles&#125;&#125; github.com/lyloou/goer/pkg/math</span><br><span class="line">// 包内测试</span><br><span class="line">$ go list -f=&#123;&#123;.TestGoFiles&#125;&#125; github.com/lyloou/goer/pkg/math</span><br><span class="line">// 测试扩展包</span><br><span class="line">$ go list -f=&#123;&#123;.XTestGoFiles&#125;&#125; github.com/lyloou/goer/pkg/math</span><br></pre></td></tr></table></figure>

<p>像<code>fmt/export_test.go</code>中所表现的，通过提供一个秘密出口的小技巧，来进行测试扩展包的白盒测试。<br>—— <a href="https://yar999.gitbooks.io/gopl-zh/content/ch11/ch11-02.html">https://yar999.gitbooks.io/gopl-zh/content/ch11/ch11-02.html</a> (11.2.4)</p>
<blockquote>
<p>开始一个好的测试的关键是通过实现你真正想要的具体行为，然后才是考虑简化测试代码。<br>最好的接口是直接从库的抽象接口开始，针对公共接口编写一些测试函数。</p>
</blockquote>
]]></content>
      <tags>
        <tag>go</tag>
      </tags>
  </entry>
  <entry>
    <title>Gradle学习</title>
    <url>/gradle/Gradle%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Gradle 是以 Groovy 语言为基础，面向 Java 应用为主，基于 DSL 语法的自动化构建工具。</p>
<h1 id="如何自动化打包（含签名的）"><a href="#如何自动化打包（含签名的）" class="headerlink" title="如何自动化打包（含签名的）"></a>如何自动化打包（含签名的）</h1><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>1、将准备好的<code>keystore</code>签名文件放在根目录下；（目的是待会儿配置 build.gradle 文件时，可以直接通过指定路径引用）<br>2、在 module 级别的 build.gradle 中添加如下配置代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    signingConfigs &#123;</span><br><span class="line">        myConfig &#123;</span><br><span class="line">            storeFile <span class="title function_">file</span>(<span class="string">&quot;lyloou.keystore&quot;</span>)</span><br><span class="line">            storePassword <span class="string">&quot;lyloou&quot;</span></span><br><span class="line">            keyAlias <span class="string">&quot;lyloou&quot;</span></span><br><span class="line">            keyPassword <span class="string">&quot;lyloou&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            signingConfig signingConfigs.<span class="property">myConfig</span></span><br><span class="line">            minifyEnabled <span class="literal">false</span></span><br><span class="line">            proguardFiles <span class="title function_">getDefaultProguardFile</span>(<span class="string">&#x27;proguard-android.txt&#x27;</span>), <span class="string">&#x27;proguard-rules.pro&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、执行<code>gradle clean</code>清理之前的自动生成文件；<br>4、执行<code>gradle build</code>开始生成文件；<br>5、在<code>build/outputs/apk/</code>文件夹中可以看到生成成功的 apk 文件；</p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>通过执行<code>gradle build</code>自动生成的文件包含：</p>
<ul>
<li>[项目名]-debug-unaligned.apk：指的是调试模式，没有优化的 apk（可直接安装）</li>
<li>[项目名]-release-unsigned.apk：指的是没有签名的 apk（不可直接安装）</li>
<li>[项目名]-debug.apk：指的是已经签名过的调试版 apk；</li>
<li>[项目名]-release.apk：指的是已经签名过的发布版 apk；</li>
</ul>
<h2 id="扩展技巧"><a href="#扩展技巧" class="headerlink" title="扩展技巧"></a>扩展技巧</h2><ul>
<li>敏感信息保存到<code>gradle.properties</code>文件中，具体参考 <a href="https://www.kancloud.cn/thinkphp/android-best-practices/42169">Gradle 配置</a></li>
<li>自动化命名并输出 apk，具体参考<a href="https://github.com/lyloou/hexo/blob/master/source/_posts/tech/build.gradle%E9%85%8D%E7%BD%AE.md">build.gradle 配置</a></li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="http://stormzhang.com/android/2014/02/28/android-gradle/">ANDROID GRADLE</a></li>
</ul>
<h1 id="如何根据环境自动选择-key-或其他配置信息"><a href="#如何根据环境自动选择-key-或其他配置信息" class="headerlink" title="如何根据环境自动选择 key 或其他配置信息"></a>如何根据环境自动选择 key 或其他配置信息</h1><h2 id="动态替换AndroidManifest-xml中的-key-信息"><a href="#动态替换AndroidManifest-xml中的-key-信息" class="headerlink" title="动态替换AndroidManifest.xml中的 key 信息"></a>动态替换<code>AndroidManifest.xml</code>中的 key 信息</h2><ol>
<li>在<code>AndroidManifest</code>中添加占位符</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">&quot;$&#123;WECHATAPPID&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在<code>build.gradle</code>中的<code>defaultConfig</code>标签或者<code>buildTypes</code>的 debug 和 release 标签下定义具体 value</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">    manifestPlaceholders = [<span class="attr">WECHATAPPID</span>: <span class="string">&quot;wxea2xxxxxxxxxxxxxxx&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">debug &#123;</span><br><span class="line">    manifestPlaceholders = [<span class="attr">WECHATAPPID</span>: <span class="string">&quot;wxea2xxxxxxxxxxxxxxx1&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">release &#123;</span><br><span class="line">    manifestPlaceholders = [<span class="attr">WECHATAPPID</span>: <span class="string">&quot;wxea2xxxxxxxxxxxxxxx2&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="通过BuildConfig定义值"><a href="#通过BuildConfig定义值" class="headerlink" title="通过BuildConfig定义值"></a>通过<code>BuildConfig</code>定义值</h2><p>在不同的环境中设置不同的值，这样在打包（测试环境或正式环境）的时候就会有不同的值。注意定义完成后，要重新编译下环境，这样才能在 BuildConfig.java 中生效；</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">debug &#123;</span><br><span class="line">    buildConfigField <span class="string">&quot;boolean&quot;</span>, <span class="string">&quot;TEST_ENV&quot;</span>, <span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">release &#123;</span><br><span class="line">    buildConfigField <span class="string">&quot;boolean&quot;</span>, <span class="string">&quot;TEST_ENV&quot;</span>, <span class="string">&quot;false&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在代码中引用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">TEST_ENV</span> <span class="operator">=</span> BuildConfig.TEST_ENV;</span><br></pre></td></tr></table></figure>

<h2 id="在编译之前执行脚本"><a href="#在编译之前执行脚本" class="headerlink" title="在编译之前执行脚本"></a>在编译之前执行脚本</h2><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在 settings.gradle 最上方添加</span></span><br><span class="line"><span class="keyword">def</span> updateDependencies()&#123;</span><br><span class="line">    <span class="keyword">def</span> command = <span class="string">&quot;sh install.sh&quot;</span></span><br><span class="line">    exec &#123;</span><br><span class="line">        executable <span class="string">&quot;bash&quot;</span></span><br><span class="line">        args <span class="string">&quot;-c&quot;</span>, command</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">updateDependencies()</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
        <tag>gradle</tag>
      </tags>
  </entry>
  <entry>
    <title>关于Jcenter的一些总结</title>
    <url>/gradle/%E5%85%B3%E4%BA%8Ejcenter%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="摘要："><a href="#摘要：" class="headerlink" title="摘要："></a>摘要：</h2><p>本文介绍了将自己的库发布到jcenter相关的一些总结。</p>
<p>之所以有这篇文章，起源于这样一种原因：</p>
<blockquote>
<p>在AS中使用开源库很简单，只需要在<code>build.gradle</code>文件中添加一句命令即可。<br>如果我想要把自己积累的常用代码库也通过这种方式，那么我就可以在多个项目中使用，也可以开源给其他程序员使用。</p>
</blockquote>
<h2 id="初次配置（具体参考外部链接）"><a href="#初次配置（具体参考外部链接）" class="headerlink" title="初次配置（具体参考外部链接）"></a>初次配置（具体参考外部链接）</h2><ul>
<li>配置project的build.gradle文件；</li>
<li>配置lib的build.gradle文件；</li>
<li>在终端执行gradlew相关命令上传到jcenter；</li>
</ul>
<h2 id="更新版本库"><a href="#更新版本库" class="headerlink" title="更新版本库"></a>更新版本库</h2><ul>
<li>修改版本号；</li>
<li>完成清单<code>tool/Checklist.md</code>；</li>
<li>在命令行窗口执行下面命令（当发生错误时，参照错误提示进行修改）<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">gradlew clean build bintrayUpload</span><br><span class="line">  -PbintrayUser=「Your Name」</span><br><span class="line">  -PbintrayKey=「API KEY」</span><br><span class="line">  -PdryRun=<span class="literal">false</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="https://github.com/hehonghui/android-tech-frontier/blob/master/issue-17/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Android-Studio%E6%8A%8A%E8%87%AA%E5%B7%B1%E7%9A%84Android-library%E5%88%86%E5%8F%91%E5%88%B0jCenter%E5%92%8CMaven-Central.md">如何使用Android Studio把自己的Android library分发到jCenter和Maven Central</a></li>
<li><a href="http://wuxiaolong.me/2016/05/06/jcenter2/">Android library分享到jcenter</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>解决Gradle编译时的版本冲突</title>
    <url>/gradle/%E8%A7%A3%E5%86%B3gradle%E7%BC%96%E8%AF%91%E6%97%B6%E7%9A%84%E7%89%88%E6%9C%AC%E5%86%B2%E7%AA%81/</url>
    <content><![CDATA[<h2 id="方法-1：排除冲突的依赖"><a href="#方法-1：排除冲突的依赖" class="headerlink" title="方法 1：排除冲突的依赖"></a>方法 1：排除冲突的依赖</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看 app 模块所依赖的项目（通过 grep 来过滤冲突的模块名称）</span></span><br><span class="line">./gradlew -q app:dependencies | grep commons-codec</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 针对某个冲突模块排除</span></span><br><span class="line">api(<span class="string">&quot;com.afollestad.material-dialogs:core:0.9.5.0&quot;</span>) &#123;</span><br><span class="line">    exclude group: <span class="string">&#x27;com.android.support&#x27;</span>, module: <span class="string">&#x27;support-v13&#x27;</span></span><br><span class="line">    exclude group: <span class="string">&#x27;com.android.support&#x27;</span>, module: <span class="string">&#x27;support-vector-drawable&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 重置所有相同模块的版本号</span></span><br><span class="line">configurations.all &#123;</span><br><span class="line">    resolutionStrategy.eachDependency &#123; DependencyResolveDetails details -&gt;</span><br><span class="line">        def requested = details.requested</span><br><span class="line">        <span class="keyword">if</span> (requested.group == <span class="string">&#x27;com.android.support&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!requested.name.startsWith(<span class="string">&quot;multidex&quot;</span>)) &#123;</span><br><span class="line">                details.useVersion <span class="string">&#x27;28.0.0&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="方法-2：使用-androidx"><a href="#方法-2：使用-androidx" class="headerlink" title="方法 2：使用 androidx"></a>方法 2：使用 androidx</h2><p>如果是 <code>com.android.support</code> 库冲突可以使用 androidx 来解决。</p>
<p>具体查看 <a href="https://developer.android.google.cn/jetpack/androidx/migrate">迁移到 AndroidX  |  Android 开发者  |  Android Developers</a></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://blog.csdn.net/yuzhiqiang_1993/article/details/78214812">com.android.support 版本冲突的解决办法<em>移动开发</em>喻志强的博客-CSDN 博客</a></li>
<li><a href="https://blog.csdn.net/yuzhiqiang_1993/article/details/78366985">implementation、api、compileOnly 区别详解<em>移动开发</em>喻志强的博客-CSDN 博客</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo使用和配置</title>
    <url>/hexo/Hexo%E4%BD%BF%E7%94%A8%E5%92%8C%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="摘要："><a href="#摘要：" class="headerlink" title="摘要："></a>摘要：</h2><p>主要内容：<br>本文介绍我在搭建本博客平台时用到的工具、插件，以及遇到的问题；</p>
<h2 id="文档管理工具"><a href="#文档管理工具" class="headerlink" title="文档管理工具"></a>文档管理工具</h2><p>Android Studio | IDEA</p>
<h3 id="通过-template-方便创建文档"><a href="#通过-template-方便创建文档" class="headerlink" title="通过 template 方便创建文档"></a>通过 template 方便创建文档</h3><p><code>File -&gt; Setting -&gt; Editor -&gt; File and Code Templates</code><br><code>--- title: $&#123;NAME&#125; date: $&#123;DATE&#125; $&#123;TIME&#125; toc: true comments: true tags: - $&#123;Tag&#125; ---</code></p>
<h2 id="教程、文档、API"><a href="#教程、文档、API" class="headerlink" title="教程、文档、API"></a>教程、文档、API</h2><p>网址：<code>https://hexo.io</code><br>安装 hexo 教程：<code>https://hexo.io/zh-cn/docs/</code></p>
<h2 id="主题选择"><a href="#主题选择" class="headerlink" title="主题选择"></a>主题选择</h2><p>网址：<code>https://hexo.io/themes/</code></p>
<h2 id="插入多媒体"><a href="#插入多媒体" class="headerlink" title="插入多媒体"></a>插入多媒体</h2><h4 id="插入图片："><a href="#插入图片：" class="headerlink" title="插入图片："></a>插入图片：</h4><pre><code><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//</span> 方式<span class="number">1</span>，加入本地图片：</span><br><span class="line"><span class="regexp">//</span> 首先需要在source中加入文件夹images，并放入图片smile01.gif;</span><br><span class="line">![](<span class="regexp">/images/</span>smile01.gif)</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> 方式<span class="number">2</span>，加入图床中的图片地址：</span><br><span class="line">![](图片地址)</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> 方式<span class="number">3</span>，获取到github的raw图片网址；</span><br></pre></td></tr></table></figure>
</code></pre>
<h4 id="插入音乐："><a href="#插入音乐：" class="headerlink" title="插入音乐："></a>插入音乐：</h4><pre><code><figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">&lt;iframe frameborder<span class="operator">=</span><span class="string">&quot;no&quot;</span> border<span class="operator">=</span><span class="string">&quot;0&quot;</span> marginwidth<span class="operator">=</span><span class="string">&quot;0&quot;</span> marginheight<span class="operator">=</span><span class="string">&quot;0&quot;</span> width<span class="operator">=</span><span class="number">330</span> height<span class="operator">=</span><span class="number">86</span></span><br><span class="line">    src<span class="operator">=</span><span class="string">&quot;http://music.163.com/outchain/player?type=2&amp;id=25706282&amp;auto=0&amp;height=66&quot;</span>&gt;</span><br><span class="line">&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
<h4 id="插入视频："><a href="#插入视频：" class="headerlink" title="插入视频："></a>插入视频：</h4><pre><code><figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">&lt;center&gt;</span><br><span class="line">&lt;iframe frameborder<span class="operator">=</span><span class="string">&quot;no&quot;</span> border<span class="operator">=</span><span class="string">&quot;0&quot;</span> marginwidth<span class="operator">=</span><span class="string">&quot;0&quot;</span> marginheight<span class="operator">=</span><span class="string">&quot;0&quot;</span> width<span class="operator">=</span><span class="number">330</span> height<span class="operator">=</span><span class="number">86</span></span><br><span class="line">    src<span class="operator">=</span><span class="string">&quot;http://music.163.com/outchain/player?type=2&amp;id=25706282&amp;auto=0&amp;height=66&quot;</span>&gt;</span><br><span class="line">&lt;/iframe&gt;</span><br><span class="line">&lt;/center&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
<p>外部链接：</p>
<ul>
<li><a href="http://blog.wleyuan.me/2015/07/18/Hexo-AddSoundPicMovie/">Hexo 博客添加图片、音乐、视频</a></li>
</ul>
<h2 id="自动更新目录结构"><a href="#自动更新目录结构" class="headerlink" title="自动更新目录结构"></a>自动更新目录结构</h2><p>对于需要手动管理的目录，可以通过自动生成脚本来实现目录链接<br>参考：<code>https://lyloou.com/life/create_md_link.sh</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">自动更新目录文件：</span></span><br><span class="line"><span class="string">获取当前目录。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">获取所有文件，排序：目录、文件，</span></span><br><span class="line"><span class="string">1. 如果是目录：生成【目录名/index.html链接】</span></span><br><span class="line"><span class="string">2. 如果是文件：生成【文件名.html链接】</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">将1、2拼接后，放入本目录的index.html中。</span></span><br><span class="line"><span class="string">如果是目录，递归操作。</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"><span class="function"><span class="title">create_md_link</span></span>() &#123;</span><br><span class="line">    path=$(<span class="built_in">pwd</span>)</span><br><span class="line"></span><br><span class="line">    files=$(<span class="built_in">ls</span> <span class="variable">$path</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 当前文件</span></span><br><span class="line">    title=<span class="string">&quot;#### <span class="variable">$&#123;path##*/&#125;</span>\n&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="variable">$title</span> &gt;index.md</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27;\n###### 文件列表\n&#x27;</span> &gt;&gt;index.md</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出文件</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> <span class="variable">$files</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [[ -f <span class="string">&quot;<span class="variable">$filename</span>&quot;</span> &amp;&amp; <span class="variable">$filename</span> =~ .*md$ ]]; <span class="keyword">then</span></span><br><span class="line">            md_link=$(<span class="built_in">echo</span> <span class="variable">$filename</span> | sed <span class="string">&#x27;s/\.[^.]*$//&#x27;</span>)</span><br><span class="line">            md_link=<span class="string">&quot;- [<span class="variable">$md_link</span>](<span class="variable">$md_link</span>.html)&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$md_link</span> &gt;&gt;index.md</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27;\n###### 子目录列表\n&#x27;</span> &gt;&gt;index.md</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出目录</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> <span class="variable">$files</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$filename</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">            md_link=<span class="string">&quot;- [<span class="variable">$filename</span>](./<span class="variable">$filename</span>/index.html)&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$md_link</span> &gt;&gt;index.md</span><br><span class="line">            <span class="built_in">cd</span> <span class="variable">$filename</span></span><br><span class="line">            create_md_link</span><br><span class="line">            <span class="built_in">cd</span> ..</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;create md_files link success: <span class="variable">$path</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">create_md_link</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="问题列表"><a href="#问题列表" class="headerlink" title="问题列表"></a>问题列表</h2><h3 id="Error-Local-hexo-not-found"><a href="#Error-Local-hexo-not-found" class="headerlink" title="Error Local hexo not found"></a>Error Local hexo not found</h3><p>具体描述：从 github 上直接克隆下来的源码，执行<code>hexo s</code>会出现错误：</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Error </span>Local hexo not found in /XXX</span><br><span class="line"><span class="keyword">Error </span>Try running: &#x27;npm install hexo --save&#x27;</span><br></pre></td></tr></table></figure>

<p>原因分析：<br><code>.gitignore</code>文件中忽略了<code>node_modules</code>文件夹，所以从 github 上的克隆的源码中不存在此文件夹；</p>
<p>解决方案：<br>重新执行<code>npm install</code>命令即可；（用自带 CMD）<br>执行 <code>npm install</code>可能会出现失败的警告，有可能是 npm 版本问题：<br>执行下面命令来降低 npm 的版本：<br><code>npm install -g npm@3.3.12</code></p>
<p>外部连接：</p>
<ul>
<li><a href="http://blog.csdn.net/burststar/article/details/45115905">用 Hexo 写博客 - ERROR Local hexo not found in xxx</a></li>
<li><a href="https://github.com/foreverjs/forever/issues/788">npm WARN optional dep failed, continuing fsevents@1.0.6</a></li>
</ul>
<h3 id="add-Read-More"><a href="#add-Read-More" class="headerlink" title="add Read More"></a>add Read More</h3><p>方法：在需要截断的地方插入<code>&lt;!--more--&gt;</code>即可。<br>外部连接：<a href="http://twiceyuan.com/2014/05/25/hexo%E8%87%AA%E5%8A%A8%E6%B7%BB%E5%8A%A0readmore%E6%A0%87%E8%AE%B0/">Hexo 自动添加 ReadMore 标记</a></p>
<blockquote>
<p>（解决问题的方法：将错误日志中的关键部分择取关键字交给 Google；）</p>
</blockquote>
]]></content>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo集成travis自动部署</title>
    <url>/hexo/hexo%E9%9B%86%E6%88%90travis/</url>
    <content><![CDATA[<h2 id="自动化前-VS-后"><a href="#自动化前-VS-后" class="headerlink" title="自动化前 VS 后"></a>自动化前 VS 后</h2><h3 id="没有-travis-的流程"><a href="#没有-travis-的流程" class="headerlink" title="没有 travis 的流程"></a>没有 travis 的流程</h3><p>每次写完文章后，要手动运行以下命令部署</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">hexo clean --config <span class="built_in">source</span>/_data/next.yml &amp;&amp;</span><br><span class="line">hexo g --config <span class="built_in">source</span>/_data/next.yml &amp;&amp;</span><br><span class="line">hexo d --config <span class="built_in">source</span>/_data/next.yml</span><br></pre></td></tr></table></figure>

<h3 id="基于-travis-的自动部署流程"><a href="#基于-travis-的自动部署流程" class="headerlink" title="基于 travis 的自动部署流程"></a>基于 travis 的自动部署流程</h3><p>有了 travis，写好文章后，只需推送代码到 GitHub 仓库。其他的部署操作都由 travis 自动完成：</p>
<ol>
<li>提交并推送代码到 GitHub；</li>
<li>Travis Ci 监听到 GitHub 仓库发生变化，开始依据 <code>.travis.yml</code> 脚本构建项目；</li>
<li>Travis Ci 构建完成后将生成的最终文件推送到 GitHub；</li>
</ol>
<h2 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h2><h3 id="Permission-denied"><a href="#Permission-denied" class="headerlink" title="Permission denied"></a>Permission denied</h3><p>原因：脚本没有运行权限</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ ./run_d.sh</span><br><span class="line">/home/travis/.travis/job_stages: line 104: ./run_d.sh: Permission denied</span><br><span class="line">The <span class="built_in">command</span> <span class="string">&quot;./run_d.sh&quot;</span> exited with 126.</span><br></pre></td></tr></table></figure>

<p>在 <code>.travis.yml</code>的 <code>before_install:</code>阶段添加<code>x</code>权限：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">chmod</span> <span class="string">+x</span> <span class="string">./run_d.sh</span></span><br></pre></td></tr></table></figure>

<h3 id="Permission-denied-publickey"><a href="#Permission-denied-publickey" class="headerlink" title="Permission denied (publickey)"></a>Permission denied (publickey)</h3><p>Q:</p>
<blockquote>
<p>fatal: Could not read from remote repository.<br>Please make sure you have the correct access rights</p>
</blockquote>
<p>A:</p>
<blockquote>
<p>If you want to push via ssh then travis needs to have access to the private part of the ssh key you generated. What you want to do is use the travis cli gem to encrypt the private key, add it to your repo and during the deploy stage decrypt it again and use it. Here’s a <a href="https://github.com/lyloou/learn-travis/blob/master/encrypted-ssh-keys-deployment.md">step-by-step</a></p>
</blockquote>
<p>为了能将 travis 构建后的文件推送到 github，需要：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 以下操作匀在客户端</span></span><br><span class="line">sudo apt install ruby</span><br><span class="line">sudo apt install ruby​​-dev</span><br><span class="line">sudo gem install <span class="built_in">tr</span>​​avis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 生成ssh密钥</span></span><br><span class="line">ssh-keygen -C <span class="string">&quot;lyloou@qq.com&quot;</span> -t rsa -b 2048 -f ~/.ssh/hexo</span><br><span class="line"><span class="comment"># 2. 将公钥内容贴到Github上项目的 「Settings -&gt; Deploy keys -&gt; Add deploy key」</span></span><br><span class="line"><span class="comment"># 3. 登录travis（会自动生成 ~/.travis/config.yml 文件）</span></span><br><span class="line">travis login --auto</span><br><span class="line"><span class="comment"># 4. 在你的项目中运行以下命令，加密刚才生成的私钥，生成 hexo.enc 文件。 （注意提示内容，不要把密钥给提交到仓库了）</span></span><br><span class="line">travis encrypt-file ~/.ssh/hexo --add</span><br></pre></td></tr></table></figure>

<p>上面的第 4 步，做了这几件事：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">- 加密ssh私钥, 生成一个hexo.enc。这个文档需要放到项目里，上面的输出已经提示了，千万别把原始的私钥放进去了~~</span><br><span class="line">- 相应的解密k/v值以环境变量方式存在Travis CI上, 见Travis CI上项目的「More options -&gt; Settings -&gt; Environment Variables」</span><br><span class="line">- 将解密命令自动写入到本地项目的 .travis.yml 里</span><br></pre></td></tr></table></figure>

<p>加密之后的<code>hexo.enc</code>文件，只有 travis 能解密使用。<br>因为在 login 的时候，将解密的密钥存放到<code>Environment Variables</code>中了，拿不到这个就无法解密还原了。</p>
<p>接着通过 ssh_agent 的方式配置<code>ssh client</code>：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">before_install:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">openssl</span> <span class="string">aes-256-cbc</span> <span class="string">-K</span> <span class="string">$encrypted_f9a8a4d68f34_key</span> <span class="string">-iv</span> <span class="string">$encrypted_f9a8a4d68f34_iv</span></span><br><span class="line">    <span class="string">-in</span> <span class="string">wiki.enc</span> <span class="string">-out</span> <span class="string">~/.ssh/id_rsa</span> <span class="string">-d</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">chmod</span> <span class="number">600</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">eval</span> <span class="string">$(ssh-agent)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ssh-add</span> <span class="string">~/.ssh/id_rsa</span></span><br></pre></td></tr></table></figure>

<h2 id="最终配置"><a href="#最终配置" class="headerlink" title="最终配置"></a>最终配置</h2><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">language:</span> <span class="string">node_js</span></span><br><span class="line"><span class="attr">node_js:</span> <span class="string">stable</span></span><br><span class="line"><span class="attr">branches:</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">source</span></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">apt:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">yarn:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">directories:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">node_modules</span></span><br><span class="line"><span class="attr">before_install:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">openssl</span> <span class="string">aes-256-cbc</span> <span class="string">-K</span> <span class="string">$encrypted_a685f241ac15_key</span> <span class="string">-iv</span> <span class="string">$encrypted_a685f241ac15_iv</span></span><br><span class="line">    <span class="string">-in</span> <span class="string">hexo.enc</span> <span class="string">-out</span> <span class="string">~/.ssh/id_rsa</span> <span class="string">-d</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">chmod</span> <span class="number">600</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">eval</span> <span class="string">$(ssh-agent)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ssh-add</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">export</span> <span class="string">TZ=&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">&quot;$USER_NAME&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">&quot;$USER_EMAIL&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">curl</span> <span class="string">-o-</span> <span class="string">-L</span> <span class="string">https://yarnpkg.com/install.sh</span> <span class="string">|</span> <span class="string">bash</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">export</span> <span class="string">PATH=$HOME/.yarn/bin:$PATH</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">-g</span> <span class="string">hexo-cli</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">chmod</span> <span class="string">+x</span> <span class="string">./run_d.sh</span></span><br><span class="line"><span class="attr">install:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">yarn</span></span><br><span class="line"><span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">./run_d.sh</span></span><br><span class="line"><span class="attr">after_success:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;oked!&quot;</span></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">global:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">USER_NAME:</span> <span class="string">lyloou</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">USER_EMAIL:</span> <span class="string">lyloou@qq.com</span></span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>在 GitHub 的<code>Readme.md</code>中显示构建结果</p>
<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">[<span class="string">build-info</span>](<span class="link">https://travis-ci.org/userName/repoName.svg</span>)</span><br></pre></td></tr></table></figure>

<h2 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h2><p>Q: travis-ci node-sass: Command failed.<br>A: <a href="https://github.com/travis-ci/travis-ci/issues/9561">https://github.com/travis-ci/travis-ci/issues/9561</a></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://segmentfault.com/a/1190000009054888">使用 Travis 自动部署 Hexo 到 Github 与 自己的服务器 - 我的儿子叫酸奶 - SegmentFault 思否</a></li>
<li><a href="https://hk.saowen.com/a/8edd77efe1c7f306f67e7c71e764ad76184d9ff3675d6dcfc9913d913be24cbd">Simiki 基于 Github Pages 配合 Travis CI 做持续集成 - 扫文资讯</a></li>
<li><a href="https://segmentfault.com/a/1190000004667156">用 Travis CI 自动部署 hexo - ac 黄博客精选 - SegmentFault 思否</a></li>
</ul>
]]></content>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>用GitHub Page和Hexo搭建个人博客</title>
    <url>/hexo/%E7%94%A8GitHub%20Page%E5%92%8CHexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li>安装<a href="https://nodejs.org/en/">Node.js</a></li>
<li>安装<a href="https://git-scm.com/">Git </a></li>
<li>安装Hexo（所有操作均在Windows自带的cmd命令行中运行：<code>npm install -g hexo</code>）</li>
<li>切换到博客目录并初始化：<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># cd <span class="attr">d</span>:<span class="regexp">/w/</span>hexo</span><br><span class="line"># hexo init</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">hexo generate  == hexo g</span><br><span class="line">hexo server    == hexo s</span><br><span class="line">hexo deploy    == hexo d</span><br><span class="line">hexo <span class="keyword">new</span>       == hexo n</span><br></pre></td></tr></table></figure>

<h2 id="部署到Github"><a href="#部署到Github" class="headerlink" title="部署到Github"></a>部署到Github</h2><p>配置_config.yml</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy</span>:</span><br><span class="line">  <span class="attr">type</span>: git</span><br><span class="line">  <span class="attr">repo</span>: git@github.<span class="property">com</span>:lyloou/lyloou.<span class="property">github</span>.<span class="property">io</span>.<span class="property">git</span></span><br><span class="line">  <span class="attr">branch</span>: master</span><br></pre></td></tr></table></figure>

<p>安装部署</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>

<h2 id="绑定独立域名"><a href="#绑定独立域名" class="headerlink" title="绑定独立域名"></a>绑定独立域名</h2><ul>
<li>在Hexo项目的Source中新建文件CNAME</li>
<li>添加<code>lyloou.com</code></li>
<li>然后<code>hexo d -g</code>上传即可</li>
</ul>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><ul>
<li>执行了 <code>hexo d -g</code>后，未能成功部署到网站：请先clean一下，<code>hexo clean</code></li>
</ul>
<hr>
<h2 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h2><ul>
<li><a href="http://wenjunoy.com/2016/hexo-github-blog/">在Github上搭建一个Hexo博客系统</a></li>
</ul>
]]></content>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTP the Definitive Guide 读书笔记</title>
    <url>/http/HTTP%20The%20Definitive%20Guide/</url>
    <content><![CDATA[<h1 id="HTTP-The-Definitive-Guide-读书笔记"><a href="#HTTP-The-Definitive-Guide-读书笔记" class="headerlink" title="HTTP The Definitive Guide 读书笔记"></a>HTTP The Definitive Guide 读书笔记</h1><blockquote>
<p>逆序记录 </p>
</blockquote>
<p>| Status  –p59</p>
<ul>
<li>100-199: Informational Status Codes</li>
<li>200-299: Success Status Codes</li>
<li>300-399:Redirection Status Codes</li>
</ul>
<p>| The TRACE method is used primarily for diagnostics;<br>It’s also a good tool for seeing the effects of proxies and other applications<br>on your requests. –p56</p>
<p>| The TRACE method allows clients to see how its request looks when it finally<br>makes it to the server. –p55</p>
<p>| PUT:<br>Because PUT allows you to change content, many web servers require you to log in<br>with a password before you can perform a PUT. –p55</p>
<p>| HEAD METHOD:<br>The HEAD method behaves exactly like the GET method, but the server returns<br>only the headers in the response. No entity body is ever returned.<br>Using HEAD, you can:</p>
<ul>
<li>Find out about a resource without getting it.</li>
<li>See if an object exists, by looking at the status code of the response.</li>
<li>Test if the resource has been modified, by looking at the headers.</li>
<li>-p54</li>
</ul>
<p>| The GET and HEAD methods are said to be safe, meaning that no action should<br>occur as a result of an HTTP request that uses either the GET or HEAD method.<br>–p53</p>
<p>| HTTP mesages can carry many kinds of digital data:  –p52</p>
<ul>
<li>images;</li>
<li>video;</li>
<li>HTML documents;</li>
<li>software applications;</li>
<li>credit card transactions;</li>
<li>electronic mail;</li>
<li>…</li>
</ul>
<p>| HTTP headers are classified into:  –p51</p>
<ul>
<li>General headers;</li>
<li>Request headers;</li>
<li>Response headers;</li>
<li>Entity headers;</li>
<li>Extension headers;</li>
</ul>
<p>| Version:<br>Note that version numbers are not treated as fractional numbers.<br>Each number in the version is treated as a separate number.<br>HTTP/2.22 &gt; HTTP/2.3, because 22 &gt; 3</p>
<p>| The numeric code makes error processing easy for programs, while the reason<br>phrase is easily understood by humans.(这样的存在总是有意义的)<br><img src="./http_status_code.png" alt="status_code"></p>
<p>| The method begins the start line of requests, telling the server what to do.<br>–p48</p>
<ul>
<li>GET</li>
<li>POST</li>
<li>PUSH</li>
<li>DELETE</li>
<li>HEAD</li>
<li>TRACE</li>
<li>OPTIONS<br><img src="./http_methods.png" alt="HTTP method"></li>
</ul>
<p>| The headders are terminated by a blank line (CRLF), marking the<br>end of the list of headers and the beginning of the entity body.<br>–p47</p>
<p>| messages –p46<br>request message:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">method</span>&gt;</span> <span class="tag">&lt;<span class="name">request-URL</span>&gt;</span> <span class="tag">&lt;<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">headers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">entity-body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>response message:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span> <span class="tag">&lt;<span class="name">status</span>&gt;</span> <span class="tag">&lt;<span class="name">reason-phrase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">headers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">entity-body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>| Both request and response messages have the same basic message structure.<br>(start line; headers; body) –pp45</p>
<p>| The Parts of a Message: –p44</p>
<ul>
<li>a start line describing the message;(Start line)</li>
<li>a block of headers containing attributes; (Headers)</li>
<li>an optional body containing data. (Body)</li>
</ul>
<p>| HTTP messages flow like rivers. All messages flow downstream,regardless of<br>whether they are request messages or response messages.(所有的消息流都downstream)<br>The sender of any message is upstream of the receiver.<br>在图3-2中，代理1是代理3请求的上流，回应的下流。 –p44</p>
<p>| Messages travel inbound to the origin server, and when their work is done,<br>they travel outbound back to the user agent. –p43</p>
<p>| Describe message direction: –p43</p>
<ul>
<li>inbound</li>
<li>outbound</li>
<li>upstream</li>
<li>downstream</li>
</ul>
<p>| HTTP messages are the blocks of data sent between HTTP applications (clients,<br>  servers, and proxies). These blocks of data begin with some text <code>meta-information</code><br>  describing the message contents and meaning, followed by optional data. –p43</p>
<p>| The chapter 3 aim to: –p43</p>
<ul>
<li>how to create them;</li>
<li>how to understand them;</li>
</ul>
<p>If HTTP is the Internet’s courier, HTTP messages are the packages it uses<br>to move things around. –p43</p>
<h2 id="CHAPTER-3-HTTP-Messages"><a href="#CHAPTER-3-HTTP-Messages" class="headerlink" title="CHAPTER 3: HTTP Messages"></a>CHAPTER 3: HTTP Messages</h2><p>| https: The https scheme is a twin to the http scheme. The only difference is<br>  that the https scheme uses Netscape’s Secure Sockets Layer (SSL), which provides<br>  end-to-end encryption of HTTP connnections. Its syntax is idential to that of<br>  HTTP, with a default port of 443. –p38</p>
<p>| In general, applications interpreting URLs must decode the URLs before<br>  processing them. –p37</p>
<p>| 字符限制(Character Restrictions)：有些字符是保留的，是有特殊意义的，<br>  不允许直接在URL中使用。（例如：% / . # ? ; : % + @ &amp; = { } [ ] ~ &lt; &gt;）–p36</p>
<p>| Encoding Mechanisms –p36</p>
<ul>
<li><code>%7E == ~</code></li>
<li><code>%20 == [space]</code></li>
<li><code>%25 == %</code></li>
<li><code>%40 == -</code></li>
</ul>
<p>| Shady Characters<br>nonprinting characters also are prohibited in URLs, even though these characters<br>may pass through mailers and otherwise be portable. –p35</p>
<p>| Expandomatic URLs –p34<br>two flavors:</p>
<ul>
<li>Hostname expansion.(eg. if you type “yahoo” in the address, your browser<br>can automatically insert “www.” and “.com” onto the hostname)</li>
<li>History expansion.(eg. if you were typing in the start of a URL that<br>you had visited previously, such as <code>http://www.joes-</code> your browser<br>could suggest <code>http://www.joes-hardware.com</code>)<br>Note: Be aware that URL auto-expansion may behave differently when used with proxies.</li>
</ul>
<p>| Using this URL as a base, we can infer the missing information. –p32</p>
<p>| Fragments (<frag>): To allow referencing of parts or fragments of a resource,<br> URLs support a frag component to identify pieces within a resource. –p30<br>(精确定位到文档具体位置，这个过程在 client 端进行，而不是 server 端。<br>  the server sends the entire object and the agent applies the fragment<br>  identifier to the resource)</frag></p>
<p>| Query component: There is no requirement for the format of the query component, except that some<br>characters are illegal.(查询组件对格式没有要求，但必须是合法的字符) –p29<br>跟在 <code>?</code> 后面的名值对，多个查询条件用 <code>&amp;</code> 分割：<code>?item=12731&amp;color=blue</code></p>
<p>| Auery Strings:<br>Some resources, such as database services, can be asked questions or queries to<br>narrow down the type of resource being requested. –p29</p>
<p>| If an application is using a URL scheme that requires a username and password,<br>such as FTP, it generally will insert a default username and password if<br>they aren’t supplied. –p27</p>
<p>| Scheme names are case-insensitive –p27<br>(Scheme的名字不区分大小写：例如<code>http://</code>和<code>HTTP://</code>是等效的)</p>
<p>| The scheme is really the main identifier of how to access a given resource.<br>–p27</p>
<p>| Most URL schemes base their URL syntax on this nine-part general format: –p26</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">-------------------------------------------------------------------------</span><br><span class="line">&lt;scheme&gt;<span class="symbol">://&lt;user&gt;</span><span class="symbol">:&lt;password&gt;</span>@&lt;host&gt;<span class="symbol">:&lt;port&gt;/&lt;path&gt;</span>;&lt;params&gt;<span class="string">?&lt;</span>query&gt;#&lt;frag&gt;</span><br><span class="line">-------------------------------------------------------------------------</span><br><span class="line">eg. <span class="symbol">http:</span>/<span class="regexp">/www.joes-hardware.com:80/index</span>.html</span><br></pre></td></tr></table></figure>

<p>| Urls give you and your browser all you need to find a piece of<br>information. They define the particular resource you want,<br>where it is located, and how to get it.</p>
<p>| <img src="/.com//url_component.png" alt="URL Component"></p>
<h2 id="CHAPTER-2-URLs-and-Resources"><a href="#CHAPTER-2-URLs-and-Resources" class="headerlink" title="CHAPTER 2: URLs and Resources"></a>CHAPTER 2: URLs and Resources</h2><p>| Agents<br>User agents (or just agents) are client programs that make HTTP requests on the<br>user’s behalf. (用来发出HTTP请求的客户端程序，例如：web浏览器) –p19</p>
<p>| Tunnels<br>HTTP tunnels are often used to transport non-HTTP data over one or more HTTP<br>connections, without looking at the data. –p19</p>
<p>| Gateways</p>
<p>| Caches</p>
<p>| Proxies<br>A proxy sits between a client and a server.<br>Proxies are often used for security, acting as trusted intermediaries<br>through which all web traffic flows. –p18</p>
<h2 id="Architectrual-Components-of-the-Web"><a href="#Architectrual-Components-of-the-Web" class="headerlink" title="Architectrual Components of the Web"></a>Architectrual Components of the Web</h2><p>| Protocol Versions –p16<br>HTTP/0.9 supports only the GET method.<br>1.0 was the first version of HTTP that was widely deployed.</p>
<p>| An HTTP transaction using telnet:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># telnet www.lyloou.com 80</span></span><br><span class="line">Trying 151.101.192.133...</span><br><span class="line">Connected to www.lyloou.com.</span><br><span class="line">Escape character is <span class="string">&#x27;^]&#x27;</span>.</span><br><span class="line">GET /index.html HTTP/1.1  <span class="comment"># input this</span></span><br><span class="line">Host: www.lyloou.com      <span class="comment"># input this</span></span><br><span class="line">                          <span class="comment"># input this</span></span><br><span class="line"></span><br><span class="line">HTTP/1.1 301 Moved Permanently</span><br><span class="line">Server: GitHub.com</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Location: http://lyloou.com/index.html</span><br><span class="line">X-GitHub-Request-Id: 26A4:06EC:8E05E6C:B479C11:58CB8810</span><br><span class="line">Content-Length: 178</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Date: Fri, 17 Mar 2017 06:54:08 GMT</span><br><span class="line">Via: 1.1 varnish</span><br><span class="line">Age: 0</span><br><span class="line">Connection: keep-alive</span><br><span class="line">X-Served-By: cache-lax8651-LAX</span><br><span class="line">X-Cache: MISS</span><br><span class="line">X-Cache-Hits: 0</span><br><span class="line">X-Timer: S1489733648.903540,VS0,VE68</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">X-Fastly-Request-ID: b8d3f5bbb2343450fd125b92f1dde483c5109377</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;&lt;title&gt;301 Moved Permanently&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body bgcolor=<span class="string">&quot;white&quot;</span>&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;301 Moved Permanently&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>| Telnet is commonly used for remote terminal sessions, but it can<br>generally connect to any TCP server, including HTTP servers.</p>
<p>| Establish a TCP/IP connection between the client and server:</p>
<ul>
<li>Internet protocol (IP) addresses</li>
<li>Port numbers</li>
</ul>
<p>| TCP/IP<br>Once a TCP connections is established, messages exchanged between the client and<br>server computers will never be lost, damaged, or received out of order. –p12</p>
<p>| HTTP messages consist of three parts: –p11</p>
<ol>
<li>Start line; (indicating what to do for a request and what happened for a<br>response)</li>
<li>Header fields; (Note: The headers end with a blank line)</li>
<li>Body; (can contain arbitray binary data. eg., images, videos, audio tracks,<br>software applications.)</li>
</ol>
<p>| Messages</p>
<ul>
<li>request messages: sent from web clients to web servers.</li>
<li>response messages: messages from servers to clients.<br>they are very similar.</li>
</ul>
<p>| Status Codes<br>Every HTTP response message comes back with a status code. –p9</p>
<p>| Methods<br>The method tells the server what action to perform (e.g. fetch a web page,<br>  delete a file, etc.) –p8</p>
<ul>
<li>GET</li>
<li>POST</li>
<li>DELETE</li>
<li>PUT</li>
<li>HEAD</li>
</ul>
<p>| Transactions<br>An HTTP transaction consists of: –p8</p>
<ul>
<li>a request command (sent from client to server).</li>
<li>a response result (sent from the server back to the client)</li>
</ul>
<p>| URNs<br>A URNs serves as a unique name for a particular piece of content,<br>independent of where the resource currently resides.<br>URNs are still experimental and not yet widely adopted. –p7</p>
<p>| URLs<br>URLs describe the specific location of a resource on a particular server.<br>contains three main parts: –p7</p>
<ul>
<li>scheme: (e.g., http://)</li>
<li>server Internet address (e.g., <a href="http://www.lyloou.com/">www.lyloou.com</a>)</li>
<li>names a resource on the web server (e.g., hello.gif)</li>
</ul>
<p>| URIs<br>URIs come in two flavors: URLs and URNs.</p>
<p>| Media Types<br>MIME was originally designed to solve problems encountered in moving messages<br>between different electronic mail systems.<br>MIME worked so well for email that HTTP adopted it to describe and label its<br>own multimedia content. –p5<br>eg.</p>
<ul>
<li>text/HTML</li>
<li>text/plain</li>
<li>image/jpeg</li>
<li>image/gif</li>
<li>video/quicktime</li>
<li>application/vnd.ms-powerpoint<br><a href="https://zh.wikipedia.org/wiki/%E5%A4%9A%E7%94%A8%E9%80%94%E4%BA%92%E8%81%AF%E7%B6%B2%E9%83%B5%E4%BB%B6%E6%93%B4%E5%B1%95">https://zh.wikipedia.org/wiki/多用途互聯網郵件擴展</a></li>
</ul>
<p>| Resources</p>
<ul>
<li>static file: text files, HTML files, Word files, JPEG files, AVI…</li>
<li>dynamic content: generate content based on your identity, on what<br>information you’ve requested, or on the time of day.(eg. show live image<br>  from a camera, trade stocks, search databases, buy gifts from online<br>  stores)</li>
</ul>
<p>| Because HTTP uses reliable data-transmission protocols, it guarantees that<br>your data will not be damaged or scrambled in transit, even when it comes from<br>the other side of the globe. –p3</p>
<p>| Throughout the book, we are careful to explain the “why” of HTTP, not just the<br>“how”.</p>
<p>| There are many books that  explain how to use Web,<br>but this is the book that explains how the Web works.</p>
<p>| The Definitive Guide is in understanding how the Web works<br>and how to apply that knowledge to web programming and administration.</p>
]]></content>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTP笔记</title>
    <url>/http/HTTP%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><ul>
<li><a href="http://www.cnblogs.com/TankXiao/archive/2012/02/06/2337728.html">Fiddler 教程 - 小坦克 - 博客园</a></li>
</ul>
<h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><ul>
<li><a href="http://www.cnblogs.com/TankXiao/archive/2012/02/13/2342672.html">HTTP协议详解 - 小坦克 - 博客园</a></li>
<li><a href="http://www.cnblogs.com/TankXiao/archive/2012/12/12/2794160.html">HTTP协议 (五) 代理 - 小坦克 - 博客园</a></li>
</ul>
<h2 id="post-amp-get"><a href="#post-amp-get" class="headerlink" title="post &amp; get"></a>post &amp; get</h2><ul>
<li><a href="https://www.xuyimin.club/article/15">Post与Get请求</a></li>
<li><a href="http://uule.iteye.com/blog/2302713">关于 HTTP GET/POST 请求参数长度最大值的一个理解误区</a></li>
</ul>
<h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><ul>
<li><a href="http://www.cnblogs.com/fish-li/archive/2011/07/03/2096903.html">细说Cookie</a></li>
<li><a href="http://www.cnblogs.com/TankXiao/archive/2013/04/15/2848906.html">HTTP协议 (七) Cookie - 小坦克 - 博客园</a></li>
</ul>
<h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><ul>
<li><a href="https://zhuanlan.zhihu.com/p/25484889">程序猿必读-防范CSRF跨站请求伪造</a></li>
</ul>
<h2 id="Oauth2-0"><a href="#Oauth2-0" class="headerlink" title="Oauth2.0"></a>Oauth2.0</h2><ul>
<li><a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html">理解OAuth 2.0 - 阮一峰的网络日志</a></li>
</ul>
]]></content>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title>Socket编程</title>
    <url>/http/socket/</url>
    <content><![CDATA[<blockquote>
<p>Socket:<br>The unique combination of IP address and Port number together are termed as Socket.<br>REF: <a href="https://www.geeksforgeeks.org/basics-computer-networking/">Basics of Computer Networking - GeeksforGeeks</a></p>
</blockquote>
<blockquote>
<p>socket 是一种操作系统提供的进程间通信机制。<br>REF: <a href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E8%B7%AF%E6%8F%92%E5%BA%A7">网络套接字 - 维基百科，自由的百科全书</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title>Tcp-Ip</title>
    <url>/http/tcp-ip%E5%A6%82%E4%BD%95%E8%BF%90%E4%BD%9C/</url>
    <content><![CDATA[<h2 id="为什么要分层？"><a href="#为什么要分层？" class="headerlink" title="为什么要分层？"></a>为什么要分层？</h2><ul>
<li>各层互相独立。<br>各层之间通过接口通信，接口不变，内部可以随意调整。降低了整个问题的复杂度。</li>
<li>灵活。<br>只要保证接口不变，技术革新不会引起其他层的变化。排除问题也需要只关注当前层。</li>
<li>结构上可分开。各层都可以采用最合适的技术来实现。<br>避免木桶效应，因为某一方面的技术不完善而影响 整体工作效率。</li>
<li>易于实现和维护。<br>将整个系统拆分成若干个相对独立的子系统。进行调试和维护时，可以对每一层单独调试，<br>易于排查和解决问题。</li>
<li>促进标准化工作。<br>精确定位各层的功能和服务。标准化后，可以随意替换某几层，对于使用和科研十分方便。</li>
</ul>
<hr>
<p>参考：</p>
<ul>
<li><a href="https://www.applysquare.com/topic-cn/V9UHWe49W/">为什么计算机网络协议都是分层的？有什么好处？ - 申请方</a></li>
<li><a href="http://www.tech-faq.com/osi-model.html">The OSI Model – What It Is; Why It Matters; Why It Doesn’t Matter.</a></li>
</ul>
<h2 id="分了哪几层？"><a href="#分了哪几层？" class="headerlink" title="分了哪几层？"></a>分了哪几层？</h2><p><img src="http://img.hb.aicdn.com/13cfad969ef263cbd2dbe10df1d7086630d909e298d1-ncE989_fw658"><br><img src="http://img.hb.aicdn.com/a5173f12197048ac74fc34c3cc44eb1ca0b9aa526c02-GQ8FwZ_fw658"></p>
<p>那 TCP/IP 是如何运作的呢？我们就拿妳常常连上的 Yahoo 入口网站来做个说明好了，整个联机的状态可以这样看：</p>
<p>应用程序阶段：妳打开浏览器，在浏览器上面输入网址列，按下 [Enter]。此时网址列与相关数据会被浏览器包成一个数据， 并向下传给 TCP/IP 的应用层；<br>应用层：由应用层提供的 HTTP 通讯协议，将来自浏览器的数据报起来，并给予一个应用层表头，再向传送层丢去；<br>传送层：由于 HTTP 为可靠联机，因此将该数据丢入 TCP 封包内，并给予一个 TCP 封包的表头，向网络层丢去；<br>网络层：将 TCP 包裹包进 IP 封包内，再给予一个 IP 表头 (主要就是来源与目标的 IP 啰)，向链结层丢去；<br>链结层：如果使用以太网络时，此时 IP 会依据 CSMA/CD 的标准，包裹到 MAC 讯框中，并给予 MAC 表头，再转成位串后， 利用传输媒体传送到远程主机上。<br>等到 Yahoo 收到你的包裹后，在依据相反方向拆解开来，然后交给对应的层级进行分析，最后就让 Yahoo 的 WWW 服务器软件得到你所想要的数据，该服务器软件再根据你的要求，取得正确的资料后，又依循上述的流程，一层一层的包装起来， 最后传送到你的手上！就是这样啰！</p>
<p>来源： <a href="http://cn.linux.vbird.org/linux_server/0110network_basic_1.php#ps4">http://cn.linux.vbird.org/linux_server/0110network_basic_1.php#ps4</a></p>
<h2 id="TCP协议三次握手过程分析-一江水-博客园"><a href="#TCP协议三次握手过程分析-一江水-博客园" class="headerlink" title="TCP协议三次握手过程分析 - 一江水 - 博客园"></a><a href="https://www.cnblogs.com/rootq/articles/1377355.html">TCP协议三次握手过程分析 - 一江水 - 博客园</a></h2><p>TCP(Transmission Control Protocol)传输控制协议<br>TCP是主机对主机层的传输控制协议，提供可靠的连接服务，采用三次握手确认建立一个连接：</p>
<p>位码即tcp标志位，有6种标示：SYN(synchronous建立联机) ACK(acknowledgement 确认) PSH(push传送) FIN(finish结束) RST(reset重置) URG(urgent紧急)Sequence number(顺序号码) Acknowledge number(确认号码)</p>
<p>第一次握手：主机A发送位码为syn＝1，随机产生seq number=1234567的数据包到服务器，主机B由SYN=1知道，A要求建立联机；</p>
<p>第二次握手：主机B收到请求后要确认联机信息，向A发送ack number=(主机A的seq+1)，syn=1，ack=1，随机产生seq=7654321的包；<br>第三次握手：主机A收到后检查ack number是否正确，即第一次发送的seq number+1，以及位码ack是否为1，若正确，主机A会再发送ack number=(主机B的seq+1)，ack=1，主机B收到后确认seq值与ack=1则连接建立成功。</p>
]]></content>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title>三次握手</title>
    <url>/http/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B/</url>
    <content><![CDATA[<h2 id="简单理解"><a href="#简单理解" class="headerlink" title="简单理解"></a>简单理解</h2><p>三资握手的目的是：确认自己的接收能力和发送能力OK，还要确认对方的接收能力和发送能力OK；</p>
<ol>
<li>A发送给B，B收到了； B知道自己的接收能力OK，对方的发送能力OK；</li>
<li>B回复给A，A收到了； A知道自己的接收能力OK，自己的发送能力OK，对方的接收能力OK，对方的发送能力OK；（但是B还不知道自己的发送能力和A的接收能力是否OK，所以需要第三次握手）</li>
<li>A发送给B，B收到了； B知道自己的发送能力OK；A的接收能力OK；</li>
</ol>
<h2 id="状态机"><a href="#状态机" class="headerlink" title="状态机"></a>状态机</h2><p><img src="https://github.com/lyloou/img/raw/develop/z/20190124151245.jpg"></p>
<h2 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h2><h3 id="为什么建链接要三次？"><a href="#为什么建链接要三次？" class="headerlink" title="为什么建链接要三次？"></a>为什么建链接要三次？</h3><p>保证能成功通知对方自己的ISN（Initial Sequence Number，这个ISN是作为自己以后数据通信的序号）。</p>
<blockquote>
<p>主要是要初始化Sequence Number 的初始值。通信的双方要互相通知对方自己的初始化的Sequence Number（缩写为ISN：Inital Sequence Number）——所以叫SYN，全称Synchronize Sequence Numbers。也就上图中的 x 和 y。这个号要作为以后的数据通信的序号，以保证应用层接收到的数据不会因为网络上的传输的问题而乱序（TCP会用这个序号来拼接数据）。</p>
</blockquote>
<h3 id="如何保证数据到达"><a href="#如何保证数据到达" class="headerlink" title="如何保证数据到达"></a>如何保证数据到达</h3><p>数据重传机制</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>客户端：C （192.168.103.34）<br>服务端：S （14.18.201.48）</p>
<p>第一次握手：<br>首先C发起连接请求 <code>[syn] Seq=2070720725</code>，<br>C进入SYN_SEND状态；<br><img src="https://github.com/lyloou/img/raw/develop/z/20190124145542.png"> </p>
<p>第二次握手：<br>接着S收到请求后，返回 <code>[syn ack] Seq=3747916590 Ack=2070720726</code><br>S进入SYN_RECV状态；<br><img src="https://github.com/lyloou/img/raw/develop/z/20190124145609.png"></p>
<p>第三次握手：<br>C收到S返回的信息，验证成功后返回确认信息 <code>[ack] Seq=2070720726 Ack=3747916590</code><br>C进入ESTABLISH状态。S收到后也进入ESTABLISH状态。<br><img src="https://github.com/lyloou/img/raw/develop/z/20190124145626.png"></p>
<p>注意：wireshark默认显示的sequence number是相对的数字 ，可以通过如下图的方式取消<br><img src="https://github.com/lyloou/img/raw/develop/z/20190124145823.png"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://coolshell.cn/articles/11564.html">TCP 的那些事儿（上） | | 酷 壳 - CoolShell</a></li>
</ul>
]]></content>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title>网络学习资料</title>
    <url>/http/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/</url>
    <content><![CDATA[<ul>
<li><a href="https://www.geeksforgeeks.org/computer-network-tutorials/">Computer Network Tutorials - GeeksforGeeks</a></li>
</ul>
]]></content>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title>网络名词解释</title>
    <url>/http/%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A/</url>
    <content><![CDATA[<p><a href="https://www.geeksforgeeks.org/basics-computer-networking/">Basics of Computer Networking - GeeksforGeeks</a></p>
<h2 id="幂等"><a href="#幂等" class="headerlink" title="幂等"></a>幂等</h2><h3 id="幂等-百度百科"><a href="#幂等-百度百科" class="headerlink" title="幂等_百度百科"></a><a href="https://baike.baidu.com/item/%E5%B9%82%E7%AD%89">幂等_百度百科</a></h3><p>在编程中一个幂等操作的特点是其任意多次执行所产生的影响均与一次执行的影响相同。</p>
<h3 id="理解HTTP幂等性-Todd-Wei-博客园"><a href="#理解HTTP幂等性-Todd-Wei-博客园" class="headerlink" title="理解HTTP幂等性 - Todd Wei - 博客园"></a><a href="https://www.cnblogs.com/weidagang2046/archive/2011/06/04/idempotence.html">理解HTTP幂等性 - Todd Wei - 博客园</a></h3><p>另一种更轻量级的解决方案是幂等设计。我们可以通过一些技巧把withdraw变成幂等的，比如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">create_ticket</span><span class="params">()</span> </span><br><span class="line">bool <span class="title function_">idempotent_withdraw</span><span class="params">(ticket_id, account_id, amount)</span></span><br></pre></td></tr></table></figure>

<p>create_ticket的语义是获取一个服务器端生成的唯一的处理号ticket_id，它将用于标识后续的操作。idempotent_withdraw和withdraw的区别在于关联了一个ticket_id，一个ticket_id表示的操作至多只会被处理一次，每次调用都将返回第一次调用时的处理结果。这样，idempotent_withdraw就符合幂等性了，客户端就可以放心地多次调用。</p>
<p>基于幂等性的解决方案中一个完整的取钱流程被分解成了两个步骤：1.调用create_ticket()获取ticket_id；2.调用idempotent_withdraw(ticket_id, account_id, amount)。虽然create_ticket不是幂等的，但在这种设计下，它对系统状态的影响可以忽略，加上idempotent_withdraw是幂等的，所以任何一步由于网络等原因失败或超时，客户端都可以重试，直到获得结果。<br><img src="https://images.cnblogs.com/cnblogs_com/weidagang2046/201106/201106042051069339.png"></p>
<h3 id="POST-和-PUT-在幂等性方面有所不同"><a href="#POST-和-PUT-在幂等性方面有所不同" class="headerlink" title="POST 和 PUT 在幂等性方面有所不同"></a>POST 和 PUT 在幂等性方面有所不同</h3><blockquote>
<p>The POST method is used to request that the origin server accept the entity enclosed in the request as a new subordinate of the resource identified by the Request-URI in the Request-Line …… If a resource has been created on the origin server, the response SHOULD be 201 (Created) and contain an entity which describes the status of the request and refers to the new resource, and a Location header.<br>The PUT method requests that the enclosed entity be stored under the supplied Request-URI. If the Request-URI refers to an already existing resource, the enclosed entity SHOULD be considered as a modified version of the one residing on the origin server. If the Request-URI does not point to an existing resource, and that URI is capable of being defined as a new resource by the requesting user agent, the origin server can create the resource with that URI.<br>POST所对应的URI并非创建的资源本身，而是资源的接收者。<br>比如：POST <code>http://www.forum.com/articles</code>的语义是在<code>http://www.forum.com/articles</code>下创建一篇帖子，HTTP响应中应包含帖子的创建状态以及帖子的URI。两次相同的POST请求会在服务器端创建两份资源，它们具有不同的URI；所以，POST方法不具备幂等性。而PUT所对应的URI是要创建或更新的资源本身。比如：PUT <code>http://www.forum/articles/4231</code>的语义是创建或更新ID为4231的帖子。对同一URI进行多次PUT的副作用和一次PUT是相同的；因此，PUT方法具有幂等性。  </p>
</blockquote>
<p><a href="https://www.cnblogs.com/weidagang2046/archive/2011/06/04/idempotence.html">https://www.cnblogs.com/weidagang2046/archive/2011/06/04/idempotence.html</a></p>
]]></content>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title>【Java】通过 Getter 方法引用，来比较两个对象是否相等</title>
    <url>/java/Equable/</url>
    <content><![CDATA[<h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>编写代码时，会经常需要编写两个对象是否相等的逻辑，一般会有如下做法</p>
<ol>
<li>直接写在业务代码中；</li>
<li>单独写个方法，业务代码中调用；</li>
<li>重写 equals 方法；</li>
</ol>
<p>上面这些做法，都比较复杂，如果属性太多或复杂点（如果是 list 和 map 就更复杂了），就需要编写更多的判断逻辑代码了。</p>
<h4 id="想法"><a href="#想法" class="headerlink" title="想法"></a>想法</h4><p>如果能只需要提供比较的方法引用列表，有个地方能自动方法引用取值，并比较就好了。</p>
<h4 id="思路-1"><a href="#思路-1" class="headerlink" title="思路 1"></a>思路 1</h4><ol>
<li>在 java8 中可以使用方法引用，如：People::getName；</li>
<li>可以将所有要比较的 Getter 保存到列表中；</li>
<li>在 比较的时候，根据 方法引用获取具体的值进行比较；</li>
<li>全部比较都相等了，就认为是相等的。</li>
</ol>
<h4 id="思路-2"><a href="#思路-2" class="headerlink" title="思路 2"></a>思路 2</h4><ol>
<li>思路 1 适用于需要比较的字段少时，有一种情况是，需要比较的字段多，只想排除掉少量字段</li>
<li>通过注解来忽略指定的字段</li>
<li>获取全部字段，过滤掉忽略的字段，通过反射比较字段对应的值。</li>
</ol>
<h4 id="举个例子-1-改造前"><a href="#举个例子-1-改造前" class="headerlink" title="举个例子 1(改造前)"></a>举个例子 1(改造前)</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EqualDemo</span> <span class="keyword">implements</span> <span class="title class_">Equable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">    <span class="keyword">private</span> List&lt;EqualDemo&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, EqualDemo&gt; map;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> EqualDemo) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!Objects.equals(((EqualDemo) obj).getId(), <span class="built_in">this</span>.getId())) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!Objects.equals(((EqualDemo) obj).getAge(), <span class="built_in">this</span>.getAge())) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!Objects.equals(((EqualDemo) obj).getUsername(), <span class="built_in">this</span>.getUsername())) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">final</span> List&lt;EqualDemo&gt; list1 = ((EqualDemo) obj).getList();</span><br><span class="line">            <span class="keyword">final</span> List&lt;EqualDemo&gt; list2 = <span class="built_in">this</span>.getList();</span><br><span class="line">            <span class="comment">// todo 比较 list1 和 list2</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> Map&lt;String, EqualDemo&gt; map1 = ((EqualDemo) obj).getMap();</span><br><span class="line">            <span class="keyword">final</span> Map&lt;String, EqualDemo&gt; map2 = <span class="built_in">this</span>.getMap();</span><br><span class="line">            <span class="comment">// todo 比较 map1 和 map2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Objects.equals(<span class="built_in">this</span>, obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EqualDemoTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimpleTrue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">EqualDemo</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EqualDemo</span>();</span><br><span class="line">        s1.setId(<span class="number">1</span>);</span><br><span class="line">        s1.setUsername(<span class="string">&quot;bob&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">EqualDemo</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EqualDemo</span>();</span><br><span class="line">        s2.setId(<span class="number">1</span>);</span><br><span class="line">        s2.setUsername(<span class="string">&quot;bob&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// // s1 和 s2 相等</span></span><br><span class="line">        <span class="keyword">assert</span> s1.equals(s2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="举个例子-2-改造后-指定需要比较的字段的-Getter-方法引用"><a href="#举个例子-2-改造后-指定需要比较的字段的-Getter-方法引用" class="headerlink" title="举个例子 2(改造后-指定需要比较的字段的 Getter 方法引用)"></a>举个例子 2(改造后-指定需要比较的字段的 Getter 方法引用)</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OnlyEqualDemo</span> <span class="keyword">implements</span> <span class="title class_">Equable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">    <span class="keyword">private</span> List&lt;OnlyEqualDemo&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, OnlyEqualDemo&gt; map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;EqualGetter&lt;OnlyEqualDemo&gt;&gt; <span class="title function_">listOnlyEqualsToGetter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> EqualGetter&lt;OnlyEqualDemo&gt; getId = OnlyEqualDemo::getId;</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(</span><br><span class="line">                getId,</span><br><span class="line">                OnlyEqualDemo::getAge,</span><br><span class="line">                OnlyEqualDemo::getUsername,</span><br><span class="line">                OnlyEqualDemo::getList,</span><br><span class="line">                OnlyEqualDemo::getMap</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OnlyEqualDemoTest</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimpleTrue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">OnlyEqualDemo</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OnlyEqualDemo</span>();</span><br><span class="line">        s1.setId(<span class="number">1</span>);</span><br><span class="line">        s1.setUsername(<span class="string">&quot;bob&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">OnlyEqualDemo</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OnlyEqualDemo</span>();</span><br><span class="line">        s2.setId(<span class="number">1</span>);</span><br><span class="line">        s2.setUsername(<span class="string">&quot;bob&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// // s1 和 s2 相等</span></span><br><span class="line">        <span class="keyword">assert</span> s1.onlyEqualsTo(s2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="举个例子-3-改造后-排除少量字段"><a href="#举个例子-3-改造后-排除少量字段" class="headerlink" title="举个例子 3(改造后-排除少量字段)"></a>举个例子 3(改造后-排除少量字段)</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IgnoreEqualDemo</span> <span class="keyword">implements</span> <span class="title class_">Equable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EqualIgnored</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EqualIgnored</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EqualIgnored</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;IgnoreEqualDemo&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, IgnoreEqualDemo&gt; map;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IgnoreEqualDemoTest</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimpleTrue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">IgnoreEqualDemo</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IgnoreEqualDemo</span>();</span><br><span class="line">        s1.setId(<span class="number">1</span>);</span><br><span class="line">        s1.setUsername(<span class="string">&quot;bob&quot;</span>);</span><br><span class="line">        s1.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">IgnoreEqualDemo</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IgnoreEqualDemo</span>();</span><br><span class="line">        s2.setId(<span class="number">1</span>);</span><br><span class="line">        s2.setUsername(<span class="string">&quot;bob&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// // s1 和 s2 相等</span></span><br><span class="line">        <span class="keyword">assert</span> s1.ignoreEqualsTo(s2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就简洁很多了，由于 ignoreEqualsTo 和 onlyEqualsTo 方法是 Equable 接口中的默认方法，具体逻辑全封装起来了（包括 object, collection 和 map 的处理），不需要重写就可以直接使用，具体实现看下面的源码。</p>
<h4 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.beans.PropertyDescriptor;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.BiFunction;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 比较两个对象是否相等</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lilou</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/4/9 9:30</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Equable#onlyEqualsTo(Equable) 方法1：通过 Getter方法引用 来指定需要比较的字段（场景：字段总量多，但是只需要比较少量字段时）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Equable#ignoreEqualsTo(Equable) 方法2：通过忽略注解(&#123;<span class="doctag">@code</span> EqualIgnored&#125;)来指定忽略比较的字段，未标识的字段会全部参与比较（场景：字段总量多，但是只需要排除少量字段时）</span></span><br><span class="line"><span class="comment"> * 注意：onlyEqualsTo 和 ignoreEqualsTo 不要混用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Equable</span> <span class="keyword">extends</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用方法引用来比较，只比较指定的 Getter 方法引用。</span></span><br><span class="line"><span class="comment">     * 使用此方法：重写 listOnlyEqualsToGetter 方法，指定需要比较的字段的Getter方法引用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> other 另一个 model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">onlyEqualsTo</span><span class="params">(Equable other)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> List&lt;EqualGetter&lt;Equable&gt;&gt; getterList = listOnlyEqualsToGetter();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// getter方法引用列表中没有需要比较的 getter，直接比较对象</span></span><br><span class="line">        <span class="keyword">if</span> (getterList == <span class="literal">null</span> || getterList.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> Objects.equals(other, <span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 列表有值，计算两个对象在列表中 getter 值，并比较是否相等</span></span><br><span class="line">        <span class="keyword">for</span> (EqualGetter&lt;Equable&gt; equalGetter : getterList) &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">o1</span> <span class="operator">=</span> equalGetter.apply(<span class="built_in">this</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">o2</span> <span class="operator">=</span> equalGetter.apply(other);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 对于属性中也有实现了 Equable 接口的，递归调用</span></span><br><span class="line">            <span class="keyword">if</span> (o1 <span class="keyword">instanceof</span> Equable &amp;&amp; o2 <span class="keyword">instanceof</span> Equable) <span class="keyword">return</span> ((Equable) o1).onlyEqualsTo((Equable) o2);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// equalTo collection</span></span><br><span class="line">            <span class="keyword">if</span> (o1 <span class="keyword">instanceof</span> Collection &amp;&amp; o2 <span class="keyword">instanceof</span> Collection) &#123;</span><br><span class="line">                <span class="comment">// 判断不相等</span></span><br><span class="line">                <span class="keyword">if</span> (notEqualsCollection((Collection&lt;?&gt;) o1, (Collection&lt;?&gt;) o2, Equable::onlyEqualsTo)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 列表已经判断完了，开始下一个属性</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// equalTo map</span></span><br><span class="line">            <span class="keyword">if</span> (o1 <span class="keyword">instanceof</span> Map &amp;&amp; o2 <span class="keyword">instanceof</span> Map) &#123;</span><br><span class="line">                <span class="keyword">if</span> (notEqualsMap((Map&lt;?, ?&gt;) o1, (Map&lt;?, ?&gt;) o2, Equable::onlyEqualsTo)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="comment">// 列表已经判断完了，开始下一个属性</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!Objects.equals(o1, o2)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">notEqualsMap</span><span class="params">(Map&lt;?, ?&gt; o1, Map&lt;?, ?&gt; o2, BiFunction&lt;Equable, Equable, Boolean&gt; biFunc)</span> &#123;</span><br><span class="line">        <span class="comment">// 比较 key</span></span><br><span class="line">        <span class="keyword">final</span> Collection&lt;?&gt; set1 = o1.keySet();</span><br><span class="line">        <span class="keyword">final</span> Collection&lt;?&gt; set2 = o2.keySet();</span><br><span class="line">        <span class="keyword">if</span> (notEqualsCollection(set1, set2, biFunc)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 比较 value</span></span><br><span class="line">        <span class="keyword">final</span> Collection&lt;?&gt; values1 = o1.values();</span><br><span class="line">        <span class="keyword">final</span> Collection&lt;?&gt; values2 = o2.values();</span><br><span class="line">        <span class="keyword">return</span> notEqualsCollection(values1, values2, biFunc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断 collection 是否不相等</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o1 第一个 collection</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> o2 第二个 collection</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否不相等</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">notEqualsCollection</span><span class="params">(Collection&lt;?&gt; o1, Collection&lt;?&gt; o2, BiFunction&lt;Equable, Equable, Boolean&gt; biFunc)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(o1) &amp;&amp; Objects.isNull(o2)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(o1) || Objects.isNull(o2)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (o1.isEmpty() &amp;&amp; o2.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (o1.size() != o2.size()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据 hashCode 来排序</span></span><br><span class="line">        o1 = o1.stream().sorted(Comparator.comparingInt(Object::hashCode)).collect(Collectors.toList());</span><br><span class="line">        o2 = o2.stream().sorted(Comparator.comparingInt(Object::hashCode)).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 逐个比较</span></span><br><span class="line">        <span class="keyword">final</span> Iterator&lt;?&gt; iterator1 = o1.iterator();</span><br><span class="line">        <span class="keyword">final</span> Iterator&lt;?&gt; iterator2 = o2.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator1.hasNext() &amp;&amp; iterator2.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">next1</span> <span class="operator">=</span> iterator1.next();</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">next2</span> <span class="operator">=</span> iterator2.next();</span><br><span class="line">            <span class="keyword">if</span> (next1 <span class="keyword">instanceof</span> Equable &amp;&amp; next2 <span class="keyword">instanceof</span> Equable) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!biFunc.apply((Equable) next1, (Equable) next2)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> !Objects.equals(next1, next2);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需重写</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 需要比较的 Getter 方法列表（原理是通过Getter 的 apply 方法得到实际的值，再进行比较）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt; 泛型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> getter 方法列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">default</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Equable</span>&gt; List&lt;EqualGetter&lt;T&gt;&gt; <span class="title function_">listOnlyEqualsToGetter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * getter方法接口定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@FunctionalInterface</span></span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">EqualGetter</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Equable</span>&gt; <span class="keyword">extends</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">        Object <span class="title function_">apply</span><span class="params">(T source)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * IgnoreEqual 注解+反射来实现 equal 逻辑</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> other 另一个 model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">ignoreEqualsTo</span><span class="params">(Equable other)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (Objects.equals(<span class="built_in">this</span>, other)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">Equable</span>&gt; aClass1 = <span class="built_in">this</span>.getClass();</span><br><span class="line">        <span class="keyword">final</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">Equable</span>&gt; aClass2 = other.getClass();</span><br><span class="line">        <span class="keyword">if</span> (!Objects.equals(aClass1, aClass2)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Field[] declaredFields = aClass1.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field declaredField : declaredFields) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 字段是否被标记忽略</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">EqualIgnored</span> <span class="variable">isIgnored</span> <span class="operator">=</span> declaredField.getAnnotation(EqualIgnored.class);</span><br><span class="line">            <span class="keyword">if</span> (Objects.nonNull(isIgnored)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> <span class="type">PropertyDescriptor</span> <span class="variable">propertyDescriptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PropertyDescriptor</span>(declaredField.getName(), aClass1);</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Method</span> <span class="variable">readMethod</span> <span class="operator">=</span> propertyDescriptor.getReadMethod();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">o1</span> <span class="operator">=</span> readMethod.invoke(<span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">o2</span> <span class="operator">=</span> readMethod.invoke(other);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 对于属性中也有实现了 Equable 接口的，递归调用</span></span><br><span class="line">            <span class="keyword">if</span> (o1 <span class="keyword">instanceof</span> Equable &amp;&amp; o2 <span class="keyword">instanceof</span> Equable) <span class="keyword">return</span> ((Equable) o1).ignoreEqualsTo((Equable) o2);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// equalTo collection</span></span><br><span class="line">            <span class="keyword">if</span> (o1 <span class="keyword">instanceof</span> Collection &amp;&amp; o2 <span class="keyword">instanceof</span> Collection) &#123;</span><br><span class="line">                <span class="comment">// 判断不相等</span></span><br><span class="line">                <span class="keyword">if</span> (notEqualsCollection((Collection&lt;?&gt;) o1, (Collection&lt;?&gt;) o2, Equable::ignoreEqualsTo)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 列表已经判断完了，开始下一个属性</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// equalTo map</span></span><br><span class="line">            <span class="keyword">if</span> (o1 <span class="keyword">instanceof</span> Map &amp;&amp; o2 <span class="keyword">instanceof</span> Map) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (notEqualsMap((Map&lt;?, ?&gt;) o1, (Map&lt;?, ?&gt;) o2, Equable::ignoreEqualsTo)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 列表已经判断完了，开始下一个属性</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!Objects.equals(o1, o2)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EqualIgnored &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h4><p><strong>方法 1：</strong></p>
<p><a href="https://github.com/lyloou/component/blob/master/component-dto/src/test/java/com/lyloou/component/dto/OnlyEqualDemoTest.java">https://github.com/lyloou/component/blob/master/component-dto/src/test/java/com/lyloou/component/dto/OnlyEqualDemoTest.java</a><br><img src="https://raw.githubusercontent.com/lyloou/img/develop/Equable_20220410103323_2022-04-10-10-33-24.png" alt="Equable_20220410103323_2022-04-10-10-33-24"></p>
<p><strong>方法 2：</strong></p>
<p><a href="https://github.com/lyloou/component/blob/master/component-dto/src/test/java/com/lyloou/component/dto/IgnoreEqualDemoTest.java">https://github.com/lyloou/component/blob/master/component-dto/src/test/java/com/lyloou/component/dto/IgnoreEqualDemoTest.java</a><br><img src="https://raw.githubusercontent.com/lyloou/img/develop/Equable_20220410103408_2022-04-10-10-34-09.png" alt="Equable_20220410103408_2022-04-10-10-34-09"></p>
<h2 id="参考资源"><a href="#参考资源" class="headerlink" title="参考资源"></a>参考资源</h2><ul>
<li><a href="https://github.com/lyloou/component/blob/master/component-dto/src/main/java/com/lyloou/component/dto/Equable.java">https://github.com/lyloou/component/blob/master/component-dto/src/main/java/com/lyloou/component/dto/Equable.java</a></li>
<li><a href="https://github.com/lyloou/component/blob/master/component-dto/src/main/java/com/lyloou/component/dto/field/FieldUtil.java">https://github.com/lyloou/component/blob/master/component-dto/src/main/java/com/lyloou/component/dto/field/FieldUtil.java</a></li>
</ul>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM</title>
    <url>/java/JVM/</url>
    <content><![CDATA[<h2 id="查看堆栈信息"><a href="#查看堆栈信息" class="headerlink" title="查看堆栈信息"></a>查看堆栈信息</h2><h3 id="查看当前机器上运行的-java-进程"><a href="#查看当前机器上运行的-java-进程" class="headerlink" title="查看当前机器上运行的 java 进程"></a>查看当前机器上运行的 java 进程</h3><p><a href="https://blog.csdn.net/u013891584/article/details/80983494">JVM–查看堆栈信息<em>u013891584 的博客-CSDN 博客</em>如何查看堆栈信息</a></p>
<p><code>jps -lvm</code><br>命令格式 jps [options][hostid]<br>注：如果不指定 hostid 就默认为当前主机或服务器。<br>命令行参数选项说明如下：<br>-q 不输出类名、Jar 名和传入 main 方法的参数<br>-m 输出传入 main 方法的参数<br>-l 输出 main 类或 Jar 的全限名<br>-v 输出传入 JVM 的参数</p>
<p><code>jstat -gc 21275</code><br>-gc 垃圾回收堆的行为统计，常用命令<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/20210702091905.png" alt="JVM_2020-08-11-15-37-17"><br>C 即 Capacity 总容量，U 即 Used 已使用的容量<br>S0C : survivor0 区的总容量<br>S1C : survivor1 区的总容量<br>S0U : survivor0 区已使用的容量<br>S1C : survivor1 区已使用的容量<br>EC : Eden 区的总容量<br>EU : Eden 区已使用的容量<br>OC : Old 区的总容量<br>OU : Old 区已使用的容量<br>MC：方法区大小<br>MU：方法区使用大小<br>CCSC:压缩类空间大小<br>CCSU:压缩类空间使用大小<br>YGC : 新生代垃圾回收次数<br>YGCT : 新生代垃圾回收时间<br>FGC : 老年代垃圾回收次数<br>FGCT : 老年代垃圾回收时间<br>GCT : 垃圾回收总消耗时间</p>
<p><code>jstat -gc 1262 2000 20</code><br>这个命令意思就是每隔 2000ms 输出 1262 的 gc 情况，一共输出 20 次</p>
<p><a href="https://blog.csdn.net/Daybreak1209/article/details/80540360">JVM 堆、栈信息监测<em>Think In JAVA—Max-CSDN 博客</em>查看 jvm 堆栈信息</a><br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/20210702091918.png" alt="JVM_2020-08-11-15-45-17"></p>
<h2 id="Class-文件字节码结构示意图"><a href="#Class-文件字节码结构示意图" class="headerlink" title="Class 文件字节码结构示意图"></a>Class 文件字节码结构示意图</h2><p><img src="https://github.com/lyloou/img/raw/develop/z/20191023193030.png" alt="this is an image"></p>
<h2 id="visualvm-plugin"><a href="#visualvm-plugin" class="headerlink" title="visualvm plugin"></a>visualvm plugin</h2><p><a href="https://visualvm.github.io/pluginscenters.html">https://visualvm.github.io/pluginscenters.html</a><br>(注意如果是用 jvisualvm，要选择<code>Java VisualVM</code>的地址))</p>
<ul>
<li><a href="https://howtodoinjava.com/java/basics/jdk-jre-jvm/">What is Java JDK, JRE and JVM - In-depth Analysis - HowToDoInJava</a></li>
<li><a href="https://www.ibm.com/support/knowledgecenter/en/SSYKE2_8.0.0/com.ibm.java.vm.80.doc/docs/jit_optimize.html">How the JIT compiler optimizes code</a></li>
</ul>
<h2 id="JVM-相关问题"><a href="#JVM-相关问题" class="headerlink" title="JVM 相关问题"></a>JVM 相关问题</h2><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">; vi /etc/supervisord.conf</span></span><br><span class="line"><span class="section">[program:xxl-job-admin-7005]</span></span><br><span class="line"><span class="attr">command</span>=java -XX:-UseGCOverheadLimit -jar /data/www/xxl-job-admin/xxl-job-admin-<span class="number">7005</span>.jar --server.port=<span class="number">7005</span></span><br><span class="line"><span class="attr">autostart</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">autorestart</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">user</span> = omadmin</span><br><span class="line"><span class="attr">redirect_stderr</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">stdout_logfile_maxbytes</span>=<span class="number">100</span>MB</span><br><span class="line"><span class="attr">stdout_logfile</span> = /data/log/xxl-job-admin/xxl-job-admin.log</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/casablancaagnes_3sdf/article/details/52299100">-XX:-UseGCOverheadLimit 参数 java.lang.OutOfMemoryError：GC overhead limit exceeded 填坑心得_cas3$#%nca%6nes_3sdf 的博客-CSDN 博客_usegcoverheadlimit 有什么作用</a></p>
<h2 id="JVM-垃圾回收-之-强引用、弱引用、软引用、虚引用-cyt-CSDN-博客"><a href="#JVM-垃圾回收-之-强引用、弱引用、软引用、虚引用-cyt-CSDN-博客" class="headerlink" title="JVM 垃圾回收 之 强引用、弱引用、软引用、虚引用_cyt-CSDN 博客"></a><a href="https://blog.csdn.net/qq_41291945/article/details/108549120">JVM 垃圾回收 之 强引用、弱引用、软引用、虚引用_cyt-CSDN 博客</a></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Strong</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 强引用 是最常见的引用， 首先用 new 关键字创建对象的时候</span></span><br><span class="line"><span class="comment">     * 这个对象就是一个强引用也就是默认的引用类型。 只要强引用的对象</span></span><br><span class="line"><span class="comment">     * 是可触及的， 那么他就不会被回收！如果强引用对象超过了他的作用范围</span></span><br><span class="line"><span class="comment">     * 或者被设置为 null  那就可以被回收了。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 只要有强引用在， 当内存不足的时候jvm就算抛出OOM也不会回收掉它！</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">test_strong_reference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;test strong reference&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">test</span> <span class="operator">=</span> test_strong_reference;</span><br><span class="line">        test_strong_reference = <span class="literal">null</span>;</span><br><span class="line">        System.gc();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;test_strong_reference - &gt; &quot;</span>+ test_strong_reference);</span><br><span class="line">        System.out.println(<span class="string">&quot;test - &gt; &quot;</span>+test);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Soft</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 软引用， 用来描述那些还有用， 但是不是必须用的对象， 只被软引用关联着的对象</span></span><br><span class="line"><span class="comment">     * 在系统内存溢出之前，会把这些对象列进入回收范围之内进行二次回收， 如果回收之后</span></span><br><span class="line"><span class="comment">     * 内存还不够的话， 就抛出内存溢出的异常.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 可以在一些内存敏感的地方 进行使用, 高速缓存之类的</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 内存够用的时候就保留软引用的可达对象</span></span><br><span class="line"><span class="comment">     * 内存不够的时候就回收可达对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">cuiyt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&quot;cuiyt&quot;</span>);</span><br><span class="line">        SoftReference&lt;User&gt; reference = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;User&gt;(cuiyt);</span><br><span class="line">        cuiyt = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(reference.get().toString());</span><br><span class="line">        System.gc();</span><br><span class="line">        System.out.println(<span class="string">&quot;after - &gt; &quot;</span> + reference.get().toString());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">7</span>];</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(reference.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Weak</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 弱引用， 发送GC就会被回收掉！ 不管内存够不够</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        WeakReference&lt;User&gt; test = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;User&gt;(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&quot;@cuiyut&quot;</span>));</span><br><span class="line">        System.out.println(test.get());</span><br><span class="line">        System.gc();</span><br><span class="line">        System.out.println(test.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Empty</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Empty empty;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PhantomReference&lt;Empty&gt; reference;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ReferenceQueue&lt;Empty&gt; queue;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.finalize();</span><br><span class="line">        System.out.println(<span class="string">&quot;调用 finalize&quot;</span>);</span><br><span class="line">        empty = <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Check</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="built_in">super</span>.run();</span><br><span class="line">                <span class="keyword">if</span> (reference != <span class="literal">null</span>) &#123;</span><br><span class="line">                    PhantomReference&lt;Empty&gt; test = <span class="literal">null</span>;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        test = (PhantomReference&lt;Empty&gt;) queue.remove();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (test != <span class="literal">null</span>) &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;跟踪垃圾回收过程， Empty 被GC&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 形同虚设的一个引用类型， 当试图从虚引用中获得对象的时候</span></span><br><span class="line"><span class="comment">     * 它总是空的 ！ 为一个对象设置虚引用关联的唯一目的是跟踪垃圾回收的过程</span></span><br><span class="line"><span class="comment">     * 比如: 能在这个对象被回收的时候发出一个通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Check</span> <span class="variable">check</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Check</span>();</span><br><span class="line">        check.setDaemon(<span class="literal">true</span>);</span><br><span class="line">        check.start();</span><br><span class="line"></span><br><span class="line">        queue = <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>&lt;&gt;();</span><br><span class="line">        empty = <span class="keyword">new</span> <span class="title class_">Empty</span>();</span><br><span class="line">        reference = <span class="keyword">new</span> <span class="title class_">PhantomReference</span>&lt;&gt;(empty, queue);</span><br><span class="line">        <span class="comment">// 取消强引用</span></span><br><span class="line">        empty = <span class="literal">null</span>;</span><br><span class="line">        System.out.println(reference.get());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;第一次GC&quot;</span>);</span><br><span class="line">        <span class="comment">// 把回收的对象， 放到引用队列中</span></span><br><span class="line">        System.gc();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;after 第一次GC&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (empty != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;empty 可用&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;empty 不可用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;第二次GC&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 取消强引用</span></span><br><span class="line">        empty = <span class="literal">null</span>;</span><br><span class="line">        System.gc();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;after 第二次GC&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (empty != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;empty 可用&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;empty 不可用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>网络</title>
    <url>/http/%E7%BD%91%E7%BB%9C/</url>
    <content><![CDATA[<p><img src="https://github.com/lyloou/img/raw/develop/network/sevenlayer.png"></p>
<ul>
<li><p><a href="http://blog.jobbole.com/97270/">Linux TCP/IP 网络工具对比：net-tools 和 iproute2 - 文章 - 伯乐在线</a></p>
</li>
<li><p><a href="https://time.geekbang.org/column/article/7772">第3讲 | ifconfig：最熟悉又陌生的命令行</a></p>
</li>
<li><p><a href="https://www.zhihu.com/question/21134017">如何做到一个VPS一个公网IP的？</a></p>
</li>
</ul>
]]></content>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM参数列表</title>
    <url>/java/JVM%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8/</url>
    <content><![CDATA[<h2 id="How-to-Set-JVM-Proxy-Setting-Without-Touching-the-Code"><a href="#How-to-Set-JVM-Proxy-Setting-Without-Touching-the-Code" class="headerlink" title="How to Set JVM Proxy Setting Without Touching the Code"></a><a href="http://www.glomelurus.com/2009/09/how-to-set-jvm-proxy-setting-without.html">How to Set JVM Proxy Setting Without Touching the Code</a></h2><h2 id="X-参数"><a href="#X-参数" class="headerlink" title="-X 参数"></a><code>-X</code> 参数</h2><p>On the basis of how we specify JVM option it can be divided into two parts, JVM Options which starts with –X and those which starts with -XX:</p>
<blockquote>
<ol>
<li> JVM Options that begin with -X are non-standard (thy are not guaranteed to be supported on all JVM implementations), and are subject to change without notice in subsequent releases of the JDK.</li>
<li> JVM Options or parameters which are specified with -XX are not stable and are not recommended for casual use. These options are subject to change without notice also.</li>
</ol>
</blockquote>
<p><a href="https://javarevisited.blogspot.com/2011/11/hotspot-jvm-options-java-examples.html#axzz5dIpc21eU">10 Examples of HotSpot JVM Options in Java</a></p>
<p>【推荐】给 JVM 环境参数设置-XX:+HeapDumpOnOutOfMemoryError 参数，让 JVM 碰到 OOM 场<br>景时输出 dump 信息。<br>说明：OOM 的发生是有概率的，甚至相隔数月才出现一例，出错时的堆内信息对解决问题非常<br>有帮助。<br>// 《阿里巴巴 Java 开发手册 1.4.0pdf - p34》</p>
<h2 id="D参数"><a href="#D参数" class="headerlink" title="-D参数"></a><code>-D</code>参数</h2><p>参数 <code>-D</code> 是 Java 自带的，其功能是通过命令行设置一个 Java 系统属性。</p>
<h2 id="常用参数"><a href="#常用参数" class="headerlink" title="常用参数"></a>常用参数</h2><p>-Xms2G<br>-Xmx2G<br>-XX:NewRatio=4<br>-XX:SurvivorRatio=8<br>-XX:UseParNewGC<br>-XX:UseParallelOldGC<br>-XX:UseConcMarkSweepGC<br>-XX:+PrintGC<br>-XX:+PrintGCDetails</p>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java8</title>
    <url>/java/Java8/</url>
    <content><![CDATA[<ul>
<li><a href="https://github.com/winterbe/java8-tutorial">https://github.com/winterbe/java8-tutorial</a></li>
<li><a href="http://winterbe.com/posts/2014/07/31/java8-stream-tutorial-examples/">http://winterbe.com/posts/2014/07/31/java8-stream-tutorial-examples/</a></li>
</ul>
<p>Optional<br>需要返回值时<br>Optional.orElse<br>Optional.orElseThrow</p>
<p>不需要返回值时<br>Optional.ifPresent</p>
<h2 id="LocalDate-to-TimeStamp"><a href="#LocalDate-to-TimeStamp" class="headerlink" title="LocalDate to TimeStamp"></a><a href="https://stackoverflow.com/questions/8992282/convert-localdate-to-localdatetime-or-java-sql-timestamp">LocalDate to TimeStamp</a></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ZoneId</span> <span class="variable">zoneId</span> <span class="operator">=</span> ZoneId.of(<span class="string">&quot;Asia/Shanghai&quot;</span>);</span><br><span class="line"><span class="type">LocalDate</span> <span class="variable">date</span> <span class="operator">=</span> LocalDate.parse(time, DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd&quot;</span>).withZone(zoneId));</span><br><span class="line">Timestamp.valueOf(date.atStartOfDay());</span><br></pre></td></tr></table></figure>

<h2 id="String-to-TimeStamp"><a href="#String-to-TimeStamp" class="headerlink" title="String to TimeStamp"></a>String to TimeStamp</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> <span class="string">&quot;2018-12-12&quot;</span></span><br><span class="line">Timestamp.valueOf(time + <span class="string">&quot; 00:00:00&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="list-to-map"><a href="#list-to-map" class="headerlink" title="list to map"></a>list to map</h2><p><a href="https://blog.csdn.net/hern_16/article/details/105118006">Java8 中 List 转 Map(Collectors.toMap) 使用技巧_Hern_16 的博客-CSDN 博客</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 简单对象</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span> <span class="comment">// 链式方法</span></span><br><span class="line"><span class="meta">@lombok</span>.Data</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 列表</span></span><br><span class="line">List&lt;User&gt; userList = Lists.newArrayList(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>().setId(<span class="string">&quot;A&quot;</span>).setName(<span class="string">&quot;张三&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>().setId(<span class="string">&quot;B&quot;</span>).setName(<span class="string">&quot;李四&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>().setId(<span class="string">&quot;C&quot;</span>).setName(<span class="string">&quot;王五&quot;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">/*希望转换成</span></span><br><span class="line"><span class="comment">A-&gt; 张三</span></span><br><span class="line"><span class="comment">B-&gt; 李四</span></span><br><span class="line"><span class="comment">C-&gt; 王五</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">    map.put(user.getId(), user.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// java8之前的做法</span></span><br><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">    map.put(user.getId(), user.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// java8的做法</span></span><br><span class="line">userList.stream().collect(Collectors.toMap(User::getId, User::getName));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果希望得到 Map 的 value 为对象本身时</span></span><br><span class="line">userList.stream().collect(Collectors.toMap(User::getId, t -&gt; t));</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">userList.stream().collect(Collectors.toMap(User::getId, Function.identity()));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意如果Id有重复的话 Collectors.toMap 会抛出异常，需要手动处理，使用 toMap 的重载方法</span></span><br><span class="line">toMap(Function&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> <span class="title class_">K</span>&gt; keyMapper, Function&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> <span class="title class_">U</span>&gt; valueMapper);</span><br><span class="line">toMap(Function&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> <span class="title class_">K</span>&gt; keyMapper, Function&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> <span class="title class_">U</span>&gt; valueMapper,</span><br><span class="line">        BinaryOperator&lt;U&gt; mergeFunction);</span><br><span class="line">toMap(Function&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> <span class="title class_">K</span>&gt; keyMapper, Function&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> <span class="title class_">U</span>&gt; valueMapper,</span><br><span class="line">        BinaryOperator&lt;U&gt; mergeFunction, Supplier&lt;M&gt; mapSupplier);</span><br><span class="line"><span class="comment">// 具体做法是</span></span><br><span class="line">userList.stream().collect(Collectors.toMap(User::getId, User::getName, (n1, n2) -&gt; n1 + n2)); <span class="comment">// 合并字符串</span></span><br><span class="line">userList.stream().collect(Collectors.toMap(User::getId, User::getName, (n1, n2) -&gt; n1)); <span class="comment">// 取第一个</span></span><br><span class="line"><span class="comment">// mapSupplier可以用来自定义map类型，如依据 key 排序</span></span><br><span class="line">userList.stream().collect(</span><br><span class="line">    Collectors.toMap(User::getId, User::getName, (n1, n2) -&gt; n1, TreeMap::<span class="keyword">new</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">A-&gt; 李四</span></span><br><span class="line"><span class="comment">B-&gt; 张三</span></span><br><span class="line"><span class="comment">C-&gt; 王五</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="https://juejin.cn/post/6844903918586052616">聊聊 Java8 以后各个版本的新特性 - 掘金</a><br><a href="https://advancedweb.hu/a-categorized-list-of-all-java-and-jvm-features-since-jdk-8-to-17/">A categorized list of all Java and JVM features since JDK 8 to 17 - Advanced Web Machinery</a><br><a href="https://nanova.me/java-lang-jvm-updates/">Java 9 到 16 的语言和 JVM 特性更新分类清单 | NanoNova’s cyberspace</a></p>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java中instanceof-isInstanceOf-isAssignableFrom的区别</title>
    <url>/java/instanceof/</url>
    <content><![CDATA[<h2 id="摘要："><a href="#摘要：" class="headerlink" title="摘要："></a>摘要：</h2><p>主要内容：<br>本文介绍了如何判断一个对象是否是一个类的实例。</p>
<blockquote>
</blockquote>
<p>instanceof运算符 只被用于对象引用变量，检查左边的被测试对象 是不是 右边类或接口的 实例化。如果被测对象是null值，则测试结果总是false。<br>形象地：自身实例或子类实例 instanceof 自身类   返回true<br>例： String s=new String(“javaisland”);<br>     System.out.println(s instanceof String); //true</p>
<blockquote>
</blockquote>
<p>Class类的isInstance(Object obj)方法，obj是被测试的对象，如果obj是调用这个方法的class或接口 的实例，则返回true。这个方法是instanceof运算符的动态等价。<br>形象地：自身类.class.isInstance(自身实例或子类实例)  返回true<br>例：String s=new String(“javaisland”);<br>    System.out.println(String.class.isInstance(s)); //true</p>
<blockquote>
</blockquote>
<p>Class类的isAssignableFrom(Class cls)方法，如果调用这个方法的class或接口 与 参数cls表示的类或接口相同，或者是参数cls表示的类或接口的父类，则返回true。<br>形象地：自身类.class.isAssignableFrom(自身类或子类.class)  返回true<br>例：System.out.println(ArrayList.class.isAssignableFrom(Object.class));  //false<br>    System.out.println(Object.class.isAssignableFrom(ArrayList.class));  //true</p>
<h2 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h2><ul>
<li><a href="http://bbs.csdn.net/topics/300208631">instanceof运算符、Class的isInstance( )与isAssignableFrom</a></li>
</ul>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Jackson和fastjson区别</title>
    <url>/java/jackson%E5%92%8Cfastjson%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<h2 id="model"><a href="#model" class="headerlink" title="model"></a>model</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.annotation.JSONField;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Model</span> &#123;</span><br><span class="line">    <span class="meta">@JSONField(name = &quot;fastjson_name&quot;)</span> <span class="comment">// fastjson 改名</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;jackson_name&quot;)</span> <span class="comment">// jackson 改名</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;name&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JSONField(name = &quot;fastjson_time&quot;, format = &quot;yyyy-MM-dd hh:mm&quot;)</span> <span class="comment">// fastson 修改日期格式</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;jackson_time&quot;)</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy/MM/dd hh:mm:ss&quot;)</span> <span class="comment">// jackson 修改日期格式</span></span><br><span class="line">    <span class="keyword">private</span> Date time;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTime</span><span class="params">(Date time)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.time = time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/jackson&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Model <span class="title function_">jackson</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Model</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Model</span>();</span><br><span class="line">        model.setTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> model;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/fastjson&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">fastjson</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Model</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Model</span>();</span><br><span class="line">        model.setTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="comment">// 这里也可以再次指定dateFormat，会覆盖之前的</span></span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONStringWithDateFormat(model, <span class="literal">null</span>, SerializerFeature.DisableCircularReferenceDetect);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// http://localhost:8080/jackson</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;jackson_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;jackson_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2020/11/02 02:52:03&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// http://localhost:8080/fastjson</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;fastjson_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;fastjson_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2020-11-02 10:51&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Jar包相关</title>
    <url>/java/jar%E5%8C%85%E7%9B%B8%E5%85%B3/</url>
    <content><![CDATA[<h2 id="基于-Java-的打包-jar、war、ear-包的作用与区别详解"><a href="#基于-Java-的打包-jar、war、ear-包的作用与区别详解" class="headerlink" title="基于 Java 的打包 jar、war、ear 包的作用与区别详解"></a><a href="https://blog.csdn.net/liangrui1988/article/details/49964711">基于 Java 的打包 jar、war、ear 包的作用与区别详解</a></h2><table>
<thead>
<tr>
<th></th>
<th>JAR</th>
<th>WAR</th>
<th>EAR</th>
</tr>
</thead>
<tbody><tr>
<td><strong>英文</strong></td>
<td>Java Archive file</td>
<td>Web Archive file</td>
<td>Enterprise Archive file</td>
</tr>
<tr>
<td><strong>包含内容</strong></td>
<td>class、properties 文件，是文件封装的最小单元；包含 Java 类的普通库、资源（resources）、辅助文件（auxiliary files）等</td>
<td>Servlet、JSP 页面、JSP 标记库、JAR 库文件、HTML/XML 文档和其他公用资源文件，如图片、音频文件等</td>
<td>除了包含 JAR、WAR 以外，还包括 EJB 组件</td>
</tr>
<tr>
<td><strong>部署文件</strong></td>
<td>application-client.xml</td>
<td>web.xml</td>
<td>application.xml</td>
</tr>
<tr>
<td><strong>容器</strong></td>
<td>应用服务器（application servers）</td>
<td>小型服务程序容器（servlet containers）</td>
<td>EJB 容器（EJB containers）</td>
</tr>
<tr>
<td><strong>级别</strong></td>
<td>小</td>
<td>中</td>
<td>大</td>
</tr>
</tbody></table>
<h2 id="运行-jar-包"><a href="#运行-jar-包" class="headerlink" title="运行 jar 包"></a>运行 jar 包</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">java -Dlogging.level.root=debug -D<span class="string">&#x27;file.encoding=utf-8&#x27;</span> -jar -Dspring.profiles.active=master admin.jar</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java8_如何以并发方式在同一个流上执行多种操作</title>
    <url>/java/java8_%E5%A6%82%E4%BD%95%E4%BB%A5%E5%B9%B6%E5%8F%91%E6%96%B9%E5%BC%8F%E5%9C%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E6%B5%81%E4%B8%8A%E6%89%A7%E8%A1%8C%E5%A4%9A%E7%A7%8D%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<p>java8 中，stream 流多次使用会抛出异常：java.lang.IllegalStateException: stream has already been operated upon or closed</p>
<p>所以如何解决呢——如何以并发方式在同一个流上执行多种操作</p>
<p>可以 借助 Spliterator，尤其是它的延迟绑定能力，结合 BlockingQueues 和 Futures 来实现这一大有裨益的特性</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CompletableFuture;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.StreamSupport;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 如何以并发方式在同一个流上执行多种操作</span></span><br><span class="line"><span class="comment"> * 参考：java8_in_action 附录C</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lilou</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021/5/7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamForker</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Stream&lt;T&gt; stream;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Object, Function&lt;Stream&lt;T&gt;, ?&gt;&gt; forks = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StreamForker</span><span class="params">(Stream&lt;T&gt; stream)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stream = stream;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> StreamForker&lt;T&gt; <span class="title function_">fork</span><span class="params">(Object key, Function&lt;Stream&lt;T&gt;, ?&gt; f)</span> &#123;</span><br><span class="line">        forks.put(key, f);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Results <span class="title function_">getResults</span><span class="params">()</span> &#123;</span><br><span class="line">        ForkingStreamConsumer&lt;T&gt; consumer = build();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            stream.sequential().forEach(consumer);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            consumer.finish();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> consumer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ForkingStreamConsumer&lt;T&gt; <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;BlockingQueue&lt;T&gt;&gt; queues = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Map&lt;Object, Future&lt;?&gt;&gt; actions = forks.entrySet()</span><br><span class="line">                .stream()</span><br><span class="line">                .reduce(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Object, Future&lt;?&gt;&gt;(),</span><br><span class="line">                        (map, e) -&gt; &#123;</span><br><span class="line">                            map.put(e.getKey(), getOperationResult(queues, e.getValue()));</span><br><span class="line">                            <span class="keyword">return</span> map;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        (m1, m2) -&gt; &#123;</span><br><span class="line">                            m1.putAll(m2);</span><br><span class="line">                            <span class="keyword">return</span> m1;</span><br><span class="line">                        &#125;</span><br><span class="line">                );</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ForkingStreamConsumer</span>&lt;&gt;(queues, actions);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Future&lt;?&gt; getOperationResult(List&lt;BlockingQueue&lt;T&gt;&gt; queues, Function&lt;Stream&lt;T&gt;, ?&gt; f) &#123;</span><br><span class="line">        BlockingQueue&lt;T&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;();</span><br><span class="line">        queues.add(queue);</span><br><span class="line">        <span class="keyword">final</span> Spliterator&lt;T&gt; spliterator = <span class="keyword">new</span> <span class="title class_">BlockingQueueSpliterator</span>&lt;&gt;(queue);</span><br><span class="line">        <span class="keyword">final</span> Stream&lt;T&gt; source = StreamSupport.stream(spliterator, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; f.apply(source));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">interface</span> <span class="title class_">Results</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> &lt;R&gt; R <span class="title function_">get</span><span class="params">(Object key)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ForkingStreamConsumer</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Consumer</span>&lt;T&gt;, Results &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">END_OF_STREAM</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> List&lt;BlockingQueue&lt;T&gt;&gt; queues;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Object, Future&lt;?&gt;&gt; actions;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ForkingStreamConsumer</span><span class="params">(List&lt;BlockingQueue&lt;T&gt;&gt; queues, Map&lt;Object, Future&lt;?&gt;&gt; actions)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.queues = queues;</span><br><span class="line">            <span class="built_in">this</span>.actions = actions;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@SuppressWarnings(&#123;&quot;unchecked&quot;, &quot;SSBasedInspection&quot;&#125;)</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> &lt;R&gt; R <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> ((Future&lt;R&gt;) actions.get(key)).get();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(T t)</span> &#123;</span><br><span class="line">            queues.forEach(q -&gt; q.add(t));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">finish</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">//noinspection unchecked</span></span><br><span class="line">            accept((T) END_OF_STREAM);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BlockingQueueSpliterator</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Spliterator</span>&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> BlockingQueue&lt;T&gt; q;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">BlockingQueueSpliterator</span><span class="params">(BlockingQueue&lt;T&gt; q)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.q = q;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryAdvance</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> T&gt; action)</span> &#123;</span><br><span class="line">            T t;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="comment">//noinspection SSBasedInspection</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    t = q.take();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (t != ForkingStreamConsumer.END_OF_STREAM) &#123;</span><br><span class="line">                action.accept(t);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Spliterator&lt;T&gt; <span class="title function_">trySplit</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">estimateSize</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">characteristics</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lilou</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021/5/7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamForkerTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">100</span>];</span><br><span class="line">        Arrays.fill(a, <span class="number">1</span>);</span><br><span class="line">        Arrays.parallelPrefix(a, Integer::sum);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Stream&lt;Integer&gt; integerStream = Arrays.stream(a).boxed();</span><br><span class="line">        <span class="keyword">final</span> StreamForker.<span class="type">Results</span> <span class="variable">results</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StreamForker</span>&lt;&gt;(integerStream)</span><br><span class="line">                .fork(<span class="string">&quot;平均值&quot;</span>, StreamForkerTest::average)</span><br><span class="line">                .fork(<span class="string">&quot;求和&quot;</span>, StreamForkerTest::sum)</span><br><span class="line">                .fork(<span class="string">&quot;拼接&quot;</span>, StreamForkerTest::concat)</span><br><span class="line">                .getResults();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">average</span> <span class="operator">=</span> results.get(<span class="string">&quot;平均值&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sum</span> <span class="operator">=</span> results.get(<span class="string">&quot;求和&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">concat</span> <span class="operator">=</span> results.get(<span class="string">&quot;拼接&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;平均值:&quot;</span> + average);</span><br><span class="line">        System.out.println(<span class="string">&quot;求和:&quot;</span> + sum);</span><br><span class="line">        System.out.println(<span class="string">&quot;拼接:&quot;</span> + concat);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">concat</span><span class="params">(Stream&lt;Integer&gt; stream)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stream.map(String::valueOf).collect(Collectors.joining(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">sum</span><span class="params">(Stream&lt;Integer&gt; stream)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stream.reduce(Integer::sum).map(String::valueOf).orElse(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">average</span><span class="params">(Stream&lt;Integer&gt; stream)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stream.mapToInt(Integer::intValue).summaryStatistics().getAverage() + <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>结果</strong></p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">平均值:<span class="number">50</span>.<span class="number">5</span></span><br><span class="line">求和:<span class="number">5050</span></span><br><span class="line">拼接:<span class="number">1,2,3,4</span>,<span class="number">5,6,7,8</span>,<span class="number">9,10,11,12</span>,<span class="number">13,14,15,16</span>,<span class="number">17,18,19,20</span>,<span class="number">21,22,23,24</span>,<span class="number">25,26,27,28</span>,<span class="number">29,30,31,32</span>,<span class="number">33,34,35,36</span>,<span class="number">37,38,39,40</span>,<span class="number">41,42,43,44</span>,<span class="number">45,46,47,48</span>,<span class="number">49,50,51,52</span>,<span class="number">53,54,55,56</span>,<span class="number">57,58,59,60</span>,<span class="number">61,62,63,64</span>,<span class="number">65,66,67,68</span>,<span class="number">69,70,71,72</span>,<span class="number">73,74,75,76</span>,<span class="number">77,78,79,80</span>,<span class="number">81,82,83,84</span>,<span class="number">85,86,87,88</span>,<span class="number">89,90,91,92</span>,<span class="number">93,94,95,96</span>,<span class="number">97,98,99,100</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java 中的 Exception 和 Error</title>
    <url>/java/exception%E5%92%8Cerror/</url>
    <content><![CDATA[<h3 id="java-What’s-the-difference-between-StackOverflowError-and-OutOfMemoryError-Stack-Overflow"><a href="#java-What’s-the-difference-between-StackOverflowError-and-OutOfMemoryError-Stack-Overflow" class="headerlink" title="java - What’s the difference between StackOverflowError and OutOfMemoryError - Stack Overflow"></a><a href="https://stackoverflow.com/questions/11435613/whats-the-difference-between-stackoverflowerror-and-outofmemoryerror">java - What’s the difference between StackOverflowError and OutOfMemoryError - Stack Overflow</a></h3><p>Short answer:</p>
<ul>
<li>OutOfMemoryError is related to Heap.</li>
<li>StackOverflowError is related to stack</li>
</ul>
<p>Long answer:</p>
<p>When you start JVM you define how much RAM it can use for processing. JVM divides this into certain memory locations for its processing purpose, two of those are Stack &amp; Heap</p>
<p>If you have large objects (or) referenced objects in memory, then you will see OutofMemoryError. If you have strong references to objects, then GC can’t clean the memory space allocated for that object. When JVM tries to allocate memory for new object and not enough space available it throws OutofMemoryError because it can’t allocate the required amount of memory.</p>
<p>How to avoid: Make sure un-necessary objects are available for GC</p>
<p>All your local variables and methods calls related data will be on the stack. For every method call, one stack frame will be created and local as well as method call related data will be placed inside the stack frame. Once method execution is completed, the stack frame will be removed. ONE WAY to reproduce this is, have an infinite loop for method call, you will see stackoverflow error, because stack frame will be populated with method data for every call but it won’t be freed (removed).</p>
<p>How to avoid: Make sure method calls are ending (not in an infinite loop)</p>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java代码片段</title>
    <url>/java/java%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/</url>
    <content><![CDATA[<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 《Android进阶之光》p214</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">convertStreamToString</span><span class="params">(InputStream stream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(stream));</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            sb.append(line).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> sb.toString();</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// https://stackoverflow.com/questions/43157/easy-way-to-write-contents-of-a-java-inputstream-to-an-outputstream</span></span><br><span class="line">    <span class="comment">// http://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/IOUtils.html</span></span><br><span class="line">    <span class="comment">// http://commons.apache.org/proper/commons-io/download_io.cgi</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">convertStreamToFile</span><span class="params">(InputStream in, File out)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">outStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(out);</span><br><span class="line">        IOUtils.copy(in, outStream);</span><br><span class="line">        in.close();</span><br><span class="line">        outStream.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 网络图片</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;https://www.cnblogs.com/images/logo_small.gif&quot;</span>).openStream();</span><br><span class="line"></span><br><span class="line">        convertStreamToFile(stream, <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;./java/cnblog_logo.png&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 网页</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">stream2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;https://www.cnblogs.com/&quot;</span>).openStream();</span><br><span class="line"></span><br><span class="line">        convertStreamToFile(stream2, <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;./java/cnblog.html&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 本地文件</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;./java/hi.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        convertStreamToFile(fileInputStream, <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;./java/hi2.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取字符串</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;./java/hi.txt&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> convertStreamToString(fileInputStream2);</span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="定时功能"><a href="#定时功能" class="headerlink" title="定时功能"></a>定时功能</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ScheduledExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line">service.schedule(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Yeah, I&#x27;m late.&quot;</span>);</span><br><span class="line">        service.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">10</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>

<h2 id="多线程调试"><a href="#多线程调试" class="headerlink" title="多线程调试"></a>多线程调试</h2><p>一次只打一个断点。</p>
<h2 id="获取服务器时间"><a href="#获取服务器时间" class="headerlink" title="获取服务器时间"></a>获取服务器时间</h2><p>原理：通过获取链接的 Header 信息来获取时间。<br>注意：网络请求需要在多线程中执行</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://lyloou.com&quot;</span>);</span><br><span class="line"><span class="type">URLConnection</span> <span class="variable">uc</span> <span class="operator">=</span> url.openConnection();<span class="comment">// 获取连接对象</span></span><br><span class="line">uc.connect();<span class="comment">// 连接</span></span><br><span class="line"><span class="type">long</span> <span class="variable">webTimeMillis</span> <span class="operator">=</span> uc.getDate();</span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>, Locale.CHINA);</span><br><span class="line"><span class="type">String</span> <span class="variable">formatWebTime</span> <span class="operator">=</span> simpleDateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>(webTimeMillis));</span><br><span class="line">System.out.println(formatWebTime);</span><br></pre></td></tr></table></figure>

<h2 id="添加顺序的注释"><a href="#添加顺序的注释" class="headerlink" title="添加顺序的注释"></a>添加顺序的注释</h2><blockquote>
<p>参考资料:深入探索 Android 热修复技术原理 7.3Q.pdf p107</p>
</blockquote>
<p>// %% Part 1. 创建了新对象；<br>// %% Part 2. 找到旧对象的引用；<br>// %% Part 3. 用新对象赋值给旧对象的引用；</p>
<h2 id="对象转换成字符串"><a href="#对象转换成字符串" class="headerlink" title="对象转换成字符串"></a>对象转换成字符串</h2><p>在不确定对象是否为空时，通过<code>String.valueOf(object)</code>的方法，<br>而不是直接调用：<code>object.toString();</code>方法</p>
<h2 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h2><p><code>当类似的代码多次出现的时候，就可以考虑将其封装起来。</code></p>
<h2 id="日期、时间格式的转换"><a href="#日期、时间格式的转换" class="headerlink" title="日期、时间格式的转换"></a>日期、时间格式的转换</h2><blockquote>
</blockquote>
<ul>
<li><a href="https://github.com/lyloou/RxJavaSamples/blob/master/app/src/main/java/com/rengwuxian/rxjavasamples/util/GankBeautyResultToItemsMapper.java">GankBeautyResultToItemsMapper.java</a></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">strDate</span> <span class="operator">=</span> <span class="string">&quot;2017-05-09T14:28:32.974Z&quot;</span>;</span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">inputFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SS&#x27;Z&#x27;&quot;</span>);</span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">outputFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yy/MM/dd HH:mm:ss&quot;</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">Date</span> <span class="variable">inputDate</span> <span class="operator">=</span> inputFormat.parse(strDate);</span><br><span class="line">    <span class="type">String</span> <span class="variable">outputDate</span> <span class="operator">=</span> outputFormat.format(inputDate);</span><br><span class="line">    System.out.println(outputDate);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="打印出好看的list"><a href="#打印出好看的list" class="headerlink" title="打印出好看的list"></a>打印出好看的<code>list</code></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(Arrays.toString(list.toArray()));</span><br></pre></td></tr></table></figure>

<h2 id="HashMap-用来缓存对象"><a href="#HashMap-用来缓存对象" class="headerlink" title="HashMap 用来缓存对象"></a>HashMap 用来缓存对象</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Object&gt; objectsCache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// put in</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putIn</span><span class="params">(String key, Object obj)</span> &#123;</span><br><span class="line">  objectsCache.put(key, obj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get out</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">getOut</span><span class="params">(String key, Object <span class="keyword">default</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(objectsCache.containsKey(key)) &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> objectsCache.get(key);</span><br><span class="line">    <span class="keyword">if</span>(obj == <span class="literal">null</span>) &#123;</span><br><span class="line">      objectsCache.put(key, <span class="keyword">default</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    objectsCache.put(key, <span class="keyword">default</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">default</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="根据-class-将-object-对象转换成-class-的对象"><a href="#根据-class-将-object-对象转换成-class-的对象" class="headerlink" title="根据 class 将 object 对象转换成 class 的对象"></a>根据 class 将 object 对象转换成 class 的对象</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">MyClass</span> <span class="variable">mobj</span> <span class="operator">=</span> MyClass.class.cast(obj);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">newObj</span> <span class="operator">=</span> Class.forName(classname).cast(obj);</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>【Java】jfinal</title>
    <url>/java/jfinal/</url>
    <content><![CDATA[<h2 id="数据库数据保存后，随即用id作其他更新操作，导致无法更新成功问题"><a href="#数据库数据保存后，随即用id作其他更新操作，导致无法更新成功问题" class="headerlink" title="数据库数据保存后，随即用id作其他更新操作，导致无法更新成功问题"></a>数据库数据保存后，随即用id作其他更新操作，导致无法更新成功问题</h2><p>原因：因为是刚保存的，如果没有取回id，其id肯定还是默认的0；<br>解决办法：回传ID</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Record</span> <span class="variable">record</span> <span class="operator">=</span> RecordUtils.toRecord(ps);</span><br><span class="line">record.set(<span class="string">&quot;id&quot;</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">ps.setCreated(Timestamp.from(Instant.now()));</span><br><span class="line"><span class="type">boolean</span> <span class="variable">ret</span> <span class="operator">=</span> Db.save(TABLE.PROXY_STOCKS, <span class="string">&quot;id&quot;</span>, record);</span><br><span class="line"><span class="comment">// 回传ID</span></span><br><span class="line">ps.setId(record.getNumber(<span class="string">&quot;id&quot;</span>).longValue());</span><br></pre></td></tr></table></figure>

<p><a href="https://www.yeetrack.com/?p=1151">Jfinal quartz动态的增、删、暂停、恢复job | 易踪网</a></p>
<p><a href="https://www.jfinal.com/share/1618">jfinal使用QuartzPlugin（定时任务插件）(上)</a></p>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>定时任务Job</title>
    <url>/java/job/</url>
    <content><![CDATA[<h2 id="在线-Cron-表达式生成器"><a href="#在线-Cron-表达式生成器" class="headerlink" title="在线 Cron 表达式生成器"></a>在线 Cron 表达式生成器</h2><ul>
<li><a href="https://www.stylefeng.cn/contents/roses_kernel/detail/15_timer.html#%E5%9C%A8%E7%BA%BF%E5%88%9B%E5%BB%BA%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6">定时任务 | Guns 快速开发平台</a></li>
<li><a href="https://cron.qqe2.com/">https://cron.qqe2.com/</a></li>
<li><a href="https://qqe2.com/cron">https://qqe2.com/cron</a></li>
</ul>
<h2 id="QuartZ-Cron-表达式-sunjie-博客园"><a href="#QuartZ-Cron-表达式-sunjie-博客园" class="headerlink" title="QuartZ Cron 表达式 - sunjie - 博客园"></a><a href="https://www.cnblogs.com/sunjie9606/archive/2012/03/15/2397626.html">QuartZ Cron 表达式 - sunjie - 博客园</a></h2><p>CronTrigger</p>
<p>CronTriggers 往往比 SimpleTrigger 更有用，如果您需要基于日历的概念，而非 SimpleTrigger 完全指定的时间间隔，复发的发射工作的时间表。<br>CronTrigger，你可以指定触发的时间表如“每星期五中午”，或“每个工作日 9:30 时”，甚至“每 5 分钟一班 9:00 和 10:00 逢星期一上午，星期三星期五“。<br>即便如此，SimpleTrigger 一样，CronTrigger 拥有的 startTime 指定的时间表时生效，指定的时间表时，应停止（可选）结束时间。<br>Cron Expressions</p>
<p>cron 的表达式被用来配置 CronTrigger 实例。 cron 的表达式是字符串，实际上是由七子表达式，描述个别细节的时间表。这些子表达式是分开的空白，代表：</p>
<pre><code>1.        Seconds
2.        Minutes
3.        Hours
4.        Day-of-Month
5.        Month
6.        Day-of-Week
7.        Year (可选字段)
</code></pre>
<p>例 “0 0 12 ? * WED” 在每星期三下午 12:00 执行,</p>
<p>个别子表达式可以包含范围, 例如，在前面的例子里(“WED”)可以替换成 “MON-FRI”, “MON, WED, FRI”甚至”MON-WED,SAT”.</p>
<p>“*” 代表整个时间段.</p>
<p>每一个字段都有一套可以指定有效值，如</p>
<pre><code>Seconds (秒)         ：可以用数字0－59 表示，

Minutes(分)          ：可以用数字0－59 表示，

Hours(时)             ：可以用数字0-23表示,

Day-of-Month(天) ：可以用数字1-31 中的任一一个值，但要注意一些特别的月份

Month(月)            ：可以用0-11 或用字符串  “JAN, FEB, MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV and DEC” 表示

Day-of-Week(每周)：可以用数字1-7表示（1 ＝ 星期日）或用字符口串“SUN, MON, TUE, WED, THU, FRI and SAT”表示

“/”：为特别单位，表示为“每”如“0/15”表示每隔15分钟执行一次,“0”表示为从“0”分开始, “3/20”表示表示每隔20分钟执行一次，“3”表示从第3分钟开始执行

“?”：表示每月的某一天，或第周的某一天

“L”：用于每月，或每周，表示为每月的最后一天，或每个月的最后星期几如“6L”表示“每月的最后一个星期五”

“W”：表示为最近工作日，如“15W”放在每月（day-of-month）字段上表示为“到本月15日最近的工作日”

““#”：是用来指定“的”每月第n个工作日,例 在每周（day-of-week）这个字段中内容为&quot;6#3&quot; or &quot;FRI#3&quot; 则表示“每月第三个星期五”
</code></pre>
<p>1）Cron 表达式的格式：秒 分 时 日 月 周 年(可选)。</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>允许的值</th>
<th>允许的特殊字符</th>
</tr>
</thead>
<tbody><tr>
<td>秒</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>分</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>小时</td>
<td>0-23</td>
<td>, - * /</td>
</tr>
<tr>
<td>日</td>
<td>1-31</td>
<td>, - * ? / L W C</td>
</tr>
<tr>
<td>月</td>
<td>1-12 or JAN-DEC</td>
<td>, - * /</td>
</tr>
<tr>
<td>周几</td>
<td>1-7 or SUN-SAT</td>
<td>, - * ? / L C #</td>
</tr>
<tr>
<td>年 (可选字段)</td>
<td>empty, 1970-2099</td>
<td>, - * /</td>
</tr>
</tbody></table>
<pre><code>“?”字符：表示不确定的值

“,”字符：指定数个值

“-”字符：指定一个值的范围

“/”字符：指定一个值的增加幅度。n/m表示从n开始，每次增加m

“L”字符：用在日表示一个月中的最后一天，用在周表示该月最后一个星期X

“W”字符：指定离给定日期最近的工作日(周一到周五)

“#”字符：表示该月第几个周X。6#3表示该月第3个周五
</code></pre>
<p>2）Cron 表达式范例：</p>
<pre><code>每隔5秒执行一次：*/5 * * * * ?

每隔1分钟执行一次：0 */1 * * * ?

每天23点执行一次：0 0 23 * * ?

每天凌晨1点执行一次：0 0 1 * * ?

每月1号凌晨1点执行一次：0 0 1 1 * ?

每月最后一天23点执行一次：0 0 23 L * ?

每周星期天凌晨1点实行一次：0 0 1 ? * L

在26分、29分、33分执行一次：0 26,29,33 * * * ?

每天的0点、13点、18点、21点都执行一次：0 0 0,13,18,21 * * ?
</code></pre>
<p>注： <code>*/X</code> 或 <code>M-N/X</code>，表示匹配范围内能被 X 整除的值，如 <code>1-10/3</code> 就等同于 <code>3, 6, 9</code></p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>跑定时任务时要注意： 整点的情况要考虑周全。<br>例如：活动的开始时间是 12:00 ，再结合数据库查询的时候， start_at &gt;= 12:00 时，不要漏了“=”号。</p>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>【Java】日志</title>
    <url>/java/logger/</url>
    <content><![CDATA[<h2 id="logback"><a href="#logback" class="headerlink" title="logback"></a>logback</h2><p><a href="https://juejin.im/post/6844903822687485965">SpringBoot 日志处理之 Logback - 掘金</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">contextName</span>&gt;</span>logback-spring-demo-dev<span class="tag">&lt;/<span class="name">contextName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg %n&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;pattern-color&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%yellow(%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;) [%thread] %highlight(%-5level) %green(%logger&#123;50&#125;) - %highlight(%msg) %n&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_HOME&quot;</span> <span class="attr">value</span>=<span class="string">&quot;logs&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 控制台输出 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 控制台输出-带颜色 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE-WITH-COLOR&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;pattern-color&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 文件输出 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/all.%d.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>10MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;pattern&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE-WITH-COLOR&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.example.logbackdemo.IndexAction&quot;</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><ul>
<li><a href="https://www.cnblogs.com/ywlaker/p/6124067.html">java ???? log4j ?????? slf4j ?????? - ywlaker - ???</a></li>
<li><a href="https://howtodoinjava.com/log4j/slf4j-vs-log4j-which-one-is-better/">SLF4j Vs Log4j - Which one is better? - HowToDoInJava</a></li>
<li><a href="https://www.hollischuang.com/archives/3000">https://www.hollischuang.com/archives/3000</a></li>
<li><a href="https://javarevisited.blogspot.com/2011/05/top-10-tips-on-logging-in-java.html#axzz5dIpc21eU">Top 10 Tips on Logging in Java - Tutorial</a></li>
</ul>
<ul>
<li><a href="http://3rdaftergod.blogspot.com/2017/01/intellij-idea-live-template-for-slf4j.html">Intellij IDEA live template for SLF4J logger | chhh, quiet plxplx…</a></li>
</ul>
<p>How to define a live template</p>
<pre><code>Go to File-&gt;Settings-&gt;Editor-&gt;Live Templates.
In the right panel tree select category other.
Click the plus (+) sign on the top right, select Live Template.
Set
    Abbreviation: log
    Description: Inserts private static Logger for slf4j
    Template text: private static final org.slf4j.Logger logger = org.slf4j.LoggerFactory.getLogger($CLASS_NAME$.class);$END$
Now click the Edit Variables button, we will tell the IDE what $CLASS_NAME$ means here. $END$ means where to place the cursor after template expansion.
    Name: CLASS_NAME
    Expression: className()
    Default value: leave empty
    Skip if defined: true (check the checkbox)
At the very bottom look for text Applicable in with a link Change next to it, click it. Select Java-&gt;declaration.
</code></pre>
<p>Congratulations, you’re done! Just type log and press Tab anywhere in the class declaration.</p>
<h2 id="有颜色的-log4j"><a href="#有颜色的-log4j" class="headerlink" title="有颜色的 log4j"></a>有颜色的 log4j</h2><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">log4j.debug</span>=<span class="literal">false</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Default level is INFO</span></span><br><span class="line"><span class="attr">log4j.rootLogger</span>=DEBUG,StdoutErrorFatal,StdoutWarn,StdoutInfo,StdoutDebug,StdoutTrace</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># and for com.some.package.* log everything</span></span><br><span class="line"><span class="attr">log4j.logger.com.some.package</span>=TRACE</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">log4j.appender.StdoutErrorFatal</span>=org.apache.log4j.ConsoleAppender</span><br><span class="line"><span class="attr">log4j.appender.StdoutErrorFatal.layout</span>=org.apache.log4j.PatternLayout</span><br><span class="line"><span class="attr">log4j.appender.StdoutErrorFatal.layout.conversionPattern</span>=\u001b[<span class="number">31</span><span class="comment">;1m%d&#123;HH:mm:ss,SSS&#125; %-5p - %-26c - [user:%X&#123;username&#125;] %m\n</span></span><br><span class="line">log4j.appender.StdoutErrorFatal.threshold=ERROR</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">log4j.appender.StdoutWarn=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.StdoutWarn.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.StdoutWarn.layout.conversionPattern=\u001b[<span class="number">33</span><span class="comment">;1m%d&#123;HH:mm:ss,SSS&#125; %-5p - %-26c - [user:%X&#123;username&#125;] %m\n</span></span><br><span class="line">log4j.appender.StdoutWarn.threshold=WARN</span><br><span class="line">log4j.appender.StdoutWarn.filter.filter1=org.apache.log4j.varia.LevelRangeFilter</span><br><span class="line">log4j.appender.StdoutWarn.filter.filter1.levelMin=WARN</span><br><span class="line">log4j.appender.StdoutWarn.filter.filter1.levelMax=WARN</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">log4j.appender.StdoutInfo=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.StdoutInfo.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.StdoutInfo.layout.conversionPattern=\u001b[<span class="number">0</span>m%d&#123;HH:mm:ss,SSS&#125; %-<span class="number">5</span>p - %-<span class="number">26</span>c - [user:%X&#123;username&#125;] %m\n</span><br><span class="line">log4j.appender.StdoutInfo.threshold=INFO</span><br><span class="line">log4j.appender.StdoutInfo.filter.filter1=org.apache.log4j.varia.LevelRangeFilter</span><br><span class="line">log4j.appender.StdoutInfo.filter.filter1.levelMin=INFO</span><br><span class="line">log4j.appender.StdoutInfo.filter.filter1.levelMax=INFO</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">log4j.appender.StdoutDebug=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.StdoutDebug.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.StdoutDebug.layout.conversionPattern=\u001b[<span class="number">0</span><span class="comment">;36m%d&#123;HH:mm:ss,SSS&#125; %-5p - %-26c - [user:%X&#123;username&#125;] %m\n</span></span><br><span class="line">log4j.appender.StdoutDebug.threshold=DEBUG</span><br><span class="line">log4j.appender.StdoutDebug.filter.filter1=org.apache.log4j.varia.LevelRangeFilter</span><br><span class="line">log4j.appender.StdoutDebug.filter.filter1.levelMin=DEBUG</span><br><span class="line">log4j.appender.StdoutDebug.filter.filter1.levelMax=DEBUG</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">log4j.appender.StdoutTrace=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.StdoutTrace.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.StdoutTrace.layout.conversionPattern=\u001b[<span class="number">0</span><span class="comment">;30;1m%d&#123;HH:mm:ss,SSS&#125; %-5p - %-26c - [user:%X&#123;username&#125;] %m\n</span></span><br><span class="line">log4j.appender.StdoutTrace.threshold=TRACE</span><br><span class="line">log4j.appender.StdoutTrace.filter.filter1=org.apache.log4j.varia.LevelRangeFilter</span><br><span class="line">log4j.appender.StdoutTrace.filter.filter1.levelMin=TRACE</span><br><span class="line">log4j.appender.StdoutTrace.filter.filter1.levelMax=TRACE</span><br></pre></td></tr></table></figure>

<p>完整配置: <a href="http://javapub.iteye.com/blog/866664">http://javapub.iteye.com/blog/866664</a></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">log4j.rootLogger</span>=CONSOLE,FILE</span><br><span class="line"><span class="attr">log4j.addivity.org.apache</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用于控制台</span></span><br><span class="line"><span class="attr">log4j.appender.CONSOLE</span>=org.apache.log4j.ConsoleAppender</span><br><span class="line"><span class="attr">log4j.appender.CONSOLE.Threshold</span>=INFO</span><br><span class="line"><span class="attr">log4j.appender.CONSOLE.Target</span>=System.out</span><br><span class="line"><span class="attr">log4j.appender.CONSOLE.Encoding</span>=GBK</span><br><span class="line"><span class="attr">log4j.appender.CONSOLE.layout</span>=org.apache.log4j.PatternLayout</span><br><span class="line"><span class="attr">log4j.appender.CONSOLE.layout.ConversionPattern</span>=[framework] %d - %c -%-<span class="number">4</span>r [%t] %-<span class="number">5</span>p %c %x - %m%n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每天新建日志</span></span><br><span class="line"><span class="attr">log4j.appender.A1</span>=org.apache.log4j.DailyRollingFileAppender</span><br><span class="line"><span class="attr">log4j.appender.A1.File</span>=C:/log4j/log</span><br><span class="line"><span class="attr">log4j.appender.A1.Encoding</span>=GBK</span><br><span class="line"><span class="attr">log4j.appender.A1.Threshold</span>=DEBUG</span><br><span class="line"><span class="attr">log4j.appender.A1.DatePattern</span>=<span class="string">&#x27;.&#x27;</span>yyyy-MM-dd</span><br><span class="line"><span class="attr">log4j.appender.A1.layout</span>=org.apache.log4j.PatternLayout</span><br><span class="line"><span class="attr">log4j.appender.A1.layout.ConversionPattern</span>=%d&#123;ABSOLUTE&#125; %<span class="number">5</span>p %c&#123;<span class="number">1</span>&#125;:%L : %m%n</span><br><span class="line"></span><br><span class="line"><span class="comment">#应用于文件</span></span><br><span class="line"><span class="attr">log4j.appender.FILE</span>=org.apache.log4j.FileAppender</span><br><span class="line"><span class="attr">log4j.appender.FILE.File</span>=C:/log4j/file.log</span><br><span class="line"><span class="attr">log4j.appender.FILE.Append</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">log4j.appender.FILE.Encoding</span>=GBK</span><br><span class="line"><span class="attr">log4j.appender.FILE.layout</span>=org.apache.log4j.PatternLayout</span><br><span class="line"><span class="attr">log4j.appender.FILE.layout.ConversionPattern</span>=[framework] %d - %c -%-<span class="number">4</span>r [%t] %-<span class="number">5</span>p %c %x - %m%n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用于文件回滚</span></span><br><span class="line"><span class="attr">log4j.appender.ROLLING_FILE</span>=org.apache.log4j.RollingFileAppender</span><br><span class="line"><span class="attr">log4j.appender.ROLLING_FILE.Threshold</span>=ERROR</span><br><span class="line"><span class="attr">log4j.appender.ROLLING_FILE.File</span>=rolling.log</span><br><span class="line"><span class="attr">log4j.appender.ROLLING_FILE.Append</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">log4j.appender.CONSOLE_FILE.Encoding</span>=GBK</span><br><span class="line"><span class="attr">log4j.appender.ROLLING_FILE.MaxFileSize</span>=<span class="number">10</span>KB</span><br><span class="line"><span class="attr">log4j.appender.ROLLING_FILE.MaxBackupIndex</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">log4j.appender.ROLLING_FILE.layout</span>=org.apache.log4j.PatternLayout</span><br><span class="line"><span class="attr">log4j.appender.ROLLING_FILE.layout.ConversionPattern</span>=[framework] %d - %c -%-<span class="number">4</span>r [%t] %-<span class="number">5</span>p %c %x - %m%n</span><br><span class="line"></span><br><span class="line"><span class="comment">#自定义Appender</span></span><br><span class="line"><span class="attr">log4j.appender.im</span> = net.cybercorlin.util.logger.appender.IMAppender</span><br><span class="line"><span class="attr">log4j.appender.im.host</span> = mail.cybercorlin.net</span><br><span class="line"><span class="attr">log4j.appender.im.username</span> = username</span><br><span class="line"><span class="attr">log4j.appender.im.password</span> = password</span><br><span class="line"><span class="attr">log4j.appender.im.recipient</span> = yyflyons@<span class="number">163</span>.com</span><br><span class="line"><span class="attr">log4j.appender.im.layout</span>=org.apache.log4j.PatternLayout</span><br><span class="line"><span class="attr">log4j.appender.im.layout.ConversionPattern</span> =[framework] %d - %c -%-<span class="number">4</span>r [%t] %-<span class="number">5</span>p %c %x - %m%n</span><br><span class="line"></span><br><span class="line"><span class="comment">#应用于socket</span></span><br><span class="line"><span class="attr">log4j.appender.SOCKET</span>=org.apache.log4j.RollingFileAppender</span><br><span class="line"><span class="attr">log4j.appender.SOCKET.RemoteHost</span>=localhost</span><br><span class="line"><span class="attr">log4j.appender.SOCKET.Port</span>=<span class="number">5001</span></span><br><span class="line"><span class="attr">log4j.appender.SOCKET.LocationInfo</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># Set up for Log Facter 5</span></span><br><span class="line"><span class="attr">log4j.appender.SOCKET.layout</span>=org.apache.log4j.PatternLayout</span><br><span class="line"><span class="attr">log4j.appender.SOCET.layout.ConversionPattern</span>=[start]%d&#123;DATE&#125;[DATE]%n%p[PRIORITY]%n%x[NDC]%n%t[THREAD]%n%c[CATEGORY]%n%m[MESSAGE]%n%n</span><br><span class="line"><span class="comment"># Log Factor 5 Appender</span></span><br><span class="line"><span class="attr">log4j.appender.LF5_APPENDER</span>=org.apache.log4j.lf5.LF5Appender</span><br><span class="line"><span class="attr">log4j.appender.LF5_APPENDER.MaxNumberOfRecords</span>=<span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送日志给邮件</span></span><br><span class="line"><span class="attr">log4j.appender.MAIL</span>=org.apache.log4j.net.SMTPAppender</span><br><span class="line"><span class="attr">log4j.appender.MAIL.Threshold</span>=FATAL</span><br><span class="line"><span class="attr">log4j.appender.MAIL.BufferSize</span>=<span class="number">10</span></span><br><span class="line"><span class="attr">log4j.appender.MAIL.From</span>=yyflyons@<span class="number">163</span>.com</span><br><span class="line"><span class="attr">log4j.appender.MAIL.SMTPHost</span>=www.wusetu.com</span><br><span class="line"><span class="attr">log4j.appender.MAIL.Subject</span>=Log4J Message</span><br><span class="line"><span class="attr">log4j.appender.MAIL.To</span>=yyflyons@<span class="number">126</span>.com</span><br><span class="line"><span class="attr">log4j.appender.MAIL.layout</span>=org.apache.log4j.PatternLayout</span><br><span class="line"><span class="attr">log4j.appender.MAIL.layout.ConversionPattern</span>=[framework] %d - %c -%-<span class="number">4</span>r [%t] %-<span class="number">5</span>p %c %x - %m%n</span><br></pre></td></tr></table></figure>

<h2 id="Spring-MVC-Log4j-example"><a href="#Spring-MVC-Log4j-example" class="headerlink" title="Spring MVC + Log4j example"></a><a href="https://www.mkyong.com/spring-mvc/spring-mvc-log4j-integration-example/">Spring MVC + Log4j example</a></h2>]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Lombok</title>
    <url>/java/lombok/</url>
    <content><![CDATA[<h2 id="常用的-lombok-注解"><a href="#常用的-lombok-注解" class="headerlink" title="常用的 lombok 注解"></a><a href="https://blog.csdn.net/mccand1234/article/details/53456411">常用的 lombok 注解</a></h2><ul>
<li><code>@EqualsAndHashCode</code> ：实现 equals()方法和 hashCode()方法 @ToString：实现` toString()方法</li>
<li><code>@Data</code> ：注解在类上；提供类所有属性的 getting 和 setting 方法，此外还提供了 equals、canEqual、hashCode、toString 方法</li>
<li><code>@Setter</code> ：注解在属性上；为属性提供 setting 方法</li>
<li><code>@Getter</code> ：注解在属性上；为属性提供 getting 方法</li>
<li><code>@Log4j</code> ：注解在类上；为类提供一个 属性名为 log 的 log4j 日志对象</li>
<li><code>@NoArgsConstructor</code> ：注解在类上；为类提供一个无参的构造方法</li>
<li><code>@AllArgsConstructor</code> ：注解在类上；为类提供一个全参的构造方法</li>
<li><code>@Cleanup</code> ：关闭流 @Synchronized：对象同步 @SneakyThrows：抛出异常</li>
</ul>
<h2 id="转换数据库数据到实体对象出错"><a href="#转换数据库数据到实体对象出错" class="headerlink" title="转换数据库数据到实体对象出错"></a>转换数据库数据到实体对象出错</h2><blockquote>
<p>org.springframework.dao.DataIntegrityViolationException: Error attempting to get column ‘content’ from result set. Cause: java.sql.SQLDataException: Cannot convert string ‘2202’ to java.sql.Timestamp value</p>
</blockquote>
<p>实际上是因为没有空构造函数引起的错误，参考 <a href="https://github.com/baomidou/mybatis-plus/issues/1074">改变实体类成员变量的顺序,导致报错 · Issue #1074 · baomidou/mybatis-plus</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span> <span class="comment">// 添加这个</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span> <span class="comment">// 也加上这个</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Event</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date gmtCreate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date gmtModified;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String day;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Lombok-IDEA-异常"><a href="#Lombok-IDEA-异常" class="headerlink" title="Lombok IDEA 异常"></a>Lombok IDEA 异常</h2><p><a href="https://stackoverflow.com/questions/65128763/java-you-arent-using-a-compiler-supported-by-lombok-so-lombok-will-not-work-a">intellij idea - java: You aren’t using a compiler supported by lombok, so lombok will not work and has been disabled - Stack Overflow</a></p>
<blockquote>
<p><code>-Djps.track.ap.dependencies=false</code><br>Build, Execution, Deployment -&gt; Compiler -&gt; Shared build process VM options</p>
</blockquote>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Maven命令</title>
    <url>/java/maven-command/</url>
    <content><![CDATA[<h2 id="maven-修改版本号命令"><a href="#maven-修改版本号命令" class="headerlink" title="maven 修改版本号命令"></a>maven 修改版本号命令</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 更新根模块及所有子模块的版本号，同时会生成 pom.xml.versionsBackup 文件</span></span><br><span class="line">mvn versions:<span class="built_in">set</span> -DnewVersion=x.x.x-SNAPSHOT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交版本修改 同时会删除 pom.xml.versionsBackup 文件。</span></span><br><span class="line">mvn versions:commit</span><br></pre></td></tr></table></figure>

<p>ref:</p>
<blockquote>
<ul>
<li><a href="https://www.liujiajia.me/2018/11/29/maven-set-modules-version">【Maven】修改模块版本号 | 佳佳的博客</a></li>
<li><a href="https://github.com/alibaba/jetcache/wiki/DevNote_CN">DevNote_CN · alibaba/jetcache Wiki</a></li>
<li><a href="https://blog.csdn.net/ggbomb2/article/details/78316068">Versions maven plugin 修改版本_GGBomb2 的博客-CSDN 博客</a></li>
</ul>
</blockquote>
<h2 id="多个-maven-模块的项目，只打包某个模块和其关联的模块"><a href="#多个-maven-模块的项目，只打包某个模块和其关联的模块" class="headerlink" title="多个 maven 模块的项目，只打包某个模块和其关联的模块"></a>多个 maven 模块的项目，只打包某个模块和其关联的模块</h2><p>参考：<a href="https://blog.csdn.net/fqwgc8/article/details/50517821">Maven 多个 mudule 只编译、打包指定 module_fqwgc8 的博客-CSDN 博客_maven 编译指定 module</a></p>
<p>例如 A,B,P 的继承关系为<br>P<br>|<br>—– A<br>|<br>—– B</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">-pl, <span class="comment">--projects</span></span><br><span class="line">        Build specified reactor projects <span class="keyword">instead</span> <span class="keyword">of</span> <span class="keyword">all</span> projects</span><br><span class="line">-am, <span class="comment">--also-make</span></span><br><span class="line">        <span class="keyword">If</span> project list <span class="keyword">is</span> specified, <span class="keyword">also</span> build projects required <span class="keyword">by</span> the list</span><br></pre></td></tr></table></figure>

<p>打包 A</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入目录 P</span></span><br><span class="line">mvn install -pl A -am</span><br><span class="line"><span class="comment"># 添加prod参数</span></span><br><span class="line">mvn install -pl A -am -Pprod</span><br><span class="line">mvn package -pl A -am -Pprod</span><br></pre></td></tr></table></figure>

<h2 id="maven-多模块"><a href="#maven-多模块" class="headerlink" title="maven 多模块"></a>maven 多模块</h2><ul>
<li><a href="https://juejin.im/post/5cd15ed2e51d453b5854b881">三分钟把 spring boot 打成 war 包部署到 tomcat 中 - 掘金</a></li>
<li>打包共享 lib ，分离配置文件</li>
</ul>
<h2 id="模块太多，编译指定模块"><a href="#模块太多，编译指定模块" class="headerlink" title="模块太多，编译指定模块"></a>模块太多，编译指定模块</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 编译指定module</span></span><br><span class="line"><span class="comment"># [continuous integration - Skip a submodule during a Maven build - Stack Overflow](https://stackoverflow.com/questions/8304110/skip-a-submodule-during-a-maven-build)</span></span><br><span class="line"></span><br><span class="line">mvn -pl \</span><br><span class="line">:marketing-api-tv-topic-pk,\</span><br><span class="line">:marketing-api-phone-topic-pk\</span><br><span class="line">  clean install -Dmaven.skip.test=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="查看包依赖情况，从什么时候引入的"><a href="#查看包依赖情况，从什么时候引入的" class="headerlink" title="查看包依赖情况，从什么时候引入的"></a>查看包依赖情况，从什么时候引入的</h2><p><a href="https://www.cnblogs.com/wormday/p/8186109.html">通过 IntelliJ IDEA 和 Maven 命令查看某个 jar 包是怎么引入的 - 小墨的童鞋 - 博客园</a></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mvn dependency:tree -Dverbose <span class="attribute">-Dincludes</span>=org.yaml:snakeyaml</span><br></pre></td></tr></table></figure>

<h2 id="打包时跳过测试"><a href="#打包时跳过测试" class="headerlink" title="打包时跳过测试"></a>打包时跳过测试</h2><p>注意用的是 package 命令 而不是 war 命令</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line">mvn clean <span class="keyword">package</span> -Dmaven.test.skip=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Maven</title>
    <url>/java/maven/</url>
    <content><![CDATA[<h2 id="Run-Your-Maven-Build-Anywhere-with-the-Maven-Wrapper"><a href="#Run-Your-Maven-Build-Anywhere-with-the-Maven-Wrapper" class="headerlink" title="Run Your Maven Build Anywhere with the Maven Wrapper"></a><a href="https://reflectoring.io/maven-wrapper/">Run Your Maven Build Anywhere with the Maven Wrapper</a></h2><blockquote>
<p>mvn -N io.takari:maven:wrapper -Dmaven=3.6.3</p>
</blockquote>
<h2 id="Guide-to-installing-3rd-party-JARs"><a href="#Guide-to-installing-3rd-party-JARs" class="headerlink" title="Guide to installing 3rd party JARs"></a>Guide to installing 3rd party JARs</h2><p><a href="http://maven.apache.org/guides/mini/guide-3rd-party-jars-local.html">http://maven.apache.org/guides/mini/guide-3rd-party-jars-local.html</a></p>
<h2 id="pom-xml-文件-中-dependency-标记的-scope-属性解释："><a href="#pom-xml-文件-中-dependency-标记的-scope-属性解释：" class="headerlink" title="pom.xml 文件 中 dependency 标记的 scope 属性解释："></a>pom.xml 文件 中 dependency 标记的 scope 属性解释：</h2><p>compile，缺省值，适用于所有阶段，会随着项目一起发布。<br>provided，类似 compile，期望 JDK、容器或使用者会提供这个依赖。如 servlet.jar。<br>runtime，只在运行时使用，如 JDBC 驱动，适用运行和测试阶段。<br>test，只在测试时使用，用于编译和运行测试代码。不会随项目发布。<br>system，类似 provided，需要显式提供包含依赖的 jar，Maven 不会在 Repository 中查找它。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 如：system --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aqmd<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aqmd-netty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/lib/aqmd-netty-2.0.1.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="一键生成"><a href="#一键生成" class="headerlink" title="一键生成"></a>一键生成</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mvn archetype:generate -DgroupId=com.lyloou.app -DartifactId=algs4 -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="多模块开发"><a href="#多模块开发" class="headerlink" title="多模块开发"></a>多模块开发</h2><ul>
<li><a href="https://www.cnblogs.com/luxh/p/3506750.html">Maven 构建简单的多模块项目 - CN.programmer.Luxh - 博客园</a></li>
<li><a href="https://my.oschina.net/guoenzhou/blog/395851">基于 Maven 分模块开发实践 - 郭恩洲的个人页面 - OSCHINA</a></li>
<li><a href="https://juvenshun.iteye.com/blog/305865">Maven 最佳实践：划分模块 - Maven 中文 - ITeye 博客</a></li>
</ul>
<h2 id="nexus-安装"><a href="#nexus-安装" class="headerlink" title="nexus 安装"></a>nexus 安装</h2><h3 id="nexus2"><a href="#nexus2" class="headerlink" title="nexus2"></a>nexus2</h3><p><a href="https://www.cnblogs.com/dreamroute/p/5440419.html">【原创】Nexus 搭建 Maven 私服</a><br><a href="https://help.sonatype.com/repomanager2/installing-and-running/running">https://help.sonatype.com/repomanager2/installing-and-running/running</a></p>
<p>注意访问网址是： <a href="http://localhost:8081/nexus/">http://localhost:8081/nexus/</a></p>
<p>学习建议：mvn 这个东西，就是难者不会，会者不难。基本上按照这样一个路线就问题不大，基本使用 =&gt; 了解继承/聚合 =&gt; 了解 jar 包冲突机制，并解决冲突 =&gt;了解 mvn 的 3 个默认声明周期 ，生命周期的各个阶段 phase ，各个阶段的目标 goal =&gt; mvn 的插件开发 =&gt; Nexus 私服搭建及其使用。大致这样一个过程下来，就能非常熟悉 mvn，如果在稍微看看 mvn 的源码，大致看一看，基本上可以说是精通 mvn 了。</p>
<h3 id="nexus3"><a href="#nexus3" class="headerlink" title="nexus3"></a>nexus3</h3><p><a href="https://help.sonatype.com/repomanager3/download/download-archives---repository-manager-3">https://help.sonatype.com/repomanager3/download/download-archives---repository-manager-3</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker volume create --name nexus-data</span><br><span class="line">docker run -d -p 8081:8081 --name nexus3 -v nexus-data:/nexus-data sonatype/nexus3</span><br><span class="line"></span><br><span class="line">docker volume inspect nexus-data</span><br><span class="line"><span class="comment"># see admin password in nexus-data/admin.password</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/EasonJim/p/6858333.html">https://www.cnblogs.com/EasonJim/p/6858333.html</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nexus.exe /install &lt;optional-service-name&gt; <span class="comment">#安装</span></span><br><span class="line">nexus.exe /start &lt;optional-service-name&gt; <span class="comment">#开始</span></span><br><span class="line">nexus.exe /stop &lt;optional-service-name&gt; <span class="comment">#结束</span></span><br><span class="line">nexus.exe /uninstall &lt;optional-service-name&gt; <span class="comment">#卸载</span></span><br><span class="line"><span class="comment">#其中&lt;optional-service-name&gt;为服务的名称，可自定义</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://segmentfault.com/a/1190000003044418">使用 Maven 管理 Java 项目 - 大梦初晓 - SegmentFault 思否</a></li>
<li><a href="http://www.huangbowen.net/blog/2016/01/29/understand-official-version-and-snapshot-version-in-maven/">理解 Maven 中的 SNAPSHOT 版本和正式版本 - 黄博文的地盘</a></li>
<li><a href="http://wiki.jikexueyuan.com/project/maven/snapshots.html">Maven - 快照 - Maven 教程 - 极客学院 Wiki</a><br>快照 vs 版本<br>对于版本，Maven 一旦下载了指定的版本（例如 data-service:1.0），它将不会尝试从仓库里再次下载一个新的 1.0 版本。想要下载新的代码，数据服务版本需要被升级到 1.1。<br>对于快照，每次用户接口团队构建他们的项目时，Maven 将自动获取最新的快照（data-service:1.0-SNAPSHOT）。</li>
</ul>
<h2 id="设置-deploy-的地址"><a href="#设置-deploy-的地址" class="headerlink" title="设置 deploy 的地址"></a>设置 deploy 的地址</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml中加入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>remote-nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span> <span class="comment">&lt;!-- 注意id要和.m2文件夹中的setting.xml server标签下的id一样 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Releases<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/repository/maven-releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>remote-nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Snapshot<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/repository/maven-snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- .m2/setting.xml --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- [maven设置-setting.xml文件学习](https://blog.csdn.net/tomato__/article/details/13025187) --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- [Maven – Settings Reference](https://maven.apache.org/settings.html) --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>local-nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>remote-nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>name<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>password<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="有一些与-Maven-生命周期相关的重要概念需要说明"><a href="#有一些与-Maven-生命周期相关的重要概念需要说明" class="headerlink" title="有一些与 Maven 生命周期相关的重要概念需要说明"></a><a href="http://wiki.jikexueyuan.com/project/maven/build-life-cycle.html">有一些与 Maven 生命周期相关的重要概念需要说明</a></h2><p>当一个阶段通过 Maven 命令调用时，例如 mvn compile，只有该阶段之前以及包括该阶段在内的所有阶段会被执行。</p>
<p>不同的 maven 目标将根据打包的类型（JAR / WAR / EAR），被绑定到不同的 Maven 生命周期阶段。</p>
<h2 id="maven-dependency-中-scope-compile-和-provided-区别"><a href="#maven-dependency-中-scope-compile-和-provided-区别" class="headerlink" title="maven dependency 中 scope=compile 和 provided 区别"></a><a href="https://blog.csdn.net/mccand1234/article/details/60962283">maven dependency 中 scope=compile 和 provided 区别</a></h2><p>maven 中三种 classpath<br>编译，测试，运行<br>1.compile：默认范围，编译测试运行都有效<br>2.provided：在编译和测试时有效<br>3.runtime：在测试和运行时有效<br>4.test:只在测试时有效<br>5.system:在编译和测试时有效，与本机系统关联，可移植性差</p>
<h2 id="multiple-conflict"><a href="#multiple-conflict" class="headerlink" title="multiple conflict"></a>multiple conflict</h2><p><a href="https://stackoverflow.com/questions/14024756/slf4j-class-path-contains-multiple-slf4j-bindings">maven 2 - SLF4J: Class path contains multiple SLF4J bindings - Stack Overflow</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Generate-source-code-jar-for-Maven-based-project-–-Mkyong-com"><a href="#Generate-source-code-jar-for-Maven-based-project-–-Mkyong-com" class="headerlink" title="Generate source code jar for Maven based project – Mkyong.com"></a><a href="https://www.mkyong.com/maven/generate-source-code-jar-for-maven-based-project/">Generate source code jar for Maven based project – Mkyong.com</a></h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-source-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-sources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看 goal 和 phase 的默认绑定</span></span><br><span class="line">mvn <span class="built_in">help</span>:describe -Dplugin=org.apache.maven.plugins:maven-source-plugin:2.1.1 -Ddetail</span><br></pre></td></tr></table></figure>

<h2 id="打包的时候，resource-中的文件没有打包进去"><a href="#打包的时候，resource-中的文件没有打包进去" class="headerlink" title="打包的时候，resource 中的文件没有打包进去"></a>打包的时候，resource 中的文件没有打包进去</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mvn resources:resources</span><br></pre></td></tr></table></figure>

<p><a href="https://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html">Apache Maven Resources Plugin – Filtering</a></p>
<h2 id="其他镜像"><a href="#其他镜像" class="headerlink" title="其他镜像"></a>其他镜像</h2><ul>
<li><a href="https://yq.aliyun.com/articles/78124">最快的 maven repository–阿里镜像仓库-云栖社区-阿里云</a></li>
<li><a href="https://help.aliyun.com/document_detail/102512.html?spm=a2c4e.11153940.0.0.213c7bdebk30HM">阿里云帮助中心-阿里云，领先的云计算服务提供商</a></li>
</ul>
<h2 id="maven-加速"><a href="#maven-加速" class="headerlink" title="maven 加速"></a>maven 加速</h2><p><a href="https://zhuanlan.zhihu.com/p/71998219">将 maven 源改为国内阿里云镜像 - 知乎</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0</span></span></span><br><span class="line"><span class="string"><span class="tag">                      http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">localRepository</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">interactiveMode</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">usePluginRegistry</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">offline</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginGroups</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servers</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyunmaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>阿里云公共仓库<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/central<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>repo1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>central repo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repo1.maven.org/maven2/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyunmaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>apache snapshots<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>阿里云阿帕奇仓库<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/apache-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">proxies</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">activeProfiles</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyunmaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyunmaven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>MavenCentral<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repo1.maven.org/maven2/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyunmavenApache<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/apache-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="idea-中调用-compile-package-时跳过测试"><a href="#idea-中调用-compile-package-时跳过测试" class="headerlink" title="idea 中调用 compile, package 时跳过测试"></a>idea 中调用 compile, package 时跳过测试</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">org.mapstruct.version</span>&gt;</span>1.4.1.Final<span class="tag">&lt;/<span class="name">org.mapstruct.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- maven时跳过测试 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.test.skip</span>&gt;</span>true<span class="tag">&lt;/<span class="name">maven.test.skip</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Maven-如何为不同的环境打包-——-开发、测试和产品环境-作业部落-Cmd-Markdown-编辑阅读器"><a href="#Maven-如何为不同的环境打包-——-开发、测试和产品环境-作业部落-Cmd-Markdown-编辑阅读器" class="headerlink" title="Maven 如何为不同的环境打包 —— 开发、测试和产品环境 - 作业部落 Cmd Markdown 编辑阅读器"></a><a href="https://www.zybuluo.com/haokuixi/note/25985">Maven 如何为不同的环境打包 —— 开发、测试和产品环境 - 作业部落 Cmd Markdown 编辑阅读器</a></h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">runtime.env</span>&gt;</span>src/main/env/dev<span class="tag">&lt;/<span class="name">runtime.env</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">final.name</span>&gt;</span>webapp<span class="tag">&lt;/<span class="name">final.name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.eightqiu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>CodeCmns<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>qa<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">runtime.env</span>&gt;</span>src/main/env/qa<span class="tag">&lt;/<span class="name">runtime.env</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">final.name</span>&gt;</span>webapp_$&#123;buildNumber&#125;<span class="tag">&lt;/<span class="name">final.name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>buildnumber-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">phase</span>&gt;</span>validate<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>create<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">format</span>&gt;</span>&#123;0,date,yyyyMMdd&#125;<span class="tag">&lt;/<span class="name">format</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">items</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">item</span>&gt;</span>timestamp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">items</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">reporting</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.eightqiu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>CodeCmns<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">runtime.env</span>&gt;</span>src/main/env/prod<span class="tag">&lt;/<span class="name">runtime.env</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">final.name</span>&gt;</span>webapp<span class="tag">&lt;/<span class="name">final.name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.eightqiu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>CodeCmns<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="上传到-公网-maven-repository"><a href="#上传到-公网-maven-repository" class="headerlink" title="上传到 公网 maven repository"></a>上传到 公网 maven repository</h2><p><a href="https://maven.apache.org/repository/guide-central-repository-upload.html">https://maven.apache.org/repository/guide-central-repository-upload.html</a><br><a href="https://central.sonatype.org/pages/ossrh-guide.html">https://central.sonatype.org/pages/ossrh-guide.html</a><br><a href="https://central.sonatype.org/pages/apache-maven.html">https://central.sonatype.org/pages/apache-maven.html</a><br><a href="https://central.sonatype.org/publish/requirements/gpg">https://central.sonatype.org/publish/requirements/gpg</a></p>
<p><a href="https://my.oschina.net/vFfYcnn42VKa/blog/1524409">发布构件到 Maven 中央仓库 - 在风中的个人空间 - OSCHINA - 中文开源技术交流社区</a></p>
<blockquote>
<p>mvn clean deploy -P release -Dgpg.passphrase=密码<br>mvn clean deploy -Pdeploy</p>
</blockquote>
<p><a href="https://stackoverflow.com/questions/7446599/how-to-deploy-only-the-sub-modules-using-maven-deploy">How to Deploy only the sub-modules using maven deploy? - Stack Overflow</a></p>
<blockquote>
<p>mvn deploy -pl SubModuleB</p>
</blockquote>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>UML图</title>
    <url>/java/uml/</url>
    <content><![CDATA[<h4 id="UML-类图符号-各种关系说明以及举例"><a href="#UML-类图符号-各种关系说明以及举例" class="headerlink" title="UML 类图符号 各种关系说明以及举例"></a><a href="https://www.cnblogs.com/duanxz/archive/2012/06/13/2547801.html">UML 类图符号 各种关系说明以及举例</a></h4><ul>
<li>依赖（Dependency）:虚线箭头表示</li>
<li>关联（Association）：实线箭头表示</li>
<li>聚合（Aggregation）：带空心菱形头表示<blockquote>
<p>特征：属于是关联的特殊情况，体现部分-整体关系，是一种弱拥有关系；整体和部分可以有不一样的生命周期；是一种弱关联；</p>
</blockquote>
</li>
<li>组合（Composition）：带实心菱形头的实线表示<blockquote>
<p>特征：属于是关联的特殊情况，也体现了体现部分-整体关系，是一种强“拥有关系”；整体与部分有相同的生命周期，是一种强关联；</p>
</blockquote>
</li>
<li>泛化（Generalization）：带空心箭头的实线线表示 // 类继承类</li>
<li>实现（Realization）：空心箭头和虚线表示 // 类实现接口</li>
</ul>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Thrift</title>
    <url>/java/thrift/</url>
    <content><![CDATA[<ul>
<li><p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-apachethrift/index.html">Apache Thrift - 可伸缩的跨语言服务开发框架</a></p>
</li>
<li><p><a href="https://blog.csdn.net/zw19910924/article/details/78178539">跨语言RPC框架Thrift详解 - zw19910924的专栏 - CSDN博客</a></p>
</li>
<li><p><a href="https://zh.wikipedia.org/wiki/Thrift">Thrift - 维基百科，自由的百科全书</a></p>
</li>
</ul>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Zookeeper</title>
    <url>/java/zookeeper/</url>
    <content><![CDATA[<ol>
<li>按照 <a href="https://my.oschina.net/yafeiok/blog/618835">zookeeper入门与实战 - yafeiok1的个人空间 - 开源中国</a> 在linux上跑通。</li>
<li>看完后重新看一遍上面的文章。</li>
</ol>
<p><a href="https://blog.csdn.net/liu857279611/article/details/70495413">zookeeper之监听事件总结 - 航天飞哥的博客 - CSDN博客</a></p>
<p><a href="https://www.open-open.com/lib/view/open1456154723823.html">zookeeper入门与实战 - 分布式/云计算/大数据 - 服务器软件 - 深度开源</a></p>
<p><a href="https://www.cnblogs.com/hujiapeng/p/9019103.html">Zookeeper安装使用及JavaAPI使用 - jiapeng - 博客园</a></p>
<p><a href="https://m.w3cschool.cn/zookeeper/zookeeper_overview.html">Zookeeper 概述_Zookeeper教程_w3cschool</a></p>
<p><a href="https://www.cnblogs.com/felixzh/p/5869212.html">Zookeeper的功能以及工作原理 - 微信-大数据从业者 - 博客园</a></p>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java验证只有一个时间戳</title>
    <url>/java/%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AA%E6%97%B6%E9%97%B4%E6%88%B3%20/</url>
    <content><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>每个不同的地区都有对应有不同时间戳吗？</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//: 通过程序证明来时间戳只有一个；</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">now</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GregorianCalendar</span>();</span><br><span class="line">        System.out.println(TimeZone.getDefault());</span><br><span class="line">        System.out.println(now.getTime());</span><br><span class="line">        System.out.println(now.getTime().getTime());</span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        TimeZone.setDefault(TimeZone.getTimeZone(<span class="string">&quot;GMT+8&quot;</span>));</span><br><span class="line">        System.out.println(TimeZone.getDefault());</span><br><span class="line">        System.out.println(now.getTime());</span><br><span class="line">        System.out.println(now.getTime().getTime());</span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        TimeZone.setDefault(TimeZone.getTimeZone(<span class="string">&quot;GMT+0&quot;</span>));</span><br><span class="line">        System.out.println(TimeZone.getDefault());</span><br><span class="line">        System.out.println(now.getTime());</span><br><span class="line">        System.out.println(now.getTime().getTime());</span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        TimeZone.setDefault(TimeZone.getTimeZone(<span class="string">&quot;GMT+12&quot;</span>));</span><br><span class="line">        System.out.println(TimeZone.getDefault());</span><br><span class="line">        System.out.println(now.getTime());</span><br><span class="line">        System.out.println(now.getTime().getTime());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">sun.util.calendar.ZoneInfo[id=&quot;Asia/Shanghai&quot;,offset=28800000,dstSavings=0,useDaylight=false,transitions=19,lastRule=null]</span></span><br><span class="line"><span class="comment">Thu Aug 10 09:39:22 CST 2017</span></span><br><span class="line"><span class="comment">1502329162745</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">sun.util.calendar.ZoneInfo[id=&quot;GMT+08:00&quot;,offset=28800000,dstSavings=0,useDaylight=false,transitions=0,lastRule=null]</span></span><br><span class="line"><span class="comment">Thu Aug 10 09:39:22 GMT+08:00 2017</span></span><br><span class="line"><span class="comment">1502329162745</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">sun.util.calendar.ZoneInfo[id=&quot;GMT+00:00&quot;,offset=0,dstSavings=0,useDaylight=false,transitions=0,lastRule=null]</span></span><br><span class="line"><span class="comment">Thu Aug 10 01:39:22 GMT+00:00 2017</span></span><br><span class="line"><span class="comment">1502329162745</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">sun.util.calendar.ZoneInfo[id=&quot;GMT+12:00&quot;,offset=43200000,dstSavings=0,useDaylight=false,transitions=0,lastRule=null]</span></span><br><span class="line"><span class="comment">Thu Aug 10 13:39:22 GMT+12:00 2017</span></span><br><span class="line"><span class="comment">1502329162745</span></span><br><span class="line"><span class="comment">*/</span><span class="comment">//~</span></span><br></pre></td></tr></table></figure>

<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>只有一个时间戳；<br><strong>时间戳在所有地方都是一样的，只不过是该时间戳对应不同的地区有不同的当地时间表示（而不是有每个地区都有一个不同的时间戳）。</strong></p>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>【Java】那些踩过的坑</title>
    <url>/java/%E5%9D%91/</url>
    <content><![CDATA[<h2 id="BigDecimal-相等问题"><a href="#BigDecimal-相等问题" class="headerlink" title="BigDecimal 相等问题"></a>BigDecimal 相等问题</h2><p>切记，不能根据字面来判断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BigDecimalTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">num1</span> <span class="operator">=</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">num2</span> <span class="operator">=</span> <span class="string">&quot;0.00&quot;</span>;</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">bd1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(num1);</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">bd2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(num2);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result1</span> <span class="operator">=</span> bd1.equals(bd2);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result2</span> <span class="operator">=</span> bd1.compareTo(bd2) == <span class="number">0</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;result1:&quot;</span> + result1);</span><br><span class="line">        System.out.println(<span class="string">&quot;result2:&quot;</span> + result2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * output:</span></span><br><span class="line"><span class="comment"> * result1:false</span></span><br><span class="line"><span class="comment"> * result2:true</span></span><br><span class="line"><span class="comment"> */</span><span class="comment">//~</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="gson-不能正确解析双花括号语法"><a href="#gson-不能正确解析双花括号语法" class="headerlink" title="gson 不能正确解析双花括号语法"></a>gson 不能正确解析双花括号语法</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cronTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Item&gt; items = getItemsWithDoubleBrackets();</span><br><span class="line">        System.out.println(<span class="string">&quot;getItemsWithDoubleBrackets:&quot;</span>);</span><br><span class="line">        System.out.println(items);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Gson</span>().toJson(items));</span><br><span class="line"></span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;getItemsNormalWay:&quot;</span>);</span><br><span class="line">        items = getItemsNormalWay();</span><br><span class="line">        System.out.println(items);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Gson</span>().toJson(items));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;Item&gt; <span class="title function_">getItemsWithDoubleBrackets</span><span class="params">()</span> &#123;</span><br><span class="line">        count = <span class="number">0</span>;</span><br><span class="line">        ArrayList&lt;Item&gt; items = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            items.add(<span class="keyword">new</span> <span class="title class_">Item</span>() &#123;&#123; <span class="comment">// double brackets</span></span><br><span class="line">                setContent(<span class="string">&quot;美好的一天&quot;</span> + count++);</span><br><span class="line">            &#125;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;Item&gt; <span class="title function_">getItemsNormalWay</span><span class="params">()</span> &#123;</span><br><span class="line">        count = <span class="number">0</span>;</span><br><span class="line">        ArrayList&lt;Item&gt; items = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="type">Item</span> <span class="variable">item</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Item</span>();</span><br><span class="line">            item.setContent(<span class="string">&quot;美好的一天&quot;</span> + count++);</span><br><span class="line">            items.add(item);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Item</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(String content)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.content = content;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&#123;&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;content=&#x27;&quot;</span> + content + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">/*</span></span><br><span class="line"><span class="comment">getItemsWithDoubleBrackets:</span></span><br><span class="line"><span class="comment">[&#123;content=&#x27;美好的一天0&#x27;&#125;, &#123;content=&#x27;美好的一天1&#x27;&#125;, &#123;content=&#x27;美好的一天2&#x27;&#125;]</span></span><br><span class="line"><span class="comment">[null,null,null]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">getItemsNormalWay:</span></span><br><span class="line"><span class="comment">[&#123;content=&#x27;美好的一天0&#x27;&#125;, &#123;content=&#x27;美好的一天1&#x27;&#125;, &#123;content=&#x27;美好的一天2&#x27;&#125;]</span></span><br><span class="line"><span class="comment">[&#123;&quot;content&quot;:&quot;美好的一天0&quot;&#125;,&#123;&quot;content&quot;:&quot;美好的一天1&quot;&#125;,&#123;&quot;content&quot;:&quot;美好的一天2&quot;&#125;]</span></span><br><span class="line"><span class="comment">*/</span><span class="comment">//~</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>原因是：添加的时候是匿名内部类，此匿名内部类不符合 gson 序列化规则，所以会是 <code>null</code>。</p>
<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/20210809152418.png" alt="image-20210809152411331" style="zoom: 80%;"><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/20210809153711.png" alt="image-20210809153711267" style="zoom:80%;"></p>
<h2 id="Gson-doesn’t-deserialise-Long-numbers-correctly"><a href="#Gson-doesn’t-deserialise-Long-numbers-correctly" class="headerlink" title="Gson doesn’t deserialise Long numbers correctly"></a>Gson doesn’t deserialise Long numbers correctly</h2><p>RecordUtils.toRecord(proxyStocksOrders)，让 flow_id 变成了重复的了，解决办法是用 Record 来逐个写；<br>如，<code>ProxyDaoImpl.lock()</code>方法里的 <code>save()</code> 方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RecordUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实体类转record</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Record <span class="title function_">toRecord</span><span class="params">(Object data)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (data == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">        Map&lt;String, Object&gt; json = <span class="keyword">new</span> <span class="title class_">Gson</span>().fromJson(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">GsonBuilder</span>()</span><br><span class="line">                        .setFieldNamingStrategy(FieldNamingPolicy.LOWER_CASE_WITH_UNDERSCORES)</span><br><span class="line">                        .setDateFormat(CONST.FORMAT)</span><br><span class="line">                        .create().toJson(data, data.getClass()),</span><br><span class="line">                HashMap.class</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Record</span>().setColumns(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Main</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Record&gt; records = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Order&gt; orders = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">            <span class="type">long</span> <span class="variable">flowId</span> <span class="operator">=</span> Long.parseLong(Common.getPsoFlowId());</span><br><span class="line">            order.setFlowId(flowId);</span><br><span class="line">            order.setName(String.valueOf(flowId));</span><br><span class="line"></span><br><span class="line">            orders.add(order);</span><br><span class="line">            records.add(RecordUtils.toRecord(order));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;----------&quot;</span>);</span><br><span class="line">        records.forEach(System.out::println);</span><br><span class="line">        System.out.println(<span class="string">&quot;----------&quot;</span>);</span><br><span class="line">        orders.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原因是，gson 将 long 类型的数据做了转换（如：把<code>20200426163033383</code>转换成了<code>2.0200426163033384E16</code>，把<code>20200426163034384</code> 也转换成了 <code>2.0200426163034384E16</code>。<br>有一种解决办法是，对于这种 flow_id 这种类型的字段，用 <code>string</code> 类型，而不是 <code>long</code> 类型。</p>
<p>还有一种办法，添加：LongSerializationPolicy</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://github.com/google/gson/issues/1084</span></span><br><span class="line"><span class="keyword">new</span> <span class="constructor">GsonBuilder()</span></span><br><span class="line">        .set<span class="constructor">FieldNamingStrategy(FieldNamingPolicy.LOWER_CASE_WITH_UNDERSCORES)</span></span><br><span class="line">        .set<span class="constructor">DateFormat(CONST.FORMAT)</span></span><br><span class="line">        .set<span class="constructor">LongSerializationPolicy(LongSerializationPolicy.STRING)</span> <span class="comment">// add this line</span></span><br><span class="line">        .create<span class="literal">()</span>.<span class="keyword">to</span><span class="constructor">Json(<span class="params">data</span>, <span class="params">data</span>.<span class="params">getClass</span>()</span>),</span><br></pre></td></tr></table></figure>

<h2 id="mybatis-语句拼接问题"><a href="#mybatis-语句拼接问题" class="headerlink" title="mybatis 语句拼接问题"></a>mybatis 语句拼接问题</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 从 provider_marketable_goods 表中删除数据</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> providerIds 拼接的 providerId</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Update(&quot;&lt;script&gt;&quot; +</span></span><br><span class="line"><span class="meta">        &quot;delete from goods where provider_id in (#&#123;providerIds&#125;)&quot; +</span></span><br><span class="line"><span class="meta">        &quot;&lt;/script&gt;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">removeGoodsByProviderId</span><span class="params">(<span class="meta">@Param(&quot;providerIds&quot;)</span> String providerIds)</span>;</span><br></pre></td></tr></table></figure>

<p>实际的运行 sql 语句是： delete from goods where provider_id in (‘23,432,4432,4432’)</p>
<p>下面这个才是你想要的：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 从 provider_marketable_goods 表中删除数据</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> providerIds 拼接的 providerId</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Update(&quot;&lt;script&gt;&quot; +</span></span><br><span class="line"><span class="meta">        &quot;delete from goods where provider_id in (&quot; +</span></span><br><span class="line"><span class="meta">        &quot;&lt;foreach collection=&#x27;providerIds&#x27; item=&#x27;providerId&#x27; separator=&#x27;,&#x27;&gt;&quot; +</span></span><br><span class="line"><span class="meta">        &quot;#&#123;providerId&#125;&quot; +</span></span><br><span class="line"><span class="meta">        &quot;&lt;/foreach&gt;&quot; +</span></span><br><span class="line"><span class="meta">        &quot;)&quot; +</span></span><br><span class="line"><span class="meta">        &quot;&lt;/script&gt;&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">removeGoodsByProviderId</span><span class="params">(<span class="meta">@Param(&quot;providerIds&quot;)</span> Set&lt;Long&gt; providerIds)</span>;</span><br></pre></td></tr></table></figure>

<p>实际的运行 sql 语句是： delete from goods where provider_id in (23,432,4432,4432)</p>
<h2 id="作用域问题"><a href="#作用域问题" class="headerlink" title="作用域问题"></a>作用域问题</h2><p>搞错作用域，会导致获取的数据莫名其妙。<br>例如下面，本该放在循环内的，结果放在了循环之内（这种 bug 比较难找，要小心才是）。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">divideToHandleProviderIdToGoodsIdListMap</span><span class="params">(Consumer&lt;Map&lt;Long, List&lt;Integer&gt;&gt;&gt; consumer)</span> &#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;Long, List&lt;Integer&gt;&gt; map = Maps.newHashMap(); <span class="comment">// outside the loop</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    List&lt;ProviderGoods&gt; list;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        list = providerMarketableDao.getProviderGoodsFromGoods(count * number, number);</span><br><span class="line">        list.stream().collect(Collectors.groupingBy(ProviderGoods::getProviderId))</span><br><span class="line">                .forEach((providerId, providerGoodsList) -&gt; &#123;</span><br><span class="line">                    map.put(providerId, providerGoodsList.stream()</span><br><span class="line">                            .map(ProviderGoods::getGoodsId)</span><br><span class="line">                            .collect(Collectors.toList()));</span><br><span class="line">                &#125;);</span><br><span class="line">        consumer.accept(map);</span><br><span class="line">        count++;</span><br><span class="line">    &#125; <span class="keyword">while</span> (isNotEmptyList(list));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">divideToHandleProviderIdToGoodsIdListMap</span><span class="params">(Consumer&lt;Map&lt;Long, List&lt;Integer&gt;&gt;&gt; consumer)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    List&lt;ProviderGoods&gt; list;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        Map&lt;Long, List&lt;Integer&gt;&gt; map = Maps.newHashMap(); <span class="comment">// within the loop</span></span><br><span class="line">        list = providerMarketableDao.getProviderGoodsFromGoods(count * number, number);</span><br><span class="line">        list.stream().collect(Collectors.groupingBy(ProviderGoods::getProviderId))</span><br><span class="line">                .forEach((providerId, providerGoodsList) -&gt; &#123;</span><br><span class="line">                    map.put(providerId, providerGoodsList.stream()</span><br><span class="line">                            .map(ProviderGoods::getGoodsId)</span><br><span class="line">                            .collect(Collectors.toList()));</span><br><span class="line">                &#125;);</span><br><span class="line">        consumer.accept(map);</span><br><span class="line">        count++;</span><br><span class="line">    &#125; <span class="keyword">while</span> (isNotEmptyList(list));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java中的存储单位</title>
    <url>/java/%E5%AD%98%E5%82%A8%E5%8D%95%E4%BD%8D/</url>
    <content><![CDATA[<blockquote>
<p>一直觉得自己的Java基础还可以，真的在面试的时候才发现，还是太肤浅了（我根本没法表达清楚）。</p>
</blockquote>
<h1 id="存储单位"><a href="#存储单位" class="headerlink" title="存储单位"></a>存储单位</h1><ul>
<li>位（bit），计算机存储信息的最小单位，二进制的一个“0”或者“1”表示一位。</li>
<li>字节（Byte），计算机存储容量基本单位是字节，8个二进制位表示一个字节。</li>
<li>（字符，是一种标记符号（像<code>a</code>,<code>b</code>,<code>A</code>），同以上的存储单位不是一回事。）<blockquote>
<p>计算机内存和硬盘等存储空间的管理都是以字节为基本单位，每个字节都有自己的编号，而“字符-Char”是<br> 人们用作标记的符号，如’A’, ‘-‘等，每个字符都有约定的抽象含义。</p>
</blockquote>
</li>
</ul>
<h1 id="基础类型"><a href="#基础类型" class="headerlink" title="基础类型"></a>基础类型</h1><p>在Java中有8种基本数据类型 —— 4种整型，2种浮点类型，1种表示Unicode编码的字符单元的字符类型，<br>1种表示真值的boolean类型。（一个字节8位）</p>
<ol>
<li><p>整型</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">类型          存储需求            bit数            取值范围            备注</span><br><span class="line"><span class="type">int</span>           <span class="number">4</span>字节               <span class="number">4</span>*<span class="number">8</span></span><br><span class="line"><span class="type">short</span>         <span class="number">2</span>字节               <span class="number">2</span>*<span class="number">8</span>             <span class="number">-32768</span>~<span class="number">32767</span></span><br><span class="line"><span class="type">long</span>          <span class="number">8</span>字节               <span class="number">8</span>*<span class="number">8</span></span><br><span class="line"><span class="type">byte</span>          <span class="number">1</span>字节               <span class="number">1</span>*<span class="number">8</span>             <span class="number">-128</span>~<span class="number">127</span></span><br></pre></td></tr></table></figure></li>
<li><p>浮点型</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">类型          存储需求            bit数            取值范围            备注</span><br><span class="line"><span class="type">float</span>         <span class="number">4</span>字节               <span class="number">4</span>*<span class="number">8</span>                             （区别于<span class="type">double</span>，有后缀`F`）</span><br><span class="line"><span class="type">double</span>        <span class="number">8</span>字节               <span class="number">8</span>*<span class="number">8</span></span><br></pre></td></tr></table></figure></li>
<li><p>char类型</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">类型          存储需求            bit数            取值范围            备注</span><br><span class="line"><span class="type">char</span>          <span class="number">2</span>字节               <span class="number">2</span>*<span class="number">8</span></span><br></pre></td></tr></table></figure></li>
<li><p>boolean类型</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">类型          存储需求            bit数            取值范围            备注</span><br><span class="line"><span class="type">boolean</span>       <span class="number">1</span>字节               <span class="number">1</span>*<span class="number">8</span>            <span class="literal">false</span>/<span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>（对于范围很大的数，用<code>BigDecimal</code>, <code>BigInteger</code>来表示。）</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="http://jrunner.blog.51cto.com/1015356/490317">位、字符、字节、有什么区别</a></li>
<li><a href="http://m.blog.csdn.net/article/details?id=12029917">java中基本类型占用字节数</a></li>
<li><a href="http://www.baike.com/wiki/Java%E5%AD%97%E7%AC%A6">Java字符——互动百科</a></li>
</ul>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java名词解释</title>
    <url>/java/%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A/</url>
    <content><![CDATA[<h2 id="DAO"><a href="#DAO" class="headerlink" title="DAO"></a>DAO</h2><blockquote>
<p>在计算机软件中，数据访问对象（data access object，DAO）是为某种类型的数据库或其他持久性机制提供一个抽象接口的对象。通过映射应用程序对持久层的调用，DAO 提供一些特定的数据操作，而无需暴露数据库细节。这种隔离支持单一功能原则。它分离了应用程序需要访问哪些数据，就域特定对象和数据类型（DAO 的公共接口），而言，这些需求可以用数据库管理系统（DBMS）、数据库模式等满足（DAO 的实现）。</p>
</blockquote>
<ul>
<li><a href="https://zh.wikipedia.org/zh-cn/%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%AF%B9%E8%B1%A1">https://zh.wikipedia.org/zh-cn/%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%AF%B9%E8%B1%A1</a></li>
</ul>
<h2 id="POJO-amp-JavaBean"><a href="#POJO-amp-JavaBean" class="headerlink" title="POJO &amp; JavaBean"></a>POJO &amp; JavaBean</h2><p><strong>POJO</strong><br>使用 POJO 名称是为了避免和 EJB 混淆起来, 而且简称比较直接. 其中有一些属性及其 getter setter 方法的类,没有业务逻辑，有时可以作为 VO(value -object)或 dto(Data Transform Object)来使用.<br>当然,如果你有一个简单的运算属性也是可以的,但不允许有业务方法,也不能携带有 connection 之类的方法。</p>
<p>下面是摘自 Martin Fowler 个人网站的一句话：<br>“We wondered why people were so against using regular objects in their systems and concluded that it was because simple objects lacked a fancy name. So we gave them one, and it’s caught on very nicely.”－－Martin Fowler<br>我们疑惑为什么人们不喜欢在他们的系统中使用普通的对象，我们得到的结论是——普通的对象缺少一个响亮的名字，因此我们给它们起了一个，并且取得了很好的效果。——Martin Fowler</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">分层领域模型规约</span><br><span class="line">- DO（Data Object）：此对象与数据库表结构一一对应，通过 DAO 层向上传输数据源对象。</span><br><span class="line">- DTO（Data Transfer Object）：数据传输对象，Service 或 Manager 向外传输的对象。</span><br><span class="line">- BO（Business Object）：业务对象，由 Service 层输出的封装业务逻辑的对象。</span><br><span class="line">- AO（Application Object）：应用对象，在 Web 层与 Service 层之间抽象的复用对象模型，极为贴近展示层，复用度不高。</span><br><span class="line">- VO（View Object）：显示层对象，通常是 Web 向模板渲染引擎层传输的对象。</span><br><span class="line">- Query：数据查询对象，各层接收上层的查询请求。注意超过 2 个参数的查询封装，禁止使用 Map 类来传输。</span><br><span class="line">// 阿里巴巴Java开发手册1.4.0.pdf</span><br></pre></td></tr></table></figure>

<p><strong>JavaBean</strong><br>JavaBeans 是 Java 中一种特殊的类，可以将多个对象封装到一个对象（bean）中。特点是可序列化，提供无参构造器，提供 getter 方法和 setter 方法访问对象的属性。名称中的“Bean”是用于 Java 的可重用软件组件的惯用叫法。</p>
<p>Java Bean 是可复用的组件，对 Java Bean 并没有严格的规范，理论上讲，任何一个 Java 类都可以是一个 Bean 。<br>但通常情况下，由于 Java Bean 是被容器所创建（如 Tomcat) 的，所以 Java Bean 应具有一个无参的构造器，另外，通常 Java Bean 还要实现 Serializable 接口用于实现 Bean 的持久性。 Java Bean 是不能被跨进程访问的。JavaBean 是一种组件技术，就好像你做了一个扳子，而这个扳子会在很多地方被拿去用，这个扳子也提供多种功能(你可以拿这个扳子扳、锤、撬等等)，而这个扳子就是一个组件。</p>
<ul>
<li><a href="https://zh.wikipedia.org/wiki/JavaBeans">https://zh.wikipedia.org/wiki/JavaBeans</a></li>
<li><a href="https://blog.csdn.net/qq_27093465/article/details/52527270">POJO 是什么，javabean 是什么，以及 POJO 与 javabean 的区别 - CSDN 博客</a></li>
<li><a href="https://blog.csdn.net/chenchunlin526/article/details/69939337">什么是 JavaBean、bean? 什么是 POJO、PO、DTO、VO、BO ? 什么是 EJB、EntityBean？ - chunlynn 的小屋 | 头条号：有范管理美学 - CSDN 博客</a></li>
</ul>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java学习资料</title>
    <url>/java/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/</url>
    <content><![CDATA[<h2 id="学习途径"><a href="#学习途径" class="headerlink" title="学习途径"></a>学习途径</h2><ul>
<li>GitHub</li>
<li>Stackoverflow</li>
<li>Twitter</li>
<li>牛人关注的牛人</li>
</ul>
<h2 id="java-tutorial-搜索"><a href="#java-tutorial-搜索" class="headerlink" title="java tutorial 搜索"></a>java tutorial 搜索</h2><p><a href="https://docs.oracle.com/javase/tutorial/search.html">https://docs.oracle.com/javase/tutorial/search.html</a></p>
<h2 id="发展趋势"><a href="#发展趋势" class="headerlink" title="发展趋势"></a>发展趋势</h2><p><a href="https://github.com/trending/java">https://github.com/trending/java</a></p>
<ul>
<li><p><a href="https://blog.csdn.net/wisgood/article/details/52503052">使用 Java 8 Optional 的正确姿势 - CSDN博客</a></p>
</li>
<li><p><a href="http://www.huangbowen.net/blog/2017/02/23/alibaba-java-code-style/">阿里巴巴Java开发手册评述</a></p>
</li>
<li><p><a href="https://yq.aliyun.com/articles/69327">《阿里巴巴Java开发手册v1.4.0（详尽版）》更新，新增16条设计规约-博客-云栖社区-阿里云</a></p>
</li>
<li><p><a href="https://google.github.io/styleguide/javaguide.html">Google Java Style Guide</a></p>
</li>
</ul>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>【Java】基于方法引用的构建器模式运用</title>
    <url>/java/%E5%9F%BA%E4%BA%8E%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8%E7%9A%84%E6%9E%84%E5%BB%BA%E5%99%A8%E6%A8%A1%E5%BC%8F%E8%BF%90%E7%94%A8/</url>
    <content><![CDATA[<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>封装一个 set 对象构建器，利用类的 set 引用方法（不局限 set 开头的方法）来设值，便于点式调用。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.bean.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String other;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">appendOther</span><span class="params">(String other)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.other = other;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 方法1，普通语法（推荐）</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user1.setName(<span class="string">&quot;Jojo&quot;</span>);</span><br><span class="line">        user1.setAge(<span class="number">18</span>);</span><br><span class="line">        user1.setSex(<span class="string">&quot;女&quot;</span>);</span><br><span class="line">        user1.setEmail(<span class="string">&quot;JoJo@example.com&quot;</span>);</span><br><span class="line">        user1.appendOther(<span class="string">&quot;其他数据&quot;</span>);</span><br><span class="line">        System.out.println(user1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 方法2，双括号语法（本质是匿名函数。不推荐使用，可能引起内层泄露）</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>() &#123;&#123;</span><br><span class="line">            setName(<span class="string">&quot;Jojo&quot;</span>);</span><br><span class="line">            setAge(<span class="number">18</span>);</span><br><span class="line">            setSex(<span class="string">&quot;女&quot;</span>);</span><br><span class="line">            setEmail(<span class="string">&quot;JoJo@example.com&quot;</span>);</span><br><span class="line">            appendOther(<span class="string">&quot;其他数据&quot;</span>);</span><br><span class="line">        &#125;&#125;;</span><br><span class="line">        System.out.println(user2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 方法3：set 构建器（推荐）</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">User</span> <span class="variable">user3</span> <span class="operator">=</span> SetBuilder.of(<span class="keyword">new</span> <span class="title class_">User</span>())</span><br><span class="line">                .set(User::setName, <span class="string">&quot;JoJo&quot;</span>)</span><br><span class="line">                .set(User::setAge, <span class="number">18</span>)</span><br><span class="line">                .set(User::setSex, <span class="string">&quot;女&quot;</span>)</span><br><span class="line">                .set(User::setEmail, <span class="string">&quot;JoJo@example.com&quot;</span>)</span><br><span class="line">                .set(User::appendOther, <span class="string">&quot;其他数据&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        System.out.println(user3);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 方法4：反射设值</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">User</span> <span class="variable">user4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        BeanUtil.setFieldValue(user4, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;JoJo&quot;</span>);</span><br><span class="line">        BeanUtil.setFieldValue(user4, <span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        BeanUtil.setFieldValue(user4, <span class="string">&quot;sex&quot;</span>, <span class="string">&quot;女&quot;</span>);</span><br><span class="line">        BeanUtil.setFieldValue(user4, <span class="string">&quot;email&quot;</span>, <span class="string">&quot;JoJo@example.com&quot;</span>);</span><br><span class="line">        BeanUtil.setFieldValue(user4, <span class="string">&quot;other&quot;</span>, <span class="string">&quot;其他数据&quot;</span>);</span><br><span class="line">        System.out.println(user4);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打印：</span></span><br><span class="line"><span class="comment">     User(name=Jojo, age=18, sex=女, email=JoJo@example.com, other=其他数据)</span></span><br><span class="line"><span class="comment">     User(name=Jojo, age=18, sex=女, email=JoJo@example.com, other=其他数据)</span></span><br><span class="line"><span class="comment">     User(name=JoJo, age=18, sex=女, email=JoJo@example.com, other=其他数据)</span></span><br><span class="line"><span class="comment">     User(name=JoJo, age=18, sex=女, email=JoJo@example.com, other=其他数据)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装一个set构建器，基于对象的 set 引用方法来设值</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; 指定对象泛型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetBuilder</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> T object;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; SetBuilder&lt;T&gt; <span class="title function_">of</span><span class="params">(T object)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SetBuilder</span>&lt;&gt;(object);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造函数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object 对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SetBuilder</span><span class="params">(T object)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.object = object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 链式调用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setter set引用方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value  要设置的属性值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;V&gt;    对象泛型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> builder，可链式调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;V&gt; SetBuilder&lt;T&gt; <span class="title function_">set</span><span class="params">(Setter&lt;T, V&gt; setter, V value)</span> &#123;</span><br><span class="line">        setter.set(object, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 构建后对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@FunctionalInterface</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Setter</span>&lt;T, V&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 调用set方法</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> t     实体对象</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> value 实体对象属性值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T t, V value)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>定时任务</title>
    <url>/java/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
    <content><![CDATA[<h2 id="Quartz-在某一天的某一秒执行一个任务"><a href="#Quartz-在某一天的某一秒执行一个任务" class="headerlink" title="Quartz 在某一天的某一秒执行一个任务"></a>Quartz 在某一天的某一秒执行一个任务</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">; job.properties</span></span><br><span class="line"><span class="attr">a.job</span>=com.lyloou.FeeJob</span><br><span class="line"><span class="attr">a.cron</span>=<span class="number">0</span> <span class="number">0</span>/<span class="number">1</span> * * * ?</span><br><span class="line"><span class="attr">a.enable</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>更多 cron 配置，看 <a href="./job.html">链接</a></p>
</blockquote>
<h3 id="Quartz-在某一天的某一秒执行一个任务-1"><a href="#Quartz-在某一天的某一秒执行一个任务-1" class="headerlink" title="Quartz 在某一天的某一秒执行一个任务"></a>Quartz 在某一天的某一秒执行一个任务</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// TimeUtils.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeUtils</span> &#123;</span><br><span class="line">    <span class="comment">// 1月中的15号，0点整</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Timestamp <span class="title function_">getMonthDay15</span><span class="params">(Date date)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        calendar.setTime(date);</span><br><span class="line">        calendar.set(Calendar.DAY_OF_MONTH, <span class="number">15</span>);</span><br><span class="line">        calendar.set(Calendar.HOUR_OF_DAY, <span class="number">0</span>);</span><br><span class="line">        calendar.set(Calendar.MINUTE, <span class="number">0</span>);</span><br><span class="line">        calendar.set(Calendar.SECOND, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Timestamp</span>(calendar.getTimeInMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FeeJob.java</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 入账任务</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lyloou</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeeJob</span> <span class="keyword">implements</span> <span class="title class_">Job</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.get(FeeJob.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(JobExecutionContext jec)</span> &#123;</span><br><span class="line">        <span class="comment">// 1分钟执行一次</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="keyword">if</span> (TimeUtils.getMonthDay15(date).getTime() != date.getTime()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// do your job here</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">spend</span> <span class="operator">=</span> System.currentTimeMillis() - t1;</span><br><span class="line">        logger.info(String.format(<span class="string">&quot;%s|执行xxx任务，耗时%s：&quot;</span>, getClass().getName(), spend));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java方法的按值调用</title>
    <url>/java/%E6%8C%89%E5%80%BC%E8%B0%83%E7%94%A8/</url>
    <content><![CDATA[<p>java程序设计<code>总是</code>采用<code>按值调用</code>。</p>
<p>方法参数有两种类型：</p>
<ul>
<li>基本数据类型（数字、布尔值）</li>
<li>对象引用</li>
</ul>
<p>在传递对象的时候，实际上传递的是对象的引用拷贝。<br>对象引用和引用拷贝指向的是同一个对象，<br>可以通过对象自身的方法修改自己。</p>
<p>java中方法参数的使用情况</p>
<ul>
<li>一个方法不能修改一个基本数据类型的参数（即数值型或布尔型）</li>
<li>一个方法可以改变一个对象参数的状态。</li>
<li>一个方法不能让对象参数引用一个新的对象。</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li>《java核心技术卷1》第10版，p118</li>
</ul>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>攻克目标</title>
    <url>/java/%E6%94%BB%E5%85%8B%E7%9B%AE%E6%A0%87/</url>
    <content><![CDATA[<h1 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h1><h2 id="Java技术"><a href="#Java技术" class="headerlink" title="Java技术"></a>Java技术</h2><h2 id="主流开发框架"><a href="#主流开发框架" class="headerlink" title="主流开发框架"></a>主流开发框架</h2><p>Spring</p>
<p>Dubbo</p>
<p>Kafka</p>
<p>Redis</p>
<p>Canal</p>
<p>ElasticSearch</p>
<h2 id="相关能力"><a href="#相关能力" class="headerlink" title="相关能力"></a>相关能力</h2><p>分布式、高并发、高可用大型系统架构设计能力和相关经验；<br>极强的产品思维和业务理解能力，熟练掌握软件设计原则；<br>熟悉各类算法、分布式、中间件、服务化框架、负载均衡，相关高性能、高可用系统架构设计成功实践；<br>熟悉流程引擎、规则引擎相关技术的应用，有过多业务场景下的协同系统的开发实践经验；<br>有良好的沟通能力和自我驱动力，具备一定的项目管理能力，能规划中长期架构方向者。</p>
<h1 id="层面："><a href="#层面：" class="headerlink" title="层面："></a>层面：</h1><h2 id="学习阶段"><a href="#学习阶段" class="headerlink" title="学习阶段"></a>学习阶段</h2><ol>
<li>这个技术出现的背景、初衷和要达到什么样的目标或是要解决什么样的问题？</li>
<li>这个技术的优势和劣势分别是什么？</li>
<li>这个技术的适用场景？</li>
<li>技术的组成部分和关键实现？</li>
<li>已有的实现和它之间的对比？</li>
</ol>
<h2 id="实战阶段"><a href="#实战阶段" class="headerlink" title="实战阶段"></a>实战阶段</h2><ol>
<li>基本使用demo</li>
<li>练手项目</li>
<li>真项目</li>
</ol>
<p>高质量的信息和第一手的知识<br>知识连成地图（通过问题来学习，有的放矢）<br>不断反思，与不同年龄的人讨论<br>举一反三，并实践，知识转换成技能。</p>
<p>学习是为了改变自己。<br>坚持是一件反人性的事，所以，它才难能可贵，也更有价值。<br>人不怕笨，怕的是懒，怕的是找到各种理由放弃。<br>坚持也不是要苦苦的坚持，有循环有成就感的坚持才是真正可以持续的。<br>所以一方面：要把你的坚持形成成果晒出来，让别人来给你点赞。<br>另一方面：还要把坚持变成一种习惯，就像吃饭喝水一样，你感觉不到太多的成本付出。</p>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java 数值</title>
    <url>/java/%E6%95%B0%E5%80%BC/</url>
    <content><![CDATA[<h2 id="取整"><a href="#取整" class="headerlink" title="取整"></a>取整</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 向上取整（天花板）</span></span><br><span class="line">Math.ceil();</span><br><span class="line"><span class="comment">// 向下取整（地板）</span></span><br><span class="line">Math.floor();</span><br></pre></td></tr></table></figure>

<h2 id="判断两个金额是否相等"><a href="#判断两个金额是否相等" class="headerlink" title="判断两个金额是否相等"></a>判断两个金额是否相等</h2><blockquote>
<p>注意不能直接使用<code>equal</code> 或 <code>==</code> ， 例如： <code>0.01</code> 和 <code>0.010</code> 实际上是一样的</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 比较两个数值是否相等</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isEqual</span><span class="params">(Object x, Object y)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> compareTo(x, y) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 比较数字大小，x &gt; y返回-1，x = y返回0，x &lt; y返回1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Object x, Object y)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(x + <span class="string">&quot;&quot;</span>).compareTo(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(y + <span class="string">&quot;&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">a</span> <span class="operator">=</span> divide(<span class="number">1</span>, <span class="number">7</span>, <span class="number">2</span>, RoundingMode.HALF_EVEN);</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">b</span> <span class="operator">=</span> divide(<span class="number">6</span>, <span class="number">7</span>, <span class="number">2</span>, RoundingMode.HALF_EVEN);</span><br><span class="line">        System.out.println(a);</span><br><span class="line">        System.out.println(b);</span><br><span class="line">        System.out.println(CalcUtils.add(a, b));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BigDecimal <span class="title function_">divide</span><span class="params">(Object x, Object y, <span class="type">int</span> bit, RoundingMode mode)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(x + <span class="string">&quot;&quot;</span>).divide(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(y + <span class="string">&quot;&quot;</span>), bit, mode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>服务端统一返回格式</title>
    <url>/java/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%BB%9F%E4%B8%80%E8%BF%94%E5%9B%9E%E6%A0%BC%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="返回的-json-信息"><a href="#返回的-json-信息" class="headerlink" title="返回的 json 信息"></a>返回的 json 信息</h2><ul>
<li>错误情况</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;err_code&quot;</span><span class="punctuation">:</span> <span class="number">1003</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;err_msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;参数错误，超出最大数量限制&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>正常情况</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;err_code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;err_msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ok&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lyloou&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lyloou@qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;personal_signature&quot;</span><span class="punctuation">:</span> <span class="string">&quot;多么美好的太阳&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gmt_create&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2020-01-16T09:38:18.000+0000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gmt_modified&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2020-03-14T11:27:58.000+0000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;is_disabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;err_code&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> status;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;err_msg&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;data&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">(<span class="type">int</span> status, String msg)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.status = status;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">data</span><span class="params">(Object data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">msg</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">appendMsg</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> appendMsg(msg, <span class="string">&quot;, &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">appendMsg</span><span class="params">(String msg, String sep)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!Strings.isNullOrEmpty(msg)) &#123;</span><br><span class="line">            <span class="built_in">this</span>.msg = Joiner.on(sep).join(<span class="built_in">this</span>.msg, msg);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理 Result 的接口，具体实现看 ResultHandlerImpl</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ResultHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 只需要返回 code 和 msg</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 状态码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Result <span class="title function_">msgResult</span><span class="params">(StatusCode code)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 正常返回时，才使用这个；</span></span><br><span class="line"><span class="comment">     * 错误的时候，尽量不要用这个，除非前端有作处理。填写不当的 data，有可能会导致解析不对；</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 错误码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data 返回给调用者的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Result <span class="title function_">dataResult</span><span class="params">(StatusCode code, Object data)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResultHandlerImpl</span> <span class="keyword">implements</span> <span class="title class_">ResultHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">msgResult</span><span class="params">(StatusCode code)</span> &#123;</span><br><span class="line">        <span class="type">StatusCodeDict</span> <span class="variable">status</span> <span class="operator">=</span> code.get();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(status.code(), status.msg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">dataResult</span><span class="params">(StatusCode code, Object data)</span> &#123;</span><br><span class="line">        <span class="type">StatusCodeDict</span> <span class="variable">status</span> <span class="operator">=</span> code.get();</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>(status.code(), status.msg());</span><br><span class="line">        result.data(data);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ResultHandle 用此类作为参数。</span></span><br><span class="line"><span class="comment"> * 通过此接口，可以通过 lambda 的方式来获取 StatusCodeDict 里的信息</span></span><br><span class="line"><span class="comment"> * (&lt;code&gt;resultHandler.msgResult(() -&gt; PARAM_LOGIN_ERROR);&lt;/code&gt;)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StatusCode</span> <span class="keyword">extends</span> <span class="title class_">Supplier</span>&lt;StatusCodeDict&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    StatusCodeDict <span class="title function_">get</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 错误码字典</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">StatusCodeDict</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通用码</span></span><br><span class="line">    COMMON_OK(<span class="number">0</span>, <span class="string">&quot;ok&quot;</span>),</span><br><span class="line">    COMMON_UNKNOWN(<span class="number">9999</span>, <span class="string">&quot;未知的异常&quot;</span>),</span><br><span class="line">    COMMON_INVALID_REQUEST(<span class="number">9998</span>, <span class="string">&quot;无效的请求&quot;</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 系统</span></span><br><span class="line">    SYSTEM_404(<span class="number">404</span>, <span class="string">&quot;404你懂的&quot;</span>),</span><br><span class="line">    SYSTEM_502(<span class="number">502</span>, <span class="string">&quot;服务器打洋了&quot;</span>),</span><br><span class="line">    SYSTEM_500(<span class="number">500</span>, <span class="string">&quot;哎哟，这里有个锅&quot;</span>),</span><br><span class="line"></span><br><span class="line">    PARAM(<span class="number">1001</span>, <span class="string">&quot;参数错误&quot;</span>),</span><br><span class="line">    PARAM_BEYOND_QUANTITY_NUMBER(<span class="number">1003</span>, <span class="string">&quot;参数错误，超出最大数量限制&quot;</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    PARAM_LOGIN_ERROR(<span class="number">1102</span>, <span class="string">&quot;用户名不存在或密码错误&quot;</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 商品</span></span><br><span class="line">    GOODS_IS_NOT_EXISTED(<span class="number">1301</span>, <span class="string">&quot;商品不存在&quot;</span>),</span><br><span class="line">    GOODS_IS_NOT_MARKETABLE(<span class="number">1302</span>, <span class="string">&quot;商品已经下架&quot;</span>),</span><br><span class="line"></span><br><span class="line">    DB(<span class="number">1401</span>, <span class="string">&quot;数据库异常&quot;</span>),</span><br><span class="line"></span><br><span class="line">    UNDEFINED(<span class="number">1999</span>, <span class="string">&quot;未定义的业务异常&quot;</span>),</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Integer, StatusCodeDict&gt; dict = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        Arrays.stream(StatusCodeDict.values())</span><br><span class="line">                .forEach(p -&gt; dict.put(p.code, p));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> StatusCodeDict <span class="title function_">of</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.of(dict.get(code)).orElse(COMMON_UNKNOWN);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    StatusCodeDict(<span class="type">int</span> code, String msg) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">code</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">msg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;$&#123;apiVersion&#125;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ResultHandler resultHandler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;name&quot;)</span> String name,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;password&quot;)</span> String password</span></span><br><span class="line"><span class="params">    )</span> &#123;</span><br><span class="line">        <span class="type">UserPassword</span> <span class="variable">userPassword</span> <span class="operator">=</span> userMapper.getUserPasswordByNamePassword(name, password);</span><br><span class="line">        <span class="keyword">if</span> (userPassword == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> resultHandler.msgResult(() -&gt; PARAM_LOGIN_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.getUser(userPassword.getUserId());</span><br><span class="line">        <span class="keyword">return</span> resultHandler.dataResult(() -&gt; COMMON_OK, user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java时间</title>
    <url>/java/%E6%97%B6%E9%97%B4/</url>
    <content><![CDATA[<h2 id="时间工具"><a href="#时间工具" class="headerlink" title="时间工具"></a>时间工具</h2><p>joda-time</p>
<h2 id="判断当前时间是否处在某个区间（用字符串表示的两个时间点）"><a href="#判断当前时间是否处在某个区间（用字符串表示的两个时间点）" class="headerlink" title="判断当前时间是否处在某个区间（用字符串表示的两个时间点）"></a>判断当前时间是否处在某个区间（用字符串表示的两个时间点）</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 判断当前时间是否处在某个区间（用字符串表示的两个时间点）</span></span><br><span class="line"><span class="comment">  * https://www.programcreek.com/java-api-examples/?class=org.apache.commons.lang.time.DateUtils&amp;method=parseDate</span></span><br><span class="line"><span class="comment">  * org.apache.commons.lang.time.DateUtils.parseDate</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isNowSuitable</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">startTime</span> <span class="operator">=</span> <span class="string">&quot;2019-01-12&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">endTime</span> <span class="operator">=</span> <span class="string">&quot;2019-08-12&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isEmpty(startTime) || StringUtils.isEmpty(endTime)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        String[] parsePatterns = &#123;<span class="string">&quot;yyyy-MM-dd&quot;</span>&#125;; <span class="comment">// &quot;yyyy-MM-dd HH:mm:ss&quot;</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">startDate</span> <span class="operator">=</span> DateUtils.parseDate(startTime, parsePatterns);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">endDate</span> <span class="operator">=</span> DateUtils.parseDate(endTime, parsePatterns);</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> Calendar.getInstance().getTimeInMillis();</span><br><span class="line">        <span class="keyword">if</span> (now &gt;= startDate.getTime() &amp;&amp; now &lt;= endDate.getTime()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="iso-时间转换"><a href="#iso-时间转换" class="headerlink" title="iso 时间转换"></a>iso 时间转换</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.annotation.JSONField;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.DateFormat;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.TimeZone;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;类的详细说明&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lyloou</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 其他作者姓名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.00 2020/10/30 , 星期五 lyloou 创建</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;1.01 YYYY/MM/DD 修改者姓名 修改内容说明&lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">A</span>().test();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">toISO8601UTC</span><span class="params">(Date date)</span> &#123;</span><br><span class="line">        <span class="type">TimeZone</span> <span class="variable">tz</span> <span class="operator">=</span> TimeZone.getTimeZone(<span class="string">&quot;UTC&quot;</span>);</span><br><span class="line">        <span class="type">DateFormat</span> <span class="variable">df</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSS&#x27;Z&#x27;&quot;</span>);</span><br><span class="line">        df.setTimeZone(tz);</span><br><span class="line">        <span class="keyword">return</span> df.format(date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">fromISO8601UTC</span><span class="params">(String dateStr)</span> &#123;</span><br><span class="line">        <span class="type">TimeZone</span> <span class="variable">tz</span> <span class="operator">=</span> TimeZone.getTimeZone(<span class="string">&quot;UTC&quot;</span>);</span><br><span class="line">        <span class="type">DateFormat</span> <span class="variable">df</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSS&#x27;Z&#x27;&quot;</span>);</span><br><span class="line">        df.setTimeZone(tz);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> df.parse(dateStr);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">input</span> <span class="operator">=</span> <span class="string">&quot;2020-11-05T16:00:00.000Z&quot;</span>; <span class="comment">// 对应的日期时间是：Fri Nov 06 00:00:00 CST 2020</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> fromISO8601UTC(input);</span><br><span class="line">        System.out.println(date);</span><br><span class="line">        <span class="type">DateFormat</span> <span class="variable">df1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        System.out.println(df1.format(date));</span><br><span class="line"></span><br><span class="line">        <span class="type">Model</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Model</span>();</span><br><span class="line">        model.startTime = date;</span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> com.alibaba.fastjson.JSON.toJSONStringWithDateFormat(model, <span class="string">&quot;yyyy-MM-dd&quot;</span>, SerializerFeature.DisableCircularReferenceDetect);</span><br><span class="line">        System.out.println(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Model</span> &#123;</span><br><span class="line">        <span class="meta">@JSONField(format = &quot;yyyy-MM-dd hh:mm&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> Date startTime;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@JSONField(format = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> Date endTime;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Model&#123;&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;startTime=&quot;</span> + startTime +</span><br><span class="line">                    <span class="string">&quot;, endTime=&quot;</span> + endTime +</span><br><span class="line">                    <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>android</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>正则</title>
    <url>/java/%E6%AD%A3%E5%88%99/</url>
    <content><![CDATA[<p><a href="https://www.cnblogs.com/ggjucheng/p/3423731.html">JAVA 正则表达式：Pattern 类与 Matcher 类详解(转) - ggjucheng - 博客园</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Pattern p=Pattern.compile(<span class="string">&quot;\\d+&quot;</span>);</span><br><span class="line">Matcher m=p.matcher(<span class="string">&quot;我的QQ是:456456 我的电话是:0532214 我的邮箱是:aaa123@aaa.com&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(m.find()) &#123;</span><br><span class="line">     System.out.println(m.group());</span><br><span class="line">     System.out.print(<span class="string">&quot;start:&quot;</span>+m.start());</span><br><span class="line">     System.out.println(<span class="string">&quot; end:&quot;</span>+m.end());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>现在大家应该知道,每次执行匹配操作后 start(),end(),group()三个方法的值都会改变,改变成匹配到的子字符串的信息,以及它们的重载方法,也会改变成相应的信息.<br>注意:只有当匹配操作成功,才可以使用 start(),end(),group()三个方法,否则会抛出 java.lang.IllegalStateException,也就是当 matches(),lookingAt(),find()其中任意一个方法返回 true 时,才可以使用.</p>
</blockquote>
<p><strong>Pattern 类：</strong><br>pattern 对象是一个正则表达式的编译表示。Pattern 类没有公共构造方法。要创建一个 Pattern 对象，你必须首先调用其公共静态编译方法，它返回一个 Pattern 对象。该方法接受一个正则表达式作为它的第一个参数。</p>
<p><strong>Matcher 类：</strong><br>Matcher 对象是对输入字符串进行解释和匹配操作的引擎。与 Pattern 类一样，Matcher 也没有公共构造方法。你需要调用 Pattern 对象的 matcher 方法来获得一个 Matcher 对象。</p>
<p><strong>PatternSyntaxException：</strong><br>PatternSyntaxException 是一个非强制异常类，它表示一个正则表达式模式中的语法错误。</p>
<ul>
<li><a href="https://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">Pattern (Java Platform SE 7 )</a></li>
</ul>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java测试</title>
    <url>/java/%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<h2 id="Junit5-and-AssertJ"><a href="#Junit5-and-AssertJ" class="headerlink" title="Junit5 and AssertJ"></a>Junit5 and AssertJ</h2><p><a href="https://www.petrikainulainen.net/programming/testing/junit-5-tutorial-writing-assertions-with-assertj/">JUnit 5 Tutorial: Writing Assertions With AssertJ</a><br><a href="https://juejin.cn/post/7067402739134758948">SpringBoot+Junit5+Assertj+Mockito的单元测试 - 掘金</a></p>
<h2 id="基准测试"><a href="#基准测试" class="headerlink" title="基准测试"></a>基准测试</h2><p><a href="https://www.baeldung.com/java-microbenchmark-harness">https://www.baeldung.com/java-microbenchmark-harness</a><br><a href="https://github.com/eugenp/tutorials/tree/master/jmh">https://github.com/eugenp/tutorials/tree/master/jmh</a></p>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>【Java】获取属性名工具</title>
    <url>/java/%E8%8E%B7%E5%8F%96%E5%B1%9E%E6%80%A7%E5%90%8D%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>在编码时经常会用到同名的属性名字符串，比如</p>
<ol>
<li>用相同的属性名做为 map 中的键；</li>
<li>在 mybatis 中，根据属性名的下划线字符串来拼接 sql 查询条件。</li>
</ol>
<p>需要修改属性名时，如果是用字符串硬编码的，引用的地方越多，修改越困难</p>
<p>但是如果用的是 java8 中的属性引用，操作起来就很方便了，修改一处即可修改全部相关引用。</p>
<h2 id="属性工具类测试"><a href="#属性工具类测试" class="headerlink" title="属性工具类测试"></a>属性工具类测试</h2><p>参考下面测试类，怎样使用；</p>
<p>如果想要修改 <code>articleName</code> 为 <code>articleTitle</code>，</p>
<blockquote>
<p>在 IDEA 中，修改类的属性名很方便，选中属性名 articleName，按下快捷键 &lt;Shift + F6&gt;，键入新的属性名称 articleTitle，确认即可替换所有关联的属性名称</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 属性工具类测试</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lilou</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FieldUtilTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Article</span> &#123;</span><br><span class="line">        String articleName;</span><br><span class="line">        String articleContent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// test getter</span></span><br><span class="line">        System.out.println(FieldUtil.noPrefix(Article::getArticleName));</span><br><span class="line">        System.out.println(FieldUtil.underline(Article::getArticleName));</span><br><span class="line">        System.out.println(FieldUtil.underlineUpper(Article::getArticleContent));</span><br><span class="line">        System.out.println(FieldUtil.toSymbolCase(Article::getArticleName, <span class="string">&#x27;$&#x27;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// test setter</span></span><br><span class="line">        System.out.println(FieldUtil.noPrefix(Article::setArticleName));</span><br><span class="line">        System.out.println(FieldUtil.underline(Article::setArticleName));</span><br><span class="line">        System.out.println(FieldUtil.underlineUpper(Article::setArticleContent));</span><br><span class="line">        System.out.println(FieldUtil.toSymbolCase(Article::setArticleName, <span class="string">&#x27;$&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="属性工具类代码"><a href="#属性工具类代码" class="headerlink" title="属性工具类代码"></a>属性工具类代码</h2><p>关键逻辑是利用了 java8 中的 SerializedLambda 的 getImplMethodName 方法来获取属性名。</p>
<p>源码中引用了 hutool 第三方工具类的 <code>StrUtil</code>工具，方便操作字符串，当然也可自行开发。</p>
<p>参考资料：<a href="https://segmentfault.com/a/1190000019389160">利用 Lambda 实现通过 getter/setter 方法引用拿到属性名 - SegmentFault 思否</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.lang.invoke.SerializedLambda;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 属性工具类，用来获取 Getter 和 Setter 属性的名称。支持首字母小写样式，下划线的样式和自定义样式</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 参考：[利用Lambda实现通过getter/setter方法引用拿到属性名 - SegmentFault 思否](https://segmentfault.com/a/1190000019389160)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lilou</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FieldUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * ===========&gt; getter 方法引用 &lt;===========</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下划线样式，小写</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; String <span class="title function_">underline</span><span class="params">(IGetter&lt;T&gt; fn)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> toSymbolCase(fn, <span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下划线样式，大写</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; String <span class="title function_">underlineUpper</span><span class="params">(IGetter&lt;T&gt; fn)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> underline(fn).toUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 依据符号转换样式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; String <span class="title function_">toSymbolCase</span><span class="params">(IGetter&lt;T&gt; fn, <span class="type">char</span> symbol)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> StrUtil.toSymbolCase(noPrefix(fn), symbol);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 转换getter方法引用为属性名，首字母小写</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; String <span class="title function_">noPrefix</span><span class="params">(IGetter&lt;T&gt; fn)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getGeneralField(fn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * ===========&gt; setter 方法引用 &lt;===========</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下划线样式，小写</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T, R&gt; String <span class="title function_">underline</span><span class="params">(ISetter&lt;T, R&gt; fn)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> toSymbolCase(fn, <span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下划线样式，大写</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T, R&gt; String <span class="title function_">underlineUpper</span><span class="params">(ISetter&lt;T, R&gt; fn)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> underline(fn).toUpperCase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 依据符号转换样式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T, R&gt; String <span class="title function_">toSymbolCase</span><span class="params">(ISetter&lt;T, R&gt; fn, <span class="type">char</span> symbol)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> StrUtil.toSymbolCase(noPrefix(fn), symbol);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转换setter方法引用为属性名，首字母小写</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T, R&gt; String <span class="title function_">noPrefix</span><span class="params">(ISetter&lt;T, R&gt; fn)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getGeneralField(fn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * ===========&gt; 复用功能 &lt;===========</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得set或get或is方法对应的标准属性名，其它前缀的方法名使用原名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getGeneralField</span><span class="params">(Serializable fn)</span> &#123;</span><br><span class="line">        <span class="type">SerializedLambda</span> <span class="variable">lambda</span> <span class="operator">=</span> getSerializedLambda(fn);</span><br><span class="line">        <span class="type">String</span> <span class="variable">getOrSetMethodName</span> <span class="operator">=</span> lambda.getImplMethodName();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">generalField</span> <span class="operator">=</span> StrUtil.getGeneralField(getOrSetMethodName);</span><br><span class="line">        <span class="keyword">return</span> StrUtil.isEmpty(generalField) ? getOrSetMethodName : generalField;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 获取类对应的Lambda</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SerializedLambda <span class="title function_">getSerializedLambda</span><span class="params">(Serializable fn)</span> &#123;</span><br><span class="line">        <span class="comment">//先检查缓存中是否已存在</span></span><br><span class="line">        SerializedLambda lambda;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//提取SerializedLambda并缓存</span></span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> fn.getClass().getDeclaredMethod(<span class="string">&quot;writeReplace&quot;</span>);</span><br><span class="line">            method.setAccessible(Boolean.TRUE);</span><br><span class="line">            lambda = (SerializedLambda) method.invoke(fn);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;获取SerializedLambda异常, class=&quot;</span> + fn.getClass().getSimpleName(), e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lambda;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * getter方法接口定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@FunctionalInterface</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IGetter</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">        Object <span class="title function_">apply</span><span class="params">(T source)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * setter方法接口定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@FunctionalInterface</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ISetter</span>&lt;T, U&gt; <span class="keyword">extends</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(T t, U u)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java缓存</title>
    <url>/java/%E7%BC%93%E5%AD%98/</url>
    <content><![CDATA[<p><a href="https://www.google.com/search?client=firefox-b-ab&amp;q=%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85+%E7%BC%93%E5%AD%98%E5%A4%9A%E4%B9%85+redis">https://www.google.com/search?client=firefox-b-ab&amp;q=%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85+%E7%BC%93%E5%AD%98%E5%A4%9A%E4%B9%85+redis</a></p>
<p><a href="https://tech.meituan.com/cache_about.html">https://tech.meituan.com/cache_about.html</a></p>
<p><a href="https://juejin.im/post/59638d5e51882568b463054e">https://juejin.im/post/59638d5e51882568b463054e</a></p>
<p><a href="https://blog.csdn.net/qfikh/article/details/52943068">https://blog.csdn.net/qfikh/article/details/52943068</a></p>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>【Java】获取有效的异常调用堆栈信息</title>
    <url>/java/%E8%8E%B7%E5%8F%96%E6%9C%89%E6%95%88%E7%9A%84%E5%BC%82%E5%B8%B8%E8%B0%83%E7%94%A8%E5%A0%86%E6%A0%88%E4%BF%A1%E6%81%AF/</url>
    <content><![CDATA[<p>项目中，可能会遇到虽然知道发生了异常，但是不知道异常是什么，由于调用栈信息不全，从日志上看不出具体问题；主要原因是异常调用栈太深，导致异常信息被截断。</p>
<p>下面这个方法可以获取根异常，将中间的非主要异常过滤掉。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 获取根异常，防止调用链太长，导致有效信息被截断 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> Throwable <span class="title function_">getRootThrowable</span><span class="params">(Throwable e)</span> &#123;  </span><br><span class="line">    <span class="keyword">if</span> (Objects.isNull(e)) &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="type">Throwable</span> <span class="variable">lastCause</span> <span class="operator">=</span> e;  </span><br><span class="line">    <span class="type">Throwable</span> <span class="variable">currentCause</span> <span class="operator">=</span> e.getCause();  </span><br><span class="line">    <span class="keyword">while</span> (Objects.nonNull(currentCause)) &#123;  </span><br><span class="line">        lastCause = currentCause;  </span><br><span class="line">        currentCause = currentCause.getCause();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> lastCause;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThrowableTestDemo</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line">        test();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            <span class="keyword">try</span> &#123;  </span><br><span class="line">                <span class="keyword">try</span> &#123;  </span><br><span class="line">                    <span class="keyword">try</span> &#123;  </span><br><span class="line">                        <span class="keyword">try</span> &#123;  </span><br><span class="line">                            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;  </span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </span><br><span class="line">            log.warn(<span class="string">&quot;处理前：&quot;</span>, e);  </span><br><span class="line">            System.out.println(<span class="string">&quot;=======&gt;&quot;</span>);  </span><br><span class="line">            log.warn(<span class="string">&quot;处理后：&quot;</span>, getRootThrowable(e));  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="number">10</span>:<span class="number">38</span>:<span class="number">13.122</span> <span class="selector-attr">[main]</span> WARN com<span class="selector-class">.coocaa</span><span class="selector-class">.media</span><span class="selector-class">.sync</span><span class="selector-class">.ThrowableTestDemo</span> - 处理前：</span><br><span class="line">java<span class="selector-class">.lang</span><span class="selector-class">.RuntimeException</span>: java<span class="selector-class">.lang</span><span class="selector-class">.RuntimeException</span>: java<span class="selector-class">.lang</span><span class="selector-class">.RuntimeException</span>: java<span class="selector-class">.lang</span><span class="selector-class">.RuntimeException</span>: java<span class="selector-class">.lang</span><span class="selector-class">.ArithmeticException</span>: / by zero</span><br><span class="line">	at com<span class="selector-class">.coocaa</span><span class="selector-class">.media</span><span class="selector-class">.sync</span><span class="selector-class">.ThrowableTestDemo</span><span class="selector-class">.test</span>(ThrowableTestDemo<span class="selector-class">.java</span>:<span class="number">36</span>)</span><br><span class="line">	at com<span class="selector-class">.coocaa</span><span class="selector-class">.media</span><span class="selector-class">.sync</span><span class="selector-class">.ThrowableTestDemo</span><span class="selector-class">.main</span>(ThrowableTestDemo<span class="selector-class">.java</span>:<span class="number">15</span>)</span><br><span class="line">Caused by: java<span class="selector-class">.lang</span><span class="selector-class">.RuntimeException</span>: java<span class="selector-class">.lang</span><span class="selector-class">.RuntimeException</span>: java<span class="selector-class">.lang</span><span class="selector-class">.RuntimeException</span>: java<span class="selector-class">.lang</span><span class="selector-class">.ArithmeticException</span>: / by zero</span><br><span class="line">	at com<span class="selector-class">.coocaa</span><span class="selector-class">.media</span><span class="selector-class">.sync</span><span class="selector-class">.ThrowableTestDemo</span><span class="selector-class">.test</span>(ThrowableTestDemo<span class="selector-class">.java</span>:<span class="number">33</span>)</span><br><span class="line">	... <span class="number">1</span> common frames omitted</span><br><span class="line">Caused by: java<span class="selector-class">.lang</span><span class="selector-class">.RuntimeException</span>: java<span class="selector-class">.lang</span><span class="selector-class">.RuntimeException</span>: java<span class="selector-class">.lang</span><span class="selector-class">.ArithmeticException</span>: / by zero</span><br><span class="line">	at com<span class="selector-class">.coocaa</span><span class="selector-class">.media</span><span class="selector-class">.sync</span><span class="selector-class">.ThrowableTestDemo</span><span class="selector-class">.test</span>(ThrowableTestDemo<span class="selector-class">.java</span>:<span class="number">30</span>)</span><br><span class="line">	... <span class="number">1</span> common frames omitted</span><br><span class="line">Caused by: java<span class="selector-class">.lang</span><span class="selector-class">.RuntimeException</span>: java<span class="selector-class">.lang</span><span class="selector-class">.ArithmeticException</span>: / by zero</span><br><span class="line">	at com<span class="selector-class">.coocaa</span><span class="selector-class">.media</span><span class="selector-class">.sync</span><span class="selector-class">.ThrowableTestDemo</span><span class="selector-class">.test</span>(ThrowableTestDemo<span class="selector-class">.java</span>:<span class="number">27</span>)</span><br><span class="line">	... <span class="number">1</span> common frames omitted</span><br><span class="line">Caused by: java<span class="selector-class">.lang</span><span class="selector-class">.ArithmeticException</span>: / by zero</span><br><span class="line">	at com<span class="selector-class">.coocaa</span><span class="selector-class">.media</span><span class="selector-class">.sync</span><span class="selector-class">.ThrowableTestDemo</span><span class="selector-class">.test</span>(ThrowableTestDemo<span class="selector-class">.java</span>:<span class="number">25</span>)</span><br><span class="line">	... <span class="number">1</span> common frames omitted</span><br><span class="line">	</span><br><span class="line">=======&gt;</span><br><span class="line"><span class="number">10</span>:<span class="number">38</span>:<span class="number">13.124</span> <span class="selector-attr">[main]</span> WARN com<span class="selector-class">.coocaa</span><span class="selector-class">.media</span><span class="selector-class">.sync</span><span class="selector-class">.ThrowableTestDemo</span> - 处理后：</span><br><span class="line">java<span class="selector-class">.lang</span><span class="selector-class">.ArithmeticException</span>: / by zero</span><br><span class="line">	at com<span class="selector-class">.coocaa</span><span class="selector-class">.media</span><span class="selector-class">.sync</span><span class="selector-class">.ThrowableTestDemo</span><span class="selector-class">.test</span>(ThrowableTestDemo<span class="selector-class">.java</span>:<span class="number">25</span>)</span><br><span class="line">	at com<span class="selector-class">.coocaa</span><span class="selector-class">.media</span><span class="selector-class">.sync</span><span class="selector-class">.ThrowableTestDemo</span><span class="selector-class">.main</span>(ThrowableTestDemo<span class="selector-class">.java</span>:<span class="number">15</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java获取网络时间</title>
    <url>/java/%E8%8E%B7%E5%8F%96%E7%BD%91%E7%BB%9C%E6%97%B6%E9%97%B4/</url>
    <content><![CDATA[<h1 id="通过网页-Head-来获取"><a href="#通过网页-Head-来获取" class="headerlink" title="通过网页 Head 来获取"></a>通过网页 Head 来获取</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getWebsiteDatetime</span><span class="params">(String webUrl)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(webUrl);<span class="comment">// 取得资源对象</span></span><br><span class="line">        <span class="type">URLConnection</span> <span class="variable">uc</span> <span class="operator">=</span> url.openConnection();<span class="comment">// 生成连接对象</span></span><br><span class="line">        uc.connect();<span class="comment">// 发出连接</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">ld</span> <span class="operator">=</span> uc.getDate();<span class="comment">// 读取网站日期时间</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(ld);<span class="comment">// 转换为标准时间对象</span></span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>, Locale.CHINA);<span class="comment">// 输出北京时间</span></span><br><span class="line">        <span class="keyword">return</span> sdf.format(date);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="获取网页时间戳"><a href="#获取网页时间戳" class="headerlink" title="获取网页时间戳"></a>获取网页时间戳</h1><p>（如果本地和网页时间相差不多，以后都以本地为主）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">URL_CHECK_TIME</span> <span class="operator">=</span> <span class="string">&quot;http://www.taobao.com&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> useLocal;<span class="comment">// 是否使用本地时间</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> deltaTime; <span class="comment">// 本机时间-网络时间；</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">resetTimeStamp</span><span class="params">()</span> &#123;</span><br><span class="line">    useLocal = <span class="literal">false</span>;</span><br><span class="line">    deltaTime = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取时间戳（首次从网上获取时间，和本地比较，如果相差在一定的范围内，以后的调用就直接使用本地的，如果相差很大，以后都以网页时间为准）</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回的是以秒为单位的时间字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getTimeStamp</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">long</span> <span class="variable">phoneTime</span> <span class="operator">=</span> System.currentTimeMillis() / <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> String.valueOf(phoneTime);</span><br><span class="line">    <span class="keyword">if</span> (!useLocal) &#123;</span><br><span class="line">        <span class="comment">// 之所以使用线程，是因为在Android中不允许在主线程中开启网络请求（NetworkOnMainThreadException）</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">URLConnection</span> <span class="variable">uc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(URL_CHECK_TIME).openConnection();<span class="comment">// 生成连接对象</span></span><br><span class="line">                    uc.connect();<span class="comment">// 发出连接</span></span><br><span class="line">                    <span class="type">long</span> <span class="variable">webSiteTime</span> <span class="operator">=</span> uc.getDate() / <span class="number">1000</span>;<span class="comment">// 读取网站日期时间</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 获取到了网站时间，就进行比较</span></span><br><span class="line">                    <span class="comment">// 如果在范围内，下一次直接使用本地手机时间；</span></span><br><span class="line">                    <span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> System.currentTimeMillis() / <span class="number">1000</span>;</span><br><span class="line">                    useLocal = Math.abs(currentTime - webSiteTime) &lt; <span class="number">5</span> * <span class="number">60</span>;</span><br><span class="line">                    deltaTime = currentTime - webSiteTime;</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    Log.e(TAG, <span class="string">&quot;getTimeStamp: &quot;</span>, e);</span><br><span class="line">                    resetTimeStamp();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        result = String.valueOf(phoneTime - deltaTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Log.i(TAG, <span class="string">&quot;getTimeStamp: 本次使用了本机时间？&quot;</span> + useLocal);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="监听时间和日期变化"><a href="#监听时间和日期变化" class="headerlink" title="监听时间和日期变化"></a>监听时间和日期变化</h1><p><code>onCreate</code>中添加注册</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 监听用户对时间和日期的修改；</span></span><br><span class="line"><span class="type">IntentFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntentFilter</span>();</span><br><span class="line">filter.addAction(Intent.ACTION_TIME_CHANGED);</span><br><span class="line">filter.addAction(Intent.ACTION_DATE_CHANGED);</span><br><span class="line">registerReceiver(mReceiver, filter);</span><br></pre></td></tr></table></figure>

<p><code>onDestroy</code>中取消注册</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">unregisterReceiver(mReceiver);</span><br></pre></td></tr></table></figure>

<p><code>mReceiver</code>实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">BroadcastReceiver</span> <span class="variable">mReceiver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BroadcastReceiver</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (intent.getAction()) &#123;</span><br><span class="line">            <span class="comment">// 时间发生变化后，重新设置时间戳</span></span><br><span class="line">            <span class="keyword">case</span> Intent.ACTION_TIME_CHANGED:</span><br><span class="line">            <span class="keyword">case</span> Intent.ACTION_DATE_CHANGED:</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;onReceive: Time or Date changed&quot;</span>);</span><br><span class="line">                Utime.resetTimeStamp();</span><br><span class="line">                Utime.getTimeStamp();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="直接获取"><a href="#直接获取" class="headerlink" title="直接获取"></a>直接获取</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Utime</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">URL_BASE</span> <span class="operator">=</span> <span class="string">&quot;https://sj.qq.com/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据url这个网址来获取时间戳（如果获取此网络时间失败，使用本地时间）</span></span><br><span class="line"><span class="comment">     * 返回的是以秒为单位的时间字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url url</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getTimeStamp</span><span class="params">(String url)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">urlRrBase</span> <span class="operator">=</span> getBaseUrl(url);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">long</span> <span class="variable">currentTimeMillis</span> <span class="operator">=</span> System.currentTimeMillis() / <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">URLConnection</span> <span class="variable">uc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(urlRrBase).openConnection();<span class="comment">// 生成连接对象</span></span><br><span class="line">            uc.connect();<span class="comment">// 发出连接</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">webTimeMillis</span> <span class="operator">=</span> uc.getDate();</span><br><span class="line">            <span class="type">long</span> <span class="variable">webTime</span> <span class="operator">=</span> webTimeMillis / <span class="number">1000</span>;<span class="comment">// 读取网站日期时间</span></span><br><span class="line">            <span class="keyword">return</span> String.valueOf(webTime);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> String.valueOf(currentTimeMillis);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getBaseUrl</span><span class="params">(String url)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(url)) &#123;</span><br><span class="line">            <span class="keyword">return</span> URL_BASE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URI</span>(url);</span><br><span class="line">            <span class="keyword">return</span> uri.getScheme() + <span class="string">&quot;://&quot;</span> + uri.getHost();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> URL_BASE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="http://blog.csdn.net/catoop/article/details/50076879">获取网络时间（国家标准时间）</a></li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>解析数据</title>
    <url>/java/%E8%A7%A3%E6%9E%90%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<h2 id="Jsoup-解析-html-标签"><a href="#Jsoup-解析-html-标签" class="headerlink" title="Jsoup 解析 html 标签"></a>Jsoup 解析 html 标签</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.jsoup.Jsoup;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Document;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// http://www.runoob.com/java/java-regular-expressions.html</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRegex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">input</span> <span class="operator">=</span> <span class="string">&quot;【丝路亚心】250gX4&lt;font color=\&quot;red\&quot;&gt;核桃仁&lt;/font&gt; 原味生&lt;font color=\&quot;red\&quot;&gt;核桃核桃仁&lt;/font&gt; 新疆特产, &lt;font color=\&quot;red\&quot;&gt;123445&lt;/font&gt;bcdef&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">regex</span> <span class="operator">=</span> <span class="string">&quot;&lt;font[^&gt;]+?&gt;(.*?)&lt;\\\\/font&gt;&quot;</span>;</span><br><span class="line">        <span class="type">Pattern</span> <span class="variable">compile</span> <span class="operator">=</span> Pattern.compile(regex);</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> compile.matcher(input);</span><br><span class="line">        List&lt;String&gt; output = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (matcher.find()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;--&quot;</span> + count);</span><br><span class="line">            output.add(matcher.group(count));</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(output);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHtml</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> <span class="string">&quot;&lt;span style=\&quot;color:red;border-radius:10px;background-color:blue;\&quot;&gt;抢购&lt;/span&gt; 我是标题我是标题我是标题&lt;font color=\&quot;red\&quot;&gt;高亮&lt;/font&gt;我是标题我是标题我是标题我是标题&lt;font color=\&quot;red\&quot;&gt;高亮&lt;/font&gt;我是标题&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(html);</span><br><span class="line">        System.out.println(doc); <span class="comment">// 输出带标签的html文档</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n----&gt;&quot;</span> + doc.text()); <span class="comment">// 输出内容</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n----&gt;&quot;</span> + doc.getElementsByTag(<span class="string">&quot;span&quot;</span>).get(<span class="number">0</span>).html());</span><br><span class="line">        System.out.println(<span class="string">&quot;\n----&gt;&quot;</span> + doc.getElementsByTag(<span class="string">&quot;font&quot;</span>).get(<span class="number">0</span>).html());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testStyle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">style</span> <span class="operator">=</span> <span class="string">&quot;position: absolute; width: 500px; height: 552px; color: red; background-color: blue;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">width</span> <span class="operator">=</span> <span class="string">&quot;width&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">color</span> <span class="operator">=</span> <span class="string">&quot;color&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">backgroundColor</span> <span class="operator">=</span> <span class="string">&quot;background-color&quot;</span>;</span><br><span class="line">        System.out.println(getFloat(style, width));</span><br><span class="line">        System.out.println(getString(style, color));</span><br><span class="line">        System.out.println(getString(style, backgroundColor));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// https://www.cnblogs.com/qlqwjy/p/7531579.html</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">double</span> <span class="title function_">getFloat</span><span class="params">(String value, String property)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (value.contains(property)) &#123;</span><br><span class="line">                value = value.substring(value.indexOf(property));</span><br><span class="line">                value = value.substring(<span class="number">0</span>, value.contains(<span class="string">&quot;;&quot;</span>) ? value.indexOf(<span class="string">&quot;;&quot;</span>) : value.length());</span><br><span class="line">                <span class="type">String</span> <span class="variable">attr</span> <span class="operator">=</span> value.substring(value.indexOf(<span class="string">&quot;:&quot;</span>) + <span class="number">1</span>).trim();</span><br><span class="line">                <span class="keyword">return</span> Double.parseDouble(attr.substring(<span class="number">0</span>, attr.indexOf(<span class="string">&quot;px&quot;</span>)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// ignore all exception</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getString</span><span class="params">(String value, String property)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (value.contains(property)) &#123;</span><br><span class="line">                System.out.println(value);</span><br><span class="line">                value = value.substring(value.indexOf(property));</span><br><span class="line">                value = value.substring(<span class="number">0</span>, value.contains(<span class="string">&quot;;&quot;</span>) ? value.indexOf(<span class="string">&quot;;&quot;</span>) : value.length());</span><br><span class="line">                <span class="keyword">return</span> value.substring(value.indexOf(<span class="string">&quot;:&quot;</span>) + <span class="number">1</span>).trim();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// ignore all exception</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java环境部署</title>
    <url>/java/%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<p>服务器部署用到的JRE是server JRE，如下图的JAVA 8 JRE</p>
<p><img src="https://github.com/lyloou/img/raw/develop/z/20190401154854.png"></p>
<h2 id="打包jar"><a href="#打包jar" class="headerlink" title="打包jar"></a>打包jar</h2><p>将Java程序打包成一个jar包</p>
<p>点击File-&gt;Project Structure-&gt;Artifacts-&gt;Jar-&gt;From modules with dependencies</p>
<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/v3/2023-04/20230425094801dfcf279c1d1f4425ca265930e21e18a3.png" alt="image.png"></p>
<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/v3/2023-04/202304250948522b7bf1e29f81061aca98d7d93bc73d81.png" alt="image.png"></p>
<p>参考：<a href="https://blog.csdn.net/vfdxvffd/article/details/113430701">https://blog.csdn.net/vfdxvffd/article/details/113430701</a></p>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java配置文件读取</title>
    <url>/java/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/</url>
    <content><![CDATA[<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># config/test.properties</span></span><br><span class="line"><span class="attr">key1</span>=<span class="number">2018</span></span><br><span class="line"><span class="attr">key2</span>=<span class="number">2019</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// TestProperties.java</span></span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.ImmutableList;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.ImmutableMap;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Maps;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TestProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Properties</span> <span class="variable">prop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            prop.load(<span class="keyword">new</span> <span class="title class_">java</span>.io.FileInputStream(System.getProperty(<span class="string">&quot;user.dir&quot;</span>).concat(<span class="string">&quot;/config/test.properties&quot;</span>)));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">TestProperties</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// value</span></span><br><span class="line">        System.out.println(getValue(<span class="string">&quot;key1&quot;</span>));</span><br><span class="line">        System.out.println(getValue(<span class="string">&quot;key2&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// array</span></span><br><span class="line">        System.out.println(Arrays</span><br><span class="line">                .stream(getValues(ImmutableList.of(</span><br><span class="line">                        <span class="string">&quot;key1&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;key2&quot;</span></span><br><span class="line">                ).toArray()))</span><br><span class="line">                .collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// map</span></span><br><span class="line">        ImmutableMap&lt;String, String&gt; map = Maps.fromProperties(prop);</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getValue</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> prop.getProperty(key).trim();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object[] getValues(Object[] key) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> key.length;</span><br><span class="line">        Object[] objects = <span class="keyword">new</span> <span class="title class_">Object</span>[length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            objects[i] = prop.getProperty(key[i].toString()).trim();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> objects;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java资源回收</title>
    <url>/java/%E8%B5%84%E6%BA%90%E5%9B%9E%E6%94%B6/</url>
    <content><![CDATA[<h2 id="资源回收的时机"><a href="#资源回收的时机" class="headerlink" title="资源回收的时机"></a>资源回收的时机</h2><ul>
<li><a href="https://blog.csdn.net/ungoneless/article/details/53191719">程序kill -9与kill -15的区别，以及回调函数的作用 - ungoneless的博客 - CSDN博客</a><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShutdownHookTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">shutdownCallback</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Shutdown callback is invoked.&quot;</span>);</span><br><span class="line">        <span class="comment">// 在这回收资源</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        Runtime.getRuntime().addShutdownHook(<span class="keyword">new</span> <span class="title class_">Thread</span>(ShutdownHookTest::shutdownCallback));</span><br><span class="line">        Thread.sleep(<span class="number">20000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">java ShutdownHookTest</span><br><span class="line"></span><br><span class="line">ps -aux | grep ShutdownHookTest</span><br><span class="line"></span><br><span class="line"><span class="built_in">kill</span> -15 6483</span><br></pre></td></tr></table></figure>
<p><img src="https://github.com/lyloou/img/raw/develop/z/20190705140222.png" alt="ShutdownHookTest"></p>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>订单号生成器</title>
    <url>/java/%E8%AE%A2%E5%8D%95%E5%8F%B7%E7%94%9F%E6%88%90%E5%99%A8/</url>
    <content><![CDATA[<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><blockquote>
<p>订单号 = 前缀 + 日期 + (一个 1000-9999 之间的四位数字)</p>
</blockquote>
<p>后面的四位数字，可以通过 <code>jedis.incrBy()</code> 来实现。</p>
<p>效能：最多可以在 <code>1</code> 秒钟创建 <code>9000</code> 个不重复单号</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ID 生成器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IdGenerator</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成器类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Type</span> &#123;</span><br><span class="line">        NORMAL(<span class="string">&quot;&quot;</span>),</span><br><span class="line">        ORDER(<span class="string">&quot;OR&quot;</span>),</span><br><span class="line">        RETURN(<span class="string">&quot;RT&quot;</span>),</span><br><span class="line">        REFUND(<span class="string">&quot;RF&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String prefix;</span><br><span class="line"></span><br><span class="line">        Type(String prefix) &#123;</span><br><span class="line">            <span class="built_in">this</span>.prefix = prefix;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">GENERATOR</span> <span class="operator">=</span> <span class="string">&quot;GENERATOR&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">FORMAT</span> <span class="operator">=</span> <span class="string">&quot;yyyyMMddHHmmss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generate</span><span class="params">(Type type)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">now</span> <span class="operator">=</span> DateFormatUtils.format(<span class="keyword">new</span> <span class="title class_">Date</span>(), FORMAT);</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> GENERATOR + <span class="string">&quot;:&quot;</span> + type.name();</span><br><span class="line">        <span class="type">int</span> <span class="variable">counter</span> <span class="operator">=</span> getCounter(key);</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;%s%s%s&quot;</span>, type.prefix, now, counter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Jedis jedis;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过 redis 来获取累加器</span></span><br><span class="line"><span class="comment">     * 根据 key 类型来获取累加数字</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 累加的数字</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getCounter</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">int</span> num;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serial</span> <span class="operator">=</span> jedis.get(key);</span><br><span class="line">        num = <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">if</span> (serial != <span class="literal">null</span> &amp;&amp; Integer.parseInt(serial) &lt; <span class="number">9999</span>) &#123;</span><br><span class="line">            num = jedis.incrBy(key, <span class="number">1</span>).intValue();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            jedis.set(key, String.valueOf(num));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.lyloou.order&quot;&#125;)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlowApplicationTests</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  IdGenerator idGenerator;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGenerator</span><span class="params">()</span> &#123;</span><br><span class="line">      List&lt;String&gt; ids = Lists.newArrayList();</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">          <span class="type">double</span> <span class="variable">delay</span> <span class="operator">=</span> Math.random() * <span class="number">1000</span>;</span><br><span class="line">          Thread.sleep((<span class="type">long</span>) delay);</span><br><span class="line">          ids.add(idGenerator.generate(IdGenerator.Type.ORDER));</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(Joiner.on(<span class="string">&quot;,\n&quot;</span>).join(ids));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 运行结果：</span></span><br><span class="line"><span class="comment">OR202003261127151030,</span></span><br><span class="line"><span class="comment">OR202003261127161031,</span></span><br><span class="line"><span class="comment">OR202003261127171032,</span></span><br><span class="line"><span class="comment">OR202003261127181033,</span></span><br><span class="line"><span class="comment">OR202003261127181034,</span></span><br><span class="line"><span class="comment">OR202003261127191035,</span></span><br><span class="line"><span class="comment">OR202003261127191036,</span></span><br><span class="line"><span class="comment">OR202003261127191037,</span></span><br><span class="line"><span class="comment">OR202003261127201038,</span></span><br><span class="line"><span class="comment">OR202003261127211039</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>Java隐藏特性</title>
    <url>/java/%E9%9A%90%E8%97%8F%E7%89%B9%E6%80%A7/</url>
    <content><![CDATA[<h2 id="双花括号初始化语法（DoubleBraceInitialization）"><a href="#双花括号初始化语法（DoubleBraceInitialization）" class="headerlink" title="双花括号初始化语法（DoubleBraceInitialization）"></a>双花括号初始化语法（DoubleBraceInitialization）</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这里解释下这两个括号：</span></span><br><span class="line"><span class="comment">// 第一个括号创建了一个新的匿名内部类，相信这个大家都知道；</span></span><br><span class="line"><span class="comment">// 第二个括号声明了匿名内部类实例化时运行的实例初始化块。</span></span><br><span class="line">removeProductsWithCodeIn(<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;() &#123;&#123;</span><br><span class="line">    add(<span class="string">&quot;XZ13s&quot;</span>);</span><br><span class="line">    add(<span class="string">&quot;AB21/X&quot;</span>);</span><br><span class="line">    add(<span class="string">&quot;YYLEX&quot;</span>);</span><br><span class="line">    add(<span class="string">&quot;AR5E&quot;</span>);</span><br><span class="line"> &#125;&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="http://www.cnblogs.com/lanxuezaipiao/p/3460373.html">Java 你不知道的那些事儿—Java 隐藏特性（上） - Alexia(minmin) - 博客园</a></li>
</ul>
<h3 id="注意：此特性可能存在的问题；"><a href="#注意：此特性可能存在的问题；" class="headerlink" title="注意：此特性可能存在的问题；"></a><strong>注意</strong>：此特性可能存在的问题；</h3><ol>
<li> gson 不能正确解析双花括号语法(<a href="http://lyloou.com/java/%E5%9D%91/">【Java】那些踩过的坑 | 比特楼</a>)</li>
<li><a href="https://segmentfault.com/a/1190000022717457">永远不要使用双花括号初始化实例，否则就会 OOM！ - SegmentFault 思否</a><br> （匿名内部类，可能会导致 OOM）</li>
<li>Caused by: com.esotericsoftware.kryo.KryoException: Class cannot be created (missing no-arg constructor): com.lyloou.jetcache.UserServiceImpl$1<br> This is an anonymous class, which is not serializable by default in Kryo. Possible solutions: 1. Remove uses of anonymous classes, including double brace initialization, from the containing class. This is the safest solution, as anonymous classes don’t have predictable names for serialization.</li>
</ol>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java并发学习</title>
    <url>/java-concurrent/readme/</url>
    <content><![CDATA[<ul>
<li><a href="https://www.cnblogs.com/dolphin0520/category/602384.html">Java 并发编程 - 随笔分类 - 海 子 - 博客园</a></li>
<li><a href="https://www.cnblogs.com/dolphin0520/p/3920373.html">Java 并发编程：volatile 关键字解析 - 海 子 - 博客园</a></li>
</ul>
<h2 id="completableFuture"><a href="#completableFuture" class="headerlink" title="completableFuture"></a>completableFuture</h2><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/readme-2021-07-14-17-10-12.png" alt="readme-2021-07-14-17-10-12"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> List&lt;CompletableFuture&lt;Void&gt;&gt; futureList = nameToContent.keySet().stream()</span><br><span class="line">        .map(name -&gt; CompletableFuture.runAsync(() -&gt; doUploadFile(map, name, nameToContent), executor))</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">//noinspection ResultOfMethodCallIgnored</span></span><br><span class="line">futureList.stream().map(CompletableFuture::join).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意：如果使用 count() 不会阻塞</span></span><br><span class="line"><span class="comment">// futureList.stream().map(CompletableFuture::join).count()</span></span><br></pre></td></tr></table></figure>

<h2 id="线程池如何合理配置"><a href="#线程池如何合理配置" class="headerlink" title="线程池如何合理配置"></a>线程池如何合理配置</h2><p><a href="https://cloud.tencent.com/developer/article/1806245">CPU 密集型 和 IO 密集型 的区别，如何确定线程池大小？ - 云+社区 - 腾讯云</a><br>配置线程池可以从以下几个方面来考虑。</p>
<ul>
<li>任务是 CPU 密集型、IO 密集型或者混合型；</li>
<li>任务优先级，高中低；</li>
<li>任务时间执行长短；</li>
<li>任务依赖性：是否依赖其他系统资源。</li>
</ul>
<hr>
<ul>
<li>CPU 密集型可以配置可能小的线程，比如：N+1 线程。</li>
<li>IO 密集型（网络、磁盘 IO）可以配置较多的线程，如 2n 个线程。</li>
<li>混合型可以拆成 IO 密集型任务和 CPU 密集型任务，计算如下：<blockquote>
<p>最佳线程数目 = （线程等待时间与线程 CPU 时间之比 + 1）* CPU 数目</p>
</blockquote>
</li>
</ul>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">示例：</span><br><span class="line"></span><br><span class="line">假如一个程序平均每个线程<span class="meta">CPU</span>运行时间为<span class="number">0.</span>5s，而线程等待时间（非<span class="meta">CPU</span>运行时间，比如IO）为<span class="number">1.</span>5s，<span class="meta">CPU</span>核心数为<span class="number">8</span>，那么最佳的线程数应该是？</span><br><span class="line">     根据上面这个公式估算得到最佳的线程数：((<span class="number">0.5</span>+<span class="number">1.5</span>)/<span class="number">0.5</span>)*<span class="number">8</span>=<span class="number">32</span>。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过<code>Runtime.getRuntime().avaiableProcessors()</code>来获取 cpu 个数。</p>
<h2 id="窃取线程池"><a href="#窃取线程池" class="headerlink" title="窃取线程池"></a>窃取线程池</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.thread.ThreadUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExecutorOfWorkStealingPoolTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newWorkStealingPool();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; Integer.MAX_VALUE; i++) &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">            <span class="type">int</span> <span class="variable">finalI</span> <span class="operator">=</span> i;</span><br><span class="line">            executorService.submit(() -&gt; &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; - &quot;</span> + finalI);</span><br><span class="line">                ThreadUtil.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        ThreadUtil.sleep(<span class="number">1000000</span>);</span><br><span class="line">        executorService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>【Java】基于线程池的独立任务并发执行器</title>
    <url>/java-concurrent/%E5%9F%BA%E4%BA%8E%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E7%8B%AC%E7%AB%8B%E4%BB%BB%E5%8A%A1%E5%B9%B6%E5%8F%91%E6%89%A7%E8%A1%8C%E5%99%A8/</url>
    <content><![CDATA[<h4 id="目的："><a href="#目的：" class="headerlink" title="目的："></a>目的：</h4><p>对于多个独立的任务，可以以并发的方式执行任务，以提高 CPU 利用率，提高处理效率。</p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>在一个线程池中，开启指定数量的线程，每个线程从任务队列中获取任务执行。</p>
<p>执行的过程中，判断当前线程是否在执行任务的状态，如果没有执行任务，取一条任务执行，如果正在执行，则跳过，下轮再判断。</p>
<p>在所有任务执行完后，关闭线程池。</p>
<p>需要注意的是数据结构的选择，须选择并发类的数据结构，不然可能出现阻塞，死锁等情况。</p>
<p>（具体逻辑参考源码）</p>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 并发执行器示例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcurrentExecutorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            test();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, String&gt; paramMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            paramMap.put(<span class="string">&quot;key:&quot;</span> + i, <span class="string">&quot;value:&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> ConcurrentExecutor&lt;String, String, Integer&gt; executor = <span class="keyword">new</span> <span class="title class_">ConcurrentExecutor</span>&lt;&gt;(<span class="number">5</span>, paramMap,</span><br><span class="line">                (k, v) -&gt; &#123;</span><br><span class="line">                    ThreadUtil.sleep(<span class="number">10</span>);</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;-&quot;</span> + v);</span><br><span class="line">                    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">abs</span> <span class="operator">=</span> Math.abs(Objects.hash(v));</span><br><span class="line">                    <span class="keyword">if</span> (abs % <span class="number">3</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> abs;</span><br><span class="line">                &#125;);</span><br><span class="line">        executor.execute();</span><br><span class="line">        System.out.println(<span class="string">&quot;success result: &quot;</span> + executor.getSuccessResultMap());</span><br><span class="line">        System.out.println(<span class="string">&quot;error result: &quot;</span> + executor.getErrorResultMap());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试结果</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">pool-1-thread-1-value:0</span><br><span class="line">pool-1-thread-2-value:1</span><br><span class="line">pool-1-thread-4-value:3</span><br><span class="line">pool-1-thread-3-value:2</span><br><span class="line">pool-1-thread-3-value:8</span><br><span class="line">pool-1-thread-1-value:5</span><br><span class="line">pool-1-thread-5-value:4</span><br><span class="line">pool-1-thread-2-value:6</span><br><span class="line">pool-1-thread-4-value:7</span><br><span class="line">pool-1-thread-3-value:9</span><br><span class="line">success result: &#123;key:<span class="attr">2</span>=<span class="number">231604360</span>, key:<span class="number">0</span>=<span class="number">231604358</span>, key:<span class="number">6</span>=<span class="number">231604364</span>, key:<span class="number">5</span>=<span class="number">231604363</span>, key:<span class="number">3</span>=<span class="number">231604361</span>, key:<span class="number">9</span>=<span class="number">231604367</span>, key:<span class="number">8</span>=<span class="number">231604366</span>&#125;</span><br><span class="line">error result: &#123;key:<span class="attr">1</span>=java.lang.ArithmeticException: / by zero, key:<span class="number">4</span>=java.lang.ArithmeticException: / by zero, key:<span class="number">7</span>=java.lang.ArithmeticException: / by zero&#125;</span><br></pre></td></tr></table></figure>

<h4 id="源码（方案-1）"><a href="#源码（方案-1）" class="headerlink" title="源码（方案 1）"></a>源码（方案 1）</h4><p>基于自定义的 queue 实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.ConcurrentHashSet;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.lang.Assert;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.thread.ThreadUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.BooleanUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentLinkedQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.function.BiFunction;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 并发执行器</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 适用场景：每个任务是独立的，不耦合的</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lilou</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2022/6/9 9:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcurrentExecutor</span>&lt;K, V, R&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 任务参数映射（K：key的类型，V：值的类型）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;K, V&gt; paramMap;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 成功的任务结果映射（R：结果类型）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;K, R&gt; successResultMap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 失败的任务结果映射</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;K, Throwable&gt; errorResultMap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前运行中的key集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;K&gt; runningKeySet;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 候选任务key队列</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Queue&lt;K&gt; candidateKeyQueue;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 同时运行的最大线程数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> maxThreadNum;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ExecutorService executorService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 具体任务策略</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BiFunction&lt;K, V, R&gt; biFunction;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前index线程的运行状态，可依据此状态，判断是否立刻从任务参数中获取任务执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Integer, Boolean&gt; currentIndexThreadRunningStatusMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcurrentExecutor</span><span class="params">(<span class="type">int</span> maxThreadNum, Map&lt;K, V&gt; paramMap, BiFunction&lt;K, V, R&gt; biFunction)</span> &#123;</span><br><span class="line">        Assert.notNull(paramMap, <span class="string">&quot;paramMap不可为空&quot;</span>);</span><br><span class="line">        Assert.isTrue(maxThreadNum &gt; <span class="number">0</span>, <span class="string">&quot;maxThreadNum不可小于1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">paramSize</span> <span class="operator">=</span> paramMap.size();</span><br><span class="line">        <span class="built_in">this</span>.maxThreadNum = Math.min(maxThreadNum, paramSize);</span><br><span class="line">        <span class="comment">// tips: 须转换成同步类的map数据结构，如果错误地使用 this.paramMap = paramMap; 且外部使用了HashMap 或 LinkedHashMap，多测试几遍会发现，偶尔会陷入了阻塞</span></span><br><span class="line">        <span class="built_in">this</span>.paramMap = Collections.synchronizedMap(paramMap);</span><br><span class="line">        <span class="built_in">this</span>.candidateKeyQueue = <span class="keyword">new</span> <span class="title class_">ConcurrentLinkedQueue</span>&lt;&gt;(paramMap.keySet());</span><br><span class="line">        <span class="built_in">this</span>.runningKeySet = <span class="keyword">new</span> <span class="title class_">ConcurrentHashSet</span>&lt;&gt;(paramSize);</span><br><span class="line">        <span class="built_in">this</span>.biFunction = biFunction;</span><br><span class="line">        <span class="built_in">this</span>.executorService = ThreadUtil.newExecutor(<span class="built_in">this</span>.maxThreadNum, <span class="built_in">this</span>.maxThreadNum, Integer.MAX_VALUE);</span><br><span class="line">        <span class="built_in">this</span>.currentIndexThreadRunningStatusMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="built_in">this</span>.maxThreadNum);</span><br><span class="line">        <span class="built_in">this</span>.successResultMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="built_in">this</span>.paramMap.size());</span><br><span class="line">        <span class="built_in">this</span>.errorResultMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (CollUtil.isNotEmpty(paramMap)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 最多同时有 maxRunningThreadNumber 同时消费 taskMap 中的数据</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="built_in">this</span>.maxThreadNum; i++) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">currentIndex</span> <span class="operator">=</span> i;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 当前线程上次还未执行完，暂时跳过</span></span><br><span class="line">                <span class="keyword">final</span> <span class="type">Boolean</span> <span class="variable">isRunning</span> <span class="operator">=</span> currentIndexThreadRunningStatusMap.getOrDefault(currentIndex, <span class="literal">false</span>);</span><br><span class="line">                <span class="keyword">if</span> (BooleanUtil.isTrue(isRunning)) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 选择一个候选key</span></span><br><span class="line">                <span class="keyword">final</span> <span class="type">K</span> <span class="variable">candidateKey</span> <span class="operator">=</span> pickCandidateKey();</span><br><span class="line">                <span class="comment">// 当前没有对应key的任务</span></span><br><span class="line">                <span class="keyword">if</span> (Objects.isNull(candidateKey)) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 在线程池中运行任务</span></span><br><span class="line">                executorService.submit(() -&gt; &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        currentIndexThreadRunningStatusMap.put(currentIndex, <span class="literal">true</span>);</span><br><span class="line">                        <span class="keyword">final</span> <span class="type">V</span> <span class="variable">data</span> <span class="operator">=</span> paramMap.get(candidateKey);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// 开始执行任务</span></span><br><span class="line">                        <span class="keyword">final</span> <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> biFunction.apply(candidateKey, data);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// 存入正常结果</span></span><br><span class="line">                        successResultMap.put(candidateKey, result);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        <span class="comment">// 存入异常结果</span></span><br><span class="line">                        errorResultMap.put(candidateKey, e);</span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                        paramMap.remove(candidateKey);</span><br><span class="line">                        candidateKeyQueue.remove(candidateKey);</span><br><span class="line">                        currentIndexThreadRunningStatusMap.remove(currentIndex);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        executorService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从候选任务key队列中选择一个任务key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> K <span class="title function_">pickCandidateKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (K candidateKey : candidateKeyQueue) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!runningKeySet.contains(candidateKey)) &#123;</span><br><span class="line">                runningKeySet.add(candidateKey);</span><br><span class="line">                <span class="keyword">return</span> candidateKey;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;K, R&gt; <span class="title function_">getSuccessResultMap</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> successResultMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;K, Throwable&gt; <span class="title function_">getErrorResultMap</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> errorResultMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="源码（方案-2）"><a href="#源码（方案-2）" class="headerlink" title="源码（方案 2）"></a>源码（方案 2）</h2><p>基于 executorService.invokeAll</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyloou.component.util.concurrent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.TimeInterval;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.lang.Assert;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.thread.ThreadUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.function.BiFunction;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 并发执行器</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 适用场景：每个任务是独立的，不耦合的</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lilou</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2022/6/9 9:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcurrentExecutor2</span>&lt;K, V, R&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 任务参数映射（K：key的类型，V：值的类型）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;K, V&gt; paramMap;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 成功的任务结果映射</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;K, R&gt; successResultMap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 失败的任务结果映射</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;K, Throwable&gt; errorResultMap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ExecutorService executorService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 具体任务策略</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BiFunction&lt;K, V, R&gt; biFunction;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcurrentExecutor2</span><span class="params">(<span class="type">int</span> maxThreadNum, Map&lt;K, V&gt; paramMap, BiFunction&lt;K, V, R&gt; biFunction)</span> &#123;</span><br><span class="line">        Assert.notNull(paramMap, <span class="string">&quot;paramMap不可为空&quot;</span>);</span><br><span class="line">        Assert.isTrue(maxThreadNum &gt; <span class="number">0</span>, <span class="string">&quot;maxThreadNum不可小于1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 同时运行的最大线程数量</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">maxThreadNum1</span> <span class="operator">=</span> Math.min(maxThreadNum, paramMap.size());</span><br><span class="line">        <span class="comment">// tips: 如果错误地使用 this.paramMap = paramMap; 多测试几遍会发现，偶尔会陷入了阻塞</span></span><br><span class="line">        <span class="built_in">this</span>.paramMap = Collections.synchronizedMap(paramMap);</span><br><span class="line">        <span class="built_in">this</span>.biFunction = biFunction;</span><br><span class="line">        <span class="built_in">this</span>.executorService = ThreadUtil.newExecutor(maxThreadNum1, maxThreadNum1, Integer.MAX_VALUE);</span><br><span class="line">        <span class="built_in">this</span>.successResultMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="built_in">this</span>.paramMap.size());</span><br><span class="line">        <span class="built_in">this</span>.errorResultMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (CollUtil.isNotEmpty(paramMap)) &#123;</span><br><span class="line">            List&lt;Callable&lt;R&gt;&gt; callableList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            paramMap.forEach((k, v) -&gt; callableList.add(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="type">R</span> <span class="variable">result</span> <span class="operator">=</span> biFunction.apply(k, v);</span><br><span class="line">                    successResultMap.put(k, result);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    errorResultMap.put(k, e);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    paramMap.remove(k);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;));</span><br><span class="line">            <span class="comment">// 在线程池中运行任务</span></span><br><span class="line">            executorService.invokeAll(callableList);</span><br><span class="line">            executorService.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;K, R&gt; <span class="title function_">getSuccessResultMap</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> successResultMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;K, Throwable&gt; <span class="title function_">getErrorResultMap</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> errorResultMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TimeInterval</span> <span class="variable">timer</span> <span class="operator">=</span> DateUtil.timer();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            test();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(timer.intervalMs());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        Map&lt;String, String&gt; paramMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            paramMap.put(<span class="string">&quot;key:&quot;</span> + i, <span class="string">&quot;value:&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> ConcurrentExecutor2&lt;String, String, Integer&gt; executor = <span class="keyword">new</span> <span class="title class_">ConcurrentExecutor2</span>&lt;&gt;(<span class="number">5</span>, paramMap,</span><br><span class="line">                (k, v) -&gt; &#123;</span><br><span class="line">                    ThreadUtil.sleep(<span class="number">10</span>);</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;-&quot;</span> + v);</span><br><span class="line">                    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">abs</span> <span class="operator">=</span> Math.abs(Objects.hash(v));</span><br><span class="line">                    <span class="keyword">if</span> (abs % <span class="number">3</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> abs;</span><br><span class="line">                &#125;);</span><br><span class="line">        executor.execute();</span><br><span class="line">        System.out.println(<span class="string">&quot;success result: &quot;</span> + executor.getSuccessResultMap());</span><br><span class="line">        System.out.println(<span class="string">&quot;error result: &quot;</span> + executor.getErrorResultMap());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>HTML易混淆概念.md</title>
    <url>/js/HTML%E6%98%93%E6%B7%B7%E6%B7%86%E6%A6%82%E5%BF%B5/</url>
    <content><![CDATA[<h2 id="HTML中易混淆概念"><a href="#HTML中易混淆概念" class="headerlink" title="HTML中易混淆概念"></a>HTML中易混淆概念</h2><h3 id="不要胡乱嵌套标签"><a href="#不要胡乱嵌套标签" class="headerlink" title="不要胡乱嵌套标签"></a>不要胡乱嵌套标签</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">- <span class="tag">&lt;<span class="name">p</span>&gt;</span>里面不可以嵌套<span class="tag">&lt;<span class="name">div</span>&gt;</span>、<span class="tag">&lt;<span class="name">h1</span>&gt;</span>~<span class="tag">&lt;<span class="name">h6</span>&gt;</span>、<span class="tag">&lt;<span class="name">p</span>&gt;</span>、<span class="tag">&lt;<span class="name">ul</span>&gt;</span>/<span class="tag">&lt;<span class="name">ol</span>&gt;</span>/<span class="tag">&lt;<span class="name">li</span>&gt;</span>、<span class="tag">&lt;<span class="name">dl</span>&gt;</span>/<span class="tag">&lt;<span class="name">dt</span>&gt;</span>/<span class="tag">&lt;<span class="name">dd</span>&gt;</span>、<span class="tag">&lt;<span class="name">form</span>&gt;</span>等</span><br><span class="line">- a元素里不可以嵌套交互式元素(<span class="tag">&lt;<span class="name">a</span>&gt;</span>、<span class="tag">&lt;<span class="name">button</span>&gt;</span>、<span class="tag">&lt;<span class="name">select</span>&gt;</span>等)</span><br></pre></td></tr></table></figure>
<p><a href="http://www.w3cschool.cn/html/html-cui11xk2.html">HTML元素嵌套嵌套错误可能引起的问题</a></p>
]]></content>
      <tags>
        <tag>html</tag>
      </tags>
  </entry>
  <entry>
    <title>JQuery学习笔记.md</title>
    <url>/js/JQuery%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<p>重难点：<br><a href="http://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/0014345008539155e93fc16046d4bb7854943814c4f9dc2000#0">Promise</a></p>
<h1 id="jQuery"><a href="#jQuery" class="headerlink" title="jQuery"></a>jQuery</h1><h2 id="组合查找"><a href="#组合查找" class="headerlink" title="组合查找"></a>组合查找</h2><h3 id="tag和属性"><a href="#tag和属性" class="headerlink" title="tag和属性"></a>tag和属性</h3><p>$(‘input[name=”email”]’); // 找到input下的name=”email”的标签；</p>
<h3 id="tag和class"><a href="#tag和class" class="headerlink" title="tag和class"></a>tag和class</h3><p>$(‘tr.red’); // 找出<tr class="red ...">…</tr></p>
<h2 id="多项选择器"><a href="#多项选择器" class="headerlink" title="多项选择器"></a>多项选择器</h2><p>用符号”,”隔开<br>$(‘p,div’); // 把</p><p>、<div>都选择出来。<br>注意选择出来的元素按照在HTML中的顺序排列的，不会有重复的元素。</div></p>
<h2 id="层级选择器"><a href="#层级选择器" class="headerlink" title="层级选择器"></a>层级选择器</h2><p>如果两个DOM元素据有层级关系，就用<code>$(&#39;parent child&#39;)</code>来选择，层级之间用空格隔开。<br>其中，parent和child可以是父子关系，也可以是祖孙关系。</p>
<p>好处：缩小了选择的范围，因为首先要定位父节点，才能选择相应的子节点。</p>
<h2 id="子选择器"><a href="#子选择器" class="headerlink" title="子选择器"></a>子选择器</h2><p>$(‘parent&gt;child’)<br>其中，parent和child必须是父子关系（直属父子关系）；</p>
<h2 id="查找和过滤"><a href="#查找和过滤" class="headerlink" title="查找和过滤"></a>查找和过滤</h2><p>向下层查找： 使用<code>find()</code>函数，其中的参数表示同上面的选择器所需要的一样；<br>向上层查找： 使用<code>parent()</code>函数。<br>同层查找： 使用<code>next()</code>或者<code>prev()</code>方法。可以包含参数，也可以不要参数。</p>
<h2 id="操作DOM"><a href="#操作DOM" class="headerlink" title="操作DOM"></a>操作DOM</h2><p>$(‘#id’).text() 获取节点文本<br>$(‘#id’).html() 获取原始HTML</p>
<h3 id="传入参数直接修改内容"><a href="#传入参数直接修改内容" class="headerlink" title="传入参数直接修改内容"></a>传入参数直接修改内容</h3><p>$(‘#id’).text(‘new’);<br>$(‘#id’).html(‘<span>new</span>‘);</p>
<h3 id="获取class"><a href="#获取class" class="headerlink" title="获取class"></a>获取class</h3><p>$(‘#id’).css(‘color’);</p>
<h3 id="设置class"><a href="#设置class" class="headerlink" title="设置class"></a>设置class</h3><p>$(‘#id’).css(‘color’, ‘red’);<br>$(‘#id’).css(‘backgroundColor’, ‘red’);<br>$(‘#id’).css(‘background-color’, ‘red’);</p>
<p>$(‘#id’).hasClass(‘hightlight’);<br>$(‘#id’).addClass(‘hightlight’);<br>$(‘#id’).removeClass(‘hightlight’);</p>
<h3 id="显示和隐藏DOM"><a href="#显示和隐藏DOM" class="headerlink" title="显示和隐藏DOM"></a>显示和隐藏DOM</h3><p>$(‘#id’).hide(); // 隐藏<br>$(‘#id’).show(); // 显示</p>
<h3 id="获取DOM信息"><a href="#获取DOM信息" class="headerlink" title="获取DOM信息"></a>获取DOM信息</h3><p>$(‘#id’).width();<br>$(‘#id’).height();</p>
<h3 id="操作属性"><a href="#操作属性" class="headerlink" title="操作属性:"></a>操作属性:</h3><p>$(‘#id’).attr(‘name’); // 获取属性<br>$(‘#id’).attr(‘name’, ‘hello’); // 设置属性<br>$(‘#id’).removeAttr(‘name’); // 移除属性</p>
<p>注意：针对radio 和 selected 要区别处理（例如使用prop），最好使用<code>is(&#39;:selected&#39;)</code>这样的方式；<br><a href="http://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/001434500494451273e6b3dec9d411d9ba841dee8caec45000">http://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/001434500494451273e6b3dec9d411d9ba841dee8caec45000</a></p>
<h3 id="操作表单"><a href="#操作表单" class="headerlink" title="操作表单"></a>操作表单</h3><p>获取value: input.val();<br>设置value: input.val(‘newValue’);</p>
<h2 id="修改DOM结构"><a href="#修改DOM结构" class="headerlink" title="修改DOM结构"></a>修改DOM结构</h2><h3 id="添加子节点"><a href="#添加子节点" class="headerlink" title="添加子节点"></a>添加子节点</h3><p>在子节点最后添加：<br>$(‘#div’).append(‘<li>Lua</li>‘);</p>
<p>在子节点前面添加：<br>$(‘#div’).append(‘<li>Lua</li>‘);</p>
<p>在同级节点添加：<br>$(‘#div’).after(‘</p><p>Java</p>‘);<br>$(‘#div’).before(‘<p>Java</p>‘);<p></p>
<h3 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h3><p>$(‘#div’).remove(); // 删除了id为div的节点</p>
<h1 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h1><p><a href="http://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/00143564690172894383ccd7ab64669b4971f4b03fa342d000#0">http://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/00143564690172894383ccd7ab64669b4971f4b03fa342d000#0</a></p>
<ul>
<li>鼠标事件</li>
<li>键盘事件</li>
<li>其他事件（focus, blur, change, submit, ready）<br>在head中的script中设置了DOM的事件监听，却没有生效，原因是：<br>因为JavaScript在此执行的时候，设置的对象尚未载入浏览器，所以获取的DOM为<code>[]</code>，所以事件并没有绑定到任何DOM上。<br>解决办法是：<br>将绑定事件的过程放在document的ready中执行<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&#x27;ready&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        $(<span class="string">&#x27;#testForm&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;submit&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&#x27;Submit&#x27;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
另一种简单处理方式（上面的代码简写）：<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    $(<span class="string">&#x27;#testForm&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;submit&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&#x27;Submit&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="事件触发条件"><a href="#事件触发条件" class="headerlink" title="事件触发条件"></a>事件触发条件</h3><p>例如：监听文本框的内容变动</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> input = $(<span class="string">&#x27;#test-input&#x27;</span>);</span><br><span class="line">input.<span class="title function_">change</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;changed...&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>通过js代码改变其值，并不会触发事件，我们可以通过手动调用change()方法来触发；</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> input = $(<span class="string">&#x27;#test-input&#x27;</span>);</span><br><span class="line">input.<span class="title function_">val</span>(<span class="string">&#x27;change it!&#x27;</span>);</span><br><span class="line">input.<span class="title function_">change</span>();</span><br></pre></td></tr></table></figure>
<p><code>input.change()</code>相当于<code>input.trigger(&#39;change&#39;)</code></p>
<h3 id="浏览器安全限制"><a href="#浏览器安全限制" class="headerlink" title="浏览器安全限制"></a>浏览器安全限制</h3><p>只有用户触发才能执行</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 无法弹出新窗口，将被浏览器屏蔽</span></span><br><span class="line">$(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正常执行</span></span><br><span class="line"><span class="keyword">var</span> button1 = $(<span class="string">&#x27;#testPopupButton1&#x27;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">popupTestWindow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">button1.<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 正常执行</span></span><br><span class="line">    <span class="title function_">popupTestWindow</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 延迟执行的`window.open()`方法会被浏览器限制；</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(popupTestWindow, <span class="number">100</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="jQuery动画"><a href="#jQuery动画" class="headerlink" title="jQuery动画"></a>jQuery动画</h1><h2 id="常用动画"><a href="#常用动画" class="headerlink" title="常用动画"></a>常用动画</h2><ul>
<li>div.show(300);</li>
<li>div.hide(300);</li>
<li>div.toggle(300);</li>
<li>div.slideDown(300);</li>
<li>div.slideUp(300);</li>
<li>div.slideToggle(300);</li>
<li>div.fadeIn(300);</li>
<li>div.fadeOut(300);</li>
<li>div.fadeToggle(300);</li>
</ul>
<h2 id="自定义动画"><a href="#自定义动画" class="headerlink" title="自定义动画"></a>自定义动画</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">div.<span class="title function_">animate</span>(&#123;</span><br><span class="line">        <span class="comment">// 最后的状态</span></span><br><span class="line">    &#125;, <span class="number">300</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// 动画结束后的操作</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="jQuery扩展"><a href="#jQuery扩展" class="headerlink" title="jQuery扩展"></a>jQuery扩展</h1><p>编写jQuery插件原则：</p>
<ol>
<li>给<code>$.fn</code>绑定函数，实现插件的代码逻辑；</li>
<li>插件函数最后要<code>return this</code>, 以支持链式调用；</li>
<li>插件函数要有默认值，绑定在<code>$.fn.&lt;pluginName&gt;.defaults</code>上；</li>
<li>用户在调用时可传入设定值以便覆盖默认值；</li>
</ol>
<h1 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h1><p>对于 try catch finally结构的处理方式，需要注意：<br>一旦错误发生，就不再向后进行，但是前面已经执行成功的，则保持住了，如下代码；</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> r1=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> r2=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">var</span> r3=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> r4=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        r1 = <span class="number">1</span>;</span><br><span class="line">        r2.<span class="property">kk</span>;</span><br><span class="line">        r3 = <span class="number">3</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        r4 = <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;r1=&#x27;</span> + r1);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;r2=&#x27;</span> + r2);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;r3=&#x27;</span> + r3);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;r4=&#x27;</span> + r4);</span><br><span class="line">&lt;/script&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>输出结果是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">r1=<span class="number">1</span> <span class="comment">// r1已经执行成功了，（注意：不像java中的处理方式，如果出错了所有的都失效）</span></span><br><span class="line">r2=<span class="literal">null</span></span><br><span class="line">r3=<span class="number">0</span></span><br><span class="line">r4=<span class="number">4</span></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS中易混淆概念</title>
    <url>/js/css%E4%B8%AD%E6%98%93%E6%B7%B7%E6%B7%86%E6%A6%82%E5%BF%B5/</url>
    <content><![CDATA[<h3 id="轮廓（outline）的宽度是否影响元素尺寸？"><a href="#轮廓（outline）的宽度是否影响元素尺寸？" class="headerlink" title="轮廓（outline）的宽度是否影响元素尺寸？"></a>轮廓（outline）的宽度是否影响元素尺寸？</h3><p>在盒子模型里，元素的尺寸依赖于：边距，边框，填充，内容。</p>
<blockquote>
</blockquote>
<p>outline 属性与 border 属性不同：outline不是元素尺寸的一部分，元素的总宽度和高度不受轮廓宽度的影响。<br>轮廓不被视为页面的一部分，因此在应用它们时不会导致页面布局被调整。<br><a href="http://www.w3cschool.cn/css/html-css-outline.html">http://www.w3cschool.cn/css/html-css-outline.html</a></p>
<p>ps:当宽度很宽时，outline直接覆盖到其他元素了。<br>通过颜色透明度来观察会更清晰：<code>outline:52px solid #80aaaaaa;</code><br>（可以在<code>http://www.w3cschool.cn/tryrun/showhtml/trycss3_outline-offset</code>这个实验里修改更大的宽度和颜色看看。）</p>
<h3 id="浮动和清除浮动"><a href="#浮动和清除浮动" class="headerlink" title="浮动和清除浮动"></a>浮动和清除浮动</h3><p>clear属性指定元素两侧不能出现浮动元素。<br><a href="http://www.w3cschool.cn/css/css-float.html">CSS Float（浮动）</a></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">- 假如某个<span class="selector-tag">div</span>元素<span class="selector-tag">A</span>是浮动的，如果<span class="selector-tag">A</span>元素上一个元素也是浮动的，那么<span class="selector-tag">A</span>元素会跟随在上一个元素的后边</span><br><span class="line">  (如果一行放不下这两个元素，那么<span class="selector-tag">A</span>元素会被挤到下一行)；如果<span class="selector-tag">A</span>元素上一个元素是标准流中的元素，那么<span class="selector-tag">A</span>的相对垂直位置不会改变，也就是说<span class="selector-tag">A</span>的顶部总是和上一个元素的底部对齐。</span><br><span class="line">- <span class="attribute">clear</span>属性只对当前被作用的标签有效，不能影响其他元素；</span><br></pre></td></tr></table></figure>
<p><a href="http://www.cnblogs.com/iyangyuan/archive/2013/03/27/2983813.html">经验分享：CSS浮动(float,clear)通俗讲解</a></p>
<h3 id="常见的块级元素和内联元素"><a href="#常见的块级元素和内联元素" class="headerlink" title="常见的块级元素和内联元素"></a>常见的块级元素和内联元素</h3><p>块级元素：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">- <span class="selector-tag">div</span></span><br><span class="line">- <span class="selector-tag">p</span></span><br><span class="line">- <span class="selector-tag">h1</span>, <span class="selector-tag">h2</span>, <span class="selector-tag">h3</span>, ..., <span class="selector-tag">h6</span></span><br><span class="line">- <span class="selector-tag">ul</span></span><br><span class="line">- <span class="selector-tag">table</span></span><br></pre></td></tr></table></figure>
<p>内联元素：</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">- </span>span</span><br><span class="line"><span class="bullet">- </span>b</span><br><span class="line"><span class="bullet">- </span>td</span><br><span class="line"><span class="bullet">- </span>a</span><br><span class="line"><span class="bullet">- </span>img</span><br></pre></td></tr></table></figure>

<h3 id="下拉菜单"><a href="#下拉菜单" class="headerlink" title="下拉菜单"></a>下拉菜单</h3><p><a href="http://www.w3cschool.cn/css/xohvqfmc.html">http://www.w3cschool.cn/css/xohvqfmc.html</a></p>
]]></content>
      <tags>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS布局</title>
    <url>/js/css%E5%B8%83%E5%B1%80/</url>
    <content><![CDATA[<blockquote>
<p>从局部到全面。一小块，一小块。<br>从全面到局部。逐级增大。</p>
</blockquote>
<h2 id="Flex-布局教程"><a href="#Flex-布局教程" class="headerlink" title="Flex 布局教程"></a>Flex 布局教程</h2><p><a href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html">Flex 布局教程：语法篇 - 阮一峰的网络日志</a><br><a href="http://www.ruanyifeng.com/blog/2015/07/flex-examples.html">Flex 布局教程：实例篇 - 阮一峰的网络日志</a></p>
<h2 id="圆角图片"><a href="#圆角图片" class="headerlink" title="圆角图片"></a>圆角图片</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.icon</span> &#123;</span><br><span class="line">    <span class="attribute">border-radius</span>:<span class="number">50%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="横向滚动"><a href="#横向滚动" class="headerlink" title="横向滚动"></a>横向滚动</h2><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.items</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: row;</span><br><span class="line">    <span class="attribute">overflow-x</span>: scroll;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">218px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>Emoji</title>
    <url>/js/emoji/</url>
    <content><![CDATA[<p>微信使用的是：Softbank的编码<br><a href="http://www.wxeditor.com/emoji">http://www.wxeditor.com/emoji</a></p>
<p><a href="https://github.com/iamcal/js-emoji">https://github.com/iamcal/js-emoji</a></p>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>ES6</title>
    <url>/js/es6/</url>
    <content><![CDATA[<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a><a href="http://es6.ruanyifeng.com/#docs/function">函数</a></h2><h3 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h3><p>如果箭头函数只有一行语句，且不需要返回值，可以采用下面的写法，就不用写大括号了。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; <span class="keyword">void</span> <span class="title function_">doesNotReturn</span>();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>箭头函数有几个使用注意点。<br>（1）函数体内的 this 对象，就是定义时所在的对象，而不是使用时所在的对象。<br>（2）不可以当作构造函数，也就是说，不可以使用 new 命令，否则会抛出一个错误。<br>（3）不可以使用 arguments 对象，该对象在函数体内不存在。如果要用，可以用 rest 参数代替。<br>（4）不可以使用 yield 命令，因此箭头函数不能用作 Generator 函数。</p>
</blockquote>
<h3 id="定义时所在的作用域-amp-运行时所在的作用域"><a href="#定义时所在的作用域-amp-运行时所在的作用域" class="headerlink" title="定义时所在的作用域 &amp; 运行时所在的作用域"></a><a href="http://es6.ruanyifeng.com/#docs/function#%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E7%82%B9">定义时所在的作用域 &amp; 运行时所在的作用域</a></h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 箭头函数可以让setTimeout里面的this，绑定定义时所在的作用域，而不是指向运行时所在的作用域。下面是另一个例子。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Timer</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">s1</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">s2</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 箭头函数</span></span><br><span class="line">  <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">s1</span>++, <span class="number">1000</span>);</span><br><span class="line">  <span class="comment">// 普通函数</span></span><br><span class="line">  <span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">s2</span>++;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> timer = <span class="keyword">new</span> <span class="title class_">Timer</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;s1: &quot;</span>, timer.<span class="property">s1</span>), <span class="number">3100</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;s2: &quot;</span>, timer.<span class="property">s2</span>), <span class="number">3100</span>);</span><br><span class="line"><span class="comment">// s1: 3</span></span><br><span class="line"><span class="comment">// s2: 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面代码中，Timer函数内部设置了两个定时器，分别使用了箭头函数和普通函数。前者的this绑定定义时所在的作用域（即Timer函数），后者的this指向运行时所在的作用域（即全局对象）。所以，3100 毫秒之后，timer.s1被更新了 3 次，而timer.s2一次都没更新。</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>箭头函数里面根本没有自己的 this，而是引用外层的 this。<br>除了 this，以下三个变量在箭头函数之中也是不存在的，指向外层函数的对应变量：arguments、super、new.target。<br>另外，由于箭头函数没有自己的 this，所以当然也就不能用 call()、apply()、bind()这些方法去改变 this 的指向。</p>
</blockquote>
<h3 id="尾调用"><a href="#尾调用" class="headerlink" title="尾调用"></a><a href="http://es6.ruanyifeng.com/#docs/function#%E5%B0%BE%E8%B0%83%E7%94%A8%E4%BC%98%E5%8C%96">尾调用</a></h3><p>只有不再用到外层函数的内部变量，内层函数的调用帧才会取代外层函数的调用帧，否则就无法进行“尾调用优化”。</p>
<h3 id="空位"><a href="#空位" class="headerlink" title="空位"></a>空位</h3><p>for…of 并没有忽略它们；<br>entries()、keys()、values()、find()和 findIndex()会将空位处理成 undefined；<br>由于空位的处理规则非常不统一，所以建议避免出现空位。</p>
<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a><a href="http://es6.ruanyifeng.com/#docs/object">对象</a></h2><p>Object.assign 拷贝的属性是有限制的，<br>只拷贝源对象的自身属性（不拷贝继承属性），也不拷贝不可枚举的属性（enumerable: false）。</p>
<h3 id="有四个操作会忽略-enumerable-为-false-的属性。"><a href="#有四个操作会忽略-enumerable-为-false-的属性。" class="headerlink" title="有四个操作会忽略 enumerable 为 false 的属性。"></a>有四个操作会忽略 enumerable 为 false 的属性。</h3><ul>
<li>for…in 循环：只遍历对象自身的和继承的可枚举的属性。</li>
<li>Object.keys()：返回对象自身的所有可枚举的属性的键名。</li>
<li>JSON.stringify()：只串行化对象自身的可枚举的属性。</li>
<li>Object.assign()： 忽略 enumerable 为 false 的属性，只拷贝对象自身的可枚举的属性。</li>
</ul>
<p>for…in 会返回继承的属性，可以通过配置<code>enumerable</code>为<code>false</code>来避免<code>toString</code>和<code>length</code>属性被遍历。<br>总的来说，操作中引入继承的属性会让问题复杂化，大多数时候，我们只关心对象自身的属性。所以，尽量不要用 for…in 循环，而用 Object.keys()代替。</p>
<h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>Promise 新建后就会立即执行。<br><a href="http://es6.ruanyifeng.com/#docs/promise">Promise 对象 - ECMAScript 6 入门</a></p>
<p>Promise 对象的报错具有传递性。<br><a href="https://wangdoc.com/javascript/async/promise.html">Promise 对象 - JavaScript 教程 - 网道</a></p>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Grunt相关</title>
    <url>/js/grunt/</url>
    <content><![CDATA[<p>| How do I uninstall or remove unwanted plugins?</p>
<ul>
<li><code>npm uninstall [GRUNT_PLUGIN] --save-dev</code>, this will remove the plugin from<br>your <code>package.json</code> and from <code>node_module</code></li>
<li>delete the dependencies in <code>package.json</code> mannually and run <code>npm prune</code></li>
</ul>
<p>| 异步任务,需要在task body中调用<code>this.async()</code>来开启。<br><code>var done = this.async()</code><br>Note that passing <code>false</code> to the <code>done()</code> function tells Grunt that the task has<br>failed.</p>
<p>| 获取configuration中的属性值<br><code>grunt.config(&#39;meta.name&#39;)</code><br>or<br><code>grunt.config([&#39;meta&#39;, &#39;name&#39;])</code></p>
<p>| 验证configuration中是否存在property:<br><code>grunt.config.requires(&#39;meta.name&#39;)</code><br>or<br><code>grunt.config.requires([&#39;meta&#39;, &#39;name&#39;])</code></p>
<p>| Tasks can be dependent on the successful execution of other tasks.<br><code>grunt.task.requires(&#39;foo&#39;)</code></p>
<p>| Inside a task, you can run other tasks.<br><code>grunt.task.run(&#39;bar&#39;, &#39;baz&#39;)</code><br>or<br><code>grunt.task.run([&#39;bar&#39;, &#39;baz&#39;])</code></p>
<p>| 一旦一个任务返回了false，就会abort了。通过添加参数<code>--force</code>来强制向后继续执行。</p>
<p>| 执行多个任务用空格分开：<br><code>grunt foo bar</code> 和下面的代码一样</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">grunt foo</span><br><span class="line">grunt bar</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://gruntjs.com/creating-tasks">https://gruntjs.com/creating-tasks</a></li>
</ul>
<p>| Creating Tasks</p>
<ul>
<li><p>Alias Task;</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">grunt.<span class="title function_">registerTask</span>(taskName, [description, ], taskList);</span><br><span class="line"><span class="comment">// eg.</span></span><br><span class="line">grunt.<span class="title function_">registerTask</span>(<span class="string">&quot;default&quot;</span>, [<span class="string">&#x27;jshint&#x27;</span>, <span class="string">&#x27;qunit&#x27;</span>, <span class="string">&#x27;concat:dist&#x27;</span>, <span class="string">&#x27;uglify:dist&#x27;</span>]);</span><br></pre></td></tr></table></figure></li>
<li><p>Multi Task;<br>When a multi task is run, Grunt looks for a property of the same in the Grunt Configuration.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">grunt.<span class="title function_">registerMultiTask</span>(taskName, [description, ], taskFunction);</span><br><span class="line"></span><br><span class="line"><span class="comment">// eg.</span></span><br><span class="line">grunt.<span class="title function_">registerMultiTask</span>(<span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;log stuff.&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    grunt.<span class="property">log</span>.<span class="title function_">write</span>(<span class="variable language_">this</span>.<span class="property">target</span> + <span class="string">&quot;:&quot;</span> + <span class="variable language_">this</span>.<span class="property">data</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>Basic Task;<br>When a basic task is run, Grunt doesn’t looks at the configuration and environment.<br>通过冒号来传递参数:例如针对下面的声明，通过<code>grunt log:ARG1:ARG2</code>来调用。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">grunt.<span class="title function_">registerTask</span>(taskName, [description, ], taskFunction);</span><br><span class="line"></span><br><span class="line"><span class="comment">// eg.</span></span><br><span class="line">grunt.<span class="title function_">registerTask</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;A sample task that logs stuff.&#x27;</span>, <span class="keyword">function</span>(<span class="params">arg1, arg2</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        grunt.<span class="property">log</span>.<span class="title function_">write</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;, no args.&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        grunt.<span class="property">log</span>.<span class="title function_">write</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;, arg1=&quot;</span> + arg1 + <span class="string">&quot;, arg2=&quot;</span> + arg2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>Custom Task;</p>
</li>
</ul>
<p>| eg.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">grunt</span>) &#123;</span><br><span class="line">    grunt.<span class="title function_">initConfig</span>(&#123;</span><br><span class="line">        <span class="attr">pkg</span>: grunt.<span class="property">file</span>.<span class="title function_">readJSON</span>(<span class="string">&#x27;package.json&#x27;</span>),</span><br><span class="line">        <span class="attr">uglify</span>: &#123;</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">banner</span>: <span class="string">&#x27;/*! &lt;%= pkg.name %&gt; &lt;%= grunt.template.today(&quot;yyyy-mm-dd&quot;) %&gt;*/\n&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">build</span>: &#123;</span><br><span class="line">                <span class="attr">src</span>: <span class="string">&#x27;src/&lt;%= pkg.name %&gt;.js&#x27;</span>,</span><br><span class="line">                <span class="attr">dest</span>: <span class="string">&#x27;build/&lt;%= pkg.name %&gt;.min.js&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">concat</span>: &#123;</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">separator</span>: <span class="string">&quot;;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">dist</span>: &#123;</span><br><span class="line">                <span class="attr">src</span>: [<span class="string">&#x27;src/**/*.js&#x27;</span>],</span><br><span class="line">                <span class="attr">dest</span>: <span class="string">&#x27;dist/&lt;%= pkg.name %&gt;.js&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">qunit</span>: &#123;</span><br><span class="line">            <span class="attr">files</span>: [<span class="string">&#x27;test/**/*.html&#x27;</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">jshint</span>: &#123;</span><br><span class="line">            <span class="attr">files</span>: [<span class="string">&#x27;Gruntfile.js&#x27;</span>, <span class="string">&#x27;src/**/*.js&#x27;</span>, <span class="string">&#x27;test/**/*.js&#x27;</span>],</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">globals</span>: &#123;</span><br><span class="line">                    <span class="attr">jQuery</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">console</span>: <span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">module</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">watch</span>: &#123;</span><br><span class="line">            <span class="attr">files</span>: [<span class="string">&#x27;&lt;%= jshint.files %&gt;&#x27;</span>],</span><br><span class="line">            <span class="attr">tasks</span>: [<span class="string">&#x27;jshint&#x27;</span>, <span class="string">&#x27;qunit&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// grunt.loadNpmTasks(&#x27;grunt-contrib-uglify&#x27;);</span></span><br><span class="line">    <span class="comment">// grunt.loadNpmTasks(&#x27;grunt-contrib-concat&#x27;);</span></span><br><span class="line">    <span class="comment">// grunt.loadNpmTasks(&#x27;grunt-contrib-qunit&#x27;);</span></span><br><span class="line">    <span class="comment">// grunt.loadNpmTasks(&#x27;grunt-contrib-jshint&#x27;);</span></span><br><span class="line">    <span class="comment">// grunt.loadNpmTasks(&#x27;grunt-contrib-watch&#x27;);</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&#x27;matchdep&#x27;</span>).<span class="title function_">filterDev</span>(<span class="string">&#x27;grunt-*&#x27;</span>).<span class="title function_">forEach</span>(grunt.<span class="property">loadNpmTasks</span>);</span><br><span class="line"></span><br><span class="line">    grunt.<span class="title function_">registerTask</span>(<span class="string">&#x27;test&#x27;</span>, [<span class="string">&#x27;jshint&#x27;</span>, <span class="string">&#x27;qunit&#x27;</span>]);</span><br><span class="line">    grunt.<span class="title function_">registerTask</span>(<span class="string">&#x27;default&#x27;</span>, [<span class="string">&#x27;jshint&#x27;</span>, <span class="string">&#x27;qunit&#x27;</span>, <span class="string">&#x27;concat&#x27;</span>, <span class="string">&#x27;uglify&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    grunt.<span class="title function_">registerTask</span>(<span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;log some stuff&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        grunt.<span class="property">log</span>.<span class="title function_">write</span>(<span class="string">&#x27;Logging some stuff ...&#x27;</span>).<span class="title function_">error</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>| importing external data</p>
<ul>
<li><code>grunt.file.readJSON()</code></li>
<li><code>grunt.file.readYAML()</code></li>
</ul>
<p>| Template</p>
<ul>
<li><code>&lt;%= prop.subprop %&gt;</code> Expand to the value of <code>prop.subprop</code> in the config,<br>regardless of type. Templates like this can be used to reference not only<br>String values, but also arrays and other objects.</li>
<li><code>&lt;% %&gt;</code> Execute arbitrary inline JavaScript code. This is useful with control<br>flow or looping.<br><a href="https://gruntjs.com/configuring-tasks#templates">https://gruntjs.com/configuring-tasks#templates</a></li>
</ul>
<p>| Global Patterns.<br>All most people need to know is that <code>foo/*.js</code> will match all files<br>ending with <code>.js</code> in the <code>foo/</code> subdirectory, but <code>foo/**/*.js</code> will match<br>all files ending with <code>.js</code> in the <code>foo/</code> subdirectory and all of its<br>subdirectories.</p>
<p>| Specifying both a task and target like <code>grunt concat:foo</code> or <code>grunt concat:bar</code><br>will process just the specified target’s configuration, while run <code>grunt concat</code><br>will iterate over all targets, processing each in turn.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">grunt.<span class="title function_">initConfig</span>(&#123;</span><br><span class="line">  <span class="attr">concat</span>: &#123;</span><br><span class="line">    <span class="attr">foo</span>: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">bar</span>: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>| Define a configuration for each of the tasks we mentioned.<br>  Note: The configuration object for a plugins lives as a property on the<br>  configuration object, that offen shares the same name as its plugin.<br>  eg. <code>grunt-contrib-concat</code> =&gt; <code>concat</code></p>
<p>| 5个插件</p>
<ul>
<li>grunt-contrib-watch: check the code at every change you perform；</li>
<li>grunt-contrib-jshint: ensure best practices, or check the code behaviors；</li>
<li>grunt-contrib-uglify: 创建一个minified的version；</li>
<li>grunt-contrib-qunit: 测试你的project；</li>
<li>grunt-contrib-concat: 多个文件合并成一个文件；</li>
</ul>
<p>| The typical folder structure features the following folders: src, dist, and test.</p>
<ul>
<li>The src folder (sometimes called app) contains the source code of the library as you author it.</li>
<li>The dist folder (sometimes called build) contains the distribution, a minified version of the source code.</li>
<li>the test folder contains the code to test the project.<br><a href="https://gruntjs.com/sample-gruntfile">https://gruntjs.com/sample-gruntfile</a></li>
</ul>
<p>| Grunt and Grunt plugins should be defined as devDependencies in your project’s<br><code>package.json</code>.<br>please use: <code>npm install $package --save-dev</code><br><a href="https://gruntjs.com/installing-grunt">https://gruntjs.com/installing-grunt</a></p>
<p>| load all grunt tasks</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// load all grunt tasks</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;matchdep&#x27;</span>).<span class="title function_">filterDev</span>(<span class="string">&#x27;grunt-*&#x27;</span>).<span class="title function_">forEach</span>(grunt.<span class="property">loadNpmTasks</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面的一句话就替代了很多次的类似下面的调用</span></span><br><span class="line">grunt.<span class="title function_">loadNpmTasks</span>(<span class="string">&#x27;grunt-contrib-jshint&#x27;</span>);</span><br><span class="line">grunt.<span class="title function_">loadNpmTasks</span>(<span class="string">&#x27;grunt-contrib-watch&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>注意：<code>matchdep</code>需要在<code>package.json</code>中的<code>devDependencies</code>中添加：<br><code>&quot;matchdep&quot;: &quot;latest&quot;</code></p>
<p>| A GruntFile is comprised of the following parts:</p>
<ul>
<li>The <code>wrapper</code> function</li>
<li>Project and task configuration</li>
<li>Loading Grunt plugins and tasks</li>
<li>Custom tasks</li>
</ul>
<p>| Because <code>&lt;% %&gt;</code> template strings may reference any config properties,<br>configuration data like filepaths and file lists may be specified this way<br>to reduce repetition.</p>
<ul>
<li><a href="https://gruntjs.com/getting-started">https://gruntjs.com/getting-started</a></li>
</ul>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Javascript的全选、全不选、反选逻辑实现</title>
    <url>/js/javascript%E7%9A%84%E5%85%A8%E9%80%89%E3%80%81%E5%85%A8%E4%B8%8D%E9%80%89%E3%80%81%E5%8F%8D%E9%80%89%E9%80%BB%E8%BE%91%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="实现目标"><a href="#实现目标" class="headerlink" title="实现目标"></a>实现目标</h1><figure class="highlight"><table><tr><td class="code"><pre><span class="line">当用户勾上“全选”时，自动选中所有语言，并把“全选”变成“全不选”；</span><br><span class="line"></span><br><span class="line">当用户去掉“全不选”时，自动不选中所有语言；</span><br><span class="line"></span><br><span class="line">当用户点击“反选”时，自动把所有语言状态反转（选中的变为未选，未选的变为选中）；</span><br><span class="line"></span><br><span class="line">当用户把所有语言都手动勾上时，“全选”被自动勾上，并变为“全不选”；</span><br><span class="line"></span><br><span class="line">当用户手动去掉选中至少一种语言时，“全不选”自动被去掉选中，并变为“全选”。</span><br></pre></td></tr></table></figure>

<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://code.jquery.com/jquery-3.1.1.js&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"><span class="meta"></span></span></span><br><span class="line"><span class="meta"><span class="language-javascript">        &#x27;use strict&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span></span></span><br><span class="line"><span class="language-javascript">                form = $(<span class="string">&#x27;#test-form&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                langs = form.<span class="title function_">find</span>(<span class="string">&#x27;[name=lang]&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                selectAll = form.<span class="title function_">find</span>(<span class="string">&#x27;label.selectAll :checkbox&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                selectAllLabel = form.<span class="title function_">find</span>(<span class="string">&#x27;label.selectAll span.selectAll&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                deselectAllLabel = form.<span class="title function_">find</span>(<span class="string">&#x27;label.selectAll span.deselectAll&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">                invertSelect = form.<span class="title function_">find</span>(<span class="string">&#x27;a.invertSelect&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 重置初始化状态:</span></span></span><br><span class="line"><span class="language-javascript">            form.<span class="title function_">find</span>(<span class="string">&#x27;*&#x27;</span>).<span class="title function_">show</span>().<span class="title function_">off</span>();</span></span><br><span class="line"><span class="language-javascript">            form.<span class="title function_">find</span>(<span class="string">&#x27;:checkbox&#x27;</span>).<span class="title function_">prop</span>(<span class="string">&#x27;checked&#x27;</span>, <span class="literal">false</span>).<span class="title function_">off</span>();</span></span><br><span class="line"><span class="language-javascript">            deselectAllLabel.<span class="title function_">hide</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 拦截form提交事件:</span></span></span><br><span class="line"><span class="language-javascript">            form.<span class="title function_">off</span>().<span class="title function_">submit</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                e.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(form.<span class="title function_">serialize</span>());</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            selectAll.<span class="title function_">on</span>(<span class="string">&#x27;change&#x27;</span>, <span class="keyword">function</span>(<span class="params">e</span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                langs.<span class="title function_">get</span>().<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">x</span>)&#123;$(x).<span class="title function_">prop</span>(<span class="string">&#x27;checked&#x27;</span>, <span class="variable language_">this</span>.<span class="property">checked</span>);&#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">checked</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                    selectAllLabel.<span class="title function_">hide</span>();</span></span><br><span class="line"><span class="language-javascript">                    deselectAllLabel.<span class="title function_">show</span>();</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    selectAllLabel.<span class="title function_">show</span>();</span></span><br><span class="line"><span class="language-javascript">                    deselectAllLabel.<span class="title function_">hide</span>();</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 校验所有的 input</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">function</span> <span class="title function_">checkAll</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// 获取所有input的checked个数</span></span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">var</span> count = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">              langs.<span class="title function_">get</span>().<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">x</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span>($(x).<span class="title function_">prop</span>(<span class="string">&#x27;checked&#x27;</span>))&#123;</span></span><br><span class="line"><span class="language-javascript">                  count = count+<span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">              &#125;);</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">if</span>(count === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (count === inputs.<span class="property">length</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 当用户把所有语言都手动勾上时，“全选”被自动勾上，并变为“全不选”；</span></span></span><br><span class="line"><span class="language-javascript">                selectAll.<span class="title function_">prop</span>(<span class="string">&#x27;checked&#x27;</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                selectAllLabel.<span class="title function_">hide</span>();</span></span><br><span class="line"><span class="language-javascript">                deselectAllLabel.<span class="title function_">show</span>();</span></span><br><span class="line"><span class="language-javascript">              &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 当用户手动去掉选中至少一种语言时，“全不选”自动被去掉选中，并变为“全选”。</span></span></span><br><span class="line"><span class="language-javascript">                selectAll.<span class="title function_">prop</span>(<span class="string">&#x27;checked&#x27;</span>, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                selectAllLabel.<span class="title function_">show</span>();</span></span><br><span class="line"><span class="language-javascript">                deselectAllLabel.<span class="title function_">hide</span>();</span></span><br><span class="line"><span class="language-javascript">              &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            invertSelect.<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params">x</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                langs.<span class="title function_">get</span>().<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">x</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                    $(x).<span class="title function_">prop</span>(<span class="string">&#x27;checked&#x27;</span>, !($(x).<span class="title function_">prop</span>(<span class="string">&#x27;checked&#x27;</span>)));</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">checkAll</span>();</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 设置所有input的监听事件</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> inputs = langs.<span class="title function_">get</span>();</span></span><br><span class="line"><span class="language-javascript">            inputs.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">x</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                $(x).<span class="title function_">change</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="title function_">checkAll</span>();</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  Hello, Lou!</span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- HTML结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;test-form&quot;</span> <span class="attr">action</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>请选择想要学习的编程语言：<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;selectAll&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;selectAll&quot;</span>&gt;</span>全选<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;deselectAll&quot;</span>&gt;</span>全不选<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;invertSelect&quot;</span>&gt;</span>反选<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lang&quot;</span> <span class="attr">value</span>=<span class="string">&quot;javascript&quot;</span>&gt;</span> JavaScript<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lang&quot;</span> <span class="attr">value</span>=<span class="string">&quot;python&quot;</span>&gt;</span> Python<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lang&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ruby&quot;</span>&gt;</span> Ruby<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lang&quot;</span> <span class="attr">value</span>=<span class="string">&quot;haskell&quot;</span>&gt;</span> Haskell<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lang&quot;</span> <span class="attr">value</span>=<span class="string">&quot;scheme&quot;</span>&gt;</span> Scheme<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="http://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/00143564690172894383ccd7ab64669b4971f4b03fa342d000#0">事件 - 廖雪峰的官方网站</a></li>
</ul>
]]></content>
      <tags>
        <tag>js</tag>
        <tag>jQuery</tag>
      </tags>
  </entry>
  <entry>
    <title>Js代码片段</title>
    <url>/js/js%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5/</url>
    <content><![CDATA[<h2 id="获取日期字符串"><a href="#获取日期字符串" class="headerlink" title="获取日期字符串"></a>获取日期字符串</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// [javascript Date format(js日期格式化)(转) - 先锋之客 - 博客园](https://www.cnblogs.com/xianfengzhike/p/9656382.html)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">format</span>(<span class="params">date, format</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> o = &#123;</span><br><span class="line">    <span class="string">&quot;M+&quot;</span>: date.<span class="title function_">getMonth</span>() + <span class="number">1</span>, <span class="comment">// month</span></span><br><span class="line">    <span class="string">&quot;d+&quot;</span>: date.<span class="title function_">getDate</span>(), <span class="comment">// day</span></span><br><span class="line">    <span class="string">&quot;h+&quot;</span>: date.<span class="title function_">getHours</span>(), <span class="comment">// hour</span></span><br><span class="line">    <span class="string">&quot;m+&quot;</span>: date.<span class="title function_">getMinutes</span>(), <span class="comment">// minute</span></span><br><span class="line">    <span class="string">&quot;s+&quot;</span>: date.<span class="title function_">getSeconds</span>(), <span class="comment">// second</span></span><br><span class="line">    <span class="string">&quot;q+&quot;</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>((date.<span class="title function_">getMonth</span>() + <span class="number">3</span>) / <span class="number">3</span>), <span class="comment">// quarter</span></span><br><span class="line">    <span class="attr">S</span>: date.<span class="title function_">getMilliseconds</span>() <span class="comment">// millisecond</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/(y+)/</span>.<span class="title function_">test</span>(format)) &#123;</span><br><span class="line">    format = format.<span class="title function_">replace</span>(</span><br><span class="line">      <span class="title class_">RegExp</span>.<span class="property">$1</span>,</span><br><span class="line">      (date.<span class="title function_">getFullYear</span>() + <span class="string">&quot;&quot;</span>).<span class="title function_">substr</span>(<span class="number">4</span> - <span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="property">length</span>)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> o) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;(&quot;</span> + k + <span class="string">&quot;)&quot;</span>).<span class="title function_">test</span>(format)) &#123;</span><br><span class="line">      format = format.<span class="title function_">replace</span>(</span><br><span class="line">        <span class="title class_">RegExp</span>.<span class="property">$1</span>,</span><br><span class="line">        <span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="property">length</span> == <span class="number">1</span> ? o[k] : (<span class="string">&quot;00&quot;</span> + o[k]).<span class="title function_">substr</span>((<span class="string">&quot;&quot;</span> + o[k]).<span class="property">length</span>)</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> format;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getYearMonthDay</span>(<span class="params">date</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">format</span>(date || <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;yyyyMMdd&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getYearMonth</span>(<span class="params">date</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">format</span>(date || <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;yyyyMM&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getYearMonthDay</span>());</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getYearMonth</span>());</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getYearMonthDay</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">1999</span>, <span class="number">1</span>, <span class="number">3</span>)));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getYearMonth</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">1999</span>, <span class="number">1</span>, <span class="number">3</span>)));</span><br></pre></td></tr></table></figure>

<h2 id="身份证验证"><a href="#身份证验证" class="headerlink" title="身份证验证"></a>身份证验证</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> isIDCard = <span class="keyword">function</span>(<span class="params">str</span>) &#123;</span><br><span class="line">  <span class="comment">// 验证是否身份证号</span></span><br><span class="line">  <span class="keyword">var</span> city = &#123;</span><br><span class="line">    <span class="number">11</span>: <span class="string">&quot;北京&quot;</span>,</span><br><span class="line">    <span class="number">12</span>: <span class="string">&quot;天津&quot;</span>,</span><br><span class="line">    <span class="number">13</span>: <span class="string">&quot;河北&quot;</span>,</span><br><span class="line">    <span class="number">14</span>: <span class="string">&quot;山西&quot;</span>,</span><br><span class="line">    <span class="number">15</span>: <span class="string">&quot;内蒙古&quot;</span>,</span><br><span class="line">    <span class="number">21</span>: <span class="string">&quot;辽宁&quot;</span>,</span><br><span class="line">    <span class="number">22</span>: <span class="string">&quot;吉林&quot;</span>,</span><br><span class="line">    <span class="number">23</span>: <span class="string">&quot;黑龙江 &quot;</span>,</span><br><span class="line">    <span class="number">31</span>: <span class="string">&quot;上海&quot;</span>,</span><br><span class="line">    <span class="number">32</span>: <span class="string">&quot;江苏&quot;</span>,</span><br><span class="line">    <span class="number">33</span>: <span class="string">&quot;浙江&quot;</span>,</span><br><span class="line">    <span class="number">34</span>: <span class="string">&quot;安徽&quot;</span>,</span><br><span class="line">    <span class="number">35</span>: <span class="string">&quot;福建&quot;</span>,</span><br><span class="line">    <span class="number">36</span>: <span class="string">&quot;江西&quot;</span>,</span><br><span class="line">    <span class="number">37</span>: <span class="string">&quot;山东&quot;</span>,</span><br><span class="line">    <span class="number">41</span>: <span class="string">&quot;河南&quot;</span>,</span><br><span class="line">    <span class="number">42</span>: <span class="string">&quot;湖北 &quot;</span>,</span><br><span class="line">    <span class="number">43</span>: <span class="string">&quot;湖南&quot;</span>,</span><br><span class="line">    <span class="number">44</span>: <span class="string">&quot;广东&quot;</span>,</span><br><span class="line">    <span class="number">45</span>: <span class="string">&quot;广西&quot;</span>,</span><br><span class="line">    <span class="number">46</span>: <span class="string">&quot;海南&quot;</span>,</span><br><span class="line">    <span class="number">50</span>: <span class="string">&quot;重庆&quot;</span>,</span><br><span class="line">    <span class="number">51</span>: <span class="string">&quot;四川&quot;</span>,</span><br><span class="line">    <span class="number">52</span>: <span class="string">&quot;贵州&quot;</span>,</span><br><span class="line">    <span class="number">53</span>: <span class="string">&quot;云南&quot;</span>,</span><br><span class="line">    <span class="number">54</span>: <span class="string">&quot;西藏 &quot;</span>,</span><br><span class="line">    <span class="number">61</span>: <span class="string">&quot;陕西&quot;</span>,</span><br><span class="line">    <span class="number">62</span>: <span class="string">&quot;甘肃&quot;</span>,</span><br><span class="line">    <span class="number">63</span>: <span class="string">&quot;青海&quot;</span>,</span><br><span class="line">    <span class="number">64</span>: <span class="string">&quot;宁夏&quot;</span>,</span><br><span class="line">    <span class="number">65</span>: <span class="string">&quot;新疆&quot;</span>,</span><br><span class="line">    <span class="number">71</span>: <span class="string">&quot;台湾&quot;</span>,</span><br><span class="line">    <span class="number">81</span>: <span class="string">&quot;香港&quot;</span>,</span><br><span class="line">    <span class="number">82</span>: <span class="string">&quot;澳门&quot;</span>,</span><br><span class="line">    <span class="number">91</span>: <span class="string">&quot;国外&quot;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 基础验证，长度验证</span></span><br><span class="line">  <span class="keyword">if</span> (!str || !<span class="regexp">/^\d&#123;17&#125;(\d|x)$/i</span>.<span class="title function_">test</span>(str)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 验证地址编码</span></span><br><span class="line">  <span class="keyword">if</span> (!city[<span class="built_in">parseInt</span>(str.<span class="title function_">substr</span>(<span class="number">0</span>, <span class="number">2</span>))]) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 验证出生日期</span></span><br><span class="line">  <span class="keyword">var</span> birthdayStr =</span><br><span class="line">    str.<span class="title function_">substr</span>(<span class="number">6</span>, <span class="number">4</span>) + <span class="string">&quot;/&quot;</span> + str.<span class="title function_">substr</span>(<span class="number">10</span>, <span class="number">2</span>) + <span class="string">&quot;/&quot;</span> + str.<span class="title function_">substr</span>(<span class="number">12</span>, <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">var</span> birthday = <span class="keyword">new</span> <span class="title class_">Date</span>(birthdayStr);</span><br><span class="line">  <span class="keyword">if</span> (!birthday) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">var</span> transBirthdayStr =</span><br><span class="line">    birthday.<span class="title function_">getFullYear</span>() +</span><br><span class="line">    <span class="string">&quot;/&quot;</span> +</span><br><span class="line">    (birthday.<span class="title function_">getMonth</span>() &gt;= <span class="number">9</span></span><br><span class="line">      ? birthday.<span class="title function_">getMonth</span>() + <span class="number">1</span></span><br><span class="line">      : <span class="string">&quot;0&quot;</span> + (birthday.<span class="title function_">getMonth</span>() + <span class="number">1</span>)) +</span><br><span class="line">    <span class="string">&quot;/&quot;</span> +</span><br><span class="line">    (birthday.<span class="title function_">getDate</span>() &gt;= <span class="number">10</span> ? birthday.<span class="title function_">getDate</span>() : <span class="string">&quot;0&quot;</span> + birthday.<span class="title function_">getDate</span>());</span><br><span class="line">  <span class="keyword">if</span> (birthdayStr != transBirthdayStr) &#123;</span><br><span class="line">    <span class="comment">// 日期有误</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 验证长度和校验位</span></span><br><span class="line">  <span class="keyword">if</span> (str.<span class="property">length</span> == <span class="number">18</span>) &#123;</span><br><span class="line">    str = str.<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">//∑(ai×Wi)(mod 11)</span></span><br><span class="line">    <span class="comment">//加权因子</span></span><br><span class="line">    <span class="keyword">var</span> factor = [<span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>];</span><br><span class="line">    <span class="comment">//校验位</span></span><br><span class="line">    <span class="keyword">var</span> parity = [<span class="number">1</span>, <span class="number">0</span>, <span class="string">&quot;X&quot;</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> ai = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> wi = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">17</span>; i++) &#123;</span><br><span class="line">      ai = str[i];</span><br><span class="line">      wi = factor[i];</span><br><span class="line">      sum += ai * wi;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> last = parity[sum % <span class="number">11</span>];</span><br><span class="line">    <span class="keyword">if</span> (parity[sum % <span class="number">11</span>] != str[<span class="number">17</span>].<span class="title function_">toUpperCase</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="设定参数必须传递"><a href="#设定参数必须传递" class="headerlink" title="设定参数必须传递"></a><a href="http://es6.ruanyifeng.com/#docs/function#%E5%BA%94%E7%94%A8">设定参数必须传递</a></h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throwIfMissing</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Missing parameter&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">mustBeProvided = throwIfMissing()</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> mustBeProvided;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>();</span><br><span class="line"><span class="comment">// Error: Missing parameter</span></span><br></pre></td></tr></table></figure>

<h2 id="为浮点数运算部署一个误差检查函数"><a href="#为浮点数运算部署一个误差检查函数" class="headerlink" title="为浮点数运算部署一个误差检查函数"></a><a href="http://es6.ruanyifeng.com/#docs/number#Number-EPSILON">为浮点数运算部署一个误差检查函数</a></h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">withinErrorMargin</span>(<span class="params">left, right</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">abs</span>(left - right) &lt; <span class="title class_">Number</span>.<span class="property">EPSILON</span> * <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">0.1</span> + <span class="number">0.2</span> === <span class="number">0.3</span>; <span class="comment">// false</span></span><br><span class="line"><span class="title function_">withinErrorMargin</span>(<span class="number">0.1</span> + <span class="number">0.2</span>, <span class="number">0.3</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.1</span> + <span class="number">1.3</span> === <span class="number">2.4</span>; <span class="comment">// false</span></span><br><span class="line"><span class="title function_">withinErrorMargin</span>(<span class="number">1.1</span> + <span class="number">1.3</span>, <span class="number">2.4</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="正确返回字符串长度的函数（Unicode-字符）"><a href="#正确返回字符串长度的函数（Unicode-字符）" class="headerlink" title="正确返回字符串长度的函数（Unicode 字符）"></a><a href="http://es6.ruanyifeng.com/#docs/regex#u-%E4%BF%AE%E9%A5%B0%E7%AC%A6">正确返回字符串长度的函数（Unicode 字符）</a></h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">codePointLength</span>(<span class="params">text</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> result = text.<span class="title function_">match</span>(<span class="regexp">/[\s\S]/gu</span>);</span><br><span class="line">  <span class="keyword">return</span> result ? result.<span class="property">length</span> : <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = <span class="string">&quot;𠮷𠮷&quot;</span>;</span><br><span class="line"></span><br><span class="line">s.<span class="property">length</span>; <span class="comment">// 4</span></span><br><span class="line"><span class="title function_">codePointLength</span>(s); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<h2 id="apply-amp-call"><a href="#apply-amp-call" class="headerlink" title="apply &amp; call"></a>apply &amp; call</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123; <span class="attr">x</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> b = &#123; <span class="attr">x</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">x</span>);</span><br><span class="line">&#125;</span><br><span class="line">a.<span class="property">f</span> = f;</span><br><span class="line">b.<span class="property">f</span> = f;</span><br><span class="line">f.<span class="title function_">apply</span>(a); <span class="comment">//1</span></span><br><span class="line">f.<span class="title function_">apply</span>(b); <span class="comment">//2</span></span><br></pre></td></tr></table></figure>

<h2 id="返回对象的类"><a href="#返回对象的类" class="headerlink" title="返回对象的类"></a>返回对象的类</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// p214</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">classof</span>(<span class="params">o</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o).<span class="title function_">slice</span>(<span class="number">8</span>, -<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="输出对象的类：Object-prototype-toString-call"><a href="#输出对象的类：Object-prototype-toString-call" class="headerlink" title="输出对象的类：Object.prototype.toString.call"></a>输出对象的类：Object.prototype.toString.call</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="number">1</span>);</span><br><span class="line">(<span class="string">&quot;[object Number]&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;);</span><br><span class="line">(<span class="string">&quot;[object Function]&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>typeof 得到的是类型；</p>
<h2 id="How-to-pass-url-query-params"><a href="#How-to-pass-url-query-params" class="headerlink" title="How to pass url query params"></a><a href="https://github.com/github/fetch/issues/256">How to pass url query params</a></h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getUrl</span>(<span class="params">url, options</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isEmptyObject</span>(options)) &#123;</span><br><span class="line">    url += (url.<span class="title function_">indexOf</span>(<span class="string">&quot;?&quot;</span>) === -<span class="number">1</span> ? <span class="string">&quot;?&quot;</span> : <span class="string">&quot;&amp;&quot;</span>) + <span class="title function_">queryParams</span>(options);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">queryParams</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(params)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">k</span> =&gt;</span> <span class="built_in">encodeURIComponent</span>(k) + <span class="string">&quot;=&quot;</span> + <span class="built_in">encodeURIComponent</span>(params[k]))</span><br><span class="line">    .<span class="title function_">join</span>(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断对象是否为空 https://stackoverflow.com/questions/4994201/is-object-empty</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isEmptyObject</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">if</span> (obj.<span class="property">length</span> &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (obj.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj != <span class="string">&quot;object&quot;</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.<span class="title function_">hasOwnProperty</span>(name)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> url = <span class="title function_">getUrl</span>(<span class="string">&quot;http://lyloou.com&quot;</span>, &#123;&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(url);</span><br></pre></td></tr></table></figure>

<h2 id="对象转数组"><a href="#对象转数组" class="headerlink" title="对象转数组"></a>对象转数组</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">json2array = <span class="keyword">function</span>(<span class="params">json</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> result = [];</span><br><span class="line">  <span class="keyword">let</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(json);</span><br><span class="line">  keys.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    result.<span class="title function_">push</span>(json[key]);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">arr2Obj = <span class="keyword">function</span>(<span class="params">array</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> array == <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> array) &#123;</span><br><span class="line">      <span class="keyword">var</span> thisEle = <span class="title function_">convArrToObj</span>(array[i]);</span><br><span class="line">      obj[i] = thisEle;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    obj = array;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="输入银行卡号，4-位自动加上空格分隔"><a href="#输入银行卡号，4-位自动加上空格分隔" class="headerlink" title="输入银行卡号，4 位自动加上空格分隔"></a>输入银行卡号，4 位自动加上空格分隔</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;test&quot;</span>).<span class="property">onkeyup</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">value</span></span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">replace</span>(<span class="regexp">/\s/g</span>, <span class="string">&quot;&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">replace</span>(<span class="regexp">/\D/g</span>, <span class="string">&quot;&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">            .<span class="title function_">replace</span>(<span class="regexp">/(\d&#123;4&#125;)(?=\d)/g</span>, <span class="string">&quot;$1 &quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在前台读取数字时自动忽略空格</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这样的话会把a b c d读取为abc</span></span><br><span class="line"><span class="title class_">String</span> newStr = <span class="string">&quot;a b c&quot;</span>.<span class="title function_">replaceAll</span>(<span class="string">&quot; &quot;</span>,<span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://blog.csdn.net/happy_jijiawei/article/details/22850839">JS 控制文本框：输入银行卡号，4 位自动加上空格分隔 - 别在熬夜了！ - CSDN 博客</a></li>
</ul>
<h2 id="正则摘取文字"><a href="#正则摘取文字" class="headerlink" title="正则摘取文字"></a>正则摘取文字</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// var input = &quot;&#x27;Warehouse&#x27;,&#x27;Local Release&#x27;,&#x27;Local Release DA&#x27;&quot;;</span></span><br><span class="line"><span class="keyword">var</span> input =</span><br><span class="line">  <span class="string">&#x27;【丝路亚心】250gX4&lt;font color=&quot;red&quot;&gt;核桃仁&lt;/font&gt; 原味生&lt;font color=&quot;red&quot;&gt;核桃核桃仁&lt;/font&gt; 新疆特产, &lt;font color=&quot;red&quot;&gt;123445&lt;/font&gt;bcdef&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/&lt;font[^&gt;]+?&gt;(.*?)&lt;\/font&gt;/g</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> matches,</span><br><span class="line">  output = [];</span><br><span class="line"><span class="keyword">while</span> ((matches = regex.<span class="title function_">exec</span>(input))) &#123;</span><br><span class="line">  output.<span class="title function_">push</span>(matches[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(matches);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(output);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">replaceText</span>(<span class="params">text</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> text.<span class="title function_">replace</span>(<span class="regexp">/&lt;font[^&gt;]*&gt;/g</span>, <span class="string">&quot;&quot;</span>).<span class="title function_">replace</span>(<span class="regexp">/&lt;\/font&gt;/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> newStr = <span class="title function_">replaceText</span>(input);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newStr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> output) &#123;</span><br><span class="line">  <span class="keyword">let</span> val = output[i];</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(val);</span><br><span class="line">  <span class="keyword">let</span> index = newStr.<span class="title function_">indexOf</span>(val);</span><br><span class="line">  arr.<span class="title function_">push</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;normal&quot;</span>, <span class="attr">value</span>: newStr.<span class="title function_">substring</span>(<span class="number">0</span>, index) &#125;);</span><br><span class="line">  arr.<span class="title function_">push</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;highlight&quot;</span>, <span class="attr">value</span>: val &#125;);</span><br><span class="line">  newStr = newStr.<span class="title function_">substring</span>(index + val.<span class="property">length</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (newStr) &#123;</span><br><span class="line">  arr.<span class="title function_">push</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;normal&quot;</span>, <span class="attr">value</span>: newStr &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr);</span><br><span class="line"><span class="comment">// [&#123;&quot;type&quot;:&quot;normal&quot;,&quot;value&quot;:&quot;【丝路亚心】250gX4&quot;&#125;,&#123;&quot;type&quot;:&quot;highlight&quot;,&quot;value&quot;:&quot;核桃仁&quot;&#125;,&#123;&quot;type&quot;:&quot;normal&quot;,&quot;value&quot;:&quot; 原味生&quot;&#125;,&#123;&quot;type&quot;:&quot;highlight&quot;,&quot;value&quot;:&quot;核桃核桃仁&quot;&#125;,&#123;&quot;type&quot;:&quot;normal&quot;,&quot;value&quot;:&quot; 新疆特产, &quot;&#125;,&#123;&quot;type&quot;:&quot;highlight&quot;,&quot;value&quot;:&quot;123445&quot;&#125;,&#123;&quot;type&quot;:&quot;normal&quot;,&quot;value&quot;:&quot;bcdef&quot;&#125;]</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Js坑</title>
    <url>/js/js%E5%9D%91/</url>
    <content><![CDATA[<h2 id="使用for-in-循环Object会有个问题，会loop来自prototype的属性，使用的时候要小心；"><a href="#使用for-in-循环Object会有个问题，会loop来自prototype的属性，使用的时候要小心；" class="headerlink" title="使用for in 循环Object会有个问题，会loop来自prototype的属性，使用的时候要小心；"></a>使用for in 循环Object会有个问题，会loop来自prototype的属性，使用的时候要小心；</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> validation_messages) &#123;</span><br><span class="line">    <span class="comment">// skip loop if the property is from prototype</span></span><br><span class="line">    <span class="keyword">if</span> (!validation_messages.<span class="title function_">hasOwnProperty</span>(key)) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> obj = validation_messages[key];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> prop <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="comment">// skip loop if the property is from prototype</span></span><br><span class="line">        <span class="keyword">if</span>(!obj.<span class="title function_">hasOwnProperty</span>(prop)) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// your code</span></span><br><span class="line">        <span class="title function_">alert</span>(prop + <span class="string">&quot; = &quot;</span> + obj[prop]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">first</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  <span class="attr">last</span>: <span class="string">&quot;Doe&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	Visit non-inherited enumerable keys</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">key</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(key, obj[key]);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://stackoverflow.com/questions/921789/how-to-loop-through-a-plain-javascript-object-with-the-objects-as-members">https://stackoverflow.com/questions/921789/how-to-loop-through-a-plain-javascript-object-with-the-objects-as-members</a></p>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Node相关</title>
    <url>/js/node/</url>
    <content><![CDATA[<p>| crypto模块：提供通用的加密和哈希算法。</p>
<p>| 服务器案例（模块http、path、fs的运用）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>(<span class="keyword">function</span>(<span class="params">request, response</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> workDir = path.<span class="title function_">resolve</span>(<span class="string">&quot;.&quot;</span>); <span class="comment">// 获取当前目录</span></span><br><span class="line">  <span class="keyword">var</span> filepath = path.<span class="title function_">join</span>(workDir, <span class="string">&quot;showdate.html&quot;</span>); <span class="comment">// 定位showdate.html文件</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将本地的文件作为响应返回</span></span><br><span class="line">  response.<span class="title function_">writeHead</span>(<span class="number">200</span>);</span><br><span class="line">  fs.<span class="title function_">createReadStream</span>(filepath).<span class="title function_">pipe</span>(response);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务已开启，请登录：http://localhost:3000&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>| pipe</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> rs = fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;hello.js&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> ws = fs.<span class="title function_">createWriteStream</span>(<span class="string">&quot;copy.js&quot;</span>);</span><br><span class="line">rs.<span class="title function_">pipe</span>(ws);</span><br></pre></td></tr></table></figure>

<p>| stream 是node.js提供的仅在服务端可用的模块；<br>基于事件的、异步的方式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> rs = fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;hello.js&quot;</span>, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">rs.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, f);</span><br><span class="line">rs.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, f);</span><br><span class="line">rs.<span class="title function_">on</span>(<span class="string">&quot;error&quot;</span>, f);</span><br></pre></td></tr></table></figure>

<p>| 同步的写文件：<code>fs.writeFileSync()</code>；</p>
<p>| 写文件：<code>fs.writeFile(&quot;output.txt&quot;, data, function(x)&#123;&#125;)</code>，如果data是String，默认<br>  编码是UTF-8；如果传入的是Buffer，则写入的是二进制文件；回调函数只关心成功与否。</p>
<p>| 同步读文件使用<code>fs.readFileSync()</code>方法，不接受回调函数，函数直接返回结果。<br>通过<code>try...catch</code>来捕获同步获取文件时的错误。</p>
<p>| <code>Buffer</code>对象可以和String做转换：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Buffer -&gt; String</span></span><br><span class="line"><span class="keyword">var</span> text = data.<span class="title function_">toString</span>(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(text);</span><br><span class="line"><span class="comment">// String -&gt; Buffer</span></span><br><span class="line"><span class="keyword">var</span> buf = <span class="keyword">new</span> <span class="title class_">Buffer</span>(text, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf);</span><br></pre></td></tr></table></figure>

<p>| fs模块</p>
<ul>
<li>读取文件编码是<code>utf-8</code>的文件；<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&quot;hello.js&quot;</span>, <span class="string">&quot;utf-8&quot;</span>, <span class="variable language_">console</span>.<span class="property">log</span>);</span><br></pre></td></tr></table></figure></li>
<li>读取二进制文件，不传入文件编码，回调函数将返回一个Buffer对象。<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&quot;hello.js&quot;</span>, <span class="variable language_">console</span>.<span class="property">log</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<p>| 在需要使用回调函数的地方，传入<code>console.log</code>，可以打印出回调函数的参数信息。</p>
<p>| 建议始终使用<code>module.exports</code>的方式，而不是省写的<code>exports</code>；</p>
<p>| 如果要输出一个键值对象<code>&#123;&#125;</code>，可以利用<code>exports</code>这个已经存在的空对象<code>&#123;&#125;</code>，<br>  并继续在上面添加新的键值；</p>
<blockquote>
<p>var exported = load(module.exports, module);<br>  因为对exports重新赋值，对module.exports没有任何副作用。</p>
</blockquote>
<p>如果要输出一个函数或数组，必须直接对<code>module.exports</code>对象赋值；</p>
<p>| 实现“模块”功能的奥妙就在于JavaScript是一种函数式编程语言，它支持闭包。</p>
<p>| 引入的对象具体是什么，取决于引用模块输出的变量。（输出的变量可以是任意对象、函数、数组等等）</p>
<p>| 一个模块想要对外暴露变量（函数也是变量），可以用<code>module.exports = variable;</code>；<br>  一个模块想要引用其他模块暴露的变量，用<code>var ref = require(&#39;module_name&#39;)</code>就拿到了引用模块变量；</p>
<p>| 使用模块的好处：</p>
<ul>
<li>提高了代码的可维护性；</li>
<li>代码重用；</li>
<li>避免了函数名和变量名冲突；</li>
</ul>
<p>| 在Node环境中，一个.js文件就称之为一个模块（module）。</p>
<p>| 让node直接为所有js文件都开启严格模式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">node --use_strict myFile.<span class="property">js</span></span><br></pre></td></tr></table></figure>


<p><a href="http://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000">http://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000</a></p>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Npm-Package</title>
    <url>/js/npm-package.json/</url>
    <content><![CDATA[<h2 id="package-json：The-difference-between-devDependencies-and-dependencies"><a href="#package-json：The-difference-between-devDependencies-and-dependencies" class="headerlink" title="package.json：The difference between devDependencies and dependencies"></a>package.json：The difference between devDependencies and dependencies</h2><blockquote>
<p>If someone is planning on downloading and using your module in their program,<br> then they probably don’t want or need to download and build the external test<br> or documentation framework that you use. In this case,<br> it’s best to list these additional items in a devDependencies hash.</p>
</blockquote>
<ul>
<li><a href="https://blog.csdn.net/u011240877/article/details/76582670">npm 与 package.json 快速入门教程</a></li>
<li><a href="http://javascript.ruanyifeng.com/nodejs/packagejson.html">package.json文件 – JavaScript 标准参考教程（alpha）</a></li>
</ul>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Js中的常见问题</title>
    <url>/js/qa/</url>
    <content><![CDATA[<h1 id="通过var拿到到对象的属性后，能直接删除它吗？（而不是通过类似a-b-的方式）"><a href="#通过var拿到到对象的属性后，能直接删除它吗？（而不是通过类似a-b-的方式）" class="headerlink" title="通过var拿到到对象的属性后，能直接删除它吗？（而不是通过类似a[b]的方式）"></a>通过var拿到到对象的属性后，能直接删除它吗？（而不是通过类似<code>a[b]</code>的方式）</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">a=&#123;</span><br><span class="line">    <span class="attr">b</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="attr">c</span>:<span class="number">2</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">delete</span> a[<span class="string">&#x27;b&#x27;</span>]; <span class="comment">// ok，返回true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> k = a[b]; </span><br><span class="line"><span class="keyword">delete</span> k; <span class="comment">// 这样是不行，《JavaScript权威指南》p89中这样说：不能删除通过var声明的变量，返回false</span></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Node配置</title>
    <url>/js/node%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="国内优秀npm镜像推荐及使用"><a href="#国内优秀npm镜像推荐及使用" class="headerlink" title="国内优秀npm镜像推荐及使用"></a><a href="http://riny.net/2014/cnpm/">国内优秀npm镜像推荐及使用</a></h2><p>淘宝npm镜像</p>
<ul>
<li>搜索地址：<a href="http://npm.taobao.org/">http://npm.taobao.org/</a></li>
<li>registry地址：<a href="http://registry.npm.taobao.org/">http://registry.npm.taobao.org/</a><br>cnpmjs镜像</li>
<li>搜索地址：<a href="http://cnpmjs.org/">http://cnpmjs.org/</a></li>
<li>registry地址：<a href="http://r.cnpmjs.org/">http://r.cnpmjs.org/</a></li>
</ul>
<h3 id="临时使用"><a href="#临时使用" class="headerlink" title="临时使用"></a>临时使用</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm --registry https://registry.npm.taobao.org install express</span><br></pre></td></tr></table></figure>
<h3 id="持久使用"><a href="#持久使用" class="headerlink" title="持久使用"></a>持久使用</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">// 配置后可通过下面方式来验证是否成功</span><br><span class="line">npm config get registry</span><br><span class="line">// 或</span><br><span class="line">npm info express</span><br></pre></td></tr></table></figure>
<h3 id="通过cnpm使用"><a href="#通过cnpm使用" class="headerlink" title="通过cnpm使用"></a>通过cnpm使用</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">// 使用</span><br><span class="line">cnpm install express</span><br></pre></td></tr></table></figure>




<h2 id="https-blog-niceue-com-front-end-development-using-domestic-npm-images-html"><a href="#https-blog-niceue-com-front-end-development-using-domestic-npm-images-html" class="headerlink" title="https://blog.niceue.com/front-end-development/using-domestic-npm-images.html"></a><a href="https://blog.niceue.com/front-end-development/using-domestic-npm-images.html">https://blog.niceue.com/front-end-development/using-domestic-npm-images.html</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置 registry</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://r.cnpmjs.org/</span><br><span class="line"><span class="comment"># 验证配置是否修改成功</span></span><br><span class="line">npm config get registry</span><br></pre></td></tr></table></figure>

<h2 id="npm-install"><a href="#npm-install" class="headerlink" title="npm install"></a>npm install</h2><blockquote>
<p>If you have a package.json file in your directory and you run npm install,<br>then npm will look at the dependencies that are listed in that file and<br>download the latest versions satisfying semver rules for all of those.<br><a href="https://docs.npmjs.com/getting-started/using-a-package.json">https://docs.npmjs.com/getting-started/using-a-package.json</a></p>
</blockquote>
<h2 id="修改npm-install-g-的安装目录"><a href="#修改npm-install-g-的安装目录" class="headerlink" title="修改npm install -g 的安装目录"></a>修改<code>npm install -g</code> 的安装目录</h2><p>查看： <code>npm root -g</code><br>修改：在配置文件中 <code>.npmrc</code> 中添加，<code>prefix = &quot;D:\\c\\nodejs\\node_modules\\npm&quot;</code></p>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>【RN】相关</title>
    <url>/js/rn/</url>
    <content><![CDATA[<h2 id="run-from-android"><a href="#run-from-android" class="headerlink" title="run from android"></a>run from android</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">C:\Users\Administrator\AppData\Roaming\npm</span><br><span class="line"></span><br><span class="line">react-native bundle --platform android --dev <span class="literal">false</span> --entry-file App.js --bundle-output android/app/src/main/assets/index.android.bundle --assets-dest android/app/src/main/res</span><br><span class="line"></span><br><span class="line">react-native run-android</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://stackoverflow.com/questions/44446523/unable-to-load-script-from-assets-index-android-bundle-on-windows">react native - Unable to load script from assets index.android.bundle on windows - Stack Overflow</a></li>
</ul>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue相关</title>
    <url>/js/vue/</url>
    <content><![CDATA[<h2 id="官方文档：https-cn-vuejs-org"><a href="#官方文档：https-cn-vuejs-org" class="headerlink" title="官方文档：https://cn.vuejs.org"></a>官方文档：<a href="https://cn.vuejs.org/">https://cn.vuejs.org</a></h2><h2 id="Uploading-Files-With-VueJS-and-Axios"><a href="#Uploading-Files-With-VueJS-and-Axios" class="headerlink" title="Uploading Files With VueJS and Axios"></a><a href="https://serversideup.net/uploading-files-vuejs-axios/">Uploading Files With VueJS and Axios</a></h2><h2 id="读懂原理："><a href="#读懂原理：" class="headerlink" title="读懂原理："></a>读懂原理：</h2><ul>
<li><a href="http://www.cnblogs.com/keepfool/p/5619070.html">Vue.js——60分钟快速入门 - keepfool - 博客园</a></li>
<li><a href="http://www.cnblogs.com/keepfool/p/5625583.html">Vue.js——60分钟组件快速入门（上篇） - keepfool - 博客园</a></li>
<li><a href="http://www.cnblogs.com/keepfool/p/5637834.html">Vue.js——60分钟组件快速入门（下篇） - keepfool - 博客园</a></li>
<li><a href="http://www.cnblogs.com/keepfool/p/5678427.html">Vue.js——60分钟webpack项目模板快速入门 - keepfool - 博客园</a></li>
<li><a href="http://www.cnblogs.com/keepfool/p/5690366.html">Vue.js——vue-router 60分钟快速入门 - keepfool - 博客园</a></li>
</ul>
<h2 id="视频教程：vue-js入门教程"><a href="#视频教程：vue-js入门教程" class="headerlink" title="视频教程：vue.js入门教程"></a>视频教程：<a href="http://www.imooc.com/learn/694">vue.js入门教程</a></h2><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul>
<li>webpack结合vue的时候，less中的元素重名会导致渲染错误。可以通过添加前缀来区别：<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.a</span>&#123;</span><br><span class="line">    <span class="selector-class">.container</span> &#123;</span><br><span class="line">        <span class="attribute">background</span>:<span class="number">#fff</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.nihao</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>:<span class="number">#2f0</span>;</span><br><span class="line">        <span class="attribute">background</span>:<span class="number">#c38</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.b</span>&#123;</span><br><span class="line">    <span class="selector-class">.container</span> &#123;</span><br><span class="line">        <span class="attribute">background</span>:<span class="number">#000</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.nihao</span> &#123;</span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="通过scoped来避免全局污染"><a href="#通过scoped来避免全局污染" class="headerlink" title="通过scoped来避免全局污染"></a>通过<code>scoped</code>来避免全局污染</h2><figure class="highlight less"><table><tr><td class="code"><pre><span class="line">&lt;<span class="selector-tag">style</span> <span class="selector-tag">lang</span>=&quot;<span class="selector-tag">less</span>&quot; <span class="selector-tag">scoped</span>&gt;</span><br><span class="line">  @<span class="selector-tag">import</span> &quot;../../<span class="selector-tag">styles</span>/<span class="selector-tag">product-list</span><span class="selector-class">.less</span>&quot;;</span><br><span class="line">&lt;/<span class="selector-tag">style</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Vue-固定滚动位置的处理办法-前端-掘金"><a href="#Vue-固定滚动位置的处理办法-前端-掘金" class="headerlink" title="Vue 固定滚动位置的处理办法. - 前端 - 掘金"></a><a href="https://juejin.im/entry/5966372251882568d546f51d">Vue 固定滚动位置的处理办法. - 前端 - 掘金</a></h2>]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Webpack相关</title>
    <url>/js/webpack/</url>
    <content><![CDATA[<ul>
<li><a href="http://www.cnblogs.com/keepfool/p/5678427.html">Vue.js——60分钟webpack项目模板快速入门 - keepfool - 博客园</a><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用vue-webpack-simple模板</span></span><br><span class="line">vue init webpack-simple my-webpack-simple-demo <span class="comment"># webpack-simple是项目模板的名称，my-webpack-simple-demo是你要生成的项目名称。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> my-webpack-simple-demo</span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">npm run dev</span><br><span class="line"></span><br><span class="line">npm run build</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用vue-webpack模板</span></span><br><span class="line">vue init webpack my-webpack-demo <span class="comment"># webpack是项目模板，my-webpack-demo是项目名称。</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> my-webpack-demo</span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">npm run dev</span><br><span class="line"></span><br><span class="line">npm run build <span class="comment"># 发布</span></span><br></pre></td></tr></table></figure>


<ul>
<li>视频教程：<a href="http://www.imooc.com/learn/802">webpack深入与实战</a></li>
</ul>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Weex</title>
    <url>/js/weex/</url>
    <content><![CDATA[<h2 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h2><ul>
<li>官网：<a href="https://weex.incubator.apache.org/cn/guide/">快速上手 | Weex</a></li>
<li>示例：<a href="https://hanks10100.github.io/weex-vue-examples/">weex-vue-examples</a></li>
<li>源码：<a href="https://github.com/apache/incubator-weex">incubator-weex</a></li>
<li><a href="https://alibaba.github.io/weex-ui/#/?id=weex-ui">Weex Ui</a></li>
</ul>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><ul>
<li><a href="https://github.com/w11p3333/weex-start-kit">weex-start-kit</a></li>
<li><a href="https://github.com/CarGuo/GSYGithubAppWeex">GSYGithubAppWeex</a></li>
</ul>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="可能是史上最全的weex踩坑攻略"><a href="#可能是史上最全的weex踩坑攻略" class="headerlink" title="可能是史上最全的weex踩坑攻略"></a><a href="https://www.jianshu.com/p/497f1a9ff33f">可能是史上最全的weex踩坑攻略</a></h3><h3 id="WEEX-使用navigator跳转Android系统出现ActivityNotFoundException报错"><a href="#WEEX-使用navigator跳转Android系统出现ActivityNotFoundException报错" class="headerlink" title="WEEX 使用navigator跳转Android系统出现ActivityNotFoundException报错"></a><a href="https://blog.csdn.net/violetjack0808/article/details/74390249">WEEX 使用navigator跳转Android系统出现ActivityNotFoundException报错</a></h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:name</span>=<span class="string">&quot;.WXPageActivity&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme.NoActionBar&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.taobao.android.intent.action.WEEX&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;com.taobao.android.intent.category.WEEX&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.VIEW&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">&quot;http&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">&quot;https&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">&quot;wxpage&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">navUrl</span> <span class="operator">=</span> getIntent().getData().toString();</span><br></pre></td></tr></table></figure>

<p>分析模板代码（如下面所示）：<br>我们需要一个<code>mContainer</code>来容纳已经渲染过的<code>wxview</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- activity_wxpage.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/container&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;#ffffff&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// AbsWeexActivity.java</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onViewCreated</span><span class="params">(WXSDKInstance wxsdkInstance, View view)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mContainer != <span class="literal">null</span>) &#123;</span><br><span class="line">        mContainer.removeAllViews();</span><br><span class="line">        mContainer.addView(view); <span class="comment">// mContainer是用来容纳wxview的viewgroup</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>《JavaScript权威指南》笔记</title>
    <url>/js/%E3%80%8AJavaScript%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<blockquote>
<p>注：笔记是倒序排列的。</p>
</blockquote>
<p>| node的helloworld程序：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//! program.js</span></span><br><span class="line"><span class="comment">// 通过在命令行输入`node program.js`来运行，然后在浏览器中打开网址`127.0.0.1:8080`来访问</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = <span class="keyword">new</span> http.<span class="title class_">Server</span>();</span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">8080</span>);</span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="keyword">function</span>(<span class="params">request, response</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(request.<span class="property">url</span>); <span class="comment">//打印请求网址</span></span><br><span class="line">  response.<span class="title function_">write</span>(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">  response.<span class="title function_">end</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>| Rhino，一种用Java编写的JavaScript解释器。在<a href="https://github.com/mozilla/rhino">mozilla/rhino: Rhino is an open-source implementation of JavaScript written entirely in Java</a>中具体研究。</p>
<p>| Web浏览器之外的两种运行环境</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Projects/Rhino/Download_Rhino">下载 Rhino - Mozilla 产品与私有技术 | MDN</a></li>
<li>node</li>
</ul>
<h2 id="第十二章：服务器端JavaScript"><a href="#第十二章：服务器端JavaScript" class="headerlink" title="第十二章：服务器端JavaScript"></a>第十二章：服务器端JavaScript</h2><p>| 解构赋值右侧的数组所包含的元素不必和左侧的变量一一对应，左侧多余的变量的赋值为<code>undefined</code>，右侧多于的值则会被忽略。左侧的变量列表可以包含连续的逗号用以跳过右侧对应的值。–p275</p>
<p>| 通过var声明的变量在函数内都是可用的，而通过let声明的变量则只属于就近的花括号括起来的语句块。–p272</p>
<h2 id="第十一章：JavaScript的子集和扩展"><a href="#第十一章：JavaScript的子集和扩展" class="headerlink" title="第十一章：JavaScript的子集和扩展"></a>第十一章：JavaScript的子集和扩展</h2><p>| RegExp方法</p>
<ul>
<li><code>exec()</code>：exec()方法对一个指定的字符串执行一个正则表达式。lastIndex属性会在设置了<code>g</code>修饰符后起作用。 –p264 –p265</li>
<li><code>test(字符串)</code>：对字符串进行检测，如果包含有一个匹配，则返回true；</li>
</ul>
<p>| String支持4种正则表达式用法。–p262</p>
<ul>
<li>String.search(/正则/); 如果参数不是正则，则通过RegExp构造正则对象；</li>
<li>String.replace(/正则/, “代替换文本”); 如果第一个参数是字符串，则直接搜索该字符串而不是构造成正则表达式。第二个参数可以是函数，该函数能够动态地计算替换字符串；</li>
<li>String.match(/正则/); 最常用的正则方法；</li>
<li>String.split(/正则/); 参数可以是字符串也可以是正则；</li>
</ul>
<p>| 正则表达式修饰符：出现在第二条斜线之外的字符。 –p261</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">i</span> 不区分大小写</span><br><span class="line">g 全局匹配</span><br><span class="line">m 多行模式的匹配</span><br></pre></td></tr></table></figure>

<p>| 锚字符：–p261</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">^ 匹配字符串开头</span><br><span class="line"><span class="variable">$ </span>匹配字符串结尾</span><br><span class="line">\b 匹配单词的边界</span><br><span class="line">\B 匹配非单词边界</span><br><span class="line">(<span class="string">?=</span>p) 零宽正向先行断言，要求接下来字符都与p匹配</span><br><span class="line">(<span class="string">?!</span>p) 零宽负向先行断言，要求接下来字符不与p匹配</span><br></pre></td></tr></table></figure>

<p>| 非贪婪匹配（尽可能少地匹配）：在匹配的字符后跟随一个问号。–p257</p>
<p>| 重复：–p257</p>
<figure class="highlight excel"><table><tr><td class="code"><pre><span class="line">&#123;<span class="built_in">n</span>, m&#125; （至少<span class="built_in">n</span>次，不能超过m次）</span><br><span class="line">&#123;<span class="built_in">n</span>, &#125; （匹配前一项<span class="built_in">n</span>次到多次）</span><br><span class="line">&#123;<span class="built_in">n</span>&#125; 匹配前一项<span class="built_in">n</span>次</span><br><span class="line">? <span class="number">0</span>次或多次</span><br><span class="line">+ <span class="number">1</span>次或多次</span><br><span class="line">* <span class="number">0</span>次或多次</span><br></pre></td></tr></table></figure>

<p>| 字符类：将直接量字符单独放进方括号<code>[]</code>内就组成了字符类。 –p256</p>
<p>| 在正则表达式中，具有特殊含义的标点符号：–p255</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">^ $ . * + ? = ! : | \ / ( ) [ ] &#123; &#125;</span><br></pre></td></tr></table></figure>

<p>| ECMAScript 5 规范做了同ECMAScript 3相反的规定，同一段代码所表示的正则表达式直接量的每次运算都返回新的对象。–p254</p>
<p>| 创建正则表达式：</p>
<ul>
<li>使用<code>RegExp()</code>构造函数来创建；</li>
<li>使用正则表达式直接量语法（包含在一对斜杠之间的字符）；</li>
</ul>
<h2 id="第十章：正则表达式"><a href="#第十章：正则表达式" class="headerlink" title="第十章：正则表达式"></a>第十章：正则表达式</h2><p>| 模块，导出API：</p>
<ol>
<li>返回构造函数； –p251</li>
<li>通过new来直接调用模块函数； –p252</li>
<li>框架提供的导出模块API方法； –p252</li>
</ol>
<p>| 模块化，实现代码的重用。–p248</p>
<p>| 锁定原型对象的一个使用场合：阻止枚举类型<code>enumeration()</code>属性的变化（修改和删除）。在<code>Object.freeze()</code>方法调用之前所做的设置都是生效可用的。 –p244</p>
<p>| <code>Object.freeze()</code>和<code>Object.seal</code>的功能一样，都会把对象的属性设置为只读和不可配置的。–p244</p>
<p>| <code>Object.defineProperty()</code>和<code>Object.defineProperties()</code>可以用来创建新特性，也可以用来修改已有属性的特性。 –p242</p>
<p>| ECMAScript 5给对象的扩展性增加了限制（方法支持：setter、getter、可枚举性、可写性、可配置性），其新特性使类更加健壮。 –p239</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>();</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperties</span>();</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">seal</span>();</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">preventExtensions</span>();</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">create</span>();</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">freeze</span>();</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>();</span><br></pre></td></tr></table></figure>


<p>| <code>var str = JSON.stringify(o);</code>将对象转化为json字符串，<br><code>JSON.parse(str)</code>，将字符串转化为对象，但是该对象不具有和o对象相同的继承结构。 –p222</p>
<p>| 鸭式辨型不能应用于内置类，比如不能通过<code>quacks(o, Array)</code>来检测o是否实现了Array中的所有同名方法。原因是内置类的方法都是不可枚举的（for/in操作无法遍历）。–p217</p>
<p>| 在JavaScript中，类的实现是基于其原型继承机制的。–p201</p>
<h2 id="第九章：类和模块"><a href="#第九章：类和模块" class="headerlink" title="第九章：类和模块"></a>第九章：类和模块</h2><p>| 需要给<code>f()</code>传入一个参数，所以使用<code>f()</code>的<code> ()</code>方法；<br>  需要给<code>g()</code>传入多个参数，所以使用<code>g()</code>的<code>apply()</code>方法； –p197 –p189</p>
<p>| 可以通过<code>new Function()</code>构造方法的方式来定义函数（另外两种定义方式：1.函数定义语句；2. 函数直接量表达式）。<code>Function</code>构造函数创建的是一个匿名函数，不需要指定函数名。–p192</p>
<p>| 书写闭包的时候还需要注意一件事，this是JavaScript的关键字，而不是变量。</p>
<p>| 函数的执行依赖于变量作用域，这个作用域是在函数定义时决定的，而不是函数调用时。 –p182</p>
<p>| 直接调用匿名函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是匿名函数，我被调用&quot;</span>)&#125;());</span><br><span class="line">(<span class="keyword">function</span>(<span class="params">x</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是匿名函数，我被调用=&gt;&quot;</span> + x)&#125;)(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>注意：<code>function</code>之前的左圆括号是必需的，如果不写这个左圆括号，JavaScript解释器会视图将关键字function解析为函数定义表达式。</p>
<p>| 调用函数中的函数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 函数中的函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是a&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是b&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">c</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是c&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">a</span>()()(); <span class="comment">// =&gt; 我是a /n 我是b /n 我是c</span></span><br></pre></td></tr></table></figure>

<p>| <code>argument[]</code>对象适用场合：函数包含固定个数的命名和必须的参数，以及随后个数不定的可选实参。–p175</p>
<p>| JavaScript针对实参的默认检查行为：省略的实参都是<code>undefined</code>，多出的实参会自动省略。–p174</p>
<p>| 标识符<code>arguments</code>是指向实参对象的引用，实参对象是一个类数组对象。可以通过下标来访问传入的实参值。例如：<code>argeuments[0]</code>表示第一个参数，<code>arguments.length()</code>表示实参数组的长度。–p174</p>
<p>| this是一个关键字，不是变量，也不是属性名。JavaScript的语法不允许给this赋值。–p171</p>
<p>| 任何函数只要作为方法调用实际上都会传入一个隐士的实参——这个实参是个对象，方法调用的母体就是这个对象。–p170</p>
<p>| 函数定义表达式/函数声明语句<br>函数声明语句：ECMAScript规范只是允许它们作为顶级语句。可以出现在全局代码里，或者内嵌在其他函数中，不能出现在循环，条件判断，或者try/catch/finally中。<br>函数定义表达式：可以出现在JavaScript代码的任何地方。 –p168</p>
<h1 id="第八章：函数"><a href="#第八章：函数" class="headerlink" title="第八章：函数"></a>第八章：函数</h1><p>| 对于字符串<code>var a = &quot;test&quot;</code>虽然可以通过<code>a[0]</code>的方式获取字符（很类似于数组的获取方式），但是字符串不是数组：<code>Array.isArray(a) === false</code>。</p>
<p>| <code>Array.indexOf()</code>和<code>Array.lastIndexOf()</code>：<br>参数1：需要搜索的值。<br>参数2：指定数组中的一个索引，从那里开始搜索。（可选的，如果省略则从头开始搜索；如果是负数，则表示相对末尾的偏移量） –p160</p>
<p>| <code>Array.reduce()</code>需要两个参数：<br>参数1： 执行化简操作的函数。<br>参数2： 传递给函数的初始值（可选的）。</p>
<p>| forEach无法在所有元素都传递给调用的函数之前终止遍历。可以通过抛异常的方式来中断。–p156</p>
<p>| <a href="http://www.cnblogs.com/moltboy/archive/2013/04/24/3040450.html">JavaScript中函数和方法的区别</a><br>函数：是可执行的JavaScript代码块，由JavaScript程序定义或JavaScript实现预定义。<br>方法：是通过对象调用的JavaScript函数。<br>（一个方法无非是个保存在一个对象的属性里的JavaScript。–p169）<br>（如果函数挂载在一个对象上，作为对象的一个属性，就称它为对象的一个方法。当通过这个对象来调用函数时，该对象就是此次调用的上下文，也就是该函数的this值–p165）<br>方法是用来对this对象进行操作的，this对象是方法的一个重要属性，当this对象出现在方法主体内部，this值就指向调用该方法的对象。而函数通常是独立的，并不需要经常使用this对象。</p>
<p>| <code>Array.push(a)</code>和<code>Array.pop()</code>，均修改原数组本身。 –p154</p>
<p>|<code>Array.splice()</code>，对元素本身做修改。</p>
<ul>
<li>参数1：指定插入或删除的起始位置；</li>
<li>参数2：指定了应该从数组中删除的元素个数。（为0时不删除任何元素）</li>
<li>后续参数：要插入的元素；</li>
</ul>
<p>| <code>Array.concat()</code>不会递归扁平化数组的数组。<code>concat()</code>也不会修改调用的数组。</p>
<p>| <code>Array.reverse()</code>操作的是原数组，对原数组进行重新排列。<br>例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">a.<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&quot;-&quot;</span>); <span class="comment">// =&gt; 1-2-3</span></span><br><span class="line">a <span class="comment">// =&gt;[3, 2, 1]</span></span><br></pre></td></tr></table></figure>

<p>| <code>Array.join()</code>，用什么字符来拼接数组中的元素。例如：<code>[1, 2, 3].join(-)</code>的结果是<code>1-2-3</code>；</p>
<p>| 在数组尾部压入一个元素，与给数组a[a.length]赋值是一样的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [];</span><br><span class="line">a.<span class="title function_">push</span>(<span class="string">&quot;one&quot;</span>); <span class="comment">// [&quot;one&quot;]</span></span><br><span class="line">a[a.<span class="property">length</span>] = <span class="string">&quot;two&quot;</span>; <span class="comment">// [&quot;one&quot;, &quot;two&quot;]</span></span><br></pre></td></tr></table></figure>

<p>| 在数组直接量中省略值时不会创建稀疏数组。省略的元素在数组中是存在的，其值为<code>undefined</code>。 –p147</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a1 = [,,,]; <span class="comment">// 数组是[undefined, undefined, undefined]</span></span><br><span class="line"><span class="keyword">var</span> a2 = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">3</span>); <span class="comment">// 该数组根本没有元素</span></span><br><span class="line"><span class="number">0</span> <span class="keyword">in</span> a1 <span class="comment">// =&gt; true: a1在索引0处有一个元素——undefined。？？？，在Chrome56.0中，其值为false；而如果a1=[undefined, undefined, undefined]，该结果是true</span></span><br><span class="line"><span class="number">0</span> <span class="keyword">in</span> a2 <span class="comment">// =&gt; false: a2在索引0处没有元素</span></span><br></pre></td></tr></table></figure>

<p>| 数组最大能容纳<code>2^32-1=4 294 967 295</code>个元素。</p>
<p>| 非标准的方法：以两条下划线作前缀，两条下划线做后缀的方法。例如：<code>__lookupGetter__()、__lookupSetter__()</code>。–p138</p>
<h1 id="第七章"><a href="#第七章" class="headerlink" title="第七章"></a>第七章</h1><p>| 基于兼容性考虑，不推荐使用<code>__proto__</code>，IE和Opera尚未实现它。 –p139</p>
<p>| <code>Object.defineProperty(对象, 要创建或修改的属性名称, 属性描述符对象)</code>方法可以用来设置属性的特性、新建属性的某种特性。<br>属性描述符：<code>&#123;value: 1, writable: true, enumerable: false, configurable: true&#125;</code>，不必包含所有4个特性，例如:<code>&#123;value:2&#125;</code>；<br>对于新创建的属性来说，默认的特性值是<code>false</code>或<code>undefined</code>。 –p136</p>
<p>| 对象直接量:var a = {x:1, y:2}<br>对象直接量是一个表达式，每次运算都创建并初始化一个新对象，如果在一个重复调用的函数中的循环体内使用了对象直接量，它将会创建很多新对象；–p<br>120<br><a href="http://www.cnblogs.com/jiuyi/p/4226903.html">http://www.cnblogs.com/jiuyi/p/4226903.html</a></p>
<p>| 严格模式（”use strict”是ECMAScript 5引入的一条指令）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// c = &quot;dd&quot;; // 在`use strict`之前没有任何表达式</span></span><br><span class="line"><span class="meta">&quot;use strict&quot;</span> <span class="comment">// 被当作指令</span></span><br><span class="line">d = <span class="string">&quot;d1&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">c = <span class="string">&quot;dd&quot;</span>;</span><br><span class="line"><span class="meta">&quot;use strict&quot;</span> <span class="comment">// 被当作普通的表达式语句对待。</span></span><br><span class="line">d = <span class="string">&quot;d1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>| 严格模式存在的意义：修正了语言的重要缺陷，并提供健壮的查错功能和增强的安全机制。 –p115</p>
<p>| with的用法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ==&gt; with测试</span></span><br><span class="line"><span class="keyword">var</span> o = &#123;<span class="attr">x</span>:<span class="number">1</span>&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o); <span class="comment">// =&gt; &#123;x:1&#125;</span></span><br><span class="line"><span class="title function_">with</span>(o) x = <span class="number">12</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o); <span class="comment">// =&gt; &#123;x: 12&#125;: with语句可以用来修改对象中属性的值。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o = &#123;&#125;;</span><br><span class="line"><span class="title function_">with</span>(o) x = <span class="number">13</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o); <span class="comment">// =&gt; &#123;&#125;:with提供了一种读取o的属性的快捷方式，但是不能创建o的属性。</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x); <span class="comment">// =&gt; 13:如果o没有属性x, 则相当于这段代码相当于`x=13`</span></span><br></pre></td></tr></table></figure>

<p>| 在严格模式下是禁止使用<code>with</code>语句的，并且在非严格模式下也是不推荐的，尽量避免使用<code>with</code>语句。(难优化，运行的慢) –p113</p>
<p>| 通过<code>prompt(&quot;msg&quot;)</code>的方式，从浏览器客户端获取用户输入。<br> 通过<code>alert(&quot;msg&quot;)</code>的方式弹出消息。</p>
<p>| 如果抛出异常的函数没有处理它的<code>try/catch/finally</code>语句，异常将向上传播到调用该函数的代码。如果没有找到任何异常处理程序，JavaScript将把异常当作程序错误来处理。–p110</p>
<p>| return语句只能在函数体内出现，否则会报语法错误。 –p109</p>
<p>| 函数，可以通过两种方式来定义： –p62, p57，p95</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方式1--函数定义表达式：</span></span><br><span class="line"><span class="keyword">var</span> square = <span class="keyword">function</span>(<span class="params">x</span>)&#123; <span class="keyword">return</span> x * x;&#125;</span><br><span class="line"><span class="comment">// 方式2--函数声明语句：</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">square</span>(<span class="params">x</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>两者的区别是：</p>
<ul>
<li>使用var，只有变量声明提前了–变量的初始化代码仍然在原来的位置。</li>
<li>使用函数声明语句的话，函数名称和函数体均提前。</li>
</ul>
<p>举个例子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ==&gt;函数声明提前测试；</span></span><br><span class="line"><span class="comment">// 在函数初始化之前调用</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;代码定义之前调用=============&quot;</span>);</span><br><span class="line"><span class="comment">// f1(); // =&gt;TypeError: f1 is not a function</span></span><br><span class="line"><span class="title function_">f2</span>(); <span class="comment">// =&gt; f2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数定义的地方</span></span><br><span class="line"><span class="keyword">var</span> f1 = <span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;f1&quot;</span>)&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f2</span>(<span class="params"></span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;f2&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;代码定义之后调用=============&quot;</span>);</span><br><span class="line"><span class="title function_">f1</span>(); <span class="comment">// =&gt; f1</span></span><br><span class="line"><span class="title function_">f2</span>(); <span class="comment">// =&gt; f2</span></span><br></pre></td></tr></table></figure>

<p>整体被显示地“提前”到了脚本或函数的顶部。</p>
<p>| 函数体内局部变量会声明提前，并且会覆盖同名的全局变量 –p58</p>
<blockquote>
<p>将函数内的变量声明“提前”至函数体顶部，同时变量初始化留在原来的位置。</p>
</blockquote>
<p>| JavaScript中，if,else的匹配规则是，else总是和就近的if语句匹配。 –p97</p>
<p>JavaScript中没有块级作用域。 –p93</p>
<p>delete:一些内置核心和客户端属性是不能删除的，用户通过var语句声明的变量不能删除。–p89</p>
<p>三元运算符的使用场合： –87<br>如果有定义就使用定义过的，如果没有定义则使用默认值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> greeting = <span class="string">&quot;hello&quot;</span> + (username ? username : <span class="string">&quot;there&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>为什么会有下面这种用法？p.x的执行依赖于p，如果不使用这种“&amp;&amp;”的方式，那么会抛出类型错误异常。–p80</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="literal">null</span>;</span><br><span class="line">p &amp;&amp; p.<span class="property">x</span></span><br></pre></td></tr></table></figure>

<p>假值是<code>false, null, undefined, 0, -0, NaN和&quot;&quot;</code>，所有其他的值包括对象都是真值。 –p79</p>
<p>所有小写的ASCII字母都“大于”大写的ASCII字母。 – p77</p>
<p>数组也是对象</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typeof</span> [] === <span class="string">&quot;object&quot;</span>; <span class="comment">// =&gt;true</span></span><br></pre></td></tr></table></figure>

<p>只有在<code>x</code>等于<code>NaN</code>时，表达式<code>x!==x</code>成立。 –p75</p>
<p>true在比较的过程中会转换为1.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> == <span class="literal">true</span> <span class="comment">// =&gt; true</span></span><br><span class="line"><span class="number">2</span> == <span class="literal">true</span> <span class="comment">// =&gt; false</span></span><br></pre></td></tr></table></figure>

<p>NaN和其他任何值都是不相等的（包括它本身）。 –p75</p>
<p>位操作移动的位数的范围是：0-31.<br>为什么？因为位运算符要求它的操作数是整数，这些整数表示为32位整型而不是64位浮点型； -p73</p>
<p>在JavaScript中，所有的数字都是浮点型的，除法运算的结果也是浮点型的。–p70</p>
<p>如果操作数是NaN，那么操作结果也是NaN。–p70</p>
<p>所有无法转换成数字的操作数在进行算术运算时，都转换成NaN。 –p70</p>
<p>结合性：一元运算符，赋值和三元条件运算符都具有从右至左的结合性。 –p69</p>
<p>注意：当属性名是通过运算得出的值而不是固定的值的时候，使用方括号写法。 –p64</p>
<p>点式的写法更简单（相比较于方括号），但是访问的属性名称必须是合法的标识符，并且需要知道属性的名字。 –p63</p>
<p>对于属性名称中包含空格的情况，可以通过<code>[]</code>来表示，例如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p = &#123;<span class="string">&quot;ni hao&quot;</span> : <span class="string">&quot;hello&quot;</span>&#125;;</span><br><span class="line">p[<span class="string">&quot;ni hao&quot;</span>] <span class="comment">// =&gt; hello</span></span><br></pre></td></tr></table></figure>

<p>对象直接量中的属性名称可以是字符串而不是标识符。–p62</p>
<p>数组直接量中的列表逗号之间的元素可以省略，省略的空位会填充 <code>undefined</code>。<br>数组直接量的元素列表结尾可以留下单个逗号，这时并不创建一个新的<code>undefined</code>对象。 –p62</p>
<p>在开头添加一行字符串<code>use strict;</code>可以开启严格模式；</p>
<p>同名的变量名，局部的会覆盖全局的。注意声明提前。</p>
<p>始终使用<code>var</code>来声明变量（不要隐藏var）。 –p56</p>
<p><code>new Boolean(false)</code>是一个对象，而不是原始值。所以以下代码会打印出<code>1</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">if</span>(c)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>依照术语的叫法，对象值都是引用，对象的比较均是引用的比较：当且仅当他们引用同一个基对象时，他们才相等。–p48</p>
<p>JavaScript中的字符串相等：<br>当且仅当他们的长度相等，且每个索引的字符都相等时. –p47</p>
<p>JavaScript对象是一种复合值：它是属性或已命名值的集合。 –p46<br>属性值可以是方法名。通过<code>o.m()</code>的方式进行调用。</p>
<p>任意JavaScript的值都可以转换成布尔值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="literal">undefined</span></span><br><span class="line"><span class="literal">null</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">-<span class="number">0</span></span><br><span class="line"><span class="title class_">NaN</span></span><br><span class="line"><span class="string">&quot;&quot;</span> <span class="comment">// 空字符串</span></span><br></pre></td></tr></table></figure>
<p>所有其他值，包括所有对象（数组）都会转换成true. –p43</p>
<p>在两条斜线之间的文本构成了一个正则表达式直接量。</p>
<p>舍入误差的解决方案：使用整数“分”而不要使用小数“元”进行基于货币单位的运算。 –p38</p>
<p>二进制浮点数表示法并不能精确表示类似0.1这样的简单数字。 –p37</p>
<p>除了作为除数外<code>0</code>和<code>-0</code>是一模一样的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> zero = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> negz = -<span class="number">0</span>;</span><br><span class="line">zero === negz; <span class="comment">// =&gt; true</span></span><br><span class="line"><span class="number">1</span>/zero === <span class="number">1</span>/negz; <span class="comment">// =&gt; false: 正无穷大和负无穷大不一样</span></span><br></pre></td></tr></table></figure>
<p>– p37</p>
<p>当且仅当x为<code>NaN</code>时，表达式<code>x != x</code>为<code>true</code>；–p37</p>
<p>无穷大值在进行加减乘除运算后，结果还是无穷大。</p>
<p>JavaScript中的算术运算在溢出、下溢、被零整除时不会报错：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">3</span> / <span class="number">0</span> = <span class="title class_">Infinity</span>;</span><br><span class="line">-<span class="number">3</span> / <span class="number">0</span> = -<span class="title class_">Infinity</span>;</span><br></pre></td></tr></table></figure>
<p>–p36</p>
<p>八进制（不推荐使用八进制，在ECMAScript 6的严格模式下  ，8进制是明令禁止的）：<br>0377是八进制；<br>0378是十进制；（可以通过console来验证） –p35</p>
<p>浮点数范围（采用IEEE 754标准）：<br>最大值（无限远离0）：+- 1.7976931348623157 x 10^308<br>最小值（无限接近0）：+- 5.0 x 10^-324<br>–p34</p>
<p>数字直接量：一个数字直接出现在JavaScript程序中。<br>在任何数字直接量前添加<code>-</code>符号，可以得到它们的负值。但负号是一元求反运算符，并不是数字直接量语法的组成部分。p34</p>
<p>JavaScript中的所有数字均用浮点数值表示。</p>
<p>不在任何函数内声明的变量称作全局变量，它在JavaScript程序中的任何地方都是可见的。<br>在函数内声明的变量具有函数作用域，并且只在函数内可见。 –p34</p>
<h3 id="可选的分号"><a href="#可选的分号" class="headerlink" title="可选的分号"></a>可选的分号</h3><p>在JavaScript中，分割语句的分号是可选的。<br>JavaScript并不是在所有换行处都填补分号：只有在缺少了分号就无法正确解析代码的情况下，JavaScript才会填补分号；<br>例外1：注意：在<code>return</code>, <code>break</code>, <code>continue</code>和随后的表达式之间不能换行（会自动添加分号）。<br>例外2：在涉及<code>++</code>, <code>--</code>的时候，既可以作为前缀也可以作为后缀。如果作为后缀表达式，则应当放在同一行。</p>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>在编程语言中，能够表示并操作的值的类型称作数据类型。</p>
<p>在技术上讲，只有JavaScript对象才能拥有方法。然而数字，字符串和布尔值也可以拥有自己的方法。<br>在JavaScript中只有<code>null</code>和<code>undefined</code>是无法拥有方法的；</p>
<p>本书的风格和《Effective Java》很类似</p>
<h1 id="《JavaScript权威指南》笔记"><a href="#《JavaScript权威指南》笔记" class="headerlink" title="《JavaScript权威指南》笔记"></a>《JavaScript权威指南》笔记</h1><p>2012年4月第1版 2016年9月第17次印刷。</p>
<h3 id="书中的错误"><a href="#书中的错误" class="headerlink" title="书中的错误"></a>书中的错误</h3><p>| p75<br>结果应该是相等，这条和第四条关于NaN的描述存在矛盾。</p>
<blockquote>
<p>如果两个值都是null或者都是undefined，则它们不相等。 =&gt; 则他们相等</p>
</blockquote>
<p>| p77</p>
<blockquote>
<p>则需要首先将字符串转全部换为小写字母 =&gt; 则需要首先将字符串全部转换为小写字母</p>
</blockquote>
<p>| p113</p>
<blockquote>
<p>width、debugger和use strict =&gt; with、debugger和use strict</p>
</blockquote>
<p>| p159</p>
<blockquote>
<p>为了简单起见，到目前位置 =&gt; 到目前为止</p>
</blockquote>
<p>| p168</p>
<blockquote>
<p>try/cache/finally =&gt; try/catch/finally</p>
</blockquote>
<p>| p177</p>
<blockquote>
<p>数组a中必须为数字、null和undefined的元素都将忽略。 =&gt; <code>、</code>修改为<code>,</code></p>
</blockquote>
<p>| p203</p>
<blockquote>
<p>prototye属性 =&gt; prototype</p>
</blockquote>
<p>| p204</p>
<blockquote>
<p>var r = range(1, 3); =&gt; var r = new Range(1, 3);</p>
</blockquote>
<p>| p205</p>
<blockquote>
<p>冠以关键字mew =&gt; 冠以关键字new</p>
</blockquote>
<p>| p213</p>
<blockquote>
<p>但我们常常会忽觉原型上的constructor属性。 =&gt; 但我们常常会忽略原型上的constructor属性。</p>
</blockquote>
<p>| p260</p>
<blockquote>
<p>/\s\Javas/ =&gt; /\sJava\s/</p>
</blockquote>
<p>| p260</p>
<blockquote>
<p> 带有“(?!”的断言是负向先行断言，用以指定接下来的字符都不必匹配。<br>=&gt; 带有“(?!”的断言是负向先行断言，用以指定接下来的字符都不匹配。</p>
</blockquote>
<p>| p263</p>
<blockquote>
<p> 接下来对exec()方法的讨论中会提到：<br>=&gt; 接下来对exec()方法的讨论中会提到。</p>
</blockquote>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>前端工具</title>
    <url>/js/%E5%89%8D%E7%AB%AF%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<ul>
<li><p><a href="http://www.imooc.com/learn/37">Fiddler工具使用</a></p>
</li>
<li><p><a href="http://element.eleme.io/#/zh-CN">网站快速成型工具</a></p>
</li>
<li><p>webpack</p>
</li>
</ul>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>商品多规格组合成单个SKU</title>
    <url>/js/%E5%95%86%E5%93%81sku%E7%BB%84%E5%90%88/</url>
    <content><![CDATA[<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> arr = [];</span><br><span class="line">  <span class="keyword">if</span> (!a || a.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> a) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j <span class="keyword">in</span> b) &#123;</span><br><span class="line">      arr.<span class="title function_">push</span>(a[i] + <span class="string">&quot;,&quot;</span> + b[j]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getComposeResult</span>(<span class="params">d</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="title function_">compose</span>([]);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; d.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    result = <span class="title function_">compose</span>(</span><br><span class="line">      result,</span><br><span class="line">      d[i]</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">let</span> c = [<span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="keyword">let</span> d = [a, b, c];</span><br><span class="line"><span class="comment">// let d = [[1,2], [3,4], [5,6]]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getComposeResult</span>(d));</span><br><span class="line"></span><br><span class="line"><span class="comment">// output: [&quot;1,3,5&quot;, &quot;1,3,6&quot;, &quot;1,4,5&quot;, &quot;1,4,6&quot;, &quot;2,3,5&quot;, &quot;2,3,6&quot;, &quot;2,4,5&quot;, &quot;2,4,6&quot;]</span></span><br></pre></td></tr></table></figure>

<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> products = [&#123;</span><br><span class="line">    <span class="string">&quot;18547,49234,48480&quot;</span>: <span class="number">947858</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">&quot;18547,49234,48481&quot;</span>: <span class="number">947859</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">&quot;18547,49235,48480&quot;</span>: <span class="number">947860</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">&quot;18547,49235,48481&quot;</span>: <span class="number">947861</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">&quot;19167,49234,48480&quot;</span>: <span class="number">947862</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">&quot;19167,49234,48481&quot;</span>: <span class="number">947863</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">&quot;19167,49235,48480&quot;</span>: <span class="number">947864</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">&quot;19167,49235,48481&quot;</span>: <span class="number">947865</span></span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> spec = [&#123;</span><br><span class="line">    <span class="string">&quot;spec_name&quot;</span>: <span class="string">&quot;颜色&quot;</span>,</span><br><span class="line">    <span class="string">&quot;children&quot;</span>: [&#123;</span><br><span class="line">        <span class="string">&quot;spec_value_name&quot;</span>: <span class="string">&quot;红&quot;</span>,</span><br><span class="line">        <span class="string">&quot;spec_value_image&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;spec_value_id&quot;</span>: <span class="number">18547</span>,</span><br><span class="line">        <span class="string">&quot;active&quot;</span>: <span class="string">&quot;selected&quot;</span>,</span><br><span class="line">        <span class="string">&quot;disabled&quot;</span>: <span class="string">&quot;false&quot;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&quot;spec_value_name&quot;</span>: <span class="string">&quot;白&quot;</span>,</span><br><span class="line">        <span class="string">&quot;spec_value_image&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;spec_value_id&quot;</span>: <span class="number">19167</span>,</span><br><span class="line">        <span class="string">&quot;disabled&quot;</span>: <span class="string">&quot;false&quot;</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&quot;spec_id&quot;</span>: <span class="number">4</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">&quot;spec_name&quot;</span>: <span class="string">&quot;重量&quot;</span>,</span><br><span class="line">    <span class="string">&quot;children&quot;</span>: [&#123;</span><br><span class="line">        <span class="string">&quot;spec_value_name&quot;</span>: <span class="string">&quot;1吨&quot;</span>,</span><br><span class="line">        <span class="string">&quot;spec_value_image&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;spec_value_id&quot;</span>: <span class="number">49234</span>,</span><br><span class="line">        <span class="string">&quot;active&quot;</span>: <span class="string">&quot;selected&quot;</span>,</span><br><span class="line">        <span class="string">&quot;disabled&quot;</span>: <span class="string">&quot;false&quot;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&quot;spec_value_name&quot;</span>: <span class="string">&quot;2吨&quot;</span>,</span><br><span class="line">        <span class="string">&quot;spec_value_image&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;spec_value_id&quot;</span>: <span class="number">49235</span>,</span><br><span class="line">        <span class="string">&quot;disabled&quot;</span>: <span class="string">&quot;false&quot;</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&quot;spec_id&quot;</span>: <span class="number">113</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="string">&quot;spec_name&quot;</span>: <span class="string">&quot;大小&quot;</span>,</span><br><span class="line">    <span class="string">&quot;children&quot;</span>: [&#123;</span><br><span class="line">        <span class="string">&quot;spec_value_name&quot;</span>: <span class="string">&quot;L&quot;</span>,</span><br><span class="line">        <span class="string">&quot;spec_value_image&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;spec_value_id&quot;</span>: <span class="number">48480</span>,</span><br><span class="line">        <span class="string">&quot;active&quot;</span>: <span class="string">&quot;selected&quot;</span>,</span><br><span class="line">        <span class="string">&quot;disabled&quot;</span>: <span class="string">&quot;false&quot;</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="string">&quot;spec_value_name&quot;</span>: <span class="string">&quot;M&quot;</span>,</span><br><span class="line">        <span class="string">&quot;spec_value_image&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;spec_value_id&quot;</span>: <span class="number">48481</span>,</span><br><span class="line">        <span class="string">&quot;disabled&quot;</span>: <span class="string">&quot;false&quot;</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&quot;spec_id&quot;</span>: <span class="number">742</span></span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getNumberArray</span>(<span class="params">spec</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr1 = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> spec) &#123;</span><br><span class="line">        <span class="keyword">let</span> arr2 = [];</span><br><span class="line">        <span class="keyword">let</span> children = spec[i].<span class="property">children</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j <span class="keyword">in</span> children) &#123;</span><br><span class="line">            <span class="keyword">let</span> child = children[j].<span class="property">spec_value_id</span>;</span><br><span class="line">            arr2.<span class="title function_">push</span>(child);</span><br><span class="line">        &#125;</span><br><span class="line">        arr1.<span class="title function_">push</span>(arr2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">if</span> (!a || a.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> a) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j <span class="keyword">in</span> b) &#123;</span><br><span class="line">            arr.<span class="title function_">push</span>(a[i] + <span class="string">&#x27;,&#x27;</span> + b[j])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getComposeSpecArray</span>(<span class="params">numArr</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="title function_">compose</span>([])</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; numArr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        result = <span class="title function_">compose</span>(result, numArr[i])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getSelectSkuBySelectedStatus</span>(<span class="params">spec</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> spec) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j <span class="keyword">in</span> spec[i].<span class="property">children</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> child = spec[i].<span class="property">children</span>[j];</span><br><span class="line">            <span class="keyword">if</span> (child.<span class="property">active</span> &amp;&amp; child.<span class="property">active</span> == <span class="string">&#x27;selected&#x27;</span>) &#123;</span><br><span class="line">                arr.<span class="title function_">push</span>(child.<span class="property">spec_value_id</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = <span class="title function_">getNumberArray</span>(spec);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr)</span><br><span class="line"><span class="comment">// output: [[18547,19167],[49234,49235],[48480,48481]]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> specArr = <span class="title function_">getComposeSpecArray</span>(arr)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(specArr);</span><br><span class="line"><span class="comment">// output: [&quot;18547,49234,48480&quot;, &quot;18547,49234,48481&quot;, &quot;18547,49235,48480&quot;, &quot;18547,49235,48481&quot;, &quot;19167,49234,48480&quot;, &quot;19167,49234,48481&quot;, &quot;19167,49235,48480&quot;, &quot;19167,49235,48481&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sku = <span class="title function_">getSelectSkuBySelectedStatus</span>(spec);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sku)</span><br><span class="line"><span class="comment">// output: &#x27;18547,49234,48480&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getProductId</span>(<span class="params">products, sku</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> products) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j <span class="keyword">in</span> products[i]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (j == sku) &#123;</span><br><span class="line">                <span class="keyword">return</span> products[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> productId = <span class="title function_">getProductId</span>(products, sku)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(productId)</span><br><span class="line"><span class="comment">// output: 947858</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>小程序</title>
    <url>/js/%E5%B0%8F%E7%A8%8B%E5%BA%8F/</url>
    <content><![CDATA[<ul>
<li><p>本地资源无法通过css获取<br>background-image：可以使用网络图片，或者base64或者使用<code>&lt;image/&gt;</code>标签<br><a href="http://www.wxapp-union.com/thread-910-1-1.html">http://www.wxapp-union.com/thread-910-1-1.html</a></p>
</li>
<li><p>每个身份证最多注册5个小程序； <a href="https://zhuanlan.zhihu.com/p/30185790">https://zhuanlan.zhihu.com/p/30185790</a></p>
</li>
</ul>
<ul>
<li><p><code>app.json</code>文件，不可以添加任何注释</p>
</li>
<li><p>页面的<code>.json</code>只能设置 window 相关的配置项，以决定本页面的窗口表现，所以无需写 window 这个键<br><a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/config.html">https://mp.weixin.qq.com/debug/wxadoc/dev/framework/config.html</a></p>
</li>
<li><p><code>前台、后台</code>定义： 当用户点击左上角关闭，或者按了设备 Home 键离开微信，小程序并没有直接销毁，而是进入了后台；当再次进入微信或再次打开小程序，又会从后台进入前台。需要注意的是：只有当小程序进入后台一定时间，或者系统资源占用过高，才会被真正的销毁。<br><a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/app-service/app.html">https://mp.weixin.qq.com/debug/wxadoc/dev/framework/app-service/app.html</a></p>
</li>
<li><p>Tip：不要尝试修改页面栈，会导致路由以及页面状态错误。<br><a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/app-service/route.htmlr">https://mp.weixin.qq.com/debug/wxadoc/dev/framework/app-service/route.htmlr</a></p>
</li>
</ul>
<ul>
<li><p>模版中：对象扩展运算符 … 来将一个对象展开<br><a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/data.html">https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/data.html</a><br>  存在变量名相同的情况，后边的会覆盖前面</p>
</li>
<li><p>注意： 花括号和引号之间如果有空格，将最终被解析成为字符串（<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/data.html%EF%BC%89">https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/data.html）</a>    </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;[1,2,3]&#125;&#125; &quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;item&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 等价于 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;[1,2,3] + &#x27; &#x27;&#125;&#125;&quot;</span>&gt;</span>  <span class="comment">&lt;!-- 其中&#123;&#123;[1,2,3]+&#x27;&#x27;&#125;&#125;=&quot;1,2,3 &quot; --&gt;</span> </span><br><span class="line">  &#123;&#123;item&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p><code>&lt;block&gt;</code>标签：用来渲染一个包含多节点的结构块；<br>  <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/list.html">https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/list.html</a></p>
</li>
<li><p><code>&lt;block/&gt;</code> 并不是一个组件，它仅仅是一个包装元素，不会在页面中做任何渲染，只接受控制属性。<br>  <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/conditional.html">https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/conditional.html</a></p>
</li>
<li><p>一般来说，wx:if 有更高的切换消耗而 hidden 有更高的初始渲染消耗。<br>  因此，如果需要频繁切换的情景下，用 hidden 更好，如果在运行时条件不大可能改变则 wx:if 较好。</p>
</li>
<li><p>事件分为冒泡事件和非冒泡事件：<br>冒泡事件：当一个组件上的事件被触发后，该事件会向父节点传递。<br>非冒泡事件：当一个组件上的事件被触发后，该事件不会向父节点传递。<br><a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/event.html">https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/event.html</a></p>
</li>
</ul>
<ul>
<li><p>bind事件绑定不会阻止冒泡事件向上冒泡，catch事件绑定可以阻止冒泡事件向上冒泡。</p>
</li>
<li><p>在布局的时候，通过下面这个特性，将想要布局的页面放在第一个，可以剩下许多时间。</p>
<blockquote>
<p>而写在 pages 字段的第一个页面就是这个小程序的首页(打开小程序看到的第一个页面)。<br><a href="https://mp.weixin.qq.com/debug/wxadoc/dev/quickstart/basic/framework.html#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%90%AF%E5%8A%A8">https://mp.weixin.qq.com/debug/wxadoc/dev/quickstart/basic/framework.html#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%90%AF%E5%8A%A8</a></p>
</blockquote>
</li>
<li><p><a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/app-service/page.html">Page 生命周期函数</a></p>
<blockquote>
<p><code>onLoad</code>: 页面加载<br>一个页面只会调用一次，可以在 onLoad 中获取打开当前页面所调用的 query 参数。</p>
</blockquote>
</li>
</ul>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Js文件服务器</title>
    <url>/js/%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    <content><![CDATA[<h2 id="Node-js-quick-file-server-static-files-over-HTTP-Stack-Overflow"><a href="#Node-js-quick-file-server-static-files-over-HTTP-Stack-Overflow" class="headerlink" title="Node.js quick file server (static files over HTTP) - Stack Overflow"></a><a href="https://stackoverflow.com/questions/16333790/node-js-quick-file-server-static-files-over-http">Node.js quick file server (static files over HTTP) - Stack Overflow</a></h2><p>A good “ready-to-use tool” option could be http-server:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install http-server -g</span><br><span class="line">sudo <span class="built_in">ln</span> -sf /home/<span class="variable">$USER</span>/c/node/bin/http-server  /usr/bin/http-server</span><br></pre></td></tr></table></figure>

<p>To use it:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> D:\Folder</span><br><span class="line">http-server</span><br></pre></td></tr></table></figure>

<p>Or, like this:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">http-server D:\Folder</span><br></pre></td></tr></table></figure>

<p>Check it out: <a href="https://github.com/nodeapps/http-server">https://github.com/nodeapps/http-server</a></p>
<h2 id="serve"><a href="#serve" class="headerlink" title="serve"></a>serve</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm i -g serve   // install</span><br><span class="line">serve C:/repos            // run with one line?? FTW!!</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Kotlin 参考资料</title>
    <url>/kotlin/%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/</url>
    <content><![CDATA[<p><a href="https://www.kotlincn.net/docs/reference/delegated-properties.html">委托属性 - Kotlin 语言中文站</a></p>
]]></content>
      <tags>
        <tag>kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>Kotlin in Action笔记</title>
    <url>/kotlin/kotlininaction/</url>
    <content><![CDATA[<p>Only after understanding the surrounding code can you make the necessary<br>modifications.</p>
<p>Note that omitting the return type is allowed only for functions with an expression<br>body</p>
<p>Note that this example shows the<br>only place in the Kotlin syntax where you’re required to use semicolons: if you define<br>any methods in the enum class, the semicolon separates the enum constant list from the<br>method definitions.</p>
<p>The rule “the last expression in a block is the result” holds in all cases where a block<br>can be used and a result is expected. As you’ll see at the end of this chapter, the same<br>rule works for the try body and catch clauses, and chapter 5 discusses its application to<br>lambda expressions. But as we already mentioned in section 2.2.1, this rule doesn’t hold<br>for regular functions. A function can have either an expression body that can’t be a block,<br>or a block body with explicit return statements inside.<br>p41</p>
<p>Just like many other modern JVM languages, Kotlin doesn’t differentiate between<br>checked and unchecked exceptions. You don’t specify the exceptions thrown by a<br>function, and you may or may not handle any exceptions. This design decision is based<br>on the practice of using checked exceptions in Java. Experience has shown that the Java<br>rules often require a lot of meaningless code to rethrow or ignore exceptions, and the<br>rules don’t consistently protect you from the errors that can happen.<br>p48</p>
<p>Note that extension<br>functions don’t allow you to break encapsulation. Unlike methods defined in the class,<br>extension functions don’t have access to private or protected members of the class.<br>p61</p>
<p>Method overriding in Kotlin works as usual for member functions, but you can’t override<br>an extension function.<br>the function that’s called depends on the static type of the<br>variable being declared, not on the runtime type of the value stored in that variable.<br>p64-p65</p>
<p>Note: If the class has a member function with the same signature as an<br>extension function, the member function always takes precedence.<br>You should keep this in mind when extending the API of classes: if<br>you add a member function with the same signature as an<br>extension function that a client of your class has defined, and they<br>then recompile their code, it will change its meaning and start<br>referring to the new member function.<br>p65<br>//TODO but how to override CharSequence.split, if the member function always takes precedence ???</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>(<span class="keyword">var</span> c: String) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getDiffC</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;---<span class="variable">$c</span>---&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getDiffD</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;!!!!!<span class="variable">$c</span>!!!!!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> A.<span class="title">getDiffD</span><span class="params">()</span></span>: String = <span class="string">&quot;====<span class="subst">$&#123;this.c&#125;</span>====&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    println(A(<span class="string">&quot;a&quot;</span>).getDiffC())</span><br><span class="line">    println(A(<span class="string">&quot;d&quot;</span>).getDiffD())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>The destructuring declaration feature isn’t limited to pairs. For example, you can<br>assign a map entry to two separate variables, key and value , as well.<br>p69</p>
<p>The to function is an extension function. You can create a pair of any elements,<br>which means it’s an extension to a generic receiver: you can write <code>1 to &quot;one&quot;</code> ,<br><code>&quot;one&quot; to 1</code> , <code>list to list.size()</code> , and so one.<br>Even though the creation of a new map may look like a special construct in Kotlin,<br>it’s a regular function with a concise syntax</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>to(<span class="string">&quot;one)</span></span><br><span class="line"><span class="string">// ====equivalent====</span></span><br><span class="line"><span class="string">1 to &quot;</span>one<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>
<p>p70</p>
<p>local functions and extensions<br>Kotlin gives you a cleaner solution: you can nest the functions you’ve extracted in the<br>containing function. This way, you have the structure you need without any extra<br>syntactic overhead. (meaning fun in fun)<br>p75</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="keyword">val</span> id: <span class="built_in">Int</span>, <span class="keyword">val</span> name: String, <span class="keyword">val</span> address: String)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">saveUser</span><span class="params">(user: <span class="type">User</span>)</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">validate</span><span class="params">(user: <span class="type">User</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 value: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 fieldName: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (value.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> IllegalArgumentException(</span><br><span class="line">                    <span class="string">&quot;Cannot save user <span class="subst">$&#123;user.id&#125;</span>: <span class="variable">$fieldName</span> is empty&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    validate(user, user.name, <span class="string">&quot;Name&quot;</span>)</span><br><span class="line">    validate(user, user.address, <span class="string">&quot;Address&quot;</span>)</span><br><span class="line"><span class="comment">// Save user to the database</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><p>Declaring a class as a <code>data</code> class instructs the compiler to generate several standard methods<br>for this class. You can also avoid writing delegating methods by hand, because the delegation<br>pattern is supported natively in Kotlin.<br>p78</p>
<p>This chapter also describes a new <code>object</code> keyword that declares a class and also<br>creates an instance of the class. The keyword is used to express singleton objects,<br>companion objects, and object expressions<br>p78</p>
<p>Unlike Java, using the override modifier is mandatory in Kotlin<br>p79</p>
<p>Whereas Java’s classes and methods are open by<br>default, Kotlin’s are final by default.<br>If you want to allow the creation of subclasses of a class, you need to mark the class<br>with the open modifier. In addition, you need to add the open modifier to everyproperty<br>or method that can be overridden<br>p82</p>
<p>Note that if you override a member of a base class or interface, the overriding<br>member will also be open by default. If you want to change this and forbid the subclasses<br>of your class from overriding your implementation, you can explicitly mark the<br>overriding member as final.(不像java中的修饰符不能缩小权限，kotlin中可以)<br>p83</p>
<p>The meaning of access modifiers in a class (p84)</p>
<table>
<thead>
<tr>
<th align="left">Modifier</th>
<th align="left">Corresponding member</th>
<th align="left">Comments</th>
</tr>
</thead>
<tbody><tr>
<td align="left">final</td>
<td align="left">Can’t be overridden</td>
<td align="left">Used by default for class members</td>
</tr>
<tr>
<td align="left">open</td>
<td align="left">Can be overridden</td>
<td align="left">Should be specified explicitly</td>
</tr>
<tr>
<td align="left">abstract</td>
<td align="left">Must be overridden</td>
<td align="left">Can be used only in abstract classes; abstract members can’t have an implementation</td>
</tr>
<tr>
<td align="left">override</td>
<td align="left">Overrides a member in a superclass</td>
<td align="left">Overridden member is open by default, if not marked final</td>
</tr>
</tbody></table>
<p>Kotlin offers a new visibility modifier, <code>internal</code>, which means<br>“visible inside a module.” A module is a set of Kotlin files compiled together. It may be<br>an IntelliJ IDEA module, an Eclipse project, a Maven or Gradle project, or a set of files<br>compiled with an invocation of the Ant task.<br>p84</p>
<p>kotlin visibility modifiers (p85)</p>
<table>
<thead>
<tr>
<th align="left">Modifier</th>
<th align="left">Class Member</th>
<th align="left">Top-level declaration</th>
</tr>
</thead>
<tbody><tr>
<td align="left">public(default)</td>
<td align="left">Visible everywhere</td>
<td align="left">Visible everywhere</td>
</tr>
<tr>
<td align="left">internal</td>
<td align="left">Visible in a moudle</td>
<td align="left">Visible in a moudle</td>
</tr>
<tr>
<td align="left">protected</td>
<td align="left">Visible in a subclasses</td>
<td align="left">—</td>
</tr>
<tr>
<td align="left">private</td>
<td align="left">Visible in a class</td>
<td align="left">Visible in a file</td>
</tr>
</tbody></table>
<p>This is a case of a general rule that<br>requires all types used in the list of base types and type parameters of a class, or the<br>signature of a method, to be as visible as the class or method itself. This rule ensures that<br>you always have access to all types you might need to invoke the function or extend a<br>class.<br>p85</p>
<p>Note the difference in behavior for the protected modifier in Java and in Kotlin. In<br>Java, you can access a protected member from the same package, but Kotlin doesn’t<br>allow that. In Kotlin, visibility rules are simple, and a protected member is only visible<br>in the class and its subclasses. Also note that extension functions of a class don’t get<br>access to its private or protected members.<br>p85</p>
<p>The difference<br>is that Kotlin nested classes don’t have access to the outer class instance, unless you<br>specifically request that.<br>p86</p>
<p>A nested class in Kotlin with no explicit modifiers is the same as a static nested<br>class in Java. To turn it into an inner class, so that it contains a reference to an outer<br>class, you use the inner modifier.<br>p88</p>
<table>
<thead>
<tr>
<th align="left">Class A declared within another class B</th>
<th align="left">In Java</th>
<th>In Kotlin</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Nested class (doesn’t store a reference to an outer class)</td>
<td align="left">static class A</td>
<td>class A</td>
</tr>
<tr>
<td align="left">Inner class (store a reference to an outer class)</td>
<td align="left">class A</td>
<td>inner class A</td>
</tr>
</tbody></table>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Outer</span> &#123;</span><br><span class="line">    <span class="keyword">inner</span> <span class="keyword">class</span> <span class="title class_">Inner</span> &#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getOuterReference</span><span class="params">()</span></span>: Outer = <span class="keyword">this</span><span class="symbol">@Outer</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>p88</p>
<p>In Java, as you know, a class can declare one or more constructors. Kotlin is similar, with<br>one additional change: it makes a distinction between a primary constructor (which is<br>usually the main, concise way to initialize a class and is <code>declared outside of the class body</code>)<br>and a secondary constructor (which is <code>declared in the class body</code>). It also allows<br>you to put additional initialization logic in initializer blocks</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// This block of code surrounded by parentheses is called a primary constructor. It serves two</span></span><br><span class="line"><span class="comment">// purposes: specifying constructor parameters and defining properties that are initialized by</span></span><br><span class="line"><span class="comment">// those parameters.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="keyword">val</span> nickname: String)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>p91</p>
<p>If your class has a superclass, the primary constructor also needs to initialize the<br>superclass. You can do so by providing the superclass constructor parameters after the<br>superclass reference in the base class list:</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">User</span>(<span class="keyword">val</span> nickname: String) &#123; ... &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TwitterUser</span>(nickname: String) : User(nickname) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>p93</p>
<p>If you inherit the Button class and don’t provide any constructors, you have to<br>explicitly invoke the constructor of the superclass even if it doesn’t have any parameters:</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">Button</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RadioButton</span>: <span class="type">Button</span>()</span><br></pre></td></tr></table></figure>
<p>That’s why you need empty parentheses after the name of the superclass. Note the<br>difference with interfaces: interfaces don’t have constructors, so if you implement an<br>interface, you never put parentheses after its name in the supertype list.<br>p93</p>
<p>If you want to ensure that your class can’t be instantiated by other code, you have to<br>make the constructor private</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Secretive</span> <span class="keyword">private</span> <span class="keyword">constructor</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Secretive</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">constructor</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or use : companion objects</span></span><br></pre></td></tr></table></figure>
<p>p94</p>
<p><code>secondary constructor</code><br>The below class doesn’t declare a primary constructor (as you can tell because there are no<br>parentheses after the class name in the class header), but it declares two secondary<br>constructors. A secondary constructor is introduced using the <code>constructor</code> keyword<br>You can declare as many secondary constructors as you need.</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(ctx: Context) &#123;</span><br><span class="line">        <span class="comment">// some code</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(ctx: Context, attr: AttributeSet) &#123;</span><br><span class="line">        <span class="comment">// some code</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If you want to extend this class, you can declare the same constructors:</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyButton</span> : <span class="type">View</span> &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(ctx: Context) : <span class="keyword">super</span>(ctx) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(ctx: Context, attr: AttributeSet) : <span class="keyword">super</span>(ctx, attr) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>p95</p>
<p>If the class has no primary constructor, then each secondary constructor has to<br>initialize the base class or delegate to another constructor that does so. Thinking in terms<br>of the previous figures, each secondary constructor must have an outgoing arrow starting<br>a path that ends at any constructor of the base class.<br>p96</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="keyword">val</span> name: String) &#123;</span><br><span class="line">    <span class="keyword">var</span> address: String = <span class="string">&quot;unspecified&quot;</span></span><br><span class="line">        <span class="keyword">set</span>(value: String) &#123;</span><br><span class="line">            println(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                Address was changed for <span class="variable">$name</span>:</span></span><br><span class="line"><span class="string">                &quot;<span class="variable">$field</span>&quot; -&gt; &quot;<span class="variable">$value</span>&quot;.&quot;&quot;&quot;</span>.trimIndent())</span><br><span class="line">            field = value</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the body of the setter, you use the special identifier field to access the value of<br>the backing field. In a getter, you can only read the value; and in a setter, you can both<br>read and modify it.<br>In the body of the setter, you use the special identifier field to access the value of<br>the backing field. In a getter, you can only read the value; and in a setter, you can both<br>read and modify it.<br>Note that you can redefine only one of the accessors for a mutable property. The<br>getter in the previous example is trivial and just returns the field value, so you didn’t<br>need to redefine it<br>p99</p>
<p>In Kotlin, == is the default way to compare two objects: it compares their<br>values by calling equals under the hood. Thus, if equals is overridden in<br>your class, you can safely compare its instances using == . For reference<br>comparison, you can use the === operator, which works exactly thesame<br>as == in Java.<br>p102</p>
<p>Note that properties that aren’t declared in the primary<br>constructor don’t take part in the equality checks and hashcode calculation.<br>p104</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">- You use the field identifier to reference a property backing field from the accessor body.</span><br><span class="line">- Data classes provide compiler-generated equals() , hashCode() , toString() , copy() , and other methods.</span><br><span class="line">- Companion objects (along with package-level functions and properties) replace Java’s static method and field definitions.</span><br><span class="line">- Companion objects, like other objects, can implement interfaces or have extension functions or properties.</span><br><span class="line">- Object expressions are Kotlin’s replacement for Java’s anonymous inner classes, with </span><br><span class="line">    added power such as the ability to implement multiple interfaces and to modify the</span><br><span class="line">    variables defined in the scope where the object is created.</span><br></pre></td></tr></table></figure>

<h1 id="5"><a href="#5" class="headerlink" title="5"></a>5</h1><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">&#123;x:<span class="built_in">Int</span>, y:<span class="built_in">Int</span> -&gt; x+y&#125;</span><br></pre></td></tr></table></figure>
<p>A lambda expression in Kotlin is always surrounded by curly braces. Note that there<br>are no parentheses around the arguments. The arrow separates the argument list from the<br>body of the lambda.<br>p122</p>
<p>The road of improvement</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Person</span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="keyword">val</span> people = listOf(Person(<span class="string">&quot;lisi&quot;</span>, <span class="number">18</span>), Person(<span class="string">&quot;wangwu&quot;</span>, <span class="number">15</span>))</span><br><span class="line">people.maxBy(&#123;p:Person -&gt; p.age&#125;)</span><br></pre></td></tr></table></figure>
<p>In Kotlin, a syntactic convention lets you move a lambda expression out of parentheses<br>if it’s the last argument in a function call.<br>In this example, the lambda is the only argument, so it can be placed<br>after the parentheses:</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">people.maxBy() &#123; p: Person -&gt; p.age &#125;</span><br></pre></td></tr></table></figure>
<p>When the lambda is the only argument to a function, you can also remove the empty<br>parentheses from the call:</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// If a lambda is the only argument, you’ll definitely want to write it without the parentheses.</span></span><br><span class="line">people.maxBy &#123; p: Person -&gt; p.age &#125;</span><br></pre></td></tr></table></figure>
<p>As with local variables, if the type of a lambda parameter can be inferred, you don’t<br>need to specify it explicitly.</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">people.maxBy &#123; p -&gt; p.age &#125;</span><br></pre></td></tr></table></figure>
<p>The last simplification you can make in this example is to replace an argument with<br>the default argument name: <code>it</code> . This name is generated if the context expects a lambda<br>with only one argument, and its type can be inferred:</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">peopel.maxBy &#123;it.age&#125;</span><br></pre></td></tr></table></figure>
<p>p125</p>
<p>One important difference between Kotlin and Java is that in Kotlin, you aren’t<br>restricted to accessing final variables. You can also modify variables from within a<br>lambda. The next example counts the number of client and server errors in the given set<br>of response status codes:</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printProblemCounts</span><span class="params">(responses: <span class="type">Collection</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> clientErrors = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> serverErrors = <span class="number">0</span></span><br><span class="line">    responses.forEach &#123;</span><br><span class="line">        <span class="keyword">if</span> (it.startsWith(<span class="string">&quot;4&quot;</span>)) &#123;</span><br><span class="line">            clientErrors++</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (it.startsWith(<span class="string">&quot;5&quot;</span>)) &#123;</span><br><span class="line">            serverErrors++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;<span class="variable">$clientErrors</span> client errors, <span class="variable">$serverErrors</span> server errors&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that, by default, the lifetime of a local variable is constrained by the function in<br>which the variable is declared. But if it’s captured by the lambda, the code that uses this<br>variable can be stored and executed later. You may ask how this works. When you<br>capture a final variable, is value is stored together with the lambda code that uses it. For<br>non-final variables, the value is enclosed in a special wrapper that lets you change it, and<br>the reference to the wrapper is stored together with the lambda.<br>p127</p>
<p>An important caveat is that, if a lambda is used as an event handler or is otherwise<br>executed asynchronously, the modifications to local variables will occur only when the<br>lambda is executed. For example, the following code isn’t a correct way to count button<br>clicks:</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">tryToCountButtonClicks</span><span class="params">(button: <span class="type">Button</span>)</span></span>: <span class="built_in">Int</span> &#123;   </span><br><span class="line">    <span class="keyword">var</span> clicks = <span class="number">0</span></span><br><span class="line">    button.onClick &#123; clicks++ &#125;</span><br><span class="line">    <span class="keyword">return</span> clicks <span class="comment">// always return 0, you should store the clicks variable </span></span><br><span class="line">                  <span class="comment">// in a location that remains accessible outside of the function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>p128</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// smaple1</span></span><br><span class="line">people.filter &#123; it.age == people.maxBy(Person::age).age &#125; <span class="comment">// not work well with performance, because calculate maxAge everytime</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// sample2</span></span><br><span class="line"><span class="keyword">val</span> maxAge = people.maxBy(Person::age).age <span class="comment">// work well, only compulate once</span></span><br><span class="line">people.filter &#123; it.age == maxAge &#125;</span><br></pre></td></tr></table></figure>
<p>Don’t repeat a calculation if you don’t need to! Simple-looking code using lambda<br>expressions can sometimes obscure the complexity of the underlying operations, so<br>always keep in mind what is happening in the code you write.<br>p133</p>
<p>The entry point for lazy collection operations in Kotlin is the Sequence interface. The<br>interface represents just that: a sequence of elements that can be enumerated one by one.<br>Sequence provides only one method, iterator , that you can use to obtain the values<br>from the sequence.</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">people.asSequence() <span class="comment">// the lazy way more efficient than eager way when there are a million data.</span></span><br><span class="line">.map(Person::name)</span><br><span class="line">.filter &#123; it.startsWith(<span class="string">&quot;A&quot;</span>) &#125;</span><br><span class="line">.toList()</span><br></pre></td></tr></table></figure>
<p>p138</p>
<p>Note<br>As a rule, use a sequence whenever you have a chain of<br>operations on a large collection. In section 8.2, we’ll discuss why<br>eager operations on regular collections are efficient in Kotlin, in<br>spite of creating intermediate collections. But if the collection<br>contains a large number of elements, the intermediate rearranging<br>of elements costs a lot, so lazy evaluation is preferable.<br>p139</p>
<p>The order of the operations you perform on a collection can affect performance as<br>well.<br>If map goes first, each element is transformed. If you apply filter first,<br>inappropriate elements are filtered out as soon as possible and aren’t transformed.<br>p141</p>
<p>SAM: single abstract method p144</p>
<p>In addition to returning values, SAM constructors are used when you need to store a<br>functional interface instance generated from a lambda in a variable. Suppose you want to<br>reuse one listener for several buttons, as in the following example (in an Android<br>application, this code can be a part of the Activity.onCreate method):</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> listener = OnClickListener &#123; view -&gt;</span><br><span class="line">    <span class="keyword">val</span> text = <span class="keyword">when</span> (view.id) &#123;</span><br><span class="line">        R.id.button1 -&gt; <span class="string">&quot;First button&quot;</span></span><br><span class="line">        R.id.button2 -&gt; <span class="string">&quot;Second button&quot;</span></span><br><span class="line">        <span class="keyword">else</span> -&gt; <span class="string">&quot;Unknown button&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    toast(text)</span><br><span class="line">&#125;</span><br><span class="line">button1.setOnClickListener(listener)</span><br><span class="line">button2.setOnClickListener(listener)</span><br></pre></td></tr></table></figure>
<p>p147</p>
<p>Note that there’s no this in a lambda as there is in an anonymousobject:<br>there’s no way to refer to the anonymous class instance into which the<br>lambda is converted. From the compiler’s point of view, the lambda is a<br>block of code, not an object, and you can’t refer to it as an object.<br><code>The &#39;this&#39; reference in a lambda refers to a surrounding class.</code><br>p148</p>
<p>If your event listener needs to unsubscribe itself while handling an event,<br>you can’t use a lambda for that. Use an anonymous object to implement<br>a listener, instead. In an anonymous object, the this keyword refers to<br>the instance of that object, and you can pass it to the API that removes<br>the listener.</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span>  anonymousObject: Runnable = <span class="keyword">object</span> : Runnable &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;world&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Computation().postponeComputation(<span class="number">1</span>, anonymousObject)</span><br></pre></td></tr></table></figure>
<p>p148</p>
<h1 id="6"><a href="#6" class="headerlink" title="6"></a>6</h1><p>To reiterate, a type without a question mark denotes that variables of this type can’t<br>store null references. This means all regular types are non- null by default, unless<br>explicitly marked as nullable.<br>p156</p>
]]></content>
      <tags>
        <tag>kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>Kotlin疑点难点</title>
    <url>/kotlin/%E9%9A%BE%E7%82%B9/</url>
    <content><![CDATA[<h2 id="with"><a href="#with" class="headerlink" title="with"></a>with</h2><p>本书中我们大量讲了这个函数。 with 接收一个对象和一个函数，这个函数会作为<br>这个对象的扩展函数执行。这表示我们根据推断可以在函数内使用 this 。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> <span class="title">with</span><span class="params">(receiver: <span class="type">T</span>, f: <span class="type">T</span>.() -&gt; <span class="type">R</span>)</span></span>: R = receiver.f()</span><br></pre></td></tr></table></figure>

<p>泛型在这里也是以相同的方式运行： T 代表接收类型， R 代表结果。如你所见，<br>函数通过 f: T.() -&gt; R 声明被定义成了<strong>扩展函数</strong>。这就是为什么我们可以调<br>用 receiver.f() 。<br>kotlin-for-android-developers-zh p188</p>
<h2 id="构造器"><a href="#构造器" class="headerlink" title="构造器"></a>构造器</h2><blockquote>
<p>下面 3 种声明都是等效的 （《kotlin 实战》p81）</p>
</blockquote>
<p><strong>实现 1</strong></p>
<figure class="highlight kt"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">constructor</span>(_nickname:String)&#123;</span><br><span class="line">    <span class="keyword">val</span> nickname: String</span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        nickname = _nickname</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>实现 2</strong></p>
<figure class="highlight kt"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(_nickname:String)&#123;</span><br><span class="line">    <span class="keyword">val</span> nickname = _nickname <span class="comment">// 如果主构造方法没有注解和可见性修饰符，可以去掉 `constructor` 关键字；也不用放到 init 中，可以在声明的时候初始化了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>实现 3</strong></p>
<figure class="highlight kt"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="keyword">val</span> nickname: String) <span class="comment">// “val” 意味着相应的属性会用构造方法的参数来初始化</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>Centos 相关</title>
    <url>/linux/centos/</url>
    <content><![CDATA[<h2 id="设置主机名称"><a href="#设置主机名称" class="headerlink" title="设置主机名称"></a>设置主机名称</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 设置主机名</span></span><br><span class="line">hostnamectl set-hostname yourhostname</span><br><span class="line"><span class="comment"># 刷新生效</span></span><br><span class="line">bash</span><br></pre></td></tr></table></figure>

<p><strong>查看版本</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/redhat-release</span><br><span class="line"><span class="built_in">uname</span> -a</span><br><span class="line"><span class="built_in">uname</span> -r</span><br></pre></td></tr></table></figure>

<h2 id="配置固定-ip"><a href="#配置固定-ip" class="headerlink" title="配置固定 ip"></a>配置固定 ip</h2><p>编辑：<code>vi /etc/sysconfig/network-scripts/ifcfg-ens0s8</code><br>(注意：ens0s8 这个名字要和 <code>ip addr</code>中的名字保持一致，如果不一样修改文件名即可，否则会重启失败)</p>
<p><strong>默认</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=dhcp</span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">PEERDNS=<span class="built_in">yes</span></span><br><span class="line">PEERROUTES=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_PEERDNS=<span class="built_in">yes</span></span><br><span class="line">IPV6_PEERROUTES=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">NAME=enp0s8</span><br><span class="line">UUID=ed6c068c-149c-4678-8a13-d6e34a5d50c9</span><br><span class="line">DEVICE=enp0s8</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">DNS1=10.0.2.2</span><br><span class="line">DNS2=8.8.8.8</span><br></pre></td></tr></table></figure>

<p><strong>自定义</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">PEERDNS=<span class="built_in">yes</span></span><br><span class="line">PEERROUTES=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_PEERDNS=<span class="built_in">yes</span></span><br><span class="line">IPV6_PEERROUTES=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">NAME=enp0s8</span><br><span class="line">UUID=ed6c068c-149c-4678-8a13-d6e34a5d50c9</span><br><span class="line">DEVICE=enp0s8</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">IPADDR=172.20.130.84</span><br><span class="line">GATEWAY=172.20.130.1</span><br><span class="line">DNS1=10.0.2.2</span><br><span class="line">DNS2=8.8.8.8</span><br></pre></td></tr></table></figure>

<p>重启： <code>systemctl restart network</code></p>
<h2 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl status firewalld</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure>

<h2 id="免密登录"><a href="#免密登录" class="headerlink" title="免密登录"></a>免密登录</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.20.130.84</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux常用命令</title>
    <url>/linux/command/</url>
    <content><![CDATA[<h2 id="设置管理员密码"><a href="#设置管理员密码" class="headerlink" title="设置管理员密码"></a>设置管理员密码</h2><p>首次使用管理员登录需要先设置密码</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo passwd</span><br></pre></td></tr></table></figure>

<h2 id="定时关机"><a href="#定时关机" class="headerlink" title="定时关机"></a>定时关机</h2><p><a href="http://os.51cto.com/art/201108/287974.htm">http://os.51cto.com/art/201108/287974.htm</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">shutdown -h 22:30 <span class="comment"># 在指定时间关机</span></span><br><span class="line">shutdown -h 30 <span class="comment">#30分钟后关机</span></span><br></pre></td></tr></table></figure>

<h2 id="history之后执行指定行的命令"><a href="#history之后执行指定行的命令" class="headerlink" title="history之后执行指定行的命令"></a>history之后执行指定行的命令</h2><blockquote>
<p><code>$ history // 查看命令历史</code><br><code>$ !334  //表示执行第334行的命令</code></p>
</blockquote>
<h2 id="在命令行中用默认程序打开文件"><a href="#在命令行中用默认程序打开文件" class="headerlink" title="在命令行中用默认程序打开文件"></a>在命令行中用默认程序打开文件</h2><p><code>xdg-open &#123; file | URL &#125;</code></p>
<blockquote>
<p><a href="http://blog.chinaunix.net/uid-27025492-id-3376626.html">Ubuntu下用命令行快速打开各类型文件(转)-bough22-ChinaUnix博客</a></p>
</blockquote>
<h2 id="ps-查看运行的进程"><a href="#ps-查看运行的进程" class="headerlink" title="ps 查看运行的进程"></a>ps 查看运行的进程</h2><p><code>ps -aux | grep vim</code></p>
<h2 id="Ubuntu-系统强制关闭进程。"><a href="#Ubuntu-系统强制关闭进程。" class="headerlink" title="Ubuntu 系统强制关闭进程。"></a>Ubuntu 系统强制关闭进程。</h2><blockquote>
<p>$ps -aux | grep [应用名]  # 抓取指定应用的进程信息，几下 应用的pid<br>$kill -9 [应用的pid]</p>
</blockquote>
<h2 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h2><p>10行的上下文</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> file.txt | grep -C 10 key_word</span><br></pre></td></tr></table></figure>

<h2 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h2><p>查看实时日志： tail -fn 100 log_file_name.out</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">tail</span> --<span class="built_in">help</span></span><br><span class="line">-f: `--follow[HOW]` Output appended data as the file grows;</span><br><span class="line">-n: `--lines=[+]NUM` Output the last NUM lines, instead of the last 10;</span><br></pre></td></tr></table></figure>
<h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><p><a href="https://coolshell.cn/articles/9104.html">https://coolshell.cn/articles/9104.html</a></p>
<figure class="highlight scilab"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s/&#x27;</span>proxy.*/<span class="string">&#x27;proxy&#x27;</span>: <span class="string">&#x27;http://proxy.lyloou.com&#x27;</span>/g<span class="string">&quot; eros.dev.js</span></span><br></pre></td></tr></table></figure>

<h2 id="nohup"><a href="#nohup" class="headerlink" title="nohup"></a>nohup</h2><p>用途：不挂断地运行命令。<br>语法：nohup Command [ Arg … ] [　&amp; ]<br>描述：nohup 命令运行由 Command 参数和任何相关的 Arg 参数指定的命令，忽略所有挂断（SIGHUP）信号。在注销后使用 nohup 命令运行后台中的程序。要运行后台中的 nohup 命令，添加 &amp; （ 表示”and”的符号）到命令的尾部。<br><a href="http://www.cnblogs.com/allenblogs/archive/2011/05/19/2051136.html">http://www.cnblogs.com/allenblogs/archive/2011/05/19/2051136.html</a></p>
<h3 id="nohup-不生成-nohup-out的方法"><a href="#nohup-不生成-nohup-out的方法" class="headerlink" title="nohup 不生成 nohup.out的方法"></a>nohup 不生成 nohup.out的方法</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">nohup</span> java -jar /xxx/xxx/xxx.jar &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p>关键在于最后的 &gt;/dev/null 2&gt;&amp;1 部分，/dev/null是一个虚拟的空设备（类似物理中的黑洞），任何输出信息被重定向到该设备后，将会石沉大海</p>
<blockquote>
<p>/dev/null 表示将标准输出信息重定向到”黑洞”<br>2&gt;&amp;1 表示将标准错误重定向到标准输出(由于标准输出已经定向到“黑洞”了，即：标准输出此时也是”黑洞”，再将标准错误输出定向到标准输出，相当于错误输出也被定向至“黑洞”)<br><a href="http://www.cnblogs.com/yjmyzz/p/4831182.html">http://www.cnblogs.com/yjmyzz/p/4831182.html</a></p>
</blockquote>
<h2 id="在某目录及其子目录下所有文件的最前面添加几行文字"><a href="#在某目录及其子目录下所有文件的最前面添加几行文字" class="headerlink" title="在某目录及其子目录下所有文件的最前面添加几行文字"></a>在某目录及其子目录下所有文件的最前面添加几行文字</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">grep -rl <span class="string">&#x27;&#x27;</span> tmpdir\ | xargs sed -i <span class="string">&quot;1 i hi 你好吗\n 你知道我是谁吗\n 是的，是我\n&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://stackoverflow.com/questions/6758963/find-and-replace-with-sed-in-directory-and-sub-directories">linux - Find and replace with sed in directory and sub directories - Stack Overflow</a></li>
</ul>
<h2 id="lsof-i-8088"><a href="#lsof-i-8088" class="headerlink" title="lsof -i 8088"></a>lsof -i 8088</h2><h2 id="通过域名查看ip"><a href="#通过域名查看ip" class="headerlink" title="通过域名查看ip"></a>通过域名查看ip</h2><ul>
<li>ping的方式：<code>ping lyloou.com</code></li>
<li>nslookup方式： <code>nslookup lyloou.com</code></li>
</ul>
<h2 id="拉取远程文件"><a href="#拉取远程文件" class="headerlink" title="拉取远程文件"></a>拉取远程文件</h2><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">scp root@<span class="number">138.128</span>.<span class="number">208.16</span>:<span class="regexp">/root/g</span>o<span class="regexp">/src/gi</span>thub.com<span class="regexp">/inconshreveable/</span>ngrok<span class="regexp">/bin/</span>ngrok D:<span class="regexp">/dd/</span>ngrok</span><br></pre></td></tr></table></figure>
<p>如果出现这个错误：<code>connect to xxxxxxx port 22: Connection refused</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum -y install openssh-server</span><br><span class="line">service sshd start</span><br><span class="line"><span class="comment"># 首先使用命令：ss -lnt查询22号端口是否开启，如下图所示为正常开启，否则要开启22号端口。 如果要修改端口，查看或编辑SSH服务配置文件，使用命令 vi /etc/ssh/sshd.config，进入后把 port 后面默认的22端口改成别的端口即可.</span></span><br><span class="line"><span class="comment"># https://www.linuxidc.com/Linux/2017-11/148586.htm</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># http://wiki.ubuntu.org.cn/UbuntuSkills#.E9.80.9A.E8.BF.87ssh.E4.BC.A0.E8.BE.93.E6.96.87.E4.BB.B6</span></span><br><span class="line">scp -rp /path/filename username@remoteIP:/path <span class="comment">#将本地文件拷贝到服务器上</span></span><br><span class="line">scp -rp username@remoteIP:/path/filename /path <span class="comment">#将远程文件从服务器下载到本地</span></span><br></pre></td></tr></table></figure>


<h2 id="df查看硬盘容量"><a href="#df查看硬盘容量" class="headerlink" title="df查看硬盘容量"></a>df查看硬盘容量</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure>

<h2 id="how-to-automount-ntfs-partitions"><a href="#how-to-automount-ntfs-partitions" class="headerlink" title="how-to-automount-ntfs-partitions"></a><a href="https://askubuntu.com/questions/46588/how-to-automount-ntfs-partitions">how-to-automount-ntfs-partitions</a></h2><ul>
<li><p><code>vi /etc/fstab</code> &amp; add below line</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Windows-Partition</span></span><br><span class="line">UUID=&lt;xxxxx&gt; /media/win ntfs rw,auto,<span class="built_in">users</span>,<span class="built_in">exec</span>,nls=utf8,<span class="built_in">umask</span>=003,gid=46,uid=1000    0   0</span><br></pre></td></tr></table></figure></li>
<li><p>Finding which disk you will set</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo fdisk -l</span><br></pre></td></tr></table></figure></li>
<li><p>Finding the UUID</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo blkid</span><br></pre></td></tr></table></figure></li>
<li><p>Check it</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">sudo mount -<span class="selector-tag">a</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="查看使用最多的10条命令"><a href="#查看使用最多的10条命令" class="headerlink" title="查看使用最多的10条命令"></a>查看使用最多的10条命令</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">history</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -k1,1nr | <span class="built_in">head</span> -10</span><br></pre></td></tr></table></figure>
<p><a href="https://coolshell.cn/articles/8619.html">https://coolshell.cn/articles/8619.html</a><br><a href="http://blog.51cto.com/huanglianfeng/1381267">http://blog.51cto.com/huanglianfeng/1381267</a></p>
<h2 id="bash-How-to-use-arguments-from-previous-command-Stack-Overflow"><a href="#bash-How-to-use-arguments-from-previous-command-Stack-Overflow" class="headerlink" title="bash - How to use arguments from previous command? - Stack Overflow"></a><a href="https://stackoverflow.com/questions/4009412/how-to-use-arguments-from-previous-command">bash - How to use arguments from previous command? - Stack Overflow</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> a b c d e </span><br><span class="line">a b c d e</span><br><span class="line">$ <span class="built_in">echo</span> !^</span><br><span class="line"><span class="built_in">echo</span> a</span><br><span class="line">a</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> a b c d e </span><br><span class="line">a b c d e</span><br><span class="line">$ <span class="built_in">echo</span> !:1</span><br><span class="line"><span class="built_in">echo</span> a</span><br><span class="line">a</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">!^      first argument</span><br><span class="line">!$      last argument</span><br><span class="line">!*      all arguments</span><br><span class="line">!:2     second argument</span><br><span class="line"></span><br><span class="line">!:2-3   second to third arguments</span><br><span class="line">!:2-$   second to last arguments</span><br><span class="line">!:2*    second to last arguments</span><br><span class="line">!:2-    second to next to last arguments</span><br><span class="line"></span><br><span class="line">!:0     the <span class="built_in">command</span></span><br><span class="line">!!      repeat the previous line</span><br></pre></td></tr></table></figure>

<h2 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h2><ul>
<li><a href="https://www.cnblogs.com/liuhouhou/p/5400540.html">Linux kill -9 和 kill -15 的区别 - 妖老山黑 - 博客园</a></li>
<li><a href="https://www.zhihu.com/question/23747655">大家在kill -9前不会尝试kill -15么？ - 知乎</a></li>
</ul>
<h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><p>查看包含部分文字的上下文</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -E, --extended-regexp     PATTERN is an extended regular expression</span></span><br><span class="line"><span class="comment"># -i, --ignore-case         ignore case distinctions</span></span><br><span class="line">-C, --context=NUM         <span class="built_in">print</span> NUM lines of output context</span><br><span class="line">grep -E -i -C 10 <span class="string">&quot;((exception) | (error))&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Curl</title>
    <url>/linux/curl/</url>
    <content><![CDATA[<ul>
<li><a href="https://ifttl.com/send-http-post-request-with-curl/">使用 curl 发送 POST 请求的几种方式 - 自由人的 BLOG</a></li>
<li><a href="https://superuser.com/questions/149329/what-is-the-curl-command-line-syntax-to-do-a-post-request">http - What is the cURL command-line syntax to do a POST request? - Super User</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -X POST -H <span class="string">&quot;Accept-Language:zh-CN&quot;</span> -H <span class="string">&#x27;x-auth-token:09ef4702-578e-408b-91b2-a40393dfc996&#x27;</span> -F <span class="string">&#x27;symbol=BTC/USDT&#x27;</span> -F <span class="string">&#x27;price=76.00000&#x27;</span> -F <span class="string">&#x27;amount=1002&#x27;</span> -F <span class="string">&#x27;direction=BUY&#x27;</span> -F <span class="string">&#x27;type=LIMIT_PRICE&#x27;</span> http://192.168.1.22:8091/exchange/order/add</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -X GET --data <span class="string">&#x27;&#123;&quot;album_id&quot;: &quot;4510261846343990&quot;&#125;&#x27;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span>  http://localhost:6004/media/output/materiellist</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>linux</tag>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>Ftp</title>
    <url>/linux/ftp/</url>
    <content><![CDATA[<p><a href="https://hostadvice.com/how-to/how-to-install-and-configure-vsftpd-on-ubuntu-18-04/">How to Install and Configure vsftpd on Ubuntu 18.04 | HostAdvice</a></p>
<p><a href="https://blog.csdn.net/soslinken/article/details/79304076">ubuntu 使用vsftpd 创建FTP服务（用户名密码登录，限制列出目录）_迦蓝叶的博客-CSDN博客_ubuntu vsftpd添加用户</a></p>
]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>【Linux】interview</title>
    <url>/linux/interview/</url>
    <content><![CDATA[<h2 id="3-Top-10-Linux-Job-Interview-Questions-YouTube"><a href="#3-Top-10-Linux-Job-Interview-Questions-YouTube" class="headerlink" title="(3) Top 10 Linux Job Interview Questions - YouTube"></a><a href="https://www.youtube.com/watch?v=l0QGLMwR-lY">(3) Top 10 Linux Job Interview Questions - YouTube</a></h2><p>Can you answer the 10 most popular Linux tech job interview questions?<br>0:00 Introduction<br>0:53 Tech Phone screens<br>1:50 How to check the kernel version of a Linux system?</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">man <span class="built_in">uname</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">uname</span> -a <span class="comment"># everything</span></span><br><span class="line"><span class="built_in">uname</span> -rsm</span><br></pre></td></tr></table></figure>

<p>2:50 How to see the current IP address on Linux?</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ifconfig</span><br><span class="line"></span><br><span class="line">ip addr</span><br><span class="line">ip addr show eth0</span><br></pre></td></tr></table></figure>

<p>4:03 How to check for free disk space in Linux?</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">man <span class="built_in">df</span></span><br><span class="line"><span class="built_in">df</span> -ah</span><br><span class="line"></span><br><span class="line"><span class="built_in">df</span> -T -h</span><br><span class="line"><span class="comment"># ?????</span></span><br><span class="line"><span class="built_in">du</span> -sh * | grep G</span><br></pre></td></tr></table></figure>

<p>6:33 How to check the size of a directory in Linux?</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">man <span class="built_in">du</span></span><br><span class="line"><span class="built_in">du</span> -sh directory_name/</span><br></pre></td></tr></table></figure>

<p>4:55 How to see if a Linux service is running?</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">service udev status</span><br><span class="line">systemctl status udev</span><br></pre></td></tr></table></figure>

<p>7:02 How to check for open ports in Linux?</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">man netstat</span><br><span class="line">netstat -tulpn</span><br><span class="line">sudo !! <span class="comment"># show PID/Program name</span></span><br></pre></td></tr></table></figure>

<p>9:48 How to check Linux process information (CPU usage, memory, user information, etc.)?</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ps -aux | grep ngrok</span><br><span class="line">top</span><br><span class="line">htop</span><br></pre></td></tr></table></figure>

<p>11:49 How to deal with mounts in Linux</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> /mnt</span><br><span class="line">mount /dev/sdb2 /mnt</span><br><span class="line">less /etc/fstab</span><br></pre></td></tr></table></figure>

<p>13:51 Man pages<br>15:04 Other resources</p>
]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>【Linux】frps内网穿透软件</title>
    <url>/linux/frps/</url>
    <content><![CDATA[<p>frps 是一个优秀的内网穿透软件。</p>
<p>frps 下载安装：<a href="https://github.com/fatedier/frp/releases">https://github.com/fatedier/frp/releases</a></p>
<p><strong>服务端:</strong> <code>./frps -c ./frps.ini</code></p>
<p>frps.ini</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_addr</span> = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">bind_udp_port</span> = <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dashboard_port</span> = <span class="number">7500</span></span><br><span class="line"><span class="attr">dashboard_user</span> = admin</span><br><span class="line"><span class="attr">dashboard_pwd</span> = admin</span><br><span class="line"></span><br><span class="line"><span class="attr">vhost_http_port</span> = <span class="number">2780</span></span><br><span class="line"><span class="attr">subdomain_host</span> = frps.example.com</span><br></pre></td></tr></table></figure>

<p><strong>客户端:</strong> <code>./frpc -c ./frpc.ini</code></p>
<p>frpc.ini</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = xx.xx.xx.xx</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">admin_addr</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">admin_port</span> = <span class="number">7400</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">7022</span></span><br><span class="line"></span><br><span class="line"><span class="section">[web]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="attr">local_port</span> = <span class="number">2780</span></span><br><span class="line"><span class="attr">subdomain</span> = <span class="literal">off</span>ice</span><br></pre></td></tr></table></figure>

<p>访问服务器端的 dashboard 查看统计信息: <code>http://frps.example.com:7500/</code></p>
<p>访问内网 ssh： <code>ssh -oPort=7022 test@x.x.x.x</code><br>通过浏览器访问内网机器: <code>http://office.frps.example.com:2780/</code></p>
<h2 id="配置自动启动"><a href="#配置自动启动" class="headerlink" title="配置自动启动"></a>配置自动启动</h2><p>安装 supervisor</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">apt install supervisor</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 supervisor 状态</span></span><br><span class="line">service supervisor status</span><br></pre></td></tr></table></figure>

<p>添加 frps 配置：<code>vi /etc/supervisor/conf.d/frps.conf</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[program:frps]</span><br><span class="line"><span class="built_in">command</span>=/root/c/frp/frps -c /root/c/frp/frps.ini</span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>可以依次运行下面操作加载 新加入的 frps</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 告诉 supervisor 新加了配置</span></span><br><span class="line">supervisorctl reread</span><br><span class="line"></span><br><span class="line"><span class="comment"># 让 supervisor 启动 frps</span></span><br><span class="line">supervisorctl update</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>输入 supervisorctl 查看 frps 是否已运行</p>
<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/202202082113352.png" alt="202202082113352"></p>
<p>start 和 stop frps<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/202202082114908.png" alt="202202082114908"></p>
<p>设置 supervisor 开机启动</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> supervisor.service</span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<p>为 supervisor 添加 dashboard，通过 9001 来访问：</p>
<p><code>vi /etc/supervisor/supervisord.conf</code> 添加下面代码</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[inet_http_server]</span><br><span class="line">port=*:9001</span><br><span class="line">username=admin</span><br><span class="line">password=admin</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/202202082135628.png" alt="202202082135628"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://github.com/fatedier/frp">https://github.com/fatedier/frp</a></p>
<p><a href="https://www.jianshu.com/p/219553bfeca9">通过 frp 实现访问内网 ssh 与 http 简明教程 - 简书</a></p>
<p><a href="https://www.atlantic.net/vps-hosting/how-to-install-and-configure-supervisor-on-ubuntu-20-04/">How to Install and Configure Supervisor on Ubuntu 20.04 | Atlantic.Net</a></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[program:nginx]</span></span><br><span class="line"><span class="attr">command</span>=/usr/sbin/nginx -g <span class="string">&quot;daemon off;&quot;</span></span><br><span class="line"><span class="attr">autostart</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">autorestart</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">startretries</span>=<span class="number">5</span></span><br><span class="line"><span class="attr">numprocs</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">startsecs</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">process_name</span>=%(program_name)s_%(process_num)<span class="number">02</span>d</span><br><span class="line"><span class="attr">stderr_logfile</span>=/var/log/supervisor/%(program_name)s_stderr.log</span><br><span class="line"><span class="attr">stderr_logfile_maxbytes</span>=<span class="number">10</span>MB</span><br><span class="line"><span class="attr">stdout_logfile</span>=/var/log/supervisor/%(program_name)s_stdout.log</span><br><span class="line"><span class="attr">stdout_logfile_maxbytes</span>=<span class="number">10</span>MB</span><br></pre></td></tr></table></figure>

<p><a href="https://www.92ez.com/?action=show&id=23484">使用 supervisor 设置服务端 frp 开机启动 - 一只猿 - 前端攻城尸 | 安全研究员 | 硬件控 | 业余极客 | 开源拥护者</a></p>
<p><a href="https://www.bookstack.cn/read/frp/README_zh.md">frp - 《frp 中文文档》 - 书栈网 · BookStack</a></p>
]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Command Editing Shortcuts</title>
    <url>/linux/key/</url>
    <content><![CDATA[<p>移除一句话中的某个单词的词尾：<br>如: select key<cursour_is_here>_error from table1;<br>如果想要删除<code>_error</code>，可以按<code>Alt+D</code>;</cursour_is_here></p>
<p>Bash Shortcuts For Maximum Productivity<br><a href="https://www.skorks.com/2009/09/bash-shortcuts-for-maximum-productivity/">https://www.skorks.com/2009/09/bash-shortcuts-for-maximum-productivity/</a></p>
<p>SKORKS<br>Bash Shortcuts For Maximum Productivity<br>September 15, 2009 By Alan Skorkin 82 Comments</p>
<p>MaximumIt may or may not surprise you to know that the bash shell has a very rich array of convenient shortcuts that can make your life, working with the command line, a whole lot easier. This ability to edit the command line using shortcuts is provided by the GNU Readline library. This library is used by many other *nix application besides bash, so learning some of these shortcuts will not only allow you to zip around bash commands with absurd ease :), but can also make you more proficient in using a variety of other *nix applications that use Readline. I don’t want to get into Readline too deeply so I’ll just mention one more thing. By default Readline uses emacs key bindings, although it can be configured to use the vi editing mode, I however prefer to learn the default behavior of most applications (I find it makes my life easier not having to constantly customize stuff). If you’re familiar with emacs then many of these shortcuts will not be new to you, so these are mostly for the rest of us :).<br>Command Editing Shortcuts</p>
<pre><code>Ctrl + a – go to the start of the command line
Ctrl + e – go to the end of the command line
Ctrl + k – delete from cursor to the end of the command line
Ctrl + u – delete from cursor to the start of the command line
Ctrl + w – delete from cursor to start of word (i.e. delete backwards one word)
Ctrl + y – paste word or text that was cut using one of the deletion shortcuts (such as the one above) after the cursor
Ctrl + xx – move between start of command line and current cursor position (and back again)
Alt + b – move backward one word (or go to start of word the cursor is currently on)
Alt + f – move forward one word (or go to end of word the cursor is currently on)
Alt + d – delete to end of word starting at cursor (whole word if cursor is at the beginning of word)
Alt + c – capitalize to end of word starting at cursor (whole word if cursor is at the beginning of word)
Alt + u – make uppercase from cursor to end of word
Alt + l – make lowercase from cursor to end of word
Alt + t – swap current word with previous
Ctrl + f – move forward one character
Ctrl + b – move backward one character
Ctrl + d – delete character under the cursor
Ctrl + h – delete character before the cursor
Ctrl + t – swap character under cursor with the previous one
</code></pre>
<p>Command Recall Shortcuts</p>
<pre><code>Ctrl + r – search the history backwards
Ctrl + g – escape from history searching mode
Ctrl + p – previous command in history (i.e. walk back through the command history)
Ctrl + n – next command in history (i.e. walk forward through the command history)
Alt + . – use the last word of the previous command
</code></pre>
<p>Command Control Shortcuts</p>
<pre><code>Ctrl + l – clear the screen
Ctrl + s – stops the output to the screen (for long running verbose command)
Ctrl + q – allow output to the screen (if previously stopped using command above)
Ctrl + c – terminate the command
Ctrl + z – suspend/stop the command
</code></pre>
<p>Bash Bang (!) Commands</p>
<p>Bash also has some handy features that use the ! (bang) to allow you to do some funky stuff with bash commands.</p>
<pre><code>!! – run last command
!blah – run the most recent command that starts with ‘blah’ (e.g. !ls)
!blah:p – print out the command that !blah would run (also adds it as the latest command in the command history)
!$ – the last word of the previous command (same as Alt + .)
!$:p – print out the word that !$ would substitute
!* – the previous command except for the last word (e.g. if you type ‘find some_file.txt /‘, then !* would give you ‘find some_file.txt‘)
!*:p – print out what !* would substitute
</code></pre>
]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux管理工具</title>
    <url>/linux/manager/</url>
    <content><![CDATA[<h1 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h1><h2 id="supervisor-进程管理工具"><a href="#supervisor-进程管理工具" class="headerlink" title="supervisor 进程管理工具"></a>supervisor 进程管理工具</h2><ul>
<li><a href="http://supervisord.org/">Supervisor: A Process Control System — Supervisor 4.0.3 documentation</a></li>
<li><a href="https://blog.csdn.net/xyang81/article/details/51555473">Supervisor 安装与配置（Linux/Unix 进程管理工具） - CSDN 博客</a></li>
<li><a href="https://www.cnblogs.com/smail-bao/p/5673434.html">supervisor - BigBao 的博客 - 博客园</a></li>
</ul>
<h1 id="磁盘管理"><a href="#磁盘管理" class="headerlink" title="磁盘管理"></a>磁盘管理</h1><h2 id="空间"><a href="#空间" class="headerlink" title="空间"></a>空间</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">df</span> -a <span class="comment">#  显示目前在Linux系统上的文件系统的磁盘使用情况统计</span></span><br><span class="line"><span class="built_in">du</span> -sh * <span class="comment"># 显示当前目录或文件所占用的磁盘空间. -s表示总计，-h是以K，M，G为单位，提高信息的可读性</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/var/log/journal/</span><br><span class="line">journalctl --vacuum-size=10M</span><br><span class="line">journalctl --disk-usage</span><br><span class="line"><span class="comment"># https://blog.csdn.net/ithomer/article/details/89530790</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看某个目录的文件大小并排序（单位为MB）</span></span><br><span class="line"><span class="built_in">du</span> -hm --max-depth=1 /var/ | <span class="built_in">sort</span> -n</span><br></pre></td></tr></table></figure>

<h2 id="自动挂载-E-盘"><a href="#自动挂载-E-盘" class="headerlink" title="自动挂载 E 盘"></a><a href="https://askubuntu.com/questions/46588/how-to-automount-ntfs-partitions">自动挂载 E 盘</a></h2><ul>
<li><code>vi /etc/fstab</code> &amp; add below line</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Windows-Partition</span></span><br><span class="line">UUID=0004D1FE0007434B /home/lou/e ntfs rw,auto,<span class="built_in">users</span>,<span class="built_in">exec</span>,nls=utf8,<span class="built_in">umask</span>=003,gid=46,uid=1000    0   0</span><br></pre></td></tr></table></figure>

<ul>
<li>Finding which disk you will set</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo fdisk -l</span><br></pre></td></tr></table></figure>

<ul>
<li>Finding the UUID</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo blkid</span><br></pre></td></tr></table></figure>

<ul>
<li>Check it</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">sudo mount -<span class="selector-tag">a</span></span><br></pre></td></tr></table></figure>

<p>设置 image:</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//mi</span>rros.aliyun.com/ubuntu</span><br></pre></td></tr></table></figure>

<h2 id="pm2"><a href="#pm2" class="headerlink" title="pm2"></a>pm2</h2><h1 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h1><ul>
<li>修改文件的所有者和所属组：</li>
</ul>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">sudo chown -R OWNER:<span class="keyword">GROUP</span> <span class="title">/www</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="http://blog.51cto.com/jschu/1722959">修改用户所在组，group，usermod-J S Chu 的技术家园-51CTO 博客</a></li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">usermod -g 用户组 用户名</span><br><span class="line">    强制修改用户所在组</span><br><span class="line">usermod -<span class="selector-tag">a</span> -G 用户组 用户名</span><br><span class="line">    把某个用户添加进某个组</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Samba</title>
    <url>/linux/samba/</url>
    <content><![CDATA[<p><a href="https://tutorials.ubuntu.com/tutorial/install-and-configure-samba#0">https://tutorials.ubuntu.com/tutorial/install-and-configure-samba#0</a></p>
<p><a href="https://blog.csdn.net/wbaction/article/details/72758673">https://blog.csdn.net/wbaction/article/details/72758673</a></p>
<h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get install samba</span><br></pre></td></tr></table></figure>
<h2 id="config"><a href="#config" class="headerlink" title="config"></a>config</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/samba/smb.conf</span><br></pre></td></tr></table></figure>

<p>添加在后面</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[smbshare]</span></span><br><span class="line">    <span class="attr">comment</span> = samba home directory </span><br><span class="line">    <span class="attr">path</span> = /home/user/w/smbshare</span><br><span class="line">    <span class="attr">public</span> = <span class="literal">yes</span></span><br><span class="line">    <span class="attr">browseable</span> = <span class="literal">yes</span></span><br><span class="line">    <span class="attr">public</span> = <span class="literal">yes</span></span><br><span class="line">    read <span class="attr">only</span> = <span class="literal">no</span></span><br><span class="line">    valid <span class="attr">users</span> = user</span><br><span class="line">    create <span class="attr">mask</span> = <span class="number">0777</span></span><br><span class="line">    directory <span class="attr">mask</span> = <span class="number">0777</span> </span><br><span class="line">    force <span class="attr">user</span> = nobody</span><br><span class="line">    force <span class="attr">group</span> = nogroup</span><br><span class="line">    <span class="attr">available</span> = <span class="literal">yes</span></span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">```sh</span><br><span class="line">chmod 777 /home/user/w/smbshare</span><br></pre></td></tr></table></figure>

<h2 id="add-user"><a href="#add-user" class="headerlink" title="add user"></a>add user</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo smbpasswd -a <span class="variable">$USER</span></span><br></pre></td></tr></table></figure>

<h2 id="restart"><a href="#restart" class="headerlink" title="restart"></a>restart</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo service smbd restart</span><br></pre></td></tr></table></figure>

<h2 id="uninstall"><a href="#uninstall" class="headerlink" title="uninstall"></a>uninstall</h2><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">sudo apt <span class="built_in">remove</span> <span class="comment">--purge samba samba-common</span></span><br></pre></td></tr></table></figure>

<h2 id="reinstall"><a href="#reinstall" class="headerlink" title="reinstall"></a>reinstall</h2><p>sudo apt remove –purge samba samba-common<br>sudo apt install samba</p>
]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Sftp</title>
    <url>/linux/sftp/</url>
    <content><![CDATA[<h2 id="帮助文档"><a href="#帮助文档" class="headerlink" title="帮助文档"></a>帮助文档</h2><p>sftp&gt; help</p>
<h2 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h2><p>类似 <code>ssh</code> 的用法</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sftp lilou@192.168.0.1</span><br></pre></td></tr></table></figure>

<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><table>
<thead>
<tr>
<th>命令描述</th>
<th>命令（远程/本地)</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>切换目录</td>
<td>cd/lcd</td>
<td>cd /tmp</td>
</tr>
<tr>
<td>显示目录</td>
<td>pwd/lpwd</td>
<td>pwd</td>
</tr>
<tr>
<td>下载到本地</td>
<td>get</td>
<td><code>get a.txt</code> <code>get -r /tmp/dir/ /local/tmp/dir</code></td>
</tr>
<tr>
<td>上传到远程</td>
<td>put</td>
<td><code>put a.txt a.txt</code> <code>put -r /local/tmp/dir/ /tmp/dir/</code></td>
</tr>
</tbody></table>
<h2 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h2><ul>
<li><a href="https://blog.zfanw.com/sftp/#%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E5%A4%B9">SFTP 用法</a></li>
<li><a href="https://www.cnblogs.com/chen1987lei/archive/2010/11/26/1888391.html">linux 下如何使用 sftp 命令 - BradyChen - 博客园</a></li>
</ul>
]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>【Linux】shell</title>
    <url>/linux/shell/</url>
    <content><![CDATA[<ul>
<li><a href="https://blog.csdn.net/u012373815/article/details/62076793">shell 基础 $(cd <code>dirname $0</code>;pwd) - 哎幽的成长 - CSDN 博客</a></li>
</ul>
<p>在/home/admin/test/下新建 test.sh 内容如下：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> `<span class="built_in">dirname</span> <span class="variable">$0</span>`</span><br><span class="line"><span class="built_in">echo</span> `<span class="built_in">pwd</span>`</span><br></pre></td></tr></table></figure>

<p>然后返回到/home/admin/执行<br><code>sh test/test.sh</code><br>运行结果:<br><code>/home/admin/test</code></p>
<h2 id="查看网络连接数情况"><a href="#查看网络连接数情况" class="headerlink" title="查看网络连接数情况"></a>查看网络连接数情况</h2><p>netstat -an|awk ‘/tcp/ {print $6}’|sort|uniq -c</p>
<h2 id="查看一下你最常用的-10-个命令"><a href="#查看一下你最常用的-10-个命令" class="headerlink" title="查看一下你最常用的 10 个命令"></a>查看一下你最常用的 10 个命令</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> .bash_history | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -rn | <span class="built_in">head</span> -n 10</span><br></pre></td></tr></table></figure>

<h2 id="查看端口号占用情况"><a href="#查看端口号占用情况" class="headerlink" title="查看端口号占用情况"></a>查看端口号占用情况</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ss -nelp | grep 8080</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>【Shell】ssh</title>
    <url>/linux/ssh/</url>
    <content><![CDATA[<h2 id="connection-refused"><a href="#connection-refused" class="headerlink" title="connection refused"></a>connection refused</h2><p><a href="https://askubuntu.com/questions/30080/how-to-solve-connection-refused-errors-in-ssh-connection">https://askubuntu.com/questions/30080/how-to-solve-connection-refused-errors-in-ssh-connection</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get install openssh-server openssh-client</span><br></pre></td></tr></table></figure>

<h2 id="将-ssh-keys-复制到-user-host-以启用无密码-SSH-登录。"><a href="#将-ssh-keys-复制到-user-host-以启用无密码-SSH-登录。" class="headerlink" title="将 ssh keys 复制到 user@host 以启用无密码 SSH 登录。"></a>将 ssh keys 复制到 user@host 以启用无密码 SSH 登录。</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ssh</span>-copy-id user@host</span><br></pre></td></tr></table></figure>

<h2 id="将本地的文本文件保存到远程服务端中"><a href="#将本地的文本文件保存到远程服务端中" class="headerlink" title="将本地的文本文件保存到远程服务端中"></a>将本地的文本文件保存到远程服务端中</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.ssh/id_rsa.pub | ssh user@123.45.56.78 <span class="string">&quot;mkdir -p ~/.ssh &amp;&amp; cat &gt;&gt;  ~/.ssh/authorized_keys&quot;</span></span><br><span class="line">https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys--2</span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://www.howtogeek.com/168147/add-public-ssh-key-to-remote-server-in-a-single-command/">Add Public SSH Key to Remote Server in a Single Command</a></li>
</ul>
<h2 id="bash-How-can-I-ssh-directly-to-a-particular-directory-Stack-Overflow"><a href="#bash-How-can-I-ssh-directly-to-a-particular-directory-Stack-Overflow" class="headerlink" title="bash - How can I ssh directly to a particular directory? - Stack Overflow"></a><a href="https://stackoverflow.com/questions/626533/how-can-i-ssh-directly-to-a-particular-directory">bash - How can I ssh directly to a particular directory? - Stack Overflow</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ssh -t xxx.xxx.xxx.xxx <span class="string">&quot;cd /directory_wanted; bash&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="How-to-enter-ssh-password-using-bash"><a href="#How-to-enter-ssh-password-using-bash" class="headerlink" title="How to enter ssh password using bash? "></a><a href="https://stackoverflow.com/questions/16928004/how-to-enter-ssh-password-using-bash">How to enter ssh password using bash? </a></h2><blockquote>
<p>Create a new keypair: (go with the defaults)<br><code>ssh-keygen</code></p>
</blockquote>
<blockquote>
<p>Copy the public key to the server: (password for the last time)<br><code>ssh-copy-id user@my.server.com</code></p>
</blockquote>
<blockquote>
<p>From now on the server should recognize your key and not ask you for the password anymore:<br><code>ssh user@my.server.com</code></p>
</blockquote>
<h2 id="设置ngrok域名"><a href="#设置ngrok域名" class="headerlink" title="设置ngrok域名"></a>设置ngrok域名</h2><ul>
<li>ngrok -proto=tcp 22</li>
<li>ssh -p 3894 <a href="mailto:&#x6c;&#x69;&#x6c;&#x6f;&#117;&#64;&#x6e;&#103;&#114;&#x6f;&#x6b;&#x2e;&#108;&#x79;&#x6c;&#111;&#111;&#x75;&#x2e;&#99;&#x6f;&#x6d;">&#x6c;&#x69;&#x6c;&#x6f;&#117;&#64;&#x6e;&#103;&#114;&#x6f;&#x6b;&#x2e;&#108;&#x79;&#x6c;&#111;&#111;&#x75;&#x2e;&#99;&#x6f;&#x6d;</a></li>
<li><a href="https://www.zhihu.com/question/27771692">如何远程登录家里的Ubuntu电脑(命令行模式)？</a></li>
<li><a href="https://blog.csdn.net/sethqqq/article/details/77033154">https://blog.csdn.net/sethqqq/article/details/77033154</a></li>
</ul>
<h2 id="ssh-connect-to-host-localhost-port-22-Connection-refused"><a href="#ssh-connect-to-host-localhost-port-22-Connection-refused" class="headerlink" title="ssh: connect to host localhost port 22: Connection refused"></a><a href="https://blog.csdn.net/jszhangyili/article/details/8881807">ssh: connect to host localhost port 22: Connection refused</a></h2><p>错误原因：<br>1.sshd 未安装<br>2.sshd 未启动<br>3.防火墙<br>解决方法：<br>1.确定安装sshd:<br><code>$ sudo apt-get install openssh-server  </code><br>2.启动sshd:<br><code>$ sudo net start sshd  </code><br>3.检查防火墙设置,关闭防火墙：<br><code>$ sudo ufw disable   </code><br>检验方法，输入命令：<br><code>$ ssh localhost  </code><br>若成功，则表示安装成功，且连接通过；<br>但是有的时候虽然成功了但是还是会出现Connection refused 问题。<br>运行 ps -e | grep ssh，查看是否有sshd进程：<br>有时候虽然可以看到sshd 但是还是不能连接成功<br>这时候就要想到重新启动一下：sudo service ssh restart</p>
<h2 id><a href="#" class="headerlink" title></a></h2>]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Tmux</title>
    <url>/linux/tmux/</url>
    <content><![CDATA[<h2 id="install-on-Ubuntu"><a href="#install-on-Ubuntu" class="headerlink" title="install on Ubuntu"></a>install on Ubuntu</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Steps to build and install tmux from source on Ubuntu.</span></span><br><span class="line"><span class="comment"># Takes &lt; 25 seconds on EC2 env [even on a low-end config instance].</span></span><br><span class="line">VERSION=2.8</span><br><span class="line">sudo apt-get -y remove tmux</span><br><span class="line">sudo apt-get -y install wget tar libevent-dev libncurses-dev</span><br><span class="line">wget https://github.com/tmux/tmux/releases/download/<span class="variable">$&#123;VERSION&#125;</span>/tmux-<span class="variable">$&#123;VERSION&#125;</span>.tar.gz</span><br><span class="line">tar xf tmux-<span class="variable">$&#123;VERSION&#125;</span>.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -f tmux-<span class="variable">$&#123;VERSION&#125;</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> tmux-<span class="variable">$&#123;VERSION&#125;</span></span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"><span class="built_in">cd</span> -</span><br><span class="line">sudo <span class="built_in">rm</span> -rf /usr/local/src/tmux-*</span><br><span class="line">sudo <span class="built_in">mv</span> tmux-<span class="variable">$&#123;VERSION&#125;</span> /usr/local/src</span><br><span class="line"></span><br><span class="line"><span class="comment">## Logout and login to the shell again and run.</span></span><br><span class="line">tmux -V</span><br></pre></td></tr></table></figure>

<h2 id="install-on-centos"><a href="#install-on-centos" class="headerlink" title="install on centos"></a>install on centos</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># [Install tmux 2.8 on centos 7](https://gist.github.com/pokev25/4b9516d32f4021d945a140df09bf1fde)</span></span><br><span class="line"><span class="comment"># Install tmux 2.8 on Centos</span></span><br><span class="line">VERSION=2.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># install deps</span></span><br><span class="line">yum install gcc kernel-devel make ncurses-devel</span><br><span class="line"></span><br><span class="line"><span class="comment"># DOWNLOAD SOURCES FOR LIBEVENT AND MAKE AND INSTALL</span></span><br><span class="line">curl -LOk https://github.com/libevent/libevent/releases/download/release-2.1.8-stable/libevent-2.1.8-stable.tar.gz</span><br><span class="line">tar -xf libevent-2.1.8-stable.tar.gz</span><br><span class="line"><span class="built_in">cd</span> libevent-2.1.8-stable</span><br><span class="line">./configure --prefix=/usr/local</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># DOWNLOAD SOURCES FOR TMUX AND MAKE AND INSTALL</span></span><br><span class="line"></span><br><span class="line">curl -LOk https://github.com/tmux/tmux/releases/download/<span class="variable">$&#123;VERSION&#125;</span>/tmux-<span class="variable">$&#123;VERSION&#125;</span>.tar.gz</span><br><span class="line">tar -xf tmux-<span class="variable">$&#123;VERSION&#125;</span>.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -f tmux-<span class="variable">$&#123;VERSION&#125;</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> tmux-<span class="variable">$&#123;VERSION&#125;</span></span><br><span class="line">LDFLAGS=<span class="string">&quot;-L/usr/local/lib -Wl,-rpath=/usr/local/lib&quot;</span> ./configure --prefix=/usr/local</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"><span class="built_in">cd</span> -</span><br><span class="line">sudo <span class="built_in">rm</span> -rf /usr/local/src/tmux-*</span><br><span class="line">sudo <span class="built_in">mv</span> tmux-<span class="variable">$&#123;VERSION&#125;</span> /usr/local/src</span><br><span class="line"></span><br><span class="line"><span class="comment"># pkill tmux</span></span><br><span class="line"><span class="comment"># close your terminal window (flushes cached tmux executable)</span></span><br><span class="line"><span class="comment"># open new shell and check tmux version</span></span><br><span class="line">tmux -V</span><br></pre></td></tr></table></figure>

<h2 id="Tmux-快捷键-amp-速查表"><a href="#Tmux-快捷键-amp-速查表" class="headerlink" title="Tmux 快捷键 &amp; 速查表"></a><a href="https://gist.github.com/ryerh/14b7c24dfd623ef8edc7">Tmux 快捷键 &amp; 速查表</a></h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bind r source-file ~/.tmux.conf \; display-message &quot;Config reloaded&quot;</span><br><span class="line"></span><br><span class="line">bind &#x27;&quot;&#x27; split-window -c &#x27;#&#123;pane_current_path&#125;&#x27;</span><br><span class="line">bind &#x27;%&#x27; split-window -h -c &#x27;#&#123;pane_current_path&#125;&#x27;</span><br><span class="line"></span><br><span class="line">bind Escape copy-mode</span><br><span class="line">bind-key -Tcopy-mode-vi &#x27;v&#x27; send -X begin-selection</span><br><span class="line">bind-key -Tcopy-mode-vi &#x27;y&#x27; send -X copy-selection</span><br><span class="line">unbind p</span><br><span class="line">bind p pasteb</span><br><span class="line">setw -g mode-keys vi      # Vi风格选择文本</span><br><span class="line"># set-window-option -g mode-keys vi</span><br><span class="line"></span><br><span class="line"># https://stackoverflow.com/questions/17445100/getting-back-old-copy-paste-behaviour-in-tmux-with-mouse</span><br><span class="line">set -g mouse off # 不启用鼠标（启用鼠标会导致无法复制到系统）</span><br><span class="line"></span><br><span class="line">########### myself ##########</span><br><span class="line"># select panel</span><br><span class="line">bind k selectp -U</span><br><span class="line">bind j selectp -D</span><br><span class="line">bind h selectp -L</span><br><span class="line">bind l selectp -R</span><br><span class="line"></span><br><span class="line">set-option -g default-shell /bin/zsh</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://superuser.com/questions/428016/how-do-i-rename-a-session-in-tmux">How do I rename a session in tmux? - Super User</a><br><code>Ctrl</code> + <code>B</code>, <code>$</code></li>
</ul>
]]></content>
      <tags>
        <tag>linux</tag>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu相关</title>
    <url>/linux/ubuntu/</url>
    <content><![CDATA[<h1 id="Ubuntu-更换阿里云软件源"><a href="#Ubuntu-更换阿里云软件源" class="headerlink" title="Ubuntu 更换阿里云软件源"></a>Ubuntu 更换阿里云软件源</h1><h2 id="1-备份"><a href="#1-备份" class="headerlink" title="1. 备份"></a>1. 备份</h2><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo cp <span class="regexp">/etc/</span>apt<span class="regexp">/sources.list /</span>etc<span class="regexp">/apt/</span>sources.list.bak</span><br></pre></td></tr></table></figure>

<h2 id="2-修改"><a href="#2-修改" class="headerlink" title="2.修改"></a>2.修改</h2><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo vim <span class="regexp">/etc/</span>apt/sources.list</span><br></pre></td></tr></table></figure>

<p>将 source.list 文件内容替换成下面的</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">deb http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/ubuntu/</span> trusty main restricted universe multiverse</span><br><span class="line">deb http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/ubuntu/</span> trusty-security main restricted universe multiverse</span><br><span class="line">deb http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/ubuntu/</span> trusty-updates main restricted universe multiverse</span><br><span class="line">deb http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/ubuntu/</span> trusty-proposed main restricted universe multiverse</span><br><span class="line">deb http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/ubuntu/</span> trusty-backports main restricted universe multiverse</span><br><span class="line">deb-src http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/ubuntu/</span> trusty main restricted universe multiverse</span><br><span class="line">deb-src http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/ubuntu/</span> trusty-security main restricted universe multiverse</span><br><span class="line">deb-src http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/ubuntu/</span> trusty-updates main restricted universe multiverse</span><br><span class="line">deb-src http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/ubuntu/</span> trusty-proposed main restricted universe multiverse</span><br><span class="line">deb-src http:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/ubuntu/</span> trusty-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>

<h2 id="3-更新"><a href="#3-更新" class="headerlink" title="3. 更新"></a>3. 更新</h2><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">update</span></span><br></pre></td></tr></table></figure>

<p><a href="https://developer.aliyun.com/article/704603">Ubuntu 更换阿里云软件源-阿里云开发者社区</a></p>
<h2 id="默认源"><a href="#默认源" class="headerlink" title="默认源"></a>默认源</h2><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># deb cdrom:[Ubuntu 18.04.3 LTS _Bionic Beaver_ - Release amd64 (20190805)]/ bionic main restricted</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See http://help.ubuntu.com/community/UpgradeNotes for how to upgrade to</span></span><br><span class="line"><span class="comment"># newer versions of the distribution.</span></span><br><span class="line">deb http:<span class="regexp">//u</span>s.archive.ubuntu.com<span class="regexp">/ubuntu/</span> bionic main restricted</span><br><span class="line"><span class="comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic main restricted</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Major bug fix updates produced after the final release of the</span></span><br><span class="line"><span class="comment">## distribution.</span></span><br><span class="line">deb http:<span class="regexp">//u</span>s.archive.ubuntu.com<span class="regexp">/ubuntu/</span> bionic-updates main restricted</span><br><span class="line"><span class="comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic-updates main restricted</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu</span></span><br><span class="line"><span class="comment">## team. Also, please note that software in universe WILL NOT receive any</span></span><br><span class="line"><span class="comment">## review or updates from the Ubuntu security team.</span></span><br><span class="line">deb http:<span class="regexp">//u</span>s.archive.ubuntu.com<span class="regexp">/ubuntu/</span> bionic universe</span><br><span class="line"><span class="comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic universe</span></span><br><span class="line">deb http:<span class="regexp">//u</span>s.archive.ubuntu.com<span class="regexp">/ubuntu/</span> bionic-updates universe</span><br><span class="line"><span class="comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic-updates universe</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu</span></span><br><span class="line"><span class="comment">## team, and may not be under a free licence. Please satisfy yourself as to</span></span><br><span class="line"><span class="comment">## your rights to use the software. Also, please note that software in</span></span><br><span class="line"><span class="comment">## multiverse WILL NOT receive any review or updates from the Ubuntu</span></span><br><span class="line"><span class="comment">## security team.</span></span><br><span class="line">deb http:<span class="regexp">//u</span>s.archive.ubuntu.com<span class="regexp">/ubuntu/</span> bionic multiverse</span><br><span class="line"><span class="comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic multiverse</span></span><br><span class="line">deb http:<span class="regexp">//u</span>s.archive.ubuntu.com<span class="regexp">/ubuntu/</span> bionic-updates multiverse</span><br><span class="line"><span class="comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic-updates multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## N.B. software from this repository may not have been tested as</span></span><br><span class="line"><span class="comment">## extensively as that contained in the main release, although it includes</span></span><br><span class="line"><span class="comment">## newer versions of some applications which may provide useful features.</span></span><br><span class="line"><span class="comment">## Also, please note that software in backports WILL NOT receive any review</span></span><br><span class="line"><span class="comment">## or updates from the Ubuntu security team.</span></span><br><span class="line">deb http:<span class="regexp">//u</span>s.archive.ubuntu.com<span class="regexp">/ubuntu/</span> bionic-backports main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic-backports main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Uncomment the following two lines to add software from Canonical&#x27;s</span></span><br><span class="line"><span class="comment">## &#x27;partner&#x27; repository.</span></span><br><span class="line"><span class="comment">## This software is not part of Ubuntu, but is offered by Canonical and the</span></span><br><span class="line"><span class="comment">## respective vendors as a service to Ubuntu users.</span></span><br><span class="line"><span class="comment"># deb http://archive.canonical.com/ubuntu bionic partner</span></span><br><span class="line"><span class="comment"># deb-src http://archive.canonical.com/ubuntu bionic partner</span></span><br><span class="line"></span><br><span class="line">deb http:<span class="regexp">//</span>security.ubuntu.com/ubuntu bionic-security main restricted</span><br><span class="line"><span class="comment"># deb-src http://security.ubuntu.com/ubuntu bionic-security main restricted</span></span><br><span class="line">deb http:<span class="regexp">//</span>security.ubuntu.com/ubuntu bionic-security universe</span><br><span class="line"><span class="comment"># deb-src http://security.ubuntu.com/ubuntu bionic-security universe</span></span><br><span class="line">deb http:<span class="regexp">//</span>security.ubuntu.com/ubuntu bionic-security multiverse</span><br><span class="line"><span class="comment"># deb-src http://security.ubuntu.com/ubuntu bionic-security multiverse</span></span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/qq_34039018/article/details/103837158">Ubuntu18.04 中默认的软件源 sources.list_谷永普的博客-CSDN 博客</a></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span></span><br><span class="line">deb https:<span class="regexp">//mi</span>rrors.tuna.tsinghua.edu.cn<span class="regexp">/ubuntu/</span> bionic main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span></span><br><span class="line">deb https:<span class="regexp">//mi</span>rrors.tuna.tsinghua.edu.cn<span class="regexp">/ubuntu/</span> bionic-updates main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span></span><br><span class="line">deb https:<span class="regexp">//mi</span>rrors.tuna.tsinghua.edu.cn<span class="regexp">/ubuntu/</span> bionic-backports main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span></span><br><span class="line">deb https:<span class="regexp">//mi</span>rrors.tuna.tsinghua.edu.cn<span class="regexp">/ubuntu/</span> bionic-security main restricted universe multiverse</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预发布软件源，不建议启用</span></span><br><span class="line"><span class="comment"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span></span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/fanqisoft/p/10753092.html">Ubuntu18.04 更换官方默认更新源 sources.list - SpringCore - 博客园</a></p>
<h2 id="终端显示乱码"><a href="#终端显示乱码" class="headerlink" title="终端显示乱码"></a>终端显示乱码</h2><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. 配置locale-gen</span><br><span class="line">终端执行</span><br><span class="line"></span><br><span class="line">sudo locale-gen zh_CN<span class="selector-class">.UTF-8</span></span><br><span class="line"></span><br><span class="line">配置完后检查中文显示是否正常，若仍然不正常执行第二步</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. 配置语言环境变量</span><br><span class="line">复制以下命令，终端执行</span><br><span class="line"></span><br><span class="line">export LANG=en_US<span class="selector-class">.UTF-8</span></span><br><span class="line">export LANGUAGE=</span><br><span class="line">export LC_CTYPE=<span class="string">&quot;en_US.UTF-8&quot;</span></span><br><span class="line">export LC_NUMERIC=zh_CN<span class="selector-class">.UTF-8</span></span><br><span class="line">export LC_TIME=zh_CN<span class="selector-class">.UTF-8</span></span><br><span class="line">export LC_COLLATE=<span class="string">&quot;en_US.UTF-8&quot;</span></span><br><span class="line">export LC_MONETARY=zh_CN<span class="selector-class">.UTF-8</span></span><br><span class="line">export LC_MESSAGES=<span class="string">&quot;en_US.UTF-8&quot;</span></span><br><span class="line">export LC_PAPER=zh_CN<span class="selector-class">.UTF-8</span></span><br><span class="line">export LC_NAME=zh_CN<span class="selector-class">.UTF-8</span></span><br><span class="line">export LC_ADDRESS=zh_CN<span class="selector-class">.UTF-8</span></span><br><span class="line">export LC_TELEPHONE=zh_CN<span class="selector-class">.UTF-8</span></span><br><span class="line">export LC_MEASUREMENT=zh_CN<span class="selector-class">.UTF-8</span></span><br><span class="line">export LC_IDENTIFICATION=zh_CN<span class="selector-class">.UTF-8</span></span><br><span class="line">export LC_ALL=</span><br><span class="line"></span><br><span class="line">到第二步问题一般都解决了</span><br><span class="line">若仍然不正常，可以重启试试</span><br><span class="line">————————————————</span><br><span class="line">原文链接：https:<span class="comment">//blog.csdn.net/weixin_39198406/article/details/82177944</span></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Vim</title>
    <url>/linux/vim/</url>
    <content><![CDATA[<h2 id="How-to-change-visudo-editor-from-nano-to-vim"><a href="#How-to-change-visudo-editor-from-nano-to-vim" class="headerlink" title="How to change visudo editor from nano to vim?"></a><a href="https://askubuntu.com/questions/539243/how-to-change-visudo-editor-from-nano-to-vim">How to change visudo editor from nano to vim?</a></h2><p><code>sudo update-alternatives --config editor</code></p>
<h2 id="Vim-Plug"><a href="#Vim-Plug" class="headerlink" title="Vim-Plug"></a>Vim-Plug</h2><p><a href="https://github.com/junegunn/vim-plug">https://github.com/junegunn/vim-plug</a></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">curl -fLo ~<span class="regexp">/.vim/</span>autoload/plug.vim --create-dirs \</span><br><span class="line">    https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/junegunn/</span>vim-plug<span class="regexp">/master/</span>plug.vim</span><br></pre></td></tr></table></figure>

<h2 id="用-vim-编辑上一次输入的命令"><a href="#用-vim-编辑上一次输入的命令" class="headerlink" title="用 vim 编辑上一次输入的命令"></a>用 vim 编辑上一次输入的命令</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">fc</span></span><br></pre></td></tr></table></figure>

<h2 id="当你在-vi-中修改了半天配置文件-然后发现没有写权限-没有比这更令人感到挫败了-此时你需要这条命令。"><a href="#当你在-vi-中修改了半天配置文件-然后发现没有写权限-没有比这更令人感到挫败了-此时你需要这条命令。" class="headerlink" title="当你在 vi 中修改了半天配置文件,然后发现没有写权限,没有比这更令人感到挫败了,此时你需要这条命令。"></a><a href="http://mingxinglai.com/cn/2012/08/you-had-better-know-instruction/">当你在 vi 中修改了半天配置文件,然后发现没有写权限,没有比这更令人感到挫败了,此时你需要这条命令。</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">:w !sudo <span class="built_in">tee</span> %</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">:w ! sudo <span class="built_in">tee</span> %</span><br><span class="line"></span><br><span class="line"><span class="comment"># occur error</span></span><br><span class="line">:w! sudo <span class="built_in">tee</span> %</span><br></pre></td></tr></table></figure>

<h2 id="Alternative-tab-navigation-Vim-Tips-Wiki-FANDOM-powered-by-Wikia"><a href="#Alternative-tab-navigation-Vim-Tips-Wiki-FANDOM-powered-by-Wikia" class="headerlink" title="Alternative tab navigation | Vim Tips Wiki | FANDOM powered by Wikia"></a><a href="http://vim.wikia.com/wiki/Alternative_tab_navigation">Alternative tab navigation | Vim Tips Wiki | FANDOM powered by Wikia</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot; Tab navigation like Firefox.</span></span><br><span class="line"><span class="string">nnoremap &lt;C-S-tab&gt; :tabprevious&lt;CR&gt;</span></span><br><span class="line"><span class="string">nnoremap &lt;C-tab&gt;   :tabnext&lt;CR&gt;</span></span><br><span class="line"><span class="string">inoremap &lt;C-S-tab&gt; &lt;Esc&gt;:tabprevious&lt;CR&gt;i</span></span><br><span class="line"><span class="string">inoremap &lt;C-tab&gt;   &lt;Esc&gt;:tabnext&lt;CR&gt;i</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">nnoremap &lt;C-PageDown&gt; :tabprevious&lt;CR&gt;</span></span><br><span class="line"><span class="string">nnoremap &lt;C-PageUp&gt;   :tabnext&lt;CR&gt;</span></span><br><span class="line"><span class="string">inoremap &lt;C-PageDown&gt; &lt;Esc&gt;:tabprevious&lt;CR&gt;i</span></span><br><span class="line"><span class="string">inoremap &lt;C-PageUp&gt;   &lt;Esc&gt;:tabnext&lt;CR&gt;i</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">nnoremap &lt;C-t&gt;     :tabnew&lt;CR&gt;</span></span><br><span class="line"><span class="string">inoremap &lt;C-t&gt;     &lt;Esc&gt;:tabnew&lt;CR&gt;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h2 id="vim-插件-delimitmate-符号自动补全"><a href="#vim-插件-delimitmate-符号自动补全" class="headerlink" title="vim 插件: delimitmate[符号自动补全] "></a><a href="http://www.wklken.me/posts/2015/06/07/vim-plugin-delimitmate.html">vim 插件: delimitmate[符号自动补全] </a></h2><blockquote>
<p>触发后, 假设你要跳到补全后的符号后面继续编辑, 按 Shift-Tab</p>
</blockquote>
<h2 id="You-don’t-need-more-than-one-cursor-in-vim"><a href="#You-don’t-need-more-than-one-cursor-in-vim" class="headerlink" title="You don’t need more than one cursor in vim"></a><a href="https://medium.com/@schtoeffel/you-don-t-need-more-than-one-cursor-in-vim-2c44117d51db">You don’t need more than one cursor in vim</a></h2><h2 id="vim-插件-easy-align-快速对齐"><a href="#vim-插件-easy-align-快速对齐" class="headerlink" title="vim 插件: easy-align[快速对齐] "></a><a href="http://www.wklken.me/posts/2015/06/07/vim-plugin-easyalign.html">vim 插件: easy-align[快速对齐] </a></h2><h2 id="分享-关于-vim"><a href="#分享-关于-vim" class="headerlink" title="[分享]关于 vim "></a><a href="http://www.wklken.me/posts/2016/07/24/about-vim.html">[分享]关于 vim </a></h2><h2 id="vim-文本行逆序化-my-live-123-CSDN-博客-vim-倒序"><a href="#vim-文本行逆序化-my-live-123-CSDN-博客-vim-倒序" class="headerlink" title="vim 文本行逆序化_my_live_123-CSDN 博客_vim 倒序"></a><a href="https://blog.csdn.net/cwcmcw/article/details/44876267">vim 文本行逆序化_my_live_123-CSDN 博客_vim 倒序</a></h2><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">要求</span><br><span class="line"></span><br><span class="line">示例：将文本</span><br><span class="line"><span class="number">1234</span></span><br><span class="line"><span class="number">123</span></span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">转换成</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">123</span></span><br><span class="line"><span class="number">1234</span></span><br><span class="line">命令</span><br><span class="line"></span><br><span class="line">:g<span class="regexp">/.*/m</span>o0</span><br><span class="line">或者</span><br><span class="line">:g<span class="regexp">/^/m</span>o0</span><br><span class="line"></span><br><span class="line">补充说明</span><br><span class="line">原理是从第一行开始，匹配每一行，然后执行mo（move）操作移动到第<span class="number">0</span>行。如此处理每一行，直到文本末行。执行完毕文本逆序化成功！</span><br><span class="line">&gt; https:<span class="regexp">//</span>blog.csdn.net<span class="regexp">/cwcmcw/</span>article<span class="regexp">/details/</span><span class="number">44876267</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>linux</tag>
        <tag>vim</tag>
      </tags>
  </entry>
  <entry>
    <title>Tar &amp; Zip</title>
    <url>/linux/%E5%8E%8B%E7%BC%A9/</url>
    <content><![CDATA[<ul>
<li><a href="https://unix.stackexchange.com/questions/85194/how-to-download-an-archive-and-extract-it-without-saving-the-archive-to-disk/85195">shell - How to download an archive and extract it without saving the archive to disk? - Unix &amp; Linux Stack Exchange</a><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">wget -qO- your_link_here | tar xvz -C <span class="regexp">/target/</span>directory</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h2><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">https:<span class="comment">//unix.stackexchange.com/questions/46969/compress-a-folder-with-tar</span></span><br><span class="line">To tar and gzip <span class="selector-tag">a</span> folder, the syntax is:</span><br><span class="line">tar czf name_of_archive_file<span class="selector-class">.tar</span><span class="selector-class">.gz</span> name_of_directory_to_tar</span><br><span class="line"></span><br><span class="line">tar -zcvf xxx<span class="selector-class">.tar</span><span class="selector-class">.gz</span> aaa bbb</span><br><span class="line">tar -jcvf xxx<span class="selector-class">.tar</span><span class="selector-class">.bz2</span> aaa bbb</span><br><span class="line">tar -Jcvf xxx<span class="selector-class">.tar</span><span class="selector-class">.xz</span> aaa bbb</span><br></pre></td></tr></table></figure>
<h2 id="unzip"><a href="#unzip" class="headerlink" title="unzip"></a>unzip</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tar -xf xxx.tar.gz</span><br><span class="line">tar -xf xxx.tar.bz2</span><br><span class="line">tar -Jxf xxx.tar.xz</span><br><span class="line"></span><br><span class="line">tar -xf xxx.tar.gz -C ./xxx</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>linux</tag>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>学习资料</title>
    <url>/linux/%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/</url>
    <content><![CDATA[<p><a href="http://mingxinglai.com/cn/2013/01/skills-of-shell/">一堆shell脚本技巧 | 赖明星</a></p>
]]></content>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>【Linux】技巧</title>
    <url>/linux/%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h2 id="https-www-youtube-com-watch-v-V8EUdia-kOE"><a href="#https-www-youtube-com-watch-v-V8EUdia-kOE" class="headerlink" title="https://www.youtube.com/watch?v=V8EUdia_kOE"></a><a href="https://www.youtube.com/watch?v=V8EUdia_kOE">https://www.youtube.com/watch?v=V8EUdia_kOE</a></h2><ul>
<li>sudo !!</li>
<li>ctrl-k, ctrl-u, ctrl-w, ctrl-y - cutting and pasting text in the command line</li>
<li>practical kill/yank example</li>
<li>use ‘less +F’ to view logfiles, instead of ‘tail’ (ctrl-c, shift-f, q to quit)</li>
<li>ctrl-x-e - continue editing your current shell line in a text editor (uses $EDITOR)</li>
<li>alt-. - paste previous command’s argument (useful for running multiple commands on the same resource)</li>
<li>reset - resets/unborks your terminal</li>
</ul>
<h2 id="linux-kill-某个端口对应的进程"><a href="#linux-kill-某个端口对应的进程" class="headerlink" title="linux kill 某个端口对应的进程"></a>linux kill 某个端口对应的进程</h2><ul>
<li><a href="https://blog.csdn.net/gq__97/article/details/80487588">Linux 一条命令杀死占用端口的所有进程 - gq__97 的博客 - CSDN 博客</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 $(lsof -i:端口号 -t)</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://blog.csdn.net/shengzhu1/article/details/54138419">linux 下怎么根据端口号杀死进程 - shengzhu1 的博客 - CSDN 博客</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">kill</span> [<span class="string">&#x27;]netstat -nlp | grep :3306 | awk &#x27;</span>&#123;<span class="built_in">print</span> <span class="variable">$7</span>&#125;<span class="string">&#x27; | awk -F&quot;/&quot; &#x27;</span>&#123; <span class="built_in">print</span> <span class="variable">$1</span> &#125;<span class="string">&#x27;[&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="根据启动的应用名称来杀死进程"><a href="#根据启动的应用名称来杀死进程" class="headerlink" title="根据启动的应用名称来杀死进程"></a>根据启动的应用名称来杀死进程</h2><p><strong>获取所有该应用名称的进程</strong><br><code>ps -aux | grep user-0.0.1.jar </code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">lilou</span>     <span class="number">2676</span>  <span class="number">0</span>.<span class="number">0</span>  <span class="number">0</span>.<span class="number">0</span>  <span class="number">21536</span>   <span class="number">980</span> pts/<span class="number">18</span>   S+   <span class="number">09</span>:<span class="number">49</span>   <span class="number">0</span>:<span class="number">00</span> grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn user-<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>.jar</span><br><span class="line"><span class="attribute">lilou</span>     <span class="number">4353</span>  <span class="number">0</span>.<span class="number">0</span>  <span class="number">2</span>.<span class="number">0</span> <span class="number">8230288</span> <span class="number">339332</span> pts/<span class="number">21</span> Sl+  <span class="number">5</span>月<span class="number">28</span>   <span class="number">0</span>:<span class="number">43</span> java -jar user-<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>.jar</span><br></pre></td></tr></table></figure>

<p><strong>排除含有 grep 的行</strong><br><code>ps -aux | grep user-0.0.1.jar | grep -v grep</code></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">lilou</span>     <span class="number">4353</span>  <span class="number">0</span>.<span class="number">0</span>  <span class="number">2</span>.<span class="number">0</span> <span class="number">8230288</span> <span class="number">339332</span> pts/<span class="number">21</span> Sl+  <span class="number">5</span>月<span class="number">28</span>   <span class="number">0</span>:<span class="number">43</span> java -jar user-<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>.jar</span><br></pre></td></tr></table></figure>

<p><strong>获取进程号</strong><br><code>ps -aux | grep user-0.0.1.jar | grep -v grep | cut -c 9-15</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="number">4353</span></span><br></pre></td></tr></table></figure>

<p><strong>使用 kill 命令杀死进程</strong><br><code>ps -aux | grep user-0.0.1.jar | grep -v grep | cut -c 9-15 | xargs kill -15</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">该进程已经被杀死</span><br></pre></td></tr></table></figure>

<h2 id="java-项目启动和停止脚本"><a href="#java-项目启动和停止脚本" class="headerlink" title="java 项目启动和停止脚本"></a>java 项目启动和停止脚本</h2><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">➜ <span class="keyword">cat</span> env.<span class="keyword">sh</span></span><br><span class="line">NAME=<span class="string">&quot;user-0.0.1.jar&quot;</span></span><br><span class="line">➜ <span class="keyword">cat</span> start.<span class="keyword">sh</span></span><br><span class="line">. ./env.<span class="keyword">sh</span></span><br><span class="line">nohup java -Duser.timezone=GMT+<span class="number">08</span> -Xmx1G -Xms1G -jar $NAME &gt; /dev/null &amp;</span><br><span class="line">➜ <span class="keyword">cat</span> <span class="keyword">stop</span>.<span class="keyword">sh</span></span><br><span class="line">. ./env.<span class="keyword">sh</span></span><br><span class="line"><span class="keyword">ps</span> -aux | <span class="keyword">grep</span> $NAME | <span class="keyword">grep</span> -v <span class="keyword">grep</span> | cut -<span class="keyword">c</span> <span class="number">9</span>-<span class="number">15</span> | xargs kill -<span class="number">15</span></span><br><span class="line">➜ <span class="keyword">cat</span> restart.<span class="keyword">sh</span></span><br><span class="line">./<span class="keyword">stop</span>.<span class="keyword">sh</span></span><br><span class="line"><span class="keyword">sleep</span> <span class="number">8</span></span><br><span class="line">./start.<span class="keyword">sh</span></span><br><span class="line">➜</span><br></pre></td></tr></table></figure>

<p>ps -aux | grep python | grep 9090 | cut -c 9-15 | xargs kill -15<br>cd /www/smbshare &amp;&amp; python -m SimpleHTTPServer 9090 &gt; /dev/null 2&gt;&amp;1 &amp;</p>
<h2 id="根据端口来-kill-进程"><a href="#根据端口来-kill-进程" class="headerlink" title="根据端口来 kill 进程"></a>根据端口来 kill 进程</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">cd</span> $(<span class="built_in">dirname</span> <span class="variable">$0</span>)</span><br><span class="line">lsof -i :21001 |grep <span class="string">&quot;\(LISTEN\)&quot;</span>|awk -F <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;&#123;print &quot;kill -15 &quot; $2&#125;&#x27;</span>|sh</span><br></pre></td></tr></table></figure>

<p>具体参考： <code>man lsof</code></p>
<h2 id="递归删除文件和目录"><a href="#递归删除文件和目录" class="headerlink" title="递归删除文件和目录"></a>递归删除文件和目录</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归清除不必要的文件</span></span><br><span class="line"><span class="comment"># https://blog.csdn.net/skylin19840101/article/details/75099240</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除文件</span></span><br><span class="line">find . -name .flattened-pom.xml | xargs <span class="built_in">rm</span> -f</span><br><span class="line">find . -name .project | xargs <span class="built_in">rm</span> -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除目录</span></span><br><span class="line">find . -name <span class="string">&quot;.settings&quot;</span> | xargs <span class="built_in">rm</span> -rf</span><br><span class="line">find . -name <span class="string">&quot;target&quot;</span> | xargs <span class="built_in">rm</span> -rf</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu环境变量</title>
    <url>/linux/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/</url>
    <content><![CDATA[<h2 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">alias</span> cdt=<span class="string">&#x27;cd ~/t&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> cdw=<span class="string">&#x27;cd ~/w&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> e.=<span class="string">&#x27;caja .&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> egrep=<span class="string">&#x27;egrep --color=auto&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> fgrep=<span class="string">&#x27;fgrep --color=auto&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> gl=<span class="string">&#x27;git lg&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> grep=<span class="string">&#x27;grep --color=auto&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> l=<span class="string">&#x27;ls -CF&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> la=<span class="string">&#x27;ls -A&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> ll=<span class="string">&#x27;ls -alF&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">ls</span>=<span class="string">&#x27;ls --color=auto&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="java"><a href="#java" class="headerlink" title="java"></a><a href="https://blog.csdn.net/u012707739/article/details/78489833">java</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get install openjdk-8-jdk</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#set oracle jdk environment</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jvm/jdk1.8.0_121  <span class="comment">## 这里要注意目录要换成自己解</span></span><br><span class="line">压的jdk 目录 </span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre   </span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib   </span><br><span class="line"><span class="built_in">export</span> <span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<h2 id="go"><a href="#go" class="headerlink" title="go"></a>go</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> GOROOT=<span class="variable">$HOME</span>/c/go</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$GOROOT</span>/bin</span><br><span class="line"><span class="built_in">export</span> GOPATH=<span class="variable">$HOME</span>/w/go</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;GOPATH&#125;</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<h2 id="git"><a href="#git" class="headerlink" title="git"></a>git</h2><h3 id="to-set"><a href="#to-set" class="headerlink" title="to set"></a>to set</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git config --global user.name lilou</span><br><span class="line">git config --global user.email lilou@lyloou.com</span><br><span class="line">git config --global core.autocrlf  <span class="literal">false</span></span><br><span class="line">git config --global alias.lg <span class="string">&quot;log --color --graph --pretty=format:&#x27;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&#x27; --abbrev-commit&quot;</span></span><br><span class="line">git config --global http.proxy <span class="string">&#x27;socks5://127.0.0.1:1080&#x27;</span></span><br><span class="line">git config --global https.proxy <span class="string">&#x27;socks5://127.0.0.1:1080&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="result"><a href="#result" class="headerlink" title="result"></a>result</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[user]</span><br><span class="line">        email = lilou@lyloou.com</span><br><span class="line">        name = lilou</span><br><span class="line">[<span class="built_in">alias</span>]</span><br><span class="line">        lg = <span class="built_in">log</span> --color --graph --pretty=format:<span class="string">&#x27;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&#x27;</span> --abbrev-commit</span><br><span class="line">[core]        </span><br><span class="line">        autocrlf = <span class="literal">false</span></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>【Linux】系统</title>
    <url>/linux/%E7%B3%BB%E7%BB%9F/</url>
    <content><![CDATA[<h2 id="制作-ubuntu-系统启动-u-盘"><a href="#制作-ubuntu-系统启动-u-盘" class="headerlink" title="制作 ubuntu 系统启动 u 盘"></a>制作 ubuntu 系统启动 u 盘</h2><h3 id="下载发行版镜像"><a href="#下载发行版镜像" class="headerlink" title="下载发行版镜像"></a>下载发行版镜像</h3><p>有这几个供参考：ubuntu、xbuntu、mate ubuntu</p>
<h3 id="ubuntu"><a href="#ubuntu" class="headerlink" title="ubuntu"></a>ubuntu</h3><ul>
<li>Startup Disk Creator(启动盘创建器)</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># install</span></span><br><span class="line">sudo apt-get install usb-creator-gtk</span><br><span class="line"><span class="comment"># run</span></span><br><span class="line">usb-creator-gtk</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://tutorials.ubuntu.com/tutorial/tutorial-create-a-usb-stick-on-ubuntu">https://tutorials.ubuntu.com/tutorial/tutorial-create-a-usb-stick-on-ubuntu</a></li>
</ul>
<h3 id="mac"><a href="#mac" class="headerlink" title="mac"></a>mac</h3><ul>
<li>Disk Utility</li>
<li><a href="https://tutorials.ubuntu.com/tutorial/tutorial-create-a-usb-stick-on-macos">https://tutorials.ubuntu.com/tutorial/tutorial-create-a-usb-stick-on-macos</a></li>
</ul>
<h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><ul>
<li><p>下载 Pen Drive Linux’s USB 安装器 （或：rufus）</p>
</li>
<li><p>从下拉选项中选择 Ubuntu 桌面版本。</p>
</li>
<li><p>点击‘浏览’然后打开已下载的 ISO 文件。</p>
</li>
<li><p>选择一个 USB 驱动器并点击‘创建’.</p>
</li>
<li><p><a href="http://www.ubuntu.org.cn/download/desktop/create-a-usb-stick-on-windows">如何在 Windows 下创建一个可启动 USB 驱动器 | Ubuntu</a><br>注意：U 盘启动后，会出现提示<code>gfxboot.c32: not a com32r image</code>，这时按下 TAB，并输入<code>live</code>回车即可进入启动系统。</p>
</li>
<li><p><a href="https://tutorials.ubuntu.com/tutorial/tutorial-create-a-usb-stick-on-windows">https://tutorials.ubuntu.com/tutorial/tutorial-create-a-usb-stick-on-windows</a></p>
</li>
</ul>
<h2 id="如何找到-Linux-的版本号"><a href="#如何找到-Linux-的版本号" class="headerlink" title="如何找到 Linux 的版本号"></a><a href="https://linux.cn/article-9760-1.html">如何找到 Linux 的版本号</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">uname</span> -srm</span><br><span class="line"><span class="comment"># uname --kernel-name --kernel-release --machine</span></span><br><span class="line"><span class="comment"># Linux 4.13.0-46-generic x86_64</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/os-release</span><br></pre></td></tr></table></figure>
<h2 id="Checking-Your-Ubuntu-Version-From-the-Terminal"><a href="#Checking-Your-Ubuntu-Version-From-the-Terminal" class="headerlink" title="Checking Your Ubuntu Version From the Terminal"></a>Checking Your Ubuntu Version From the Terminal</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">lsb_release -a</span><br></pre></td></tr></table></figure>

<h2 id="How-do-you-run-Ubuntu-Server-with-a-GUI"><a href="#How-do-you-run-Ubuntu-Server-with-a-GUI" class="headerlink" title="How do you run Ubuntu Server with a GUI?"></a><a href="https://askubuntu.com/questions/53822/how-do-you-run-ubuntu-server-with-a-gui">How do you run Ubuntu Server with a GUI?</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Minimal GUI:</span></span><br><span class="line">sudo apt install xorg</span><br><span class="line">sudo apt install --no-install-recommends openbox</span><br><span class="line"></span><br><span class="line"><span class="comment"># Minimal GUI with display manager:</span></span><br><span class="line">sudo apt install xorg</span><br><span class="line">sudo apt install --no-install-recommends lightdm-gtk-greeter</span><br><span class="line">sudo apt install --no-install-recommends lightdm</span><br><span class="line">sudo apt install --no-install-recommends openbox</span><br><span class="line"></span><br><span class="line"><span class="comment"># A more functional minimal desktop environment (the one I use):</span></span><br><span class="line">sudo apt install xorg</span><br><span class="line">sudo apt install --no-install-recommends lightdm-gtk-greeter</span><br><span class="line">sudo apt install --no-install-recommends lightdm</span><br><span class="line">sudo apt install --no-install-recommends lxde-icon-theme</span><br><span class="line">sudo apt install --no-install-recommends lxde-core</span><br><span class="line">sudo apt install --no-install-recommends lxde-common</span><br><span class="line">sudo apt install --no-install-recommends policykit-1 lxpolkit</span><br><span class="line">sudo apt install --no-install-recommends lxsession-logout</span><br><span class="line">sudo apt install --no-install-recommends gvfs-backends</span><br><span class="line"></span><br><span class="line"><span class="comment"># A full lightweight desktop environment:</span></span><br><span class="line">sudo apt install xorg</span><br><span class="line">sudo apt install --no-install-recommends xubuntu-core</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">sudo apt install --no-install-recommends ubuntu-mate-core</span><br></pre></td></tr></table></figure>

<h2 id="Can-I-access-Ubuntu-from-Windows-remotely"><a href="#Can-I-access-Ubuntu-from-Windows-remotely" class="headerlink" title="Can I access Ubuntu from Windows remotely?"></a><a href="https://askubuntu.com/questions/592537/can-i-access-ubuntu-from-windows-remotely">Can I access Ubuntu from Windows remotely?</a></h2><p><a href="https://www.tweaking4all.com/software/linux-software/use-xrdp-remote-access-ubuntu-14-04/">https://www.tweaking4all.com/software/linux-software/use-xrdp-remote-access-ubuntu-14-04/</a></p>
<h2 id="vmware-esxi"><a href="#vmware-esxi" class="headerlink" title="vmware esxi"></a>vmware esxi</h2>]]></content>
      <tags>
        <tag>linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>【Linux】软件</title>
    <url>/linux/%E8%BD%AF%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="wps"><a href="#wps" class="headerlink" title="wps"></a>wps</h2><p><a href="http://wps-community.org/downloads">http://wps-community.org/downloads</a></p>
<h2 id="gvim"><a href="#gvim" class="headerlink" title="gvim"></a>gvim</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install vim-gnome</span><br></pre></td></tr></table></figure>

<h2 id="synpase（快速启动）"><a href="#synpase（快速启动）" class="headerlink" title="synpase（快速启动）"></a>synpase（快速启动）</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:synapse-core/ppa</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install synapse</span><br></pre></td></tr></table></figure>

<h2 id="fcitx-五笔输入法"><a href="#fcitx-五笔输入法" class="headerlink" title="fcitx 五笔输入法"></a>fcitx 五笔输入法</h2><ul>
<li><p>安装<br><code>sudo apt-get install fcitx fcitx-table-wubi fcitx-tools -y</code></p>
</li>
<li><p>启用自动调频<br>修改配置文件 /usr/share/fcitx/table/wbx.conf</p>
</li>
</ul>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">AdjustOrder</span><span class="operator">=</span>AdjustFreq</span><br></pre></td></tr></table></figure>

<ul>
<li>不能正常打出中文标点<br>修改配置文件<br>/usr/share/fcitx/addon/fcitx-fullwidth-char.conf</li>
</ul>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Priority</span><span class="operator">=</span><span class="number">80</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>重启输入法<br><code>fcitx -r</code></p>
</li>
<li><p><a href="https://zhuanlan.zhihu.com/p/28586200">linux 安装与配置 fcitx 五笔输入法</a></p>
</li>
</ul>
<h2 id="git"><a href="#git" class="headerlink" title="git"></a>git</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure>

<h2 id="vlc（多媒体播放器）"><a href="#vlc（多媒体播放器）" class="headerlink" title="vlc（多媒体播放器）"></a>vlc（多媒体播放器）</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt install vlc</span><br></pre></td></tr></table></figure>

<h2 id="wiz"><a href="#wiz" class="headerlink" title="wiz"></a>wiz</h2><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>www.wiz.cn/wiznote-linux.html</span><br></pre></td></tr></table></figure>

<h2 id="firefox"><a href="#firefox" class="headerlink" title="firefox"></a>firefox</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># https://www.computernetworkingnotes.com/ubuntu-linux-tutorials/how-to-update-firefox-in-ubuntu-linux.html</span></span><br><span class="line"><span class="comment"># install</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install firefox</span><br><span class="line"></span><br><span class="line"><span class="comment"># update</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install --only-upgrade firefox</span><br></pre></td></tr></table></figure>

<h2 id="chrome"><a href="#chrome" class="headerlink" title="chrome"></a>chrome</h2><ul>
<li>install</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># https://askubuntu.com/questions/510056/how-to-install-google-chrome</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. add key</span></span><br><span class="line">wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -</span><br><span class="line"><span class="comment"># 2. set repository</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main&#x27;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/google-chrome.list</span><br><span class="line"><span class="comment"># 3. install package</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install google-chrome-stable</span><br></pre></td></tr></table></figure>

<ul>
<li>config</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">https://github.com/FelisCatus/SwitchyOmega/releases/</span><br><span class="line"></span><br><span class="line">https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt</span><br></pre></td></tr></table></figure>

<h2 id="vscode"><a href="#vscode" class="headerlink" title="vscode"></a>vscode</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># https://code.visualstudio.com/docs/setup/linux</span></span><br><span class="line"></span><br><span class="line">curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor &gt; microsoft.gpg</span><br><span class="line">sudo <span class="built_in">mv</span> microsoft.gpg /etc/apt/trusted.gpg.d/microsoft.gpg</span><br><span class="line">sudo sh -c <span class="string">&#x27;echo &quot;deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main&quot; &gt; /etc/apt/sources.list.d/vscode.list&#x27;</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install code <span class="comment"># or code-insiders</span></span><br></pre></td></tr></table></figure>

<h2 id="idea"><a href="#idea" class="headerlink" title="idea"></a>idea</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># https://www.jetbrains.com/help/idea/install-and-set-up-product.html</span></span><br><span class="line">sudo snap install intellij-idea-ultimate --classic</span><br></pre></td></tr></table></figure>

<h2 id="emacs"><a href="#emacs" class="headerlink" title="emacs"></a>emacs</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get install emacs</span><br></pre></td></tr></table></figure>

<h2 id="shadowsocks"><a href="#shadowsocks" class="headerlink" title="shadowsocks"></a><a href="https://blog.huihut.com/2017/08/25/LinuxInstallConfigShadowsocksClient/">shadowsocks</a></h2><ul>
<li>install</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">sudo apt-get install python-pip</span><br><span class="line">pip install --upgrade pip</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">// sudo vim /usr/<span class="built_in">bin</span>/pip</span><br><span class="line"><span class="keyword">from</span> pip <span class="keyword">import</span> __main__</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    sys.exit(__main__._main())</span><br></pre></td></tr></table></figure>

<p>sudo pip install shadowsocks</p>
<ul>
<li>config<br><code>sudo vi $HOME/p/shadowsocks.json</code></li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在shadowsocks.json中加入以下内容：</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_server_ip&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;local_address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;local_port&quot;</span><span class="punctuation">:</span> <span class="number">1080</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;server_port&quot;</span><span class="punctuation">:</span> my_server_port<span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_password&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timeout&quot;</span><span class="punctuation">:</span> <span class="number">300</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;method&quot;</span><span class="punctuation">:</span> <span class="string">&quot;aes-256-cfb&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>sudo ln -s $HOME/p/shadowsocks.json /etc/shadowsocks.json</code></p>
<ul>
<li>start</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">- 前端启动： sudo sslocal -c /etc/shadowsocks.json</span><br><span class="line">- 后端启动： sudo sslocal -c /etc/shadowsocks.json -d start</span><br><span class="line">- 后端停止： sudo sslocal -c /etc/shadowsocks.json -d stop</span><br><span class="line">- 重启(修改配置要重启才生效)： sudo sslocal -c /etc/shadowsocks.json -d restart</span><br></pre></td></tr></table></figure>

<ul>
<li>boot up<br><code>sudo vim /etc/systemd/system/shadowsocks.service</code></li>
</ul>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Shadowsocks Client Service</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">User</span>=root</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/bin/sslocal -c /etc/shadowsocks.json</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>

<p><code>systemctl enable /etc/systemd/system/shadowsocks.service</code></p>
<ul>
<li>now you can reboot to check it~</li>
</ul>
<h2 id="proxychains"><a href="#proxychains" class="headerlink" title="proxychains"></a>proxychains</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># https://askubuntu.com/questions/610333/how-to-set-socks5-proxy-in-the-terminal</span></span><br><span class="line"><span class="comment"># install proxychains</span></span><br><span class="line">sudo apt install proxychains</span><br><span class="line">sudo proxychains apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># now you can config your proxy in /etc/proxychains.conf</span></span><br><span class="line"><span class="comment"># sudo vim /etc/proxychains.conf</span></span><br><span class="line">socks5 127.0.0.1 1080</span><br></pre></td></tr></table></figure>

<h2 id="privoxy"><a href="#privoxy" class="headerlink" title="privoxy"></a>privoxy</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># https://linoxide.com/linux-how-to/install-use-privoxy-ubuntu-16-04/</span></span><br><span class="line"><span class="comment"># install</span></span><br><span class="line">sudo apt-get install privoxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo vim /etc/privoxy/config</span></span><br><span class="line"><span class="comment"># 添加下面这一行</span></span><br><span class="line">forward-socks5 / 0.0.0.0:1080 .</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line">/etc/init.d/privoxy restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">curl  -x 127.0.0.1:8118 http://www.google.com</span><br></pre></td></tr></table></figure>

<h2 id="caja（文件管理器）"><a href="#caja（文件管理器）" class="headerlink" title="caja（文件管理器）"></a>caja（文件管理器）</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># https://www.devmanuals.net/install/ubuntu/ubuntu-16-04-LTS-Xenial-Xerus/how-to-install-caja.html</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install caja</span><br></pre></td></tr></table></figure>

<h2 id="terminal"><a href="#terminal" class="headerlink" title="terminal"></a>terminal</h2><h3 id="terminator"><a href="#terminator" class="headerlink" title="terminator"></a>terminator</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># http://www.ubuntugeek.com/terminator-multiple-gnome-terminals-in-one-window.html</span></span><br><span class="line"><span class="comment"># https://linux.cn/article-2978-1.html</span></span><br><span class="line">sudo apt-get install terminator</span><br></pre></td></tr></table></figure>

<h3 id="PAC-Manager"><a href="#PAC-Manager" class="headerlink" title="PAC Manager"></a>PAC Manager</h3><h2 id="tmux"><a href="#tmux" class="headerlink" title="tmux"></a>tmux</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get install tmux</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="http://witkowskibartosz.com/blog/update-your-tmux-to-latest-version.html#.W2wMk87-iCo">Update your tmux to latest version</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">VERSION=2.8</span><br><span class="line">wget https://github.com/tmux/tmux/releases/download/<span class="variable">$&#123;VERSION&#125;</span>/tmux-<span class="variable">$&#123;VERSION&#125;</span>.tar.gz</span><br><span class="line">tar xf tmux-<span class="variable">$&#123;VERSION&#125;</span>.tar.gz</span><br><span class="line"><span class="built_in">rm</span> -f tmux-<span class="variable">$&#123;VERSION&#125;</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> tmux-<span class="variable">$&#123;VERSION&#125;</span></span><br><span class="line"></span><br><span class="line">sudo apt-get install libevent-dev</span><br><span class="line">sudo apt-get install ncurses-dev</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"><span class="built_in">cd</span> -</span><br><span class="line">sudo <span class="built_in">rm</span> -rf /usr/local/src/tmux-\*</span><br><span class="line">sudo <span class="built_in">mv</span> tmux-<span class="variable">$&#123;VERSION&#125;</span> /usr/local/src</span><br></pre></td></tr></table></figure>

<h2 id="zsh"><a href="#zsh" class="headerlink" title="zsh"></a>zsh</h2><ul>
<li><a href="https://www.cnblogs.com/EasonJim/p/7863099.html">https://www.cnblogs.com/EasonJim/p/7863099.html</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># install</span></span><br><span class="line">sudo apt-get install zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># change default shell to zsh</span></span><br><span class="line">chsh -s /bin/zsh</span><br></pre></td></tr></table></figure>

<ul>
<li>oh my zsh</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># https://github.com/robbyrussell/oh-my-zsh</span></span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>&quot;</span></span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://gitee.com/mirrors/oh-my-zsh/raw/master/tools/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>autojump</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get install autojump</span><br><span class="line"></span><br><span class="line">vim .zshrc</span><br><span class="line"><span class="comment">#在最后一行加入，注意点后面是一个空格</span></span><br><span class="line">plugins=( [plugins...] autojump)</span><br></pre></td></tr></table></figure>

<ul>
<li>zsh-syntax-highlighting</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># https://github.com/zsh-users/zsh-syntax-highlighting/blob/master/INSTALL.md</span></span><br><span class="line"><span class="comment"># 1. Clone this repository in oh-my-zsh&#x27;s plugins directory:</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br><span class="line"><span class="comment"># 2. Activate the plugin in ~/.zshrc:</span></span><br><span class="line">plugins=( [plugins...] zsh-syntax-highlighting)</span><br><span class="line"><span class="comment"># 3. Source ~/.zshrc to take changes into account:</span></span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>

<ul>
<li>zsh-autosuggestions</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git://github.com/zsh-users/zsh-autosuggestions <span class="variable">$ZSH_CUSTOM</span>/plugins/zsh-autosuggestions</span><br><span class="line">plugins=( [plugins...] zsh-autosuggestions)</span><br></pre></td></tr></table></figure>

<ul>
<li>theme:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/bhilburn/powerlevel9k.git ~/.oh-my-zsh/custom/themes/powerlevel9k</span><br><span class="line"></span><br><span class="line">vi ~/.vimrc</span><br><span class="line">ZSH_THEME=<span class="string">&quot;powerlevel9k/powerlevel9k&quot;</span></span><br></pre></td></tr></table></figure>
<p><a href="https://travis.media/top-12-oh-my-zsh-themes-for-productive-developers/#20210921-eastwood">https://travis.media/top-12-oh-my-zsh-themes-for-productive-developers/#20210921-eastwood</a></p>
<h2 id="git-cola"><a href="#git-cola" class="headerlink" title="git-cola"></a>git-cola</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">apt-get install git-cola</span><br></pre></td></tr></table></figure>

<h2 id="variety-壁纸切换"><a href="#variety-壁纸切换" class="headerlink" title="variety 壁纸切换"></a>variety 壁纸切换</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install variety</span><br></pre></td></tr></table></figure>

<h2 id="catfish-文件搜索"><a href="#catfish-文件搜索" class="headerlink" title="catfish 文件搜索"></a>catfish 文件搜索</h2><h2 id="calibre（电子书阅读器）"><a href="#calibre（电子书阅读器）" class="headerlink" title="calibre（电子书阅读器）"></a>calibre（电子书阅读器）</h2><h2 id="红移（色温调节工具）"><a href="#红移（色温调节工具）" class="headerlink" title="红移（色温调节工具）"></a>红移（色温调节工具）</h2><h2 id="workrave（定时提醒）"><a href="#workrave（定时提醒）" class="headerlink" title="workrave（定时提醒）"></a>workrave（定时提醒）</h2><h2 id="LibreOffice"><a href="#LibreOffice" class="headerlink" title="LibreOffice"></a>LibreOffice</h2><h2 id="Transmission-downloader"><a href="#Transmission-downloader" class="headerlink" title="Transmission (downloader)"></a>Transmission (downloader)</h2><h2 id="diodon"><a href="#diodon" class="headerlink" title="diodon"></a>diodon</h2><h2 id="截图软件-shutter"><a href="#截图软件-shutter" class="headerlink" title="截图软件 shutter"></a>截图软件 shutter</h2><ol>
<li><code>sudo add-apt-repository ppa:shutter/ppa1</code></li>
<li><code>sudo apt-get update</code></li>
<li><code>sudo apt-get install shutter1</code></li>
<li>设置快捷键 keyboard -&gt; shortcut -&gt; <code>shutter -s</code> -&gt; Ctrl+Alt+A -&gt; ok</li>
</ol>
<ul>
<li><a href="http://www.linuxidc.com/Linux/2015-07/119753.htm">Ubuntu 安装截图工具 Shutter，并设置快捷键 Ctrl+Alt+A_Linux 教程_Linux 公社-Linux 系统门户网站</a></li>
</ul>
<h2 id="卸载软件"><a href="#卸载软件" class="headerlink" title="卸载软件"></a>卸载软件</h2><ol>
<li>查找安装名称：<code>dpkg -l | grep package_name</code></li>
<li>卸载<code>sudo apt-get remove package_name</code>, 具体输入<code>apt-get</code>命令查看</li>
</ol>
<h2 id="本地安装"><a href="#本地安装" class="headerlink" title="本地安装"></a>本地安装</h2><p>以安装网易云音乐为例</p>
<ol>
<li>从官网下载 deb 安装文件</li>
<li>执行下列命令</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sudo dpkg -i netease*.dbg</span><br><span class="line">$ sudo apt -f install</span><br></pre></td></tr></table></figure>

<h2 id="去除-chrome-的输入密码以解锁密码环提示"><a href="#去除-chrome-的输入密码以解锁密码环提示" class="headerlink" title="去除 chrome 的输入密码以解锁密码环提示"></a>去除 chrome 的<code>输入密码以解锁密码环</code>提示</h2><ul>
<li>终端输入<code>seahorse</code></li>
<li>右键删除 <code>登录</code></li>
<li>退出 chrome</li>
<li>提示输入密码时，不输入任何内容，直接按下一步。<blockquote>
<p><a href="http://blog.csdn.net/kangear/article/details/20789451">解决打开 Chrome 出现 输入密码以解锁您的登录密钥环 - Android/Linux 的专栏 - 博客频道 - CSDN.NET</a></p>
</blockquote>
</li>
</ul>
<h2 id="安装-WenQuanYi-Zen-Hei-字体"><a href="#安装-WenQuanYi-Zen-Hei-字体" class="headerlink" title="安装 WenQuanYi Zen Hei 字体"></a>安装 WenQuanYi Zen Hei 字体</h2><ol>
<li>download file: wqy-zenhei-0.9.45.deb</li>
<li>install: dpkg -i wqy-zenhei-0.9.45.deb</li>
</ol>
<h2 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a><a href="https://medium.com/@jerilkuriakose/keyboard-shortcuts-for-custom-terminal-commands-in-ubuntu-17-10-aeb902f71869">sleep</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">dbus-send --system --print-reply --dest=org.freedesktop.login1 /org/freedesktop/login1 <span class="string">&quot;org.freedesktop.login1.Manager.Suspend&quot;</span> boolean:<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="wine"><a href="#wine" class="headerlink" title="wine"></a>wine</h2><p><a href="https://wiki.winehq.org/Ubuntu">https://wiki.winehq.org/Ubuntu</a></p>
<h2 id="add-C-env"><a href="#add-C-env" class="headerlink" title="add C env"></a>add C env</h2><p>apt-get install build-essential</p>
<h2 id="rg"><a href="#rg" class="headerlink" title="rg"></a>rg</h2><p><a href="https://github.com/BurntSushi/ripgrep">https://github.com/BurntSushi/ripgrep</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -LO https://github.com/BurntSushi/ripgrep/releases/download/0.10.0/ripgrep_0.10.0_amd64.deb</span><br><span class="line"></span><br><span class="line">sudo dpkg -i ripgrep_0.10.0_amd64.deb</span><br></pre></td></tr></table></figure>

<h2 id="trash-cli"><a href="#trash-cli" class="headerlink" title="trash-cli"></a>trash-cli</h2><ul>
<li><a href="https://github.com/andreafrancia/trash-cli">andreafrancia/trash-cli: Command line interface to the freedesktop.org trashcan.</a></li>
<li><a href="https://linux.cn/article-10029-1.html">分享|Trash-Cli：Linux 上的命令行回收站工具</a></li>
</ul>
<h2 id="fzf"><a href="#fzf" class="headerlink" title="fzf"></a>fzf</h2><p>A command-line fuzzy finder</p>
<p><a href="https://github.com/junegunn/fzf">https://github.com/junegunn/fzf</a></p>
<h2 id="v2ray"><a href="#v2ray" class="headerlink" title="v2ray"></a>v2ray</h2><p><strong>server</strong></p>
<ul>
<li><a href="https://github.com/233boy/v2ray/wiki/V2Ray%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC">V2Ray 一键安装脚本 · 233boy/v2ray Wiki · GitHub</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">bash &lt;(curl -s -L https://git.io/v2ray.sh)</span><br><span class="line">bash &lt;(curl -s -L https://git.io/v2ray-setup.sh)</span><br></pre></td></tr></table></figure>

<p><strong>client</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">bash &lt;(curl -L -s https://install.direct/go.sh)</span><br></pre></td></tr></table></figure>

<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">说明</span><br><span class="line">此脚本会自动安装以下文件：</span><br><span class="line">/usr/bin/v2ray/v2ray：V2Ray 程序；</span><br><span class="line">/usr/bin/v2ray/v2ctl：V2Ray 工具；</span><br><span class="line">/etc/v2ray/config.json：配置文件；</span><br><span class="line">/usr/bin/v2ray/geoip.dat：IP 数据文件</span><br><span class="line">/usr/bin/v2ray/geosite.dat：域名数据文件</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>修改配置<br><code>vi /etc/v2ray/config.json</code></p>
</li>
<li><p>启动和状态查看</p>
</li>
</ol>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">service v2ray start</span><br><span class="line">service v2ray status</span><br><span class="line">service v2ray restart</span><br></pre></td></tr></table></figure>

<p>android 客户端：BifrostV</p>
<h2 id="file-server"><a href="#file-server" class="headerlink" title="file server"></a>file server</h2><p><a href="https://www.ostechnix.com/how-to-quickly-serve-files-and-folders-over-http-in-linux/">How To Quickly Serve Files And Folders Over HTTP In Linux - OSTechNix</a></p>
<h2 id="How-do-I-modify-or-disable-the-HUD’s-use-of-the-Alt-key"><a href="#How-do-I-modify-or-disable-the-HUD’s-use-of-the-Alt-key" class="headerlink" title="How do I modify or disable the HUD’s use of the Alt key?"></a>How do I modify or disable the HUD’s use of the Alt key?</h2><ol>
<li>open <code>System Settings</code></li>
<li>Then go to Keyboard &gt; Shortcuts &gt; Launchers. You can redefine the HUD key with the Key to show the HUD option. Pressing Backspace will disable the HUD shortcut altogether.</li>
<li>You can redefine the HUD key with the Key to show the HUD option. Pressing Backspace will disable the HUD shortcut altogether.</li>
</ol>
<ul>
<li><a href="https://askubuntu.com/questions/122209/how-do-i-modify-or-disable-the-huds-use-of-the-alt-key">unity - How do I modify or disable the HUD’s use of the Alt key? - Ask Ubuntu</a></li>
</ul>
<h2 id="Install-Fira-in-Ubuntu"><a href="#Install-Fira-in-Ubuntu" class="headerlink" title="Install Fira in Ubuntu"></a><a href="https://stevescott.ca/2015-09-28-installing-fira-in-ubuntu.html">Install Fira in Ubuntu</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget https://github.com/mozilla/Fira/archive/master.zip</span><br><span class="line">unzip master.zip</span><br><span class="line">sudo <span class="built_in">mkdir</span> -p /usr/share/fonts/truetype/fira</span><br><span class="line">sudo <span class="built_in">cp</span> Fira-master/ttf/* /usr/share/fonts/truetype/fira</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>【Linux】配置</title>
    <url>/linux/%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="修改-hostname"><a href="#修改-hostname" class="headerlink" title="修改 hostname"></a>修改 hostname</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vi /etc/hostname</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>

<h2 id="Linux-Basics-Set-a-Static-IP-on-Ubuntu"><a href="#Linux-Basics-Set-a-Static-IP-on-Ubuntu" class="headerlink" title="Linux Basics - Set a Static IP on Ubuntu"></a><a href="https://www.howtoforge.com/linux-basics-set-a-static-ip-on-ubuntu">Linux Basics - Set a Static IP on Ubuntu</a></h2><p>Here is an example for an older Ubuntu Release:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">auto lo eth0</span><br><span class="line">iface lo inet loopback</span><br><span class="line">iface eth0 inet static</span><br><span class="line">	address 192.168.1.100</span><br><span class="line">	netmask 255.255.255.0</span><br><span class="line">	gateway 192.168.1.1</span><br></pre></td></tr></table></figure>

<p>And here an example for Ubuntu 16.04 and newer:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="comment"># and how to activate them. For more information, see interfaces(5).</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/network/interfaces.d/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># The loopback network interface</span></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The primary network interface</span></span><br><span class="line">auto ens33</span><br><span class="line">iface ens33 inet static</span><br><span class="line"> address 192.168.1.100</span><br><span class="line"> netmask 255.255.255.0</span><br><span class="line"> network 192.168.1.0</span><br><span class="line"> broadcast 192.168.1.255</span><br><span class="line"> gateway 192.168.1.1</span><br><span class="line"> dns-nameservers 8.8.8.8 8.8.4.4</span><br></pre></td></tr></table></figure>

<h2 id="Changing-ubuntu-server’s-language-to-english"><a href="#Changing-ubuntu-server’s-language-to-english" class="headerlink" title="Changing ubuntu server’s language to english"></a>Changing ubuntu server’s language to english</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get install language-pack-en language-pack-en-base manpages</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /etc/default/locale</span></span><br><span class="line">LANG=<span class="string">&quot;en_US.UTF-8&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">## OR</span></span><br><span class="line">sudo update-locale LANG=en_US.UTF-8</span><br></pre></td></tr></table></figure>

<h2 id="build-essential"><a href="#build-essential" class="headerlink" title="build-essential"></a>build-essential</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">apt-get install build-essential</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">sudo apt-get <span class="keyword">install</span> aptitude</span><br><span class="line">sudo aptitude <span class="keyword">install</span> build-essential</span><br></pre></td></tr></table></figure>

<h2 id="switch-between-gdm-lightdm"><a href="#switch-between-gdm-lightdm" class="headerlink" title="switch between gdm,lightdm"></a>switch between gdm,lightdm</h2><p><a href="http://www.webupd8.org/2011/07/how-to-switch-between-gdm-lightdm-or.html">http://www.webupd8.org/2011/07/how-to-switch-between-gdm-lightdm-or.html</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo dpkg-reconfigure lightdm</span><br></pre></td></tr></table></figure>

<h2 id="How-can-I-define-startup-applications-with-the-Awesome-Window-Manager-Ask-Ubuntu"><a href="#How-can-I-define-startup-applications-with-the-Awesome-Window-Manager-Ask-Ubuntu" class="headerlink" title="[How can I define startup applications with the Awesome Window Manager? - Ask Ubuntu]("></a>[How can I define startup applications with the Awesome Window Manager? - Ask Ubuntu](</h2><p><a href="https://askubuntu.com/questions/57264/how-can-i-define-startup-applications-with-the-awesome-window-manager">https://askubuntu.com/questions/57264/how-can-i-define-startup-applications-with-the-awesome-window-manager</a>)</p>
<p>Starting from a template<br>First you’ll need to copy the template rc.lua file into your home folder</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/.config/awesome</span><br><span class="line"><span class="built_in">cp</span> /etc/xdg/awesome/rc.lua ~/.config/awesome/</span><br></pre></td></tr></table></figure>

<p>Defining applications to start<br>Now using awesome - edit config copy the following code at the bottom of your new rc.lua file</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">local</span> cmds =</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;firefox&quot;</span>,</span><br><span class="line">    <span class="string">&quot;xedit&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> _,i <span class="keyword">in</span> <span class="built_in">pairs</span>(cmds) <span class="keyword">do</span></span><br><span class="line">    awful.util.spawn(i)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>In this example - firefox and xedit are run on startup.<br>An excellent wiki page describing this and much more can be found on <a href="https://wiki.archlinux.org/index.php/Awesome3#Autorun_programs">ArchLinux</a></p>
<h2 id="rootlogin"><a href="#rootlogin" class="headerlink" title="rootlogin"></a>rootlogin</h2><p>root 账号不能登录，提示 ssh permission denied 问题</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># add below line</span></span><br><span class="line">PermitRootLogin <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># then restart sshd</span></span><br><span class="line">service sshd restart</span><br></pre></td></tr></table></figure>

<h2 id="ubuntu-设置静态网络"><a href="#ubuntu-设置静态网络" class="headerlink" title="ubuntu 设置静态网络"></a>ubuntu 设置静态网络</h2><ol>
<li>修改 /etc/netplan/00-installer-config.yaml</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">network:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2</span></span><br><span class="line">  <span class="comment"># renderer: networkd</span></span><br><span class="line">  <span class="attr">ethernets:</span></span><br><span class="line">    <span class="attr">enp0s3:</span></span><br><span class="line">      <span class="attr">dhcp4:</span> <span class="literal">no</span></span><br><span class="line">      <span class="attr">addresses:</span> [<span class="number">192.168</span><span class="number">.137</span><span class="number">.15</span><span class="string">/24</span>]</span><br><span class="line">      <span class="attr">gateway4:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.1</span></span><br><span class="line">      <span class="attr">nameservers:</span></span><br><span class="line">        <span class="comment"># search: [itzgeek.local]</span></span><br><span class="line">        <span class="attr">addresses:</span> [<span class="number">233.5</span><span class="number">.5</span><span class="number">.5</span>, <span class="number">233.6</span><span class="number">.6</span><span class="number">.6</span>]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>执行命令：<code>netplay apply</code> 即可生效</li>
</ol>
]]></content>
      <tags>
        <tag>linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>《鸟哥的Linux私房菜》读书笔记</title>
    <url>/linux/%E9%B8%9F%E5%93%A5%E7%9A%84linux%E7%A7%81%E6%88%BF%E8%8F%9C/</url>
    <content><![CDATA[<h1 id="《鸟哥的-Linux-私房菜》读书笔记"><a href="#《鸟哥的-Linux-私房菜》读书笔记" class="headerlink" title="《鸟哥的 Linux 私房菜》读书笔记"></a>《鸟哥的 Linux 私房菜》读书笔记</h1><blockquote>
<p>逆序记录</p>
</blockquote>
<p>| 使用 crontab 时需要注意： –p502</p>
<ul>
<li>资源分配不均；</li>
<li>取消不要的输出选项；</li>
<li>安全的检验；</li>
<li>周与日、月不可同时并存；</li>
</ul>
<p>| cron 这个服务的最低检测限制是“分钟”。（编辑保存后，cron 的设置就生效了，<br>也有些例外情况，这时重启 crond 这个服务即可 <code>/etc/init.d/crond restart</code>） –p500</p>
<p>| 需要注意的是<code>crontab -e</code> 这个 crontab 其实是 /usr/bin/crontab 这个执行文件，<br>但是 /etc/crontab 可是一个“纯文本文件”，可以用 root 身份来编辑这个文件。–p500</p>
<p>| <code>crontab -l</code> 显示 crontab 的工作内容 –p500<br><code>crontab -r</code> 移除全部的 crontab 的工作内容</p>
<p>| crontab 的限制同 at 命令，主要通过两个文件（cron.allow、cron.deny） –p498</p>
<p>| 循环执行的例行性工作调度（crontab） –p498</p>
<p>| batch 系统有空时才进行后台任务。 –p497</p>
<p>| 利用 atq 来查询设置的 at 任务，<br>利用 atrm 来删除设置的 at 任务。 –p497</p>
<p>| 对 atd 程序施加限制：<br>利用 <code>/etc/at.allow</code> 与 <code>/etc/at.deny</code> 这两个文件来进行 at 的使用限制。 –p495</p>
<p>| 设置 atd 开机启动： –p495</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">chkconfig atd on</span><br></pre></td></tr></table></figure>

<p>| 手动启动 atd： –p494</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">/etc/init.d/atd restart</span><br></pre></td></tr></table></figure>

<p>| Linux 上常见的例行性工作 –p493</p>
<ul>
<li>进行日志文件的轮替</li>
<li>日志文件分析 logwatch 的任务</li>
<li>新建 locate 的数据库</li>
<li>whatis 数据库的建立</li>
<li>RPM 软件日志文件的新建</li>
<li>删除临时文件</li>
<li>与网络服务有关的分析行为</li>
</ul>
<p>| Linux 工作调度的种类：at， cron –p494<br>工作调度的方式：</p>
<ul>
<li>一种是例行性的，就是每隔一定的周期要来办的事项；</li>
<li>一种是突发性的，就是这次做完了以后就没有的那一种；</li>
</ul>
<h2 id="第-16-章"><a href="#第-16-章" class="headerlink" title="第 16 章"></a>第 16 章</h2><p>| LVM 相关命令汇整与 LVM 的关闭： –p488</p>
<p>| LVM 另一个重要功能：系统快照。<br>快照就是将当时的系统信息记录下来，就好像照相机记录一般。<br>将来若有任何数据改动了，则原始数据会被移到快照区，没有被改动的区域则由快照区<br>与文件系统共享。 –p483</p>
<p>| LVM 实作流程(LV 放大容量和 LV 缩小容量)：</p>
<ul>
<li>PV 阶段</li>
<li>VG 阶段</li>
<li>LV 阶段</li>
<li>文件系统阶段</li>
</ul>
<p>| 如果要强调性能与备份，那么就直接使用 RAID 即可，不需要使用 LVM 。 –p475</p>
<p>| 数据写入 LV 的机制：分为线性模式（默认推荐的）和交错模式。 –p475</p>
<p>| 之所以称“卷”，是因为可以讲文件系统像卷一样伸长或缩短之故吧。–p473</p>
<p>| LVM(Logical Volume Manager) 逻辑卷管理器： –p473<br>LVM 的重点在于可以弹性调整文件系统的容量！（即不需要重新分区、格式化）</p>
<p>| RAID 的功能设置：开机自启、自动挂载、关闭软件 RAID。 –p466</p>
<p>| 磁盘阵列可以通过硬件和软件的方式来构建。 –p466</p>
<ul>
<li>硬件的方式是使用磁盘阵列卡，好的很贵。</li>
<li>通过软件的方式（会占用较多的系统资源，例如 CPU 的运算和 I/O 总线资源。）使用 mdadm 命令来构建<br>磁盘阵列。</li>
</ul>
<p>| 磁盘阵列（RAID），即容错廉价磁盘阵列。RAID 可以通过一些技术（软件或硬件）将多个较小的磁盘整合<br>成为一个较大的磁盘设备；而这个较大的磁盘功能可不只是存储而已，它还具有数据保护的功能。 –p463<br>基于等级的不同，有不同的功能:</p>
<ul>
<li>RAID-0：性能最佳。（注意：由于数据是依序放置到各个磁盘分区。因此 RAID-0 只要有任何一块<br>磁盘的区块被损毁，在 RAID 上面的所有数据都会丢失而无法读取。）</li>
<li>RAID-1: 完整备份。这种模式也是需要相同的磁盘容量的，最好是一模一样的磁盘。如果是不同容量<br>的磁盘组成 RAID-1 时，那么总容量将以最小的那一块磁盘为主。</li>
<li>RAID 0+1，RAID 1+0：整合上面两个的优点，性能上拥有 RAID 0 的优点、安全上拥有 RAID 1 的备份<br>功能（但是也有 RAID 1 的缺点，总容量会少一半用来备份）。</li>
<li>RAID 5：性能与数据备份的均衡考虑。</li>
<li>Spare Disk：预备磁盘的功能。所谓的　 spare disk 就是一块或多块没有包含在原本磁盘阵列等级中的磁盘，<br>这块磁盘平时并不会被磁盘阵列所使用，当磁盘整列有任何磁盘损毁时，则这块　 spare disk 会被主动拉进<br>磁盘阵列中，并将坏掉的那块磁盘移除磁盘整列，然后立即重建数据系统。如此，你的系统则可以拥抱安康。</li>
<li>磁盘阵列的优点体现在：数据安全与可靠、读写性能的加强，容量的扩增。（尤其是数据的可靠性和完整性更是<br>　 RAID 的考虑重点）　–p466</li>
</ul>
<p>| Education is :</p>
<blockquote>
<p>Education is what, when, and why to do things.<br>Training is how to do it. Most your courses have been Training.<br>I am trying to talk about the Education part.<br>–Richard W. Hamming (<a href="http://mat.uc.pt/~zhang/teaching.html">http://mat.uc.pt/~zhang/teaching.html</a>)</p>
</blockquote>
<p>| api 使用步骤：(this is how)</p>
<ul>
<li>调用的命令；（知道自己要干啥）</li>
<li>设置参数；（知道自己干啥时要选择那些配置）</li>
<li>整串执行；（开始 do it. ）</li>
</ul>
<p>| warnquota: 对超过限额者发出警告信； –p460</p>
<p>| quota 的报表主要有两种模式：<br>一种是针对每个个人或用户组的 quota 命令，<br>一个是针对整个文件系统的 repquota 命令；</p>
<p>| 坐而言不如起而行。 –p454</p>
<p>| Quota 的使用限制： –p452</p>
<ul>
<li>仅能针对整个文件系统；</li>
<li>内核必须支持 Quota；</li>
</ul>
<p>| 开始看不懂了，心里发毛了。</p>
<blockquote>
<p>底下的幾篇文章是學習 Linux 的基礎文件，這些文件是基礎中的基礎，如果您能將其中的文件都看完並且消化過，那麼未來在管理 Linux 主機以及架設網站方面，就能夠達到『事半功倍』的成效，請不要忽略這部份了！否則，再怎麼討論都是枉然的啦！因為 Linux 的資料非常的多，每份資料彼此的相關性都很強，要單獨的一項一項講解並不容易， 所以底下的文件該怎麼看呢？建議先按照順序將內容大致瀏覽過一次，看不懂的地方也可以先略過不要緊。 全部看完之後，再從頭開始『仔細』的實際操作過一遍，那應該就能夠進入 Linux 的世界囉～<br>另外，每篇文章底下的日期，指的是重大改版日期而非最新日期，每篇文章的最新日期請以該篇文章最下方的工作日誌為主的喔！<br><a href="http://linux.vbird.org/linux_basic/">http://linux.vbird.org/linux_basic/</a></p>
</blockquote>
<p>| Quota(磁盘配额), 就字面上的意思来看，就是有多少“限额”的意思。如果是用在零用钱上面，就是类似<br>“有多少零用钱一个月”的意思。在 Linux 系统中，由于是多用户、多任务的环境，所以会有多用户<br>使用一个硬盘空间的情况发生，如果其中有少数几个用户大量占掉了硬盘空间的话，那肯定影响其他用户<br>的使用权限。因此管理员应该适当限制硬盘的空间给用户，以妥善分配系统资源。 –p452</p>
<p>| 特殊账号的手工新建：–p445</p>
<p>| 纯数字账号，容易和其他属性混淆（例如：UID 501, 权限 755），建议不要使用纯数字形式的账号；–p444</p>
<p>| chpasswd 常用于批量新建账号：<code>echo &quot;dmtsai:abcdef&quot; | chpasswd -m</code></p>
<p>| 一般来说，如果你正常使用 useradd 增加用户，使用 pwconv 并不会有任何的操作，因为<br><code>/etc/passwd</code> 与 <code>/etc/shadow</code> 并不会有以上两点问题（两个文件不对应）。不过，<br>如果手动设置账号，这个 pwconv 就很重要了。–p444</p>
<p>| mail -s “bashrc file content” lou &lt; ~/.bashrc ：讲文件的内容通过邮件发给 lou –p442</p>
<p>| wall、write 命令的进行需要等到用户在线才行。可以通过 mail 的方式寄出邮件。–p442</p>
<p>| 通过广播的方式发送消息： wall “I will shutdown my linux server…” –p442</p>
<p>| 不接收任何消息： mesg n<br>接收消息： mesg y</p>
<p>| 为什么 root 无法以 telnet 直接登录系统，但是却能够使用 ssh 直接登录？<br>telnet 会引用 login 的 PAM 模块，而 login 的验证会有 /etc/securetty 的限制。<br>由于远程连接属于 pts/n (n 为数字)的动态终端机接口设备名称，并么有写入到 /etc/securetty,<br>因此 root 无法以 telnet 登录远程主机。而 ssh 使用的是 /etc/pam.d/sshd 这个模块，<br>这个模块的验证阶段没有加入 pam_securetty， 因此就没有 /etc/securetty 的限制！<br>故可以从远程直接联机到服务器。</p>
<p>| login 的 PAM 验证机制流程：</p>
<ol>
<li>验证阶段；</li>
<li>授权阶段；</li>
<li>密码阶段；</li>
<li>会议阶段；</li>
</ol>
<p>| 我们以 passwd 这个命令调用 PAM。 当你执行 passwd 后这个程序调用 PAM 的流程是： –p435</p>
<ol>
<li>用户开始执行 /usr/bin/passwd 这支程序，并输入密码；</li>
<li>passwd 调用 PAM 模块进行验证；</li>
<li>PAM 模块会到 /etc/pam.d/ 中找寻与程序（passwd）同名的配置文件。</li>
<li>依据 /etc/pam.d/passwd 内的配置，引用相关的 PAM 模块逐步进行验证分析；</li>
<li>passwd 这支程序会依据 PAM 回传的结果决定下一个操作（重新输入新密码或者通过验证）</li>
</ol>
<p>| PAM（Pluggable Authentication Modules, 嵌入式模块）,<br>为解决账号密码可能不同步的验证问题。 –p434</p>
<p>| 可以通过给不需要登录的账户设置无法登录的合法 shell 来达到目的。 –p434</p>
<p>| 两次执行 sudo 在 5 分钟之内，那么再次执行 sudo 时就不需要再次输入密码了。 –p433</p>
<p>| 默认 root 可以切换任何身份且进行任何命令。–p431</p>
<p>| 通过 visudo 来修改 <code>/etc/sudoers</code>，避免其他修改方式造成的语法错误而无法使用 sudo. –p430</p>
<p>| 可以使用 sudo 的用户是通过输入用户自己的密码来执行后续的命令串。 –p430</p>
<p>| sudo<br>并非所有用户都可以执行 sudo , 而是仅有 /etc/sudoers 内的用户才能够执行 sudo 这个命令。<br>–p429</p>
<p>| 只执行一个只有 root 才能进行的命令，且执行完毕就恢复原本的身份。–p429</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">su - -c <span class="string">&quot;head -n 3 /etc/shadow&quot;</span></span><br></pre></td></tr></table></figure>

<p>| 使用“su -”切换成 root 的身份，以 login shell 的方式。 –p428</p>
<p>| 单纯使用“su”切换成 root 的身份，读取的变量设置方式为 non-login shell 的方式，<br>这种方式下很多原本的变量不会被改变。–p428</p>
<p>| 以<code>su -</code> 命令来切换，代表使用 login-shell 的变量文件读取方式来登录系统。 –p428</p>
<p>| 让一般用户转变为 root 身份。 –p428</p>
<ul>
<li>以 “su -” 直接将身份变成 root。（需要密码）</li>
<li>以 “sudo 命令” 执行 root 的命令串。</li>
</ul>
<p>| 针对新创建的文件，设置默认的 acl; –p426</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">setfacl -m d:u:myuser1:rx /srv/projecta <span class="comment"># 这样在 projecta目录中新创建的文件，就默认有 rx 权限了。</span></span><br></pre></td></tr></table></figure>

<p>| 针对某个用户具体设置权限： –p424</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">setfacl -m u:vbird1:rx test.txt <span class="comment"># 对于文件 test.txt，给用户 vbird1 设置权限 rx</span></span><br><span class="line">setfacl -m g:mygroup1:rx test.txt <span class="comment"># 同上，设置用户组权限</span></span><br></pre></td></tr></table></figure>

<p>| acl 的设置：getfacl, setfacl –p424</p>
<p>| ACL (Access Control List), 提供传统的 owner、 group、 others 的 read、<br>write、 execute 权限之外的具体权限设置； –p423</p>
<p>| 用户组的新增与删除： –p420</p>
<ul>
<li>groupadd: 添加用户组</li>
<li>groupmod: 修改用户组（例如用户组 id, 用户组名）</li>
<li>groupdel: 删除用户组</li>
<li>用户组管理员：让某个用户组具有一个管理员，可以来管理哪些账号可以加入/移出用户组；<ul>
<li>新建一个用户组管理员： gpasswd groupname</li>
</ul>
</li>
</ul>
<p>| 是不是断了网就没法进行下去，其实也看是什么事情啦！</p>
<p>| 一般身份用户常用的账号数据更改与查询命令： –p417</p>
<ul>
<li>figure: 查询用户信息（大部分来源于 /etc/passwd 中的内容）</li>
<li>chsh: change shell</li>
<li>id: 查询某人或自己的相关 UID/GID 等的信息；</li>
</ul>
<p>| 用户修改与删除: usermod userdel –p416</p>
<p>| 对于 root 用户，唉～要帮一般账号新设密码需要使用 <code>passwd 账号</code> 的格式，使用 <code>passwd</code><br>表示修改自己的密码。–p414</p>
<p>| 使用 useradd 来创建 Linux 上的账号时至少会参考： –p413</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/etc/</span><span class="keyword">default</span>/useradd</span><br><span class="line"><span class="regexp">/etc/</span>login.defs</span><br><span class="line"><span class="regexp">/etc/</span>skel<span class="comment">/*</span></span><br></pre></td></tr></table></figure>

<p>| 在通过 useradd 来创建用户时，默认设置： –p411</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">useradd -D</span><br></pre></td></tr></table></figure>

<p>| 系统账号默认都不会主动创建主文件夹(可以通过参数 <code>-m</code> 强制添加)； –p410</p>
<p>| 添加用户: –p410</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">useradd vlou</span><br><span class="line">passwd vlou</span><br><span class="line">grep vlou /etc/passwd /etc/shadow /etc/group /home/vlou <span class="comment"># 查看创建后的属性</span></span><br></pre></td></tr></table></figure>

<p>| 加入用户组： –p408</p>
<ul>
<li>通过 root ，让其通过 usermod 命令；</li>
<li>通过 用户组管理员，让其通过 gpasswd 命令；</li>
</ul>
<p>| 有效用户组： –p408</p>
<ul>
<li>也就是使用<code>groups</code>命令得到的第一个用户组；</li>
<li>通过 <code>newgrp</code> 可以切换有效用户组；（首先必须要成为这个用户组的成员才可以执行）,<br>另外，执行了 <code>newgrp</code> 相当于启用了新的 shell, 可以 exit 退出。<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">groups</span> <span class="comment"># 查看用户所属组</span></span><br><span class="line">newgrp adm <span class="comment">#  切换到 adm 组, 以新 shell 进入</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="built_in">exit</span> <span class="comment"># 退出刚才切换的 shell</span></span><br><span class="line"><span class="built_in">groups</span> <span class="comment"># 此时恢复到之前的用户组</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>| 一个用户可以有多个用户组，那么用户在作业的时候，到底以哪个用户组为标准？ –p407<br>这个涉及到有效用户组（effective group） 和 初始用户组 （initial group）</p>
<p>| 忘记 root 密码： –p406</p>
<ul>
<li>在用户维护模式下修改；</li>
<li>以 Live CD 开机后挂载根目录去修改 /etc/shadow</li>
</ul>
<p>| 一般用户密码忘记了：这个最容易解决，请系统管理员帮忙，他会重新设置好你的密码而不需要知道你的旧密码<br>(利用 root 身份 使用 passwd 命令) –p406</p>
<p>| shadow 文件结构: –p403</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">lou@Lou:~$ sudo <span class="built_in">head</span> -n 4 /etc/shadow</span><br><span class="line">root:$6$ExVgN6IF<span class="variable">$GzxieFmtydKzA6pCaIjd1k</span>/wIhQmfqSDNQ6vrnCXZ4UkpgAQ5mdCu3Y4DS2DsnBkku4IzwW2HV4CxB2.I1.Oz.:17215:0:99999:7:::</span><br><span class="line">daemon:*:16911:0:99999:7:::</span><br><span class="line">bin:*:16911:0:99999:7:::</span><br><span class="line">sys:*:16911:0:99999:7:::</span><br></pre></td></tr></table></figure>

<ol>
<li>账号名称</li>
<li>密码</li>
<li>最近更动密码的日期</li>
<li>密码不可被更动的天数</li>
<li>密码需要重新更改的天数</li>
<li>密码需要更改期限前的警告天数</li>
<li>密码过期后的账号宽限时间</li>
<li>账号失效日期</li>
<li>保留</li>
</ol>
<p>| passwd 的文件结构： –p403</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">lou@Lou:~$ <span class="built_in">head</span> -n 4 /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br></pre></td></tr></table></figure>

<ol>
<li>账号名称</li>
<li>密码</li>
<li>UID</li>
<li>GID</li>
<li>用户信息说明列</li>
<li>主文件夹</li>
<li>Shell</li>
</ol>
<p>| 计算机认识 0 与 1, 人们认识账号；文件属性中的所有者实际上存储的是数字。 –p401</p>
<h2 id="第-14-章-Linux-账号管理与-ACL-权限设置"><a href="#第-14-章-Linux-账号管理与-ACL-权限设置" class="headerlink" title="第 14 章 Linux 账号管理与 ACL 权限设置"></a>第 14 章 Linux 账号管理与 ACL 权限设置</h2><p>| 睡不着觉：20170407, 起来看看。</p>
<p>| shell script 的追踪与调试： –p397</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sh [-nvx] scripts.sh</span><br><span class="line">-n: 不要执行 script, 仅查询语法的问题；</span><br><span class="line">-v: 在执行 script 前，现将script的内容输出到屏幕上；</span><br><span class="line">-x: 将使用到的 script 内容显示到屏幕上。</span><br></pre></td></tr></table></figure>

<p>| 运行程序时出现错误：通过以下方案解决。</p>
<ul>
<li><a href="https://my.oschina.net/zphj1987/blog/77884">syntax error: Bad for loop variable 解决办法(ubuntu)</a></li>
<li><a href="https://wiki.ubuntu.com/DashAsBinSh">DashAsBinSh</a><blockquote>
<p>错误为 Syntax error: Bad for loop variable<br>解决办法：sudo dpkg-reconfigure dash<br>在选择项中选 No<br>从 ubuntu 6.10 开始，ubuntu 就将先前默认的 bash shell 更换成了 dash shell；其表现为 /bin/sh 链接倒了/bin/dash 而不是传统的/bin/bash。<br>ubuntu edgy 是第一个将 dash 作为默认 shell 来发行的版本，这似乎是受了 debian 的影响。wiki 里面有官方的解释，<a href="https://wiki.ubuntu.com/DashAsBinSh%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8E%9F%E5%9B%A0%E6%98%AFdash%E6%9B%B4%E5%B0%8F%EF%BC%8C%E8%BF%90%E8%A1%8C%E6%9B%B4%E5%BF%AB%EF%BC%8C%E8%BF%98%E4%B8%8EPOSIX%E5%85%BC%E5%AE%B9%E3%80%82">https://wiki.ubuntu.com/DashAsBinSh，主要原因是dash更小，运行更快，还与POSIX兼容。</a><br>但 目前存在的问题是，由于 shell 的更换，致使很多脚本出错，毕竟现在的很多脚本不是 100%POSIX 兼容。<br>在 wiki 里面也说到，如 何将默认的 shell 改回 bash，方法就是<br>在终端执行 sudo dpkg-reconfigure dash<br>然后选 择 no</p>
</blockquote>
</li>
</ul>
<p>| 在 for 循环中如何表示一段连续的范围：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> sitenu <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 100)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="comment">#statements</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>| while 条件成立时执行条件；util 条件成立时退出条件； –p394</p>
<p>| 直到型（util）: 满足条件，就终止循环；</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">until</span> [[ condition ]]; <span class="keyword">do</span></span><br><span class="line">  <span class="comment">#statements</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>| 当型(while)：满足条件时，就进行循环；</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> [condition]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  程序段落</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>| 循环 –p393</p>
<ul>
<li>不断地执行某个程序段落；</li>
<li>直到用户设置的条件达成为止；</li>
</ul>
<p>| 利用 <code>function</code> 来重用轮子<br>在 shell script 当中的 function 的设置一定要在程序的最前面，这样才能够在执行时被找到<br>可用的程序段。<br>function 不但可以简化程序代码，而且可以做成类似“模块”的玩意儿。–p392</p>
<p>| 条件判断语句：<br><strong>if</strong> –p386</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> [条件判断式1]; <span class="keyword">then</span></span><br><span class="line">  <span class="comment"># 条件1成立时的逻辑</span></span><br><span class="line"><span class="keyword">elif</span> [条件判断式2]; <span class="keyword">then</span></span><br><span class="line">  <span class="comment">#  条件2成立的逻辑</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="comment"># 其他情况下的逻辑</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p><strong>case</strong> –p390</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> $变量名称 <span class="keyword">in</span></span><br><span class="line">  <span class="string">&quot;第1个变量的内容&quot;</span>)</span><br><span class="line">  程序段</span><br><span class="line">  ;;</span><br><span class="line">  <span class="string">&quot;第2个变量的内容&quot;</span>)</span><br><span class="line">  程序段</span><br><span class="line">  ;;</span><br><span class="line">  * )</span><br><span class="line">  程序段</span><br><span class="line">  ;;</span><br></pre></td></tr></table></figure>

<p>| <code>shift</code> 会移动变量，而且 shift 后面可以接数字，代表拿掉最前面的几个参数的意思。–p385<br>(左移)</p>
<p>| 在脚本文件中的较特殊的变量： –p384</p>
<ul>
<li><code>$#</code>: 代表后接的参数“个数”;</li>
<li><code>$@</code>: 代表”$1” 、”$2” 、”$3”之意思，每个变量是独立的</li>
<li><code>$*</code>: 代表”$1c$2c$3c$4”，其中 c 为分割字符，默认为空格键。</li>
</ul>
<p>| 在脚本文件中可以使用默认变量（$0, $1, $2） –p384</p>
<p>| 中括号比较常用在调剂判断式 if…then..fi 的情况中。–p383</p>
<p>| 也可以使用<code>[]</code>来测试，注意括号两边需要有空格。 –p382</p>
<p>| 利用 <code>test</code>命令的测试功能 –p380<br>各参数参考 p380；<br>eg.</p>
<ul>
<li><code>-e</code> 表示文件名是否存在；</li>
<li><code>-f</code> 该文件名是否存在且为文件（file）;</li>
<li><code>-d</code> 该文件名是否存在且为目录（directory）;</li>
<li><code>-z</code> 测试字符串是否为空：<code>test -z string</code></li>
</ul>
<p>| 利用 <code>source</code> 来执行脚本，脚本中的变量在父进程中依然可用（默认不可用）。–p379<br>eg. <code>source sh03.sh</code></p>
<p>| 利用 <code>$((运算内容))</code> 来进行数值运算。<br>例如： <code>echo $ (( 13 % 3))</code></p>
<p>| 脚本文件中的<code>exit 0</code>: –p376<br>表示离开 script 并且回传一个 0 给系统。（可以通过<code>echo $?</code> 来查看上一个命令的运行结果）</p>
<p>| 程序内容的说明(要养成这种好习惯)： –p376</p>
<ul>
<li>功能；</li>
<li>版本信息；</li>
<li>作者与联络方式；</li>
<li>版权声明方式；</li>
<li>较特殊的命令，使用”绝对路径”的方式来说明；</li>
<li>建立日期；</li>
<li>历史记录；</li>
<li>执行时需要的环境变量预先声明与设置；</li>
<li>批注说明；</li>
</ul>
<p>| 脚本文件中的第一行 <code>#!/bin/bash</code> 声明这个 script 使用的 shell 名称。 –p375<br>声明这个文件内的语法使用 bash 的语法。</p>
<p>| 可以利用 sh 的参数，如 -n 及 -x 来检查与追踪脚本文件的语法是否正确。 –p375</p>
<p>| 可以使用<code>sh shell.sh</code>来执行脚本文件：表示我想要直接以 bash 的功能来执行 shell.sh<br>这个文件。 –p375</p>
<p>| 名在 shell script 的编写中还需要用到下面的注意事项：</p>
<ol>
<li>命令的执行是从上而下、从左而右地分析与执行；</li>
<li>命令的执行就如同第 5 章内提到的：命令、参数间的多个空白都会被忽略掉；</li>
<li>空白行也将被忽略掉，并且[tab] 按键所得的空白同样视为空格键；</li>
<li>如果读到一个 Enter 符号 （CR）, 就尝试开始执行该行（或该串）命令；</li>
<li>至于如果一行的内容太多，则可以使用 <code>&quot;\[Enter]&quot;</code>来扩展至下一行；</li>
<li>“#”可作为批注。任何加在#后面的数据将全部被视为批注文字而被忽略。</li>
</ol>
<p>| shell script 用在系统管理上面是很好的一项工具，但是用在处理大量数值运算上，就不够好了，因为<br>shell script 的速度较慢，且使用的 CPU 资源较多，造成主机资源的分配不良。 –p374</p>
<p>| 为什么学习 shell script –p373</p>
<ul>
<li>自动化管理重要依据；</li>
<li>追踪管理系统的重要工作；</li>
<li>简单入侵检测系统；</li>
<li>连续命令单一化；</li>
<li>简单的数据处理；</li>
<li>跨平台支持与学习历程较短；</li>
</ul>
<p>| shell script 是针对 shell 所写的“脚本”!</p>
<h3 id="第-13-章-学习-shell-script"><a href="#第-13-章-学习-shell-script" class="headerlink" title="第 13 章 学习 shell script"></a>第 13 章 学习 shell script</h3><p>| 用 diff 可以用来制作补丁文件，然后通过 <code>patch</code> 来更新或还原文件。 –p368</p>
<p>| diff 和 cmp 的区别： –p367</p>
<ul>
<li>diff: 以行为单位;</li>
<li>cmp： 以字节为单位；</li>
</ul>
<p>| cmp 也用来比较两个文件，利用“字节”单位去比较。还可以用来比较非纯文本文件；–p367</p>
<p>| diff 还可以来比较两个目录：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">diff /etc/rc3.d/ /etc/rc5.d</span><br></pre></td></tr></table></figure>

<p>| diff 一般用来比较文本文件，并且以行为单位来比较。<br>diff 通常是用在同一文件的新旧版本区别上。 –p367</p>
<p>| awk 主要是处理每一行的字段内的数据，而默认的字段的分隔符为空格键或[tab]键。 –p364</p>
<p>| 相比于 sed 常常作用于一整行的处理， awk 则比较倾向于将一行分成数个 “字段” 来处理。 –p363</p>
<p>| <code>printf</code>，按照指定的格式来输出。 –p363</p>
<p>| 特别注意 <code>!</code> 在正则表达式中并不是特殊字符。 –p361</p>
<p>| 扩展型正则表达式可以通过组功能 “|” 来进行一次查找。 –p361</p>
<p>| <code>sed</code> 的查找和替换类似于 <code>vi</code> –p359</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/要被替换的字符串/新的字符串/g&#x27;</span></span><br></pre></td></tr></table></figure>

<p>| <code>sed</code> 后面的动作，务必要以 <code>&#39;&#39;</code> 两个单引号括住； –p358</p>
<p>| <code>sed</code> 本身是一个管道命令，可以分析 standard input<br>而且还可以将数据进行替换、删除、新增、选取特定行等的功能。 –p357</p>
<p>| 限定字符重复数:<code>&#123;&#125;</code> –p355<br>两个 o： <code>&#39;o\&#123;2\&#125;&#39;</code><br>两个 o 以上： <code>&#39;o\&#123;2,\&#125;&#39;</code><br>两-五个 o： <code>&#39;o\&#123;2,5\&#125;&#39;</code></p>
<p>| 去掉空白行和去掉以<code>#</code>开头的行：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">grep <span class="string">&#x27;^$&#x27;</span> -v regular_express.txt | grep -v <span class="string">&#x27;^#&#x27;</span> -n</span><br></pre></td></tr></table></figure>

<p>| 找到空白行： –p354</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">grep <span class="string">&#x27;^$&#x27;</span> -n regular_express.txt</span><br></pre></td></tr></table></figure>

<p>| 特殊字符若在正则表达式中有特殊含义，需要用转义字符<code>\</code>来加以修饰。 –p353</p>
<p>| 不想要开头是英文字母： –p353</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grep</span> -n <span class="string">&#x27;^[^a-zA-Z]&#x27;</span> regular_express.txt</span><br></pre></td></tr></table></figure>

<p>| 以<code>.</code>结尾的那一行的表示：<code>\.$</code> –p353</p>
<p>| 注意 –p353<br><code>[^a-z]</code> 和<code>^[a-z]</code>这两个是不一样的意思；<br>在<code>[]</code>内表示“反向选择”,<br>在<code>[]</code>外表示“定位在行首”。</p>
<p>| 下面的例子是一样的：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">grep -n <span class="string">&#x27;[[:digit:]]&#x27;</span> regular_express.txt</span><br><span class="line">grep -n <span class="string">&#x27;[0-9]&#x27;</span> regular_express.txt</span><br></pre></td></tr></table></figure>

<p>| 练习：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">grep -n <span class="string">&#x27;t[ea]st&#x27;</span> regular_express.txt</span><br></pre></td></tr></table></figure>

<p>注意：<code>[]</code>里面不论有几个字符，它都只代表某“一个”字符。<br>所以匹配了 tast 和 test。–p352</p>
<p>| 使用正则表达式，要注意语系的不同（编码） –p349</p>
<p>| 正则表达式和通配符是完全不一样的东西！ –p348<br>通配符代表的是 bash 操作接口的一个功能，<br>正则表达式是一种字符串处理的表示方式。</p>
<p>| 正则表达式的广泛用途</p>
<ul>
<li>系统管理员管理主机;</li>
<li>邮件服务器；</li>
</ul>
<p>| 正则表达式就是处理字符串的方法，它是以行为单位来进行字符串的处理行为，<br>正则表达式通过一些特殊符号的辅助，可以让用户轻易达到查找、删除、替换某特定字符串的处理<br>程序。 –p347</p>
<h2 id="第-12-章-正则表达式与文件格式化处理"><a href="#第-12-章-正则表达式与文件格式化处理" class="headerlink" title="第 12 章 正则表达式与文件格式化处理"></a>第 12 章 正则表达式与文件格式化处理</h2><p>| 管道命令的重点是它仅会处理 standard output, 对于 standard error output 会予以忽略。<br>管道命令必须要能够接受来自前一个命令的数据称为 standard input 继续处理才行。 –p344</p>
<p>| <code>tee</code> 会将数据流于文件和屏幕；而输出到屏幕的，其实就是 stdout, 可以让下个命令继续处理。<br>–p338</p>
<p>| grep 可以解析一行文字，取得关键字，若该行有存在关键字，就会整行显示出来。 –p336</p>
<p>| 数据流重定向就是将某个命令执行后应该要出现在屏幕上的数据传输到其他的地方，例如文件或者<br>是设备（例如打印机之类的） –p328</p>
<p>| source ： 读取环境变量文件的命令；</p>
<ul>
<li>利用 source 或小数点（.）都可以将配置文件的内容读进目前的 shell 环境中。–p324<br>(用来动态更新环境变量)</li>
</ul>
<p>| login shell 和 non-login shell 读取的配置文件数据是不一样的。 –p322</p>
<p>| 基本上，命令运行的顺序： –p320</p>
<ul>
<li>以相对/绝对路径执行命令，例如 “/bin/ls” 或 “./ls”;</li>
<li>由 alias 找到该命令莱执行;</li>
<li>由 bash 内置的命令来执行；</li>
<li>通过 $PATH 这个变量的顺序找到的第一个命令来执行；</li>
</ul>
<p>| alias 设置别名为什么要用单引号？<br>单引号、双引号、不用引号其实都可以，但是有些是有空格的，就需要用单引号或双引号：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">alias</span> lm=<span class="string">&#x27;ls -al | more&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> h=<span class="built_in">history</span></span><br></pre></td></tr></table></figure>

<p>| 命令别名与变量有什么不同？<br>命令别名是新创的一个新的命令，你可以直接执行该命令。<br>至于变量则需要使用类似 <code>echo</code> 命令才能调用变量的内容。</p>
<p>| 添加别名： <code>alias vi=&#39;vim&#39;</code><br>删除别名： <code>unalias vi</code></p>
<p>| 注意： alias 的定义规则与变量定义规则几乎相同，所以你只要在 alias 后面加上你的{“别名”=’命令参数…’}.<br>eg. <code>alias lm=&#39;ls -l | more&#39;</code> –p317</p>
<p>| <code>read</code> 想要跟用户对谈？用这个命令就对了。 –p310</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please keyin your name:&quot;</span> -t 30 named</span><br></pre></td></tr></table></figure>

<p>| 被 export 后的变量，我们可以称为“环境变量”。环境变量可以被子进程所引用，<br>但是其他的自定义变量内容就不会存在于子进程中。 –p309</p>
<p>| 可以将父进程的自定义变量变成环境变量，就可以让该变量值继续存在于子进程。–p308</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> 变量名称</span><br></pre></td></tr></table></figure>

<p>| 子进程仅会记录父进程的环境变量，子进程不会继承父进程的自定义变量。 –p307</p>
<p>| 留意：较高级的硬件通常会向下兼容旧有的软件，但较高级的软件可能无法在旧机器上面安装。 –p307<br>举例来说：你可以在 x86_64 的硬件上安装 i386 的 Linux 操作系统，但是你无法在 i686 的硬件<br>上安装 x86_64 的 Linux 操作系统。</p>
<p>| <code>?</code> 上一个命令的回传码。 –p307</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> $?</span><br></pre></td></tr></table></figure>

<p>| <code>$</code> 符号本身也是一个变量。这个代表的是目前这个 Shell 的线程代号，即是所谓的 PID。<br>想要知道外贸的 shell 的 PID， 用 “echo $$“ 即可，出现的数字就是你的 PID 号码。<br>（另外通过<code>bash</code> 命令来新建子进程，通过 <code>exit</code> 来推出子进程。） –p306</p>
<p>| 基本上，在 Linux 默认的情况下，使用{大写的字母}来设置的变量一般为系统内定需要的变量。–p306</p>
<p>| 自定义一个范围的随机数生成变量：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">declare</span> -i number=<span class="variable">$RANDOM</span>*10/32768;</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$number</span></span><br></pre></td></tr></table></figure>

<p>| 使用 <code>$(uname -r)</code> 来代替 ```;因为反单引号容易打错或看错。 –p304</p>
<p>| 给常用的目录设置变量： –p304</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 进入到一个很长的目录中;</span></span><br><span class="line"><span class="built_in">cd</span> /lib/modules/$(<span class="built_in">uname</span> -r)/kernel</span><br><span class="line"><span class="comment"># 2. 给当前目录设置变量：</span></span><br><span class="line">work=$(<span class="built_in">pwd</span>)</span><br><span class="line"><span class="comment"># 3. 在其他地方进入到这个常用目录：</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$work</span></span><br></pre></td></tr></table></figure>

<p>| 反单引号(`) 这个符号代表的意义为何？<br>在一串命令中，在 （`）之内的命令将会被先执行，而其执行出来的结果将作为外部的输入信息。<br>–p303</p>
<p>| 使用了单引号的时候，$name 将失去原有的变量内容，仅为一般字符的显示类型而已。 –p303</p>
<p>| 在变量的设置当中，单引号与双引号的用途有何不同？<br>答：单引号与双引号的最大不同在于双引号仍然可以保有变量的内容，<br>但单引号内仅能是一般字符，而不会有特殊符号。 –p303</p>
<p>| 在一般情况下，父进程的自定义变量是无法在子进程内使用的。<br>但是通过 export 将变量变成环境变量后，就能够在子进程下面应用了。 –p302</p>
<p>| bash 　优点　－－p297</p>
<ul>
<li>命令记忆能力；</li>
<li>命令与文件不全功能；</li>
<li>命令别名（alias）；</li>
<li>作业控制（jobs）前台、后台控制；</li>
<li>程序脚本；</li>
<li>通配符；</li>
</ul>
<p>| 为何学习　 shell？ –p295<br>－　相对于图形界面的软件， distributions 各家的 bash 　是一样的;<br>－　远程管理，命令行界面快速，稳定；<br>－　系统管理的利器；</p>
<p>| 一般用户只能通过 shell 来跟内核通信，以让内核达到我们所想要达到的工作。 –p294</p>
<p>| bash</p>
<ul>
<li>变量的设置和使用；</li>
<li>bash 操作环境的搭建；</li>
<li>数据流重定向的功能；</li>
<li>管道命令；</li>
</ul>
<h2 id="第-11-章-认识和学习-bash"><a href="#第-11-章-认识和学习-bash" class="headerlink" title="第 11 章 认识和学习 bash"></a>第 11 章 认识和学习 bash</h2><p>| 格式转换：<br><code>iconv -f big5 -t utf8 vi.big5 -o vi.utf8</code></p>
<p>| 尽可能使用 utf-8 来编码； -p289</p>
<p>| vim 记录操作的文件：<code>.viminfo</code></p>
<p>| 多窗口编辑：<br><code>:sp&#123;filename&#125;</code><br>如果想要在新窗口启动另一个文件，就添加文件名，否则仅输入 :sp 时，出现的则是同一个文件在两个<br>窗口间。</p>
<p>| 多文件编辑 –p286</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim hosts /etc/hosts</span><br></pre></td></tr></table></figure>

<p>| 块选择：<br>可以以块为单位，而不是以行为单位来处理你的整份文件。<br>借助 <code>[ctrl]+v</code> 来进行块选择； –p285</p>
<p>| 为什么要用 vim 呢？<br>因为 vim 具有颜色显示的功能，并且还支持许多的程序语法。 –p284</p>
<p>| 当我们在 vim 的一般模式下按下 [ctrl]-Z 的组合键时，你的 vim 会被丢到后台去执行； –p282</p>
<p>| 在 vi 里面，[TAB] 键所得到的结果与空格符所得到的结果是不一样的，特别强调一下。 –p277</p>
<p>| 3 种模式： –p276</p>
<ul>
<li>一般模式；</li>
<li>编辑模式；</li>
<li>命令行模式；</li>
</ul>
<p>| vim 支持的一些功能 –p276</p>
<ul>
<li>正则表达式的查找架构；</li>
<li>多文件编辑；</li>
<li>块复制；</li>
</ul>
<p>| 为何要学 vim –p275</p>
<ul>
<li>所有的 UNIX Like 系统都会内置 vi 文本编辑器，其他的文本编辑器不一定会存在。</li>
<li>很多软件的编辑借口都会主动调用 vi；</li>
<li>vim 具有程序编辑的能力，可以主动以字体颜色辨别语法的正确性，方便程序设计；</li>
<li>程序简单，编辑速度相当快速；</li>
</ul>
<h2 id="第-10-章-vim-程序编辑器"><a href="#第-10-章-vim-程序编辑器" class="headerlink" title="第 10 章 vim 程序编辑器"></a>第 10 章 vim 程序编辑器</h2><p>| 光盘刻录工具： cdrecord –p267</p>
<p>| 新建镜像文件：mkisofs –p265</p>
<p>| 和 <code>dump</code> 备份对应的是恢复 <code>restore</code> –p262</p>
<p>| <code>dump</code>,除了能针对整个文件系统备份之外，也能够仅针对目录来备份。 –p259</p>
<p>| 打包的时候，忽略某些文件： tar -jcv -f /root/system.tar.bz2 –exclude=/root/etc*<br>–p257</p>
<p>| 仅解开单一文件的做法： tar -jxv -f /root/etc.tar.bz2 etc/shadow –p256</p>
<p>| 其实最简单地使用 tar 就只要记忆下面的方式即可： –p254</p>
<ul>
<li>压缩： tar -jcv -f filename.tar.bzz2 要被压缩的文件或目录名称；</li>
<li>查询： tar -jtv -f filename.tar.bzz2</li>
<li>解压缩： tar -jxv -f filename.tar.bz2 -C 欲解压缩的目录；<br>注意：-c、-t、-x 不可同事出现在一串命令行中。</li>
</ul>
<p>| 打包与压缩是不同的概念： –p254</p>
<ul>
<li>打包：将多个文件和目录包成一个大文件；（例如：tar）</li>
<li>压缩：缩小文件体积；(例如： compress, gzip, bzip2)</li>
</ul>
<p>| <code>bzip2</code>的压缩比相对于 <code>gzip</code> 更好，用法同 <code>gzip</code>; –p253<br>使用 <code>bzcat</code>可以在不用解压缩的情况下，读取文本文件的内容。</p>
<p>| 通过 <code>zcat</code> 可以读取文本压缩文件的内容。–p252</p>
<p>| 压缩： <code>gzip [-cdtv#] 文件名</code></p>
<ul>
<li><code>-c</code> 输出到屏幕上，可以用来重定向输出到制定文件;</li>
<li><code>-d</code> 解压缩； （默认会删除掉原有的<code>gz</code>文件，同样可以组合<code>-c</code>参数而不删除 <code>gz</code> 文件）</li>
<li><code>-#</code> 压缩等级，用户可以自己指定压缩等级，-1 最快，压缩比差；-9 最慢，压缩比最好；<br>默认是 -6</li>
</ul>
<p>| compress 已经很少用了， gzip 可以说是应用最广的压缩命令了。<br>目前 gzip 可以解开 compress、zip、与 gzip 等软件所压缩的文件。–p252</p>
<p>| 文件扩展名的存在是为了便于人类小小的大脑的识别的。（虽然 linux 文件的属性基本上和文件名<br>没有绝对的关系） –p250</p>
<p>| 压缩技术：一些聪明的计算机工程师利用复杂的计算方式，讲没有使用到的空间“丢”出来，以让<br>文件占用的空间变小。 –p249</p>
<p>| 计算机上最小的计量单位是 <code>bit</code>, 另外：1byte = 8bit</p>
<h2 id="第-9-章-文件与文件系统的压缩与打包"><a href="#第-9-章-文件与文件系统的压缩与打包" class="headerlink" title="第 9 章: 文件与文件系统的压缩与打包"></a>第 9 章: 文件与文件系统的压缩与打包</h2><p>| 常见的支持文件系统： –p209</p>
<ul>
<li>传统文件系统： ext2;</li>
<li>日志文件系统： ext3/NTFS;</li>
<li>网络文件系统： NFS</li>
</ul>
<p>| 除非你有使用到大于 2TB 以上的磁盘，否则请使用 <code>fdisk</code> 这个程序来进行分区。 –p244</p>
<p>| 可以使用 <code>parted</code> 来处理高于 2TB 的分区情况。 –p243</p>
<p>| 使用<code>du -sb /etc</code>命令来查看目录所占用的所有空间。 –p243</p>
<p>| 使用<code>ls -l</code>去查询某个目录下的数据时，第一行都会出现一个<code>total</code>字样，<br>其实那就是该目录下的所有数据所占用的实际 block 数量 xblock 大小的值。–p243</p>
<p>| swap 的使用场合主要是在服务器上面，个人的桌面计算机一般用不到。–p241</p>
<p>| 构建 swap 分区 –p240</p>
<ul>
<li>使用物理分区：fdisk</li>
<li>使用文件块：dd</li>
</ul>
<p>| swap 的功能就是在应付物理内存不足的情况下所造成的内存扩展记录的功能。–p238</p>
<p>| 按照制定的参数格式设置到<code>/etc/fstab</code>文件中，即实现开机挂载。<br>注意：需要检查写入到<code>/etc/fstab</code>的语法有没有错误，这个很重要，因为文件如果写错了，<br>则你的 Linux 很可能将无法顺利开机完成！–p236</p>
<p>| 挂载点是什么？一定是目录。 –p235</p>
<p>| 开机挂载<br><code>/etc/fstab (file system table)</code>就是将我们利用 mount 命令进行挂载时，<br>将所有的参数写入到这个文件中就可以了。</p>
<p>| 使用<code>hdparm</code> 在 sata 上做测试：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">hdparm -Tt /dev/sda</span><br><span class="line">hdparm -Tt /dev/sdb</span><br></pre></td></tr></table></figure>

<p>| 可以通过 Label 的方式进行挂载： –p231</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mount -L <span class="string">&quot;vbird_logical&quot;</span> /mnt/ccc</span><br></pre></td></tr></table></figure>

<p>| e.g., 挂载一个 iso 文件到<code>/mnt/ccc</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mount xxxx.iso /mnt/ccc</span><br></pre></td></tr></table></figure>

<p>一般这种 iso 文件都是只读形式的，因此可能会有下面这种提示：<br><code>mount: /dev/loop0 is write-protected, mounting read-only</code><br>镜像文件不刻录就挂载使用。</p>
<p>| 进入到挂载目录中，进行卸载操作是不成功的。<br><code>umount: /media/cdrome: device is busy</code><br>解决办法是退出挂载目录，重新<code>umount</code><br>–p230</p>
<p>| 磁盘挂载： mount</p>
<p>| 磁盘检验：fsck, badblocks</p>
<p>| 磁盘分区完成后，进行格式化操作：<code>mkfs</code></p>
<p>| fdisk 没有办法处理大于 2TB 以上的磁盘分区。（可以使用 parted 这个命令） –p223</p>
<p>| fdisk<br>需要以管理员身份运行</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">fdisk /dev/sda</span><br><span class="line">fdisk /dev/sdb <span class="comment"># 注意不需要带具体数值</span></span><br></pre></td></tr></table></figure>

<p>| 要制作连接文件必须要使用<code>ln</code>这个命令；–p215</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ln</span> [-sf] 源文件 目标文件</span><br></pre></td></tr></table></figure>

<p>| <code>symbolic link</code>符号连接；（类似于 windows 上的快捷方式）</p>
<p>| hard link 连接有限制：</p>
<ul>
<li>不能跨文件系统；</li>
<li>不能连接到目录；</li>
</ul>
<p>| 注意硬链接和软连接的区别；–p213</p>
<p>| 整个 filesystem 其实都是 VFS（Virtual Filesystem Switch）进行管理；</p>
<p>| 根目录的上一级就是他自己。 <code>ls -ild / /. /..</code>，通过这个命令发现<code>inode</code>都是 2；</p>
<p>| Ext2 文件系统 –p197</p>
<h2 id="第-8-章"><a href="#第-8-章" class="headerlink" title="第 8 章"></a>第 8 章</h2><p>| 通过 find 来按时间属性查找：</p>
<ul>
<li>mtime</li>
<li>ctime</li>
<li>atime</li>
</ul>
<p>| 更新 locate 数据库：<br><code>updatedb</code></p>
<p>| 按文件名查找：</p>
<ul>
<li><code>whereis</code></li>
<li><code>locate</code></li>
</ul>
<p>| 查找<code>commond</code>的路径:<br><code>which -a ifconfig</code></p>
<p>| root 用户身份的 umask 权限默认是：022<br>一般用户身份的 umask 权限默认是：002 –p183</p>
<p>| 设置 umask: <code>umask 002</code></p>
<ul>
<li>具体运算规则，是默认的权限减去 umask 数值。</li>
</ul>
<p>| 新建文件的默认权限：-rw-rw-rw-<br>新建文件夹的默认权限：drwxrwxrwx<br>注意：具体的生成结果还得依赖于 umask 的值(拿掉 umask 的那一部分)。</p>
<p>| <code>ll; ls</code>:<br><code>;</code>分号表示连续命令的执行；</p>
<p>| <code>ll</code>命令是<code>ls -l</code>的缩写。–p179</p>
<p>| <code>touch</code>可以只用来修改时间，使用参数<code>-a</code>。 –p179<br>可以指定时间，使用<code>-d</code>参数。<br>还可以用来创建空文件。</p>
<p>| tail 命令：显示文件后面几行<br><code>-f</code>参数表示，持续检测文件的内容(实时性)。按 ctrl-c 停止检测。</p>
<p>| man 命令就是通过调用 less 来显示说明文件的内容的。</p>
<p>| <code>nl</code>显示文件的时候，顺便显示行号。</p>
<p>| <code>rename</code>更改大量文件的文件名</p>
<p>| <code>mv</code>命令<br>移动文件 &amp; 重命名文件</p>
<p>| <code>rm</code>命令<br>删除文件/目录</p>
<ul>
<li><code>-r</code> 遍历删除参数。（慎用）</li>
</ul>
<p>| 你是要站在巨人的肩膀上瞭望的。</p>
<p>| <code>mv</code>命令<br>用途：</p>
<ul>
<li>移动文件/文件夹；</li>
<li>用来重命名；</li>
</ul>
<p>| <code>cp</code>命令<br>用途：</p>
<ul>
<li><p>复制文件；<br>加上参数<code>-a</code> 讲文件的所有特性一起复制过来。（包括属性/权限）<br>这个功能常用来备份文件。<br>注意：复制给别人的文件要注意到文件的权限（否则别人无法修订）。<br>要复制连接文件的属性，就得使用 -d 的参数了。</p>
</li>
<li><p>创建链接（快捷方式）</p>
</li>
</ul>
]]></content>
      <tags>
        <tag>linux</tag>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMq</title>
    <url>/mq/RabbitMq/</url>
    <content><![CDATA[<p><a href="https://juejin.im/post/5dabec98e51d4524c06047aa">docker安装RabbitMq - 掘金</a></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">rabbitmq-server:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">rabbitmq</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rabbitmq:3.8-management</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">15672</span><span class="string">:15672</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">25672</span><span class="string">:25672</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">4369</span><span class="string">:4369</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">5671</span><span class="string">:5671</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">5672</span><span class="string">:5672</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./mq/rabbitmq:/var/lib/rabbitmq</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">TZ=Asia/Hong_Kong</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_USER=qq</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_PASS=1234</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">RABBITMQ_DEFAULT_VHOST=/qq</span></span><br></pre></td></tr></table></figure>
<p><a href="https://www.jianshu.com/p/2ecad37d64ff">Rabbit安装配置问题 - 简书</a></p>
<p><a href="https://www.jianshu.com/p/dae5bbed39b1">RabbitMQ入门教程（概念，应用场景，安装，使用） - 简书</a></p>
]]></content>
      <tags>
        <tag>mq</tag>
      </tags>
  </entry>
  <entry>
    <title>RocketMQ实现秒杀</title>
    <url>/mq/RocketMQ%E5%AE%9E%E7%8E%B0%E7%A7%92%E6%9D%80/</url>
    <content><![CDATA[<h2 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h2><p>virtualbox: 6.1<br>centos: 7.0<br>jdk: 1.8<br>rocketmq: <a href="https://archive.apache.org/dist/rocketmq/4.5.1/rocketmq-all-4.5.1-bin-release.zip">https://archive.apache.org/dist/rocketmq/4.5.1/rocketmq-all-4.5.1-bin-release.zip</a><br>rocketmq-console: <a href="https://github.com/apache/rocketmq-externals/tree/release-rocketmq-console-1.0.0">https://github.com/apache/rocketmq-externals/tree/release-rocketmq-console-1.0.0</a><br>redis: Redis-x64-5.0.10<br>mysql: 5.6</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改主机名</span></span><br><span class="line">hostnamectl set-hostname node1.com</span><br><span class="line">hostnamectl set-hostname node2.com</span><br><span class="line">hostnamectl set-hostname node3.com</span><br><span class="line">hostnamectl set-hostname node4.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 刷新终端</span></span><br><span class="line">bash</span><br><span class="line"><span class="comment"># 查看是否生效</span></span><br><span class="line">hostname</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改网络为具体某个ip</span></span><br><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-ens0s8</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">PEERDNS=<span class="built_in">yes</span></span><br><span class="line">PEERROUTES=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_PEERDNS=<span class="built_in">yes</span></span><br><span class="line">IPV6_PEERROUTES=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">NAME=enp0s8</span><br><span class="line">UUID=ed6c068c-149c-4678-8a13-d6e34a5d50c9</span><br><span class="line">DEVICE=enp0s8</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">IPADDR=192.168.56.11</span><br><span class="line">GATEWAY=192.168.56.1</span><br><span class="line">DNS1=10.0.2.2</span><br><span class="line">DNS2=8.8.8.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启网络</span></span><br><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>

<h2 id="修改和同步-hosts"><a href="#修改和同步-hosts" class="headerlink" title="修改和同步 hosts"></a>修改和同步 hosts</h2><ol>
<li>修改 node1.com</li>
</ol>
<figure class="highlight accesslog"><table><tr><td class="code"><pre><span class="line"><span class="number">192.168.56.11</span> node1.com</span><br><span class="line"><span class="number">192.168.56.12</span> node2.com</span><br><span class="line"><span class="number">192.168.56.13</span> node3.com</span><br><span class="line"><span class="number">192.168.56.14</span> node4.com</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">scp /etc/hosts root@node1.com:/etc/hosts</span><br><span class="line">scp /etc/hosts root@node2.com:/etc/hosts</span><br><span class="line">scp /etc/hosts root@node3.com:/etc/hosts</span><br><span class="line">scp /etc/hosts root@node4.com:/etc/hosts</span><br></pre></td></tr></table></figure>

<h2 id="启动-RocketMQ"><a href="#启动-RocketMQ" class="headerlink" title="启动 RocketMQ"></a>启动 RocketMQ</h2><p><strong>启动 nameserver</strong><br>node1 操作：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/root/c/rocketmq-all-4.5.1-bin-release/bin/mqnamesrv</span><br></pre></td></tr></table></figure>

<p>node2 操作：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/root/c/rocketmq-all-4.5.1-bin-release/bin/mqnamesrv</span><br></pre></td></tr></table></figure>

<p><strong>启动 broker</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@node1 ~]#</span><br><span class="line">/root/c/rocketmq-all-4.5.1-bin-release/bin/mqbroker -n &quot;node1.com:9876;node2.com:9876&quot; -c /root/c/rocketmq-all-4.5.1-bin-release/conf/2m-2s-sync/broker-a.properties</span><br><span class="line">[root@node2 ~]#</span><br><span class="line">/root/c/rocketmq-all-4.5.1-bin-release/bin/mqbroker -n &quot;node1.com:9876;node2.com:9876&quot; -c /root/c/rocketmq-all-4.5.1-bin-release/conf/2m-2s-sync/broker-b.properties</span><br><span class="line">[root@node3 ~]#</span><br><span class="line">/root/c/rocketmq-all-4.5.1-bin-release/bin/mqbroker -n &quot;node1.com:9876;node2.com:9876&quot; -c /root/c/rocketmq-all-4.5.1-bin-release/conf/2m-2s-sync/broker-a-s.properties</span><br><span class="line">[root@node4 ~]#</span><br><span class="line">/root/c/rocketmq-all-4.5.1-bin-release/bin/mqbroker -n &quot;node1.com:9876;node2.com:9876&quot; -c /root/c/rocketmq-all-4.5.1-bin-release/conf/2m-2s-sync/broker-b-s.properties</span><br></pre></td></tr></table></figure>

<p><strong>启动控制台</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/c/rocketmq-externals-rocketmq-console-1.0.0</span><br><span class="line">mvn clean package -Dmaven.test.skip</span><br><span class="line">java -jar /root/c/rocketmq-externals-rocketmq-console-1.0.0/rocketmq-console/target/rocketmq-console-ng-1.0.0.jar</span><br></pre></td></tr></table></figure>

<h2 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h2><p>通过分布式事务来保证一致性（数据库与 MQ 的一致性）</p>
<p><img src="http://cdn.lyloou.com/img/RocketMQ-2021-06-15-11-33-52.png" alt="RocketMQ-2021-06-15-11-33-52"></p>
<blockquote>
<p>RocketMQ 事务消息的实现原理就是基于两阶段提交和事务状态回查，来决定消息最终是提交还是回滚。</p>
</blockquote>
<ul>
<li><a href="https://juejin.cn/post/6844904099993878536">基于 RocketMQ 分布式事务 - 完整示例</a></li>
</ul>
<h2 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h2><p><strong>下单页</strong><br><a href="http://localhost:8081/order">http://localhost:8081/order</a><br><img src="http://cdn.lyloou.com/img/RocketMQ%E5%AE%9E%E7%8E%B0%E7%A7%92%E6%9D%80-2021-06-16-11-09-12.png" alt="RocketMQ实现秒杀-2021-06-16-11-09-12"></p>
<p><strong>支付页</strong><br><a href="http://localhost:8081/pay">http://localhost:8081/pay</a><br><img src="http://cdn.lyloou.com/img/RocketMQ%E5%AE%9E%E7%8E%B0%E7%A7%92%E6%9D%80-2021-06-16-11-09-30.png" alt="RocketMQ实现秒杀-2021-06-16-11-09-30"></p>
<p><strong>批量购买</strong><br><img src="http://cdn.lyloou.com/img/RocketMQ%E5%AE%9E%E7%8E%B0%E7%A7%92%E6%9D%80-2021-06-16-11-14-49.png" alt="RocketMQ实现秒杀-2021-06-16-11-14-49"><br>不会导致库存超卖<br><img src="http://cdn.lyloou.com/img/RocketMQ%E5%AE%9E%E7%8E%B0%E7%A7%92%E6%9D%80-2021-06-16-11-10-18.png" alt="RocketMQ实现秒杀-2021-06-16-11-10-18"></p>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p><a href="https://gitee.com/lyloou/practice-rocketmq-seckill/tree/feature_transaction/">https://gitee.com/lyloou/practice-rocketmq-seckill/tree/feature_transaction/</a></p>
]]></content>
      <tags>
        <tag>mq</tag>
      </tags>
  </entry>
  <entry>
    <title>Kafka相关</title>
    <url>/mq/kafka/</url>
    <content><![CDATA[<p><a href="https://www.cnblogs.com/jasongj/category/672183.html">Kafka - 随笔分类 - 郭俊 Jason - 博客园</a></p>
<p><a href="http://www.jasongj.com/2015/01/02/Kafka">www.jasongj.com/2015/01/02/Kafka</a> 深度解析/</p>
<h2 id="查看-kafka-消息队列的积压情况-12463494-51CTO-博客"><a href="#查看-kafka-消息队列的积压情况-12463494-51CTO-博客" class="headerlink" title="查看 kafka 消息队列的积压情况-12463494-51CTO 博客"></a><a href="https://blog.51cto.com/12473494/2420105">查看 kafka 消息队列的积压情况-12463494-51CTO 博客</a></h2><figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">kafka</span><span class="literal">-</span><span class="comment">consumer</span><span class="literal">-</span><span class="comment">groups</span><span class="string">.</span><span class="comment">sh</span> <span class="literal">--</span><span class="comment">bootstrap</span><span class="literal">-</span><span class="comment">server 172</span><span class="string">.</span><span class="comment">20</span><span class="string">.</span><span class="comment">154</span><span class="string">.</span><span class="comment">101:9092</span> <span class="literal">--</span><span class="comment">describe</span> <span class="literal">--</span><span class="comment">group  marketing_group | grep task</span><span class="literal">-</span><span class="comment">prize</span><span class="literal">-</span><span class="comment">gift</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/u013256816/article/details/79955578">Kafka 的 Lag 计算误区及正确实现_朱小厮的博客-CSDN 博客_kafka lag</a></p>
<p>查看正在运行的消费组<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/20210702092139.png" alt="kafka_2020-07-30-12-51-21"></p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">kafka-consumer-groups <span class="attr">--bootstrap-server</span> master:<span class="number">9092</span> <span class="attr">--list</span> <span class="attr">--new-consumer</span></span><br><span class="line">kafka-consumer-groups<span class="selector-class">.sh</span> <span class="attr">--bootstrap-server</span> ce-kafka:<span class="number">9092</span> <span class="attr">--list</span></span><br></pre></td></tr></table></figure>

<p>计算消息的消息堆积情况<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/20210702092149.png" alt="kafka_2020-07-30-12-51-47"></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kafka-consumer-groups --bootstrap-server master:9092 --describe --group  test_kafka_game_x_g1</span><br><span class="line">kafka-consumer-groups.sh --bootstrap-server ce-kafka:9092 --describe --group  default-group</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<blockquote>
<p>LogEndOffset 下一条将要被加入到日志的消息的位移<br>CurrentOffset 当前消费的位移<br>LAG 消息堆积量</p>
<p>消息堆积量：消息中间件服务端中所留存的消息与消费掉的消息之间的差值即为消息堆积量也称之为消费滞后量</p>
</blockquote>
<h2 id="kafka-清理数据日志-Adrian·Ding-博客园"><a href="#kafka-清理数据日志-Adrian·Ding-博客园" class="headerlink" title="kafka 清理数据日志 - Adrian·Ding - 博客园"></a><a href="https://www.cnblogs.com/ding2016/p/9294544.html">kafka 清理数据日志 - Adrian·Ding - 博客园</a></h2><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">log.dirs</span>=/data/kafka-logslog.cleaner.enable=<span class="literal">true</span></span><br><span class="line"><span class="attr">log.cleanup.policy</span> = delete　　　　// delete|compact</span><br><span class="line"><span class="attr">log.retention.hours</span>=<span class="number">168</span></span><br><span class="line"><span class="attr">log.segment.bytes</span>=<span class="number">1073741824</span></span><br><span class="line"><span class="attr">log.retention.check.interval.ms</span>=<span class="number">300000</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">kafka-configs.sh --zookeeper ce-zookeeper:2181 --entity-type topics --entity-name __consumer_offsets --describe</span><br><span class="line">kafka-configs.sh --zookeeper ce-zookeeper:2181 --entity-type topics --entity-name __consumer_offsets --alter --delete-config cleanup.policy</span><br></pre></td></tr></table></figure>

<h2 id="命令行操作"><a href="#命令行操作" class="headerlink" title="命令行操作"></a>命令行操作</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 创建名称为 topic_1 的主题</span></span><br><span class="line">kafka-topics.sh --zookeeper nodek.com:2181/myKafka --create --topic topic_1 --partitions 1 --replication-factor 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示消费组</span></span><br><span class="line">kafka-consumer-groups.sh --bootstrap-server nodek.com:9092 --list</span><br><span class="line">kafka-consumer-groups.sh --new-consumer --bootstrap-server nodek.com:9092 --list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 描述消费组（可以查看 offset, client_id, partition等）</span></span><br><span class="line">kafka-consumer-groups.sh --bootstrap-server nodek.com:9092 --describe --group  consumer_demo1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生产消息</span></span><br><span class="line">kafka-console-producer.sh --topic topic_1 --broker-list nodek.com:9092</span><br><span class="line"></span><br><span class="line"><span class="comment"># 消费消息（指定消费组为 console-consumer-83559）</span></span><br><span class="line">kafka-console-consumer.sh --bootstrap-server nodek.com:9092 --topic topic_1 --group console-consumer-83559</span><br><span class="line">kafka-console-consumer.sh --bootstrap-server 172.20.154.101:9092 --topic task-prize-gift-dev --from-beginning</span><br></pre></td></tr></table></figure>

<h2 id="kafka的concurrency-配置过大导致CPU占用率过大"><a href="#kafka的concurrency-配置过大导致CPU占用率过大" class="headerlink" title="kafka的concurrency 配置过大导致CPU占用率过大"></a>kafka的concurrency 配置过大导致CPU占用率过大</h2><p>问题：kafka的concurrency 配置过大导致CPU占用率过大。<br>说明和解决方案：3台机器，分区数量为10，concurrency修改前为30，修改后为3(<code>参考值：机器数量*concurrency&lt;=分区数</code>)</p>
<blockquote>
<p>修改前后趋势图<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/v3/202304131428849.png" alt="image.png"></p>
</blockquote>
<p>修改前：<img src="https://raw.githubusercontent.com/lyloou/img/develop/v3/202304131429741.jpg" alt="5dYCAwIUJ0.jpg"><br>修改后：<img src="https://raw.githubusercontent.com/lyloou/img/develop/v3/202304131430480.png" alt="image.png"></p>
<p><strong>注意：</strong><code>concurrent</code> 的数量和 <code>@KafkaListener</code> 是相关的（也可以通过注解参数配置覆盖factory的concurrency <code>@KafkaListener(concurrency = 3)</code>），互相直接的线程是不干扰的。<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/v3/202304131701372.png" alt="image.png"></p>
<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/v3/202304131659956.png" alt="image.png"></p>
<p><strong>消耗资源分析</strong><br>每一个consumer都会添加到线程池中<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/v3/202304131728246.png" alt="image.png"></p>
<p>每个consumer都会再 while 循环中执行 isRunning()和 pollAndInvoke() 方法（空轮询消耗CPU）。<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/v3/202304131736265.png" alt="image.png"></p>
<p>空轮询消耗CPU示例<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/v3/202304131740462.png" alt="image.png"></p>
<p>参考资料：<a href="https://cloud.tencent.com/developer/article/1846785">【spring-kafka】属性 concurrency 的作用及如何配置(RoundRobinAssignor 、RangeAssignor) - 云+社区 - 腾讯云</a></p>
<h2 id="其他参考资料"><a href="#其他参考资料" class="headerlink" title="其他参考资料"></a>其他参考资料</h2><p><a href="https://www.cnblogs.com/wangzhuxing/p/10111831.html#_label1_14">kafka 系列七、kafka 核心配置 - 小人物的奋斗 - 博客园</a></p>
<p><a href="https://blog.51cto.com/u_15239532/2858254">Apache Kafka-通过 concurrency 实现并发消费_小小工匠的技术博客_51CTO 博客</a><br><a href="https://blog.csdn.net/weixin_42331178/article/details/119936230">kafka 动态添加 topic，动态添加消费者_小小传奇的博客-CSDN 博客_kafka topic 动态</a><br><a href="https://blog.csdn.net/weixin_36380516/article/details/119524653?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1.pc_relevant_default&spm=1001.2101.3001.4242.2&utm_relevant_index=4">Kafka 中@KafkaListener 如何动态指定多个 topic<em>Java 知音</em>的博客-CSDN 博客</a><br><a href="https://blog.csdn.net/lishuangzhe7047/article/details/74530417">Kafka auto.offset.reset 值详解_lishuangzhe7047 的博客-CSDN 博客_auto.offset.reset</a><br><a href="https://blog.csdn.net/qq_29976261/article/details/90229375">Kafka 获得 topicPartition 的最早，最新 offset 的时间，以及存储量_卞卞要运动的博客-CSDN 博客_topicpartitions</a><br><a href="http://haoyuanliu.github.io/2020/07/24/Kafka%E6%B6%88%E8%B4%B9%E8%80%85%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/">Kafka 消费者重复消费问题解决 | 贫贫贫贫僧</a></p>
<p><a href="https://www.cfanz.cn/mobile/resource/detail/QzqWOjxEnjxEv">“高深莫测”的Kafka时间轮原理，原来也就这么回事-CFANZ编程社区</a></p>
]]></content>
      <tags>
        <tag>mq</tag>
      </tags>
  </entry>
  <entry>
    <title>RocketMQ 相关</title>
    <url>/mq/RocketMQ/</url>
    <content><![CDATA[<h2 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h2><p>virtualbox: 6.1<br>centos: 7.0<br>jdk: 1.8<br>rocketmq: <a href="https://archive.apache.org/dist/rocketmq/4.5.1/rocketmq-all-4.5.1-bin-release.zip">https://archive.apache.org/dist/rocketmq/4.5.1/rocketmq-all-4.5.1-bin-release.zip</a><br>rocketmq-console: <a href="https://github.com/apache/rocketmq-externals/tree/release-rocketmq-console-1.0.0">https://github.com/apache/rocketmq-externals/tree/release-rocketmq-console-1.0.0</a></p>
<h2 id="启动-RocketMQ"><a href="#启动-RocketMQ" class="headerlink" title="启动 RocketMQ"></a>启动 RocketMQ</h2><p><strong>启动 mq server</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./mqnamesrv</span><br></pre></td></tr></table></figure>

<p><strong>启动 broker</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./mqbroker -n localhost:9876</span><br></pre></td></tr></table></figure>

<p><strong>示例</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置 namesrv 地址环境</span></span><br><span class="line"><span class="built_in">export</span> NAMESRV_ADDR=localhost:9876</span><br><span class="line"><span class="comment"># 示例：生产</span></span><br><span class="line">sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer</span><br><span class="line"><span class="comment"># 示例：消费</span></span><br><span class="line">sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer</span><br></pre></td></tr></table></figure>

<p><strong>启动控制台</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/c/rocketmq-externals-rocketmq-console-1.0.0</span><br><span class="line">mvn clean package -Dmaven.test.skip</span><br><span class="line">java -jar /root/c/rocketmq-externals-rocketmq-console-1.0.0/rocketmq-console/target/rocketmq-console-ng-1.0.0.jar</span><br></pre></td></tr></table></figure>

<h2 id="基于-RocketMQ-分布式事务"><a href="#基于-RocketMQ-分布式事务" class="headerlink" title="基于 RocketMQ 分布式事务"></a>基于 RocketMQ 分布式事务</h2><p><img src="http://cdn.lyloou.com/img/RocketMQ-2021-06-15-11-33-52.png" alt="RocketMQ-2021-06-15-11-33-52"></p>
<blockquote>
<p>RocketMQ 事务消息的实现原理就是基于两阶段提交和事务状态回查，来决定消息最终是提交还是回滚。</p>
</blockquote>
<ul>
<li><a href="https://juejin.cn/post/6844904099993878536">基于 RocketMQ 分布式事务 - 完整示例</a></li>
</ul>
]]></content>
      <tags>
        <tag>mq</tag>
      </tags>
  </entry>
  <entry>
    <title>【Python】爬虫</title>
    <url>/python/%E7%88%AC%E8%99%AB/</url>
    <content><![CDATA[<ul>
<li><a href="https://zhuanlan.zhihu.com/p/21479334">如何学习 Python 爬虫[入门篇]？ - 知乎</a></li>
<li><a href="https://www.jianshu.com/p/e084c2b2b66d">lxml 学习笔记 - 简书</a></li>
</ul>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">pip3 <span class="keyword">install </span>lxml pandas <span class="keyword">bs4 </span>xlrd openpyxl</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>【Ruby】 Tool</title>
    <url>/ruby/tool/</url>
    <content><![CDATA[<h2 id="HTTP-服务"><a href="#HTTP-服务" class="headerlink" title="HTTP 服务"></a>HTTP 服务</h2><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">ruby -run -e httpd . -p <span class="number">5000</span></span><br></pre></td></tr></table></figure>

<p>Q: [2019-07-23 17:21:43] ERROR Encoding::CompatibilityError: incompatible character encodings: ASCII-8BIT and UTF-8<br>A: 参考<a href="https://jhuthasach.com/skills/2018/03/21/Jekyll%E4%B8%AD%E6%96%87%E4%B8%8D%E8%83%BD%E6%AD%A3%E5%B8%B8%E7%BC%96%E7%A0%81%E9%A2%84%E8%A7%88/">Jekyll 本地预览时路径中有中文不能编码无法预览 - Jhutha Sach</a></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vi /usr/lib/ruby/2.3.0/webrick/httpservlet/filehandler.rb</span></span><br><span class="line"><span class="number">520</span>           s =  <span class="string">&quot;&lt;TR&gt;&lt;TD class=\&quot;name\&quot;&gt;&lt;A HREF=\&quot;<span class="subst">#&#123;<span class="title class_">HTTPUtils</span><span class="symbol">:</span><span class="symbol">:escape</span>(name)&#125;</span><span class="subst">#&#123;query <span class="keyword">if</span> name.end_with?(<span class="string">&#x27;/&#x27;</span>)&#125;</span>\&quot;&gt;<span class="subst">#&#123;<span class="title class_">HTMLUtils</span><span class="symbol">:</span><span class="symbol">:escape</span>(dname)&#125;</span>&lt;/A&gt;&lt;/TD&gt;&quot;</span></span><br><span class="line"><span class="number">521</span>           s &lt;&lt; <span class="string">&quot;&lt;TD class=\&quot;mtime\&quot;&gt;&quot;</span> &lt;&lt; (time ? time.strftime(<span class="string">&quot;%Y/%m/%d %H:%M&quot;</span>) : <span class="string">&quot;&quot;</span>) &lt;&lt; <span class="string">&quot;&lt;/TD&gt;&quot;</span></span><br><span class="line"><span class="number">522</span>           s &lt;&lt; <span class="string">&quot;&lt;TD class=\&quot;size\&quot;&gt;&quot;</span> &lt;&lt; (size &gt;= <span class="number">0</span> ? size.to_s : <span class="string">&quot;-&quot;</span>) &lt;&lt; <span class="string">&quot;&lt;/TD&gt;&lt;/TR&gt;\n&quot;</span></span><br><span class="line"><span class="number">523</span>           res.body.force_encoding(<span class="string">&quot;UTF-8&quot;</span>) <span class="comment"># ============&gt; add this line</span></span><br><span class="line"><span class="number">524</span>           res.body &lt;&lt; s</span><br><span class="line"><span class="number">525</span>         &#125;</span><br><span class="line"><span class="number">526</span>         res.body &lt;&lt; <span class="string">&quot;&lt;/TBODY&gt;&lt;/TABLE&gt;&quot;</span></span><br><span class="line"><span class="number">527</span>         res.body &lt;&lt; <span class="string">&quot;&lt;HR&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="http://www.benjaminoakes.com/2013/09/13/ruby-simple-http-server-minimalist-rake/">Ruby Simple HTTP Server, minimalist Rake | Benjamin Oakes</a></li>
</ul>
<p><strong>tip: 快速重启脚本</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vi .bashrc</span></span><br><span class="line"><span class="comment"># add below line</span></span><br><span class="line"><span class="built_in">alias</span> xapk=<span class="string">&#x27;/usr/local/src/apk-server/restart.sh&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># restart.sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">kill</span> service ...</span><br><span class="line">ps -aux | grep ruby | grep 9090 | <span class="built_in">cut</span> -c 9-15 | xargs <span class="built_in">kill</span> -15</span><br><span class="line"><span class="built_in">echo</span> start service ...</span><br><span class="line"><span class="comment"># cd /usr/local/src/apk-server/smbshare &amp;&amp; nohup python -m SimpleHTTPServer 9090 &gt; /dev/null 2&gt;&amp;1 &amp;</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/src/apk-server/smbshare &amp;&amp; <span class="built_in">nohup</span> ruby -run -e httpd . -p 9090 &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="built_in">echo</span> oked</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>ruby</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Tool</title>
    <url>/python/tool/</url>
    <content><![CDATA[<h2 id="HTTP-服务"><a href="#HTTP-服务" class="headerlink" title="HTTP 服务"></a>HTTP 服务</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">python -m SimpleHTTPServer 8080</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># alias.sh</span></span><br><span class="line">www=<span class="string">&#x27;python -m SimpleHTTPServer 8000&#x27;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch 知多少-基础篇</title>
    <url>/search/Elasticsearch-1%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h2 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h2><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/ElasticSearch-basic_20211229152205725_8b645c.png" alt="ElasticSearch-basic"></p>
<h4 id="什么是-ES。ES-的功能、特点、使用场景"><a href="#什么是-ES。ES-的功能、特点、使用场景" class="headerlink" title="什么是 ES。ES 的功能、特点、使用场景"></a>什么是 ES。ES 的功能、特点、使用场景</h4><p>简介：<br>全称 Elasticsearch，是一个分布式、RESTful 风格的搜索和数据分析引擎。<br>通过 Elasticsearch，可以轻松地存储、搜索和分析大量数据。<br>速度快，近乎实时的存储和检索数据。扩展性好，可扩展到上百台服务器，处理 PB 级别的数据。<br>易使用，ES 使用 Lucene 作为核心实现索引和搜索功能，通过 ResutfulAPI 和 JavaAPI 来隐藏 Lucene 的复杂性。</p>
<p>官网：<br><a href="https://www.elastic.co/cn/elasticsearch/">https://www.elastic.co/cn/elasticsearch/</a></p>
<p>起源：<br>2004 年，失业的工程师 Shay Banon，帮老婆写一个菜谱搜索引擎。<br>封装 Lucene 开源项目做成了 compass，找到工作后，又基于 compass 封装成了 elasticsearch。<br>现在是 Elastic 创始人兼 Elastic 首席执行官。</p>
<p>功能：</p>
<ul>
<li>分布式的搜索引擎，类似谷歌、百度，也可以做站内搜索。</li>
<li>全文检索，具有模糊搜索，相关性排名，高亮等功能。</li>
<li>数据分析引擎，电商网站中商品销量排名前 10 的商家、新闻网点 1 个月访问量排名前 3 的板块。</li>
<li>海量数据的实时处理，分布式架构可以存储和检索大量数据，秒级的数据搜索和分析</li>
</ul>
<p>特点：</p>
<ul>
<li>安装方便，除了 java，没有其它依赖；修改几个参数即可搭建一个集群；</li>
<li>JSON 格式，输入和输出都是 JSON，不需要另外定义 Schema，快捷方便；</li>
<li>RESTful：基本操作都可以通过 http 接口进行；</li>
<li>分布式，每个节点都可做入口，加入的节点自动负载均衡；</li>
<li>多租户，可以根据不同用途区分索引，可同时操作多个索引；</li>
<li>支持超大数据，可以扩展到 PB 量级的数据。</li>
</ul>
<p>使用场景：</p>
<ul>
<li>搜索类场景，如电商、招聘、新闻</li>
<li>日志分析类场景，如经典的 ELK</li>
<li>数据预警和数据分析，如电商中的价格预警，销售量 top10 的品牌</li>
<li>商业 BI 系统，数据报表、预测热卖商品、推荐系统</li>
</ul>
<p>使用案例：<br>百科、stack overflow、github，elk 等</p>
<h4 id="搜索方案对比"><a href="#搜索方案对比" class="headerlink" title="搜索方案对比"></a>搜索方案对比</h4><p>Lucene<br>是由 Apache 基金会维护的信息搜索工具包，由 java 编写的。<br>包含索引结构，读写索引的工具，相关性工具，排序是一个框架，需要开发很多内容才能工作（数据获取、解析、分词等）</p>
<p>Solr<br>基于 Lucene 框架开发的查询服务器，封装了 Lucene 的细节，可以用 HTTP GET/POST 来查询、修改索引</p>
<p>Elasticsearch<br>基于 Lucene 核心开发的搜索引擎，采用了分布式实时文件存储的策略</p>
<p>三者共同点和区别</p>
<p>Solr 和 ES 是基于 Lucene 实现的。<br>Solr 利用 ZK 进行分布式管理，<br>ES 使用自带的分布式协调管理功能 Solr 实现更全面，功能多；<br>ES 注重核心功能，高级功能由扩展来实现</p>
<p>Solr 在传统搜索应用中表现好于 ES，ES 在实时搜索应用方面好于 Solr</p>
<h4 id="有哪些公司使用了-es"><a href="#有哪些公司使用了-es" class="headerlink" title="有哪些公司使用了 es"></a>有哪些公司使用了 es</h4><p><a href="https://elasticsearch.cn/explore/">https://elasticsearch.cn/explore/</a></p>
<p>从中文社区活动中可以看到有 华为、百度、腾讯、阿里、京东、美团、小米、今日头条、顺丰等</p>
<h4 id="什么是-es-集群和-es-节点"><a href="#什么是-es-集群和-es-节点" class="headerlink" title="什么是 es 集群和 es 节点"></a>什么是 es 集群和 es 节点</h4><p>节点：节点是 ES 的实例，是一个独立的进程，一般会将一个节点部署到一个服务器或虚拟机上。</p>
<p>按照角色分配为，master node（主节点）、data node（数据节点）、Coordinate node（协调节点）</p>
<p>主节点，主要职责是配置和管理集群中的节点。</p>
<p>数据节点，对数据的 CRUD 操作，还有搜索和聚合操作。</p>
<p>协调节点，将集群请求转发到主节点，将数据请求转发到数据节点<br>（每个节点都是自带协调节点功能的，也可以只作为协调节点。设置协调节点有益于降低主节点和数据节点负担，但过多会增加集群负担，因为需要同步状态）。</p>
<p>集群：ES 集群是一组连接在一起的 ES 节点实例。</p>
<p>集群规划策略：当前数据规模+适量增长规模。（后续可按需添加）</p>
<p>示例，三个节点和一个索引的集群（2 个主分片，4 个副本分片）<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/Elasticsearch-1%E5%9F%BA%E7%A1%80_20211231161535_2021-12-31-16-15-35.png" alt="Elasticsearch-1基础_20211231161535_2021-12-31-16-15-35"><br>我们发出的请求，可以被任何一个节点接收处理（首个处理的节点被称为协调节点），每个节点都知道集群中任一文档的位置，<br>可以将请求转发到需要的节点上。</p>
<ul>
<li><a href="https://juejin.cn/post/7038828692671299620">ES集群中各节点角色功能简介 - 掘金</a></li>
</ul>
<h4 id="安装-es-需要什么组件"><a href="#安装-es-需要什么组件" class="headerlink" title="安装 es 需要什么组件"></a>安装 es 需要什么组件</h4><p>只需要 java 环境即可（Lucene 是基于 java 编写的）</p>
<h4 id="如何安装、配置和启动"><a href="#如何安装、配置和启动" class="headerlink" title="如何安装、配置和启动"></a>如何安装、配置和启动</h4><blockquote>
<p>下载 ES 和 kibana: <a href="https://www.elastic.co/cn/start">https://www.elastic.co/cn/start</a></p>
</blockquote>
<p>创建 OS 的新用户用于启动 es 和 kibana</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 添加用户</span></span><br><span class="line">useradd estest</span><br><span class="line"><span class="comment"># 为用户添加密码</span></span><br><span class="line">passwd estest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改目录权限</span></span><br><span class="line"><span class="built_in">chown</span> -R estest /usr/elasticsearch</span><br><span class="line"><span class="built_in">chown</span> -R estest /usr/kibana</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换用户</span></span><br><span class="line">su estest</span><br></pre></td></tr></table></figure>

<ol>
<li>先安装 jdk，配置环境变量</li>
<li>安装 es、修改配置，并启动（非 root 用户启动） 验证： <a href="http://node.com:9200/">http://node.com:9200</a><br>启动：<code>./bin/elasticsearch</code></li>
<li>再安装 kibana，修改配置、并启动（非 root 用户启动） 进入 kibana: <a href="http://node.com:5601%EF%BC%8C%E7%82%B9%E5%87%BBdev_tools%E9%A1%B9%EF%BC%8C%E6%B5%8B%E8%AF%95%E3%80%82">http://node.com:5601，点击 dev_tools 项，测试。</a><br>启动：<code>./bin/kibana</code></li>
<li>es 集成 IK 分词器，添加 analysis-ik 插件，ik 分词器分 ik_max_word 模式（将文本做最细粒度拆分） 和 ik_smart 模式（将文本做最粗粒度拆分）。<br>扩展词典：自定义扩展词库、停用词库，远程扩展词库。<br>同义词典「具体操作参考讲义」</li>
</ol>
<p>启动报错的话，可能需要修改最大虚拟内存数量（在 root 下进行）<br><code>sysctl -a | grep vm.max_map_count</code></p>
<p>文件<code>/etc/systel.conf</code></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 限制一个进程拥有的VMA（虚拟内存区域）数量</span></span><br><span class="line"><span class="attr">vm.max_map_count</span>=<span class="number">655360</span></span><br></pre></td></tr></table></figure>

<p>使修改生效：<code>sysctl -p</code></p>
<p>修改 <code>/etc/security/limits.conf</code>，末尾追加（在 root 下进行，重新登录后生效）</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">*  soft  nofile   65536</span><br><span class="line">*  hard  nofile   65536</span><br><span class="line">*  soft  nproc  4096</span><br><span class="line">*  hard  nproc  4096</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/anqixiang/article/details/104922680">Linux 修改文件句柄数及 vm.max<em>map_count、stack size 的大小</em>运维</a></p>
<p>测试</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> _search</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">POST</span> _analyze</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span>,</span><br><span class="line">   <span class="string">&quot;text&quot;</span>: [<span class="string">&quot;南京市长江大桥&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">POST</span> _analyze</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span>,</span><br><span class="line">   <span class="string">&quot;text&quot;</span>: [<span class="string">&quot;南京市长江大桥&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">POST</span> _analyze</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span>,</span><br><span class="line">   <span class="string">&quot;text&quot;</span>: [<span class="string">&quot;南京市市长&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">PUT</span> /lagou-es-synonym</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;analysis&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">         <span class="string">&quot;word_sync&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;synonym&quot;</span>,</span><br><span class="line">            <span class="string">&quot;synonyms_path&quot;</span>: <span class="string">&quot;analysis-ik/synonym.txt&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;analyzer&quot;</span>: &#123;</span><br><span class="line">         <span class="string">&quot;ik_sync_max_word&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;filter&quot;</span>: [<span class="string">&quot;word_sync&quot;</span>],</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;custom&quot;</span>,</span><br><span class="line">            <span class="string">&quot;tokenizer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="string">&quot;ik_sync_smart&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;filter&quot;</span>: [<span class="string">&quot;word_sync&quot;</span>],</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;custom&quot;</span>,</span><br><span class="line">            <span class="string">&quot;tokenizer&quot;</span>: <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: &#123;</span><br><span class="line">         <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">         <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_sync_smart&quot;</span>,</span><br><span class="line">         <span class="string">&quot;search_analyzer&quot;</span>: <span class="string">&quot;ik_sync_smart&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">POST</span> /lagou-es-synonym/_doc/<span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;name&quot;</span>: <span class="string">&quot;拉勾是中国专业的互联网招聘平台&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable constant_">POST</span> /lagou-es-synonym/_doc/_search</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;match&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;china&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="什么是-Index（索引）"><a href="#什么是-Index（索引）" class="headerlink" title="什么是 Index（索引）"></a>什么是 Index（索引）</h4><p>一个索引可以理解成一个关系型的 Table(数据库表)，相类似结构的数据放在一个索引，不类似的结构放在不同索引中。</p>
<h4 id="什么是-Type（类型）"><a href="#什么是-Type（类型）" class="headerlink" title="什么是 Type（类型）"></a>什么是 Type（类型）</h4><p>代表 documet 属于 index 中的哪个类别，类似于数据库中的表，在 7.x 中弃用了这个概念，8.x 中完全删除</p>
<h4 id="什么是-Mapping（映射）"><a href="#什么是-Mapping（映射）" class="headerlink" title="什么是 Mapping（映射）"></a>什么是 Mapping（映射）</h4><p>定义了每个字段的类型信息，相当于关系型数据库中的表结构(Schema)</p>
<h4 id="什么是-Document（文档）"><a href="#什么是-Document（文档）" class="headerlink" title="什么是 Document（文档）"></a>什么是 Document（文档）</h4><p>存储 json 文档，相当于关系型数据库中的 Row(一行记录)</p>
<h4 id="什么是-Field（字段）"><a href="#什么是-Field（字段）" class="headerlink" title="什么是 Field（字段）"></a>什么是 Field（字段）</h4><p>存储某一具体字段，相当于关系型数据库中的 Column(列)</p>
<h4 id="与关系型数据库中的术语比较"><a href="#与关系型数据库中的术语比较" class="headerlink" title="与关系型数据库中的术语比较"></a>与关系型数据库中的术语比较</h4><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/Elasticsearch_%3E_2021-12-29-14-46-52.png" alt="Elasticsearch_&gt;_2021-12-29-14-46-52"></p>
<h4 id="什么是-shard（分片）"><a href="#什么是-shard（分片）" class="headerlink" title="什么是 shard（分片）"></a>什么是 shard（分片）</h4><p>将索引数据分成若干小块的过程，称为分片。</p>
<p>分片的作用是：当文档数据量太多，磁盘和处理能力不足，对客户端的请求响应变慢时，使用分片可以改善这些问题（吞吐量、性能）。</p>
<p>单台服务器无法存储大量数据，es 通过分片将数据分散到多个服务器，（也就是说可以横向扩展）</p>
<h4 id="什么是-replica（副本），有什么好处？"><a href="#什么是-replica（副本），有什么好处？" class="headerlink" title="什么是 replica（副本），有什么好处？"></a>什么是 replica（副本），有什么好处？</h4><p>副本是对分片的拷贝，当在高负载下可以提高查询的吞吐量，也能用来实现高可用。</p>
<p>高可用：当主分片出现问题时，副本可以用来替换主分片，保证集群高可用。</p>
<p>默认情况下，每个索引有 10 个分片，5 个主分片，5 个副本分片</p>
<h4 id="什么是倒排索引"><a href="#什么是倒排索引" class="headerlink" title="什么是倒排索引"></a>什么是倒排索引</h4><p>倒排索引，即关键词到文档 ID 的映射，每个关键词都对应有一组文档（每个文档中都有这个关键词），有了倒排索引，就可以很方便用户搜索。</p>
<p>每个文档都有对应的文档 ID，文档就可以被表示为一系列的关键词。</p>
<p>这些文档是通过分词器，提取出出现次数和位置等内容得到关键词信息。</p>
<p>倒排索引中两个重要细节：</p>
<ol>
<li>倒排索引中的所有词项对应一个或多个文档。</li>
<li>倒排索引中的词项，是根据字典序排列。</li>
</ol>
<p>正向索引：从索引库中依次遍历所有文档，从文档中查找关键词，根据打分规则打分，然后排出名次，再返回。</p>
<p>相比正向索引对每个文档的关键字遍历过程，倒排索引是通过关键字找到文档的过程。</p>
<h4 id="什么是-ik-分词器，作用是什么"><a href="#什么是-ik-分词器，作用是什么" class="headerlink" title="什么是 ik 分词器，作用是什么"></a>什么是 ik 分词器，作用是什么</h4><p>ik 分词器，是基于 java 语言的中文分词工具包。</p>
<p>ik 分词器 3.0 特性</p>
<ol>
<li>高处理能力。采用特有的“正向迭代最细粒度切分算法”，具有 60 万字/秒的处理能力</li>
<li>多子处理器分析模式。支持英文字母、数字、中文词汇等分词处理。</li>
<li>优化词典存储，更小的内存占用。支持扩展词典</li>
<li>提高了命中率。针对 Lucene 全文检索优化的查询分析器 KQueryParser，采用歧义分析算法优化查询关键字的搜索搜索排列组合。<a href="https://www.jdon.com/36617">分享 IKAnalyzer 3.0 中文分词器</a></li>
</ol>
<h4 id="DocValues-是什么，有什么作用"><a href="#DocValues-是什么，有什么作用" class="headerlink" title="DocValues 是什么，有什么作用"></a>DocValues 是什么，有什么作用</h4><p>DocValue 是一种列式存储结构，主要作用是解决字段值排序、聚合等问题（倒排索引对于检索性能好，但是对字段值排序却不理想）</p>
<p>搜索的时候，需要快速得到结果集</p>
<p>排序的时候，需要将正排索引（转置倒排索引，可以看作以文档为维度，实现根据指定字段的排序和聚合功能）</p>
<p>es 中的 DocValue 是默认激活的，在索引的时候创建，当字段索引时，为了快速检索，会把字段值加入到倒排索引中，同时他它也会存储字段的 DocValues。</p>
<p>应用场景：排序、聚合、过滤、脚本计算</p>
<p>当 docValues 远大于节点的可用内存时，OS 会将 doc values 放在内存中。</p>
<p>当 docValues 远小于节点的可用内存时，OS 会将 doc values 放在页缓存中，避免 jvm 堆内存溢出异常。</p>
<p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/docvalues-intro.html">Doc Values 介绍 | Elasticsearch: 权威指南 | Elastic</a></p>
<p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/docvalues.html">倒排索引和 UN 倒排索引 | Doc Values | Elasticsearch: 权威指南 | Elastic</a></p>
<h4 id="text-和-keyword-的区别是什么"><a href="#text-和-keyword-的区别是什么" class="headerlink" title="text 和 keyword 的区别是什么"></a>text 和 keyword 的区别是什么</h4><p>keyword 和 text 类型的主要区别是「是否分词」.</p>
<p>keyword 是不会分词的，是直接根据字符串的内容来建立倒排索引（只能通过精确值搜索到）。</p>
<p>text 是会分词的，在存入 text 类型的值时，会先分词，然后再建立倒排索引。</p>
<h4 id="什么是停顿词过滤"><a href="#什么是停顿词过滤" class="headerlink" title="什么是停顿词过滤"></a>什么是停顿词过滤</h4><p>没有意义的一类词，可以过滤掉的词。如「的」、「而」等等</p>
<h4 id="query-和-filter-的区别是什么"><a href="#query-和-filter-的区别是什么" class="headerlink" title="query 和 filter 的区别是什么"></a>query 和 filter 的区别是什么</h4><p>query: 不仅仅用于查询，还会计算分值，用于确定相关度。</p>
<p>filter: 仅查询，不会计算分值，也不会排序，结果可以缓存（提高性能）</p>
<h4 id="操作-定义、列出、更新、删除索引的语法"><a href="#操作-定义、列出、更新、删除索引的语法" class="headerlink" title="操作-定义、列出、更新、删除索引的语法"></a>操作-定义、列出、更新、删除索引的语法</h4><p>索引，类似于关系型数据库中的 database，有了索引才可以创建其它内容。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 创建-语法</span><br><span class="line"><span class="variable constant_">PUT</span> /索引名称</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;属性名&quot;</span>: <span class="string">&quot;属性值&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 创建-示例</span><br><span class="line"><span class="variable constant_">PUT</span> /lagou-company-index</span><br><span class="line"></span><br><span class="line"># 判断索引是否存在-语法</span><br><span class="line"><span class="variable constant_">HEAD</span> /索引名称</span><br><span class="line"># 判断索引是否存在-示例</span><br><span class="line"><span class="variable constant_">HEAD</span> /lagou-company-index</span><br><span class="line"></span><br><span class="line"># 查看索引-语法</span><br><span class="line"><span class="variable constant_">GET</span> /索引名称</span><br><span class="line"># 查看索引-示例</span><br><span class="line"><span class="variable constant_">GET</span> /lagou-company-index</span><br><span class="line"></span><br><span class="line"># 批量查看索引（用英文逗号隔开）</span><br><span class="line"><span class="variable constant_">GET</span> /索引名称<span class="number">1</span>,索引名称<span class="number">2</span></span><br><span class="line"></span><br><span class="line"># 查看所有索引</span><br><span class="line"># 方式<span class="number">1</span></span><br><span class="line"><span class="variable constant_">GET</span> _all</span><br><span class="line"># 方式<span class="number">2</span>，状态意义：绿色，分片都正常分配；黄色，至少有一个副本没有正确分配；红色，至少有一个主分片没有正确分配。</span><br><span class="line"><span class="variable constant_">GET</span> /_cat/indices?v</span><br><span class="line"></span><br><span class="line"># 打开和关闭索引：一旦索引被关闭，这个索引就只能显示元数据信息，不能做读写操作。</span><br><span class="line"># 打开索引-语法</span><br><span class="line"><span class="variable constant_">POST</span> /索引名称/_open</span><br><span class="line"># 打开索引-示例</span><br><span class="line"><span class="variable constant_">POST</span> /lagou-company-index/_open</span><br><span class="line"># 关闭索引-语法</span><br><span class="line"><span class="variable constant_">POST</span> /索引名称/_close</span><br><span class="line"># 关闭索引-示例</span><br><span class="line"><span class="variable constant_">POST</span> /lagou-company-index/_close</span><br><span class="line"></span><br><span class="line"># 删除索引-语法</span><br><span class="line"><span class="variable constant_">DELETE</span> /索引名称<span class="number">1</span>,索引名称<span class="number">2</span>,索引名称<span class="number">3</span></span><br><span class="line"># 删除索引-示例</span><br><span class="line"><span class="variable constant_">DELETE</span> /lagou-company-index,lagou-employee-index</span><br></pre></td></tr></table></figure>

<h4 id="操作-定义、列出、更新、删除映射"><a href="#操作-定义、列出、更新、删除映射" class="headerlink" title="操作-定义、列出、更新、删除映射"></a>操作-定义、列出、更新、删除映射</h4><p>索引创建后，就可以对字段设置约束信息，即字段映射（mapping）。</p>
<p>约束信息包括有：字段的数据类型、是否存储、是否索引、分词器</p>
<p>注意：</p>
<p>我们可以增加一个映射，但不能修改已存在的映射。<br>如易映射已经存在，那么数据可能已经被索引，意图修改这个映射，<br>索引的数据可能会出错，不能正常被索引。（即，除了新增操作，只能操作只能删除删除索引，新建映射）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># 创建映射-语法</span><br><span class="line"><span class="variable constant_">PUT</span> /索引库名/_mapping</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;字段名&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;类型&quot;</span>, # 可以是 text, long, short, date, integer, date等</span><br><span class="line">            <span class="string">&quot;index&quot;</span>: <span class="literal">true</span>, # 是否索引，默认<span class="literal">true</span>；<span class="literal">false</span>时，不能搜索</span><br><span class="line">            <span class="string">&quot;store&quot;</span>: <span class="literal">true</span>, # 是否独立存储, 默认<span class="literal">false</span>；独立存储时解析速度快，会占用更多的内存</span><br><span class="line">            <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;分词器&quot;</span> # 指定分词器中文中会</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 创建映射-示例</span><br><span class="line"><span class="variable constant_">PUT</span> /lagou-company-index</span><br><span class="line"><span class="variable constant_">PUT</span> /lagou-company-index/_mapping</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span> &#125;,</span><br><span class="line">    <span class="string">&quot;job&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>, <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span> &#125;,</span><br><span class="line">    <span class="string">&quot;logo&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>, <span class="string">&quot;index&quot;</span>: <span class="string">&quot;false&quot;</span> &#125;,</span><br><span class="line">    <span class="string">&quot;payment&quot;</span>: &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;float&quot;</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 查看映射关系-语法</span><br><span class="line"><span class="variable constant_">GET</span> /索引名称/_mapping</span><br><span class="line"># 查看映射关系-示例</span><br><span class="line"><span class="variable constant_">GET</span> /lagou-company-index/_mapping</span><br><span class="line"></span><br><span class="line"># 查看所有索引映射关系</span><br><span class="line"># 方式<span class="number">1</span></span><br><span class="line"><span class="variable constant_">GET</span> _mapping</span><br><span class="line"># 方式<span class="number">2</span></span><br><span class="line"><span class="variable constant_">GET</span> _all/_mapping</span><br><span class="line"></span><br><span class="line"># 修改索引映射关系-语法</span><br><span class="line"><span class="variable constant_">PUT</span> /索引名称/_mapping</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;类型&quot;</span>,</span><br><span class="line">      <span class="string">&quot;index&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;store&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;分词器&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 修改索引映射关系-示例（新增一个age映射）</span><br><span class="line"><span class="variable constant_">PUT</span> /lagou-company-index/_mapping</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;age&quot;</span>: &#123;</span><br><span class="line">         <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="操作-定义、列出、更新、删除文档"><a href="#操作-定义、列出、更新、删除文档" class="headerlink" title="操作-定义、列出、更新、删除文档"></a>操作-定义、列出、更新、删除文档</h4><p>文档，类似于关系型数据库中的一行记录。</p>
<p>是索引库中的数据，这些数据会根据索引规则创建索引，将来用于搜索。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"># 新增文档（可以手动指定id，也可以自动生成id）</span><br><span class="line"># 新增文档，手动指定id-语法</span><br><span class="line"><span class="variable constant_">POST</span> /索引名称/_doc/&#123;id&#125;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;属性名&quot;</span>: <span class="string">&quot;值&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"># 新增文档，手动指定id-示例</span><br><span class="line"><span class="variable constant_">POST</span> /lagou-company-index/_doc/<span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;name&quot;</span>: <span class="string">&quot;百度&quot;</span>,</span><br><span class="line">   <span class="string">&quot;job&quot;</span>: <span class="string">&quot;小度用户运营经理&quot;</span>,</span><br><span class="line">   <span class="string">&quot;payment&quot;</span>: <span class="string">&quot;30000&quot;</span>,</span><br><span class="line">   <span class="string">&quot;logo&quot;</span>: <span class="string">&quot;https://www.baidu.com/img/PCfb_5bf082d29588c07f842ccde3f97243ea.png&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 新增文档，自动生成id-语法</span><br><span class="line"><span class="variable constant_">POST</span> /索引名称/_doc</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;属性名&quot;</span>: <span class="string">&quot;值&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"># 新增文档，自动生成id-示例</span><br><span class="line"><span class="variable constant_">POST</span> /lagou-company-index/_doc</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;name&quot;</span>: <span class="string">&quot;百度&quot;</span>,</span><br><span class="line">   <span class="string">&quot;job&quot;</span>: <span class="string">&quot;算法工程师&quot;</span>,</span><br><span class="line">   <span class="string">&quot;payment&quot;</span>: <span class="string">&quot;50000&quot;</span>,</span><br><span class="line">   <span class="string">&quot;logo&quot;</span>: <span class="string">&quot;https://www.baidu.com/img/PCfb_5bf082d29588c07f842ccde3f97243ea.png&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 查看单个文档-语法</span><br><span class="line"><span class="variable constant_">GET</span> /索引名称/_doc/&#123;id&#125;</span><br><span class="line"># 查看单个文档-示例</span><br><span class="line"><span class="variable constant_">GET</span> /lagou-company-index/_doc/<span class="number">1</span></span><br><span class="line"></span><br><span class="line"># 查看所有文档-语法</span><br><span class="line"><span class="variable constant_">POST</span> /索引名称/_search</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;match_all&quot;</span>: &#123;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 查看所有文档-示例</span><br><span class="line"><span class="variable constant_">POST</span> /lagou-company-index/_search</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;match_all&quot;</span>: &#123;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 查看文档-通过_source定制返回结果（指定source中的返回字段，多个字段之间用逗号隔开）</span><br><span class="line"><span class="variable constant_">GET</span> /lagou-company-index/_doc/<span class="number">1</span>?_source=name,job</span><br><span class="line"></span><br><span class="line"># 更新文档分全部更新和局部更新。全部更新，是把之前的文档删除了（先标记删除，后台随后清理），然后再添加；局部更新，是指修改某个字段。</span><br><span class="line"># 更新文档之全部更新，同添加文档一样，只是将<span class="variable constant_">POST</span>换成了<span class="variable constant_">PUT</span>，并带上了id值，存在则更新，不存在则添加</span><br><span class="line"><span class="variable constant_">PUT</span> /lagou-company-index/_doc/<span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;name&quot;</span>: <span class="string">&quot;百度1&quot;</span>,</span><br><span class="line">   <span class="string">&quot;job&quot;</span>: <span class="string">&quot;小度用户运营经理&quot;</span>,</span><br><span class="line">   <span class="string">&quot;payment&quot;</span>: <span class="string">&quot;30000&quot;</span>,</span><br><span class="line">   <span class="string">&quot;logo&quot;</span>: <span class="string">&quot;https://www.baidu.com/img/PCfb_5bf082d29588c07f842ccde3f97243ea.png&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"># 更新文档之局部更新-语法</span><br><span class="line"><span class="variable constant_">POST</span> /索引名称/_update/&#123;id&#125;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;doc&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;field&quot;</span>: <span class="string">&quot;value&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 更新文档之局部更新-示例</span><br><span class="line"><span class="variable constant_">POST</span> /lagou-company-index/_update/<span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;doc&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;payment&quot;</span>: <span class="string">&quot;60000&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 删除文档-语法</span><br><span class="line"><span class="variable constant_">DELETE</span> /索引名称/_doc/&#123;id&#125;</span><br><span class="line"># 删除文档-示例</span><br><span class="line"><span class="variable constant_">DELETE</span> /lagou-company-index/_doc/<span class="number">1</span></span><br><span class="line"></span><br><span class="line"># 根据查询条件删除-语法</span><br><span class="line"><span class="variable constant_">POST</span> /索引名称/_delete_by_query</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">         <span class="string">&quot;字段名&quot;</span>: <span class="string">&quot;搜索关键字&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 根据查询条件删除-示例</span><br><span class="line"><span class="variable constant_">POST</span> /lagou-company-index/_delete_by_query</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">         <span class="string">&quot;name&quot;</span>: <span class="string">&quot;百度1&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 删除所有文档-语法</span><br><span class="line"><span class="variable constant_">POST</span> /索引名/_delete_by_query</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;match_all&quot;</span>:&#123;&#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 删除所有文档-示例</span><br><span class="line"><span class="variable constant_">POST</span> /lagou-company-index/_delete_by_query</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 全量替换文档，同「更新文档之全部更新」</span><br><span class="line"><span class="variable constant_">PUT</span> /lagou-company-index/_doc/<span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;name&quot;</span>: <span class="string">&quot;百度1&quot;</span>,</span><br><span class="line">   <span class="string">&quot;job&quot;</span>: <span class="string">&quot;小度用户运营经理&quot;</span>,</span><br><span class="line">   <span class="string">&quot;payment&quot;</span>: <span class="string">&quot;30000&quot;</span>,</span><br><span class="line">   <span class="string">&quot;logo&quot;</span>: <span class="string">&quot;https://www.baidu.com/img/PCfb_5bf082d29588c07f842ccde3f97243ea.png&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"># 强制创建，如果存在时不想替换，不存在时才创建</span><br><span class="line"><span class="variable constant_">PUT</span> /lagou-company-index/_doc/<span class="number">1</span>/_create</span><br><span class="line"># 或者 <span class="variable constant_">PUT</span> /lagou-company-index/_doc/<span class="number">1</span>?op_type=create</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;payment&quot;</span>: <span class="string">&quot;30000&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="操作-执行搜索有哪些方法"><a href="#操作-执行搜索有哪些方法" class="headerlink" title="操作-执行搜索有哪些方法"></a>操作-执行搜索有哪些方法</h4><p>方式 1（最常用）：基于 DSL 检索 Elasticsearch provides a full Query DSL (Domain Specific Language) based on JSON to define queries<br>示例：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> /lagou-company-index/_search</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">         <span class="string">&quot;filter&quot;</span>: [</span><br><span class="line">            &#123;<span class="string">&quot;match&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;百度1&quot;</span>&#125;&#125;</span><br><span class="line">         ]</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方式 2： 基于 URL 检索</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="built_in">GET</span> /lagou-company-index/_search?<span class="attribute">q</span>=name:百度2</span><br></pre></td></tr></table></figure>

<p>方式 3（不推荐）：类 SQL 检索</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> /_sql?format=txt</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: <span class="string">&quot;SELECT * FROM lagou-compony-index&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Query-DSL-支持哪些类型的查询"><a href="#Query-DSL-支持哪些类型的查询" class="headerlink" title="Query DSL 支持哪些类型的查询"></a>Query DSL 支持哪些类型的查询</h4><p>ES 提供了基于 JSON 的完整查询 DSL 来定义查询。</p>
<p>将 DSL 视为查询的 AST（抽象语法树），由叶子查询子句和复合查询子句组成。</p>
<p><strong>叶子查询子句</strong>：</p>
<p>叶子查询，在特定域中寻找特定的值，如 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html">match</a>, <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html">term</a> 和 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html">range</a></p>
<p>「精确匹配」包括：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html">term</a>, exists, term set, <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html">range</a>, prefix, <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html">ids</a>, wildcard, regexp, fuzzy 等等</p>
<p>「全文检索」匹配：<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html">match</a>, match_phrase, multi_match, match_phrase_prefix, query_string 等等</p>
<p><strong>复合查询子句</strong></p>
<p>复合查询子句，包装了其它的叶子查询或复合查询，并用逻辑方式组合多个查询（如 bool 和 dis_max 查询），或更改行为（如，constant_score 查询）</p>
<ol>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-constant-score-query.html">Constant score query </a></li>
</ol>
<p>包装一个查询，并且返回所有与相关分值等于 <code>boost</code> 参数的结果。</p>
<blockquote>
<p>Wraps a filter query and returns every matching document with a relevance score equal to the boost parameter value.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> /_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;constant_score&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;term&quot;</span>: &#123; <span class="string">&quot;user.id&quot;</span>: <span class="string">&quot;kimchy&quot;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;boost&quot;</span>: <span class="number">1.2</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-bool-query.html">Boolean query</a><br> bool 查询用 bool 操作来组合多个查询子句为一个查询</li>
</ol>
<p>bool 的 occurrence types 有： must， filter， should, must_not</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> _search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bool&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;must&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;term&quot;</span> : &#123; <span class="string">&quot;user.id&quot;</span> : <span class="string">&quot;kimchy&quot;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;filter&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;term&quot;</span> : &#123; <span class="string">&quot;tags&quot;</span> : <span class="string">&quot;production&quot;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;must_not&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;range&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;age&quot;</span> : &#123; <span class="string">&quot;gte&quot;</span> : <span class="number">10</span>, <span class="string">&quot;lte&quot;</span> : <span class="number">20</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;should&quot;</span> : [</span><br><span class="line">        &#123; <span class="string">&quot;term&quot;</span> : &#123; <span class="string">&quot;tags&quot;</span> : <span class="string">&quot;env1&quot;</span> &#125; &#125;,</span><br><span class="line">        &#123; <span class="string">&quot;term&quot;</span> : &#123; <span class="string">&quot;tags&quot;</span> : <span class="string">&quot;deployed&quot;</span> &#125; &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;minimum_should_match&quot;</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="string">&quot;boost&quot;</span> : <span class="number">1.0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>带排序的查询</strong></p>
<p>相关性排序、字段值排序、组合排序</p>
<p>示例：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> /book/_search</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">&quot;sort&quot;</span>: [</span><br><span class="line">      &#123;<span class="string">&quot;_score&quot;</span>: &#123; <span class="string">&quot;order&quot;</span>: <span class="string">&quot;asc&quot;</span> &#125;&#125;</span><br><span class="line">      &#123;<span class="string">&quot;price&quot;</span>: &#123; <span class="string">&quot;order&quot;</span>: <span class="string">&quot;desc&quot;</span> &#125;&#125;,</span><br><span class="line">      &#123;<span class="string">&quot;timestamp&quot;</span>: &#123;<span class="string">&quot;order:&quot;</span>: <span class="string">&quot;desc&quot;</span> &#125;&#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>带分页的查询</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> /book/_search</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">&quot;size&quot;</span>: <span class="number">2</span>,</span><br><span class="line">   <span class="string">&quot;from&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># <span class="attr">size</span>: 每页显示多少页</span><br><span class="line"># <span class="attr">from</span>: 从当前页的起始索引位置。 <span class="keyword">from</span> = (pageNum - <span class="number">1</span>) * size</span><br></pre></td></tr></table></figure>

<p><strong>带高亮的查询</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> /lagou-company-index/_search</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">         <span class="string">&quot;name&quot;</span>: <span class="string">&quot;百&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">&quot;highlight&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;pre_tags&quot;</span>: <span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;post_tags&quot;</span>: <span class="string">&quot;&lt;/font&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;fields&quot;</span>: [&#123;<span class="string">&quot;name&quot;</span>:&#123;&#125;&#125;]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>批量查询</strong></p>
<p>批量操作可以减少网络开销</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"># 不同索引下</span><br><span class="line"><span class="variable constant_">GET</span> /_mget</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;docs&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;lagou-company-index&quot;</span>,</span><br><span class="line">         <span class="string">&quot;_id&quot;</span>: <span class="number">1</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;lagou-exployee-index&quot;</span>,</span><br><span class="line">         <span class="string">&quot;_id&quot;</span>: <span class="number">3</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 同一索引下</span><br><span class="line"><span class="variable constant_">GET</span> /lagou-company-index/_mget</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;docs&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">&quot;_id&quot;</span>: <span class="number">1</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="string">&quot;_id&quot;</span>: <span class="number">3</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br><span class="line"># 或</span><br><span class="line"><span class="variable constant_">POST</span> /lagou-company-index/_search</span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;ids&quot;</span>: &#123;<span class="string">&quot;values&quot;</span>: [<span class="string">&quot;1&quot;</span>,<span class="string">&quot;3&quot;</span>]&#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>批量增删改</strong></p>
<p>将一系列的增删改操作，通过一条请求完成，减少网络开销。</p>
<p>语法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> /_bulk</span><br><span class="line">&#123;<span class="string">&quot;action&quot;</span>: &#123;<span class="string">&quot;metadata&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;data&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>detete 不需要请求体</p>
<p>格式，每个 json 不能换行；相邻 json 必须换行。</p>
<p>示例</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> /_bulk</span><br><span class="line">&#123; <span class="string">&quot;delete&quot;</span>: &#123; <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;book&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;1&quot;</span> &#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;create&quot;</span>: &#123; <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;book&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5&quot;</span> &#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;test14&quot;</span>,<span class="string">&quot;price&quot;</span>:<span class="number">100.99</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;update&quot;</span>: &#123; <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;book&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;2&quot;</span>&#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;doc&quot;</span> : &#123;<span class="string">&quot;name&quot;</span> : <span class="string">&quot;test&quot;</span>&#125; &#125;</span><br></pre></td></tr></table></figure>

<h4 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h4><p>【金山文档】 ElasticSearch <a href="https://kdocs.cn/l/cpGSu8K35cQk">https://kdocs.cn/l/cpGSu8K35cQk</a><br><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/2.x/index.html">Elasticsearch: 权威指南 | Elastic</a></p>
]]></content>
      <tags>
        <tag>search</tag>
        <tag>知多少</tag>
      </tags>
  </entry>
  <entry>
    <title>Shell 脚本修改 Json 中某个字段值</title>
    <url>/shell/shell%20%E8%84%9A%E6%9C%AC%E4%BF%AE%E6%94%B9%20json%20%E4%B8%AD%E6%9F%90%E4%B8%AA%E5%AD%97%E6%AE%B5%E5%80%BC/</url>
    <content><![CDATA[<h2 id="shell-脚本修改-json-中某个字段的值"><a href="#shell-脚本修改-json-中某个字段的值" class="headerlink" title="shell 脚本修改 json 中某个字段的值"></a>shell 脚本修改 json 中某个字段的值</h2><ul>
<li>思路：通过 awk 来找到旧数据，然后用 sed 来替换旧数据</li>
</ul>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p>config.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;the_name&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;132869&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;content_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://hot.example.com/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;enable_feature1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;true&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;enable_feature2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>config/mode1.sh</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!bin/bash</span></span><br><span class="line">content_url_new=<span class="string">&quot;https://hot1.example.com/&quot;</span></span><br><span class="line">enable_feature1_new=<span class="string">&quot;true&quot;</span></span><br><span class="line">enable_feature2_new=<span class="string">&quot;true&quot;</span></span><br></pre></td></tr></table></figure>

<p>config/mode2.sh</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!bin/bash</span></span><br><span class="line">content_url_new=<span class="string">&quot;https://hot2.example.com/&quot;</span></span><br><span class="line">enable_feature1_new=<span class="string">&quot;false&quot;</span></span><br><span class="line">enable_feature2_new=<span class="string">&quot;false&quot;</span></span><br></pre></td></tr></table></figure>

<p>main.sh</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> != <span class="string">&quot;mode1&quot;</span> -a <span class="string">&quot;<span class="variable">$1</span>&quot;</span> != <span class="string">&quot;mode2&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;tip:─┬─────── 您输入参数不对，请重试：&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;     │─────── &#x27;mode1&#x27;, 使用config/mode1.sh的配置&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;     └─────── &#x27;mode2&#x27;, 使用config/mode2.sh的配置&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">mode1)</span><br><span class="line">    . config/mode1.sh</span><br><span class="line">;;</span><br><span class="line">mode2)</span><br><span class="line">    . config/mode2.sh</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: sh main.sh [mode1|mode2]&quot;</span></span><br><span class="line">    <span class="built_in">exit</span>;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果要修改的内容在文档中唯一，可以做全局修改</span></span><br><span class="line">content_url_old=$(awk -F<span class="string">&quot;\&quot;&quot;</span> <span class="string">&#x27;/content_url/&#123;print $4&#125;&#x27;</span> example.json)</span><br><span class="line">sed -e <span class="string">&quot;s@<span class="variable">$content_url_old</span>@<span class="variable">$content_url_new</span>@g&quot;</span> -i example.json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果要修改的内容在文档中不唯一，就需要针对那一行做修改。（例如，这个例子中有两个布尔类型的值）</span></span><br><span class="line">enable_feature1_line=$(awk -F<span class="string">&quot;\&quot;&quot;</span> <span class="string">&#x27;/enable_feature1/&#123;print NR&#125;&#x27;</span> example.json) <span class="comment"># 记住行号</span></span><br><span class="line">enable_feature1_old=$(awk -F<span class="string">&quot;\&quot;&quot;</span> <span class="string">&#x27;/enable_feature1/&#123;print $4&#125;&#x27;</span> example.json)  <span class="comment"># 获取旧数据</span></span><br><span class="line">sed -e <span class="string">&quot;<span class="variable">$enable_feature1_line</span> s@<span class="variable">$enable_feature1_old</span>@<span class="variable">$enable_feature1_new</span>@&quot;</span> -i example.json <span class="comment"># 替换所在行的老数据</span></span><br><span class="line"></span><br><span class="line">enable_feature2_line=$(awk -F<span class="string">&quot;\&quot;&quot;</span> <span class="string">&#x27;/enable_feature2/&#123;print NR&#125;&#x27;</span> example.json) <span class="comment"># 记住行号</span></span><br><span class="line">enable_feature2_old=$(awk -F<span class="string">&quot;\&quot;&quot;</span> <span class="string">&#x27;/enable_feature2/&#123;print $4&#125;&#x27;</span> example.json)  <span class="comment"># 获取旧数据</span></span><br><span class="line">sed -e <span class="string">&quot;<span class="variable">$enable_feature2_line</span> s@<span class="variable">$enable_feature2_old</span>@<span class="variable">$enable_feature2_new</span>@&quot;</span> -i example.json <span class="comment"># 替换所在行的老数据</span></span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sh main.sh mode1</span><br><span class="line">sh main.sh mode2</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>Shell Tips</title>
    <url>/shell/tips/</url>
    <content><![CDATA[<h2 id="help-tips"><a href="#help-tips" class="headerlink" title="help tips"></a>help tips</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">help</span></span>()&#123;</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">HELP</span></span><br><span class="line"><span class="string">usage: dd ddk </span></span><br><span class="line"><span class="string">example: &#x27;wowo wowo&#x27;</span></span><br><span class="line"><span class="string">HELP</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$1</span> == <span class="string">&quot;&quot;</span> || <span class="variable">$1</span> == <span class="string">&quot;-h&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;what?&#x27;</span></span><br><span class="line">    <span class="built_in">help</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$1</span> != <span class="string">&quot;&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033]0;<span class="variable">$1</span>\007&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="read-from-terminal"><a href="#read-from-terminal" class="headerlink" title="read from terminal"></a>read from terminal</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> input your name:</span><br><span class="line"><span class="built_in">read</span> name</span><br><span class="line"><span class="built_in">echo</span> your name is <span class="variable">$&#123;name&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>linux</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>常用的shell命令（Windows平台上）</title>
    <url>/shell/%E5%B8%B8%E7%94%A8%E7%9A%84shell%E5%91%BD%E4%BB%A4%EF%BC%88Windows%E5%B9%B3%E5%8F%B0%E4%B8%8A%EF%BC%89/</url>
    <content><![CDATA[<h1 id="按任意键退出"><a href="#按任意键退出" class="headerlink" title="按任意键退出"></a>按任意键退出</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">read -n 1 -p &quot;按任意键退出，并打开apk目录...&quot;</span><br></pre></td></tr></table></figure>

<h1 id="打开Windows资源管理器指定目录"><a href="#打开Windows资源管理器指定目录" class="headerlink" title="打开Windows资源管理器指定目录"></a>打开Windows资源管理器指定目录</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取当前目录</span></span><br><span class="line">rootpath=$(pwd)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打开当前目录下的/_apk/apk目录</span></span><br><span class="line">start $rootpath&#x27;/_apk/apk&#x27;</span><br></pre></td></tr></table></figure>


<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="http://blog.csdn.net/zzban/article/details/8852655">Linux Shell编程语法（变量及其赋值）</a><br><a href="http://blog.csdn.net/ithomer/article/details/5904632">SHELL学习笔记—-IF条件判断，判断条件</a><br><a href="http://blog.csdn.net/liuxincumt/article/details/6202295">shell的read方法使用介绍</a></p>
]]></content>
      <tags>
        <tag>linux</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>关于SQLite的总结</title>
    <url>/sql/SQLite%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="C-Create"><a href="#C-Create" class="headerlink" title="C (Create)"></a>C (Create)</h2><p>使用自带API：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">db = dbHelper.getWritableDatabase();</span><br><span class="line"><span class="type">ContentValue</span> <span class="variable">values</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentValue</span>();</span><br><span class="line">values.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;第一行代码&quot;</span>);</span><br><span class="line">values.put(<span class="string">&quot;author&quot;</span>, <span class="string">&quot;郭霖&quot;</span>);</span><br><span class="line">values.put(<span class="string">&quot;price&quot;</span>, <span class="string">&quot;79.99&quot;</span>);</span><br><span class="line">values.put(<span class="string">&quot;pages&quot;</span>, <span class="string">&quot;552&quot;</span>);</span><br><span class="line">db.insert(<span class="string">&quot;Book&quot;</span>, <span class="literal">null</span>, values);</span><br><span class="line">values.clear();</span><br></pre></td></tr></table></figure>

<p>使用数据库语句：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">db = dbHelper.getWritableDatabase();</span><br><span class="line">db.execSQL(<span class="string">&quot;insert into Book (name, author, pages, price) values (?, ?, ?, ?)&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123; <span class="string">&quot;第一行代码&quot;</span>, <span class="string">&quot;郭霖&quot;</span>, <span class="string">&quot;552&quot;</span>, <span class="string">&quot;79.00&quot;</span>&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="R-Retrieve"><a href="#R-Retrieve" class="headerlink" title="R (Retrieve)"></a>R (Retrieve)</h2><p>使用自带API：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Cursor</span> <span class="variable">cursor</span> <span class="operator">=</span> db.query(<span class="string">&quot;Book&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p>使用数据库语句：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">db = dbHelper.getReadableDatabase();</span><br><span class="line"><span class="type">Cursor</span> <span class="variable">cursor</span> <span class="operator">=</span> db.rawQuery(<span class="string">&quot;SELECT id, name FROM people WHERE name = ? AND id = ?&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[] &#123;<span class="string">&quot;David&quot;</span>, <span class="string">&quot;2&quot;</span>&#125;);</span><br><span class="line"><span class="keyword">if</span>(cursor.moveToFirst())&#123;</span><br><span class="line">  <span class="keyword">do</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> cursor.getString(cursor.getColumnIndex(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> cursor.getString(cursor.getColumnIndex(<span class="string">&quot;id&quot;</span>));</span><br><span class="line"></span><br><span class="line">    Log.e(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line">    Log.e(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;id = &quot;</span> + id);</span><br><span class="line">  &#125; <span class="keyword">while</span> (cursor.moveToNext());</span><br><span class="line">&#125;</span><br><span class="line">cursor.close();</span><br></pre></td></tr></table></figure>


<h2 id="U-Update"><a href="#U-Update" class="headerlink" title="U (Update)"></a>U (Update)</h2><p>使用自带API：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">db = dbHelper.getWritableDatabase();</span><br><span class="line"><span class="type">ContentValue</span> <span class="variable">values</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentValue</span>();</span><br><span class="line">values.put(<span class="string">&quot;price&quot;</span>, <span class="number">79.99</span>);</span><br><span class="line">db.update(<span class="string">&quot;Book&quot;</span>, values, <span class="string">&quot;name = ?&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123; <span class="string">&quot;第一行代码&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>使用数据库语句：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">db = dbHelper.getWritableDatabase();</span><br><span class="line">db.execSQL(<span class="string">&quot;update Book set price = ? where name = ?&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123; <span class="string">&quot;79.99&quot;</span>, <span class="string">&quot;第一行代码&quot;</span> &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="D-Delete"><a href="#D-Delete" class="headerlink" title="D (Delete)"></a>D (Delete)</h2><p>使用自带API：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">db = dbHelper.getWritableDatabase();</span><br><span class="line">db.delete(<span class="string">&quot;Book&quot;</span>, <span class="string">&quot;page &gt; ?&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123; <span class="string">&quot;500&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>使用数据库语句：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">db = dbHelper.getWritableDatabase();</span><br><span class="line">db.execSQL(<span class="string">&quot;delete from Book where pages &gt; ?&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123; <span class="string">&quot;500&quot;</span> &#125;)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="使用事务（保证数据操作的原子性）"><a href="#使用事务（保证数据操作的原子性）" class="headerlink" title="使用事务（保证数据操作的原子性）"></a>使用事务（保证数据操作的原子性）</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">SQLiteDatabase</span> <span class="variable">db</span> <span class="operator">=</span> mDbHelper.getWritableDatabase();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   db.beginTransaction();</span><br><span class="line"></span><br><span class="line">   <span class="type">String</span> <span class="variable">position</span> <span class="operator">=</span> mode.getPosition().ordinal() + <span class="string">&quot;&quot;</span>;</span><br><span class="line">   <span class="type">String</span> <span class="variable">action</span> <span class="operator">=</span> mode.getAction().ordinal() + <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="type">ContentValues</span> <span class="variable">values</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentValues</span>();</span><br><span class="line">   values.put(<span class="string">&quot;color&quot;</span>, mode.getColor());</span><br><span class="line">   values.put(<span class="string">&quot;used&quot;</span>, mode.isUsed() ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">   values.put(<span class="string">&quot;level&quot;</span>, mode.getLevel());</span><br><span class="line">   values.put(<span class="string">&quot;time&quot;</span>, mode.getTime());</span><br><span class="line"></span><br><span class="line">   db.update(TABLE_NAME, values, <span class="string">&quot; position=? and action = ? &quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;position, action&#125;);</span><br><span class="line">   values.clear();</span><br><span class="line"></span><br><span class="line">   db.setTransactionSuccessful();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">   db.endTransaction();</span><br><span class="line">   db.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h2><ul>
<li><a href="http://stackoverflow.com/questions/10598137/rawqueryquery-selectionargs">rawQuery(query, selectionArgs)</a></li>
<li>《第一行代码》（第六章 数据存储全方案，详解持久化技术）</li>
</ul>
]]></content>
      <tags>
        <tag>android</tag>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>Jooq相关</title>
    <url>/sql/jooq/</url>
    <content><![CDATA[<p><a href="https://www.jooq.org/doc/3.9/manual/#Overview">https://www.jooq.org/doc/3.9/manual/#Overview</a></p>
<p>C</p>
<p>R</p>
<p>U</p>
<p>D</p>
<h2 id="插入或更新"><a href="#插入或更新" class="headerlink" title="插入或更新"></a><strong>插入或更新</strong></h2><p>如果没有就插入，如果有则更新</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 工具方法 https://github.com/jOOQ/jOOQ/issues/2134</span></span><br><span class="line"><span class="keyword">import</span> org.jooq.Field;</span><br><span class="line"><span class="keyword">import</span> org.jooq.impl.DSL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyDSL</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Field&lt;T&gt; <span class="title function_">values</span><span class="params">(Field&lt;T&gt; field)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DSL.field(<span class="string">&quot;VALUES(&#123;0&#125;)&quot;</span>, field.getDataType(), field);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insertCouponItemsToDb</span><span class="params">(List&lt;TbkDgItemCouponGetResponse.TbkCoupon&gt; results)</span> &#123;</span><br><span class="line"></span><br><span class="line">    dslContext.transaction((configuration) -&gt; &#123;</span><br><span class="line"></span><br><span class="line">        InsertValuesStep19&lt;TbkGoodsRecord, Long, Integer,</span><br><span class="line">                String, Timestamp, Timestamp,</span><br><span class="line">                String, Integer, Integer,</span><br><span class="line">                String, String, Long,</span><br><span class="line">                String, String, String,</span><br><span class="line">                Byte, Integer, BigDecimal,</span><br><span class="line">                String, BigDecimal&gt; step =</span><br><span class="line">                DSL.using(configuration).insertInto(TBK_GOODS,</span><br><span class="line">                        TBK_GOODS.NUM_IID,</span><br><span class="line">                        TBK_GOODS.CATEGORY,</span><br><span class="line">                        TBK_GOODS.COUPON_CLICK_URL,</span><br><span class="line">                        TBK_GOODS.COUPON_START_TIME,</span><br><span class="line">                        TBK_GOODS.COUPON_END_TIME,</span><br><span class="line">                        TBK_GOODS.COUPON_INFO,</span><br><span class="line">                        TBK_GOODS.COUPON_REMAIN_COUNT,</span><br><span class="line">                        TBK_GOODS.COUPON_TOTAL_COUNT,</span><br><span class="line">                        TBK_GOODS.NICK,</span><br><span class="line">                        TBK_GOODS.PICT_URL,</span><br><span class="line">                        TBK_GOODS.SELLER_ID,</span><br><span class="line">                        TBK_GOODS.SHOP_TITLE,</span><br><span class="line">                        TBK_GOODS.SMALL_IMAGES,</span><br><span class="line">                        TBK_GOODS.TITLE,</span><br><span class="line">                        TBK_GOODS.USER_TYPE,</span><br><span class="line">                        TBK_GOODS.VOLUME,</span><br><span class="line">                        TBK_GOODS.ZK_FINAL_PRICE,</span><br><span class="line">                        TBK_GOODS.ITEM_DESCRIPTION,</span><br><span class="line">                        TBK_GOODS.TK_RATE</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">        results.forEach(tbkCoupon -&gt; &#123;</span><br><span class="line">            step.values(tbkCoupon.getNumIid(),</span><br><span class="line">                    tbkCoupon.getCategory().intValue(),</span><br><span class="line">                    tbkCoupon.getCouponClickUrl(),</span><br><span class="line">                    formatTime(tbkCoupon.getCouponStartTime()),</span><br><span class="line">                    formatTime(tbkCoupon.getCouponEndTime()),</span><br><span class="line">                    tbkCoupon.getCouponInfo(),</span><br><span class="line">                    tbkCoupon.getCouponRemainCount().intValue(),</span><br><span class="line">                    tbkCoupon.getCouponTotalCount().intValue(),</span><br><span class="line">                    tbkCoupon.getNick(),</span><br><span class="line">                    tbkCoupon.getPictUrl(),</span><br><span class="line">                    tbkCoupon.getSellerId(),</span><br><span class="line">                    tbkCoupon.getShopTitle(),</span><br><span class="line">                    StringUtil.convertListToArrayStringWithDoubleQuotation(tbkCoupon.getSmallImages()),</span><br><span class="line">                    tbkCoupon.getTitle(),</span><br><span class="line">                    tbkCoupon.getUserType().byteValue(),</span><br><span class="line">                    tbkCoupon.getVolume().intValue(),</span><br><span class="line">                    BigDecimal.valueOf(Double.parseDouble(tbkCoupon.getZkFinalPrice())),</span><br><span class="line">                    tbkCoupon.getItemDescription(),</span><br><span class="line">                    BigDecimal.valueOf(Double.parseDouble(tbkCoupon.getCommissionRate()))</span><br><span class="line">            );</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        step.onDuplicateKeyUpdate()</span><br><span class="line">                .set(TBK_GOODS.CATEGORY, MyDSL.values(TBK_GOODS.CATEGORY))</span><br><span class="line">                .set(TBK_GOODS.COUPON_CLICK_URL, MyDSL.values(TBK_GOODS.COUPON_CLICK_URL))</span><br><span class="line">                .set(TBK_GOODS.COUPON_START_TIME, MyDSL.values(TBK_GOODS.COUPON_START_TIME))</span><br><span class="line">                .set(TBK_GOODS.COUPON_END_TIME, MyDSL.values(TBK_GOODS.COUPON_END_TIME))</span><br><span class="line">                .set(TBK_GOODS.COUPON_INFO, MyDSL.values(TBK_GOODS.COUPON_INFO))</span><br><span class="line">                .set(TBK_GOODS.COUPON_REMAIN_COUNT, MyDSL.values(TBK_GOODS.COUPON_REMAIN_COUNT))</span><br><span class="line">                .set(TBK_GOODS.NICK, MyDSL.values(TBK_GOODS.NICK))</span><br><span class="line">                .set(TBK_GOODS.PICT_URL, MyDSL.values(TBK_GOODS.PICT_URL))</span><br><span class="line">                .set(TBK_GOODS.SELLER_ID, MyDSL.values(TBK_GOODS.SELLER_ID))</span><br><span class="line">                .set(TBK_GOODS.SHOP_TITLE, MyDSL.values(TBK_GOODS.SHOP_TITLE))</span><br><span class="line">                .set(TBK_GOODS.SMALL_IMAGES, MyDSL.values(TBK_GOODS.SMALL_IMAGES))</span><br><span class="line">                .set(TBK_GOODS.TITLE, MyDSL.values(TBK_GOODS.TITLE))</span><br><span class="line">                .set(TBK_GOODS.USER_TYPE, MyDSL.values(TBK_GOODS.USER_TYPE))</span><br><span class="line">                .set(TBK_GOODS.VOLUME, MyDSL.values(TBK_GOODS.VOLUME))</span><br><span class="line">                .set(TBK_GOODS.ZK_FINAL_PRICE, MyDSL.values(TBK_GOODS.ZK_FINAL_PRICE))</span><br><span class="line">                .set(TBK_GOODS.ITEM_DESCRIPTION, MyDSL.values(TBK_GOODS.ITEM_DESCRIPTION))</span><br><span class="line">                .set(TBK_GOODS.TK_RATE, MyDSL.values(TBK_GOODS.TK_RATE))</span><br><span class="line">                .executeAsync(executorService);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Timestamp <span class="title function_">formatTime</span><span class="params">(String time)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Strings.isNullOrEmpty(time)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Timestamp.valueOf(time + <span class="string">&quot; 00:00:00&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="判断某个字段是否为空"><a href="#判断某个字段是否为空" class="headerlink" title="判断某个字段是否为空"></a>判断某个字段是否为空</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">step.and(TbkGoods.TBK_GOODS.COUPON_INFO.length().notEqual(<span class="number">0</span>));</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>Mybatis相关</title>
    <url>/sql/mybatis/</url>
    <content><![CDATA[<h2 id="mybatisplus"><a href="#mybatisplus" class="headerlink" title="mybatisplus"></a>mybatisplus</h2><p><a href="https://github.com/lyloou/spring-master/tree/master/spring-mybatisplus">https://github.com/lyloou/spring-master/tree/master/spring-mybatisplus</a></p>
<ul>
<li>自动生成，包括 Controller、Mapper、Entity、Service、Mapper.xml</li>
</ul>
<h2 id="mybatis-自动生成工具"><a href="#mybatis-自动生成工具" class="headerlink" title="mybatis 自动生成工具"></a>mybatis 自动生成工具</h2><ul>
<li>下载<code>mybatis-generator-core-1.3.7.jar</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">https://github.com/mybatis/generator/releases</span><br><span class="line">https://github.com/mybatis/generator/releases/download/mybatis-generator-1.3.7/mybatis-generator-core-1.3.7.zip</span><br></pre></td></tr></table></figure>

<ul>
<li>下载<code>postgresql-42.2.2.jar</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">https://jdbc.postgresql.org/download.html</span><br><span class="line">https://jdbc.postgresql.org/download/postgresql-42.2.2.jar</span><br></pre></td></tr></table></figure>

<ul>
<li>配置<code>generatorConfig.xml</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classPathEntry</span></span></span><br><span class="line"><span class="tag">            <span class="attr">location</span>=<span class="string">&quot;D:/c/mybatis/mybatis-generator-core-1.3.7/lib/postgresql-42.2.2.jar&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;MysqlContext&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3Simple&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 生成的pojo，将implements Serializable--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.generator.plugins.SerializablePlugin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;org.postgresql.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:postgresql://192.168.1.123:5432/users?currentSchema=hello<span class="symbol">&amp;amp;</span>tcpKeepAlive=true&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;hello&quot;</span> <span class="attr">password</span>=<span class="string">&quot;hello&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        默认false，把JDBC DECIMAL 和 NUMERIC 类型解析为 Integer</span></span><br><span class="line"><span class="comment">            true，把JDBC DECIMAL 和 NUMERIC 类型解析为java.math.BigDecimal</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.example.model.original&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">targetProject</span>=<span class="string">&quot;./src/main/java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 从数据库返回的值被清理前后的空格  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;ANNOTATEDMAPPER&quot;</span></span></span><br><span class="line"><span class="tag">                             <span class="attr">targetPackage</span>=<span class="string">&quot;com.example.repository.mapper&quot;</span></span></span><br><span class="line"><span class="tag">                             <span class="attr">targetProject</span>=<span class="string">&quot;./src/main/java&quot;</span>  &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;rootInterface&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.example.repository.mark.IMarkMapper&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 阻止**生成的注释包含时间戳 true：是 ： false:否 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressDate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 是否去除自动生成的注释 true：是 ： false:否 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">schema</span>=<span class="string">&quot;hello&quot;</span> <span class="attr">tableName</span>=<span class="string">&quot;app_verify_info&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">schema</span>=<span class="string">&quot;hello&quot;</span> <span class="attr">tableName</span>=<span class="string">&quot;api_interface_info&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">schema</span>=<span class="string">&quot;hello&quot;</span> <span class="attr">tableName</span>=<span class="string">&quot;api_interface_access&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">schema</span>=<span class="string">&quot;hello&quot;</span> <span class="attr">tableName</span>=<span class="string">&quot;app_code&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>配置<code>generatorConfig.bat</code></li>
</ul>
<figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">java -jar mybatis-generator-core-<span class="number">1</span>.<span class="number">3</span>.<span class="number">2</span>.jar -configfile generatorConfig.xml</span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure>

<p>参考资料：</p>
<ul>
<li><a href="https://github.com/mybatis/generator">官网 generator</a></li>
<li><a href="https://blog.csdn.net/zxh_2581285470/article/details/51915228">mybatis 自动生成工具-MBG</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mysql使用的是不同的连接库</span></span><br><span class="line">mysql-connector-java-5.1.37.jar</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://blog.csdn.net/weixin_42476601/article/details/81479362">Mybatis 最入门—代码自动生成（generatorConfig.xml 配置） - 越来越好 ing 的博客 - CSDN 博客</a></li>
</ul>
<h2 id="根据数据库表生成对应实体类（Lombok-的注解实现）"><a href="#根据数据库表生成对应实体类（Lombok-的注解实现）" class="headerlink" title="根据数据库表生成对应实体类（Lombok 的注解实现）"></a>根据数据库表生成对应实体类（Lombok 的注解实现）</h2><p>记得 IDEA 安装好插件：Lombok Plugin</p>
<p>文件<code>pom.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis.generator.version</span>&gt;</span>1.3.7<span class="tag">&lt;/<span class="name">mybatis.generator.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.connector.java</span>&gt;</span>5.1.46<span class="tag">&lt;/<span class="name">mysql.connector.java</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis.generator.lombok.plugin</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">mybatis.generator.lombok.plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.connector.java&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.generator.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">overwrite</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overwrite</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configurationFile</span>&gt;</span>src/main/resources/mybatis/generatorConfig.xml<span class="tag">&lt;/<span class="name">configurationFile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.connector.java&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.softwareloop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-lombok-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.generator.lombok.plugin&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>文件<code>src/main/resources/mybatis/generatorConfig.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;context1&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3Simple&quot;</span> <span class="attr">defaultModelType</span>=<span class="string">&quot;flat&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- include the plugin --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">type</span>=<span class="string">&quot;com.softwareloop.mybatis.generator.plugins.LombokPlugin&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- enable annotations --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;builder&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- annotation&#x27;s option(boolean) --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;builder.fluent&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- annotation&#x27;s option(String) --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;builder.builderMethodName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;myBuilder&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;accessors&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- annotation&#x27;s option(array of String) --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;accessors.prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;m_, _&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- disable annotations --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;allArgsConstructor&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  关闭自动生成的注释  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://127.0.0.1/lyloou?useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=utf8&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span></span></span><br><span class="line"><span class="tag">                <span class="attr">targetPackage</span>=<span class="string">&quot;com.lyloou.orders.entity.task&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--&lt;table tableName=&quot;tasks&quot; domainObjectName=&quot;Tasks&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;task_bonus&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;TaskBonus&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;task_bonus_coupon&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;TaskBonusCoupon&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;task_bonus_user&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;TaskBonusUser&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如下图所示点击生成 entity<br><img src="https://github.com/lyloou/img/raw/develop/z/20190624151033.png" alt="点击生成 entity"></p>
<p>如果数据库中的时间用的是 <code>timestamp</code>，为了不损失精度，做一个【在文件夹中替换】的操作。<br>选中刚才的 task 文件夹，键入 <code>Ctrl + Shift + R</code><br>替换 <code>private Date</code> 为 <code>private java.sql.Timestamp</code></p>
]]></content>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>Mybatisplus相关</title>
    <url>/sql/mybatisplus/</url>
    <content><![CDATA[<h2 id="mybatisplus-saveOrUpdate-DuplicateKeyException-问题"><a href="#mybatisplus-saveOrUpdate-DuplicateKeyException-问题" class="headerlink" title="mybatisplus saveOrUpdate DuplicateKeyException 问题"></a>mybatisplus saveOrUpdate DuplicateKeyException 问题</h2><p>使用了 atlas 代理后，在 update 的时候，如果更新的内容不变，返回为 0 问题<br>mybatis 在这种情况下默认返回 1。（可以通过 jdbc 参数<code>useAffectedRows</code>来自定义）</p>
<p><strong><code>mybatis-plus-extension-3.0.1.jar</code></strong></p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ServiceImpl.java</span></span><br><span class="line">    @Override</span><br><span class="line">    public boolean save<span class="constructor">OrUpdate(T <span class="params">entity</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (null != entity) &#123;</span><br><span class="line">            Class&lt;?&gt; cls = entity.get<span class="constructor">Class()</span>;</span><br><span class="line">            TableInfo tableInfo = <span class="module-access"><span class="module"><span class="identifier">TableInfoHelper</span>.</span></span>get<span class="constructor">TableInfo(<span class="params">cls</span>)</span>;</span><br><span class="line">            <span class="keyword">if</span> (null != tableInfo<span class="operator"> &amp;&amp; </span><span class="module-access"><span class="module"><span class="identifier">StringUtils</span>.</span></span>is<span class="constructor">NotEmpty(<span class="params">tableInfo</span>.<span class="params">getKeyProperty</span>()</span>)) &#123;</span><br><span class="line">                Object idVal = <span class="module-access"><span class="module"><span class="identifier">ReflectionKit</span>.</span></span>get<span class="constructor">MethodValue(<span class="params">cls</span>, <span class="params">entity</span>, <span class="params">tableInfo</span>.<span class="params">getKeyProperty</span>()</span>);</span><br><span class="line">                <span class="keyword">if</span> (<span class="module-access"><span class="module"><span class="identifier">StringUtils</span>.</span></span>check<span class="constructor">ValNull(<span class="params">idVal</span>)</span>) &#123;</span><br><span class="line">                    return save(entity);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">/*</span></span><br><span class="line"><span class="comment">                     * 更新成功直接返回，失败执行插入逻辑</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    return update<span class="constructor">ById(<span class="params">entity</span>)</span><span class="operator"> || </span>save(entity);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                throw <span class="module-access"><span class="module"><span class="identifier">ExceptionUtils</span>.</span></span>mpe(<span class="string">&quot;Error:  Can not execute. Could not find @TableId.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>在 mybatis-plus-extension-3.0.1 版本下面，会导致下面错误</code></strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">org.springframework.dao.DuplicateKeyException:</span><br><span class="line">### Error updating database.  Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException: Duplicate entry <span class="string">&#x27;657-CHECK_IN_EXTRA_AWARD-ACCUMULATIVE&#x27;</span> <span class="keyword">for</span> key <span class="string">&#x27;unique_id_type&#x27;</span></span><br><span class="line">### The error may involve com.lyloou.springmybatisplus.mapper.CheckInExtraAwardMapper.insert-Inline</span><br><span class="line">### The error occurred <span class="keyword">while</span> setting parameters</span><br><span class="line">### SQL: INSERT INTO <span class="title function_">check_in_extra_award</span>  <span class="params">( id, type_key, award_type_enum, award_rule_enum )</span>  VALUES  ( ?, ?, ?, ? )</span><br><span class="line">### Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException: Duplicate entry <span class="string">&#x27;657-CHECK_IN_EXTRA_AWARD-ACCUMULATIVE&#x27;</span> <span class="keyword">for</span> key <span class="string">&#x27;unique_id_type&#x27;</span></span><br><span class="line">; ]; Duplicate entry <span class="string">&#x27;657-CHECK_IN_EXTRA_AWARD-ACCUMULATIVE&#x27;</span> <span class="keyword">for</span> key <span class="string">&#x27;unique_id_type&#x27;</span>; nested exception is com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException: Duplicate entry <span class="string">&#x27;657-CHECK_IN_EXTRA_AWARD-ACCUMULATIVE&#x27;</span> <span class="keyword">for</span> key <span class="string">&#x27;unique_id_type&#x27;</span></span><br><span class="line"></span><br><span class="line">	at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:<span class="number">242</span>)</span><br><span class="line">	at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:<span class="number">72</span>)</span><br><span class="line">	at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:<span class="number">73</span>)</span><br><span class="line">	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:<span class="number">446</span>)</span><br><span class="line">	at com.sun.proxy.$Proxy59.insert(Unknown Source)</span><br><span class="line">	at org.mybatis.spring.SqlSessionTemplate.insert(SqlSessionTemplate.java:<span class="number">278</span>)</span><br><span class="line">	at com.baomidou.mybatisplus.core.override.PageMapperMethod.execute(PageMapperMethod.java:<span class="number">68</span>)</span><br><span class="line">	at com.baomidou.mybatisplus.core.override.PageMapperProxy.invoke(PageMapperProxy.java:<span class="number">64</span>)</span><br><span class="line">	at com.sun.proxy.$Proxy62.insert(Unknown Source)</span><br><span class="line">	at com.baomidou.mybatisplus.extension.service.impl.ServiceImpl.save(ServiceImpl.java:<span class="number">99</span>)</span><br><span class="line">	at com.baomidou.mybatisplus.extension.service.impl.ServiceImpl.saveOrUpdate(ServiceImpl.java:<span class="number">159</span>)</span><br><span class="line">	at com.baomidou.mybatisplus.extension.service.impl.ServiceImpl$$FastClassBySpringCGLIB$$<span class="number">76535273.</span>invoke(&lt;generated&gt;)</span><br><span class="line">	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:<span class="number">204</span>)</span><br><span class="line">	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:<span class="number">685</span>)</span><br><span class="line">	at com.lyloou.springmybatisplus.service.CheckInExtraAwardBaseService$$EnhancerBySpringCGLIB$$22ac1ad5.saveOrUpdate(&lt;generated&gt;)</span><br><span class="line">	at com.lyloou.springmybatisplus.SpringMybatisplusApplicationTests.contextLoads(SpringMybatisplusApplicationTests.java:<span class="number">31</span>)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:<span class="number">498</span>)</span><br><span class="line">	at org.junit.runners.model.FrameworkMethod$<span class="number">1.</span>runReflectiveCall(FrameworkMethod.java:<span class="number">50</span>)</span><br><span class="line">	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:<span class="number">12</span>)</span><br><span class="line">	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:<span class="number">47</span>)</span><br><span class="line">	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:<span class="number">17</span>)</span><br><span class="line">	at org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:<span class="number">73</span>)</span><br><span class="line">	at org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:<span class="number">83</span>)</span><br><span class="line">	at org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:<span class="number">75</span>)</span><br><span class="line">	at org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:<span class="number">86</span>)</span><br><span class="line">	at org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:<span class="number">84</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:<span class="number">325</span>)</span><br><span class="line">	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:<span class="number">251</span>)</span><br><span class="line">	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:<span class="number">97</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner$<span class="number">3.</span>run(ParentRunner.java:<span class="number">290</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner$<span class="number">1.</span>schedule(ParentRunner.java:<span class="number">71</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:<span class="number">288</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner.access$<span class="number">000</span>(ParentRunner.java:<span class="number">58</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner$<span class="number">2.</span>evaluate(ParentRunner.java:<span class="number">268</span>)</span><br><span class="line">	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:<span class="number">61</span>)</span><br><span class="line">	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:<span class="number">70</span>)</span><br><span class="line">	at org.junit.runners.ParentRunner.run(ParentRunner.java:<span class="number">363</span>)</span><br><span class="line">	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:<span class="number">190</span>)</span><br><span class="line">	at org.junit.runner.JUnitCore.run(JUnitCore.java:<span class="number">137</span>)</span><br><span class="line">	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:<span class="number">69</span>)</span><br><span class="line">	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:<span class="number">33</span>)</span><br><span class="line">	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:<span class="number">221</span>)</span><br><span class="line">	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:<span class="number">54</span>)</span><br><span class="line">Caused by: com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException: Duplicate entry <span class="string">&#x27;657-CHECK_IN_EXTRA_AWARD-ACCUMULATIVE&#x27;</span> <span class="keyword">for</span> key <span class="string">&#x27;unique_id_type&#x27;</span></span><br><span class="line">	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:<span class="number">45</span>)</span><br><span class="line">	at java.lang.reflect.Constructor.newInstance(Constructor.java:<span class="number">423</span>)</span><br><span class="line">	at com.mysql.jdbc.Util.handleNewInstance(Util.java:<span class="number">425</span>)</span><br><span class="line">	at com.mysql.jdbc.Util.getInstance(Util.java:<span class="number">408</span>)</span><br><span class="line">	at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:<span class="number">936</span>)</span><br><span class="line">	at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:<span class="number">3976</span>)</span><br><span class="line">	at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:<span class="number">3912</span>)</span><br><span class="line">	at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:<span class="number">2530</span>)</span><br><span class="line">	at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:<span class="number">2683</span>)</span><br><span class="line">	at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:<span class="number">2486</span>)</span><br><span class="line">	at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:<span class="number">1858</span>)</span><br><span class="line">	at com.mysql.jdbc.PreparedStatement.execute(PreparedStatement.java:<span class="number">1197</span>)</span><br><span class="line">	at com.alibaba.druid.pool.DruidPooledPreparedStatement.execute(DruidPooledPreparedStatement.java:<span class="number">493</span>)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:<span class="number">498</span>)</span><br><span class="line">	at org.apache.ibatis.logging.jdbc.PreparedStatementLogger.invoke(PreparedStatementLogger.java:<span class="number">59</span>)</span><br><span class="line">	at com.sun.proxy.$Proxy69.execute(Unknown Source)</span><br><span class="line">	at org.apache.ibatis.executor.statement.PreparedStatementHandler.update(PreparedStatementHandler.java:<span class="number">46</span>)</span><br><span class="line">	at org.apache.ibatis.executor.statement.RoutingStatementHandler.update(RoutingStatementHandler.java:<span class="number">74</span>)</span><br><span class="line">	at org.apache.ibatis.executor.SimpleExecutor.doUpdate(SimpleExecutor.java:<span class="number">50</span>)</span><br><span class="line">	at org.apache.ibatis.executor.BaseExecutor.update(BaseExecutor.java:<span class="number">117</span>)</span><br><span class="line">	at org.apache.ibatis.session.defaults.DefaultSqlSession.update(DefaultSqlSession.java:<span class="number">198</span>)</span><br><span class="line">	at org.apache.ibatis.session.defaults.DefaultSqlSession.insert(DefaultSqlSession.java:<span class="number">185</span>)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:<span class="number">498</span>)</span><br><span class="line">	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:<span class="number">433</span>)</span><br><span class="line">	... <span class="number">42</span> more</span><br><span class="line"></span><br><span class="line"><span class="number">2021</span>-<span class="number">06</span>-<span class="number">29</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">38.356</span>  INFO <span class="number">92996</span> --- [       Thread-<span class="number">2</span>] s.c.a.AnnotationConfigApplicationContext : Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@1a245833: startup date [Tue Jun <span class="number">29</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">35</span> CST <span class="number">2021</span>]; root of context hierarchy</span><br><span class="line"><span class="number">2021</span>-<span class="number">06</span>-<span class="number">29</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">38.360</span>  INFO <span class="number">92996</span> --- [       Thread-<span class="number">2</span>] com.alibaba.druid.pool.DruidDataSource   : &#123;dataSource-<span class="number">1</span>&#125; closed</span><br><span class="line"></span><br><span class="line">Process finished with exit code -<span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="解决办法："><a href="#解决办法：" class="headerlink" title="解决办法："></a>解决办法：</h4><ol>
<li>升级 mybatis-plus 版本</li>
</ol>
<p>在 mybatis-plus 新版本，已经换了实现。<br><strong><code>mybatis-plus-extension-3.3.1.tmp.jar</code></strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ServiceImpl.java</span></span><br><span class="line">    <span class="meta">@Transactional(</span></span><br><span class="line"><span class="meta">        rollbackFor = &#123;Exception.class&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">saveOrUpdate</span><span class="params">(T entity)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == entity) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Class&lt;?&gt; cls = entity.getClass();</span><br><span class="line">            <span class="type">TableInfo</span> <span class="variable">tableInfo</span> <span class="operator">=</span> TableInfoHelper.getTableInfo(cls);</span><br><span class="line">            Assert.notNull(tableInfo, <span class="string">&quot;error: can not execute. because can not find cache of TableInfo for entity!&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]);</span><br><span class="line">            <span class="type">String</span> <span class="variable">keyProperty</span> <span class="operator">=</span> tableInfo.getKeyProperty();</span><br><span class="line">            Assert.notEmpty(keyProperty, <span class="string">&quot;error: can not execute. because can not find column for id from entity!&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">idVal</span> <span class="operator">=</span> ReflectionKit.getMethodValue(cls, entity, tableInfo.getKeyProperty());</span><br><span class="line">            <span class="keyword">return</span> !StringUtils.checkValNull(idVal) &amp;&amp; !Objects.isNull(<span class="built_in">this</span>.getById((Serializable)idVal)) ? <span class="built_in">this</span>.updateById(entity) : <span class="built_in">this</span>.save(entity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>不使用 atlas<br>github 上有人提过这个问题，目前还没有人解答：<br><a href="https://github.com/Qihoo360/Atlas/issues/191">连接 atlas update 成功后返回结果为 0 · Issue #191 · Qihoo360/Atlas</a></li>
</ol>
<p>本以为可以通过配置来满足需求（返回匹配行数，而不是影响行数），找到了 <code>useAffectedRows</code>，<br>可是这个参数，对于 atlas 不可用。</p>
<h4 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h4><p><a href="https://blog.csdn.net/qq_15071263/article/details/81662725">Mysql 连接参数 useAffectedRows 详解_简简单单 Onlinezuozuo-CSDN 博客_useaffectedrows</a></p>
<blockquote>
<p>useAffectedRows=true 时, update 返回值为受影响行数;<br>useAffectedRows=false 时（默认）, update 返回值为 where 条件匹配的行数.</p>
</blockquote>
]]></content>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysql命令行实用程序</title>
    <url>/sql/mysql%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%AE%9E%E7%94%A8%E7%A8%8B%E5%BA%8F/</url>
    <content><![CDATA[<h2 id="help"><a href="#help" class="headerlink" title="help"></a>help</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mysql --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h2 id="启动-mysql："><a href="#启动-mysql：" class="headerlink" title="启动 mysql："></a>启动 mysql：</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">mysql -u root --password=your_password</span><br></pre></td></tr></table></figure>

<h2 id="导入数据结构和数据"><a href="#导入数据结构和数据" class="headerlink" title="导入数据结构和数据"></a>导入数据结构和数据</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -u root -p goods &lt; goods_db_structure.sql</span><br><span class="line">mysql -u root -p goods &lt; goods_db_data.sql</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/gaochen519/article/details/51504319">Mysql 通过 cmd 命令导入 sql 文件_gaochen519 的博客-CSDN 博客</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">show database;</span><br><span class="line">use mydb;</span><br><span class="line"><span class="built_in">source</span> /root/mydb.sql;</span><br></pre></td></tr></table></figure>

<h2 id="show"><a href="#show" class="headerlink" title="show"></a>show</h2><p><a href="https://www.iteye.com/blog/yufenfei-1743967">mysql show columns 等 show 的用法 - yufenfei - ITeye 博客</a><br>SHOW DATABASES︰列出 MySQL Server 上的数据库。<br>SHOW TABLES [FROM db_name]︰列出数据库中的表。<br>SHOW TABLE STATUS [FROM db_name]︰列出数据库的表信息，比较详细。<br>SHOW COLUMNS FROM tbl_name [FROM db_name]︰列出表的列信息，同 SHOW FIELDS FROM tbl_name [FROM db_name]，DESCRIBE tbl_name [col_name]。<br>SHOW FULL COLUMNS FROM tbl_name [FROM db_name]︰列出表的列信息，比较详细，同 SHOW FULL FIELDS FROM tbl_name [FROM db_name]。<br>SHOW INDEX FROM tbl_name [FROM db_name]︰列出表的索引信息。<br>SHOW STATUS︰列出 Server 的状态信息。<br>SHOW VARIABLES︰列出 MySQL 系統参数值<br>SHOW PROCESSLIST︰查看当前 mysql 查询进程 （可以用来查看死锁问题）<br>SHOW GRANTS FOR user︰列出用户的授权命令</p>
<h2 id="g-和-G"><a href="#g-和-G" class="headerlink" title="\g 和 \G"></a><code>\g</code> 和 <code>\G</code></h2><p><a href="https://www.cnblogs.com/tjudzj/p/10032846.html">MySQl 中的\g 和\G - 一步一个小脚印 - 博客园</a></p>
<ol>
<li>\g<br>在 MySQL 的 sql 语句后加上\g，效果等同于加上定界符，一般默认的定界符是分号;</li>
<li>\G<br>在 MySQL 的 sql 语句后加上\G，表示将查询结果进行按列打印，可以使每个字段打印到单独的行。即将查到的结构旋转 90 度变成纵向；</li>
</ol>
]]></content>
      <tags>
        <tag>sql</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>【Mysql】字段类型</title>
    <url>/sql/mysql%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<h2 id="常用"><a href="#常用" class="headerlink" title="常用"></a>常用</h2><table>
<thead>
<tr>
<th>数值类型</th>
<th>范围(signed)</th>
<th>范围(unsigned)</th>
<th align="right">字节数</th>
</tr>
</thead>
<tbody><tr>
<td>int</td>
<td>-2147493648 到 2147493647</td>
<td>0 到 4294967295 (<code>2^(4*8)</code>)</td>
<td align="right">4</td>
</tr>
<tr>
<td>bigint</td>
<td>-9223372036854775808 到 9223372036854775807</td>
<td>0 到 18446744073709551615 (<code>2^(8*8)</code>)</td>
<td align="right">8</td>
</tr>
<tr>
<td>float</td>
<td>见下方</td>
<td>见下方</td>
<td align="right">4</td>
</tr>
<tr>
<td>double</td>
<td>见下方</td>
<td>见下方</td>
<td align="right">-</td>
</tr>
<tr>
<td>decimal</td>
<td>DECIMAL[(M[,D])] <code>M&lt;=65 &amp;&amp; D&lt;=30</code></td>
<td>不能为负值</td>
<td align="right">-</td>
</tr>
</tbody></table>
<p>mysql 官方说明文档: <a href="https://dev.mysql.com/doc/refman/5.6/en/data-type-overview.html">MySQL :: MySQL 5.6 Reference Manual :: 11.1 Data Type Overview</a></p>
<h2 id="mysql-字段类型范围说明-int、bigint、smallint、tinyint-char、varchar、nvarchar-幻星宇-博客园"><a href="#mysql-字段类型范围说明-int、bigint、smallint、tinyint-char、varchar、nvarchar-幻星宇-博客园" class="headerlink" title="mysql 字段类型范围说明:int、bigint、smallint、tinyint,char、varchar、nvarchar - 幻星宇 - 博客园"></a><a href="https://www.cnblogs.com/xingmeng/archive/2012/10/24/2737455.html">mysql 字段类型范围说明:int、bigint、smallint、tinyint,char、varchar、nvarchar - 幻星宇 - 博客园</a></h2><p>MySQL 的列类型主要有三种：数字、字串和日期。</p>
<p>下面来详细的说明,不一定准确不一定完整,请多包含或者提出您的建议,我很乐意倾听,呵呵.</p>
<p>数字列类型 int、bigint、smallint、tinyint<br>　　数字列类型用于储存各种数字数据，如价格、年龄或者数量。数字列类型主要分为两种：整数型和浮点型。所有的数字列类型都允许有两个选 项：UNSIGNED 和 ZEROFILL。选择 UNSIGNED 的列不允许有负数，选择了 ZEROFILL 的列会为数值添加零。下面是 MySQL 中可用的 数字列类型<br>• TINYINT——一个微小的整数，支持 -128 到 127(SIGNED)，0 到 255(UNSIGNED)，需要 1 个字节存储<br>• BIT——同 TINYINT(1)<br>• BOOL——同 TINYINT(1)<br>• SMALLINT——一个小整数，支持 -32768 到 32767(SIGNED)，0 到 65535(UNSIGNED)，需要 2 个字节存储 MEDIUMINT——一个中等整数，支持 -8388608 到 8388607(SIGNED)，0 到 16777215(UNSIGNED)，需要 3 个字节存储<br>• INT——一个整数，支持 -2147493648 到 2147493647(SIGNED)，0 到 4294967295(UNSIGNED)，需要 4 个字节存储<br>• INTEGER——同 INT<br>• BIGINT——一个大整数，支持 -9223372036854775808 到 9223372036854775807(SIGNED)，0 到 18446744073709551615(UNSIGNED)，需要 8 个字节存储<br>• FLOAT(precision)——一个浮点数。precision&lt;=24 用于单精度浮点数；precision 在 25 和 53 之间，用于又精度 浮点数。FLOAT(X)与相诮的 FLOAT 和 DOUBLE 类型有差相同的范围，但是没有定义显示尺寸和小数位数。在 MySQL3.23 之前，这不是一个 真的浮点值，且总是有两位小数。MySQL 中的所有计算都用双精度，所以这会带来一些意想不到的问题。<br>• FLOAT——一个小的菜单精度浮点数。支持 -3.402823466E+38 到-1.175494351E-38，0 和 1.175494351E-38 to 3.402823466E+38，需要 4 个字节存储。如果是 UNSIGNED，正数的范围保持不变，但负数是不允许的。<br>• DOUBLE——一个双精度浮点数。支持 -1.7976931348623157E+308 到-2.2250738585072014E-308，0 和 2.2250738585072014E- 308 到 1.7976931348623157E+308。如果是 FLOAT，UNSIGNED 不会改变正数范围，但负数是不允许的。<br>• DOUBLE PRECISION——同 DOUBLE<br>• REAL——同 DOUBLE<br>• DECIMAL——将一个数像字符串那样存储，每个字符占一个字节<br>• DEC——同 DECIMAL<br>• NUMERIC——同 DECIMAL</p>
<p>字符串列类型:char、varchar、nvarchar<br>　　字符串列类型用于存储任何类型的字符数据，如名字、地址或者报纸文章。下面是 MySQL 中可用的字符串列类型<br>• CHAR——字符。固定长度的字串，在右边补齐空格，达到指定的长度。支持从 0 到 155 个字符。搜索值时，后缀的空格将被删除。<br>• VARCHAR——可变长的字符。一个可变长度的字串，其中的后缀空格在存储值时被删除。支持从 0 到 255 字符<br>• TINYBLOB——微小的二进制对象。支持 255 个字符。需要长度+1 字节的存储。与 TINYTEXT 一样，只不过搜索时是区分大小写的。(0.25KB)<br>• TINYTEXT——支持 255 个字符。要求长度+1 字节的存储。与 TINYBLOB 一样，只不过搜索时会忽略大小写。(0.25KB)<br>• BLOB——二进制对象。支持 65535 个字符。需要长度+2 字节的存储。 (64KB)<br>• TEXT——支持 65535 个字符。要求长度+2 字节的存储。 (64KB)<br>• MEDIUMBLOB——中等大小的二进制对象。支持 16777215 个字符。需要长度+3 字节的存储。 (16M)<br>• MEDIUMTEXT——支持 16777215 个字符。需要长度+3 字节的存储。 (16M)<br>• LONGBLOB——大的的二进制对象。支持 4294967295 个字符。需要长度+4 字节的存储。 (4G)<br>• LONGTEXT——支持 4294967295 个字符。需要长度+4 字节的存储。(4G)<br>• ENUM——枚举。只能有一个指定的值，即 NULL 或””，最大有 65535 个值<br>• SET——一个集合。可以有 0 到 64 个值，均来自于指定清单.</p>
<p>日期和时间列类型<br>　　日期和时间列类型用于处理时间数据，可以存储当日的时间或出生日期这样的数据。格式的规定：Y 表示年、M（前 M）表示月、D 表示日、H 表示小时、M（后 M）表示分钟、S 表示秒。下面是 MySQL 中可用的日期和时间列类型<br>• DATETIME——格式：’YYYY-MM-DD HH:MM:SS’，范围：’1000-01-01 00:00:00’到’9999-12-31 23:59:59’<br>• DATE——格式：’YYYY-MM-DD’，范围：’1000-01-01’到’9999-12-31’<br>• TIMESTAMP——格式：’YYYYMMDDHHMMSS’、’YYMMDDHHMMSS’、’YYYYMMDD’、’YYMMDD’，范围：’1970-01-01 00:00:00’到’2037-01-01 00:00:00’<br>• TIME——格式：’HH:MM:SS’<br>• YEAR——格式：’YYYY，范围：’1901’到’2155’</p>
<h2 id="MySQL-中-int-5-最大长度是多少？"><a href="#MySQL-中-int-5-最大长度是多少？" class="headerlink" title="MySQL 中 int(5)最大长度是多少？"></a>MySQL 中 int(5)最大长度是多少？</h2><ul>
<li>无论是 int(3)、int(10)，内存存储的是 4 个字节；</li>
<li>最大长度取决于类型是 int 还是 bigint ；</li>
<li><code>int(5)</code>的 5 表示默认显示字符的宽度: 如果输入的是<code>10</code>默认给你显示为<code>00010</code>（加上 <code>zerofill</code>后可以看到）；</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test1` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">5</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `id2` <span class="type">int</span>(<span class="number">5</span>) unsigned <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `id3` <span class="type">int</span>(<span class="number">5</span>) unsigned zerofill <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>MyISAM AUTO_INCREMENT<span class="operator">=</span><span class="number">17</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>latin1;</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/lyloou/img/raw/develop/z/20190718155452.png"></p>
<p>参考： <a href="https://blog.csdn.net/allenjay11/article/details/76549503">MySQL 中 int(11)最大长度是多少？ - 养码青年 - CSDN 博客</a></p>
<blockquote>
<p>在 SQL 语句中 int 代表你要创建字段的类型，int 代表整型，11 代表字段的长度。<br>　这个 11 代表显示宽度，整数列的显示宽度与 mysql 需要用多少个字符来显示该列数值，与该整数需要的存储空间的大小都没有关系，比如，不管设定了显示宽度是多少个字符，bigint 都要占用 8 个 字节。</p>
<p>int 是整型，(11)是指显示字符的长度，但要加参数的，最大为 255，比如它是记录行数的 id,插入 10 笔资料，它就显示 00000000001 ~~~00000000010，当字符的位数超过 11,它也只显示 11 位，如果你没有加那个让它未满 11 位就前面加 0 的参数，它不会在前面加 0</p>
<p>声明整型数据列时，我们可以为它指定个显示宽度 M(1~255)，如 INT(5)，指定显示宽度为 5 个字符,如果没有给它指定显示宽度，MySQL 会为它指定一个默认值。显示宽度只用于显示，并不能 限制取值范围和占用空间，如：INT(3)会占用 4 个字节的存储空间，并且允许的最大值也不会是 999,而是 INT 整型所允许的最大值。</p>
<p>MySQL 有五种整型数据列类型，即 TINYINT，SMALLINT，MEDIUMINT，INT 和 BIGINT。它们之间的区别是取值范围不同，存储空间也各不相同。<br>在整型数据列后加上 UNSIGNED 属性可以禁止负数，取值从 0 开始。</p>
</blockquote>
<h2 id="varchar-5-中的-5-又代表什么"><a href="#varchar-5-中的-5-又代表什么" class="headerlink" title="varchar(5)中的 5 又代表什么?"></a>varchar(5)中的 5 又代表什么?</h2><p>这里的<code>5</code>就真的是字符串的长度了</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test1` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">5</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `id2` <span class="type">int</span>(<span class="number">5</span>) unsigned <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `id3` <span class="type">int</span>(<span class="number">5</span>) unsigned zerofill <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name1` <span class="type">varchar</span>(<span class="number">5</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>MyISAM AUTO_INCREMENT<span class="operator">=</span><span class="number">17</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>latin1;</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/lyloou/img/raw/develop/z/20190718163004.png"></p>
]]></content>
      <tags>
        <tag>sql</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysql必知必会</title>
    <url>/sql/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/</url>
    <content><![CDATA[<blockquote>
<p>《MySQL 必知必会》——BenForta 著 刘晓霞译<br>表结构和数据源文件 <a href="http://forta.com/books/0672327120/">http://forta.com/books/0672327120/</a></p>
</blockquote>
<h2 id="客户机-服务器软件"><a href="#客户机-服务器软件" class="headerlink" title="客户机-服务器软件"></a>客户机-服务器软件</h2><ul>
<li>服务器部分是负责所有数据访问和处理的一个软件。</li>
<li>客户机是与用户打交道的软件。<br>例如，如果你请求一个按字母顺序列出的产品表，则客户机软件通过网络提交该请求给服务器软件。<br>服务器软件处理这个请求，根据需要过滤、丢弃和排序数据；然后把结果送回到你的客户机软件。</li>
</ul>
<ul>
<li>服务器软件为 MySQL DBMS。</li>
<li>客户机软件可以是 MySQL 提供的工具、脚本语言（如 Perl）、Web 应用开发语言（如 ASP、ColdFusion、JSP 和 PHP）、<br>程序设计语言（如 C、C++、Java）等。</li>
</ul>
<h2 id="SHOW"><a href="#SHOW" class="headerlink" title="SHOW"></a>SHOW</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line"><span class="keyword">SHOW</span> COLUMNS <span class="keyword">FROM</span> customers;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE crashcouse;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> customers;</span><br></pre></td></tr></table></figure>

<h2 id="检索"><a href="#检索" class="headerlink" title="检索"></a>检索</h2><p>SELECT 子句及其顺序 p88</p>
<table>
<thead>
<tr>
<th>子句</th>
<th>说明</th>
<th>是否必须使用</th>
</tr>
</thead>
<tbody><tr>
<td>SELECT</td>
<td>要返回的列或表达式</td>
<td>是</td>
</tr>
<tr>
<td>FROM</td>
<td>从中检索数据的表</td>
<td>仅在从表中选择数据时使用</td>
</tr>
<tr>
<td>WHERE</td>
<td>行级过滤</td>
<td>否</td>
</tr>
<tr>
<td>GROUP BY</td>
<td>分组说明</td>
<td>仅在按组计算聚集时使用</td>
</tr>
<tr>
<td>HAVING</td>
<td>组级过滤</td>
<td>否</td>
</tr>
<tr>
<td>ORDER BY</td>
<td>输出排序顺序</td>
<td>否</td>
</tr>
<tr>
<td>LIMIT</td>
<td>要检索的行数</td>
<td>否</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products;</span><br><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price <span class="keyword">FROM</span> products; # 检索多列</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> products;  # 除非确实需要表中的每个列，否则最好不要使用`<span class="operator">*</span>`通配符，检索不需要的列通常会降低检索和应用程序的性能。</span><br></pre></td></tr></table></figure>

<h3 id="DISTINCT"><a href="#DISTINCT" class="headerlink" title="DISTINCT"></a>DISTINCT</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> vend_id <span class="keyword">FROM</span> products;  # <span class="keyword">DISTINCT</span> 表示只返回唯一不同的行，用法是直接放在列名前，注意不能使用<span class="keyword">DISTINCT</span></span><br><span class="line">                                        # <span class="keyword">DISTINCT</span> 应用于所有列而不是前置它的列。</span><br><span class="line">                                        # 可以通过 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="operator">+</span> <span class="keyword">IN</span> 的方式：</span><br></pre></td></tr></table></figure>

<h3 id="LIMIT"><a href="#LIMIT" class="headerlink" title="LIMIT"></a>LIMIT</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products LIMIT <span class="number">5</span>;     # 返回前<span class="number">5</span>行；类似 LIMIT <span class="number">0</span>,<span class="number">5</span></span><br><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products LIMIT <span class="number">5</span>, <span class="number">10</span>; # 返回从第<span class="number">5</span>行（包括<span class="number">5</span>）开始的<span class="number">10</span>条数据； 注意下标从<span class="number">0</span>开始。</span><br><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products LIMIT <span class="number">10</span> <span class="keyword">OFFSET</span> <span class="number">5</span>; # 返回从第<span class="number">5</span>行开始的<span class="number">10</span>行</span><br></pre></td></tr></table></figure>

<h3 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h3><p>关系数据设计理论认为，如果不明确规定排序，则不应该假定检索出的数据的顺序有意义。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products <span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_name;</span><br><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products <span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_price;  # 可以用非检索的列来排序</span><br><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price <span class="keyword">FROM</span> products <span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_price,prod_name;  # 多列检索</span><br><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price <span class="keyword">FROM</span> products <span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_price,prod_name <span class="keyword">DESC</span>;  # 反序 （默认是<span class="keyword">ASC</span>——升序）</span><br><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price <span class="keyword">FROM</span> products <span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_price <span class="keyword">DESC</span>,prod_name;  # 注意和上面的区别；</span><br><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price <span class="keyword">FROM</span> products <span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_price <span class="keyword">DESC</span>,prod_name <span class="keyword">DESC</span>;  # <span class="keyword">DESC</span> 关键字只应用到直接位于其前面的列名</span><br><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price <span class="keyword">FROM</span> products <span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_price <span class="keyword">DESC</span> LIMIT <span class="number">1</span>;    # 找到最昂贵的物品；</span><br><span class="line">                                                     # <span class="keyword">ORDER</span> <span class="keyword">BY</span> 位于 <span class="keyword">FROM</span> 之后，LIMIT 位于 <span class="keyword">ORDER</span> <span class="keyword">BY</span> 之后；</span><br></pre></td></tr></table></figure>

<h3 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_price <span class="operator">=</span> <span class="number">2.50</span>;</span><br><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_price <span class="operator">&gt;=</span> <span class="number">2.50</span>;</span><br><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_price <span class="keyword">BETWEEN</span> <span class="number">5</span> <span class="keyword">AND</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">SELECT</span> cust_id <span class="keyword">FROM</span> customers <span class="keyword">WHERE</span> cust_email <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><em>子句操作符</em></p>
<table>
<thead>
<tr>
<th>操作符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>=</td>
<td>等于</td>
</tr>
<tr>
<td>&lt;&gt;</td>
<td>不等于</td>
</tr>
<tr>
<td>!=</td>
<td>不等于</td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
</tr>
<tr>
<td>&lt;=</td>
<td>小于等于</td>
</tr>
<tr>
<td>&gt;</td>
<td>大于</td>
</tr>
<tr>
<td>&gt;=</td>
<td>大于等于</td>
</tr>
<tr>
<td>BETWEEN</td>
<td>在指定的两个值之间</td>
</tr>
</tbody></table>
<p><em><code>AND</code> &amp; <code>OR</code></em></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_id, prod_price, prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> vend_id <span class="operator">=</span> <span class="number">1003</span> <span class="keyword">AND</span> prod_price <span class="operator">&lt;=</span> <span class="number">10</span>; # 逻辑与</span><br><span class="line"><span class="keyword">SELECT</span> vend_id, prod_id, prod_price, prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> vend_id <span class="operator">=</span> <span class="number">1003</span> <span class="keyword">OR</span> vend_id <span class="operator">=</span> <span class="number">1002</span>; # 逻辑或</span><br></pre></td></tr></table></figure>

<p>当<code>AND</code>和<code>OR</code>在一起时，在处理<code>OR</code>之前，优先处理<code>AND</code>操作符。解决办法是使用<code>()</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> vend_id <span class="operator">=</span> <span class="number">1002</span> <span class="keyword">OR</span> vend_id <span class="operator">=</span> <span class="number">1003</span> <span class="keyword">AND</span> prod_price <span class="operator">&gt;=</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> (vend_id <span class="operator">=</span> <span class="number">1002</span> <span class="keyword">OR</span> vend_id <span class="operator">=</span> <span class="number">1003</span>) <span class="keyword">AND</span> prod_price <span class="operator">&gt;=</span> <span class="number">10</span>;</span><br><span class="line"># 使用圆括号没有什么坏处，它能消除歧义</span><br></pre></td></tr></table></figure>

<p><em><code>IN</code></em></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name,prod_price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> vend_id <span class="keyword">IN</span> (<span class="number">1002</span>, <span class="number">1003</span>) <span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_name;</span><br></pre></td></tr></table></figure>

<p><code>IN</code>的功能与<code>OR</code>相当，且有更多的优点：</p>
<ul>
<li>在使用长的合法选项清单时，<code>IN</code>操作符的语法更清楚且更直观。</li>
<li>在使用<code>IN</code>时，计算的次序更容易管理（因为使用的操作符更少）</li>
<li><code>IN</code>操作符一般比<code>OR</code>操作符清单执行的更快。</li>
<li><code>IN</code>的最大优点是可以包含其他<code>SELECT</code>语句，使得能够更容易动态地建立<code>WHERE</code>子句。</li>
</ul>
<p><code>NOT</code>，在<code>WHERE</code>子句中用来否定后跟条件的关键字</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, prod_price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> vend_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="number">1002</span>, <span class="number">1003</span>) <span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_name;</span><br></pre></td></tr></table></figure>

<p><code>NOT</code>可以和<code>IN</code>、<code>BETWEEN</code>、<code>EXISTS</code>子句结合使用，对结果取反。</p>
<h3 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_id, prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_name <span class="keyword">LIKE</span> <span class="string">&#x27;jet%&#x27;</span>; # 检索任意以jet起头的词</span><br><span class="line"><span class="keyword">SELECT</span> prod_id, prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_name <span class="keyword">LIKE</span> <span class="string">&#x27;%anvil%&#x27;</span>; # 检索任意位置包含文本anvil的值</span><br><span class="line"><span class="keyword">SELECT</span> prod_id, prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_name <span class="keyword">LIKE</span> <span class="string">&#x27;_ ton anvil&#x27;</span>; # 与<span class="operator">%</span>可以匹配任意字符不一样,</span><br><span class="line">                                                                            # _ 总是匹配一个字符，不能多也不能少</span><br></pre></td></tr></table></figure>

<p><code>%</code>通配符不能匹配值为<code>NULL</code>的行。<br>使用通配符的技巧：</p>
<ul>
<li>不要过度使用通配符。如果其他操作符能达到相同的目的，应该使用其他操作符。</li>
<li>在确实需要使用通配符时，除非绝对有必要，否则不要把它们用在搜索模式的开始处。把通配符置于搜索模式的开始处，搜索起来是最慢的。</li>
<li>仔细注意通配符的位置。如果放错了地方，可能不会返回想要的数据。</li>
</ul>
<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_name REGEXP <span class="string">&#x27;1000&#x27;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_name;</span><br><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_name REGEXP <span class="string">&#x27;.000&#x27;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_name; # `.`匹配任意一个字符</span><br><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_name REGEXP <span class="type">BINARY</span> <span class="string">&#x27;JetPack .000&#x27;</span>; # 默认不匹配大小写, 使用 <span class="type">BINARY</span> 来区分</span><br><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_name REGEXP <span class="string">&#x27;1000|2000|3000&#x27;</span>; # 进行<span class="keyword">OR</span>匹配</span><br><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_name REGEXP <span class="string">&#x27;[123] ton&#x27;</span>; # 匹配任意几个字符, 指定一组用[和]括起来的字符</span><br><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_name REGEXP <span class="string">&#x27;1|2|3 ton&#x27;</span>; # 区别于上面的[<span class="number">123</span>] ton,这里匹配的是<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> ton</span><br><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_name REGEXP <span class="string">&#x27;[1-5] ton&#x27;</span>; # 匹配范围</span><br><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_name REGEXP <span class="string">&#x27;\\.&#x27;</span>; # 匹配特殊字符, 需要使用转义符</span><br><span class="line">                                                             # Mysql要求两个反斜杠(Mysql自己解释一个,正则表达式库解释一个)</span><br><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_name REGEXP <span class="string">&#x27;[:alnum:]&#x27;</span>; # 匹配字符类,更多参考p58</span><br><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_name REGEXP <span class="string">&#x27;\\([0-9] sticks?\\)&#x27;</span>; # sticks? 匹配stick和sticks</span><br></pre></td></tr></table></figure>

<p>重复元字符</p>
<table>
<thead>
<tr>
<th>元字符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>*</td>
<td>0 个或多个匹配</td>
</tr>
<tr>
<td>+</td>
<td>1 个或多个匹配(等于{1,})</td>
</tr>
<tr>
<td>?</td>
<td>0 个或 1 个匹配(等于{0,1})</td>
</tr>
<tr>
<td>{n}</td>
<td>指定数目的匹配</td>
</tr>
<tr>
<td>{n,}</td>
<td>不少于指定数目的匹配</td>
</tr>
<tr>
<td>{n,m}</td>
<td>匹配数目的范围(m 不超过 255)</td>
</tr>
</tbody></table>
<p>定位元字符</p>
<table>
<thead>
<tr>
<th>元字符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>^</td>
<td>文本的开始</td>
</tr>
<tr>
<td>$</td>
<td>文本的结尾</td>
</tr>
<tr>
<td>[[:&lt;:]]</td>
<td>词的开始</td>
</tr>
<tr>
<td>[[:&gt;:]]</td>
<td>词的结尾</td>
</tr>
</tbody></table>
<p><code>^</code> 有两种用法，在集合中（用<code>[</code>和<code>]</code>定义），用它来否定该集合，否则，用来指串的开始。</p>
<p>简单的正则表达示测试</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;hello&#x27;</span> REGEXP <span class="string">&#x27;[a-zA-Z]&#x27;</span> # 验证字符是否符合正则</span><br></pre></td></tr></table></figure>

<p>条件符合时结果为 1，条件不符合时结果为 0；</p>
<h3 id="计算字段"><a href="#计算字段" class="headerlink" title="计算字段"></a>计算字段</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Concat(vend_name, <span class="string">&#x27; (&#x27;</span>, vend_country, <span class="string">&#x27;)&#x27;</span>) <span class="keyword">FROM</span> vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name; # 拼接字段Concatenate, 将值连接到一起构成单个值</span><br><span class="line"><span class="keyword">SELECT</span> Concat(vend_name, <span class="string">&#x27; (&#x27;</span>, vend_country, <span class="string">&#x27;)&#x27;</span>) <span class="keyword">AS</span> vend_title <span class="keyword">FROM</span> vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name; # 别名alias</span><br><span class="line"><span class="keyword">SELECT</span> Concat(RTrim(vend_name), <span class="string">&#x27; (&#x27;</span>, RTrim(vend_country), <span class="string">&#x27;)&#x27;</span>) <span class="keyword">AS</span> vend_title <span class="keyword">FROM</span> vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name; # 去除左边LTrim(), 右边RTrim(), 两边<span class="built_in">Trim</span>()的空格</span><br></pre></td></tr></table></figure>

<p>MySQL 算术操作符</p>
<table>
<thead>
<tr>
<th>操作符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>加</td>
</tr>
<tr>
<td>-</td>
<td>减</td>
</tr>
<tr>
<td>*</td>
<td>乘</td>
</tr>
<tr>
<td>/</td>
<td>除</td>
</tr>
</tbody></table>
<h3 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vend_name, <span class="built_in">Upper</span>(vend_name) <span class="keyword">AS</span> vend_name_upcase <span class="keyword">FROM</span> vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> customers <span class="keyword">WHERE</span> Soundex(cust_contact) <span class="operator">=</span> Soundex(<span class="string">&#x27;Y. Lie&#x27;</span>); # 比较发音字符</span><br></pre></td></tr></table></figure>

<p>常用文本处理函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Left()</td>
<td>返回串左边的字符</td>
</tr>
<tr>
<td>Length()</td>
<td>返回串的长度</td>
</tr>
<tr>
<td>Locate()</td>
<td>找出串的一个子串</td>
</tr>
<tr>
<td>Lower()</td>
<td>将串转换为小写</td>
</tr>
<tr>
<td>LTrim()</td>
<td>去除串左边的空格</td>
</tr>
<tr>
<td>Right()</td>
<td>返回串右边的字符</td>
</tr>
<tr>
<td>RTrim()</td>
<td>去除串右边的空格</td>
</tr>
<tr>
<td>Soundex()</td>
<td>返回串的 SOUNDEX 值</td>
</tr>
<tr>
<td>SubString()</td>
<td>返回子串的字符</td>
</tr>
<tr>
<td>Upper()</td>
<td>将串转换为大写</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_id, order_num <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> <span class="type">Date</span>(order_date) <span class="operator">=</span> <span class="string">&#x27;2005-09-01&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> cust_id, order_num <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> <span class="type">Date</span>(order_date) <span class="keyword">BETWEEN</span> <span class="string">&#x27;2005-09-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2005-09-30&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> cust_id, order_num <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> <span class="keyword">Year</span>(order_date) <span class="operator">=</span> <span class="string">&#x27;2005&#x27;</span> <span class="keyword">AND</span> <span class="keyword">Month</span>(order_date) <span class="operator">=</span> <span class="string">&#x27;09&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>常用日期和时间处理函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>AddDate()</td>
<td>增加一个日期（天、周等）</td>
</tr>
<tr>
<td>AddTime()</td>
<td>增加一个时间</td>
</tr>
<tr>
<td>CurDate()</td>
<td>返回当前日期</td>
</tr>
<tr>
<td>CurTime()</td>
<td>返回当前日间</td>
</tr>
<tr>
<td>Date()</td>
<td>返回日期时间的日期部分</td>
</tr>
<tr>
<td>DateDiff()</td>
<td>计算两个日期之差</td>
</tr>
<tr>
<td>Date_Add()</td>
<td>高度灵活的日期运算函数</td>
</tr>
<tr>
<td>Date_Format()</td>
<td>返回一个格式化的日期或时间串</td>
</tr>
<tr>
<td>Day()</td>
<td>返回一个日期的天数部分</td>
</tr>
<tr>
<td>DayOfWeek()</td>
<td>对于一个日期，返回对应的星期几</td>
</tr>
<tr>
<td>Hour()</td>
<td>返回一个时间的小时部分</td>
</tr>
<tr>
<td>Minute()</td>
<td>返回一个时间的分钟部分</td>
</tr>
<tr>
<td>Month()</td>
<td>返回一个日期的月数部分</td>
</tr>
<tr>
<td>Now()</td>
<td>返回当前日期和时间</td>
</tr>
<tr>
<td>Second()</td>
<td>返回一个时间的秒部分</td>
</tr>
<tr>
<td>Time()</td>
<td>返回一个日期的时间部分</td>
</tr>
<tr>
<td>Year()</td>
<td>返回一个日期的年份部分</td>
</tr>
</tbody></table>
<h3 id="汇总数据"><a href="#汇总数据" class="headerlink" title="汇总数据"></a>汇总数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(prod_price) <span class="keyword">AS</span> avg_price <span class="keyword">FROM</span> products; # AVG函数只作用于单个列,为了获得多个列的平均值,必须使用多个AVG函数</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(prod_price) <span class="keyword">AS</span> avg_price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> vend_id<span class="operator">=</span><span class="number">1003</span>;</span><br><span class="line">                                                   # AVG 忽略列值为<span class="keyword">NULL</span>的行</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> num_cust <span class="keyword">FROM</span> customers; # 对表中的所有行计数, 不论是否为<span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(cust_email) <span class="keyword">AS</span> num_cust <span class="keyword">FROM</span> customers; # 对特定的列计数,忽略<span class="keyword">NULL</span>值</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(prod_price) <span class="keyword">AS</span> max_price <span class="keyword">FROM</span> products; # 找出最大值     ,忽略<span class="keyword">NULL</span>值</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(prod_price) <span class="keyword">AS</span> min_price <span class="keyword">FROM</span> products; # 找出最小值     ,忽略<span class="keyword">NULL</span>值</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(quantity) <span class="keyword">AS</span> items_ordered <span class="keyword">FROM</span> orderitems <span class="keyword">WHERE</span> order_num <span class="operator">=</span> <span class="number">20005</span>; # 指定列求和</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(quantity<span class="operator">*</span>item_price) <span class="keyword">AS</span> total_price <span class="keyword">FROM</span> orderitems <span class="keyword">WHERE</span> order_num <span class="operator">=</span> <span class="number">20005</span>; # 合计计算值</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(<span class="keyword">DISTINCT</span> prod_price) <span class="keyword">AS</span> avg_price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> vend_id <span class="operator">=</span> <span class="number">1003</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(<span class="keyword">ALL</span> prod_price) <span class="keyword">AS</span> avg_price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> vend_id <span class="operator">=</span> <span class="number">1003</span>; # 默认<span class="built_in">AVG</span>(<span class="keyword">ALL</span>)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> num_items, <span class="built_in">MIN</span>(prod_price) <span class="keyword">AS</span> price_min, <span class="built_in">MAX</span>(prod_price) <span class="keyword">AS</span> price_max, <span class="built_in">AVG</span>(prod_price) <span class="keyword">AS</span> price_avg</span><br><span class="line"><span class="keyword">FROM</span> products;</span><br></pre></td></tr></table></figure>

<p>聚集函数用来汇总数据。MySQL 支持一系列聚集函数，可以用多种方法使用它们以返回所需的结果。<br>这些函数是高效设计的，它们返回结果一般比你在自己的客户机应用程序中计算要快得多。</p>
<h3 id="分组数据"><a href="#分组数据" class="headerlink" title="分组数据"></a>分组数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vend_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> num_prods <span class="keyword">FROM</span> products <span class="keyword">GROUP</span> <span class="keyword">BY</span> vend_id;</span><br><span class="line"><span class="keyword">SELECT</span> cust_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> orders <span class="keyword">FROM</span> orders <span class="keyword">GROUP</span> <span class="keyword">BY</span> cust_id <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span><span class="number">2</span>;</span><br><span class="line"><span class="keyword">SELECT</span> cust_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> orders <span class="keyword">FROM</span> orders <span class="keyword">GROUP</span> <span class="keyword">BY</span> cust_id <span class="keyword">HAVING</span> orders <span class="operator">&gt;=</span><span class="number">2</span>; # 第三条</span><br><span class="line"><span class="keyword">SELECT</span> vend_id, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> num_prods <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> prod_price <span class="operator">&gt;=</span> <span class="number">10</span></span><br><span class="line">       <span class="keyword">GROUP</span> <span class="keyword">BY</span> vend_id <span class="keyword">HAVING</span> num_prods <span class="operator">&gt;=</span><span class="number">2</span>; # <span class="keyword">WHERE</span> 和 <span class="keyword">HAVING</span> 的区别, <span class="keyword">WHERE</span>在数据分组前进行过滤,<span class="keyword">HAVING</span>在数据分组后进行过滤,</span><br><span class="line">                                              # <span class="keyword">WHERE</span> 排除的行不包括在分组中</span><br><span class="line"><span class="keyword">SELECT</span> order_num, <span class="built_in">SUM</span>(quantity<span class="operator">*</span>item_price) <span class="keyword">AS</span> ordertotal <span class="keyword">FROM</span> orderitems <span class="keyword">GROUP</span> <span class="keyword">BY</span> order_num <span class="keyword">HAVING</span> ordertotal <span class="operator">&gt;=</span><span class="number">50</span>;</span><br><span class="line"><span class="keyword">SELECT</span> order_num, <span class="built_in">SUM</span>(quantity<span class="operator">*</span>item_price) <span class="keyword">AS</span> ordertotal <span class="keyword">FROM</span> orderitems <span class="keyword">GROUP</span> <span class="keyword">BY</span> order_num <span class="keyword">HAVING</span> ordertotal <span class="operator">&gt;=</span><span class="number">50</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> ordertotal; # 对总计订单价格排序</span><br></pre></td></tr></table></figure>

<p><code>GROUP BY</code>重要规定</p>
<ul>
<li><code>GROUP BY</code> 子句可以包含任意数目。这使得能对分组进行嵌套，为数据分组提供更细致的控制。</li>
<li>如果在<code>GROUP BY</code>子句中嵌套了分组，数据将在最后规定的分组上进行汇总换句话说，在建立分组时，指定的所有列都一起计算<br>（所以不能从个别的列取回数据）。</li>
<li><code>GROUP BY</code> 子句中列出的每个列都必须是检索列或有效的表达式（但不能是聚集函数）。<br>如果在 SELECT 中使用表达式，则必须在 GROUP BY 子句中指定相同的表达式。不能使用别名。 // 这个不对吧，譬如上面的第三条语句。版本升级？</li>
<li>除聚集计算语句外，SELECT 语句中的每个列都必须在 GROUP BY 子句中给出。</li>
<li>如果分组列中具有 NULL 值，则 NULL 将作为一个分组返回。如果列中有多行 NULL 值它们将分为一组。</li>
<li>GROUP BY 子句必须出现在 WHERE 子句之后，ORDER BY 子句之前。</li>
</ul>
<h3 id="子查询和联结"><a href="#子查询和联结" class="headerlink" title="子查询和联结"></a>子查询和联结</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> cust_id</span><br><span class="line">                  <span class="keyword">FROM</span> orders</span><br><span class="line">                  <span class="keyword">WHERE</span> order_num <span class="keyword">IN</span> (<span class="keyword">SELECT</span> order_num</span><br><span class="line">                                      <span class="keyword">FROM</span> orderitems</span><br><span class="line">                                      <span class="keyword">WHERE</span> prod_id <span class="operator">=</span> <span class="string">&#x27;TNT2&#x27;</span>)); # 方法<span class="number">1</span> 子查询 p92</span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orders <span class="keyword">ON</span> customers.cust_id <span class="operator">=</span> orders.cust_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> orderitems <span class="keyword">ON</span> orders.order_num <span class="operator">=</span> orderitems.order_num</span><br><span class="line"><span class="keyword">WHERE</span> orderitems.prod_id <span class="operator">=</span> <span class="string">&#x27;TNT2&#x27;</span>; # 方法<span class="number">2</span> 外查询</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> cust_name,</span><br><span class="line">       cust_state,</span><br><span class="line">       (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line">        <span class="keyword">FROM</span> orders</span><br><span class="line">        <span class="keyword">WHERE</span> orders.cust_id <span class="operator">=</span> customers.cust_id) <span class="keyword">AS</span> orders</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name; # 有必要完全限定列名, 即: <span class="keyword">table</span>名.filed名</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact</span><br><span class="line"><span class="keyword">FROM</span> customers, orders, orderitems</span><br><span class="line"><span class="keyword">WHERE</span> customers.cust_id <span class="operator">=</span> orders.cust_id</span><br><span class="line">  <span class="keyword">AND</span> orderitems.order_num <span class="operator">=</span> orders.order_num</span><br><span class="line">  <span class="keyword">AND</span> prod_id <span class="operator">=</span> <span class="string">&#x27;TNT2&#x27;</span>; # 方法<span class="number">3</span> 内部查询 p105</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> orders <span class="keyword">ON</span> customers.cust_id <span class="operator">=</span> orders.cust_id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> orderitems <span class="keyword">ON</span> orders.order_num <span class="operator">=</span> orderitems.order_num</span><br><span class="line"><span class="keyword">WHERE</span> orderitems.prod_id <span class="operator">=</span> <span class="string">&#x27;TNT2&#x27;</span>; # 方法<span class="number">4</span> 内部查询 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> p104</span><br><span class="line">                                 # ANSI <span class="keyword">SQL</span> 规范首选<span class="keyword">INNER</span> <span class="keyword">JOIN</span> 语法.对比<span class="keyword">WHERE</span>子句,明确要使用联结条件, 性能更佳</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> p1.prod_id, p1.prod_name</span><br><span class="line"><span class="keyword">FROM</span> products <span class="keyword">AS</span> p1, products <span class="keyword">AS</span> p2</span><br><span class="line"><span class="keyword">WHERE</span> p1.vend_id <span class="operator">=</span> p2.vend_id</span><br><span class="line">  <span class="keyword">AND</span> p2.prod_id <span class="operator">=</span> <span class="string">&#x27;DTNTR&#x27;</span>; # 自联结  对比子查询, 有时候处理自联结远比处理子查询快的多</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> c.<span class="operator">*</span>, o.order_num, o.order_date,</span><br><span class="line">       oi.prod_id, oi.quantity, oi.item_price</span><br><span class="line"><span class="keyword">FROM</span> customers <span class="keyword">AS</span> c, orders <span class="keyword">AS</span> o, orderitems <span class="keyword">AS</span> oi</span><br><span class="line"><span class="keyword">WHERE</span> c.cust_id <span class="operator">=</span> o.cust_id</span><br><span class="line">  <span class="keyword">AND</span> oi.order_num <span class="operator">=</span> o.order_num</span><br><span class="line">  <span class="keyword">AND</span> prod_id <span class="operator">=</span> <span class="string">&#x27;FB&#x27;</span>;  # 自然联结 排除多次出现, 全每个列只返回一次</span><br><span class="line">                       # 系统不完成这项工作, 由你自己完成它</span><br><span class="line">                       # 一般是对表使用通配符 (<span class="keyword">SELECT</span> <span class="operator">*</span>), 对所有其他表的列使用明确的子集来完成</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> customers.cust_id, orders.order_num</span><br><span class="line"><span class="keyword">FROM</span> customers <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> orders</span><br><span class="line"> <span class="keyword">ON</span> customers.cust_id <span class="operator">=</span> orders.cust_id; # 外部联结 和内部联结不同的是，外部联结还包括没有关联行的行。</span><br><span class="line">                                        # 相对的还有 <span class="keyword">RIGHT</span> <span class="keyword">OUT</span> <span class="keyword">JOIN</span> ，究竟使用哪一种纯粹是根据方便而定</span><br><span class="line">                                        # 注意：<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> 等同于 <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span>  —— https:<span class="operator">/</span><span class="operator">/</span>stackoverflow.com<span class="operator">/</span>questions<span class="operator">/</span><span class="number">406294</span><span class="operator">/</span><span class="keyword">left</span><span class="operator">-</span><span class="keyword">join</span><span class="operator">-</span>vs<span class="operator">-</span><span class="keyword">left</span><span class="operator">-</span><span class="keyword">outer</span><span class="operator">-</span><span class="keyword">join</span><span class="operator">-</span><span class="keyword">in</span><span class="operator">-</span><span class="keyword">sql</span><span class="operator">-</span>server</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> customers.cust_name,</span><br><span class="line">       customers.cust_id,</span><br><span class="line">       <span class="built_in">COUNT</span>(orders.order_num) <span class="keyword">AS</span> num_ord</span><br><span class="line"><span class="keyword">FROM</span> customers <span class="keyword">INNER</span> <span class="keyword">JOIN</span> orders</span><br><span class="line"><span class="keyword">ON</span> customers.cust_id <span class="operator">=</span> orders.cust_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> customers.cust_id; # 带聚集函数的联结, 按客户分组；</span><br><span class="line">                            # 其中 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> 可以换成 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span>，查找到订单为<span class="number">0</span>的客户</span><br></pre></td></tr></table></figure>

<p>使用联结的要点：</p>
<ul>
<li>注意所使用的联结类型。一般我们使用内部联结，但使用外部联结也是有效的。</li>
<li>保证使用正确的联结条件，否则将返回不正确的数据。</li>
<li>应该总是提供联结条件，否则会得出笛卡尔积。</li>
<li>在一个联结中可以包含多个表，甚至对于每个联结可以采用不同的联结类型。虽然这样做是合法的，一般也很有用，但应该在一起测试它们前，分别测试每个联结。这将使故障排除更为简单。</li>
</ul>
<h3 id="组合查询"><a href="#组合查询" class="headerlink" title="组合查询"></a>组合查询</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vend_id, prod_id, prod_price</span><br><span class="line"><span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">WHERE</span> prod_price <span class="operator">&lt;=</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> vend_id, prod_id, prod_price</span><br><span class="line"><span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">WHERE</span> vend_id <span class="keyword">IN</span> (<span class="number">1001</span>, <span class="number">1002</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> vend_id, prod_id, prod_price</span><br><span class="line"><span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">WHERE</span> prod_price <span class="operator">&lt;=</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> vend_id, prod_id, prod_price</span><br><span class="line"><span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">WHERE</span> vend_id <span class="keyword">IN</span> (<span class="number">1001</span>, <span class="number">1002</span>); # 使用 <span class="keyword">UNION</span> <span class="keyword">ALL</span> 不排除重复的行</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> vend_id, prod_id, prod_price</span><br><span class="line"><span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">WHERE</span> prod_price <span class="operator">&lt;=</span> <span class="number">5</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> vend_id, prod_id, prod_price</span><br><span class="line"><span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">WHERE</span> vend_id <span class="keyword">IN</span> (<span class="number">1001</span>, <span class="number">1002</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_id, prod_price; # 使用 <span class="keyword">UNION</span>查询，只能使用一条<span class="keyword">ORDER</span> <span class="keyword">BY</span> 子句，必须出现在最后一条<span class="keyword">SELECT</span>语句之后。但实际上是对所有结果排序。</span><br></pre></td></tr></table></figure>

<p><code>UNION</code>规则</p>
<ul>
<li>UNION 必须由两条或两条以上的 SELECT 语句组成，语句之间用关键字 UNION 分隔（因此，如果组合 4 条 SELECT 语句，将要使用 3 个 UNION 关键字）</li>
<li>UNION 中的每个查询必须包含相同的列、表达式或聚集函数（不过各个列不需要以相同的次序列出）。</li>
<li>列数据类型必须兼容：类型不必完全相同，但必须是 DBMS 可以隐含地转换的类型（例如，不同的数值类型或不同的日期类型）。</li>
</ul>
<h3 id="全文本搜索"><a href="#全文本搜索" class="headerlink" title="全文本搜索"></a>全文本搜索</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> note_text <span class="keyword">FROM</span> productnotes <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;rabbit&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> note_text, <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;rabbit&#x27;</span>) <span class="keyword">AS</span> rank</span><br><span class="line"><span class="keyword">FROM</span> productnotes; # 演示排序如何工作（等级越高，越靠前）</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> note_text <span class="keyword">FROM</span> productnotes</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;anvils&#x27;</span> <span class="keyword">WITH</span> QUERY EXPANSION);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> note_text</span><br><span class="line"><span class="keyword">FROM</span> productnotes</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;heavy -rope*&#x27;</span> <span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> note_text <span class="keyword">FROM</span> productnotes <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;+rabbit +bait&#x27;</span> <span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE);</span><br><span class="line"><span class="keyword">SELECT</span> note_text <span class="keyword">FROM</span> productnotes <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;rabbit bait&#x27;</span> <span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE);</span><br><span class="line"><span class="keyword">SELECT</span> note_text <span class="keyword">FROM</span> productnotes <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;&quot;rabbit bait&quot;&#x27;</span> <span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE);</span><br><span class="line"><span class="keyword">SELECT</span> note_text <span class="keyword">FROM</span> productnotes <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;&gt;rabbit &lt;carrot&#x27;</span> <span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE);</span><br><span class="line"><span class="keyword">SELECT</span> note_text <span class="keyword">FROM</span> productnotes <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;+safe +(&lt;combination)&#x27;</span> <span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>MySQL 中，最常用的两个引擎为 MyISAM 和 InnoDB，MyISAM 引擎支持全文本搜索。<br>不要在导入数据时使用 FULLTEXT，应该首先导入数据，然后再修改表，定义 FULLTEXT。</p>
<p>全文本布尔操作符</p>
<table>
<thead>
<tr>
<th>布尔操作符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>包含，词必须存在</td>
</tr>
<tr>
<td>-</td>
<td>排除，词必须不出现</td>
</tr>
<tr>
<td>&gt;</td>
<td>包含，而且增加等级值</td>
</tr>
<tr>
<td>&lt;</td>
<td>包含，且减少等级值</td>
</tr>
<tr>
<td>()</td>
<td>把词组成子表达式（允许这些子表达式作为一个组实包含、排除、排列等）</td>
</tr>
<tr>
<td>~</td>
<td>取消一个词的排序值</td>
</tr>
<tr>
<td>*</td>
<td>词尾的通配符</td>
</tr>
<tr>
<td>“”</td>
<td>定义一个短语（与单个词的列表不一样，它匹配整个短语以便包含或排除这个短语）</td>
</tr>
</tbody></table>
<h2 id="插入-amp-更新-amp-删除"><a href="#插入-amp-更新-amp-删除" class="headerlink" title="插入 &amp; 更新 &amp; 删除"></a>插入 &amp; 更新 &amp; 删除</h2><h3 id="INSERT"><a href="#INSERT" class="headerlink" title="INSERT"></a>INSERT</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers(cust_name,</span><br><span class="line">  cust_contact,</span><br><span class="line">  cust_email,</span><br><span class="line">  cust_address,</span><br><span class="line">  cust_city,</span><br><span class="line">  cust_state,</span><br><span class="line">  cust_zip,</span><br><span class="line">  cust_country)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;Pep E.LaPew&#x27;</span>,</span><br><span class="line">  <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="string">&#x27;100 Main Street&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;Los Angeles&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;CA&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;90046&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;USA&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers(cust_name,</span><br><span class="line">  cust_address,</span><br><span class="line">  cust_city,</span><br><span class="line">  cust_state,</span><br><span class="line">  cust_zip,</span><br><span class="line">  cust_country)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;Pep E. Lapwe&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;100 Main Street&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Los Angeles&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;CA&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;90046&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;USA&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;M. Martian&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;42 Galaxy Way&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;New York&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;NY&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;11213&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;USA&#x27;</span>); # 一次插入多条数据：单条<span class="keyword">INSERT</span>语句处理多个插入比使用多条<span class="keyword">INSERT</span>语句快。</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers(cust_name,</span><br><span class="line">  cust_address,</span><br><span class="line">  cust_city,</span><br><span class="line">  cust_state,</span><br><span class="line">  cust_zip,</span><br><span class="line">  cust_country)</span><br><span class="line"><span class="keyword">SELECT</span> cust_name,</span><br><span class="line">       cust_address,</span><br><span class="line">       cust_city,</span><br><span class="line">       cust_state,</span><br><span class="line">       cust_zip,</span><br><span class="line">       cust_country</span><br><span class="line"><span class="keyword">FROM</span> custnew; # 插入检索出的数据；</span><br><span class="line">              # 不一定要求一列名匹配，但是列要互相对应：第一列对第一列，第二列对第二列。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>总是使用列的列表：即便表的结构改变，INSERT 语句仍能正确工作。<br>省略列，须满足以下某个条件：</p>
<ul>
<li>该列定义为允许 NULL 值（无值或空值）</li>
<li>在表定义中给出默认值。这表示如果不给出值，将使用默认值。</li>
</ul>
<p>如果系统的数据检索是最重要的，可以降低 INSERT、UPDATE、DELETE 的优先级来提高整体性能。<br><code>INSERT LOW PRIORITY INTO</code></p>
<h3 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> customers</span><br><span class="line"><span class="keyword">SET</span> cust_email <span class="operator">=</span> <span class="string">&#x27;elmer@fudd.com&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> cust_id <span class="operator">=</span> <span class="number">10005</span>; # 务必指定 <span class="keyword">WHERE</span>子句，否则更新所有行。</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> customers <span class="keyword">SET</span> cust_email <span class="operator">=</span> <span class="keyword">NULL</span> <span class="keyword">WHERE</span> cust_id <span class="operator">=</span> <span class="number">10005</span>; # 删除某个列的值，可设置它为<span class="keyword">NULL</span>(前提是可以为<span class="keyword">NULL</span>)</span><br></pre></td></tr></table></figure>

<h3 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_id <span class="operator">=</span> <span class="number">10006</span>; # 务必指定 <span class="keyword">WHERE</span>子句，否则删除所有行。</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> customers; # 删除所有用户（逐行删除）</span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> customers; # 删除所有用户，更快的删除（删除表并重新创建表）</span><br></pre></td></tr></table></figure>

<p>更新和删除的指导原则</p>
<ul>
<li>除非确实打算更新和删除每一行，否则绝对不要使用不带 WHERE 子句的 UPDATE 或 DELETE 语句；</li>
<li>保证每个表都有主键，尽可能像 WHERE 子句那样使用它（可以指定各主键、多个值或值的范围）；</li>
<li>在对 UPDATE 或 DELETE 使用 WHERE 子句前，应该先用 SELECT 进行测试，保证它过滤的是正确的记录，以防编写的 WHERE 子句不正确。</li>
<li>使用强制实施引用完整性的数据库，这样 MySQL 将不允许删除具有与其他表相关联的数据的行。</li>
</ul>
<h2 id="创建和操纵表"><a href="#创建和操纵表" class="headerlink" title="创建和操纵表"></a>创建和操纵表</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> customers</span><br><span class="line">(</span><br><span class="line">  cust_id       <span class="type">int</span>       <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  cust_name     <span class="type">char</span>(<span class="number">50</span>)  <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  cust_address  <span class="type">char</span>(<span class="number">50</span>)  <span class="keyword">NULL</span>,</span><br><span class="line">  cust_city     <span class="type">char</span>(<span class="number">50</span>)  <span class="keyword">NULL</span>,</span><br><span class="line">  cust_state    <span class="type">char</span>(<span class="number">5</span>)   <span class="keyword">NULL</span>,</span><br><span class="line">  cust_zip      <span class="type">char</span>(<span class="number">10</span>)  <span class="keyword">NULL</span>,</span><br><span class="line">  cust_country  <span class="type">char</span>(<span class="number">50</span>)  <span class="keyword">NULL</span>,</span><br><span class="line">  cust_contact  <span class="type">char</span>(<span class="number">50</span>)  <span class="keyword">NULL</span>,</span><br><span class="line">  cust_email    <span class="type">char</span>(<span class="number">50</span>)  <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (cust_id)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB; # 适当的格式缩进以便阅读和编辑</span><br><span class="line">                   # 试图给<span class="keyword">NOT</span> <span class="keyword">NULL</span>的列插入<span class="keyword">NULL</span>（该列无值），将返回错误，插入失败</span><br><span class="line">                   # 每个表只允许一个AUTO_INCREMENT列，而且它必须被索引（如，使它成为主键）</span><br><span class="line">                   # `<span class="keyword">SELECT</span> last_insert_id()`来获取最后一个AUTO_INCREMENT值。</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> customers</span><br><span class="line">(cust_id       <span class="type">int</span>       <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT); # 仅在表名不存在时创建</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> orderitems</span><br><span class="line">(</span><br><span class="line">  order_num   <span class="type">int</span>       <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">  order_item  <span class="type">int</span>       <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">  prod_id     <span class="type">char</span>(<span class="number">10</span>)  <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">  quantity    <span class="type">int</span>       <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">  item_price  <span class="type">DECIMAL</span>(<span class="number">8</span>,<span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> ,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (order_num, order_item)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB; # 由多个列组成的主键，以逗号分隔。</span><br><span class="line">                   # 默认值不可为函数，只支持常量</span><br></pre></td></tr></table></figure>

<p>引擎：</p>
<ul>
<li>InnoDB 是一个可靠的事务处理引擎，它不支持全文本搜索。</li>
<li>MEMORY 在功能等同于 MyISAM，但由于数据存储在内在（不是磁盘）中，速度很快（特别适合于临时表）</li>
<li>MyISAM 是一个性能极高的引擎，它支持全文本搜索，但不支持事务处理。</li>
</ul>
<p>外键不能跨引擎，即使用一个引擎的表不能引用具有使用不同引擎的表的外键。<br>使用哪个引擎，依赖于需要什么样的特性；</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> vendors</span><br><span class="line"><span class="keyword">ADD</span> vend_phone <span class="type">CHAR</span>(<span class="number">20</span>); # 添加一个列</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> vendors</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> vend_phone; # 删除列</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> orderitems</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_orderitems_orders</span><br><span class="line"><span class="keyword">FOREIGN</span> KEY (order_num) <span class="keyword">REFERENCES</span> orders (order_num); # <span class="keyword">ALTER</span> <span class="keyword">TABLE</span>常见的用途是定义外键。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> customers2; # 删除表</span><br><span class="line"></span><br><span class="line">RENAME <span class="keyword">TABLE</span> customers2 <span class="keyword">TO</span> customers; # 重命名表</span><br><span class="line"></span><br><span class="line">RENAME <span class="keyword">TABLE</span> backup_customers <span class="keyword">TO</span> customers,</span><br><span class="line">             backup_vendors <span class="keyword">TO</span> vendors,</span><br><span class="line">             backup_products <span class="keyword">TO</span> products; # 对多个表重命名</span><br></pre></td></tr></table></figure>

<h2 id="使用视图"><a href="#使用视图" class="headerlink" title="使用视图"></a>使用视图</h2><p><em>常见视图应用</em></p>
<ul>
<li>重用 SQL 语句</li>
<li>简化复杂 SQL 操作。在编写查询后，可以方便地重用它而不必知道它的基本查询细节。</li>
<li>使用表的组成部分而不是整个表。</li>
<li>保护数据。可以给用户授予表的特定部分的访问权限而不是整个表的访问权限。</li>
<li>更改数据格式和表示。视图可返回与底层表的表示和格式不同的数据。</li>
</ul>
<p><em>视图的规则和限制</em></p>
<ul>
<li>与表一样，视图必须唯一命名（视图名不能重复或与表名相同）</li>
<li>对于可以创建的视图数目没有限制。</li>
<li>为了创建视图，必须具有足够的访问权限。这些限制通常由数据库管理人员授予。</li>
<li>视图可以嵌套，即可以利用从其他视图中检索数据的查询来构造一个视图</li>
<li>ORDER BY 可以用在视图中，但如果从该视图检索数据的 SELECT 语句中也含有 ORDER BY， 那么该视图中的 ORDER BY 将被覆盖。</li>
<li>视图不能索引，也不能有关联的触发器或默认值。</li>
<li>视图可以和表一起使用。例如，编写一条联结表和视图的 SELECT 语句。</li>
</ul>
<p><em>视图的创建</em></p>
<ul>
<li>视图用 CREATE VIEW 语句来创建。</li>
<li>使用<code>SHOW CREATE VIEW viewname;</code> 来查看创建视图的语句。</li>
<li>用 DROP 删除视图，其语法为<code>DROP VIEW viewname;</code></li>
<li>更新视图时，可以先用 DROP 再用 CREATE，也可以直接用<code>CREATE OR REPLACE VIEW</code>。如果更新的视图不存在，则第 1 条语句会创建一个视图；<br>如果要更新的视图存在，则第 2 条更新的语句会替换原有视图。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> productcustomers <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact, prod_id</span><br><span class="line"><span class="keyword">FROM</span> customers, orders, orderitems</span><br><span class="line"><span class="keyword">WHERE</span> customers.cust_id <span class="operator">=</span> orders.cust_id</span><br><span class="line">    <span class="keyword">AND</span> orderitems.order_num <span class="operator">=</span> orders.order_num; # 创建视图</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact</span><br><span class="line"><span class="keyword">FROM</span> productcustomers</span><br><span class="line"><span class="keyword">WHERE</span> prod_id <span class="operator">=</span> <span class="string">&#x27;TNT2&#x27;</span>;    # 查询视图</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> vendorlocations <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> Concat(RTrim(vend_name), <span class="string">&#x27; (&#x27;</span>, RTrim(vend_country), <span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">    <span class="keyword">AS</span> vend_title</span><br><span class="line"><span class="keyword">FROM</span> vendors</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name; # 创建重新格式化的视图</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> vendorlocations;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> customeremaillist <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_id, cust_name, cust_email</span><br><span class="line"><span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_email <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>; # 创建过滤条件的视图</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> customeremaillist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> orderitemsexpanded <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num,</span><br><span class="line">       prod_id,</span><br><span class="line">       quantity,</span><br><span class="line">       item_price,</span><br><span class="line">       quantity<span class="operator">*</span>item_price <span class="keyword">AS</span> expanded_price</span><br><span class="line"><span class="keyword">FROM</span> orderitems;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orderitemsexpanded <span class="keyword">WHERE</span> order_num <span class="operator">=</span> <span class="number">20005</span>;</span><br></pre></td></tr></table></figure>

<p><em>视图定义在以下操作不可更新</em></p>
<ul>
<li>分组（使用 GROUPING 和 HAVING）</li>
<li>联结</li>
<li>子查询</li>
<li>并</li>
<li>聚集函数（Min(), Cust(), Sum()等）</li>
<li>DISTINCT</li>
<li>导出（计算）列</li>
</ul>
<p>视图的主要作用在于数据检索，而不用于更新（INSERT、UPDATE 和 DELETE）</p>
<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><p><em>为什么使用存储过程</em></p>
<ul>
<li>通过把处理封装在容易使用的单元中，简化复杂的操作。</li>
<li>由于不要求反复建立一系列处理步骤，这保证了数据的完整性。<br>如果所有开发人员和应用程序都使用同一存储过程，则所使用的代码都是相同的。防止错误，保证了数据的一致性。</li>
<li>简化对变动的管理。如果表名、列名、或业务逻辑有变化，只需要更改存储过程的代码。使用这的人员甚至不需要知道这些变化。<br>这一点的延伸就是安全性。通过存储过程限制对基础数据的访问减少了数据讹误的机会。</li>
<li>提高性能。因为使用在座过程比使用单独的 SQL 语句要快。</li>
<li>存在一些只能用在单个请求中的 MySQL 元素和特性，存储过程可以使用它们来编写功能更强更灵活的代码。</li>
</ul>
<p>换句话说，使用存储过程有 3 个主要好处：简单、安全、高性能。</p>
<p>另外也有一些缺陷：</p>
<ul>
<li>存储过程的编写比 SQL 语句复杂，编写存储过程概要更高的技能，更丰富的经验。</li>
<li>由于数据库管理员限制，可能只有使用的权限，没有创建的权限。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> productpricing(</span><br><span class="line">  <span class="keyword">OUT</span> pl <span class="type">DECIMAL</span>(<span class="number">8</span>,<span class="number">2</span>),</span><br><span class="line">  <span class="keyword">OUT</span> ph <span class="type">DECIMAL</span>(<span class="number">8</span>,<span class="number">2</span>),</span><br><span class="line">  <span class="keyword">OUT</span> pa <span class="type">DECIMAL</span>(<span class="number">8</span>,<span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="built_in">Min</span>(prod_price)</span><br><span class="line">  <span class="keyword">INTO</span> pl</span><br><span class="line">  <span class="keyword">FROM</span> products;</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="built_in">MAX</span>(prod_price)</span><br><span class="line">  <span class="keyword">INTO</span> ph</span><br><span class="line">  <span class="keyword">FROM</span> products;</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(prod_price)</span><br><span class="line">  <span class="keyword">INTO</span> pa</span><br><span class="line">  <span class="keyword">FROM</span> products;</span><br><span class="line"><span class="keyword">END</span>; # 存储过程的创建</span><br><span class="line">     # 参数中的<span class="keyword">IN</span>：传递数据给存储过程</span><br><span class="line">     # 参数中的<span class="keyword">OUT</span>：从存储过程传出</span><br><span class="line">     # 参数中的<span class="keyword">INOUT</span>：对存储过程传入传出</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> productpricing(<span class="variable">@pricelow</span>, <span class="variable">@pricehigh</span>, <span class="variable">@priceaverage</span>); # 调用存储过程</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@pricelow</span>; # 检索结果</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@pricehigh</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@priceaverage</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> productpricing; # 删除存储过程，如果不存在会产生错误</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> productpricing; # 删除存储过程</span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> productpricing; # 检查存储过程</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;productpricing&#x27;</span>; # 限制过程状态结果</span><br></pre></td></tr></table></figure>

<blockquote>
<p>mysql 命令行客户机的分隔符：<br>mysql 命令行实用程序使用<code>;</code>作为分隔符<br>默认 mysql 语句也使用<code>;</code>作为分隔符<br>解决冲突的办法是临时更改命令行实用程序的语句分隔符</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> productpricing()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">Avg</span>(prod_price) <span class="keyword">AS</span> priceaverage</span><br><span class="line">    <span class="keyword">FROM</span> products;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<p>考虑这个场景。你需要获得与以前一样的订单合计，但需要对合计增加营业税，不过只针对某些顾客。<br>那么，你需要做下面几件事情：</p>
<ul>
<li>获得合计（与以前一样）；</li>
<li>把营业税有条件地添加到合计；</li>
<li>返回合计（带或不带税）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- Name: order total</span></span><br><span class="line"><span class="comment">-- Parameters: onumber = order number</span></span><br><span class="line"><span class="comment">--             taxable = 0 if not taxable, 1 if taxable</span></span><br><span class="line"><span class="comment">--             ototal = order total variable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> ordertotal(</span><br><span class="line">  <span class="keyword">IN</span> onumber <span class="type">INT</span>,</span><br><span class="line">  <span class="keyword">IN</span> taxable <span class="type">BOOLEAN</span>,</span><br><span class="line">  <span class="keyword">OUT</span> ototal <span class="type">DECIMAL</span>(<span class="number">8</span>, <span class="number">2</span>)</span><br><span class="line">) COMMENT <span class="string">&#x27;Obtain order total, optionally adding tax&#x27;</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- Declare variable for total</span></span><br><span class="line">  <span class="keyword">DECLARE</span> total <span class="type">DECIMAL</span>(<span class="number">8</span>, <span class="number">2</span>);</span><br><span class="line">  <span class="comment">-- Decliare tax percentage</span></span><br><span class="line">  <span class="keyword">DECLARE</span> taxrate <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Get the order total</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="built_in">Sum</span>(item_price<span class="operator">*</span>quantity)</span><br><span class="line">  <span class="keyword">FROM</span> orderitems</span><br><span class="line">  <span class="keyword">WHERE</span> order_num <span class="operator">=</span> onumber</span><br><span class="line">  <span class="keyword">INTO</span> total;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Is this taxable?</span></span><br><span class="line">  IF taxable <span class="keyword">THEN</span>   # 不可使用 ELSEIF <span class="keyword">THEN</span>、<span class="keyword">ELSE</span>子句</span><br><span class="line">  <span class="keyword">SELECT</span> total<span class="operator">+</span>(total<span class="operator">/</span><span class="number">100</span><span class="operator">*</span>taxrate) <span class="keyword">INTO</span> total;</span><br><span class="line">  <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- And finally, save to out variable</span></span><br><span class="line">  <span class="keyword">SELECT</span> total <span class="keyword">INTO</span> ototal;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> ordertotal(<span class="number">20005</span>, <span class="number">0</span>, <span class="variable">@total</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@total</span>;</span><br><span class="line"><span class="keyword">CALL</span> ordertotal(<span class="number">20005</span>, <span class="number">1</span>, <span class="variable">@total</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@total</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h2><p>MySQL 游标只能用于存储过程。</p>
<p>使用游标的步骤：</p>
<ul>
<li>在能够使用游标前，必须声明（定义）它。这个过程实际上没有检索数据，它只是定义要使用的 SELECT 语句。</li>
<li>一旦声明后，必须打开游标以供使用。这个过程用前面定义的 SELECT 语句把数据实际检索出来。</li>
<li>对于填有数据的游标，根据需要取出（检索）各行。</li>
<li>在结束游标使用时，必须关闭游标。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> processorders()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- Declare local variables</span></span><br><span class="line">  <span class="keyword">DECLARE</span> done <span class="type">BOOLEAN</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">DECLARE</span> o <span class="type">INT</span>;</span><br><span class="line">  <span class="keyword">DECLARE</span> t <span class="type">DECIMAL</span>(<span class="number">8</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Declare the cursor</span></span><br><span class="line">  <span class="keyword">DECLARE</span> ordernumbers <span class="keyword">CURSOR</span></span><br><span class="line">  <span class="keyword">FOR</span></span><br><span class="line">  <span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> orders;</span><br><span class="line">  <span class="comment">-- Declare continue handler</span></span><br><span class="line">  <span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLSTATE</span> <span class="string">&#x27;02000&#x27;</span> <span class="keyword">SET</span> done<span class="operator">=</span><span class="number">1</span>; # <span class="keyword">SQLSTATE</span> <span class="string">&#x27;02000&#x27;</span>是一个未找到条件。</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Create a table to store the results</span></span><br><span class="line">  <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> ordertotals(order_num <span class="type">INT</span>, total <span class="type">DECIMAL</span>(<span class="number">8</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Open the cursor</span></span><br><span class="line">  <span class="keyword">OPEN</span> ordernumbers;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Loop through all rows</span></span><br><span class="line">  REPEAT</span><br><span class="line">    <span class="comment">-- Get order number</span></span><br><span class="line">    <span class="keyword">FETCH</span> ordernumbers <span class="keyword">INTO</span> o;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- Get the total for this order</span></span><br><span class="line">    <span class="keyword">CALL</span> ordertotal(o, <span class="number">1</span>, t);</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- Insert order and total into ordertotals</span></span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> ordertotals(order_num, total) <span class="keyword">VALUES</span>(o, t);</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- End of loop</span></span><br><span class="line">  UNTIL done  <span class="keyword">END</span> REPEAT;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Close the cursor</span></span><br><span class="line">  <span class="keyword">CLOSE</span> ordernumbers;</span><br><span class="line"><span class="keyword">END</span>;  # 使用游标将<span class="keyword">Fetch</span>的数据存储到表中</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> processorders(); # 调用</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> ordertotals;</span><br></pre></td></tr></table></figure>

<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>触发器，在表发生一些更改时，自动处理一些事情。<br>MySQL 触发器只支持<code>UPDATE</code>、<code>DELETE</code>、<code>INSERT</code>。<br>创建触发器，需要给出 4 条信息：</p>
<ul>
<li>唯一的触发器名；</li>
<li>触发器关联的表；</li>
<li>触发器应该响应的活动（DELETE、INSERT 或 UPDATE）</li>
<li>触发器何时执行（处理之前或之后）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># http:<span class="operator">/</span><span class="operator">/</span>www.cnblogs.com<span class="operator">/</span>duhuo<span class="operator">/</span>p<span class="operator">/</span><span class="number">4655957.</span>html</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> newproduct AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> products</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span> <span class="keyword">SELECT</span> <span class="string">&#x27;Product added&#x27;</span> <span class="keyword">INTO</span> <span class="variable">@msg</span>; # 创建触发器</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> products (prod_id, vend_id, prod_name, prod_price, prod_desc) <span class="keyword">VALUES</span> (<span class="string">&#x27;Lou&#x27;</span>, <span class="number">1002</span>, <span class="string">&#x27;TNT 5&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;TNT 5, yellow, pack of 100 sticks&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@msg</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> newproduct; # 删除触发器</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> deleteorder BEFORE <span class="keyword">DELETE</span> <span class="keyword">ON</span> orders</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> archive_orders(order_num, order_date, cust_id)</span><br><span class="line">    <span class="keyword">VALUES</span>(OLD.order_num, OLD.order_date, OLD.cust_id); # 删除前先存档</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> updatevendor BEFORE <span class="keyword">UPDATE</span> <span class="keyword">ON</span> vendors</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span> <span class="keyword">SET</span> NEW.vend_state <span class="operator">=</span> <span class="built_in">Upper</span>(New.vend_state); # 更新前先转换为大写（数据净化）</span><br></pre></td></tr></table></figure>

<blockquote>
<p>只有表支持触发器，视图不支持</p>
</blockquote>
<blockquote>
<p>每个表支持 6 个触发器（每条 INSERT、UPDATE、DELETE 的之前和之后）</p>
</blockquote>
<blockquote>
<p>如果 BEFORE 触发器失败，则 MySQL 将不执行请求的操作。<br>此外，如果 BEFORE 触发器或语句本身失败，MySQL 将不执行 AFTER 触发器（如是有的话）</p>
</blockquote>
<blockquote>
<p>触发器一个非常有意义的使用是创建审计跟踪。使用触发器，把更改记录到另外一个表非常容易。</p>
</blockquote>
<h2 id="管理事务"><a href="#管理事务" class="headerlink" title="管理事务"></a>管理事务</h2><p>事务处理（transaction processing） 可以用来维护数据库的完整性，它保证成批的 MySQL 操作要么完全执行，要么完全不执行。</p>
<p>MyISAM 引擎不支持事务，InnoDB 支持事务。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> ordertotals;</span><br><span class="line"><span class="keyword">START</span> TRANSACTION <span class="keyword">WITH</span> CONSISTENT SNAPSHOT ;  # 标识事务开始</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> ordertotals;</span><br><span class="line"><span class="keyword">ROLLBACK</span> ; # 只能在一个事务处理内使用（在执行一条<span class="keyword">START</span> TANASACTION之后）</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> ordertotals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">START</span> TRANSACTION <span class="keyword">WITH</span> CONSISTENT SNAPSHOT ;  # 标识事务开始</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> orderitems <span class="keyword">WHERE</span> order_num <span class="operator">=</span> <span class="number">20007</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> order_num <span class="operator">=</span> <span class="number">20007</span>;</span><br><span class="line"><span class="keyword">COMMIT</span>; # 提交事务</span><br><span class="line"></span><br><span class="line"><span class="keyword">SAVEPOINT</span> delete1; # 保留点</span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> delete1; # 回滚到保留点</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> AUTOCOMMIT <span class="operator">=</span> <span class="number">0</span>; # 设置不自动提交</span><br></pre></td></tr></table></figure>

<h2 id="全球化和本地化"><a href="#全球化和本地化" class="headerlink" title="全球化和本地化"></a>全球化和本地化</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> ; # 查看字符集</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">COLLATION</span> ; # 查看校对, 以latin1为例，许多校对出现两次，一次区分大小写（由_cs表示）， 一次不区分（由_ci表示）</span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;character%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;collation%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytable</span><br><span class="line">(</span><br><span class="line">  columnn1 <span class="type">INT</span>,</span><br><span class="line">  columnn2 <span class="type">VARCHAR</span>(<span class="number">10</span>)</span><br><span class="line">) <span class="keyword">DEFAULT</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> hebrew</span><br><span class="line">  <span class="keyword">COLLATE</span> hebrew_general_ci; # 给表指定字符集和校对</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytable</span><br><span class="line">(</span><br><span class="line">  columnn1 <span class="type">INT</span>,</span><br><span class="line">  columnn2 <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">  columnn3 <span class="type">VARCHAR</span>(<span class="number">10</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> latin1 <span class="keyword">COLLATE</span> latin1_general_ci # 给特定的列指定字符集和校对</span><br><span class="line">) <span class="keyword">DEFAULT</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> hebrew</span><br><span class="line">  <span class="keyword">COLLATE</span> hebrew_general_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> lastname, firstname <span class="keyword">COLLATE</span> latin1_general_cs;</span><br><span class="line">   # 校对在对用`<span class="keyword">ORDER</span> <span class="keyword">BY</span>`子句检索出来的数据排序时起重要的作用（如是否忽略大小写）。</span><br></pre></td></tr></table></figure>

<h2 id="安全管理"><a href="#安全管理" class="headerlink" title="安全管理"></a>安全管理</h2><p>MySQL 的用户账号和信息存储在名为 mysql 的 MySQL 数据库中。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">USE mysql;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> name_lou IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password_lou&#x27;</span>; # 创建用户</span><br><span class="line">RENAME <span class="keyword">USER</span> name_lou <span class="keyword">TO</span> lou; # 更改名</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> lou; # 删除账号</span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> lou; # 查看已经有的权限</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> goods.<span class="operator">*</span> <span class="keyword">TO</span> lou; # 授予goods数据库的所有表的<span class="keyword">SELECT</span>权限</span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> goods.<span class="operator">*</span> <span class="keyword">FROM</span> lou; # 撤销权限</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span> <span class="keyword">ON</span> goods.<span class="operator">*</span> <span class="keyword">TO</span> lou; # 简化多次授权，使用逗号分隔</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> PASSWORD <span class="keyword">FOR</span> lou <span class="operator">=</span> Password(<span class="string">&#x27;new_password&#x27;</span>); # 更改口令；</span><br><span class="line"><span class="keyword">SET</span> PASSWORD <span class="operator">=</span> Password(<span class="string">&#x27;new_password&#x27;</span>); # 更改自己的口令；</span><br></pre></td></tr></table></figure>

<p><em>GRANT 和 REVOKE 可在几个层次上控制访问权限</em></p>
<ul>
<li>整个服务器，使用 GRANT ALL 和 REVOKE ALL；</li>
<li>整个数据库，使用 ON database.*;</li>
<li>特定的表，使用 ON database.table;</li>
<li>特定的列；</li>
<li>特定的存储过程；</li>
<li>详细看 p202</li>
</ul>
<h2 id="数据库维护"><a href="#数据库维护" class="headerlink" title="数据库维护"></a>数据库维护</h2><p>从以下几个角度考虑</p>
<ul>
<li><p>备份数据<br>备份前使用<code>FLUSH TABLE</code></p>
</li>
<li><p>表问题分析和检查</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ANALYZE <span class="keyword">TABLE</span> orders;</span><br><span class="line"><span class="keyword">CHECK</span> <span class="keyword">TABLE</span> orders, orderitems;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>诊断启动问题<br>使用命令行选项，<code>--help</code>、<code>--safe-mode</code>、<code>--verbose</code></p>
</li>
<li><p>查看日志文件<br><a href="https://stackoverflow.com/questions/5441972/how-to-see-log-files-in-mysql">https://stackoverflow.com/questions/5441972/how-to-see-log-files-in-mysql</a></p>
</li>
</ul>
<h2 id="改善性能"><a href="#改善性能" class="headerlink" title="改善性能"></a>改善性能</h2><ul>
<li>一般来说，关键的生产 DBMS 应该运行在自己的专用服务器上。</li>
<li>MySQL 是用一系列默认设置预先配置的，这些设置开始通常是很好的。但过一段时间后你可能需要调整内在分配、缓冲区大小等。<br>（为查看当前设置，可使用 SHOW VARIABLES; 和 SHOW STATUS;）</li>
<li>MySQL 是一个多用户多线程的 DBMS，换言之，它经常同时执行多个任务。<br>如果这些任务中的某个执行缓慢，则所有请求都会执行缓慢。<br>如果你遇到显著的性能不良，可使用<code>SHOW PROCESSLIST</code>显示所有活动进程（以及它们的线程 ID 和执行时间）。<br>你还可以用 KILL 命令终结某个特定的进程（使用这个命令需要作为管理员登录）。</li>
<li>总是有不止一种方法编写同一条 SELECT 语句。应该试验联结、并、子查询等，找出最佳的方法。</li>
<li>使用 EXPANIN 语句让 MySQL 解释它将如何执行一条 SELECT 语句。</li>
<li>一般来说，存储过程执行得比一条一条地执行其中的各条 MySQL 语句快。</li>
<li>应该总是使用正确的数据类型。</li>
<li>决不要检索比需求还要多的数据。换言之，不要用<code>SELECT *</code>（除非你真正需要每个列）。</li>
<li>有的操作（包括 INSERT）支持一个可靠的 DELAYED 关键字，如果使用它，将把控制立即返回给调用程序，并且一旦有可能就实际执行该操作。</li>
<li>在导入数据时，应该关闭自动提交。你可能还想删除索引（包括 FULLTEXT 索引），然后在导入完成后再重建它们。</li>
<li>必须索引数据库以改善数据检索的性能确定索引什么不是一件微不足道的任务，需要分析使用的 SELECT 语句以找出重复的 WHERE 和 ORDER BY 子句。<br>如果一个简单的 WHERE 子句返回结果所花的时间太长，则可以断定其中使用的列（或几个列）就是需要索引的对象。</li>
<li>你的 SELECT 语句中有一系列复杂的 OR 条件吗？通过使用多条 SELECT 语句和连接它们的 UNION 语句，你能看到极大的性能改进。</li>
<li>索引改善数据的性能，但损害数据插入、删除和更新的性能。<br>如果你有一些表，它们收集数据且不经常被搜索，则在有必要之前不要索引它们。（索引可根据需要添加和删除）</li>
<li>LIKE 很慢。一般来说，最好是使用 FULLTEXT 而不是 LIKE。</li>
<li>数据库是不断变化的实体。一组优化良好的表一会儿后可能就面目全非了。由于表的使用和内容的更改，理想的优化和配置也会改变。</li>
<li>最重要的规则就是，每条规则在某些条件下都会被打破。</li>
</ul>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><ul>
<li>何时使用单引号？单引号用来限定字符串。如果将值与串类型的列进行比较，则需要限定引号。用来与数值列进行比较的值不需要引号。</li>
<li>SQL 是不区分大小写的。</li>
<li>SQL 语句以<code>;</code>结束。</li>
<li>SQL 语句中的空格会被忽略，将 SQL 语句分成多行更容易阅读和调试；</li>
</ul>
]]></content>
      <tags>
        <tag>sql</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>Postgresql-Mac</title>
    <url>/sql/postgresql-mac/</url>
    <content><![CDATA[<h2 id="安装客户端"><a href="#安装客户端" class="headerlink" title="安装客户端"></a>安装客户端</h2><p><a href="https://dba.stackexchange.com/a/258890">https://dba.stackexchange.com/a/258890</a></p>
<p>Install <code>just client</code> with <code>brew</code>:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">brew install pgcli</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>then link it:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">brew link <span class="comment">--force libpq</span></span><br></pre></td></tr></table></figure>

<p>as output you will get the path to <code>psql</code>:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">If you need <span class="keyword">to</span> have this software <span class="keyword">first</span> <span class="keyword">in</span> your PATH instead consider <span class="keyword">running</span>:</span><br><span class="line">  echo <span class="string">&#x27;export PATH=&quot;/usr/local/opt/libpq/bin:$PATH&quot;&#x27;</span> <span class="operator">&gt;&gt;</span> <span class="operator">~</span><span class="operator">/</span>.zshrc</span><br></pre></td></tr></table></figure>

<p>to find this path again:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">brew info libpq</span><br></pre></td></tr></table></figure>


<h2 id="数据导入和导出"><a href="#数据导入和导出" class="headerlink" title="数据导入和导出"></a>数据导入和导出</h2><h3 id="导出数据库"><a href="#导出数据库" class="headerlink" title="导出数据库"></a>导出数据库</h3><p>1.导出单个表</p>
<p>例：从ip为xxx的数据库monitor中导出threshold的表结构和数据到本地文件threshold.sql：<br><code>pg_dump -t threshold -h 135.32.94.142 monitor -U monitor -p 5432  -f threshold.sql</code><br>参数说明：-t 指定导出的表名；-h 数据库地址；-U 数据库用户；-p 访问端口；-f  导出到指定文件；</p>
<p>2.导出所有表和所有数据</p>
<p>例：从ip为xxx的数据库monitor导出所有表结构和数据到文件monitor.sql:<br><code>pg_dump -h 135.32.94.142 monitor -U monitor -p 5432  -f monitor.sql</code><br>3.仅导出所有表结构</p>
<p>例：从ip为xxx的数据库monitor导出所有的表结构到文件monitor.sql:<br><code>pg_dump -s -h 135.32.94.142 monitor -U monitor -p 5432  -f monitor.sql</code><br>参数说明：-s 表示只导出表结构，不导数据</p>
<p>注:一般数据库数据量比较大，如果远程导出所有的表结构和数据的话会非常慢，所有只导出表结构是个明智的选择。随后可以再导出单个重要表结构和数据进来。</p>
<h3 id="导入数据库"><a href="#导入数据库" class="headerlink" title="导入数据库"></a>导入数据库</h3><p>1.导入到远程数据库</p>
<p>例：从本地文件threshold.sql导入表结构和数据到ip为xxx的数据库monitor：<br><code>psql -h 135.32.9.99 -d monitor -U monitor -f threshold.sql</code><br>参数说明： -h 数据库地址；-d  数据库；-U 指定用户；-f  要导入的文件   注:文件就是从数据库导出的文件。</p>
<p>2.导入到本地数据库<br><code>psql -h 0.0.0.0  -d monitor -U monitor -p 5432 -f monitor.sql</code><br>参数说明： -p 指定数据库服务端口，视情况而变，默认是5432端口的可以不加</p>
<p>————————————————<br>版权声明：本文为CSDN博主「比特叔叔」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/kmust20093211/article/details/45190801">postgresql数据库导入导出_比特叔叔的博客-CSDN博客</a></p>
]]></content>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>Postgresql</title>
    <url>/sql/postgresql/</url>
    <content><![CDATA[<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1 创建数据库</span></span><br><span class="line">CREATE DATABASE testdb OWNER dbuser;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 列出所有数据库</span></span><br><span class="line">\l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 连接数据库</span></span><br><span class="line">\c testdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4 创建表和查看表</span></span><br><span class="line">CREATE TABLE student(<span class="built_in">id</span> int, name varchar(20), birth_date <span class="built_in">date</span>);</span><br><span class="line">\d <span class="comment"># 查看所有表</span></span><br><span class="line">\d student <span class="comment"># 查看当前表结构</span></span><br><span class="line">\d+ student <span class="comment"># 显示更多的信息，如：与表列关联的注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5 插入数据</span></span><br><span class="line">INSERT INTO student(<span class="built_in">id</span>, name, birth_date) values(1, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;2010-10-10&#x27;</span>);</span><br><span class="line">INSERT INTO student(<span class="built_in">id</span>, name, birth_date) values(2, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;2010-10-12&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6 查询表</span></span><br><span class="line">SELECT * FROM student;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7 修改</span></span><br><span class="line">UPDATE student SET name=<span class="string">&#x27;aa&#x27;</span> WHERE <span class="built_in">id</span> = 1;</span><br><span class="line">UPDATE student SET name=<span class="string">&#x27;bb&#x27;</span> WHERE <span class="built_in">id</span> = 2;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8 删除</span></span><br><span class="line">DELETE FROM student <span class="built_in">where</span> <span class="built_in">id</span> = 1;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9 删除表</span></span><br><span class="line">DROP TABLE student;</span><br></pre></td></tr></table></figure>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install postgresql-client</span><br><span class="line">sudo apt-<span class="built_in">get</span> install postgresql</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html">PostgreSQL 新手入门</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">\h：查看SQL命令的解释，比如\h <span class="keyword">select</span>。</span><br><span class="line">\?：查看psql命令列表。</span><br><span class="line">\l：列出所有数据库。</span><br><span class="line">\c [database_name]：连接其他数据库。</span><br><span class="line">\d：列出当前数据库的所有表格。</span><br><span class="line">\d [table_name]：列出某一张表格的结构。</span><br><span class="line">\<span class="built_in">du</span>：列出所有用户。</span><br><span class="line">\e：打开文本编辑器。</span><br><span class="line">\conninfo：列出当前数据库和连接的信息。</span><br></pre></td></tr></table></figure>

<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><ul>
<li>要用<code>;</code>来结束语句；</li>
<li>字符串要用单引号<code>&#39;</code>来包裹；</li>
</ul>
<h2 id="enable-remote-connection"><a href="#enable-remote-connection" class="headerlink" title="enable remote connection"></a>enable remote connection</h2><ul>
<li><a href="https://blog.bigbinary.com/2016/01/23/configure-postgresql-to-allow-remote-connection.html">Configure PostgreSQL to allow remote connection | BigBinary Blog</a></li>
</ul>
<p>sudo service postgresql restart</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://blog.csdn.net/Chen_Victor/article/details/55515266">PostgreSQL 入门 - CSDN 博客</a></li>
<li><a href="https://www.cnblogs.com/stephen-liu74/category/343171.html">PostgreSQL - 随笔分类 - Stephen_Liu - 博客园</a></li>
<li>《PostgreSQL 修炼之道》</li>
</ul>
<h2 id="Permission-denied-for-relation"><a href="#Permission-denied-for-relation" class="headerlink" title="Permission denied for relation"></a>Permission denied for relation</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- login in admin:</span></span><br><span class="line">psql <span class="operator">-</span>U postgres <span class="operator">-</span>d exampledb <span class="operator">-</span>h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="operator">-</span>p <span class="number">5432</span>;</span><br><span class="line"><span class="comment">-- grant</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="keyword">ALL</span> TABLES user_tbl <span class="keyword">TO</span> dbuser;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- login in dbuser</span></span><br><span class="line">psql <span class="operator">-</span>U dbuser <span class="operator">-</span>d exampledb <span class="operator">-</span>h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="operator">-</span>p <span class="number">5432</span>;</span><br></pre></td></tr></table></figure>

<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><p><a href="https://stackoverflow.com/questions/26277356/how-to-get-current-database-and-user-name-using-a-select-in-postgresql/26277430">https://stackoverflow.com/questions/26277356/how-to-get-current-database-and-user-name-using-a-select-in-postgresql/26277430</a></p>
<p>查看当前用户；</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<p>查看当前数据库</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> current_database();</span><br></pre></td></tr></table></figure>

<h2 id="pgcli"><a href="#pgcli" class="headerlink" title="pgcli"></a>pgcli</h2><p><a href="https://www.pgcli.com/config">https://www.pgcli.com/config</a></p>
<h2 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h2><p>在修改某个字段类型之前，最好删除这个字段的约束，<br>修改完后再把合适的约束添加上去。《PostgreSQL 修炼之道》p166</p>
<h2 id="插入或更新"><a href="#插入或更新" class="headerlink" title="插入或更新"></a>插入或更新</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> contacts <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;n1&#x27;</span>, <span class="string">&#x27;&#123;15200000000, 15200000001&#125;&#x27;</span>, <span class="string">&#x27;shenzhen&#x27;</span>) <span class="keyword">on</span> conflict (id) do <span class="keyword">UPDATE</span> <span class="keyword">set</span> phone <span class="operator">=</span> excluded.phone;</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://stackoverflow.com/questions/1109061/insert-on-duplicate-update-in-postgresql">https://stackoverflow.com/questions/1109061/insert-on-duplicate-update-in-postgresql</a></li>
<li><a href="https://stackoverflow.com/questions/39663280/how-to-do-insert-into-select-and-on-duplicate-update-in-postgresql-9-5">https://stackoverflow.com/questions/39663280/how-to-do-insert-into-select-and-on-duplicate-update-in-postgresql-9-5</a></li>
</ul>
<h2 id="插入数组"><a href="#插入数组" class="headerlink" title="插入数组"></a>插入数组</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">TABLE</span> contacts(</span><br><span class="line">        id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">        name <span class="type">varchar</span>(<span class="number">40</span>),</span><br><span class="line">        phone <span class="type">varchar</span>(<span class="number">32</span>)[],</span><br><span class="line">        address text);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> contacts <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;n1&#x27;</span>, <span class="string">&#x27;&#123;15200000000, 15200000001&#125;&#x27;</span>, <span class="string">&#x27;shenzhen&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><a href="https://stackoverflow.com/questions/33335338/inserting-array-values">https://stackoverflow.com/questions/33335338/inserting-array-values</a></p>
<h2 id="批量插入数据"><a href="#批量插入数据" class="headerlink" title="批量插入数据"></a>批量插入数据</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student(student_no <span class="type">int</span>, student_name <span class="type">varchar</span>(<span class="number">20</span>), age <span class="type">int</span>, class_no <span class="type">int</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">select</span> generate_series(<span class="number">1</span>,<span class="number">23</span>), concat(<span class="string">&#x27;s&#x27;</span>,generate_series(<span class="number">1</span>,<span class="number">23</span>)),<span class="number">18</span>,  <span class="number">1</span></span><br><span class="line"><span class="keyword">on</span> conflict (student_no) do <span class="keyword">update</span></span><br><span class="line"><span class="keyword">set</span> student_name<span class="operator">=</span>excluded.student_name,</span><br><span class="line">    age<span class="operator">=</span>excluded.age,</span><br><span class="line">    class_no<span class="operator">=</span>excluded.class_no;</span><br></pre></td></tr></table></figure>

<h2 id="修改默认的schema"><a href="#修改默认的schema" class="headerlink" title="修改默认的schema"></a>修改默认的<code>schema</code></h2><p><a href="https://stackoverflow.com/questions/2875610/permanently-set-postgresql-schema-path">https://stackoverflow.com/questions/2875610/permanently-set-postgresql-schema-path</a></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE lou <span class="keyword">SET</span> search_path <span class="keyword">TO</span> lou, osdba,postgres,public</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis集群</title>
    <url>/sql/redis-cluster/</url>
    <content><![CDATA[<h1 id="docker-搭建-redis-伪集群"><a href="#docker-搭建-redis-伪集群" class="headerlink" title="docker 搭建 redis 伪集群"></a>docker 搭建 redis 伪集群</h1><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://juejin.im/post/6844903809005649927">Docker Redis 5.0 集群（cluster）搭建 - 掘金</a></li>
<li><a href="https://www.cnblogs.com/mafly/p/redis_cluster.html">Redis 集群搭建详细指南 - Mafly - 博客园</a></li>
</ul>
<h2 id="创建网段"><a href="#创建网段" class="headerlink" title="创建网段"></a>创建网段</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker network create redis-net</span><br><span class="line">docker network <span class="built_in">ls</span></span><br><span class="line">docker inspect redis-net</span><br></pre></td></tr></table></figure>

<h2 id="模板配置-redis-cluster-tmpl"><a href="#模板配置-redis-cluster-tmpl" class="headerlink" title="模板配置 redis-cluster.tmpl"></a>模板配置 redis-cluster.tmpl</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">port <span class="variable">$&#123;PORT&#125;</span></span><br><span class="line">protected-mode no</span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.20.0.1</span><br><span class="line">cluster-announce-port <span class="variable">$&#123;PORT&#125;</span></span><br><span class="line">cluster-announce-bus-port 1<span class="variable">$&#123;PORT&#125;</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<h2 id="根据模板批量创建配置文件"><a href="#根据模板批量创建配置文件" class="headerlink" title="根据模板批量创建配置文件"></a>根据模板批量创建配置文件</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> `<span class="built_in">seq</span> 6000 6005`; <span class="keyword">do</span> \</span><br><span class="line">  <span class="built_in">mkdir</span> -p ./<span class="variable">$&#123;port&#125;</span>/conf \</span><br><span class="line">  &amp;&amp; PORT=<span class="variable">$&#123;port&#125;</span> envsubst &lt; ./redis-cluster.tmpl &gt; ./<span class="variable">$&#123;port&#125;</span>/conf/redis.conf \</span><br><span class="line">  &amp;&amp; <span class="built_in">mkdir</span> -p ./<span class="variable">$&#123;port&#125;</span>/data; \</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="批量运行-注意修改目录"><a href="#批量运行-注意修改目录" class="headerlink" title="批量运行(注意修改目录)"></a>批量运行(注意修改目录)</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> `<span class="built_in">seq</span> 6000 6005`; <span class="keyword">do</span> \</span><br><span class="line">docker run -d -ti -p <span class="variable">$&#123;port&#125;</span>:<span class="variable">$&#123;port&#125;</span> -p 1<span class="variable">$&#123;port&#125;</span>:1<span class="variable">$&#123;port&#125;</span> \</span><br><span class="line">-v /root/w/cluster/redis-cluster/<span class="variable">$&#123;port&#125;</span>/conf/redis.conf:/usr/local/etc/redis/redis.conf \</span><br><span class="line">-v /root/w/cluster/redis-cluster/<span class="variable">$&#123;port&#125;</span>/data:/data \</span><br><span class="line">--restart always --name redis-<span class="variable">$&#123;port&#125;</span> --net redis-net \</span><br><span class="line">--sysctl net.core.somaxconn=1024 redis:5.0.3 redis-server /usr/local/etc/redis/redis.conf; \</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="运行和查看"><a href="#运行和查看" class="headerlink" title="运行和查看"></a>运行和查看</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it redis-6000 bash</span><br><span class="line">redis-cli --cluster create 172.20.0.1:6000 172.20.0.1:6001 172.20.0.1:6002 172.20.0.1:6003 172.20.0.1:6004 172.20.0.1:6005 --cluster-replicas 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接客户端，查看主从信息</span></span><br><span class="line">redis-cli -c -p 6000</span><br><span class="line">redis&gt; keys *</span><br><span class="line">redis&gt; info replication</span><br></pre></td></tr></table></figure>

<h2 id="开放防火墙"><a href="#开放防火墙" class="headerlink" title="开放防火墙"></a>开放防火墙</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> `<span class="built_in">seq</span> 7000 7005`; <span class="keyword">do</span> \</span><br><span class="line">  firewall-cmd --zone=public --add-port=<span class="variable">$&#123;port&#125;</span>/tcp --permanent</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重新载入</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="停止和移除"><a href="#停止和移除" class="headerlink" title="停止和移除"></a>停止和移除</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 暂停容器并删除容器</span></span><br><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> `<span class="built_in">seq</span> 6000 6005`; <span class="keyword">do</span> \</span><br><span class="line">  docker stop redis-<span class="variable">$&#123;port&#125;</span>;</span><br><span class="line">  docker <span class="built_in">rm</span> redis-<span class="variable">$&#123;port&#125;</span>;</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis</title>
    <url>/sql/redis/</url>
    <content><![CDATA[<h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">sudo apt <span class="keyword">update</span></span><br><span class="line">sudo apt install redis-<span class="keyword">server</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04">How To Install and Secure Redis on Ubuntu 18.04 | DigitalOcean</a></li>
</ul>
<p><strong>安装时出现 Errors were encountered while processing: redis-server 的问题</strong></p>
<blockquote>
<p>You should probably alter the redis.conf file to force it to use IPv4 if it supports that mode only and then maybe you could run it without IPv6.<br><a href="https://unix.stackexchange.com/questions/351668/cannot-install-redis-server">apt - Cannot install redis server - Unix &amp; Linux Stack Exchange</a> &gt; <a href="https://unix.stackexchange.com/a/501785">https://unix.stackexchange.com/a/501785</a></p>
</blockquote>
<p><strong>单机安装 ubuntu</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">wget -v http://download.redis.io/releases/redis-5.0.5.tar.gz</span><br><span class="line">apt install build-essential tcl</span><br><span class="line"><span class="built_in">mkdir</span> /var/redis-standalone</span><br><span class="line">make install PREFIX=/var/redis-standalone MALLOC=libc</span><br><span class="line"><span class="built_in">cp</span> ./redis.conf /var/redis-standalone</span><br><span class="line"><span class="built_in">cd</span> /var/redis-standalone</span><br><span class="line">./bin/redis-server ./redis.conf</span><br></pre></td></tr></table></figure>

<p><strong>单机安装 centos</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum install wget -y</span><br><span class="line">wget https://download.redis.io/releases/redis-5.0.8.tar.gz</span><br><span class="line">tar -zxf redis-5.0.8.tar.gz</span><br><span class="line">yum install gcc -y</span><br><span class="line"><span class="built_in">cd</span> redis-5.0.8</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> /usr/local/bin/</span><br><span class="line"><span class="built_in">cp</span> ~/redis-5.0.8/redis.conf .</span><br><span class="line">redis-server redis.conf</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><p><a href="https://www.jianshu.com/p/88636a819802">Redis-主从复制与 Sentinel - 简书</a><br><img src="http://img.hb.aicdn.com/047fcbdf9c84f15fb0b2b28eb74a7409304c200418489-i4oOmX_fw658" alt="主从复制"></p>
</li>
<li><p><a href="https://stackoverflow.com/questions/4006324/how-to-atomically-delete-keys-matching-a-pattern-using-redis">How to atomically delete keys matching a pattern using Redis</a></p>
</li>
</ul>
<figure class="highlight dos"><table><tr><td class="code"><pre><span class="line">EVAL &quot;return redis.<span class="keyword">call</span>(&#x27;<span class="built_in">del</span>&#x27;, unpack(redis.<span class="keyword">call</span>(&#x27;keys&#x27;, ARGV[<span class="number">1</span>])))&quot; <span class="number">0</span> prefix:*</span><br></pre></td></tr></table></figure>

<h2 id="set-password"><a href="#set-password" class="headerlink" title="set password"></a>set password</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/redis/redis.conf</span><br><span class="line"><span class="comment"># find and uncomment line : # requirepass foobared</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># then restart server</span></span><br><span class="line">systemctl restart redis-server</span><br></pre></td></tr></table></figure>

<h2 id="redis-过期策略及定期策略配置-bobozai86-的博客-CSDN-博客-redis-过期策略-配置文件"><a href="#redis-过期策略及定期策略配置-bobozai86-的博客-CSDN-博客-redis-过期策略-配置文件" class="headerlink" title="redis 过期策略及定期策略配置_bobozai86 的博客-CSDN 博客_redis 过期策略 配置文件"></a><a href="https://blog.csdn.net/bobozai86/article/details/112299322">redis 过期策略及定期策略配置_bobozai86 的博客-CSDN 博客_redis 过期策略 配置文件</a></h2><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">redis 过期策略</span><br><span class="line">redis 过期策略是：定期删除+惰性删除。</span><br><span class="line">所谓定期删除，指的是 redis 默认是每隔 100ms 就随机抽取一些设置了过期时间的 key，检查其是否过期，如果过期就删除。</span><br><span class="line">假设 redis 里放了 10w 个 key，都设置了过期时间，你每隔几百毫秒，就检查 10w 个 key，那 redis 基本上就死了，cpu 负载会很高的，消耗在你的检查过期 key 上了。注意，这里可不是每隔 100ms 就遍历所有的设置过期时间的 key，那样就是一场性能上的灾难。实际上 redis 是每隔 100ms 随机抽取一些 key 来检查和删除的。</span><br><span class="line"></span><br><span class="line">但是问题是，定期删除可能会导致很多过期 key 到了时间并没有被删除掉，那咋整呢？所以就是惰性删除了。这就是说，在你获取某个 key 的时候，redis 会检查一下 ，这个 key 如果设置了过期时间那么是否过期了？如果过期了此时就会删除，不会给你返回任何东西。</span><br><span class="line">获取 key 的时候，如果此时 key 已经过期，就删除，不会返回任何东西。</span><br><span class="line">但是实际上这还是有问题的，如果定期删除漏掉了很多过期 key，然后你也没及时去查，也就没走惰性删除，此时会怎么样？如果大量过期 key 堆积在内存里，导致 redis 内存块耗尽了，咋整？</span><br><span class="line">答案是：走内存淘汰机制。</span><br><span class="line"></span><br><span class="line">内存淘汰机制</span><br><span class="line">redis 内存淘汰机制有以下几个：</span><br><span class="line">• noeviction: 当内存不足以容纳新写入数据时，新写入操作会报错，这个一般没人用吧，实在是太恶心了。</span><br><span class="line">• allkeys-lru：当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的 key（这个是最常用的）。</span><br><span class="line">• allkeys-random：当内存不足以容纳新写入数据时，在键空间中，随机移除某个 key，这个一般没人用吧，为啥要随机，肯定是把最近最少使用的 key 给干掉啊。</span><br><span class="line">• volatile-lru：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，移除最近最少使用的 key（这个一般不太合适）。</span><br><span class="line">• volatile-random：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，随机移除某个 key。</span><br><span class="line">• volatile-ttl：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，有更早过期时间的 key 优先移除。</span><br></pre></td></tr></table></figure>

<p><a href="https://help.aliyun.com/document_detail/142171.html">调整 Redis 定期任务的执行频率</a></p>
]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis面试题</title>
    <url>/sql/redis%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
    <content><![CDATA[<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><p><a href="https://support.huaweicloud.com/dcs_faq/dcs-faq-0805001.html">大Key/热Key分析/整库扫描_分布式缓存服务 DCS_常见问题_华为云</a></p>
<h1 id="备份策略"><a href="#备份策略" class="headerlink" title="备份策略"></a>备份策略</h1><h2 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h2><p>rdb：指定时间点上生成的数据集快照</p>
<p>优点：</p>
<ol>
<li>保存某个时间点上的数据；</li>
<li>文件紧凑，恢复快；方便传输</li>
<li>父进程不受 IO 影响，是从父进程中 fork 一份出来备份的；</li>
</ol>
<p>缺点：</p>
<ol>
<li>可能造成备份期间的数据丢失；</li>
<li>fork 过程可能比较耗时（数据集大时，消耗的 CPU 可能导致无法响应客户端）</li>
</ol>
<h2 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h2><p>aof：所有写操作命令（redis 协议），恢复时执行这些命令<br>优点：</p>
<ol>
<li>灵活配置 fsync 策略；1）无 fsync；2）每秒一次；3）每次写入都 fsync；（就算发生了故障也是 1 秒，性能也不错；fsync 在后台线程执行）</li>
<li>对 aof 日志文件只进行追加操作；</li>
<li>文件变大时，会进行重写；</li>
<li>以 redis 协议写入日志，易读和修复（flushall）</li>
</ol>
<p>缺点：</p>
<ol>
<li>相对 rdb，体积更大；</li>
<li>fsync 策略可能会比 rdb 慢</li>
<li>个别 bug</li>
</ol>
<p>总结：<br>如果想要非常高的安全性，可以结合 rdb 和 aof 同时使用；在重启的时候，会优先使用 aof 来恢复数据（aof 更完整）；</p>
<p>其他：<br>rdb: 默认存入到 dumb.rdb 文件中；<br>RDB 手动备份：<br>SAVE：阻塞主进程，此时客户端无法连接；<br>BGSAVE：fork 一个子线程，不阻塞主进程，客户端依然可以连接；完成后通知主进程，子进程退出；<br>可以设置多少秒内有多少变动时触发备份</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">#save &lt;seconds&gt; &lt;changes&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Will save the DB if both the given number of seconds and the given</span></span><br><span class="line"><span class="comment">#   number of write operations against the DB occurred.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   In the example below the behaviour will be to save:</span></span><br><span class="line"><span class="comment">#   after 900 sec (15 min) if at least 1 key changed</span></span><br><span class="line"><span class="comment">#   after 300 sec (5 min) if at least 10 keys changed</span></span><br><span class="line"><span class="comment">#   after 60 sec if at least 10000 keys changed</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   <span class="doctag">Note:</span> you can disable saving completely by commenting out all &quot;save&quot; lines.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   It is also possible to remove all the previously configured save</span></span><br><span class="line"><span class="comment">#   points by adding a save directive with a single empty string argument</span></span><br><span class="line"><span class="comment">#   like in the following example:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   save &quot;&quot;</span></span><br><span class="line"><span class="comment"># 时间窗口M和改动的键个数N，每当时间M内改动的键个数大于N时，则触发快照备份。</span></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure>

<p>AOF 重写：<br>bgrewrite 可以用来重写，重新生成一个文件，此文件只包含当前数据集需要的最少的指令（因为是 append 的方式 ，对同一个 key 进行操作也会追加多次指令）</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://blog.csdn.net/is_zhoufeng/article/details/10210353">redis 持久化与备份策略_is_zhoufeng 的专栏-CSDN 博客</a></li>
<li><a href="https://www.cnblogs.com/rayong/p/6791330.html">Redis Save 与 BGSAVE 的区别 - Ray 雷 - 博客园</a></li>
</ul>
]]></content>
      <tags>
        <tag>redis</tag>
        <tag>面试题</tag>
      </tags>
  </entry>
  <entry>
    <title>Sql设计</title>
    <url>/sql/sql%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<p>2019-05-28 16:52:57</p>
<h2 id="三范式"><a href="#三范式" class="headerlink" title="三范式"></a>三范式</h2><blockquote>
<p><a href="https://www.cnblogs.com/linjiqin/archive/2012/04/01/2428695.html">数据库设计三大范式 - Ruthless - 博客园</a></p>
</blockquote>
<ol>
<li>确保每列保持原子性（维度：单元格）<br>所有字段都是不可分解的原子值。如【地址】这个属性，如果要经常用到【城市】这个部分，那么要将【地址】分解成【省份】、【城市】、【详细地址】等多个字段存储。</li>
<li>确保表中的每列都和主键有关（维度：一行）<br>在第 1 条的基础上，确保数据库表中的每一列都和主键有关，而不是只与主键的某一部分相关（主要针对联合主键）。<br>如子订单表中的【子订单 ID】和【商品 ID】构成联合主键。在这个表中，“商品名称，单位，商品价格”等信息不与该联合主键有关，而只是与【商品 ID】有关，不应该存储这些字段。<br>如果需要这些字段，可以从商品表中获取</li>
<li>确保表中的每列都和主键列直接有关，而不是间接相关（维度：表）<br>在一个表中存储了，在另一个表中存储外键就可以了，不要再重复添加其他字段。<br>如在订单表中添加【客户 ID】即可，不要再添加客户名称、联系方式等（这些字段已经存在于客户表中）</li>
</ol>
<blockquote>
<p>范式是用来学习和参考的，设计的时候得具体问题具体对待。例如，在访问并发量大的情况下，也会采用反范式来设计提高数据库的响应能力。</p>
</blockquote>
<p><a href="https://www.cnblogs.com/liuxiaowei/p/7163537.html">浅谈 Mysql 表设计规范 - 刘小伟 - 博客园</a></p>
<h2 id="用-BTree-还是-HASH"><a href="#用-BTree-还是-HASH" class="headerlink" title="用 BTree 还是 HASH"></a>用 BTree 还是 HASH</h2><p><a href="https://www.cnblogs.com/bonelee/p/6224698.html">B+树索引和哈希索引的区别——我在想全文搜索引擎为啥不用 hash 索引而非得使用 B+呢？ - bonelee - 博客园</a><br><a href="https://blog.csdn.net/ochangwen/article/details/54024063">MySQL BTree 索引和 hash 索引的区别 - ChangWen 的博客 - CSDN 博客</a></p>
<p><strong>hash</strong>:hash 索引在 mysql 比较少用,他以把数据的索引以 hash 形式组织起来,因此当查找某一条记录的时候,速度非常快.<br>但是因为是 hash 结构,每个键只对应一个值,而且是散列的方式分布.所以他并不支持范围查找和排序等功能.</p>
<p><strong>B+树</strong>:b+tree 是 mysql 使用最频繁的一个索引数据结构,数据结构以平衡树的形式来组织,<br>因为是树型结构,所以更适合用来处理排序,范围查找等功能.相对 hash 索引,B+树在查找单条记录的速度虽然比不上 hash 索引,但是因为更适合排序等操作,所以他更受用户的欢迎.毕竟不可能只对数据库进行单条记录的操作.</p>
<ul>
<li><a href="https://blog.csdn.net/leyangjun/article/details/42461879">Mysql 主键索引、唯一索引、普通索引、全文索引、组合索引的区别 - 乐杨俊浅谈 LAMP - CSDN 博客</a></li>
</ul>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> 每列都为保持原子性（地址精确到省、城市）</span><br><span class="line"><span class="bullet">2.</span> 每列都和主键有关（主要针对复合主键）</span><br><span class="line"><span class="bullet">3.</span> 每列都和主键列直接相关</span><br></pre></td></tr></table></figure>

<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>Mysql 各种索引区别：<br>普通索引：最基本的索引，没有任何限制<br>唯一索引：与”普通索引”类似，不同的就是：索引列的值必须唯一，但允许有空值。<br>主键索引：它 是一种特殊的唯一索引，不允许有空值。<br>全文索引：仅可用于 MyISAM 表，针对较大的数据，生成全文索引很耗时好空间。<br>组合索引：为了更多的提高 mysql 效率可建立组合索引，遵循”最左前缀“原则。</p>
<ul>
<li><a href="https://blog.csdn.net/leyangjun/article/details/42461879">Mysql 主键索引、唯一索引、普通索引、全文索引、组合索引的区别 - 乐杨俊浅谈 LAMP - CSDN 博客</a></li>
</ul>
<h2 id="分表处理的实现方法"><a href="#分表处理的实现方法" class="headerlink" title="分表处理的实现方法"></a>分表处理的实现方法</h2><ul>
<li><a href="https://blog.csdn.net/rongwenbin/article/details/40341965">MySQL 分表处理的实现方法(按月份分的表) - rongwenbin 的专栏 - CSDN 博客</a></li>
<li><a href="https://raising.iteye.com/blog/2294673">数据量大的表的分表方案 以及 跨（同类型的）表查询遇上分组时需要注意的点 - Try My Best 尽力而为 - ITeye 博客</a></li>
<li><a href="http://database.51cto.com/art/201809/583857.htm">MySQL 分库分表，写得太好了！ - 51CTO.COM</a></li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查找</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `money_histories` <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">20022253</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `money_histories_201905` <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">20022253</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `money_histories_201906` <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">20022253</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://www.cnblogs.com/joylee/p/7513038.html">学会数据库读写分离、分表分库——用Mycat，这一篇就够了！ - IT米粉 - 博客园</a></li>
<li><a href="http://www.mycat.io/">| MYCAT官方网站—开源分布式数据库中间件</a><br><a href="http://www.mycat.io/document/Mycat_V1.6.0.pdf">http://www.mycat.io/document/Mycat_V1.6.0.pdf</a></li>
</ul>
]]></content>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>Sql常见操作</title>
    <url>/sql/sql%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h2 id="拼接字符串"><a href="#拼接字符串" class="headerlink" title="拼接字符串"></a>拼接字符串</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 语法：CONCAT(str1,str2,…)</span></span><br><span class="line"><span class="comment">-- 返回结果为连接参数产生的字符串。</span></span><br><span class="line"><span class="keyword">select</span> concat(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line"><span class="comment">-- 如有任何一个参数为NULL ，则返回值为 NULL。</span></span><br><span class="line"><span class="keyword">select</span> concat(<span class="string">&#x27;a&#x27;</span>,<span class="keyword">null</span>,<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 语法：CONCAT_WS(separator,str1,str2,…)</span></span><br><span class="line"><span class="comment">-- CONCAT_WS，表示 CONCAT With Separator</span></span><br><span class="line"><span class="comment">-- 如果分隔符为 NULL，则结果为 NULL。</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT_WS(<span class="keyword">null</span>,<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"><span class="comment">-- 函数会忽略任何分隔符参数后的 NULL 值。这是和MySQL中concat函数不同的地方、concat_ws函数在执行的时候，不会因为NULL值而返回NULL。（这点很重要）</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT_WS(<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;First name&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;Last Name&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>GROUP_CONCAT 只有一列时如何拼接</strong></p>
<blockquote>
<p>完整的语法如下：group_concat([DISTINCT] 要连接的字段 [Order BY ASC/DESC 排序字段] [Separator ‘分隔符’])（分隔符默认逗号）</p>
</blockquote>
<p>示例<br><img src="http://cdn.lyloou.com/img/sql%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C-2021-08-25-10-49-37.png" alt="sql常见操作-2021-08-25-10-49-37"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span>, GROUP_CONCAT(id SEPARATOR <span class="string">&#x27;,&#x27;</span>) ids <span class="keyword">FROM</span> `<span class="keyword">user</span>` <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span>, GROUP_CONCAT(id <span class="keyword">ORDER</span> <span class="keyword">BY</span> id <span class="keyword">desc</span> SEPARATOR <span class="string">&#x27;,&#x27;</span>)ids <span class="keyword">FROM</span> `<span class="keyword">user</span>` <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><img src="http://cdn.lyloou.com/img/sql%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C-2021-08-25-10-50-11.png" alt="sql常见操作-2021-08-25-10-50-11"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 获取某列的组合</span></span><br><span class="line"><span class="keyword">SELECT</span> GROUP_CONCAT(id <span class="keyword">ORDER</span> <span class="keyword">BY</span> id <span class="keyword">desc</span> SEPARATOR <span class="string">&#x27;,&#x27;</span>)ids <span class="keyword">FROM</span> `<span class="keyword">user</span>` <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> GROUP_CONCAT(<span class="keyword">DISTINCT</span> nickname  <span class="keyword">ORDER</span> <span class="keyword">BY</span> nickname  <span class="keyword">desc</span>  SEPARATOR <span class="string">&#x27;,&#x27;</span>)nickname <span class="keyword">FROM</span> `<span class="keyword">user</span>` <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="string">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="http://cdn.lyloou.com/img/sql%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C-2021-08-25-10-56-01.png" alt="sql常见操作-2021-08-25-10-56-01"><br><img src="http://cdn.lyloou.com/img/sql%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C-2021-08-25-10-58-34.png" alt="sql常见操作-2021-08-25-10-58-34"></p>
<ul>
<li><a href="https://www.cnblogs.com/zhming26/p/6382995.html">mysql 中 concat 和 group_concat()的用法 - zhming - 博客园</a></li>
<li><a href="https://www.cnblogs.com/goloving/p/7576440.html">模糊搜索：concat 各种函数详解、like 操作符、通配符 - 古兰精 - 博客园</a></li>
</ul>
<h2 id="字符串拆分"><a href="#字符串拆分" class="headerlink" title="字符串拆分"></a>字符串拆分</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">SUBSTRING_INDEX(SUBSTRING_INDEX(<span class="string">&#x27;7654,7698,7782,7788&#x27;</span>,<span class="string">&#x27;,&#x27;</span>,help_topic_id<span class="operator">+</span><span class="number">1</span>),<span class="string">&#x27;,&#x27;</span>,<span class="number">-1</span>) <span class="keyword">AS</span> num</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">mysql.help_topic</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">help_topic_id <span class="operator">&lt;</span> LENGTH(<span class="string">&#x27;7654,7698,7782,7788&#x27;</span>)<span class="operator">-</span>LENGTH(REPLACE(<span class="string">&#x27;7654,7698,7782,7788&#x27;</span>,<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;&#x27;</span>))<span class="operator">+</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.shuzhiduo.com/A/x9J2vlNWJ6/">mysql 字符串拆分实现 split 功能</a><br><a href="https://blog.csdn.net/pjymyself/article/details/81668157">MySQL——字符串拆分（含分隔符的字符串截取）_逗比的小博客-CSDN 博客_mysql 字符串分割</a></p>
<h2 id="查询某个字段的值出现多于-1-次的"><a href="#查询某个字段的值出现多于-1-次的" class="headerlink" title="查询某个字段的值出现多于 1 次的"></a>查询某个字段的值出现多于 1 次的</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,flow_id, <span class="built_in">COUNT</span>(flow_id) <span class="keyword">FROM</span> orders <span class="keyword">GROUP</span> <span class="keyword">BY</span> flow_id <span class="keyword">HAVING</span> <span class="built_in">count</span>(flow_id)<span class="operator">&gt;</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="是否为空"><a href="#是否为空" class="headerlink" title="是否为空"></a>是否为空</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product <span class="keyword">where</span> weight <span class="keyword">is</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>

<h2 id="获取最大值-最小值"><a href="#获取最大值-最小值" class="headerlink" title="获取最大值/最小值"></a>获取最大值/最小值</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 最小值</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(column_name) <span class="keyword">from</span> table_name;</span><br><span class="line"><span class="keyword">select</span> num <span class="keyword">from</span> table_name <span class="keyword">order</span> <span class="keyword">by</span> num;</span><br><span class="line"></span><br><span class="line"># 最大值</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(column_name) <span class="keyword">from</span> table_name;</span><br><span class="line"><span class="keyword">select</span> num <span class="keyword">from</span> table_name <span class="keyword">order</span> <span class="keyword">by</span> num <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"># 获取最大值所在行</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> orders</span><br><span class="line"><span class="keyword">WHERE</span> final_amount <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(final_amount)</span><br><span class="line">					   <span class="keyword">FROM</span> orders);</span><br></pre></td></tr></table></figure>

<p>参考资料</p>
<ul>
<li><a href="http://www.111cn.net/database/mssqlserver/42437.htm">sql 中 max()和 min()取最大值和最小值语句</a></li>
</ul>
<h2 id="判断记录是否存在-不存在则插入存在则更新的场景"><a href="#判断记录是否存在-不存在则插入存在则更新的场景" class="headerlink" title="判断记录是否存在,不存在则插入存在则更新的场景"></a><a href="https://my.oschina.net/iceman/blog/53735">判断记录是否存在,不存在则插入存在则更新的场景</a></h2><p>创建表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `clients2` (</span><br><span class="line">  `client_id` <span class="type">int</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `client_name` <span class="type">varchar</span>(<span class="number">25</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `client_type` <span class="type">int</span>(<span class="number">8</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`client_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">6</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8</span><br></pre></td></tr></table></figure>

<p>不存在则插入存在则更新的场景</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 如果表中不存在则插入指定值，如果存在则给`client_type`增加<span class="number">1</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> clients (clients.`client_id`, clients.`client_name`, clients.`client_type`) <span class="keyword">VALUES</span> (<span class="number">1</span>, &quot;Lou12&quot;, <span class="number">3</span>) <span class="keyword">ON</span> DUPLICATE KEY <span class="keyword">UPDATE</span> clients.`client_type`<span class="operator">=</span>clients.`client_type`<span class="operator">+</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><a href="https://dev.mysql.com/doc/refman/8.0/en/insert-on-duplicate.html">https://dev.mysql.com/doc/refman/8.0/en/insert-on-duplicate.html</a></p>
<h2 id="插入或更新时的-NULL-字段处理"><a href="#插入或更新时的-NULL-字段处理" class="headerlink" title="插入或更新时的 NULL 字段处理"></a>插入或更新时的 NULL 字段处理</h2><p>想法来自【小白】</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 如果待插入的数据不为<span class="keyword">NULL</span>，则改变原来的为新值</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@title</span> <span class="operator">=</span> <span class="string">&#x27;新标题234&#x27;</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> goods (goods_id,title) <span class="keyword">VALUES</span> (<span class="number">9934</span>,IFNULL(<span class="variable">@title</span>,<span class="string">&#x27;&#x27;</span>)) <span class="keyword">ON</span> DUPLICATE KEY <span class="keyword">UPDATE</span> title<span class="operator">=</span>IF(<span class="keyword">VALUES</span>(title)<span class="operator">=</span><span class="string">&#x27;&#x27;</span>,title,<span class="keyword">VALUES</span>(title));</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> goods <span class="keyword">WHERE</span> goods_id  <span class="operator">=</span><span class="number">9934</span>;</span><br><span class="line"></span><br><span class="line"># 如果待插入的数据为<span class="keyword">NULL</span>，则不改变原来的</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@title</span> <span class="operator">=</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> goods (goods_id,title) <span class="keyword">VALUES</span> (<span class="number">9934</span>,IFNULL(<span class="variable">@title</span>,<span class="string">&#x27;&#x27;</span>)) <span class="keyword">ON</span> DUPLICATE KEY <span class="keyword">UPDATE</span> title<span class="operator">=</span>IF(<span class="keyword">VALUES</span>(title)<span class="operator">=</span><span class="string">&#x27;&#x27;</span>,title,<span class="keyword">VALUES</span>(title));</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> goods <span class="keyword">WHERE</span> goods_id  <span class="operator">=</span><span class="number">9934</span>;</span><br></pre></td></tr></table></figure>

<h2 id="和-0-做比较避免出现负值"><a href="#和-0-做比较避免出现负值" class="headerlink" title="和 0 做比较避免出现负值"></a>和 0 做比较避免出现负值</h2><p><a href="https://bbs.csdn.net/topics/392371054">https://bbs.csdn.net/topics/392371054</a></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 和0做比较避免出现负值</span></span><br><span class="line"><span class="keyword">update</span> products <span class="keyword">set</span> stocks<span class="operator">=</span>greatest(stocks<span class="number">-10</span>,<span class="number">0</span>) <span class="keyword">where</span> product_id<span class="operator">=</span><span class="number">55635</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> goods <span class="keyword">AS</span> g <span class="keyword">SET</span> stock <span class="operator">=</span> greatest((<span class="keyword">SELECT</span> <span class="built_in">SUM</span>(stocks) <span class="keyword">FROM</span> products <span class="keyword">AS</span> p <span class="keyword">WHERE</span> p.`goods_id` <span class="operator">=</span> g.`goods_id`), <span class="number">0</span>) <span class="keyword">WHERE</span>  goods_id<span class="operator">=</span><span class="number">1234</span></span><br></pre></td></tr></table></figure>

<h2 id="没有时插入或存在时忽略"><a href="#没有时插入或存在时忽略" class="headerlink" title="没有时插入或存在时忽略"></a>没有时插入或存在时忽略</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> IGNORE <span class="keyword">INTO</span> task_link (user_id, task_id) <span class="keyword">VALUES</span> (<span class="number">20021413</span>, <span class="number">50000</span>)</span><br></pre></td></tr></table></figure>

<h2 id="duplicate-entry-for-key"><a href="#duplicate-entry-for-key" class="headerlink" title="duplicate entry for key"></a>duplicate entry for key</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> GROUP_CONCAT(id),user_id,task_id,<span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">as</span> cnt <span class="keyword">FROM</span> task_link <span class="keyword">group</span> <span class="keyword">by</span> user_id,task_id <span class="keyword">having</span> cnt <span class="operator">&gt;</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> task_link <span class="keyword">where</span> id <span class="keyword">in</span> (<span class="number">100</span>,<span class="number">137</span>,<span class="number">131</span>,<span class="number">138</span>,<span class="number">136</span>,<span class="number">125</span>,<span class="number">124</span>);</span><br></pre></td></tr></table></figure>

<h2 id="依据两个字段来更新或插入表的其他字段"><a href="#依据两个字段来更新或插入表的其他字段" class="headerlink" title="依据两个字段来更新或插入表的其他字段"></a>依据两个字段来更新或插入表的其他字段</h2><ol>
<li><p>要先为这两个字段添加一个组合的唯一索引；<br><img src="https://github.com/lyloou/img/raw/develop/z/20190708173423.png"></p>
</li>
<li><p>使用语句来更新或插入</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> task_bonus_user (user_id,task_id,task_bonus_id) <span class="keyword">values</span> (?,?,?)</span><br><span class="line">             <span class="keyword">on</span> duplicate key <span class="keyword">update</span> task_bonus_id <span class="operator">=</span> <span class="keyword">values</span>(task_bonus_id)</span><br></pre></td></tr></table></figure>

<h2 id="去除小数点和后面的-0"><a href="#去除小数点和后面的-0" class="headerlink" title="去除小数点和后面的 0"></a>去除小数点和后面的 0</h2><p><a href="https://blog.csdn.net/strggle_bin/article/details/78135071">MySQL 去掉字符串前后或中间的某一字符串_strggle_bin 的博客-CSDN 博客_mysql 去掉前两个字符</a></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> cc_brief_video_author <span class="keyword">SET</span> user_id <span class="operator">=</span> <span class="built_in">TRIM</span>(<span class="keyword">TRAILING</span> <span class="string">&#x27;.0&#x27;</span> <span class="keyword">from</span> user_id)</span><br></pre></td></tr></table></figure>

<h2 id="删除重复的关键词"><a href="#删除重复的关键词" class="headerlink" title="删除重复的关键词"></a>删除重复的关键词</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">from</span> cc_brief_keyword_v2 <span class="keyword">WHERE</span> id <span class="keyword">not</span> <span class="keyword">in</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="built_in">min</span>(id) <span class="keyword">FROM</span> cc_brief_keyword_v2 <span class="keyword">GROUP</span> <span class="keyword">BY</span> keyword <span class="keyword">HAVING</span> <span class="built_in">count</span>(keyword) <span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">and</span></span><br><span class="line">keyword <span class="keyword">in</span> (</span><br><span class="line"> <span class="keyword">SELECT</span> keyword <span class="keyword">FROM</span> cc_brief_keyword_v2 <span class="keyword">GROUP</span> <span class="keyword">BY</span> keyword <span class="keyword">HAVING</span> <span class="built_in">count</span>(keyword) <span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="数据库备份"><a href="#数据库备份" class="headerlink" title="数据库备份"></a>数据库备份</h2><p>如果是记录表，且不对外提供查询操作可以这样处理。</p>
<p>快速备份的方案，具体操作如下：</p>
<ol>
<li><p>创建一个和 order_info 一样的新表（表结构、索引）。<br> – 执行 DDL 语句<br> create table order_info_new like order_info;</p>
</li>
<li><p>修改 order_info 的表名为 order_info_20220101，用日期做后缀方便以后查询<br> – 执行 DDL 语句<br> alter table order_info rename to order_info_20220101;</p>
</li>
<li><p>修改 order_info_new 为 order_info。<br> – 执行 DDL 语句<br> alter table order_info_new rename to order_info;</p>
</li>
</ol>
<h2 id="获取表结构"><a href="#获取表结构" class="headerlink" title="获取表结构"></a>获取表结构</h2><p><a href="https://blog.csdn.net/zhezhebie/article/details/108258387">mysql 获取所有的表结构及备注_阳水平的博客-CSDN 博客_mysql 获取表备注</a></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 获取所有表信息</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    information_schema.`TABLES`</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    TABLE_SCHEMA <span class="operator">=</span> (<span class="keyword">select</span> database())</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 获取所有表名和备注</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    TABLE_NAME 表名,</span><br><span class="line">    TABLE_COMMENT 备注</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    information_schema.`TABLES`</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    TABLE_SCHEMA <span class="operator">=</span> (<span class="keyword">select</span> database())</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 获取所有的表结构及备注</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    TABLE_SCHEMA <span class="keyword">AS</span> <span class="string">&#x27;库名&#x27;</span>,</span><br><span class="line">    TABLE_NAME <span class="keyword">AS</span> <span class="string">&#x27;表名&#x27;</span>,</span><br><span class="line">    COLUMN_NAME <span class="keyword">AS</span> <span class="string">&#x27;列名&#x27;</span>,</span><br><span class="line">    ORDINAL_POSITION <span class="keyword">AS</span> <span class="string">&#x27;列的排列顺序&#x27;</span>,</span><br><span class="line">    COLUMN_DEFAULT <span class="keyword">AS</span> <span class="string">&#x27;默认值&#x27;</span>,</span><br><span class="line">    IS_NULLABLE <span class="keyword">AS</span> <span class="string">&#x27;是否为空&#x27;</span>,</span><br><span class="line">    DATA_TYPE <span class="keyword">AS</span> <span class="string">&#x27;数据类型&#x27;</span>,</span><br><span class="line">    CHARACTER_MAXIMUM_LENGTH <span class="keyword">AS</span> <span class="string">&#x27;字符最大长度&#x27;</span>,</span><br><span class="line">    NUMERIC_PRECISION <span class="keyword">AS</span> <span class="string">&#x27;数值精度(最大位数)&#x27;</span>,</span><br><span class="line">    NUMERIC_SCALE <span class="keyword">AS</span> <span class="string">&#x27;小数精度&#x27;</span>,</span><br><span class="line">    COLUMN_TYPE <span class="keyword">AS</span> <span class="string">&#x27;列类型&#x27;</span>,</span><br><span class="line">    COLUMN_KEY <span class="string">&#x27;KEY&#x27;</span>,</span><br><span class="line">    EXTRA <span class="keyword">AS</span> <span class="string">&#x27;额外说明&#x27;</span>,</span><br><span class="line">    COLUMN_COMMENT <span class="keyword">AS</span> <span class="string">&#x27;注释&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    information_schema.`COLUMNS`</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    TABLE_SCHEMA <span class="operator">=</span> (<span class="keyword">select</span> database())</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    TABLE_NAME,</span><br><span class="line">    ORDINAL_POSITION;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>主从复制和读写分离</title>
    <url>/sql/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%92%8C%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/</url>
    <content><![CDATA[<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>环境介绍</p>
<table>
<thead>
<tr>
<th>环境&amp;软件</th>
<th>版本</th>
</tr>
</thead>
<tbody><tr>
<td>虚拟机 virtualbox</td>
<td>6.1</td>
</tr>
<tr>
<td>服务器 ubuntu</td>
<td>18.04</td>
</tr>
<tr>
<td>数据库 mysql</td>
<td>5.7.32</td>
</tr>
</tbody></table>
<p>服务架构图</p>
<table>
<thead>
<tr>
<th>机器名称</th>
<th>IP</th>
<th>角色</th>
<th>权限和作用</th>
</tr>
</thead>
<tbody><tr>
<td>master1</td>
<td>192.168.56.15</td>
<td>数据库 master</td>
<td>可读写、主库</td>
</tr>
<tr>
<td>slave1</td>
<td>192.168.56.16</td>
<td>数据库 Slave</td>
<td>只读、从库</td>
</tr>
<tr>
<td>slave2</td>
<td>192.168.56.17</td>
<td>数据库 Slave</td>
<td>只读、从库</td>
</tr>
<tr>
<td>master2</td>
<td>192.168.56.25</td>
<td>数据库 master</td>
<td>可读写、主库</td>
</tr>
<tr>
<td>slave3</td>
<td>192.168.56.26</td>
<td>数据库 Slave</td>
<td>只读、从库</td>
</tr>
<tr>
<td>slave4</td>
<td>192.168.56.27</td>
<td>数据库 Slave</td>
<td>只读、从库</td>
</tr>
</tbody></table>
<h2 id="bin-log-配置-amp-relay-log-配置"><a href="#bin-log-配置-amp-relay-log-配置" class="headerlink" title="bin_log 配置 &amp; relay_log 配置"></a>bin_log 配置 &amp; relay_log 配置</h2><p>vi /etc/mysql/mysql.conf.d/mysqld.cnf</p>
<h2 id="修改-uuid"><a href="#修改-uuid" class="headerlink" title="修改 uuid"></a>修改 uuid</h2><p>show variables like ‘%server_uuid%’;</p>
<p>通过 <code>select @@datadir</code> 找到 msyql 的数据目录在哪，在这个目录下会有一个 auto.cnf 的文件，修改里面的内容，然后重启即可解决。<br>vi /var/lib/mysql/auto.cnf<br>service mysql restart</p>
<h2 id="开启同步配置"><a href="#开启同步配置" class="headerlink" title="开启同步配置"></a>开启同步配置</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 在master上运行，记录下file名称和position</span></span><br><span class="line"><span class="keyword">show</span> master status;</span><br><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;192.168.56.15&#x27;</span>,master_port<span class="operator">=</span><span class="number">3306</span>,master_user<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>,master_password<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>,master_log_file<span class="operator">=</span><span class="string">&#x27;mysql-bin.000018&#x27;</span>,master_log_pos<span class="operator">=</span><span class="number">1731</span>;</span><br><span class="line"></span><br><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;192.168.56.25&#x27;</span>,master_port<span class="operator">=</span><span class="number">3306</span>,master_user<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>,master_password<span class="operator">=</span><span class="string">&#x27;root&#x27;</span>,master_log_file<span class="operator">=</span><span class="string">&#x27;mysql-bin.000024&#x27;</span>,master_log_pos<span class="operator">=</span><span class="number">154</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">start</span> slave; <span class="comment">-- 开启从模式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> slave status; <span class="comment">-- 查看slave状态</span></span><br><span class="line">stop slave; <span class="comment">-- 关闭从模式</span></span><br></pre></td></tr></table></figure>

<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><pre><code>https://gitee.com/lagouedu/alltestfile/raw/master/MySQL/MySQL%E4%B8%8B%E4%BD%9C%E4%B8%9A.pdf

作业资料说明：
1、提供资料：说明文档，代码，验证及讲解视频。
2、讲解内容包含：题目分析、实现思路、环境介绍。
3、说明文档包含：
l  环境介绍涉及的各个软件的版本
l  介绍各个机器对应角色&amp;作用&amp;ip地址

4、效果视频验证：
l  集群环境
* 6台
* 主master1负责写，从slave1 slave2负责读
* 主master2负责写，从slave3 slave4负责读

l  代码
* 主要类&amp;方法&amp;参数&amp;返回值及代码行标注注释
* 基于user_id对c_order表进⾏数据分⽚
* 基于master1和master2主从集群实现读写分离

l  运行效果
* 项目各个类作用介绍，重点代码进行介绍，启动
* 演示基于user_id对c_order表进⾏数据分⽚，基于master1和master2主从集群实现读写分离
* 添加数据，通过Navicat展示数据分片成功，通过代码控制台真实sql展示数据分别在master1和master2进行写入
* 查询数据，通过代码控制台真实sql展示数据是通过4个从节点查询的
</code></pre>
<h2 id="验证资料"><a href="#验证资料" class="headerlink" title="验证资料"></a>验证资料</h2><p><a href="../%E9%AA%8C%E8%AF%81%E8%B5%84%E6%96%99/Readme.md">作业讲解视频地址</a></p>
<h2 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h2><p>环境介绍<br>|环境&amp;软件| 版本|<br>|—|—|<br>|虚拟机 virtualbox|6.1|<br>|服务器 ubuntu | 18.04|<br>|数据库 mysql | 5.7.32|</p>
<p>服务架构图</p>
<table>
<thead>
<tr>
<th>机器名称</th>
<th>IP</th>
<th>角色</th>
<th>权限和作用</th>
</tr>
</thead>
<tbody><tr>
<td>master1</td>
<td>192.168.56.15</td>
<td>数据库 master</td>
<td>可读写、主库</td>
</tr>
<tr>
<td>slave1</td>
<td>192.168.56.16</td>
<td>数据库 Slave</td>
<td>只读、从库</td>
</tr>
<tr>
<td>slave2</td>
<td>192.168.56.17</td>
<td>数据库 Slave</td>
<td>只读、从库</td>
</tr>
<tr>
<td>master2</td>
<td>192.168.56.25</td>
<td>数据库 master</td>
<td>可读写、主库</td>
</tr>
<tr>
<td>slave3</td>
<td>192.168.56.26</td>
<td>数据库 Slave</td>
<td>只读、从库</td>
</tr>
<tr>
<td>slave4</td>
<td>192.168.56.27</td>
<td>数据库 Slave</td>
<td>只读、从库</td>
</tr>
</tbody></table>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p><strong>pom</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lyloou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>practice-mysql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>practice-mysql<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>11<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- c_order_0 c_order_1</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `c_order_0` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `is_del` bit(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> b<span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;是否被删除&#x27;</span>,</span><br><span class="line">  `user_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">  `company_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;公司id&#x27;</span>,</span><br><span class="line">  `publish_user_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;B端⽤户id&#x27;</span>,</span><br><span class="line">  `position_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;职位ID&#x27;</span>,</span><br><span class="line">  `resume_type` <span class="type">int</span>(<span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;简历类型：0附件 1在线&#x27;</span>,</span><br><span class="line">  `status` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;投递状态投递状态WAIT-待处理理 AUTO_FILTER-⾃自动过滤 PREPARE_CONTACT-待沟通 REFUSE-拒绝ARRANGE_INTERVIEW-通知⾯面试&#x27;</span>,</span><br><span class="line">  `create_time` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `update_time` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;处理理时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `index_userId_positionId` (`user_id`,`position_id`),</span><br><span class="line">  KEY `idx_userId_operateTime` (`user_id`,`update_time`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">551043954997460994</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>

<p><strong>sharding jdbc 配置</strong></p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 显示sql语句</span></span><br><span class="line"><span class="attr">spring.shardingsphere.props.sql.show</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#数据源</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.names</span>=master1,slave1,slave2,master2,slave3,slave4</span><br><span class="line"></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master1.type</span>=com.zaxxer.hikari.HikariDataSource</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master1.driver-class-name</span>=com.mysql.cj.jdbc.Driver</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master1.jdbc-url</span>=jdbc:mysql://<span class="number">192.168</span>.<span class="number">56.15</span>:<span class="number">3306</span>/lagou?useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf-<span class="number">8</span>&amp;useSSL=<span class="literal">false</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master1.username</span>=root</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master1.password</span>=root</span><br><span class="line"></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave1.type</span>=com.zaxxer.hikari.HikariDataSource</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave1.driver-class-name</span>=com.mysql.cj.jdbc.Driver</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave1.jdbc-url</span>=jdbc:mysql://<span class="number">192.168</span>.<span class="number">56.16</span>:<span class="number">3306</span>/lagou?useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf-<span class="number">8</span>&amp;useSSL=<span class="literal">false</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave1.username</span>=root</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave1.password</span>=root</span><br><span class="line"></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave2.type</span>=com.zaxxer.hikari.HikariDataSource</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave2.driver-class-name</span>=com.mysql.cj.jdbc.Driver</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave2.jdbc-url</span>=jdbc:mysql://<span class="number">192.168</span>.<span class="number">56.17</span>:<span class="number">3306</span>/lagou?useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf-<span class="number">8</span>&amp;useSSL=<span class="literal">false</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave2.username</span>=root</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave2.password</span>=root</span><br><span class="line"></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master2.type</span>=com.zaxxer.hikari.HikariDataSource</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master2.driver-class-name</span>=com.mysql.cj.jdbc.Driver</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master2.jdbc-url</span>=jdbc:mysql://<span class="number">192.168</span>.<span class="number">56.25</span>:<span class="number">3306</span>/lagou?useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf-<span class="number">8</span>&amp;useSSL=<span class="literal">false</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master2.username</span>=root</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.master2.password</span>=root</span><br><span class="line"></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave3.type</span>=com.zaxxer.hikari.HikariDataSource</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave3.driver-class-name</span>=com.mysql.cj.jdbc.Driver</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave3.jdbc-url</span>=jdbc:mysql://<span class="number">192.168</span>.<span class="number">56.26</span>:<span class="number">3306</span>/lagou?useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf-<span class="number">8</span>&amp;useSSL=<span class="literal">false</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave3.username</span>=root</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave3.password</span>=root</span><br><span class="line"></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave4.type</span>=com.zaxxer.hikari.HikariDataSource</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave4.driver-class-name</span>=com.mysql.cj.jdbc.Driver</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave4.jdbc-url</span>=jdbc:mysql://<span class="number">192.168</span>.<span class="number">56.27</span>:<span class="number">3306</span>/lagou?useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf-<span class="number">8</span>&amp;useSSL=<span class="literal">false</span></span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave4.username</span>=root</span><br><span class="line"><span class="attr">spring.shardingsphere.datasource.slave4.password</span>=root</span><br><span class="line"></span><br><span class="line"><span class="comment">#分库分表</span></span><br><span class="line"><span class="attr">spring.shardingsphere.sharding.tables.c_order.database-strategy.inline.sharding-column</span>=company_id</span><br><span class="line"><span class="attr">spring.shardingsphere.sharding.tables.c_order.database-strategy.inline.algorithm-expression</span>=master$-&gt;&#123;company_id%<span class="number">2</span> + <span class="number">1</span>&#125;</span><br><span class="line"><span class="attr">spring.shardingsphere.sharding.tables.c_order.actual-data-nodes</span>=master$-&gt;&#123;<span class="number">1</span>..<span class="number">2</span>&#125;.c_order_$-&gt;&#123;<span class="number">0</span>..<span class="number">1</span>&#125;</span><br><span class="line"><span class="attr">spring.shardingsphere.sharding.tables.c_order.table-strategy.inline.sharding-column</span>=user_id</span><br><span class="line"><span class="attr">spring.shardingsphere.sharding.tables.c_order.table-strategy.inline.algorithm-expression</span>=c_order_$-&gt;&#123;user_id % <span class="number">2</span>&#125;</span><br><span class="line"><span class="attr">spring.shardingsphere.sharding.tables.c_order.key-generator.column</span>=id</span><br><span class="line"><span class="attr">spring.shardingsphere.sharding.tables.c_order.key-generator.type</span>=SNOWFLAKE</span><br><span class="line"></span><br><span class="line"><span class="comment">#读写分离</span></span><br><span class="line"><span class="attr">spring.shardingsphere.sharding.master-slave-rules.master1.master-data-source-name</span>=master1</span><br><span class="line"><span class="attr">spring.shardingsphere.sharding.master-slave-rules.master1.slave-data-source-names</span>=slave1, slave2</span><br><span class="line"><span class="attr">spring.shardingsphere.sharding.master-slave-rules.master2.master-data-source-name</span>=master2</span><br><span class="line"><span class="attr">spring.shardingsphere.sharding.master-slave-rules.master2.slave-data-source-names</span>=slave3, slave4</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong><br>测试添加</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Repeat(value = 100)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAdd</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">companyId</span> <span class="operator">=</span> random.nextInt(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">userId</span> <span class="operator">=</span> random.nextInt(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Date</span> <span class="variable">now</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">COrder</span> <span class="variable">cOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">COrder</span>();</span><br><span class="line">    cOrder.setIsDel(<span class="literal">false</span>);</span><br><span class="line">    cOrder.setUserId(userId);</span><br><span class="line">    cOrder.setCompanyId(companyId);</span><br><span class="line">    cOrder.setPublishUserId(<span class="number">10</span>);</span><br><span class="line">    cOrder.setPositionId(<span class="number">100</span>);</span><br><span class="line">    cOrder.setResumeType(userId % <span class="number">2</span>);</span><br><span class="line">    cOrder.setStatus(<span class="string">&quot;AUTO_FILTER&quot;</span>);</span><br><span class="line">    cOrder.setCreateTime(now);</span><br><span class="line">    cOrder.setUpdateTime(now);</span><br><span class="line">    cOrderRepository.save(cOrder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20201230150829936.png" alt="image-20201230150829936"></p>
<p>测试查询</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFind</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> List&lt;COrder&gt; allByUserId = cOrderRepository.findAllByUserId(<span class="number">24</span>);</span><br><span class="line">    System.out.println(allByUserId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20201230151141903.png" alt="image-20201230151141903"></p>
]]></content>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>【Sql】常见问题列表</title>
    <url>/sql/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h2><p>解决思路就是：避免同时操作数据；</p>
<ul>
<li><a href="https://www.cnblogs.com/zejin2008/p/5262751.html">Mysql 并发时经典常见的死锁原因及解决方法 - 泽锦 - 博客园</a></li>
</ul>
<p>首先我们执行<br><code>show engine innodb status\G;</code><br>查看死锁情况，也可以<br><code>mysql -u root -p --execute=&quot;show engine innodb status \G&quot;&gt; c:/mysql.log</code><br>把死锁信息输出到本地磁盘，查看起来比较方便<br><a href="https://blog.csdn.net/weixin_38250126/article/details/70053222">mysql 死锁分析 - 那片天空！那片海！ - CSDN 博客</a></p>
<p><strong>例如：</strong></p>
<p>通过定位死锁的数据库： <code>show engine \G</code>，发现一个统计任务、一个改价任务，同时修改同一个端口的内容，导致死锁。</p>
<p>解决方法：将两个任务的时间错开，改价的为每分钟的 0 秒触发；统计的为每两分钟的 30 秒触发；</p>
<h2 id="日志文件被删除后，无法正常启动"><a href="#日志文件被删除后，无法正常启动" class="headerlink" title="日志文件被删除后，无法正常启动"></a>日志文件被删除后，无法正常启动</h2><p>通过<code>systemctl status mariadb.service</code>来查看缺少什么文件，创建对应的即可，<br>如果是权限问题，把外层的文件夹修改下权限 <code>/var/log/mysql</code>。<br>然后重启： <code>systemctl restart mariadb.service</code></p>
<h2 id="Authentication-plugin-‘caching-sha2-password’-cannot-be-loaded"><a href="#Authentication-plugin-‘caching-sha2-password’-cannot-be-loaded" class="headerlink" title="Authentication plugin ‘caching_sha2_password’ cannot be loaded"></a>Authentication plugin ‘caching_sha2_password’ cannot be loaded</h2><figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">use mysql;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;12345678&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> Host,<span class="keyword">user</span>,plugin,Authentication_string <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/u010358168/article/details/81253744">完美解决 ERROR2059(HY000):Authenticationplugincaching<em>sha2_passwordcannotbeloaded 问题</em>小洋人最 happy 的专栏-CSDN 博客_error2059</a></p>
<h2 id="不可重复读和幻读的区别"><a href="#不可重复读和幻读的区别" class="headerlink" title="不可重复读和幻读的区别"></a>不可重复读和幻读的区别</h2><ul>
<li>脏读：读取未提交的数据；</li>
<li>不可重复读（update）：前后多次读取，数据内容不一致；</li>
<li>幻读（insert、delete）：前后多次读取，数据总量不一致；</li>
</ul>
<ul>
<li><a href="https://cloud.tencent.com/developer/article/1450773">快速理解脏读、不可重复读、幻读和 MVCC - 云+社区 - 腾讯云</a><br>(1) 不可重复读是读取了其他事务更改的数据，针对 update 操作<br>解决：使用行级锁，锁定该行，事务 A 多次读取操作完成后才释放该锁，这个时候才允许其他事务更改刚才的数据。<br>(2) 幻读是读取了其他事务新增的数据，针对 insert 和 delete 操作<br>解决：使用表级锁，锁定整张表，事务 A 多次读取数据总量之后才释放该锁，这个时候才允许其他事务新增数据。</li>
</ul>
<h4 id="SELECT-IN-子查询-太慢问题"><a href="#SELECT-IN-子查询-太慢问题" class="headerlink" title="SELECT IN(子查询)太慢问题"></a>SELECT IN(子查询)太慢问题</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">explain <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> third_video_iqiyi <span class="keyword">WHERE</span>  v_id <span class="keyword">in</span> (<span class="keyword">SELECT</span> v_id <span class="keyword">FROM</span> third_video_iqiyi <span class="keyword">WHERE</span> v_id <span class="operator">&lt;</span> <span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98_20220608185021_2022-06-08-18-50-22.png" alt="常见问题_20220608185021_2022-06-08-18-50-22"><br>在表的整体数据量大的情况下，上面的 sql 基本无法执行。</p>
<ul>
<li><p><a href="https://blog.csdn.net/youbl/article/details/113696590">生产慢查询记录：MySQL IN 子查询导致的慢查询_北亮bl的博客-CSDN博客</a><br><img src="https://raw.githubusercontent.com/lyloou/img/develop/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98_20220608185524_2022-06-08-18-55-24.png" alt="常见问题_20220608185524_2022-06-08-18-55-24"></p>
</li>
<li><p><a href="https://www.cnblogs.com/wxw16/p/6105624.html">深入理解MySql子查询IN的执行和优化 - wuxiwei - 博客园</a></p>
</li>
<li><p><a href="https://www.365seal.com/y/AZvgXQL3Va.html">MySQL子查询慢现象的解决</a><br><img src="https://raw.githubusercontent.com/lyloou/img/develop/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98_20220608185226_2022-06-08-18-52-27.png" alt="常见问题_20220608185226_2022-06-08-18-52-27"></p>
</li>
</ul>
<p>优化方案</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">explain <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> third_video_iqiyi a ,(<span class="keyword">SELECT</span> v_id <span class="keyword">FROM</span> third_video_iqiyi <span class="keyword">WHERE</span> v_id <span class="operator">&lt;</span> <span class="number">10</span>) b <span class="keyword">WHERE</span> a.v_id <span class="operator">=</span> b.v_id;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98_20220608184956_2022-06-08-18-49-57.png" alt="常见问题_20220608184956_2022-06-08-18-49-57"></p>
]]></content>
      <tags>
        <tag>sql</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>数据库理论</title>
    <url>/sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA/</url>
    <content><![CDATA[<h2 id="三范式"><a href="#三范式" class="headerlink" title="三范式"></a>三范式</h2><p>第一范式：消除属性值可再分（非原子的）；<br>第二范式：消除非主属性对候选键的部分依赖。<br>第三范式：消除非主属性对候选键的传递依赖。<br>BC 范式：消除主属性对候选键的部分依赖和传递依赖。</p>
<p><img src="http://cdn.lyloou.com/img/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA-2021-09-09-14-08-58.png" alt="数据库理论-2021-09-09-14-08-58"></p>
<p><strong>分析</strong></p>
<blockquote>
<p>假设有属性集：{A、B、C、D、E、J}<br>依赖集 {A-&gt;B, A-&gt;C, C-&gt;D, AJ-&gt;E}</p>
</blockquote>
<ul>
<li>候选键：<code>AJ</code></li>
<li>主属性：<code>A、J</code></li>
<li>非主属性：<code>B、C、D、E</code></li>
</ul>
<ul>
<li><code>AJ</code>是主属性，B 可以通过<code>A</code>确定，存在<code>非主属性对候选键的部分依赖</code>；<code>AJ-&gt;E</code>这个关系拆分后，可满足<code>第二范式</code>；</li>
<li><code>A-&gt;C，C-&gt;D</code>，存在<code>非主属性对候选键的传递依赖</code>；<code>C-D</code> 拆分后满足<code>第三范式</code>；</li>
</ul>
<p>对于 BC 范式，可以从下面图来理解<br><img src="http://cdn.lyloou.com/img/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA-2021-09-09-14-19-18.png" alt="数据库理论-2021-09-09-14-19-18"></p>
<p>例题（答案：C、A）：<br><img src="http://cdn.lyloou.com/img/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%90%86%E8%AE%BA-2021-09-09-14-20-23.png" alt="数据库理论-2021-09-09-14-20-23"></p>
<h2 id="多版本控制（MVCC）"><a href="#多版本控制（MVCC）" class="headerlink" title="多版本控制（MVCC）"></a>多版本控制（MVCC）</h2><p>读取优化策略，不使用锁，而是使用多个版本共存的思想，根据隔离级别确定使用哪个版本号。</p>
<p>版本号的创建规则是：</p>
<p>插入数据时：<code>CREATE_VERSION</code> 记录下当前的事务ID（事务 ID 是一个全局严格递增的数值），<code>DELETE_VERSION</code> 为空；</p>
<p>删除数据时：<code>CREATE_VERSION</code> 为空，<code>DELETE_VERSION</code> 为当前事务ID；</p>
<p>更新数据时：相当于“删除旧数据，插入新数据”，拷贝一份原始数据，将原始数据的 <code>CREATE_VERSION</code> 设为空，<code>DELETE_VERSION</code> 设为当前事务ID；再将拷贝后数据的 <code>CREATE_VERSION</code> 设为当前事务ID，<code>DELETE_VERSION</code> 设为空；</p>
<p>根据隔离级别确定使用哪个版本号：</p>
<p>如果隔离级别是<code>可重复读</code>：总是取 <code>CREATE_VERSION</code> 小于当前事务ID的记录，如果还存在多个版本，逆序取最新的一个；</p>
<p>如果隔离级别是<code>读已提交</code>：总是取最新commit了的版本；<br>参考资料：<a href="https://icyfenix.cn/architect-perspective/general-architecture/transaction/local.html">本地事务 | 凤凰架构 (icyfenix.cn)</a></p>
]]></content>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>Sql表设计</title>
    <url>/sql/%E8%A1%A8%E8%AE%BE%E8%AE%A1/</url>
    <content><![CDATA[<table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">类型</th>
<th align="right">长度</th>
<th align="center">小数点</th>
<th align="center">不是 null</th>
<th align="right">默认值</th>
<th align="center">虚拟</th>
<th align="center">键</th>
<th align="left">注释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">bigint</td>
<td align="right">20</td>
<td align="center">0</td>
<td align="center">notnull</td>
<td align="right"></td>
<td align="center"></td>
<td align="center">key</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">money</td>
<td align="left">decimal</td>
<td align="right">10</td>
<td align="center">2</td>
<td align="center">notnull</td>
<td align="right">0.00</td>
<td align="center"></td>
<td align="center"></td>
<td align="left">和钱相关的</td>
</tr>
<tr>
<td align="left">gmt_create</td>
<td align="left">datetime</td>
<td align="right">0</td>
<td align="center">0</td>
<td align="center"></td>
<td align="right">current_timestamp</td>
<td align="center"></td>
<td align="center"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gmt_modified</td>
<td align="left">datetime</td>
<td align="right">0</td>
<td align="center">0</td>
<td align="center"></td>
<td align="right">current_timestamp</td>
<td align="center"></td>
<td align="center"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">is_disabled</td>
<td align="left">tinyint</td>
<td align="right">1</td>
<td align="center">0</td>
<td align="center"></td>
<td align="right"></td>
<td align="center"></td>
<td align="center"></td>
<td align="left">是与否相关的，都用 tinyint</td>
</tr>
<tr>
<td align="left">name</td>
<td align="left">varchar</td>
<td align="right">64</td>
<td align="center">0</td>
<td align="center"></td>
<td align="right"></td>
<td align="center"></td>
<td align="center"></td>
<td align="left">和名称有关的，长度可选 32、64、123</td>
</tr>
<tr>
<td align="left">intro</td>
<td align="left">text</td>
<td align="right">0</td>
<td align="center">0</td>
<td align="center"></td>
<td align="right"></td>
<td align="center"></td>
<td align="center"></td>
<td align="left">比较长的文本，用 text 类型</td>
</tr>
<tr>
<td align="left">start_time</td>
<td align="left">timestamp</td>
<td align="right">0</td>
<td align="center">0</td>
<td align="center"></td>
<td align="right"></td>
<td align="center"></td>
<td align="center"></td>
<td align="left">需要的时间要很精确，用 timestamp 类型</td>
</tr>
</tbody></table>
]]></content>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>Sql配置和安装</title>
    <url>/sql/%E9%85%8D%E7%BD%AE%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="linux-安装-mariadb"><a href="#linux-安装-mariadb" class="headerlink" title="linux 安装 mariadb"></a>linux 安装 mariadb</h2><ul>
<li><p>打开 <a href="https://downloads.mariadb.org/mariadb/repositories/">https://downloads.mariadb.org/mariadb/repositories/</a></p>
</li>
<li><p>查看自己的版本号，选择对应的 version</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">lsb_release -a</span><br></pre></td></tr></table></figure>

<ul>
<li>添加源</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get install software-properties-common</span><br><span class="line">sudo apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xF1656F24C74CD1D8</span><br><span class="line">sudo add-apt-repository <span class="string">&#x27;deb [arch=amd64,arm64,ppc64el] http://mirrors.neusoft.edu.cn/mariadb/repo/10.4/ubuntu bionic main&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>更新和安装</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install mariadb-server</span><br></pre></td></tr></table></figure>

<ul>
<li>查看安装状态</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">systemctl status mariadb</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 mysql version</li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mysql -V</span><br></pre></td></tr></table></figure>

<p><a href="https://linuxize.com/post/how-to-install-mariadb-on-ubuntu-18-04/">https://linuxize.com/post/how-to-install-mariadb-on-ubuntu-18-04/</a></p>
<h2 id="uninstall-mariadb"><a href="#uninstall-mariadb" class="headerlink" title="uninstall mariadb"></a>uninstall mariadb</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">apt-get remove --purge mysql*</span><br><span class="line">apt-get remove --purge mysql</span><br><span class="line">apt-get remove --purge mariadb</span><br><span class="line">apt-get remove --purge mariadb*</span><br><span class="line">apt-get --purge remove mariadb-server</span><br><span class="line">apt-get --purge remove python-software-properties</span><br></pre></td></tr></table></figure>

<h2 id="重置密码"><a href="#重置密码" class="headerlink" title="重置密码"></a>重置密码</h2><p><a href="https://linuxize.com/post/how-to-reset-a-mysql-root-password/">How to reset a MySQL root password | Linuxize</a></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">systemctl stop mysql</span><br><span class="line"></span><br><span class="line">sudo mysqld_safe <span class="comment">--skip-grant-tables &amp;</span></span><br><span class="line"></span><br><span class="line">mysql <span class="operator">-</span>u root</span><br><span class="line"></span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;lyloou06&#x27;</span>;</span><br><span class="line"><span class="comment">-- SET PASSWORD FOR &#x27;root&#x27;@&#x27;localhost&#x27; = PASSWORD(&#x27;MY_NEW_PASSWORD&#x27;);</span></span><br><span class="line"><span class="keyword">UPDATE</span> mysql.user <span class="keyword">SET</span> Password<span class="operator">=</span>PASSWORD(<span class="string">&#x27;rebate@2020&#x27;</span>) <span class="keyword">WHERE</span> <span class="keyword">User</span><span class="operator">=</span><span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- restart</span></span><br><span class="line">mysqladmin <span class="operator">-</span>u root <span class="operator">-</span>p shutdown</span><br><span class="line">sudo systemctl <span class="keyword">start</span> mariadb</span><br><span class="line"></span><br><span class="line"><span class="comment">-- login again</span></span><br><span class="line">mysql <span class="operator">-</span>u root <span class="operator">-</span>p</span><br></pre></td></tr></table></figure>

<h3 id="外网登录常见问题"><a href="#外网登录常见问题" class="headerlink" title="外网登录常见问题"></a>外网登录常见问题</h3><p>Q: ERROR 2003 (HY000): Can’t connect to MySQL server on (111 “Connection refused”)<br>A: <a href="https://blog.csdn.net/ssj901217/article/details/74490803">mysql 远程连接数据库报 111 错误 - ssj901217 的博客 - CSDN 博客</a></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/my</span>sql/my.cnf</span><br><span class="line">找到</span><br><span class="line">[mysqld]</span><br><span class="line">bind-address            = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">注释掉bind-address</span><br><span class="line">重启 mysql, systemctl restart mysql;</span><br></pre></td></tr></table></figure>

<p>Q: ERROR 1130 (HY000): Host is not allowed to connect to this MariaDB server<br>A: <a href="https://blog.csdn.net/HJULKK/article/details/52563044">解决 MySQL ERROR 1130 (HY000): Host ‘XXXX’ is not allowed to connect to this MySQL server - HJULKK 的专栏 - CSDN 博客</a></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql <span class="operator">-</span>u root <span class="operator">-</span>p</span><br><span class="line">use mysql;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> host <span class="operator">=</span> <span class="string">&#x27;%&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="keyword">select</span> host, <span class="keyword">user</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line">quit</span><br><span class="line"><span class="comment">-- 步骤2：重启mysql,</span></span><br><span class="line">systemctl restart mysql;</span><br></pre></td></tr></table></figure>

<p>Q: <a href="https://stackoverflow.com/questions/39281594/error-1698-28000-access-denied-for-user-rootlocalhost">mysql - ERROR 1698 (28000): Access denied for user ‘root‘@’localhost’ - Stack Overflow</a><br>A: see below code</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">sudo service mysql restart</span><br><span class="line">sudo mysql # logs <span class="keyword">in</span> automatically <span class="keyword">into</span> MariaDB</span><br><span class="line">use mysql;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> plugin<span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;your_user_name&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line">exit;</span><br><span class="line">sudo service mysql restart # restarts the mysql service</span><br></pre></td></tr></table></figure>

<p><a href="https://javen.blog.csdn.net/article/details/70949596#comments_15461007">Centos7.3 安装 Mysql5.7 并修改初始密码_酷玩时刻-By Javen-CSDN 博客_centos7 修改 mysql 密码</a></p>
<h2 id="linux-安装-mysql"><a href="#linux-安装-mysql" class="headerlink" title="linux 安装 mysql"></a>linux 安装 mysql</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install mysql-server</span><br><span class="line">sudo mysql_secure_installation</span><br></pre></td></tr></table></figure>

<p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-ubuntu-16-04?comment=53320">https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-ubuntu-16-04?comment=53320</a><br>If it occurs error because of broken MySQL package on Ubuntu 16.04. Just do this trick</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Purge all MySQL packages</span></span><br><span class="line">sudo apt purge mysql*</span><br><span class="line">sudo <span class="built_in">rm</span> -rf /var/lib/mysql</span><br><span class="line">sudo <span class="built_in">rm</span> -rf /etc/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reinstall MySQL</span></span><br><span class="line">sudo apt install mysql-server mysql-client</span><br></pre></td></tr></table></figure>

<p><strong>centos</strong></p>
<p><a href="https://developer.aliyun.com/article/654596">CentOS 7 - 安装 MySQL 5.7-阿里云开发者社区</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 添加Mysql5.7仓库</span></span><br><span class="line">sudo rpm -ivh https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确认Mysql仓库成功添加</span></span><br><span class="line">sudo yum repolist all | grep mysql | grep enabled</span><br><span class="line"><span class="comment"># 开始安装</span></span><br><span class="line">sudo yum -y install mysql-community-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动Mysql</span></span><br><span class="line">sudo systemctl start mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统启动时自动启动</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看启动状态</span></span><br><span class="line">sudo systemctl status mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS上的root默认密码可以在文件/var/log/mysqld.log找到，通过下面命令可以打印出来</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/mysqld.log | grep -i <span class="string">&#x27;temporary password&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行下面命令进行安全设置，这个命令会进行设置root密码设置，移除匿名用户，禁止root用户远程连接等</span></span><br><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure>

<p>解决：conflicts between attempted installs of MariaDB-common</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">yum shell</span><br><span class="line">remove mariadb-libs</span><br></pre></td></tr></table></figure>

<p>由于 5.7 版本在安装的时候就设置好了，不需要额外设置，但是 5.6 版本建议从安全角度完善下，运行官方脚本即可</p>
<pre><code>设置 root 密码
禁止 root 账号远程登录
禁止匿名账号（anonymous）登录
删除测试库
是否确认修改
</code></pre>
<h2 id="默认配置"><a href="#默认配置" class="headerlink" title="默认配置"></a>默认配置</h2><ul>
<li>端口：3306</li>
</ul>
<h2 id="其它软件"><a href="#其它软件" class="headerlink" title="其它软件"></a>其它软件</h2><ul>
<li>mycli</li>
</ul>
<h2 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h2><ul>
<li>[How To Install MySQL on Ubuntu 16.04](error 1045 access denied for user using password no)</li>
<li><a href="https://stackoverflow.com/questions/10299148/mysql-error-1045-28000-access-denied-for-user-billlocalhost-using-passw">MySQL ERROR 1045 (28000): Access denied for user ‘bill‘@’localhost’ (using password: YES) - Stack Overflow</a></li>
</ul>
<h2 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建用户</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;bob&#x27;</span>@<span class="string">&#x27;%&#x27;</span></span><br><span class="line">    IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授权1</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> </span><br><span class="line">    <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span></span><br><span class="line">    <span class="keyword">TO</span> <span class="string">&#x27;bob&#x27;</span>@<span class="string">&#x27;%&#x27;</span></span><br><span class="line">    <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 授权2</span></span><br><span class="line"><span class="keyword">GRANT</span> privileges <span class="keyword">on</span> databasename.tablename <span class="keyword">TO</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;host&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改密码</span></span><br><span class="line"><span class="keyword">SET</span> PASSWORD <span class="keyword">FOR</span> <span class="string">&#x27;bob&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="operator">=</span> PASSWORD(<span class="string">&#x27;bob&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 刷新</span></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

<p><a href="https://dev.mysql.com/doc/refman/8.0/en/creating-accounts.html">MySQL :: MySQL 8.0 Reference Manual :: 6.2.8 Adding Accounts, Assigning Privileges, and Dropping Accounts</a></p>
<p><a href="https://serverfault.com/questions/186057/mysql-creating-a-user-that-can-connect-from-multiple-hosts">networking - MySQL: creating a user that can connect from multiple hosts - Server Fault</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">mysql root@120.123.232.2:mysql&gt; GRANT all PRIVILEGES ON *.* to <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">(1133, <span class="string">&quot;Can&#x27;t find any matching row in the user table&quot;</span>)</span><br><span class="line"></span><br><span class="line">mysql root@120.123.232.2:mysql&gt; GRANT all PRIVILEGES ON *.* to <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED by <span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected</span><br><span class="line">Time: 0.002s</span><br><span class="line"></span><br><span class="line">grant all privileges on testDB.* to <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;1.1.1.1&#x27;</span>identified by <span class="string">&#x27;pswd&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="mac-install-mariadb"><a href="#mac-install-mariadb" class="headerlink" title="mac install mariadb"></a>mac install mariadb</h2><ul>
<li><a href="https://mariadb.com/resources/blog/installing-mariadb-10-1-16-on-mac-os-x-with-homebrew/">Installing MariaDB 10.1.16 on Mac OS X with Homebrew | MariaDB</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">xcode-select –install</span><br><span class="line">ruby -e “$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)”</span><br><span class="line">brew doctor</span><br><span class="line"></span><br><span class="line">brew update</span><br><span class="line">brew info mariadb</span><br><span class="line">brew install mariadb</span><br><span class="line">mysql_install_db</span><br><span class="line">mysql.server start</span><br><span class="line">mysql_secure_installation</span><br><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure>

<h2 id="mysql-创建数据库-添加用户-用户授权实操方法"><a href="#mysql-创建数据库-添加用户-用户授权实操方法" class="headerlink" title="mysql 创建数据库,添加用户,用户授权实操方法"></a>mysql 创建数据库,添加用户,用户授权实操方法</h2><p><a href="https://www.jb51.net/article/172998.htm">https://www.jb51.net/article/172998.htm</a></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--创建名称为“testdb”数据库，并设定编码集为utf8</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> testdb <span class="keyword">DEFAULT</span> CHARSET utf8 <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> testdb <span class="keyword">DEFAULT</span> CHARSET utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br><span class="line"></span><br><span class="line"> <span class="comment">--创建了一个名为：test 密码为：1234 的用户</span></span><br><span class="line"> <span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;1234&#x27;</span>;</span><br><span class="line"> <span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;rebate&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;rebate1234&#x27;</span>;</span><br><span class="line"><span class="comment">-- 注意：</span></span><br><span class="line"><span class="comment">-- 此处的&quot;localhost&quot;，是指该用户只能在本地登录，不能在另外一台机器上远程登录。如果想远程登录的话，将&quot;localhost&quot;改为&quot;%&quot;，表示在任何一台电脑上都可以登录。也可以指定某台机器可以远程登录。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查询用户</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host <span class="keyword">from</span> mysql.user;</span><br><span class="line"></span><br><span class="line"><span class="comment">--删除用户“test”</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> test<span class="variable">@localhost</span> ;</span><br><span class="line"><span class="comment">--若创建的用户允许任何电脑登陆，删除用户如下</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> test@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--方法1，密码实时更新；修改用户“test”的密码为“1122”</span></span><br><span class="line"><span class="keyword">set</span> password <span class="keyword">for</span> test <span class="operator">=</span>password(<span class="string">&#x27;1122&#x27;</span>);</span><br><span class="line"><span class="comment">--方法2，需要刷新；修改用户“test”的密码为“1234”</span></span><br><span class="line"><span class="keyword">update</span> mysql.user <span class="keyword">set</span> password<span class="operator">=</span>password(<span class="string">&#x27;1234&#x27;</span>) <span class="keyword">where</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;test&#x27;</span></span><br><span class="line"><span class="comment">--刷新</span></span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--授予用户test通过外网IP对数据库“testdb”的全部权限</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> rebate.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;1234&#x27;</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> rebate.<span class="operator">*</span> <span class="keyword">to</span> rebate@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;rebate1234&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--刷新权限</span></span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"><span class="comment">--授予用户“test”通过外网IP对于该数据库“testdb”中表的创建、修改、删除权限,以及表数据的增删查改权限</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">create</span>,<span class="keyword">alter</span>,<span class="keyword">drop</span>,<span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">delete</span> <span class="keyword">on</span> testdb.<span class="operator">*</span> <span class="keyword">to</span> test@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> process <span class="keyword">ON</span> . <span class="keyword">TO</span> <span class="string">&#x27;test&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看用户“test”</span></span><br><span class="line"><span class="keyword">show</span> grants <span class="keyword">for</span> test;</span><br><span class="line"><span class="keyword">show</span> grants <span class="keyword">for</span> rebate;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="简易版本"><a href="#简易版本" class="headerlink" title="简易版本"></a>简易版本</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> db_movie <span class="keyword">DEFAULT</span> CHARSET utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;admin&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> db_movie.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;admin&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> db_movie.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;admin&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">create</span>,<span class="keyword">alter</span>,<span class="keyword">drop</span>,<span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">delete</span> <span class="keyword">on</span> db_movie.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;admin&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> process <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;admin&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> grants <span class="keyword">for</span> db_movie;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>锁</title>
    <url>/sql/%E9%94%81/</url>
    <content><![CDATA[<ul>
<li><a href="https://serverfault.com/questions/36260/how-can-i-show-mysql-locks">How can I show mysql locks? - Server Fault</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">SHOW FULL PROCESSLIST;</span><br><span class="line"></span><br><span class="line">show open tables <span class="built_in">where</span> In_Use &gt; 0 ;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring 的生命周期</title>
    <url>/ssm/Spring%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
    <content><![CDATA[<h4 id="Spring-的生命周期"><a href="#Spring-的生命周期" class="headerlink" title="Spring 的生命周期"></a>Spring 的生命周期</h4><ol>
<li>实例化（Instanctiation）</li>
<li>属性填充（Populate）</li>
<li>初始化（Initialization）</li>
<li>销毁（Destruction）</li>
</ol>
<blockquote>
<p>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#doCreateBean<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/1b022eef-895d-4f8e-bd1b-a67bd8740a74_20211217114231733_9c8c98.png" alt="img"><br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/d0cd34bf-96d8-4a56-ae66-e41c3bac6c5d_20211216114015327_6687b3.jpg" alt="img"></p>
</blockquote>
<h6 id="1-实例化"><a href="#1-实例化" class="headerlink" title="1. 实例化"></a>1. 实例化</h6><p>判断是否存在方法覆盖，如果有，使用 JDK 的反射机制来实例化。<br>如果没有，使用 CGLib 技术实例化。<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/d4ee5cad-5b5e-440a-8a3f-865cf5f10ab3_20211217114246020_9bdc78.png" alt="img"></p>
<h6 id="2-属性填充"><a href="#2-属性填充" class="headerlink" title="2.属性填充"></a>2.属性填充</h6><p>分为：按名称填充、和按类型填充<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/37667b6c-c43d-48ad-b7ce-e7d3123ed12c_20211216114015366_6bdf8b.png" alt="img"></p>
<h6 id="3-初始化"><a href="#3-初始化" class="headerlink" title="3.初始化"></a>3.初始化</h6><ol>
<li>Aware 相关回调</li>
<li>初始化前置处理</li>
<li>初始化</li>
<li>初始化后置处理</li>
</ol>
<blockquote>
<p>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#initializeBean<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/ca4cb8e0-2c87-4d94-9db6-eaa6f38d4665_20211216114015353_f375f6.png" alt="img"></p>
</blockquote>
<h6 id="销毁"><a href="#销毁" class="headerlink" title="销毁"></a>销毁</h6><p>从容器中，移除 beanName<br>调用 DesposableBean.distroy 接口<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/faefd2dc-114c-4dbb-9850-99598310a635_20211217114256213_243b26.png" alt="img"></p>
<h6 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h6><ul>
<li><p>附件 1：Spring 生命周期-创建和初始化.pdf</p>
</li>
<li><p><a href="https://0f9de7f3.wiz06.com/wapp/pages/view/share/s/0fDuvP3SO4QS2Hb3sP2Di0ai1Gi4xr0PNQk-2VJor-2R5iil">Spring 源码解析</a></p>
</li>
</ul>
]]></content>
      <tags>
        <tag>java</tag>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Mybatis</title>
    <url>/ssm/mybatis/</url>
    <content><![CDATA[<h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><ul>
<li><p><a href="http://www.mybatis.org/spring/factorybean.html">mybatis-spring – MyBatis-Spring | SqlSessionFactoryBean</a></p>
<blockquote>
<p>In normal MyBatis-Spring usage, you will not need to use SqlSessionFactoryBean or the corresponding SqlSessionFactory directly. Instead, the session factory will be injected into MapperFactoryBeans or other DAOs that extend SqlSessionDaoSupport .</p>
</blockquote>
</li>
<li><p><a href="https://blog.csdn.net/techbirds_bao/article/details/9235547">Myibatis 和 spring(mvc)的集成 - CSDN 博客</a></p>
</li>
</ul>
<h2 id="nested-exception-is-org-apache-ibatis-reflection-ReflectionException-There-is-no-getter-for-property-named"><a href="#nested-exception-is-org-apache-ibatis-reflection-ReflectionException-There-is-no-getter-for-property-named" class="headerlink" title="nested exception is org.apache.ibatis.reflection.ReflectionException: There is no getter for property named"></a>nested exception is org.apache.ibatis.reflection.ReflectionException: There is no getter for property named</h2><p>2020-01-02 19:01:21 [WARN] ExceptionHandlerExceptionResolver:194 - Resolved [org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.reflection.ReflectionException: There is no getter for property named ‘is_disabled’ in ‘class com.lyloou.flow.model.flow.Flow’]</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 错误的</span></span><br><span class="line"><span class="meta">@Update(&quot;insert into flow (day,item,is_disabled,is_archived) values (#&#123;day&#125;,#&#123;item&#125;,#&#123;is_disabled&#125;,#&#123;is_archived&#125;) on duplicate key update&quot; +</span></span><br><span class="line"><span class="meta">            &quot; item=values(item),is_disabled=values(is_disabled),is_archived=values(is_archived)&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insertOrUpdateFlow</span><span class="params">(Flow flow)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确的</span></span><br><span class="line"><span class="meta">@Update(&quot;insert into flow (day,item,is_disabled,is_archived) values (#&#123;day&#125;,#&#123;item&#125;,#&#123;isDisabled&#125;,#&#123;isArchived&#125;) on duplicate key update&quot; +</span></span><br><span class="line"><span class="meta">            &quot; item=values(item),is_disabled=values(is_disabled),is_archived=values(is_archived)&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">insertOrUpdateFlow</span><span class="params">(Flow flow)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Flow</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date gmtCreate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date gmtModified;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String day;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String item;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean isArchived;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean isDisabled;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight md"><table><tr><td class="code"><pre><span class="line">2020-01-02 19:01:21 [WARN] ExceptionHandlerExceptionResolver:194 - Resolved [org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.reflection.ReflectionException: There is no getter for property named &#x27;is<span class="emphasis">_disabled&#x27; in &#x27;class com.lyloou.flow.model.flow.Flow&#x27;]</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">答案：因为解决的时候用到的是 `flow.isDisabled` 属性，因为传递的是 `flow.is_</span>disabled` 所以不行</span><br></pre></td></tr></table></figure>

<h2 id="按照输入-id-顺序来返回数据"><a href="#按照输入-id-顺序来返回数据" class="headerlink" title="按照输入 id 顺序来返回数据"></a>按照输入 id 顺序来返回数据</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryOrderedAuthorByauthorIds&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">  select * from video_author a</span><br><span class="line">  where a.user_id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;authorIds&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">      #&#123;item&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">  and a.user_status=0</span><br><span class="line">  -- 按照输入的顺序来返回排序</span><br><span class="line">  order by field(a.user_id,</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;authorIds&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">      #&#123;item&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">  )</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="自动填充字段"><a href="#自动填充字段" class="headerlink" title="自动填充字段"></a>自动填充字段</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Person.java</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span>  <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;实体ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;创建时间&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createdTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;更新时间&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updatedTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;创建人&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(value = &quot;creator&quot;, fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> String creator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;修改人&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(value = &quot;modifier&quot;, fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> String modifier;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MybatisObjectHandler.java</span></span><br><span class="line"><span class="comment">// [自动填充功能 | MyBatis-Plus](https://baomidou.com/guide/auto-fill-metainfo.html)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">userId</span> <span class="operator">=</span> AuthenticationService.getUserId();</span><br><span class="line">        <span class="keyword">if</span> (userId != <span class="literal">null</span>) &#123;</span><br><span class="line">            Stream.of(<span class="string">&quot;createdBy&quot;</span>, <span class="string">&quot;updatedBy&quot;</span>, <span class="string">&quot;modifier&quot;</span>, <span class="string">&quot;creator&quot;</span>)</span><br><span class="line">                    .forEach(s -&gt; setFieldValIfNull(s, userId.toString(), metaObject));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Stream.of(<span class="string">&quot;createdTime&quot;</span>, <span class="string">&quot;updatedTime&quot;</span>)</span><br><span class="line">                .forEach(s -&gt; setFieldValIfNull(s, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setFieldValIfNull</span><span class="params">(String field, Object fieldVal, MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> getFieldValByName(field, metaObject);</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">            setFieldValByName(field, fieldVal, metaObject);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="comment">//更新时 需要填充字段</span></span><br><span class="line">        Stream.of(<span class="string">&quot;updatedTime&quot;</span>)</span><br><span class="line">                .forEach(s -&gt; setFieldValIfNull(s, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject));</span><br><span class="line">        setFieldValByName(<span class="string">&quot;updatedTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">userId</span> <span class="operator">=</span> AuthenticationService.getUserId();</span><br><span class="line">        <span class="keyword">if</span> (userId != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//更新时填充的字段</span></span><br><span class="line">            Stream.of(<span class="string">&quot;updatedBy&quot;</span>, <span class="string">&quot;modifier&quot;</span>)</span><br><span class="line">                    .forEach(s -&gt; setFieldValIfNull(s, userId.toString(), metaObject));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mybatis-深入理解-一-之-与-区别以及-sql-预编译-SegmentFault-思否"><a href="#mybatis-深入理解-一-之-与-区别以及-sql-预编译-SegmentFault-思否" class="headerlink" title="mybatis 深入理解(一)之 # 与 $ 区别以及 sql 预编译 - SegmentFault 思否"></a><a href="https://segmentfault.com/a/1190000004617028">mybatis 深入理解(一)之 # 与 $ 区别以及 sql 预编译 - SegmentFault 思否</a></h2><p>mybatis 中使用 sqlMap 进行 sql 查询时，经常需要动态传递参数，例如我们需要根据用户的姓名来筛选用户时，sql 如下：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="type">name</span> = &quot;ruhua&quot;;</span><br></pre></td></tr></table></figure>

<p>上述 sql 中，我们希望 name 后的参数 “ruhua” 是动态可变的，即不同的时刻根据不同的姓名来查询用户。在 sqlMap 的 xml 文件中使用如下的 sql 可以实现动态传递参数 name：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="type">name</span> = #&#123;<span class="type">name</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;$&#123;name&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>对于上述这种查询情况来说，使用 #{ } 和 ${ } 的结果是相同的，但是在某些情况下，我们只能使用二者其一。</p>
<h2 id="‘-’-与-‘-’"><a href="#‘-’-与-‘-’" class="headerlink" title="‘#’ 与 ‘$’"></a>‘#’ 与 ‘$’</h2><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p><strong>动态 SQL</strong> 是 mybatis 的强大特性之一，也是它优于其他 ORM 框架的一个重要原因。mybatis 在对 sql 语句进行预编译之前，会对 sql 进行动态解析，解析为一个 BoundSql 对象，也是在此处对动态 SQL 进行处理的。</p>
<p>在动态 SQL 解析阶段， #{ } 和 ${ } 会有不同的表现：</p>
<blockquote>
<p><strong>#{ } 解析为一个 JDBC 预编译语句（prepared statement）的参数标记符。</strong></p>
</blockquote>
<p>例如，sqlMap 中如下的 sql 语句</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="type">name</span> = #&#123;<span class="type">name</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>解析为：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="type">name</span> = ?;</span><br></pre></td></tr></table></figure>

<p>一个 #{ } 被解析为一个参数占位符 <code>?</code> 。</p>
<p>而，</p>
<blockquote>
<p><strong>${ } 仅仅为一个纯碎的 string 替换，在动态 SQL 解析阶段将会进行变量替换</strong></p>
</blockquote>
<p>例如，sqlMap 中如下的 sql</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;$&#123;name&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>当我们传递的参数为 “ruhua” 时，上述 sql 的解析为：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="type">name</span> = &quot;ruhua&quot;;</span><br></pre></td></tr></table></figure>

<p>预编译之前的 SQL 语句已经不包含变量 name 了。</p>
<p>综上所得， ${ } 的变量的替换阶段是在动态 SQL 解析阶段，而 #{ }的变量的替换是在 DBMS 中。</p>
<h3 id="用法-tips"><a href="#用法-tips" class="headerlink" title="用法 tips"></a>用法 tips</h3><blockquote>
<p>1、能使用 #{ } 的地方就用 #{ }</p>
</blockquote>
<p>首先这是为了性能考虑的，相同的预编译 sql 可以重复利用。</p>
<p>其次，**${ } 在预编译之前已经被变量替换了，这会存在 sql 注入问题**。例如，如下的 sql，</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> $&#123;tableName&#125; <span class="keyword">where</span> <span class="type">name</span> = #&#123;<span class="type">name</span>&#125;</span><br></pre></td></tr></table></figure>

<p>假如，我们的参数 tableName 为 <code>user; delete user; --</code>，那么 SQL 动态解析阶段之后，预编译之前的 sql 将变为</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>; <span class="keyword">delete</span> <span class="keyword">user</span>; <span class="comment">-- where name = ?;</span></span><br></pre></td></tr></table></figure>

<p><code>--</code> 之后的语句将作为注释，不起作用，因此本来的一条查询语句偷偷的包含了一个删除表数据的 SQL！</p>
<blockquote>
<p>2、表名作为变量时，必须使用 ${ }</p>
</blockquote>
<p>这是因为，表名是字符串，使用 sql 占位符替换字符串时会带上单引号 <code>&#39;&#39;</code>，这会导致 sql 语法错误，例如：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> #&#123;tableName&#125; <span class="keyword">where</span> <span class="type">name</span> = #&#123;<span class="type">name</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>预编译之后的 sql 变为：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> ? <span class="keyword">where</span> <span class="type">name</span> = ?;</span><br></pre></td></tr></table></figure>

<p>假设我们传入的参数为 tableName = “user” , name = “ruhua”，那么在占位符进行变量替换后，sql 语句变为</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="string">&#x27;user&#x27;</span> <span class="keyword">where</span> <span class="type">name</span>=<span class="string">&#x27;ruhua&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>上述 sql 语句是存在语法错误的，表名不能加单引号 <code>&#39;&#39;</code>（注意，反引号 ``是可以的）。</p>
<h2 id="sql-预编译"><a href="#sql-预编译" class="headerlink" title="sql 预编译"></a>sql 预编译</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><blockquote>
<p>sql 预编译指的是数据库驱动在发送 sql 语句和参数给 DBMS 之前对 sql 语句进行编译，这样 DBMS 执行 sql 时，就不需要重新编译。</p>
</blockquote>
<h3 id="为什么需要预编译"><a href="#为什么需要预编译" class="headerlink" title="为什么需要预编译"></a>为什么需要预编译</h3><p>JDBC 中使用对象 PreparedStatement 来抽象预编译语句，使用预编译</p>
<ol>
<li><strong>预编译阶段可以优化 sql 的执行</strong>。<br>预编译之后的 sql 多数情况下可以直接执行，DBMS 不需要再次编译，越复杂的 sql，编译的复杂度将越大，预编译阶段可以合并多次操作为一个操作。</li>
<li><strong>预编译语句对象可以重复利用</strong>。<br>把一个 sql 预编译后产生的 PreparedStatement 对象缓存下来，下次对于同一个 sql，可以直接使用这个缓存的 PreparedState 对象。</li>
</ol>
<p>mybatis 默认情况下，将对所有的 sql 进行预编译。</p>
<h3 id="mysql-预编译源码解析"><a href="#mysql-预编译源码解析" class="headerlink" title="mysql 预编译源码解析"></a>mysql 预编译源码解析</h3><p>mysql 的预编译源码在 <code>com.mysql.jdbc.ConnectionImpl</code> 类中，如下：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> synchronized java.sql.PreparedStatement prepareStatement(String sql,</span><br><span class="line">            int resultSetType, int resultSetConcurrency) throws SQLException &#123;</span><br><span class="line">        checkClosed();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// <span class="doctag">FIXME:</span> Create warnings if can&#x27;t create results of the given</span></span><br><span class="line">        <span class="comment">// type or concurrency</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        PreparedStatement pStmt = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        boolean canServerPrepare = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 不同的数据库系统对sql进行语法转换</span></span><br><span class="line">        String nativeSql = getProcessEscapeCodesForPrepStmts() ? nativeSQL(sql): sql;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断是否可以进行服务器端预编译</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.useServerPreparedStmts &amp;&amp; getEmulateUnsupportedPstmts()) &#123;</span><br><span class="line">            canServerPrepare = canHandleAsServerPreparedStatement(nativeSql);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果可以进行服务器端预编译</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.useServerPreparedStmts &amp;&amp; canServerPrepare) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 是否缓存了PreparedStatement对象</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.getCachePreparedStatements()) &#123;</span><br><span class="line">                synchronized (<span class="keyword">this</span>.serverSideStatementCache) &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 从缓存中获取缓存的PreparedStatement对象</span></span><br><span class="line">                    pStmt = (com.mysql.jdbc.ServerPreparedStatement)<span class="keyword">this</span>.serverSideStatementCache.remove(sql);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (pStmt != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// 缓存中存在对象时对原 sqlStatement 进行参数清空等</span></span><br><span class="line">                        ((com.mysql.jdbc.ServerPreparedStatement)pStmt).setClosed(<span class="literal">false</span>);</span><br><span class="line">                        pStmt.clearParameters();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (pStmt == <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="comment">// 如果缓存中不存在，则调用服务器端(数据库)进行预编译</span></span><br><span class="line">                            pStmt = ServerPreparedStatement.getInstance(getLoadBalanceSafeProxy(), nativeSql,</span><br><span class="line">                                    <span class="keyword">this</span>.database, resultSetType, resultSetConcurrency);</span><br><span class="line">                            <span class="keyword">if</span> (sql.length() &lt; getPreparedStatementCacheSqlLimit()) &#123;</span><br><span class="line">                                ((com.mysql.jdbc.ServerPreparedStatement)pStmt).isCached = <span class="literal">true</span>;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// 设置返回类型以及并发类型</span></span><br><span class="line">                            pStmt.setResultSetType(resultSetType);</span><br><span class="line">                            pStmt.setResultSetConcurrency(resultSetConcurrency);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (SQLException sqlEx) &#123;</span><br><span class="line">                            <span class="comment">// Punt, if necessary</span></span><br><span class="line">                            <span class="keyword">if</span> (getEmulateUnsupportedPstmts()) &#123;</span><br><span class="line">                                pStmt = (PreparedStatement) clientPrepareStatement(nativeSql, resultSetType, resultSetConcurrency, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">                                <span class="keyword">if</span> (sql.length() &lt; getPreparedStatementCacheSqlLimit()) &#123;</span><br><span class="line">                                    <span class="keyword">this</span>.serverSideStatementCheckCache.put(sql, <span class="built_in">Boolean</span>.FALSE);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">throw</span> sqlEx;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 未启用缓存时，直接调用服务器端进行预编译</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    pStmt = ServerPreparedStatement.getInstance(getLoadBalanceSafeProxy(), nativeSql,</span><br><span class="line">                            <span class="keyword">this</span>.database, resultSetType, resultSetConcurrency);</span><br><span class="line"></span><br><span class="line">                    pStmt.setResultSetType(resultSetType);</span><br><span class="line">                    pStmt.setResultSetConcurrency(resultSetConcurrency);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException sqlEx) &#123;</span><br><span class="line">                    <span class="comment">// Punt, if necessary</span></span><br><span class="line">                    <span class="keyword">if</span> (getEmulateUnsupportedPstmts()) &#123;</span><br><span class="line">                        pStmt = (PreparedStatement) clientPrepareStatement(nativeSql, resultSetType, resultSetConcurrency, <span class="literal">false</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">throw</span> sqlEx;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 不支持服务器端预编译时调用客户端预编译（不需要数据库 connection ）</span></span><br><span class="line">            pStmt = (PreparedStatement) clientPrepareStatement(nativeSql, resultSetType, resultSetConcurrency, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pStmt;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>流程图如下所示：</p>
<p><img src="https://segmentfault.com/img/bVtwuY" alt="图片描述"></p>
<h2 id="mybatis-之-sql-动态解析以及预编译源码"><a href="#mybatis-之-sql-动态解析以及预编译源码" class="headerlink" title="mybatis 之 sql 动态解析以及预编译源码"></a>mybatis 之 sql 动态解析以及预编译源码</h2><h3 id="mybatis-sql-动态解析"><a href="#mybatis-sql-动态解析" class="headerlink" title="mybatis sql 动态解析"></a>mybatis sql 动态解析</h3><p>mybatis 在调用 connection 进行 sql 预编译之前，会对 sql 语句进行动态解析，动态解析主要包含如下的功能：</p>
<ul>
<li>占位符的处理</li>
<li>动态 sql 的处理</li>
<li>参数类型校验</li>
</ul>
<p>mybatis 强大的动态 SQL 功能的具体实现就在此。动态解析涉及的东西太多，以后再讨论。</p>
<h2 id="批量处理示例（修复歌手名称）"><a href="#批量处理示例（修复歌手名称）" class="headerlink" title="批量处理示例（修复歌手名称）"></a>批量处理示例（修复歌手名称）</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fixSongSingleName</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="comment">// 从0开始</span></span><br><span class="line">     <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">     <span class="comment">// 每次查询100条</span></span><br><span class="line">     <span class="type">int</span> <span class="variable">limit</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">     List&lt;CcMusicInfoEntity&gt; list;</span><br><span class="line">     <span class="keyword">do</span> &#123;</span><br><span class="line">         list = ccMusicInfoMapper.queryListByLastIdWithLimit(id, limit);</span><br><span class="line">         <span class="keyword">if</span> (CollUtil.isEmpty(list)) &#123;</span><br><span class="line">             <span class="keyword">break</span>;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 记录下一次的开始的id</span></span><br><span class="line">         id = list.get(list.size() - <span class="number">1</span>).getId();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 找到需要更新的实体</span></span><br><span class="line">         <span class="keyword">final</span> List&lt;CcMusicInfoEntity&gt; needUpdateList = list.stream()</span><br><span class="line">                 .filter(Objects::nonNull)</span><br><span class="line">                 .filter(it -&gt; SingerNameUtil.isContainCombinedSeparator(it.getSingerName()))</span><br><span class="line">                 .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 在db中更新实体</span></span><br><span class="line">         <span class="keyword">if</span> (CollUtil.isNotEmpty(needUpdateList)) &#123;</span><br><span class="line">             <span class="keyword">final</span> List&lt;String&gt; originSingerNameList = needUpdateList.stream().map(CcMusicInfoEntity::getSingerName).collect(Collectors.toList());</span><br><span class="line">             updateSongSingerInfo(needUpdateList);</span><br><span class="line"></span><br><span class="line">             Map&lt;Integer, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(needUpdateList.size());</span><br><span class="line">             <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; needUpdateList.size(); i++) &#123;</span><br><span class="line">                 <span class="keyword">final</span> <span class="type">CcMusicInfoEntity</span> <span class="variable">entity</span> <span class="operator">=</span> needUpdateList.get(i);</span><br><span class="line">                 <span class="keyword">final</span> <span class="type">String</span> <span class="variable">originSingerName</span> <span class="operator">=</span> originSingerNameList.get(i);</span><br><span class="line">                 map.put(entity.getId(), StrUtil.format(<span class="string">&quot;更新前:&#123;&#125;，更新后:&#123;&#125;&quot;</span>, originSingerName, entity.getSingerName()));</span><br><span class="line">             &#125;</span><br><span class="line">             logger.info(StrUtil.format(<span class="string">&quot;fixSongSingleName 本次更新数量，&#123;&#125;，修改数据：&#123;&#125;&quot;</span>, needUpdateList.size(), map));</span><br><span class="line">         &#125;</span><br><span class="line">         logger.info(<span class="string">&quot;fixSongSingleName: 本次更新到ID，&quot;</span> + id);</span><br><span class="line">         <span class="comment">// break;</span></span><br><span class="line">     &#125; <span class="keyword">while</span> (CollUtil.isNotEmpty(list));</span><br><span class="line">     logger.info(<span class="string">&quot;fixSongSingleName: 本次更新完成&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateSongSingerInfo</span><span class="params">(List&lt;MusicInfoEntity&gt; needUpdateList)</span> &#123;</span><br><span class="line">     List&lt;MusicInfoEntity&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(needUpdateList.size());</span><br><span class="line">     <span class="keyword">for</span> (MusicInfoEntity entity : needUpdateList) &#123;</span><br><span class="line">         <span class="keyword">final</span> <span class="type">String</span> <span class="variable">originSingerName</span> <span class="operator">=</span> entity.getSingerName();</span><br><span class="line">         <span class="keyword">final</span> <span class="type">String</span> <span class="variable">calculateSingerName</span> <span class="operator">=</span> SingerNameUtil.calculate(originSingerName);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 一样的情况，不用处理</span></span><br><span class="line">         <span class="keyword">if</span> (Objects.equals(originSingerName, calculateSingerName)) &#123;</span><br><span class="line">             <span class="keyword">continue</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="type">MusicInfoEntity</span> <span class="variable">newCcMusicInfoEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MusicInfoEntity</span>();</span><br><span class="line">         newCcMusicInfoEntity.setId(entity.getId());</span><br><span class="line">         newCcMusicInfoEntity.setLastUpdateDate(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">         newCcMusicInfoEntity.setSingerName(calculateSingerName);</span><br><span class="line">         list.add(newCcMusicInfoEntity);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (CollUtil.isNotEmpty(list)) &#123;</span><br><span class="line">         musicInfoMapper.updateByList(list);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>批量查询：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// MusicInfoMapper.java</span></span><br><span class="line">List&lt;MusicInfoEntity&gt; <span class="title function_">queryListByLastIdWithLimit</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> <span class="type">int</span> id, <span class="meta">@Param(&quot;limit&quot;)</span> <span class="type">int</span> limit)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updateByList</span><span class="params">(List&lt;MusicInfoEntity&gt; list)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MusicInfoMapper.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryListByLastIdWithLimit&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span> /&gt;</span></span><br><span class="line">    FROM t_music_info a</span><br><span class="line">    where a.id &gt; #&#123;id&#125; limit #&#123;limit&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>批量插入：</strong></p>
<p><a href="https://blog.csdn.net/chijiaodaxie/article/details/50210337">mysql 一条语句 update 多条记录_chijiaodaxie 的博客-CSDN 博客_mysql update 多条数据</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--    原文链接：https://blog.csdn.net/u013506626/article/details/121229892 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByList&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;object&quot;</span>&gt;</span></span><br><span class="line">    update music_info</span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;set&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;singer_name=case&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;end,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">                WHEN id=#&#123;item.id&#125; THEN #&#123;item.singerName&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;last_update_date=case&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;end,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">                WHEN id=#&#123;item.id&#125; THEN #&#123;item.lastUpdateDate&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    WHERE id IN</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        #&#123;item.id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文主要深入探究了 mybatis 对 #{ } 和 ${ }的不同处理方式，并了解了 sql 预编译。</p>
<h2 id="Mybatis-Mapper-xml-继承机制-SegmentFault-思否"><a href="#Mybatis-Mapper-xml-继承机制-SegmentFault-思否" class="headerlink" title="Mybatis Mapper.xml 继承机制 - SegmentFault 思否"></a><a href="https://segmentfault.com/a/1190000012470056">Mybatis Mapper.xml 继承机制 - SegmentFault 思否</a></h2><h2 id="mybatis-中大于等于小于等于的写法"><a href="#mybatis-中大于等于小于等于的写法" class="headerlink" title="mybatis 中大于等于小于等于的写法"></a><a href="https://blog.csdn.net/xuanzhangran/article/details/60329357">mybatis 中大于等于小于等于的写法</a></h2><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">第一种写法（1）：</span><br><span class="line"></span><br><span class="line">原符号       &lt;        &lt;=      &gt;       &gt;=       &amp;        &#x27;        &quot;</span><br><span class="line">替换符号    &amp;lt<span class="comment">;    &amp;lt;=   &amp;gt;    &amp;gt;=   &amp;amp;   &amp;apos;  &amp;quot;</span></span><br><span class="line">例如：sql如下：</span><br><span class="line">create_date_time &amp;gt<span class="comment">;= #&#123;startTime&#125; and  create_date_time &amp;lt;= #&#123;endTime&#125;</span></span><br><span class="line"></span><br><span class="line">第二种写法（2）：</span><br><span class="line">大于等于</span><br><span class="line">&lt;!<span class="section">[CDATA[ &gt;= ]]</span>&gt;</span><br><span class="line">小于等于</span><br><span class="line">&lt;!<span class="section">[CDATA[ &lt;= ]]</span>&gt;</span><br><span class="line">例如：sql如下：</span><br><span class="line">create_date_time &lt;!<span class="section">[CDATA[ &gt;= ]]</span>&gt; <span class="comment">#&#123;startTime&#125; and  create_date_time &lt;![CDATA[ &lt;= ]]&gt; #&#123;endTime&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>sql</tag>
        <tag>java</tag>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-Cloud</title>
    <url>/ssm/spring-cloud/</url>
    <content><![CDATA[<h2 id="spring-cloud-和-spring-boot-版本不对应时，会无法启动"><a href="#spring-cloud-和-spring-boot-版本不对应时，会无法启动" class="headerlink" title="spring cloud 和 spring boot 版本不对应时，会无法启动"></a>spring cloud 和 spring boot 版本不对应时，会无法启动</h2><figure class="highlight roboconf"><table><tr><td class="code"><pre><span class="line">org.springframework.context.ApplicationContextException: Unable to start web server; nested exception is org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat</span><br><span class="line">    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:156) ~[spring-boot-2.2.1.RELEASE.jar:2.2.1.RELEASE]</span><br><span class="line">    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:544) ~[spring-context-5.2.1.RELEASE.jar:5.2.1.RELEASE]</span><br><span class="line">    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:141) ~[spring-boot-2.2.1.RELEASE.jar:2.2.1.RELEASE]</span><br><span class="line">    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:747) ~[spring-boot-2.2.1.RELEASE.jar:2.2.1.RELEASE]</span><br><span class="line">    at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:397) ~[spring-boot-2.2.1.RELEASE.jar:2.2.1.RELEASE]</span><br><span class="line">    at org.springframework.boot.SpringApplication.run(SpringApplication.java:315) ~[spring-boot-2.2.1.RELEASE.jar:2.2.1.RELEASE]</span><br><span class="line">    at org.springframework.boot.builder.SpringApplicationBuilder.run(SpringApplicationBuilder.java:140) [spring-boot-2.2.1.RELEASE.jar:2.2.1.RELEASE]</span><br><span class="line">    at com.eureka.EurekaServerApplication.main(EurekaServerApplication.java:21) [classes/:na]</span><br><span class="line">Caused by: org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat</span><br><span class="line">    at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize(TomcatWebServer.java:126) ~[spring-boot-2.2.1.RELEASE.jar:2.2.1.RELEASE]</span><br><span class="line">    at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.&lt;init&gt;(TomcatWebServer.java:88) ~[spring-boot-2.2.1.RELEASE.jar:2.2.1.RELEASE]</span><br><span class="line">    at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getTomcatWebServer(TomcatServletWebServerFactory.java:438) ~[spring-boot-2.2.1.RELEASE.jar:2.2.1.RELEASE]</span><br><span class="line">    at org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory.getWebServer(TomcatServletWebServerFactory.java:191) ~[spring-boot-2.2.1.RELEASE.jar:2.2.1.RELEASE]</span><br><span class="line">    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.createWebServer(ServletWebServerApplicationContext.java:180) ~[spring-boot-2.2.1.RELEASE.jar:2.2.1.RELEASE]</span><br><span class="line">    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:153) ~[spring-boot-2.2.1.RELEASE.jar:2.2.1.RELEASE]</span><br><span class="line">    ... 7 common frames omitted</span><br><span class="line">Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#x27;traceFilterRegistration&#x27; defined in class path resource [org/springframework/cloud/netflix/eureka/server/EurekaServerAutoConfiguration.class]: Unsatisfied dependency expressed through method &#x27;traceFilterRegistration&#x27; parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type &#x27;javax.servlet.Filter&#x27; available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: &#123;@<span class="attribute">org.springframework.beans.factory.annotation.Qualifier(value=httpTraceFilter)&#125;</span></span><br><span class="line"><span class="attribute">    at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java</span>:787) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.ConstructorResolver</span><span class="variable">.instantiateUsingFactoryMethod</span>(ConstructorResolver<span class="variable">.java</span>:528) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.AbstractAutowireCapableBeanFactory</span><span class="variable">.instantiateUsingFactoryMethod</span>(AbstractAutowireCapableBeanFactory<span class="variable">.java</span>:1338) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.AbstractAutowireCapableBeanFactory</span><span class="variable">.createBeanInstance</span>(AbstractAutowireCapableBeanFactory<span class="variable">.java</span>:1177) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.AbstractAutowireCapableBeanFactory</span><span class="variable">.doCreateBean</span>(AbstractAutowireCapableBeanFactory<span class="variable">.java</span>:557) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.AbstractAutowireCapableBeanFactory</span><span class="variable">.createBean</span>(AbstractAutowireCapableBeanFactory<span class="variable">.java</span>:517) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.AbstractBeanFactory</span><span class="variable">.lambda</span>$doGetBean$0(AbstractBeanFactory<span class="variable">.java</span>:323) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.AbstractBeanFactory</span>$$Lambda$171/204684384<span class="variable">.getObject</span>(Unknown Source) ~[na:na]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.DefaultSingletonBeanRegistry</span><span class="variable">.getSingleton</span>(DefaultSingletonBeanRegistry<span class="variable">.java</span>:222) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.AbstractBeanFactory</span><span class="variable">.doGetBean</span>(AbstractBeanFactory<span class="variable">.java</span>:321) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.AbstractBeanFactory</span><span class="variable">.getBean</span>(AbstractBeanFactory<span class="variable">.java</span>:207) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.boot</span><span class="variable">.web</span><span class="variable">.servlet</span><span class="variable">.ServletContextInitializerBeans</span><span class="variable">.getOrderedBeansOfType</span>(ServletContextInitializerBeans<span class="variable">.java</span>:211) ~[spring-boot-2.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:2.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.boot</span><span class="variable">.web</span><span class="variable">.servlet</span><span class="variable">.ServletContextInitializerBeans</span><span class="variable">.getOrderedBeansOfType</span>(ServletContextInitializerBeans<span class="variable">.java</span>:202) ~[spring-boot-2.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:2.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.boot</span><span class="variable">.web</span><span class="variable">.servlet</span><span class="variable">.ServletContextInitializerBeans</span><span class="variable">.addServletContextInitializerBeans</span>(ServletContextInitializerBeans<span class="variable">.java</span>:96) ~[spring-boot-2.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:2.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.boot</span><span class="variable">.web</span><span class="variable">.servlet</span><span class="variable">.ServletContextInitializerBeans</span>.&lt;init&gt;(ServletContextInitializerBeans<span class="variable">.java</span>:85) ~[spring-boot-2.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:2.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.boot</span><span class="variable">.web</span><span class="variable">.servlet</span><span class="variable">.context</span><span class="variable">.ServletWebServerApplicationContext</span><span class="variable">.getServletContextInitializerBeans</span>(ServletWebServerApplicationContext<span class="variable">.java</span>:253) ~[spring-boot-2.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:2.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.boot</span><span class="variable">.web</span><span class="variable">.servlet</span><span class="variable">.context</span><span class="variable">.ServletWebServerApplicationContext</span><span class="variable">.selfInitialize</span>(ServletWebServerApplicationContext<span class="variable">.java</span>:227) ~[spring-boot-2.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:2.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.boot</span><span class="variable">.web</span><span class="variable">.servlet</span><span class="variable">.context</span><span class="variable">.ServletWebServerApplicationContext</span>$$Lambda$386/305651902<span class="variable">.onStartup</span>(Unknown Source) ~[na:na]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.boot</span><span class="variable">.web</span><span class="variable">.embedded</span><span class="variable">.tomcat</span><span class="variable">.TomcatStarter</span><span class="variable">.onStartup</span>(TomcatStarter<span class="variable">.java</span>:53) ~[spring-boot-2.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:2.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.core</span><span class="variable">.StandardContext</span><span class="variable">.startInternal</span>(StandardContext<span class="variable">.java</span>:5135) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.util</span><span class="variable">.LifecycleBase</span><span class="variable">.start</span>(LifecycleBase<span class="variable">.java</span>:183) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.core</span><span class="variable">.ContainerBase</span>$StartChild<span class="variable">.call</span>(ContainerBase<span class="variable">.java</span>:1384) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.core</span><span class="variable">.ContainerBase</span>$StartChild<span class="variable">.call</span>(ContainerBase<span class="variable">.java</span>:1374) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at java<span class="variable">.util</span><span class="variable">.concurrent</span><span class="variable">.FutureTask</span><span class="variable">.run</span>(FutureTask<span class="variable">.java</span>:266) ~[na:1.8.0_25]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.tomcat</span><span class="variable">.util</span><span class="variable">.threads</span><span class="variable">.InlineExecutorService</span><span class="variable">.execute</span>(InlineExecutorService<span class="variable">.java</span>:75) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at java<span class="variable">.util</span><span class="variable">.concurrent</span><span class="variable">.AbstractExecutorService</span><span class="variable">.submit</span>(AbstractExecutorService<span class="variable">.java</span>:134) ~[na:1.8.0_25]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.core</span><span class="variable">.ContainerBase</span><span class="variable">.startInternal</span>(ContainerBase<span class="variable">.java</span>:909) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.core</span><span class="variable">.StandardHost</span><span class="variable">.startInternal</span>(StandardHost<span class="variable">.java</span>:841) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.util</span><span class="variable">.LifecycleBase</span><span class="variable">.start</span>(LifecycleBase<span class="variable">.java</span>:183) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.core</span><span class="variable">.ContainerBase</span>$StartChild<span class="variable">.call</span>(ContainerBase<span class="variable">.java</span>:1384) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.core</span><span class="variable">.ContainerBase</span>$StartChild<span class="variable">.call</span>(ContainerBase<span class="variable">.java</span>:1374) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at java<span class="variable">.util</span><span class="variable">.concurrent</span><span class="variable">.FutureTask</span><span class="variable">.run</span>(FutureTask<span class="variable">.java</span>:266) ~[na:1.8.0_25]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.tomcat</span><span class="variable">.util</span><span class="variable">.threads</span><span class="variable">.InlineExecutorService</span><span class="variable">.execute</span>(InlineExecutorService<span class="variable">.java</span>:75) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at java<span class="variable">.util</span><span class="variable">.concurrent</span><span class="variable">.AbstractExecutorService</span><span class="variable">.submit</span>(AbstractExecutorService<span class="variable">.java</span>:134) ~[na:1.8.0_25]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.core</span><span class="variable">.ContainerBase</span><span class="variable">.startInternal</span>(ContainerBase<span class="variable">.java</span>:909) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.core</span><span class="variable">.StandardEngine</span><span class="variable">.startInternal</span>(StandardEngine<span class="variable">.java</span>:262) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.util</span><span class="variable">.LifecycleBase</span><span class="variable">.start</span>(LifecycleBase<span class="variable">.java</span>:183) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.core</span><span class="variable">.StandardService</span><span class="variable">.startInternal</span>(StandardService<span class="variable">.java</span>:421) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.util</span><span class="variable">.LifecycleBase</span><span class="variable">.start</span>(LifecycleBase<span class="variable">.java</span>:183) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.core</span><span class="variable">.StandardServer</span><span class="variable">.startInternal</span>(StandardServer<span class="variable">.java</span>:930) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.util</span><span class="variable">.LifecycleBase</span><span class="variable">.start</span>(LifecycleBase<span class="variable">.java</span>:183) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.apache</span><span class="variable">.catalina</span><span class="variable">.startup</span><span class="variable">.Tomcat</span><span class="variable">.start</span>(Tomcat<span class="variable">.java</span>:459) ~[tomcat-embed-core-9.0.27<span class="variable">.jar</span>:9.0.27]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.boot</span><span class="variable">.web</span><span class="variable">.embedded</span><span class="variable">.tomcat</span><span class="variable">.TomcatWebServer</span><span class="variable">.initialize</span>(TomcatWebServer<span class="variable">.java</span>:107) ~[spring-boot-2.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:2.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    ... 12 common frames omitted</span><br><span class="line">Caused by: org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.NoSuchBeanDefinitionException</span>: No qualifying bean of type &#x27;javax<span class="variable">.servlet</span><span class="variable">.Filter</span>&#x27; available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: &#123;@org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.annotation</span><span class="variable">.Qualifier</span>(value=httpTraceFilter)&#125;</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.DefaultListableBeanFactory</span><span class="variable">.raiseNoMatchingBeanFound</span>(DefaultListableBeanFactory<span class="variable">.java</span>:1695) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.DefaultListableBeanFactory</span><span class="variable">.doResolveDependency</span>(DefaultListableBeanFactory<span class="variable">.java</span>:1253) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.DefaultListableBeanFactory</span><span class="variable">.resolveDependency</span>(DefaultListableBeanFactory<span class="variable">.java</span>:1207) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.ConstructorResolver</span><span class="variable">.resolveAutowiredArgument</span>(ConstructorResolver<span class="variable">.java</span>:874) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    at org<span class="variable">.springframework</span><span class="variable">.beans</span><span class="variable">.factory</span><span class="variable">.support</span><span class="variable">.ConstructorResolver</span><span class="variable">.createArgumentArray</span>(ConstructorResolver<span class="variable">.java</span>:778) ~[spring-beans-5.2.1<span class="variable">.RELEASE</span><span class="variable">.jar</span>:5.2.1<span class="variable">.RELEASE</span>]</span><br><span class="line">    ... 54 common frames omitted</span><br></pre></td></tr></table></figure>

<p>查看 spring 官方对应关系和官方文档</p>
<p>spring 官方对应关系：<a href="https://start.spring.io/actuator/info">https://start.spring.io/actuator/info</a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;Finchley.M2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.0.0.M3 and &lt;2.0.0.M5&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Finchley.M3&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.0.0.M5 and &lt;=2.0.0.M5&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Finchley.M4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.0.0.M6 and &lt;=2.0.0.M6&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Finchley.M5&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.0.0.M7 and &lt;=2.0.0.M7&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Finchley.M6&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.0.0.RC1 and &lt;=2.0.0.RC1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Finchley.M7&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.0.0.RC2 and &lt;=2.0.0.RC2&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Finchley.M9&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.0.0.RELEASE and &lt;=2.0.0.RELEASE&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Finchley.RC1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.0.1.RELEASE and &lt;2.0.2.RELEASE&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Finchley.RC2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.0.2.RELEASE and &lt;2.0.3.RELEASE&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Finchley.SR4&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.0.3.RELEASE and &lt;2.0.999.BUILD-SNAPSHOT&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Finchley.BUILD-SNAPSHOT&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.0.999.BUILD-SNAPSHOT and &lt;2.1.0.M3&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Greenwich.M1&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.1.0.M3 and &lt;2.1.0.RELEASE&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Greenwich.SR6&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.1.0.RELEASE and &lt;2.1.16.BUILD-SNAPSHOT&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Greenwich.BUILD-SNAPSHOT&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.1.16.BUILD-SNAPSHOT and &lt;2.2.0.M4&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Hoxton.SR6&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.2.0.M4 and &lt;2.3.2.BUILD-SNAPSHOT&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;Hoxton.BUILD-SNAPSHOT&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.3.2.BUILD-SNAPSHOT and &lt;2.4.0.M1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;2020.0.0-SNAPSHOT&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring Boot &gt;=2.4.0.M1&quot;</span></span><br></pre></td></tr></table></figure>

<p>官方文档：<a href="https://spring.io/projects/spring-cloud">https://spring.io/projects/spring-cloud</a></p>
<ul>
<li><a href="https://www.cnblogs.com/koudaiyoutang/p/11995137.html">springboot 和 springcloud 版本冲突问题 - Alice 口袋有糖 - 博客园</a></li>
</ul>
]]></content>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-Log</title>
    <url>/ssm/spring-log/</url>
    <content><![CDATA[<h2 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Logback --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="添加配置"><a href="#添加配置" class="headerlink" title="添加配置"></a>添加配置</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- logback-spring.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;60 seconds&quot;</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">contextName</span>&gt;</span>logback<span class="tag">&lt;/<span class="name">contextName</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--输出到控制台 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;HH:mm:ss&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--按天生成日志 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;logFile&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">FileNamePattern</span>&gt;</span> /logs/spring-lovelist/%d&#123;yyyy-MM-dd&#125;/%d&#123;yyyy-MM-dd&#125;.%i.log <span class="tag">&lt;/<span class="name">FileNamePattern</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>200MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>100<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;console&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;logFile&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-Mvc</title>
    <url>/ssm/spring-mvc/</url>
    <content><![CDATA[<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p><img src="/.com//mvc_flow.png" alt="mvc 流程"></p>
<h2 id="处理器是如何-JSON-转换成-Java-对象"><a href="#处理器是如何-JSON-转换成-Java-对象" class="headerlink" title="处理器是如何 JSON 转换成 Java 对象"></a>处理器是如何 JSON 转换成 Java 对象</h2><p>使用的是 HttpMessageConverter 机制<br>在这个接口里面有 5 个方法，canRead, canWrite, write, read, getSupportMediaTypes<br>在发起 http 请求的时候，先读取 HTTP 请求的请求体；<br>然后在 HttpMessageConverter 众多实例中（由 Spring MVC 组织成一条链存放）根据 canRead 方法来判断实例能否转换，<br>这样就找到了 MappingJackson2HttpMessageConverter 实例了，<br>接着执行 read 方法，将请求体转换成 Java 对象。<br><a href="https://m.imooc.com/collector/read/62">https://m.imooc.com/collector/read/62</a></p>
<h2 id="IDEA-配置-tomcat"><a href="#IDEA-配置-tomcat" class="headerlink" title="IDEA 配置 tomcat"></a>IDEA 配置 tomcat</h2><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/202203021514358.png" alt="202203021514358"><br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/202203021515228.png" alt="202203021515228"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://iamsaurabh.wordpress.com/2017/02/11/configure-a-spring-mvc-project-with-intellij-idea/">Configure a Spring MVC Project with Intellij IDEA | In My Own Write</a></li>
<li><a href="https://www.jianshu.com/p/bae8f30300c5">Maven + Spring mvc 配置 webApp</a></li>
<li><a href="https://github.com/lyloou/spring-mvc-simple-demo">spring-mvc-simple-demo</a></li>
</ul>
]]></content>
      <tags>
        <tag>java</tag>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-Security</title>
    <url>/ssm/spring-security/</url>
    <content><![CDATA[<p><a href="http://www.iocoder.cn/Spring-Boot/Spring-Security/?self">芋道 Spring Boot 安全框架 Spring Security 入门 | 芋道源码 —— 纯源码解析博客</a></p>
]]></content>
      <tags>
        <tag>ssm</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring基础</title>
    <url>/ssm/spring/</url>
    <content><![CDATA[<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">Bean的完整生命周期经历了各种方法调用，这些方法可以划分为以下几类：</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、Bean自身的方法　　：　　这个包括了Bean本身调用的方法和通过配置文件中&lt;bean&gt;的init-<span class="keyword">method</span>和<span class="title function_">destroy</span>-<span class="title function_">method</span>指定的方法</span><br><span class="line"></span><br><span class="line">2、<span class="title function_">Bean</span>级生命周期接口方法　　：　　这个包括了<span class="title function_">BeanNameAware</span>、<span class="title function_">BeanFactoryAware</span>、<span class="title function_">InitializingBean</span>和<span class="title function_">DiposableBean</span>这些接口的方法</span><br><span class="line"></span><br><span class="line">3、容器级生命周期接口方法　　：　　这个包括了<span class="title function_">InstantiationAwareBeanPostProcessor</span> 和 <span class="title function_">BeanPostProcessor</span> 这两个接口实现，一般称它们的实现类为“后处理器”。</span><br><span class="line"></span><br><span class="line">4、工厂后处理器接口方法　　：　　这个包括了<span class="title function_">AspectJWeavingEnabler</span>, <span class="title function_">ConfigurationClassPostProcessor</span>, <span class="title function_">CustomAutowireConfigurer</span>等等非常有用的工厂后处理器　　接口的方法。工厂后处理器也是容器级的。在应用上下文装配配置文件之后立即调用。</span><br></pre></td></tr></table></figure>

<h2 id="AOP-切面的几种通知"><a href="#AOP-切面的几种通知" class="headerlink" title="AOP 切面的几种通知"></a>AOP 切面的几种通知</h2><p><img src="http://cdn.lyloou.com/img/spring-2021-08-24-18-40-42.png" alt="spring-2021-08-24-18-40-42"></p>
<p><a href="https://www.cnblogs.com/zrtqsk/p/3735273.html">Spring Bean 的生命周期（非常详细） - Chandler Qian - 博客园</a></p>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><p>版本问题：<br>例如：<code>4.0.0.RELEASE</code>版本对 Component 和 ComponentScan 支持不好，<br>而<code>4.3.2.RELEASE</code>是支持很好的。</p>
<h2 id="sprring-boot-测试"><a href="#sprring-boot-测试" class="headerlink" title="sprring boot 测试"></a>sprring boot 测试</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@Profile(&quot;dev&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = ApiTvApplication.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoServiceImplTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DemoServiceImpl demoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>java</tag>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Springboot</title>
    <url>/ssm/springboot/</url>
    <content><![CDATA[<p>maven: <a href="http://wiki.jikexueyuan.com/project/maven/">http://wiki.jikexueyuan.com/project/maven/</a><br>spring: <a href="https://wiki.jikexueyuan.com/project/spring">https://wiki.jikexueyuan.com/project/spring</a></p>
<h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><p>注解仅仅是对类加上了一些元信息，如果不使用反射等 API 对其进行探测、处理，和不加注解没有任何区别。<br><a href="https://course.tianmaying.com/web-development+form-validation#">https://course.tianmaying.com/web-development+form-validation#</a></p>
<p>任何一个标注了@Bean 的方法，其返回值将作为一个 bean 定义注册到 Spring 的 IoC 容器，方法名将默认成该 bean 定义的 id。<br><a href="http://tengj.top/2017/03/09/springboot3/">http://tengj.top/2017/03/09/springboot3/</a></p>
<p>Spring Boot 常用注解（一） - 声明 Bean 的注解 - CSDN 博客<br><a href="https://blog.csdn.net/lipinganq/article/details/79155072">https://blog.csdn.net/lipinganq/article/details/79155072</a></p>
<h2 id="JOOQ"><a href="#JOOQ" class="headerlink" title="JOOQ"></a>JOOQ</h2><p><a href="https://www.jooq.org/doc/3.10/manual/">https://www.jooq.org/doc/3.10/manual/</a></p>
<p>JOOQ 3.8.2 使用 教程：从入门到提高<br><a href="https://amao12580.github.io/post/2016/04/JOOQ-from-entry-to-improve/">https://amao12580.github.io/post/2016/04/JOOQ-from-entry-to-improve/</a></p>
<h2 id="spring-boot-devtools"><a href="#spring-boot-devtools" class="headerlink" title="spring-boot-devtools"></a>spring-boot-devtools</h2><p>Spring Boot 1.3 has introduced devtools, a module to improve the development-time experience when working on Spring Boot applications. To enable it, just add the following dependency to your project:<br>(<a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/usage.html">https://docs.spring.io/spring-boot/docs/current/maven-plugin/usage.html</a>)</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>When devtools is running, it detects change when you recompile your application and automatically refreshes it. This works for not only resources but code as well. It also provides a LiveReload server so that it can automatically trigger a browser refresh whenever things change.<br>Devtools can also be configured to only refresh the browser whenever a static resource has changed (and ignore any change in the code). Just include the following property in your project:</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.devtools.remote.restart.enabled</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">   _____</span><br><span class="line">  /  _  \__  _  __ ____   __________   _____   ____</span><br><span class="line"> /  /_\  \ \/ \/ // __ \ /  ___/  _ \ /     \_/ __ \</span><br><span class="line">/    |    \     /\  ___/ \___ (  &lt;_&gt; )  Y Y  \  ___/</span><br><span class="line">\____|__  /\/\_/  \___  &gt;____  &gt;____/|__|_|  /\___  &gt;</span><br><span class="line">        \/            \/     \/            \/     \/</span><br><span class="line"></span><br><span class="line">// spring banner</span><br><span class="line">// file name: src/main/resources/banner.txt</span><br><span class="line">// design by http://patorjk.com/software/taag</span><br><span class="line">// [18-SpringBoot——核心-基本配置 - https://github.com/Wang-Jun-Chao - CSDN博客](https://blog.csdn.net/DERRANTCM/article/details/77284924)</span><br></pre></td></tr></table></figure>

<h2 id="下面这两种有什么区别呢"><a href="#下面这两种有什么区别呢" class="headerlink" title="下面这两种有什么区别呢"></a>下面这两种有什么区别呢</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 2  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>参照<a href="https://www.cnblogs.com/maohuidong/p/11507362.html">spring.profiles.active=@profiles.active@的含义 - 毛会懂 - 博客园</a><br>在动态配置环境的过程中，如果用了 2（新建项目时自动生成的） 而没有用 1，就会导致报一个错误<br>@profiles.active@ IllegalStateException: Failed to load property source from spring.profile.active</p>
<h2 id="参数验证"><a href="#参数验证" class="headerlink" title="参数验证"></a>参数验证</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// controller</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;[管理后台]-[放映厅]-片单管理API&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/playlist&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor(onConstructor = @__(@Autowired))</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlaylistController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;列出片单&quot;, notes = &quot;根据参数列出符合要求的片单&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResultMsg&lt;PageInfo&lt;PlaylistCo&gt;&gt; <span class="title function_">listPlaylist</span><span class="params">(<span class="meta">@Valid</span> PlaylistListQry qry)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> renderSuccessData(playlistAdminService.listPlaylistByPage(qry));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PlaylistListQry.java</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;列出片单列表参数实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlaylistListQry</span> <span class="keyword">extends</span> <span class="title class_">CommonCommand</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;放映状态&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer playStatus;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;页码不能为空&quot;)</span> <span class="meta">@Min(value = 1, message = &quot;页码要大于0&quot;)</span></span><br><span class="line">    Integer pageNo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;每页大小不能为空&quot;)</span> <span class="meta">@Min(value = 1, message = &quot;每页大小要大于0&quot;)</span></span><br><span class="line">    Integer pageSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误统一处理</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="meta">@Order(value = Ordered.HIGHEST_PRECEDENCE)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(ValidationException.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> ResponseVO <span class="title function_">handle</span><span class="params">(ValidationException exception)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> ConstraintViolationException) &#123;</span><br><span class="line">            <span class="type">ConstraintViolationException</span> <span class="variable">exs</span> <span class="operator">=</span> (ConstraintViolationException) exception;</span><br><span class="line"></span><br><span class="line">            Set&lt;ConstraintViolation&lt;?&gt;&gt; violations = exs.getConstraintViolations();</span><br><span class="line">            <span class="keyword">for</span> (ConstraintViolation&lt;?&gt; item : violations) &#123;</span><br><span class="line">                <span class="comment">//打印验证不通过的信息</span></span><br><span class="line">                message = item.getMessage();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理实体字段验证不通过异常</span></span><br><span class="line">        <span class="keyword">if</span>( exception <span class="keyword">instanceof</span>  MethodArgumentNotValidException)&#123;</span><br><span class="line">          message = getDefaultMessageStr((MethodArgumentNotValidException) e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseVO.buildIllegalMsg(message);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getDefaultMessageStr</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">result</span> <span class="operator">=</span> e.getBindingResult();</span><br><span class="line">        <span class="keyword">final</span> List&lt;FieldError&gt; fieldErrors = result.getFieldErrors();</span><br><span class="line">        <span class="type">String</span> <span class="variable">defaultMessageStr</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtil.isEmpty(fieldErrors)) &#123;</span><br><span class="line">            <span class="keyword">final</span> List&lt;String&gt; msgList = fieldErrors.stream().map(FieldError::getDefaultMessage)</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">            defaultMessageStr = StrUtil.join(<span class="string">&quot;, &quot;</span>, msgList);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> defaultMessageStr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分页处理"><a href="#分页处理" class="headerlink" title="分页处理"></a>分页处理</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// controller</span></span><br><span class="line">  <span class="meta">@ApiOperation(value = &quot;列出片单&quot;, notes = &quot;根据参数列出符合要求的片单&quot;)</span></span><br><span class="line">  <span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> ResultMsg&lt;PageInfo&lt;PlaylistCo&gt;&gt; <span class="title function_">listPlaylist</span><span class="params">(<span class="meta">@Valid</span> PlaylistListQry qry)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> renderSuccessData(playlistAdminService.listPlaylistByPage(qry));</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// serviceImpl</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageInfo&lt;PlaylistCo&gt; <span class="title function_">listPlaylistByPage</span><span class="params">(PlaylistListQry qry)</span> &#123;</span><br><span class="line">        List&lt;PlaylistCo&gt; playlistCoList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// https://pagehelper.github.io/docs/howtouse/</span></span><br><span class="line">        <span class="comment">// https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/en/HowToUse.md</span></span><br><span class="line">        <span class="comment">// com.github.pagehelper.PageHelper</span></span><br><span class="line">        PageHelper.startPage(qry.getPageNo(), qry.getPageSize());</span><br><span class="line">        <span class="comment">// 根据状态获取片单</span></span><br><span class="line">        <span class="keyword">final</span> List&lt;PlaylistEntity&gt; playlistEntityList = playlistService.lambdaQuery()</span><br><span class="line">                .eq(qry.getPlayStatus() != <span class="literal">null</span>, PlaylistEntity::getPlayStatus, qry.getPlayStatus())</span><br><span class="line">                .eq(PlaylistEntity::getDeleted, DeleteType.NOT_DELETE.getCode())</span><br><span class="line">                .eq(PlaylistEntity::getCheckStatus, CheckStatusType.APPROVED.getCode())</span><br><span class="line">                .list();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (playlistEntityList.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> PageHelpUtils.getPageInfoFromView(playlistEntityList, playlistCoList);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 转换片单实体</span></span><br><span class="line">        playlistCoList = playlistEntityList.stream().map(playlistConvertor::toCo).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> PageHelpUtils.getPageInfoFromView(playlistEntityList, playlistCoList);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// [Mybatis3.4.x技术内幕（二十）：PageHelper分页插件源码及原理剖析 - 祖大俊的个人页面 - OSCHINA - 中文开源技术交流社区](https://my.oschina.net/zudajun/blog/745232)</span></span><br><span class="line"><span class="comment">// PageHelpUtils.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageHelpUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转换数据list为带分页格式</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataList 数据list</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> pageinfo格式的数据list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; PageInfo&lt;T&gt; <span class="title function_">getPageInfo</span><span class="params">(List&lt;T&gt; dataList)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;T&gt;(dataList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转换数据list为带分页格式，并替换数据为viewlist</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sourceDataList 数据库对应list</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> viewList       展现层list</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 带分页格式的展现层list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; PageInfo&lt;T&gt; <span class="title function_">getPageInfoFromView</span><span class="params">(List sourceDataList, List&lt;T&gt; viewList)</span> &#123;</span><br><span class="line">        <span class="type">PageInfo</span> <span class="variable">pageInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageInfo</span>(sourceDataList);</span><br><span class="line">        pageInfo.setList(viewList);</span><br><span class="line">        <span class="keyword">return</span> pageInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>效果</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;00000&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;success&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;roomId&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;playlistName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;片单2&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;playStatus&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;memo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;备注&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;roomId&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;playlistName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;片单3&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;playStatus&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;memo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;备注&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;roomId&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;playlistName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;片单4&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;playTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-03-18 17:53:38&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;playStatus&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;checkStatus&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;checkTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-03-25 16:18:56&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;roomId&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;playlistName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;片单5&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;playStatus&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;memo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;备注&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pageNum&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pageSize&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;startRow&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;endRow&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;prePage&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nextPage&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isFirstPage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isLastPage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hasPreviousPage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hasNextPage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;navigatePages&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;navigatepageNums&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;navigateFirstPage&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;navigateLastPage&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h2><p><a href="https://www.javaer101.com/article/2490162.html">RestTemplate 交换，未为带下划线的字段映射值 - Javaer101</a></p>
<p>使用 <code>@JsonProperty</code> 注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonProperty(&quot;Test_Id&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String Test_Id; <span class="comment">// prefer rename to testId</span></span><br></pre></td></tr></table></figure>

<h2 id="CROS-跨域处理"><a href="#CROS-跨域处理" class="headerlink" title="CROS 跨域处理"></a>CROS 跨域处理</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CorsConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean&lt;CorsFilter&gt; <span class="title function_">corsFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>() &#123;&#123;</span><br><span class="line">            setAllowCredentials(<span class="literal">true</span>);</span><br><span class="line">            addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">            addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">            addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        &#125;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">CorsFilter</span> <span class="variable">corsFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsFilter</span>(<span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>() &#123;&#123;</span><br><span class="line">            registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, config);</span><br><span class="line">        &#125;&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>&lt;CorsFilter&gt;(corsFilter) &#123;&#123;</span><br><span class="line">            setOrder(<span class="number">0</span>);</span><br><span class="line">        &#125;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Spring-Boot-之-Enable-注解的工作原理-简书"><a href="#Spring-Boot-之-Enable-注解的工作原理-简书" class="headerlink" title="Spring-Boot 之@Enable*注解的工作原理 - 简书"></a><a href="https://www.jianshu.com/p/3da069bd865c">Spring-Boot 之@Enable*注解的工作原理 - 简书</a></h2><h2 id="扫描"><a href="#扫描" class="headerlink" title="扫描"></a>扫描</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">com.lyloou.*;</span><br><span class="line">com.lyloou.**;</span><br></pre></td></tr></table></figure>

<p><code>**</code>匹配当前包和子包：如 com.lyloou 包下的Bean可以识别，com.lyloou.demo 也可以识别。<br>而<code>*</code>只能匹配子包：如 com.lyloou 包下的Bean识别不了。com.lyloou.demo下面的可以识别。</p>
<p><a href="https://blog.csdn.net/u012325167/article/details/75388990?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1.pc_relevant_paycolumn_v3&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1.pc_relevant_paycolumn_v3&utm_relevant_index=1">关于component-scan中base-package包含通配符的问题探究_陈夏明的博客-CSDN博客_basepackages通配符</a></p>
<p><a href="https://blog.csdn.net/SunnyDay87/article/details/106391759">Spring boot basePackages 通配符* 找不到Bean_小小一只の蜗牛的博客-CSDN博客_basepackages通配符</a></p>
]]></content>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Jpa</title>
    <url>/ssm/springjpa/</url>
    <content><![CDATA[<h2 id="2-ddl-auto"><a href="#2-ddl-auto" class="headerlink" title="2. ddl-auto"></a>2. ddl-auto</h2><p><a href="https://links.jianshu.com/go?to=https://blog.csdn.net/YoungLee16/article/details/88990763">ddl-auto</a><br>自己手动测试下呗</p>
<p><img src="http://cdn.lyloou.com/img/4165335-be4de4bd296bbde2.png" alt="img"></p>
<p>ddl-auto 可取的值</p>
<p>1）spring.jpa.hibernate.ddl-auto=create<br>Hibernate: drop table if exists auth_user<br>Hibernate: create table auth_user (id bigint not null, account varchar(32), name varchar(32), pwd varchar(64), primary key (id)) engine=InnoDB<br>Hibernate 删掉已经存在表， 并重建表，恐怖！！！</p>
<ol>
<li>spring.jpa.hibernate.ddl-auto=create-drop</li>
</ol>
<p>Hibernate: drop table if exists auth_user<br>Hibernate: drop table if exists cardo<br>Hibernate: create table auth_user (id bigint not null, account varchar(32), name varchar(32), pwd varchar(64), primary key (id)) engine=InnoDB<br>Hibernate: create table cardo (id bigint not null, brand_id integer, brand_name varchar(16), primary key (id)) engine=InnoDB<br>…<br>Hibernate: drop table if exists auth_user<br>Hibernate: drop table if exists cardo</p>
<ol>
<li>spring.jpa.hibernate.ddl-auto=update<br>Hibernate: create table auth_user (id bigint not null, account varchar(32), name varchar(32), pwd varchar(64), primary key (id)) engine=InnoDB<br>Hibernate: create table cardo (id bigint not null, brand_id integer, brand_name varchar(16), primary key (id)) engine=InnoDB</li>
</ol>
<p>给 entity 类添加一个字段 others, 表也会自动同步添加一个字段 others.</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = <span class="string">&quot;AUTH_USER&quot;</span>)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDO</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Long</span> id;</span><br><span class="line">    <span class="meta">@Column(length = 32)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Column(length = 32)</span></span><br><span class="line">    <span class="keyword">private</span> String account;</span><br><span class="line">    <span class="meta">@Column(length = 64)</span></span><br><span class="line">    <span class="keyword">private</span> String pwd;</span><br><span class="line">    <span class="meta">@Column(length = 255)</span></span><br><span class="line">    <span class="keyword">private</span> String others;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加个字段 others<br>Hibernate: alter table auth_user add column others varchar(255)<br>给表添加了字段 others.</p>
<p>表添加一个字段， 对 entity 类有啥影响？<br>没有任何影响.<br>Hibernate: insert into auth_user (account, name, others, pwd, id) values (?, ?, ?, ?, ?)</p>
<p>不会校验 entity 中字段类型和表中对应的字段的类型是否匹配。</p>
<ol>
<li>spring.jpa.hibernate.ddl-auto=validate</li>
</ol>
<p>当表中字段 others 是 varchar 类型， 实体类 entity 的 others 是 Integer 类型，<br>类型不匹配报错：</p>
<p>Caused by: org.hibernate.tool.schema.spi.SchemaManagementException: Schema-validation: wrong column type encountered in column [others] in table [auth_user]; found [varchar (Types#VARCHAR)], but expecting [integer (Types#INTEGER)]</p>
<ol>
<li><p>spring.jpa.hibernate.ddl-auto=none<br>禁止 ddl</p>
</li>
<li><p>ddl-auto 不能同时指定多个属性， 只能在 create, create-drop, update, validate, none 中选择一个属性</p>
</li>
<li><p>总结：<br>一般选择 validate/update/none<br>绝对不能选 create, create-drop</p>
</li>
</ol>
<p>update 能帮助建表。</p>
<p>如果希望实体类发生改动而数据库表做出相应的更改且不破坏数据库现有的数据，要将 spring.jpa.hibernate.ddl-auto 属性值设置为 update</p>
<p>这里还有一点，就算把 ddl-auto 设置成 update 值，也不能识别对表结构的所有更改，往往只能识别出增加的字段，比如修改字段名，修改字段类型或者删除一个字段都是不能够识别的。</p>
<p>ddl-auto：create —-每次运行该程序，没有表格会新建表格，表内有数据会清空；<br>ddl-auto：create-drop —-每次程序结束的时候会清空表<br>ddl-auto：update —- 每次运行程序，没有表格会新建表格，表内有数据不会清空，只会更新<br>ddl-auto： validate —- 运行程序会校验数据与数据库的字段类型是否相同，不同会报错。</p>
<p>作者：BenjaminCool<br>链接：<a href="https://www.jianshu.com/p/bc509369b3a3">https://www.jianshu.com/p/bc509369b3a3</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
]]></content>
      <tags>
        <tag>sql</tag>
        <tag>ssm</tag>
      </tags>
  </entry>
  <entry>
    <title>【SSM】swagger相关</title>
    <url>/ssm/swagger/</url>
    <content><![CDATA[<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><p>idea 插件：Swagger Tool - <a href="https://github.com/Pwhxbdk/swagger-tool">https://github.com/Pwhxbdk/swagger-tool</a></p>
<h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><p><a href="https://github.com/swagger-api/swagger-core/wiki/Annotations-1.5.X#quick-annotation-overview">Annotations 1.5.X · swagger-api/swagger-core Wiki</a></p>
<p><a href="https://juejin.cn/post/7038473995640897543">Swagger 笔记之 Swagger 注解 - 掘金</a></p>
<p><a href="https://blog.csdn.net/u014231523/article/details/54562695">SpringBoot 集成 springfox-swagger2 构建 restful API_兴国-为梦想而战-CSDN 博客_springboot springfox-swagger2</a></p>
<p><a href="https://blog.csdn.net/u014231523/article/details/76522486">swagger2 常用注解说明_兴国-为梦想而战-CSDN 博客_swagger 常用注解</a></p>
<p><a href="https://github.com/OAI/OpenAPI-Specification/blob/main/versions/2.0.md#data-types">datatype 数据类型</a></p>
]]></content>
      <tags>
        <tag>java</tag>
        <tag>ssm</tag>
      </tags>
  </entry>
  <entry>
    <title>【Spring】加密</title>
    <url>/ssm/%E5%8A%A0%E5%AF%86/</url>
    <content><![CDATA[<p>shiro<br>sprint-security</p>
]]></content>
      <tags>
        <tag>java</tag>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring异常</title>
    <url>/ssm/%E5%BC%82%E5%B8%B8/</url>
    <content><![CDATA[<h2 id="Java-lang-NoClassDefFoundError-com-fasterxml-jackson-databind-exc-InvalidDefinitionException"><a href="#Java-lang-NoClassDefFoundError-com-fasterxml-jackson-databind-exc-InvalidDefinitionException" class="headerlink" title="Java.lang.NoClassDefFoundError: com/fasterxml/jackson/databind/exc/InvalidDefinitionException"></a><a href="https://stackoverflow.com/questions/44718345/java-lang-noclassdeffounderror-com-fasterxml-jackson-databind-exc-invaliddefini/48566390">Java.lang.NoClassDefFoundError: com/fasterxml/jackson/databind/exc/InvalidDefinitionException</a></h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- change jackson-databind version to 2.9.4 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="mysql运行报The-server-time-zone-value-‘OÐ¹u±e×¼E±¼a’-is-unrecognized-or-represents-more-than-one-time-z"><a href="#mysql运行报The-server-time-zone-value-‘OÐ¹u±e×¼E±¼a’-is-unrecognized-or-represents-more-than-one-time-z" class="headerlink" title="mysql运行报The server time zone value ‘ÖÐ¹ú±ê×¼Ê±¼ä’ is unrecognized or represents more than one time z"></a><a href="https://blog.csdn.net/yuxisanno139/article/details/80705332">mysql运行报The server time zone value ‘ÖÐ¹ú±ê×¼Ê±¼ä’ is unrecognized or represents more than one time z</a></h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> &quot;%time_zone&quot;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> time_zone<span class="operator">=</span>&quot;+8:00&quot;</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.39<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="idea-Error-parsing-SQL-Mapper-Configuration-Cause-java-io-IOException-Could-not-find-resource"><a href="#idea-Error-parsing-SQL-Mapper-Configuration-Cause-java-io-IOException-Could-not-find-resource" class="headerlink" title="idea Error parsing SQL Mapper Configuration. Cause: java.io.IOException: Could not find resource"></a>idea Error parsing SQL Mapper Configuration. Cause: java.io.IOException: Could not find resource</h2><p><a href="https://blog.csdn.net/u010648555/article/details/70880425">https://blog.csdn.net/u010648555/article/details/70880425</a><br>方案1：不将xml放到src目录下面，将xxxMapper.xml放到Maven构建的resource目录下面！<br>方案2：在Maven的pom文件中，添加下面代码：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>java</tag>
        <tag>spring</tag>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>文件处理</title>
    <url>/ssm/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<h2 id="返回图片思路-1"><a href="#返回图片思路-1" class="headerlink" title="返回图片思路 1"></a>返回图片思路 1</h2><p><a href="https://stackoverflow.com/questions/5690228/spring-mvc-how-to-return-image-in-responsebody">Spring MVC: How to return image in @ResponseBody? - Stack Overflow</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/photo2&quot;, method = RequestMethod.GET, produces = MediaType.IMAGE_JPEG_VALUE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] testphoto() <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> servletContext.getResourceAsStream(<span class="string">&quot;/images/no_image.jpg&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> IOUtils.toByteArray(in);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// JavaScript</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getcaptcha</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/api/user/getcaptcha&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    <span class="attr">responseType</span>: <span class="string">&#x27;blob&#x27;</span>,</span><br><span class="line">    params,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="返回图片思路-2"><a href="#返回图片思路-2" class="headerlink" title="返回图片思路 2"></a>返回图片思路 2</h2><p>将图片作为 base64 字符串返回，前端渲染 base64 即可。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 引入 hutool 的验证码功能</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getCaptcha</span><span class="params">(String captchaKey)</span> &#123;</span><br><span class="line">    <span class="type">LineCaptcha</span> <span class="variable">lineCaptcha</span> <span class="operator">=</span> CaptchaUtil.createLineCaptcha(<span class="number">160</span>, <span class="number">80</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">captchaCode</span> <span class="operator">=</span> lineCaptcha.getCode();</span><br><span class="line">    codeCache.set(captchaKey, captchaCode, Duration.ofMinutes(<span class="number">5</span>).getSeconds());</span><br><span class="line">    <span class="keyword">return</span> lineCaptcha.getImageBase64Data();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="spring-异步处理上传的文件时，自动删除问题"><a href="#spring-异步处理上传的文件时，自动删除问题" class="headerlink" title="spring 异步处理上传的文件时，自动删除问题"></a>spring 异步处理上传的文件时，自动删除问题</h2><ul>
<li><a href="https://segmentfault.com/a/1190000038544706">上传文件异步处理注意事项 - SegmentFault 思否</a></li>
<li><a href="https://stackoverflow.com/questions/36565597/spring-async-file-upload-and-processing">Spring async file upload and processing - Stack Overflow</a></li>
</ul>
]]></content>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring面试題</title>
    <url>/ssm/%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
    <content><![CDATA[<h1 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a><a href="https://m.imooc.com/collector/read/76">面试题</a></h1><h2 id="Spring-MVC-的全流程是什么？"><a href="#Spring-MVC-的全流程是什么？" class="headerlink" title="Spring MVC 的全流程是什么？"></a>Spring MVC 的全流程是什么？</h2><p><img src="/.com//mvc_flow.png" alt="mvc_flow"><br><a href="https://m.imooc.com/collector/read/60">https://m.imooc.com/collector/read/60</a></p>
<h2 id="在-Spring-MVC-中，为什么-RequestBody-可以从-JSON-转换出-Java-对象，而-ResponseBody-可以将控制器返回转换出-JSON-数据集？"><a href="#在-Spring-MVC-中，为什么-RequestBody-可以从-JSON-转换出-Java-对象，而-ResponseBody-可以将控制器返回转换出-JSON-数据集？" class="headerlink" title="在 Spring MVC 中，为什么 @RequestBody 可以从 JSON 转换出 Java 对象，而 @ResponseBody 可以将控制器返回转换出 JSON 数据集？"></a>在 Spring MVC 中，为什么 @RequestBody 可以从 JSON 转换出 Java 对象，而 @ResponseBody 可以将控制器返回转换出 JSON 数据集？</h2><p>HttpMessageConverter<T><br><a href="https://m.imooc.com/collector/read/62">https://m.imooc.com/collector/read/62</a></T></p>
<h2 id="MyBatis-存在哪些组件，各个组件的生命周期是怎么样的，我们应该怎么使用它们？"><a href="#MyBatis-存在哪些组件，各个组件的生命周期是怎么样的，我们应该怎么使用它们？" class="headerlink" title="MyBatis 存在哪些组件，各个组件的生命周期是怎么样的，我们应该怎么使用它们？"></a>MyBatis 存在哪些组件，各个组件的生命周期是怎么样的，我们应该怎么使用它们？</h2><p>SqlSessionFactory<br>SqlSession<br>Mapper</p>
<p>Configuration<br>Plugin<br>TypeHandler<br>Alias</p>
<p><a href="https://m.imooc.com/collector/read/63">https://m.imooc.com/collector/read/63</a></p>
<h2 id="MyBatis-的-TypeHandler-的作用是什么，我们应该如何使用它？"><a href="#MyBatis-的-TypeHandler-的作用是什么，我们应该如何使用它？" class="headerlink" title="MyBatis 的 TypeHandler 的作用是什么，我们应该如何使用它？"></a>MyBatis 的 TypeHandler 的作用是什么，我们应该如何使用它？</h2><p>实现从数据库和POJO之间的相互转换。</p>
<p>使用</p>
<ol>
<li>实现TypeHandler<T></T></li>
<li>注册到MyBatis上下文</li>
<li>在mapper的xml文件中使用：如<code>#&#123;sex, typeHandler=com.imooc.ssm.typehandler.SexTypeHandler&#125;</code></li>
</ol>
<p><a href="https://m.imooc.com/collector/read/65">https://m.imooc.com/collector/read/65</a></p>
<h2 id="什么是-MyBatis-插件技术？我们应该如何开发-MyBatis-插件？"><a href="#什么是-MyBatis-插件技术？我们应该如何开发-MyBatis-插件？" class="headerlink" title="什么是 MyBatis 插件技术？我们应该如何开发 MyBatis 插件？"></a>什么是 MyBatis 插件技术？我们应该如何开发 MyBatis 插件？</h2><p>通过动态代理的方式来修改MyBatis的底层内容；<br>插件应用：如分页插件、性能分析插件</p>
<p>开发步骤：</p>
<ol>
<li>实现Inteceptor</li>
<li>在MyBatis上下文中注册</li>
</ol>
<p><a href="https://m.imooc.com/collector/read/66">https://m.imooc.com/collector/read/66</a></p>
<h2 id="Spring-数据库事务机制是怎么样的？在什么时候-Spring-会回滚事务？"><a href="#Spring-数据库事务机制是怎么样的？在什么时候-Spring-会回滚事务？" class="headerlink" title="Spring 数据库事务机制是怎么样的？在什么时候 Spring 会回滚事务？"></a>Spring 数据库事务机制是怎么样的？在什么时候 Spring 会回滚事务？</h2><p>保证两个操作要么都成功，要么都失败。<br>Spring 数据库事务流程是通过Spring AOP实现的，而Spring AOP则是通过动态代理技术来实现的。</p>
<p>执行业务的过程中，如果发生异常且满足事务配置，则会回滚事务(rollback)。<br>如果一切正常或者异常是事务配置允许的，则会提交事务(commit)。</p>
<p><a href="https://m.imooc.com/collector/read/71">https://m.imooc.com/collector/read/71</a></p>
<h2 id="我们是使用什么注解启用-Spring-数据库事务机制？"><a href="#我们是使用什么注解启用-Spring-数据库事务机制？" class="headerlink" title="我们是使用什么注解启用 Spring 数据库事务机制？"></a>我们是使用什么注解启用 Spring 数据库事务机制？</h2><p><code>@Transactional</code><br><a href="https://m.imooc.com/collector/read/71">https://m.imooc.com/collector/read/71</a></p>
<h2 id="数据库隔离级别分为几个，分别是什么？"><a href="#数据库隔离级别分为几个，分别是什么？" class="headerlink" title="数据库隔离级别分为几个，分别是什么？"></a>数据库隔离级别分为几个，分别是什么？</h2><p>4个。</p>
<p>未提交读：Read uncommited<br>提交读：Read commit<br>可重复读：Repeatable read<br>序列化：Serializable<br><a href="https://m.imooc.com/collector/read/73">https://m.imooc.com/collector/read/73</a></p>
<h2 id="各个隔离级别可能出现什么问题，请举详细实例？"><a href="#各个隔离级别可能出现什么问题，请举详细实例？" class="headerlink" title="各个隔离级别可能出现什么问题，请举详细实例？"></a>各个隔离级别可能出现什么问题，请举详细实例？</h2><table>
<thead>
<tr>
<th>隔离级别\现象</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>未提交读：Read uncommited</td>
<td>v</td>
<td>v</td>
<td>v</td>
</tr>
<tr>
<td>提交读：Read commit</td>
<td>x</td>
<td>v</td>
<td>v</td>
</tr>
<tr>
<td>可重复读：Repeatable read</td>
<td>x</td>
<td>x</td>
<td>v</td>
</tr>
<tr>
<td>序列化：Serializable</td>
<td>x</td>
<td>x</td>
<td>x</td>
</tr>
</tbody></table>
<p><a href="https://m.imooc.com/collector/read/73">https://m.imooc.com/collector/read/73</a></p>
<h2 id="不可重复读和序列化两个隔离级别有什么区别？"><a href="#不可重复读和序列化两个隔离级别有什么区别？" class="headerlink" title="不可重复读和序列化两个隔离级别有什么区别？"></a>不可重复读和序列化两个隔离级别有什么区别？</h2><p>是否会出现幻读<br><a href="https://m.imooc.com/collector/read/73">https://m.imooc.com/collector/read/73</a></p>
<h2 id="我们一般依据什么标准选择隔离级别？"><a href="#我们一般依据什么标准选择隔离级别？" class="headerlink" title="我们一般依据什么标准选择隔离级别？"></a>我们一般依据什么标准选择隔离级别？</h2><p>选择隔离级别主要从防止丢失更新和性能两方面来考虑<br><a href="https://m.imooc.com/collector/read/73">https://m.imooc.com/collector/read/73</a></p>
<h2 id="一般企业用哪个隔离级别？默认的隔离级别是哪个？Oracle-和-MySQL-对隔离级别的支持情况如何？"><a href="#一般企业用哪个隔离级别？默认的隔离级别是哪个？Oracle-和-MySQL-对隔离级别的支持情况如何？" class="headerlink" title="一般企业用哪个隔离级别？默认的隔离级别是哪个？Oracle 和 MySQL 对隔离级别的支持情况如何？"></a>一般企业用哪个隔离级别？默认的隔离级别是哪个？Oracle 和 MySQL 对隔离级别的支持情况如何？</h2><p>一般企业用的是：<code>提交读：Read</code>这个级别，它适合在高并发的场景下使用。<br>默认的隔离级别是：<code>Isolation.DEFAULT</code>，Oracle和MySQL有不同的设置：Oracle使用的是<code>提交读：Read</code>，MySQL使用的是<code>可重复读：Repeatable</code></p>
<p>MySQL支持全部4个级别；<br>Oracle只支持<code>提交读：Read</code>和<code>序列化：Serializable</code>两个级别；</p>
<p><a href="https://m.imooc.com/collector/read/73">https://m.imooc.com/collector/read/73</a></p>
<h2 id="Spring-数据库传播行为有几种？分别是什么？默认的是什么？"><a href="#Spring-数据库传播行为有几种？分别是什么？默认的是什么？" class="headerlink" title="Spring 数据库传播行为有几种？分别是什么？默认的是什么？"></a>Spring 数据库传播行为有几种？分别是什么？默认的是什么？</h2><p>7种<br><img src="/.com//propagation.jpg" alt="propagation"></p>
<p>默认的是<code>PROPAGATION_REQUIRED</code><br><a href="https://m.imooc.com/collector/read/74">https://m.imooc.com/collector/read/74</a></p>
<h2 id="什么场景下使用-NESTED-事务传播行为？"><a href="#什么场景下使用-NESTED-事务传播行为？" class="headerlink" title="什么场景下使用 NESTED 事务传播行为？"></a>什么场景下使用 NESTED 事务传播行为？</h2><p>子事务方法采用独立的事务模式，如果子方法发生异常，也不回滚原方法事务方法的事务。<br>（对于支持保护点(savepoint)的数据库使用保护点，否则Spring就会创建新的数据库事务来运行它）</p>
<p><a href="https://m.imooc.com/collector/read/74">https://m.imooc.com/collector/read/74</a></p>
<h2 id="NESTED-事务和-REQUIRES-NEW-两个传播行为有什么不同？"><a href="#NESTED-事务和-REQUIRES-NEW-两个传播行为有什么不同？" class="headerlink" title="NESTED 事务和 REQUIRES_NEW 两个传播行为有什么不同？"></a>NESTED 事务和 REQUIRES_NEW 两个传播行为有什么不同？</h2><p>首先NESTED是延续当前事务，NESTED只是回滚子方法执行过的SQL，而不是全局回滚，但是他不能重新设置事务的属性，<br>比如不能重新设置事务的隔离级别、超时时间和锁等。<br>而REQUESTS_NEW会重新建事务，我们可以重新设置事务的属性。<br><a href="https://m.imooc.com/collector/read/74">https://m.imooc.com/collector/read/74</a></p>
]]></content>
      <tags>
        <tag>java</tag>
        <tag>spring</tag>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>Android Studio定制</title>
    <url>/tool/as/</url>
    <content><![CDATA[<h2 id="摘要："><a href="#摘要：" class="headerlink" title="摘要："></a>摘要：</h2><p>主要内容：<br>本文介绍了个人的 Android Studio 配置，包括主题、插件等；</p>
<h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><ul>
<li>编写 Android 代码；</li>
<li>写 hexo 上的文章；</li>
</ul>
<h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><ul>
<li><p>!j</p>
<blockquote>
<p>Sublime Text 式的多处选择（Sublime Text Multi Selection）<br>描述：这个功能超级赞！该操作会识别当前选中字符串，选择下一个同样的字符串，并且添加一个光标。这意味着你可以在同一个文件里拥有多个光标，你可以同时在所有光标处输入任何东西。<br>快捷键：Ctrl + G(OS X)、Alt + Ｊ（Windows、Linux）</p>
</blockquote>
</li>
<li><p>!+insert</p>
<blockquote>
<p>列选择/块选择（Column Selection）<br>描述：正常选择时，当你向下选择时，会直接将当前行到行尾都选中，而块选择模式下，则是根据鼠标选中的矩形区域来选择。<br>调用：按住 Alt，然后拖动鼠标选择。<br>开启/关闭块选择：Menu → Edit → Column Selection Mode<br>快捷键：切换块选择模式：Cmd + Shift + 8(OS X)、Shift + Alt + Insert﻿(Windows/Linux);</p>
</blockquote>
</li>
<li><p>!q 上下文信息；</p>
</li>
<li><p>^!m 提取方法；</p>
</li>
<li><p>^!p 提取参数（window 快捷键冲突）；</p>
</li>
<li><p>^!n 内置(inline)，提取的反操作；</p>
</li>
<li><p>^+j 合并行和文本；</p>
</li>
<li><p>^!t 包裹代码（Surround With）；</p>
</li>
<li><p>^+delete 移除包裹代码（包裹代码的反操作）；</p>
</li>
<li><p>+F4 对当前打开的文件另起一个窗口打开；</p>
</li>
<li><p>^+insert: 选择最近复制的内容进行粘贴；</p>
</li>
<li><p>^+f: Find in Path</p>
</li>
<li><p>^+r: <a href="https://www.jetbrains.com/help/idea/find-and-replace-in-path.html">Find and Replace in Path</a></p>
</li>
<li><p><img src="/.com//askey.png" alt="askey"></p>
</li>
<li><p><img src="/.com//askey2.png" alt="askey"></p>
</li>
</ul>
<h2 id="Theme"><a href="#Theme" class="headerlink" title="Theme"></a>Theme</h2><ul>
<li>Theme: Darcula</li>
<li>Font: Fira Code (Enable font ligatures), (14, 1.1)</li>
</ul>
<h2 id="Plugin"><a href="#Plugin" class="headerlink" title="Plugin"></a>Plugin</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># basic</span></span><br><span class="line">- .ignore</span><br><span class="line">- CamelCase</span><br><span class="line">- GsonFormat</span><br><span class="line">- Json to Kotlin Class</span><br><span class="line">- BugKotlinDocument</span><br><span class="line">- Parcelable Code Generator​(<span class="keyword">for</span> kotlin)</span><br><span class="line">- Markdown support</span><br><span class="line">- BashSupport</span><br><span class="line"></span><br><span class="line"><span class="comment"># other</span></span><br><span class="line">- Android ButtkerKnife Zelenzy</span><br><span class="line">- Markdown Navigator</span><br><span class="line">- MultiTypeTemplates</span><br><span class="line">- Smalidea</span><br></pre></td></tr></table></figure>

<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><ul>
<li>Editor-&gt;General-&gt;Smart Keys</li>
<li>使用 Refector （style）的正确姿势：<br>将鼠标定位到要 refector 的标签中（不要选中任何代码），<br>然后右键 <code>Refector --&gt; Extract --&gt; Style...</code></li>
<li>通过 debug 的方式调试和查看数据值，而不是通过繁琐地打印日志；</li>
</ul>
<h2 id="提升-Gradle-编译速度"><a href="#提升-Gradle-编译速度" class="headerlink" title="提升 Gradle 编译速度"></a>提升 Gradle 编译速度</h2><ul>
<li>设置代理</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># gradle.<span class="property">properties</span>中添加</span><br><span class="line"># 举例<span class="title class_">ShadowSocket</span></span><br><span class="line">systemProp.<span class="property">http</span>.<span class="property">proxyHost</span>=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">systemProp.<span class="property">http</span>.<span class="property">proxyPort</span>=<span class="number">8118</span></span><br><span class="line">systemProp.<span class="property">https</span>.<span class="property">proxyHost</span>=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">systemProp.<span class="property">https</span>.<span class="property">proxyPort</span>=<span class="number">8118</span></span><br></pre></td></tr></table></figure>

<ul>
<li>设置中启用离线状态</li>
<li>启用守护进程</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># gradle.<span class="property">properties</span>中添加</span><br><span class="line">org.<span class="property">gradle</span>.<span class="property">jvmargs</span>=-<span class="title class_">Xmx2048</span>m -<span class="attr">XX</span>:<span class="title class_">MaxPermSize</span>=512m -<span class="attr">XX</span>:+<span class="title class_">HeapDumpOnOutOfMemoryError</span> -<span class="title class_">Dfile</span>.<span class="property">encoding</span>=<span class="variable constant_">UTF</span>-<span class="number">8</span></span><br><span class="line">org.<span class="property">gradle</span>.<span class="property">parallel</span>=<span class="literal">true</span></span><br><span class="line">org.<span class="property">gradle</span>.<span class="property">daemon</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>编译 SDK 使用 21 以上</li>
</ul>
<h3 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h3><ul>
<li><a href="http://tikitoo.github.io/2016/05/26/android-studio-gradle-build-run-faster/">知道 Android 中 Gradle 的这些技巧，提升编译构建速度</a></li>
<li><a href="http://jaeger.itscoder.com/android/2016/02/14/android-studio-tips.html">Android Studio 小技巧合集</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwMzYwMTk1NA==&mid=2247485764&idx=1&sn=f816c73c1bc0d024d877f5f5371488b7&chksm=96cda809a1ba211faf50e83386c40d74bc71a24bd420f22cffda6a3d62a64ded6b5695a20d59&mpshare=1&scene=23&srcid=0717PkrJrg2LIqVFH25udp60&utm_medium=email&utm_source=gank.io#rd">Android Studio 实用小技巧</a></li>
</ul>
<h2 id="logcat-color"><a href="#logcat-color" class="headerlink" title="logcat color"></a>logcat color</h2><p>search: Logcat</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">Assert: 9C27B0</span><br><span class="line">Debug: 2196F3</span><br><span class="line">Error: F44336</span><br><span class="line">Info: 4CAF50</span><br><span class="line">Warning: FFC107</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>tool</tag>
        <tag>editor</tag>
      </tags>
  </entry>
  <entry>
    <title>Atom定制</title>
    <url>/tool/atom/</url>
    <content><![CDATA[<p>| <a href="https://my.oschina.net/oldfeel/blog/530233">ubuntu 下 atom 禁用 alt+key 调出菜单</a></p>
<blockquote>
<p>打开 edit -&gt; preference -&gt; open config folder -&gt; init.coffee, 添加</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># <span class="title class_">Get</span> rid <span class="keyword">of</span> the alt-menu shortcuts</span><br><span class="line">atom.<span class="property">menu</span>.<span class="property">template</span>.<span class="property">forEach</span> (t) -&gt;</span><br><span class="line">  t.<span class="property">label</span> = t.<span class="property">label</span>.<span class="title function_">replace</span>(<span class="string">&quot;&amp;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">atom.<span class="property">menu</span>.<span class="title function_">update</span>()</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>tool</tag>
        <tag>editor</tag>
      </tags>
  </entry>
  <entry>
    <title>图表</title>
    <url>/tool/chart/</url>
    <content><![CDATA[<ul>
<li><p><a href="https://blog.csdn.net/w410589502/article/details/71168204">流程图符号和用法 - 小小布的程序世界 - CSDN博客</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/c80b1099e61a">流程图里的形状符号的代表意义 - 简书</a></p>
</li>
</ul>
]]></content>
      <tags>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>Chrome定制</title>
    <url>/tool/chrome/</url>
    <content><![CDATA[<h2 id="书签"><a href="#书签" class="headerlink" title="书签"></a>书签</h2><p>更多的是为了搜索，所以可以不加分类的保存起来，有必要的话给书签添加关键字；<br>（除了少数常用的放在书签栏上之外）</p>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><ul>
<li>OneTab</li>
<li>直接访问(直接访问 Google 搜索结果。)</li>
<li>Markdown Preview Plus</li>
<li>cVim</li>
<li>Codota</li>
<li>AdBlock</li>
<li>Checker Plus for Gmail</li>
<li>Checker Plus for Calendar</li>
<li>crxMouse Chrome Gestures</li>
<li>Diigo Web Collector</li>
<li>Markdown Here</li>
<li>Markdown Preview Plus</li>
<li>Momentum</li>
<li>Octotree</li>
<li>夜景模式</li>
<li>Proxy SwitchyOmega</li>
</ul>
<h2 id="控制台"><a href="#控制台" class="headerlink" title="控制台"></a>控制台</h2><h3 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h3><ul>
<li>Focus in console: Ctrl + `</li>
<li>清空屏幕: <code>Ctrl + L</code></li>
<li>清除已经声明的变量：<code>console.clear();</code></li>
</ul>
<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p>进入调试模式： F12</p>
<p>JS 调试： 可以在 <code>Snippets</code> 里编写 Javascript 脚本，运行（Ctrl+Enter），和打断点调试</p>
]]></content>
      <tags>
        <tag>tool</tag>
        <tag>chrome</tag>
      </tags>
  </entry>
  <entry>
    <title>Autohotkey定制</title>
    <url>/tool/autohotkey/</url>
    <content><![CDATA[<h2 id="摘要："><a href="#摘要：" class="headerlink" title="摘要："></a>摘要：</h2><p>这里介绍了个人的 AutoHotKey 配置，包括它的便利性、用法说明等。在文章最后提供配置代码；</p>
<h2 id="简单介绍"><a href="#简单介绍" class="headerlink" title="简单介绍"></a>简单介绍</h2><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">只要是可以编辑的地方，都用像<span class="keyword">vim</span>一样的规则控制光标。</span><br></pre></td></tr></table></figure>

<p>当我有了这样的想法时，我找到了<code>Autohotkey</code>。</p>
<p><strong>使用 Autohotkey 带来其他便利：</strong></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">*</span> 一次按键，在浏览器中用指定搜索引擎搜索选中的文字。</span><br><span class="line"><span class="bullet">*</span> 一次按键，打开指定的某一个软件或同时打开几个软件。（开机后，一个按键打开所有必备软件）</span><br><span class="line"><span class="bullet">*</span> 一次按键，可以输入自定义的模板：例如输入<span class="code">`.dta`</span>，就能达到输入<span class="code">`2017-01-11 18:57:55`</span>的效果。</span><br><span class="line"><span class="bullet">*</span> 一次按键，快速输入特殊符号（●、★、×、√ 等等）。</span><br></pre></td></tr></table></figure>

<h2 id="举例说明"><a href="#举例说明" class="headerlink" title="举例说明"></a>举例说明</h2><p><strong>光标控制</strong></p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>光标左移一次：Alt+h</span><br><span class="line"><span class="bullet">* </span>光标右移一次：Alt+l</span><br><span class="line"><span class="bullet">* </span>光标上移一次：Alt+,</span><br><span class="line"><span class="bullet">* </span>光标下移一次：Alt+i</span><br><span class="line"><span class="bullet">* </span>光标置于行首：Alt+0</span><br><span class="line"><span class="bullet">* </span>光标置于行尾：Alt+4</span><br><span class="line"><span class="bullet">* </span>选中光标位置到行首的文字：Shift<span class="code">+Alt+</span>0</span><br><span class="line"><span class="bullet">* </span>选中光标位置到行尾的文字：Shift<span class="code">+Alt+</span>4</span><br><span class="line"><span class="bullet">* </span>删除右侧一个字符（同<span class="string">`Delete`按键）：Alt+&#x27;</span></span><br><span class="line"><span class="bullet">* </span>无论光标在当前行何处，新起一行：Shift+Enter</span><br></pre></td></tr></table></figure>

<p><strong>搜索</strong></p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>选中文字，用谷歌搜索：alt+g</span><br></pre></td></tr></table></figure>

<p><strong>导航标签</strong></p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>下一个标签：Alt+k</span><br><span class="line"><span class="bullet">* </span>上一个标签：Alt+j</span><br><span class="line"><span class="bullet">* </span>新建标签：Alt+t</span><br></pre></td></tr></table></figure>

<p><strong>控制窗口</strong><br>通过<code>MoveWindows.ahk</code>文件来启用。</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>按住alt键，左键拖拽窗口任意地方可以移动窗口；（非最大化模式）</span><br><span class="line"><span class="bullet">* </span>按住alt键，右键拖拽窗口，可以调整窗口的对象；（非最大化模式）</span><br></pre></td></tr></table></figure>

<h2 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h2><p>通过<code>#Include, MoveWindows.ahk</code>，这种方式可以加载配置文件。<br>这样就不用将所有文件都写在一个配置文件，而是放在不同的文件中，然后通过<code>#Include, MoveWindows.ahk</code>来加载。<br>模块化管理，更容易变更。（有些设置好像不能生效，让我又改回去了）</p>
<h2 id="配置代码"><a href="#配置代码" class="headerlink" title="配置代码"></a>配置代码</h2><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Include, Plugins/MoveWindows.ahk</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!p::suspend ;挂起所有autohotkey按键</span></span><br><span class="line"><span class="comment">#!o::Edit ;打开配置文件</span></span><br><span class="line">Capslock::Enter <span class="comment">;大小写按键替换成Enter键</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;LWin &amp; WheelUp::Send ^#&#123;left&#125;</span></span><br><span class="line"><span class="comment">;LWin &amp; WheelDown::Send ^#&#123;right&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#m::WinMinimize, A ; 最小化当前窗口</span></span><br><span class="line"><span class="comment">#`::WinMinimize, A ; 最小化当前窗口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; 启动指定的bat文件（可以在bat文件中启动其他程序）</span></span><br><span class="line"><span class="comment">#a::run win_a</span></span><br><span class="line"><span class="comment">#c::run win_c</span></span><br><span class="line"><span class="comment">#g::run win_g</span></span><br><span class="line"><span class="comment">#q::run win_q</span></span><br><span class="line"><span class="comment">#s::run win_s</span></span><br><span class="line"><span class="comment">#t::run win_t</span></span><br><span class="line"><span class="comment">#w::run win_w</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#n::run notepad</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;光标方向控制</span></span><br><span class="line">!i::Send &#123;up&#125; <span class="comment">;光标上移</span></span><br><span class="line">!,::Send &#123;down&#125; <span class="comment">;光标下移</span></span><br><span class="line">!h::Send &#123;left&#125; <span class="comment">;光标左移</span></span><br><span class="line">!l::Send &#123;right&#125; <span class="comment">;光标右移</span></span><br><span class="line">!4::Send, &#123;end&#125;  <span class="comment">;到行末</span></span><br><span class="line">!0::Send, &#123;home&#125;  <span class="comment">;到行首</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;编辑区域操作</span></span><br><span class="line">Shift &amp; enter::send &#123;end&#125;&#123;enter&#125; <span class="comment">;下起一行</span></span><br><span class="line">+^!h::send,+^&#123;left&#125; <span class="comment">;选中左移一个单词</span></span><br><span class="line">+^!l::send,+^&#123;right&#125; <span class="comment">;选中右移一个单词</span></span><br><span class="line">+!i::send,&#123;shiftdown&#125;&#123;up&#125; <span class="comment">;选中上移</span></span><br><span class="line">+!,::send,&#123;shiftdown&#125;&#123;down&#125; <span class="comment">;选中下移</span></span><br><span class="line">+!h::send,&#123;shiftdown&#125;&#123;left&#125; <span class="comment">;选中左移</span></span><br><span class="line">+!l::send,&#123;shiftdown&#125;&#123;right&#125; <span class="comment">;选中右移</span></span><br><span class="line">+!4::send,+&#123;end&#125; <span class="comment">;选中当前光标位置到行末</span></span><br><span class="line">+!0::send,+&#123;home&#125; <span class="comment">;选中当前光标位置到行首</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;复制当前行到剪切板</span></span><br><span class="line">+!c::</span><br><span class="line">send,&#123;home&#125;&#123;shiftdown&#125;&#123;end&#125;&#123;ShiftUp&#125;</span><br><span class="line">Send,^c</span><br><span class="line">Send, &#123;end&#125;</span><br><span class="line">Return</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;替换按键</span></span><br><span class="line">!n::Send ^n <span class="comment">;新建</span></span><br><span class="line">!w::Send ^w <span class="comment">;关闭</span></span><br><span class="line">!v::Send ^v <span class="comment">;粘贴</span></span><br><span class="line">!x::Send ^x <span class="comment">;剪切</span></span><br><span class="line">!c::Send ^c <span class="comment">;复制</span></span><br><span class="line">!s::Send ^s <span class="comment">;保存</span></span><br><span class="line">!&#x27;::Send &#123;delete&#125; <span class="comment">;删除光标后面的一个字母或汉字</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;特殊符号</span></span><br><span class="line"><span class="comment">;「</span></span><br><span class="line">!<span class="section">[::</span></span><br><span class="line"><span class="section">clipboard = 「</span></span><br><span class="line"><span class="section">send ^v</span></span><br><span class="line"><span class="section">return</span></span><br><span class="line"><span class="section"></span></span><br><span class="line"><span class="section">;</span></span><br><span class="line"><span class="section">!]</span>::</span><br><span class="line"><span class="attr">clipboard</span> = 」</span><br><span class="line">send ^v</span><br><span class="line">return</span><br><span class="line"></span><br><span class="line"><span class="comment">;时间输入</span></span><br><span class="line"><span class="comment">;如：14:19:59</span></span><br><span class="line">::.tt::</span><br><span class="line"><span class="attr">d</span> = %A_Hour%:%A_Min%:%A_Sec%</span><br><span class="line"><span class="attr">clipboard</span> = %d%</span><br><span class="line">Send ^v</span><br><span class="line">return</span><br><span class="line"></span><br><span class="line"><span class="comment">;如：2016.01.16</span></span><br><span class="line">::.dd::</span><br><span class="line"><span class="attr">d</span> = %A_YYYY%.%A_MM%.%A_DD%</span><br><span class="line"><span class="attr">clipboard</span> = %d%</span><br><span class="line">Send ^v</span><br><span class="line">return</span><br><span class="line"></span><br><span class="line"><span class="comment">;如：2016-05-08 17:09:10</span></span><br><span class="line">::.dta::</span><br><span class="line"><span class="attr">d</span> = %A_YYYY%-%A_MM%-%A_DD% %A_Hour%:%A_Min%:%A_Sec%</span><br><span class="line"><span class="attr">clipboard</span> = %d%</span><br><span class="line">Send ^v</span><br><span class="line">return</span><br><span class="line"></span><br><span class="line"><span class="comment">;如：[01.06 14:00]</span></span><br><span class="line">::.dt::</span><br><span class="line"><span class="attr">d</span> =  [%A_MM%.%A_DD% %A_Hour%:%A_Min%]</span><br><span class="line"><span class="attr">clipboard</span> = %d%</span><br><span class="line">Send ^v</span><br><span class="line">return</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;用google搜索</span></span><br><span class="line">!g::</span><br><span class="line">Send ^c</span><br><span class="line">Run http://www.google.com/search?<span class="attr">q</span>=%clipboard%</span><br><span class="line">return</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">;for chrome</span></span><br><span class="line"><span class="comment">#IfWinActive ahk_class Chrome_WidgetWin_1</span></span><br><span class="line">!j::Send ^+&#123;Tab&#125;</span><br><span class="line">!k::Send ^&#123;Tab&#125;</span><br><span class="line">!t::Send ^t</span><br><span class="line">return</span><br></pre></td></tr></table></figure>

<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p><strong>！！！</strong> 如果要通过剪切板输出中文，不要将配置文件设置为 <code>UTF-8</code>,而是要设置为 <code>GBK</code>（坑了我好长时间呢）</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://blog.csdn.net/ly1414725328/article/details/49641503">【Tool】使用 Autohotkey - 木子楼的专栏 - CSDN 博客</a></li>
</ul>
]]></content>
      <tags>
        <tag>tool</tag>
        <tag>autohotkey</tag>
      </tags>
  </entry>
  <entry>
    <title>Eclipse配置</title>
    <url>/tool/eclipse/</url>
    <content><![CDATA[<h2 id="当光标移到到元素上，别处相同元素高亮显示"><a href="#当光标移到到元素上，别处相同元素高亮显示" class="headerlink" title="当光标移到到元素上，别处相同元素高亮显示"></a>当光标移到到元素上，别处相同元素高亮显示</h2><p>该功能默认是打开的，但是有时候莫名奇妙的会被关闭，这时候通过下面的方式可以启用该功能。</p>
<p>具体步骤是：<br>windows-&gt;preferences-&gt;java-&gt;editor-&gt;mark occurrences 勾选复选框</p>
<p>更改颜色:<br>window-&gt;preferences-&gt;General-&gt;editors-&gt;text Editor-&gt;Annotations<br>右边选择–&gt;Occurrence</p>
]]></content>
      <tags>
        <tag>tool</tag>
        <tag>eclipse</tag>
      </tags>
  </entry>
  <entry>
    <title>Cmder定置</title>
    <url>/tool/cmder/</url>
    <content><![CDATA[<h2 id="前导"><a href="#前导" class="headerlink" title="前导"></a>前导</h2><p>安装 git: d:/c/git<br>安装 cmder: d:/p/cmder</p>
<h2 id="user-aliases"><a href="#user-aliases" class="headerlink" title="user_aliases"></a>user_aliases</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">e.=explorer .</span><br><span class="line">;gl=git <span class="built_in">log</span> --color --oneline  --all --graph --decorate  $*</span><br><span class="line">gl=git lg</span><br><span class="line"><span class="built_in">ls</span>=<span class="built_in">ls</span> --show-control-chars -F --color=auto $*</span><br><span class="line">ll=<span class="built_in">ls</span> -l</span><br><span class="line"><span class="built_in">pwd</span>=<span class="built_in">cd</span></span><br><span class="line">clear=cls</span><br><span class="line"><span class="built_in">history</span>=<span class="built_in">cat</span> <span class="string">&quot;%CMDER_ROOT%\config\.history&quot;</span></span><br><span class="line"><span class="built_in">unalias</span>=<span class="built_in">alias</span> /d <span class="variable">$1</span></span><br><span class="line">vi=vim $*</span><br><span class="line">cmderr=<span class="built_in">cd</span> /d <span class="string">&quot;%CMDER_ROOT%&quot;</span></span><br><span class="line">cdt=<span class="built_in">cd</span> /d d:/t</span><br><span class="line">cdw=<span class="built_in">cd</span> /d d:/w</span><br></pre></td></tr></table></figure>

<h2 id="Settings-gt-Startup-Environment"><a href="#Settings-gt-Startup-Environment" class="headerlink" title="Settings -&gt; Startup/Environment"></a>Settings -&gt; Startup/Environment</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> PATH=%ConEmuBaseDir%\Scripts;%PATH%</span><br><span class="line"><span class="built_in">set</span> LANG=zh_CN.UTF8</span><br><span class="line"><span class="built_in">set</span> HOME=D:\w\cmder</span><br><span class="line"><span class="built_in">set</span> http_proxy=http://127.0.0.1:1080</span><br><span class="line"><span class="built_in">set</span> https_proxy=http://127.0.0.1:1080</span><br></pre></td></tr></table></figure>

<h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><p>模仿 terminal 终端的快捷键，<br>+^O: 水平分割<br>+^E: 垂直分割<br>+^P: 上一个终端<br>+^N: 下一个终端</p>
<h2 id="主题"><a href="#主题" class="headerlink" title="主题"></a>主题</h2><p>solarized</p>
<h2 id="设置别名"><a href="#设置别名" class="headerlink" title="设置别名"></a>设置别名</h2><p><a href="https://segmentfault.com/a/1190000010304395">cmder 别名设置和自定义 cmder 启动界面 - SegmentFault 思否</a></p>
<p>在 gitbash安装目录下的 <code>etc/bash.bashrc</code>中加入 alias 配置</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> e.=<span class="string">&quot;explorer .&quot;</span></span><br><span class="line"><span class="built_in">alias</span> gl=<span class="string">&quot;git log --color --oneline  --all --graph --decorate  $*&quot;</span></span><br><span class="line"><span class="built_in">alias</span> glh=<span class="string">&quot;git lg | head&quot;</span></span><br><span class="line"><span class="built_in">alias</span> gh=<span class="string">&quot;git lg | head&quot;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">ls</span>=<span class="string">&quot;ls --show-control-chars -F --color=auto $*&quot;</span></span><br><span class="line"><span class="built_in">alias</span> ll=<span class="string">&quot;ls -l&quot;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">pwd</span>=<span class="string">&quot;cd&quot;</span></span><br><span class="line"><span class="built_in">alias</span> clear=<span class="string">&quot;cls&quot;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">unalias</span>=<span class="string">&quot;alias /d <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">alias</span> vi=<span class="string">&quot;vim $*&quot;</span></span><br><span class="line"><span class="built_in">alias</span> cdt=<span class="string">&quot;cd d:/t&quot;</span></span><br><span class="line"><span class="built_in">alias</span> cdw=<span class="string">&quot;cd d:/w&quot;</span></span><br><span class="line"><span class="built_in">alias</span> cdc=<span class="string">&quot;cd d:/c&quot;</span></span><br><span class="line"><span class="built_in">alias</span> cdd=<span class="string">&quot;cd C:/Users/lilou/Desktop&quot;</span></span><br><span class="line"><span class="built_in">alias</span> cdwr=<span class="string">&quot;cd d:/w/weex/mobile&quot;</span></span><br><span class="line"><span class="built_in">alias</span> cdp=<span class="string">&quot;cd d:/w/go/src/github.com/lyloou/pugo&quot;</span></span><br><span class="line"><span class="built_in">alias</span> cdgo=<span class="string">&quot;cd d:/w/go/src/&quot;</span></span><br><span class="line"><span class="built_in">alias</span> vv=<span class="string">&quot;d:/c/Vim/vim81/gvim.exe -p --remote-tab-silent $*&quot;</span></span><br><span class="line"><span class="built_in">alias</span> mvnc=<span class="string">&quot;mvn clean -Dmaven.test.skip&quot;</span></span><br><span class="line"><span class="built_in">alias</span> mvncc=<span class="string">&quot;mvn clean compile -Dmaven.test.skip&quot;</span></span><br><span class="line"><span class="built_in">alias</span> mvncd=<span class="string">&quot;mvn clean deploy -Dmaven.test.skip&quot;</span></span><br><span class="line"><span class="built_in">alias</span> mvnci=<span class="string">&quot;mvn clean install -Dmaven.test.skip&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> ..=<span class="string">&quot;cd ..&quot;</span></span><br><span class="line"><span class="built_in">alias</span> ...=<span class="string">&quot;cd .. &amp;&amp; cd ..&quot;</span></span><br><span class="line"><span class="built_in">alias</span> www=<span class="string">&quot;python -m SimpleHTTPServer 8000&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>Firefox</title>
    <url>/tool/firefox/</url>
    <content><![CDATA[<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><ul>
<li>Adblock Plus<blockquote>
<p>拦截广告</p>
</blockquote>
</li>
<li>Auto Tab Discard<blockquote>
<p>Auto Tab Discard a lightweight extension that uses the native method (tabs.discard) to unload or discard browser tabs which significantly reduces the memory footprint of your browser when many tabs are in use.</p>
</blockquote>
</li>
<li>Gesturefy<blockquote>
<p>Navigate, operate and browse faster with mouse gestures! A customizable mouse gesture add-on with a variety of different commands.</p>
</blockquote>
</li>
<li>HightlightAll<blockquote>
<p>Highlights all occurrences of the selected text.</p>
</blockquote>
</li>
<li>Markdown Link<blockquote>
<p>Generates a markdown link from title and URI of the current page. (alt + insert)</p>
</blockquote>
</li>
<li>Octotree<blockquote>
<p>Github code tree on steroids</p>
</blockquote>
</li>
<li>Proxy SwitchyOmega<blockquote>
<p>proxy setting</p>
</blockquote>
</li>
<li>Remove Redirect<blockquote>
<p>Remove intermediary pages that some pages use before redirecting to a final page.</p>
</blockquote>
</li>
<li>FeHelper<blockquote>
<p>FE 助手：JSON 工具、代码美化、代码压缩、二维码工具、网页定制工具、便签笔记，等等</p>
</blockquote>
</li>
<li>ScrollAnywhere<blockquote>
<p>Drag scrollbar with your middle mouse button anywhere on the page. Supports also “grab and drag” style and Momentum.</p>
</blockquote>
</li>
<li>Vimiue<blockquote>
<p>The Hacker’s Browser. Vimium provides keyboard shortcuts for navigation and control in the spirit of Vim.</p>
</blockquote>
</li>
</ul>
<h2 id="firefox-设置每次访问时检查缓存"><a href="#firefox-设置每次访问时检查缓存" class="headerlink" title="firefox 设置每次访问时检查缓存"></a>firefox 设置每次访问时检查缓存</h2><ol>
<li>在 firefox 的地址栏上输入 about:config 回车</li>
<li>找到 browser.cache.check_doc_frequency 选项，双击将</li>
<li>改成 1 保存即可。</li>
</ol>
<p>选项每个值都是什么含义的。请看下面的解释：<br>0: Once per session 每个进程一次 每次启动 Firefox 时检查<br>1: Each time 【开发人员强烈建议开这个】每次访问此页时检查<br>2: Never<br>3: When appropriate/automatically</p>
]]></content>
      <tags>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>Idea定制</title>
    <url>/tool/idea/</url>
    <content><![CDATA[<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><ul>
<li><p>GitToolBox</p>
</li>
<li><p>CamelCase</p>
</li>
<li><p>.ignore</p>
</li>
<li><p>GsonFormat</p>
</li>
<li><p>Markdown support</p>
</li>
<li><p>GO</p>
</li>
<li><p>Lombok plugin</p>
</li>
<li><p>Swagger Tools</p>
</li>
<li><p>Mybatisx</p>
</li>
<li><p>MybatisPlus</p>
</li>
<li><p>AceJump</p>
</li>
<li><p>Key promoter X</p>
</li>
<li><p>Alibaba Java Coding Guidelines</p>
</li>
<li><p>Database navigator</p>
</li>
<li><p>Rainbow Brackets</p>
</li>
<li><p>Past Images into Markdown</p>
</li>
<li><p>Free mybatis plugin</p>
</li>
<li><p>Packages</p>
</li>
<li><p><a href="https://www.hollischuang.com/archives/3220">https://www.hollischuang.com/archives/3220</a></p>
</li>
</ul>
<h2 id="THEME"><a href="#THEME" class="headerlink" title="THEME"></a>THEME</h2><p>solarized</p>
<h2 id="取消折叠代码"><a href="#取消折叠代码" class="headerlink" title="取消折叠代码"></a>取消折叠代码</h2><p>Settings | Editor | General | Code Folding</p>
<ul>
<li><a href="https://stackoverflow.com/questions/49132093/intellij-idea-2018-1-disable-simple-comment-folding">editor - Intellij IDEA 2018.1 - Disable simple comment folding - Stack Overflow</a></li>
</ul>
<h2 id="set-author-and-date"><a href="#set-author-and-date" class="headerlink" title="set author and date"></a>set author and date</h2><p>Settings -&gt; Editor -&gt; File and code templates -&gt; Includes -&gt; File Header</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> $&#123;USER&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> $&#123;YEAR&#125;/$&#123;MONTH&#125;/$&#123;DAY&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">keymap</span> <span class="attr">version</span>=<span class="string">&quot;1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;louva&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;Default for XWin&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;$Copy&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;ctrl c&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;ctrl insert&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt c&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;$Cut&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;ctrl x&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift delete&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt x&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;$Delete&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;delete&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt quote&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;$Paste&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;ctrl v&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift insert&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt v&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;ActivateRunToolWindow&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt r&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;CloseContent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;ctrl f4&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift alt w&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;CodeInspection.OnEditor&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;Console.Execute&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;Editor Copy&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt c&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;Editor Cut&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt x&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;Editor Delete&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt quote&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;Editor Paste&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt v&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorDown&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;down&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt comma&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorDownWithSelection&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift down&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift alt comma&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorLeft&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;left&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt h&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorLeftWithSelection&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift left&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift alt h&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorLineEnd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;end&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt 4&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorLineEndWithSelection&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift end&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift alt 4&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorLineStart&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;home&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt 0&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorLineStartWithSelection&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift home&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift alt 0&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorNextWordWithSelection&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift ctrl right&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift ctrl alt l&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorPreviousWordWithSelection&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift ctrl left&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift ctrl alt h&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorRight&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;right&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt l&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorRightWithSelection&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift right&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift alt l&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorSelectWord&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;ctrl w&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt w&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorUp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;up&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt i&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;EditorUpWithSelection&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift up&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift alt i&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;NextSplitter&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift alt n&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;NextTab&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt right&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt equals&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;PopupHector&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;PrevSplitter&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift alt p&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;PreviousTab&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt left&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;alt minus&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;ShowReformatFileDialog&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;Annotate&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;ctrl alt 0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;SplitHorizontally&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift alt o&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;SplitVertically&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keyboard-shortcut</span> <span class="attr">first-keystroke</span>=<span class="string">&quot;shift alt e&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;TabShiftActions.ShiftUp&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">id</span>=<span class="string">&quot;hg4idea.QPushAction&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keymap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="IntelliJ-IDEA-change-open-with-associated-application-preference-Stack-Overflow"><a href="#IntelliJ-IDEA-change-open-with-associated-application-preference-Stack-Overflow" class="headerlink" title="IntelliJ IDEA: change open with (associated application) preference - Stack Overflow"></a><a href="https://stackoverflow.com/questions/44699658/intellij-idea-change-open-with-associated-application-preference">IntelliJ IDEA: change open with (associated application) preference - Stack Overflow</a></h2><h2 id="java-doc-不自动格式化"><a href="#java-doc-不自动格式化" class="headerlink" title="java doc 不自动格式化"></a>java doc 不自动格式化</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">// <span class="doctag">@formatter</span>:off</span></span><br><span class="line"><span class="comment">  &#123;</span></span><br><span class="line"><span class="comment">    &quot;a&quot;:&quot;b&quot;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">// <span class="doctag">@formatter</span>:on</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">name</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><a href="https://stackoverflow.com/questions/3375307/how-to-disable-code-formatting-for-some-part-of-the-code-using-comments">intellij idea - How to disable code formatting for some part of the code using comments? - Stack Overflow</a></li>
</ul>
<h2 id="激活-spring-环境"><a href="#激活-spring-环境" class="headerlink" title="激活 spring 环境"></a>激活 spring 环境</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">-Dspring.profiles.active=dev</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/202201270913347.png" alt="202201270913347"></p>
<h2 id="Live-Templates"><a href="#Live-Templates" class="headerlink" title="Live Templates"></a>Live Templates</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">logd</span><br><span class="line">log.info(<span class="string">&quot;[<span class="variable">$CLASS_NAME</span><span class="variable">$</span>#<span class="variable">$METHOD_NAME</span><span class="variable">$</span>]: <span class="variable">$END</span><span class="variable">$</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">logi</span><br><span class="line">log.info(<span class="string">&quot;[<span class="variable">$CLASS_NAME</span><span class="variable">$</span>#<span class="variable">$METHOD_NAME</span><span class="variable">$</span>]: <span class="variable">$END</span><span class="variable">$</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">logw</span><br><span class="line">log.warn(<span class="string">&quot;[<span class="variable">$CLASS_NAME</span><span class="variable">$</span>#<span class="variable">$METHOD_NAME</span><span class="variable">$</span>]: <span class="variable">$END</span><span class="variable">$</span>&quot;</span>, e);</span><br><span class="line"></span><br><span class="line">loge</span><br><span class="line">log.error(<span class="string">&quot;[<span class="variable">$CLASS_NAME</span><span class="variable">$</span>#<span class="variable">$METHOD_NAME</span><span class="variable">$</span>]: <span class="variable">$END</span><span class="variable">$</span>&quot;</span>, e);</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>tool</tag>
        <tag>idea</tag>
      </tags>
  </entry>
  <entry>
    <title>字体定制</title>
    <url>/tool/font/</url>
    <content><![CDATA[<h2 id="monoca"><a href="#monoca" class="headerlink" title="monoca"></a><a href="https://github.com/todylu/monaco.ttf">monoca</a></h2><h2 id="FiraCode"><a href="#FiraCode" class="headerlink" title="FiraCode"></a><a href="https://github.com/tonsky/FiraCode">FiraCode</a></h2><p><a href="https://github.com/tonsky/FiraCode/wiki/Linux-instructions#installing-with-a-package-manager">https://github.com/tonsky/FiraCode/wiki/Linux-instructions#installing-with-a-package-manager</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt install fonts-firacode </span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>tool</tag>
        <tag>font</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdown</title>
    <url>/tool/markdown/</url>
    <content><![CDATA[<h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">| name       | age |</span><br><span class="line">| ---------- | --- |</span><br><span class="line">| LearnShare | 12  |</span><br><span class="line">| Mike       | 32  |</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">name</th>
<th align="left">age</th>
</tr>
</thead>
<tbody><tr>
<td align="left">LearnShare</td>
<td align="left">12</td>
</tr>
<tr>
<td align="left">Mike</td>
<td align="left">32</td>
</tr>
</tbody></table>
<ul>
<li>第二行的破折线，至少需要 3 个。</li>
</ul>
<h2 id="实现换行"><a href="#实现换行" class="headerlink" title="实现换行"></a>实现换行</h2><p>在一段文字的后面添加两个空格<br>自动就换行了。</p>
<h2 id="外部链接"><a href="#外部链接" class="headerlink" title="外部链接"></a>外部链接</h2><ul>
<li><a href="https://guo365.github.io/study/Markdown.html#41">Markdown 语法整理</a></li>
</ul>
<h2 id="将-GitBook-转成-PDF-或者-EPUB-格式电子书-简书"><a href="#将-GitBook-转成-PDF-或者-EPUB-格式电子书-简书" class="headerlink" title="将 GitBook 转成 PDF 或者 EPUB 格式电子书 - 简书"></a><a href="https://www.jianshu.com/p/7d192b650874">将 GitBook 转成 PDF 或者 EPUB 格式电子书 - 简书</a></h2>]]></content>
      <tags>
        <tag>markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>Ngrok相关</title>
    <url>/tool/ngrok/</url>
    <content><![CDATA[<ul>
<li><a href="https://morongs.github.io/2016/12/28/dajian-ngrok/">从零教你搭建ngrok服务</a></li>
</ul>
]]></content>
      <tags>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>Postman</title>
    <url>/tool/postman/</url>
    <content><![CDATA[<h2 id="设置-Header-中的-token"><a href="#设置-Header-中的-token" class="headerlink" title="设置 Header 中的 token"></a>设置 Header 中的 token</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">pm.<span class="title function_">test</span>(<span class="string">&quot;Status code is 200&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  pm.<span class="property">response</span>.<span class="property">to</span>.<span class="property">have</span>.<span class="title function_">status</span>(<span class="number">200</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> r = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(responseBody);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> token = r.<span class="property">data</span>.<span class="property">token</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(token);</span><br><span class="line"></span><br><span class="line">pm.<span class="property">globals</span>.<span class="title function_">unset</span>(<span class="string">&quot;LoginToken&quot;</span>);</span><br><span class="line"></span><br><span class="line">pm.<span class="property">globals</span>.<span class="title function_">set</span>(<span class="string">&quot;LoginToken&quot;</span>, <span class="string">&quot;Bearer:&quot;</span> + token);</span><br></pre></td></tr></table></figure>

<h2 id="如何使用-Postman-对接口参数进行签名"><a href="#如何使用-Postman-对接口参数进行签名" class="headerlink" title="如何使用 Postman 对接口参数进行签名"></a><a href="http://autuan.top/2019/08/28/how-to-sign-params-by-postman/">如何使用 Postman 对接口参数进行签名</a></h2><p>在 <code>Pre-request Script</code> 选项卡中添加</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取当前的请求路径</span></span><br><span class="line"><span class="keyword">var</span> url = pm.<span class="property">request</span>.<span class="property">url</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取环境变量</span></span><br><span class="line"><span class="keyword">const</span> client = pm.<span class="property">environment</span>.<span class="title function_">get</span>(<span class="string">&quot;client&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> reqVersion = pm.<span class="property">environment</span>.<span class="title function_">get</span>(<span class="string">&quot;reqVersion&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> sign = pm.<span class="property">environment</span>.<span class="title function_">get</span>(<span class="string">&quot;reqVersion&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将必填参数拼接到路径上</span></span><br><span class="line">url = url + <span class="string">&quot;&amp;client=&quot;</span> + client + <span class="string">&quot;&amp;reqVersion=&quot;</span> + reqVersion + <span class="string">&quot;&amp;sign=&quot;</span> + sign;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写url</span></span><br><span class="line">pm.<span class="property">request</span>.<span class="property">url</span> = url;</span><br></pre></td></tr></table></figure>

<h2 id="SHA256-签名示例"><a href="#SHA256-签名示例" class="headerlink" title="SHA256 签名示例"></a>SHA256 签名示例</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取当前的请求路径</span></span><br><span class="line"><span class="keyword">var</span> url = pm.<span class="property">request</span>.<span class="property">url</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置参数</span></span><br><span class="line"><span class="keyword">let</span> activeId = <span class="string">&quot;2197&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> awardId = <span class="number">10266</span>;</span><br><span class="line"><span class="keyword">let</span> cOpenId = <span class="string">&quot;aaaa&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">MAC</span> = <span class="string">&quot;001a9a000000&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> cUDID = <span class="string">&quot;23320005&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> accessToken = <span class="string">&quot;bbb&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> cChip = <span class="string">&quot;ccc&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> cEmmcCID = <span class="string">&quot;ddd&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> cModel = <span class="string">&quot;eee&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 签名</span></span><br><span class="line"><span class="keyword">let</span> signStr = <span class="string">`MAC=<span class="subst">$&#123;MAC&#125;</span>&amp;accessToken=<span class="subst">$&#123;accessToken&#125;</span>&amp;cChip=<span class="subst">$&#123;cChip&#125;</span>&amp;cEmmcCID=<span class="subst">$&#123;cEmmcCID&#125;</span>&amp;cModel=<span class="subst">$&#123;cModel&#125;</span>&amp;cOpenId=<span class="subst">$&#123;cOpenId&#125;</span>&amp;cUDID=<span class="subst">$&#123;cUDID&#125;</span>&amp;id=<span class="subst">$&#123;activeId&#125;</span>&amp;source=wechat`</span>;</span><br><span class="line"><span class="keyword">var</span> sign = <span class="title class_">CryptoJS</span>.<span class="title class_">SHA256</span>(signStr).<span class="title function_">toString</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将必填参数拼接到路径上</span></span><br><span class="line">url = <span class="string">`<span class="subst">$&#123;url&#125;</span>?activeId=<span class="subst">$&#123;activeId&#125;</span>&amp;awardId=<span class="subst">$&#123;awardId&#125;</span>&amp;cOpenId=<span class="subst">$&#123;cOpenId&#125;</span>&amp;MAC=<span class="subst">$&#123;MAC&#125;</span>&amp;cUDID=<span class="subst">$&#123;cUDID&#125;</span>&amp;accessToken=<span class="subst">$&#123;accessToken&#125;</span>&amp;&amp;token=<span class="subst">$&#123;sign&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写url</span></span><br><span class="line">pm.<span class="property">request</span>.<span class="property">url</span> = url;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>Vim定制</title>
    <url>/tool/vim/</url>
    <content><![CDATA[<h2 id="command-line-How-to-change-visudo-editor-from-nano-to-vim-Ask-Ubuntu"><a href="#command-line-How-to-change-visudo-editor-from-nano-to-vim-Ask-Ubuntu" class="headerlink" title="command line - How to change visudo editor from nano to vim? - Ask Ubuntu"></a><a href="https://askubuntu.com/questions/539243/how-to-change-visudo-editor-from-nano-to-vim/539265">command line - How to change visudo editor from nano to vim? - Ask Ubuntu</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo update-alternatives --config editor</span><br></pre></td></tr></table></figure>
<h2 id="Ubuntu修改locale问题解决-Cannot-set-language-to-“zh-CN-utf-8”"><a href="#Ubuntu修改locale问题解决-Cannot-set-language-to-“zh-CN-utf-8”" class="headerlink" title="Ubuntu修改locale问题解决-Cannot set language to “zh_CN.utf-8”"></a>Ubuntu修改locale问题解决-Cannot set language to “zh_CN.utf-8”</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo dpkg-reconfigure locales</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot; Vim-Plug &#123;&#123;&#123;</span></span><br><span class="line"><span class="string">call plug#begin(&#x27;~/.vim/plugged&#x27;)</span></span><br><span class="line"><span class="string">Plug &#x27;junegunn/vim-easy-align&#x27;</span></span><br><span class="line"><span class="string">Plug &#x27;valloric/youcompleteme&#x27;</span></span><br><span class="line"><span class="string">Plug &#x27;altercation/vim-colors-solarized&#x27;</span></span><br><span class="line"><span class="string">Plug &#x27;https://github.com/junegunn/vim-github-dashboard.git&#x27;</span></span><br><span class="line"><span class="string">Plug &#x27;SirVer/ultisnips&#x27; | Plug &#x27;honza/vim-snippets&#x27;</span></span><br><span class="line"><span class="string">Plug &#x27;scrooloose/nerdtree&#x27;, &#123;&#x27;on&#x27;: &#x27;NERDTreeToggle&#x27;&#125;</span></span><br><span class="line"><span class="string">Plug &#x27;tpope/vim-fireplace&#x27;, &#123;&#x27;for&#x27;: &#x27;clojure&#x27;&#125;</span></span><br><span class="line"><span class="string">Plug &#x27;rdnetto/YCM-Generator&#x27;, &#123;&#x27;branch&#x27;: &#x27;stable&#x27;&#125;</span></span><br><span class="line"><span class="string">Plug &#x27;fatih/vim-go&#x27;, &#123;&#x27;tag&#x27;: &#x27;*&#x27;&#125;</span></span><br><span class="line"><span class="string">Plug &#x27;nsf/gocode&#x27;, &#123;&#x27;tag&#x27;: &#x27;v.20150303&#x27;, &#x27;rtp&#x27;:&#x27;vim&#x27;&#125;</span></span><br><span class="line"><span class="string">call plug#end()</span></span><br><span class="line"><span class="string">&quot;</span> &#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&quot; General &#123;&#123;&#123;</span></span><br><span class="line"><span class="string">set nocompatible   </span></span><br><span class="line"><span class="string">set nobackup</span></span><br><span class="line"><span class="string">set noswapfile</span></span><br><span class="line"><span class="string">set history=1024</span></span><br><span class="line"><span class="string">set autochdir</span></span><br><span class="line"><span class="string">set whichwrap=b,s,&lt;,&gt;,[,]</span></span><br><span class="line"><span class="string">set nobomb</span></span><br><span class="line"><span class="string">set backspace=indent,eol,start whichwrap+=&lt;,&gt;,[,]</span></span><br><span class="line"><span class="string">set clipboard+=unnamed &quot;</span> Vim的默认寄存器和系统剪贴板共享</span><br><span class="line"><span class="built_in">set</span> winaltkeys=no</span><br><span class="line"><span class="string">&quot; &#125;&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span> GUI &#123;&#123;&#123;</span><br><span class="line"><span class="string">&quot;colorscheme tomorrow-night</span></span><br><span class="line"><span class="string">set cursorline</span></span><br><span class="line"><span class="string">set hlsearch</span></span><br><span class="line"><span class="string">set incsearch</span></span><br><span class="line"><span class="string">set number</span></span><br><span class="line"><span class="string">set splitbelow</span></span><br><span class="line"><span class="string">set splitright</span></span><br><span class="line"><span class="string">&quot;</span><span class="built_in">set</span> guifont=Inconsolata:h20</span><br><span class="line"><span class="string">&quot; &#125;&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span> Format &#123;&#123;&#123;</span><br><span class="line"><span class="built_in">set</span> autoindent</span><br><span class="line"><span class="built_in">set</span> smartindent</span><br><span class="line"><span class="built_in">set</span> tabstop=4</span><br><span class="line"><span class="built_in">set</span> expandtab</span><br><span class="line"><span class="built_in">set</span> softtabstop=4</span><br><span class="line"><span class="string">&quot;set foldmethod=indent</span></span><br><span class="line"><span class="string">set shiftwidth=4</span></span><br><span class="line"><span class="string">set ls=2</span></span><br><span class="line"><span class="string">syntax on</span></span><br><span class="line"><span class="string">&quot;</span> &#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&quot; Keymap &#123;&#123;&#123;</span></span><br><span class="line"><span class="string">let mapleader=&quot;</span>,<span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span> 标签操作</span><br><span class="line">map &lt;leader&gt;tn :tabnew&lt;cr&gt;</span><br><span class="line">map &lt;leader&gt;tc :tabclose&lt;cr&gt;</span><br><span class="line">map &lt;leader&gt;th :tabp&lt;cr&gt;</span><br><span class="line">map &lt;leader&gt;tl :tabn&lt;cr&gt;</span><br><span class="line"></span><br><span class="line"><span class="string">&quot; 移动分割窗口</span></span><br><span class="line"><span class="string">nmap &lt;C-j&gt; &lt;C-w&gt;j</span></span><br><span class="line"><span class="string">nmap &lt;C-k&gt; &lt;C-w&gt;k</span></span><br><span class="line"><span class="string">nmap &lt;C-h&gt; &lt;C-w&gt;h</span></span><br><span class="line"><span class="string">nmap &lt;C-l&gt; &lt;C-w&gt;l </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;</span> &#125;&#125;&#125;</span><br><span class="line"><span class="built_in">set</span> completeopt-=preview</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>tool</tag>
        <tag>editor</tag>
      </tags>
  </entry>
  <entry>
    <title>Virtualbox定制</title>
    <url>/tool/virtualbox/</url>
    <content><![CDATA[<h2 id="How-to-SSH-to-a-VirtualBox-guest-externally-through-a-host"><a href="#How-to-SSH-to-a-VirtualBox-guest-externally-through-a-host" class="headerlink" title="How to SSH to a VirtualBox guest externally through a host?"></a><a href="https://stackoverflow.com/questions/5906441/how-to-ssh-to-a-virtualbox-guest-externally-through-a-host">How to SSH to a VirtualBox guest externally through a host?</a></h2><h3 id="plan-1"><a href="#plan-1" class="headerlink" title="plan 1"></a>plan 1</h3><figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">The best way <span class="keyword">to</span> login <span class="keyword">to</span> a guest Linux VirtualBox VM <span class="keyword">is</span> port forwarding. <span class="keyword">By</span> <span class="keyword">default</span>, you should have one <span class="keyword">interface</span> already which <span class="keyword">is</span> <span class="keyword">using</span> NAT. <span class="keyword">Then</span> go <span class="keyword">to</span> the Network settings <span class="keyword">and</span> click the Port Forwarding button. <span class="keyword">Add</span> a <span class="keyword">new</span> Rule:</span><br><span class="line">`Host port <span class="number">3022</span>, guest port <span class="number">22</span>, name ssh, other left blank.`</span><br></pre></td></tr></table></figure>
<h3 id="plan-2"><a href="#plan-2" class="headerlink" title="plan 2"></a>plan 2</h3><figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">Change <span class="keyword">the</span> adapter type <span class="keyword">in</span> VirtualBox <span class="built_in">to</span> bridged, <span class="keyword">and</span> <span class="built_in">set</span> <span class="keyword">the</span> guest <span class="built_in">to</span> use DHCP <span class="keyword">or</span> <span class="built_in">set</span> <span class="keyword">a</span> static IP address outside <span class="keyword">of</span> <span class="keyword">the</span> bounds <span class="keyword">of</span> DHCP. This will cause <span class="keyword">the</span> Virtual Machine <span class="built_in">to</span> act like <span class="keyword">a</span> <span class="keyword">normal</span> guest <span class="keyword">on</span> <span class="title">your</span> <span class="title">home</span> <span class="title">network</span>. <span class="title">You</span> <span class="title">can</span> <span class="title">then</span> <span class="title">port</span> <span class="title">forward</span>.</span><br></pre></td></tr></table></figure>

<h2 id="Virtualbox虚拟机Ubuntu共享文件夹设置-自动挂载-CSDN博客"><a href="#Virtualbox虚拟机Ubuntu共享文件夹设置-自动挂载-CSDN博客" class="headerlink" title="Virtualbox虚拟机Ubuntu共享文件夹设置 自动挂载 - CSDN博客"></a><a href="http://blog.csdn.net/taochangchang/article/details/12918537">Virtualbox虚拟机Ubuntu共享文件夹设置 自动挂载 - CSDN博客</a></h2><ol>
<li>run <code>autorun.sh</code></li>
<li>reboot</li>
<li>name shared folder<blockquote>
<p>点击”设备(Devices)” -&gt; 共享文档夹(Shared Folders)菜单，添加一个共享文档夹，选项固定和临时是指该文档夹是否是持久的。共享名能够任取一个自己喜欢的，比如”gongxiang”，尽量使用英文名称。</p>
</blockquote>
</li>
<li>mount dir<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo mkdir <span class="regexp">/mnt/</span>shared</span><br><span class="line">sudo mount -t vboxsf gongxiang <span class="regexp">/mnt/</span>shared</span><br></pre></td></tr></table></figure></li>
<li>add to auto mount<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//</span> add to file: `<span class="regexp">/etc/</span>fstab`</span><br><span class="line">gongxiang <span class="regexp">/mnt/</span>shared vboxsf rw,gid=username,uid=username,auto <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="regexp">//</span> 以上的 vboxsf 是群组名称 username 是你的 用户名 就是 <span class="regexp">/home/</span>下的文件夹名称<span class="regexp">/mnt/</span>shared 是挂载目录</span><br></pre></td></tr></table></figure></li>
<li>umount<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo umount -f <span class="regexp">/mnt/</span>shared</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <tags>
        <tag>tool</tag>
      </tags>
  </entry>
  <entry>
    <title>Vscode定制</title>
    <url>/tool/vscode/</url>
    <content><![CDATA[<h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><ul>
<li>同时选中所有匹配的 Ctrl+Shift+L</li>
<li>回退上一个光标操作 Ctrl+U</li>
<li>移动到定义处：F12 （或者：win+alt+left click）</li>
<li>找到所有的引用：Shift+F12</li>
</ul>
<h2 id="Snippets-in-Visual-Studio-Code"><a href="#Snippets-in-Visual-Studio-Code" class="headerlink" title="Snippets in Visual Studio Code"></a><a href="https://code.visualstudio.com/docs/editor/userdefinedsnippets">Snippets in Visual Studio Code</a></h2><h2 id="配置编辑器的显示语言（菜单、控制台等）"><a href="#配置编辑器的显示语言（菜单、控制台等）" class="headerlink" title="配置编辑器的显示语言（菜单、控制台等）"></a>配置编辑器的显示语言（菜单、控制台等）</h2><ol>
<li>Ctrl+Shift+P</li>
<li>Cofingure Language</li>
<li><a href="https://code.visualstudio.com/docs/getstarted/locales">https://code.visualstudio.com/docs/getstarted/locales</a></li>
</ol>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><ul>
<li>Git Blame</li>
<li>beautify</li>
<li>vscode-icons</li>
<li>gitignore</li>
<li>vscode-wechat</li>
<li>code runner<ul>
<li><a href="https://www.cnblogs.com/clemente/archive/2018/12/clemente/p/10056838.html">解决 VS Code 使用 code runner 开发 Python 乱码问题 - clemente - 博客园</a></li>
</ul>
</li>
<li>vetur</li>
<li>auto rename tag</li>
</ul>
<h2 id="setting-json"><a href="#setting-json" class="headerlink" title="setting.json"></a>setting.json</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;editor.fontSize&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;editor.fontFamily&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Fira Code, Monaco, Consolas, &#x27;Courier New&#x27;, monospace&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;editor.fontLigatures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;files.autoGuessEncoding&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;java.errors.incompleteClasspath.severity&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ignore&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;window.menuBarVisibility&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;workbench.activityBar.visible&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;terminal.integrated.shell.windows&quot;</span><span class="punctuation">:</span> <span class="string">&quot;D:\\c\\git\\bin\\bash.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;window.openFoldersInNewWindow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;on&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;files.autoSave&quot;</span><span class="punctuation">:</span> <span class="string">&quot;afterDelay&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;files.autoSaveDelay&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;window.zoomLevel&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;editor.minimap.enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;workbench.editor.enablePreview&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 控制编辑器是否在滚动时使用动画</span></span><br><span class="line">  <span class="attr">&quot;editor.smoothScrolling&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 总是隐藏打开的文件</span></span><br><span class="line">  <span class="attr">&quot;explorer.openEditors.visible&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;window.title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;rootName&#125;$&#123;separator&#125;$&#123;activeEditorLong&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;workbench.iconTheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vscode-icons&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;editor.accessibilitySupport&quot;</span><span class="punctuation">:</span> <span class="string">&quot;off&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;files.eol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;window.enableMenuBarMnemonics&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;[markdown]&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;editor.quickSuggestions&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;editor.tabCompletion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;on&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;vetur.format.defaultFormatter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;html&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prettier&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;css&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prettier&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;postcss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prettier&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prettier&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;less&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prettier&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;js&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prettier&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prettier&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;stylus&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stylus-supremacy&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="keybindings-json"><a href="#keybindings-json" class="headerlink" title="keybindings.json"></a>keybindings.json</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 将键绑定放入此文件中以覆盖默认值</span></span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="comment">// =======&gt; 方向</span></span><br><span class="line">  <span class="comment">// 上</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+i&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorUp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 下</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+,&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorDown&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 左</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+h&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorLeft&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 右</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+l&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorRight&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 开始</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorHome&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 结束</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorEnd&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// =======&gt; 选择</span></span><br><span class="line">  <span class="comment">// 选中-上</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shift+alt+i&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorUpSelect&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 选中-下</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shift+alt+,&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorDownSelect&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 选中-左</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shift+alt+h&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorLeftSelect&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 选中-右</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shift+alt+l&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorRightSelect&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 选中-开始</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shift+alt+0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorHomeSelect&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 选中-结束</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shift+alt+4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorEndSelect&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 选中-左（单词）</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ctrl+shift+alt+h&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorWordStartLeftSelect&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 选中-右（单词）</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ctrl+shift+alt+l&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cursorWordEndRightSelect&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 扩选</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+w&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editor.action.smartSelect.grow&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 缩选</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+shift+w&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editor.action.smartSelect.shrink&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// =======&gt; 编辑</span></span><br><span class="line">  <span class="comment">// 复制</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+c&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editor.action.clipboardCopyAction&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 粘贴</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+v&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editor.action.clipboardPasteAction&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus &amp;&amp; !editorReadonly&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// save</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+s&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workbench.action.files.save&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 删除</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;deleteRight&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;when&quot;</span><span class="punctuation">:</span> <span class="string">&quot;editorTextFocus &amp;&amp; !editorReadonly&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// =======&gt; 导航</span></span><br><span class="line">  <span class="comment">// 标签-左</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+j&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workbench.action.previousEditor&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 标签-右</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+k&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;workbench.action.nextEditor&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<h2 id="Snippets"><a href="#Snippets" class="headerlink" title="Snippets"></a>Snippets</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// Place your snippets for markdown here. Each snippet is defined under a snippet name and has a prefix, body and</span></span><br><span class="line">  <span class="comment">// description. The prefix is what is used to trigger the snippet and the body will be expanded and inserted. Possible variables are:</span></span><br><span class="line">  <span class="comment">// $1, $2 for tab stops, $0 for the final cursor position, and $&#123;1:label&#125;, $&#123;2:another&#125; for placeholders. Placeholders with the</span></span><br><span class="line">  <span class="comment">// same ids are connected.</span></span><br><span class="line">  <span class="comment">// Example:</span></span><br><span class="line">  <span class="attr">&quot;Add hexo header&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;head&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;---&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;title: $&#123;1:undefined&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;date: $CURRENT_YEAR-$CURRENT_MONTH-$CURRENT_DATE $CURRENT_HOUR:$CURRENT_MINUTE:$CURRENT_SECOND&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;toc: true&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;comments: true&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;tags:&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;  - $&#123;2:undefined&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;---&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Add hexo header&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;Add hexo image url&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;![$&#123;1:this is an image&#125;](https://github.com/lyloou/img/raw/develop/z/$&#123;2:$CURRENT_YEAR$CURRENT_MONTH$CURRENT_DATE$CURRENT_HOUR$CURRENT_MINUTE$CURRENT_SECOND.png&#125;)&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Add hexo image url&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>tool</tag>
        <tag>editor</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows重装后完善步骤</title>
    <url>/windows/step/</url>
    <content><![CDATA[<p>安装软件</p>
<ul>
<li>sougou</li>
<li>tim</li>
<li>wps</li>
<li>wechat</li>
<li>firefox</li>
<li>chrome</li>
<li>vscode</li>
</ul>
<p>软件配置</p>
<ul>
<li>7-zip</li>
<li>pic</li>
<li>vim</li>
</ul>
<p>环境变量</p>
<p>配置软链接</p>
<p>设置字体</p>
]]></content>
      <tags>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>【Windows】win11相关</title>
    <url>/windows/win11/</url>
    <content><![CDATA[<h2 id="桌面"><a href="#桌面" class="headerlink" title="桌面"></a>桌面</h2><h2 id="关闭弹性滚动"><a href="#关闭弹性滚动" class="headerlink" title="关闭弹性滚动"></a>关闭弹性滚动</h2><p>进入：<code>edge://flags/</code></p>
<p>disable <code>Microsoft Edge scrolling personality</code></p>
<h2 id="恢复-win10-桌面右键菜单"><a href="#恢复-win10-桌面右键菜单" class="headerlink" title="恢复 win10 桌面右键菜单"></a>恢复 win10 桌面右键菜单</h2><p><a href="https://blog.csdn.net/admans/article/details/121302883">Win11 恢复 Win10 经典右键菜单 亲测有效_admans 的专栏-CSDN 博客_win11 换回 win10 右键</a></p>
<p>管理员权限运行</p>
<figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">reg.exe add &quot;HKCU\Software\Classes\CLSID\&#123;<span class="number">86</span>ca1aa0-<span class="number">34</span>aa-<span class="number">4</span>e8b-a509-<span class="number">50</span>c905bae2a2&#125;\InprocServer32&quot; /f /ve</span><br></pre></td></tr></table></figure>

<p>重启资源管理器：<br><code>taskkill /f /im explorer.exe&amp;&amp;explorer.exe</code></p>
<blockquote>
<p><a href="https://zhidao.baidu.com/question/1365850274792601979.html?qbl=relate_question_2">cmd /c taskkill /f /im explorer.exe&amp;&amp;explorer.exe 这命令什么意思_百度知道</a></p>
</blockquote>
<p>恢复 win11</p>
<figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">reg.exe delete &quot;HKCU\Software\Classes\CLSID\&#123;<span class="number">86</span>ca1aa0-<span class="number">34</span>aa-<span class="number">4</span>e8b-a509-<span class="number">50</span>c905bae2a2&#125;\InprocServer32&quot; /va /f</span><br></pre></td></tr></table></figure>

<p>其它方案：startAllback 软件</p>
]]></content>
      <tags>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows系统使用技巧</title>
    <url>/windows/%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h2 id="如何复制-Windows-单文件夹里的-200-万个小文件？而且电脑不卡（Robocopy）-小众软件"><a href="#如何复制-Windows-单文件夹里的-200-万个小文件？而且电脑不卡（Robocopy）-小众软件" class="headerlink" title="如何复制 Windows 单文件夹里的 200 万个小文件？而且电脑不卡（Robocopy） - 小众软件"></a><a href="https://www.appinn.com/windows-robocopy/">如何复制 Windows 单文件夹里的 200 万个小文件？而且电脑不卡（Robocopy） - 小众软件</a></h2><p>Robocopy<br>语法 robocopy <source> <destination> [<file>[ …]] [<options>]</options></file></destination></p>
<p>例如，若要将名为 yearly-report 的文件从 c:\reports 复制到文件共享 \ \ marketing\videos ，同时启用多线程以实现更高性能的 (使用 /mt 参数) 并且在 (与 /z 参数) 中断的情况下重启传输的功能，请键入：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">robocopy c:\reports <span class="string">&#x27;\\marketing\videos&#x27;</span> yearly-report.mov <span class="regexp">/mt /</span>z</span><br></pre></td></tr></table></figure>

<p><a href="https://docs.microsoft.com/zh-cn/windows-server/administration/windows-commands/robocopy">robocopy | Microsoft Docs</a></p>
<h2 id="Create-Windows-service-from-executable-Stack-Overflow"><a href="#Create-Windows-service-from-executable-Stack-Overflow" class="headerlink" title="Create Windows service from executable - Stack Overflow"></a><a href="https://stackoverflow.com/questions/3582108/create-windows-service-from-executable">Create Windows service from executable - Stack Overflow</a></h2><figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">sc.exe create &lt;<span class="keyword">new</span><span class="type">_service_name</span>&gt; binPath= <span class="string">&quot;&lt;path_to_the_service_executable&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="新建以-开头的文件"><a href="#新建以-开头的文件" class="headerlink" title="新建以.开头的文件"></a>新建以<code>.</code>开头的文件</h2><p>例如：<code>.gitignore</code></p>
<ol>
<li>右键新建文本文件</li>
<li>重命名：<code>.gitignore.</code>， 没错最后面需要那个<code>.</code>，否则无法保存</li>
<li>回车保存。</li>
</ol>
<h2 id="远程控制设备"><a href="#远程控制设备" class="headerlink" title="远程控制设备"></a>远程控制设备</h2><p>运行命令：<code>mstsc</code></p>
<ul>
<li><a href="http://www.ittribalwo.com/article/2600.html">mstsc 命令远程控制桌面使用方法及设置讲解</a></li>
</ul>
<h2 id="解决路由冲突"><a href="#解决路由冲突" class="headerlink" title="解决路由冲突"></a>解决路由冲突</h2><ul>
<li><code>ipconfig /release</code> 释放端口</li>
<li><code>ipconfig /renew</code> 重新连接</li>
</ul>
<h2 id="Does-Windows-have-the-ln-s-or-equivalent"><a href="#Does-Windows-have-the-ln-s-or-equivalent" class="headerlink" title="Does Windows have the ln -s or equivalent?"></a><a href="https://superuser.com/questions/182553/does-windows-have-the-ln-s-or-equivalent">Does Windows have the ln -s or equivalent?</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">// To create a symbolic <span class="built_in">link</span> named MyDocs from the root directory to the \Users\User1\Documents directory, <span class="built_in">type</span>:</span><br><span class="line">mklink /d MyDocs D:/t</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">Q: mklink 你没有足够的权限执行此操作。</span><br><span class="line">A: 以管理员的身份运行`cmd.exe`, https://answers.microsoft.com/zh-hans/windows/forum/windows_10-files-winpc/win10/8df12869-96f4-4cd1-a914-355e908a6015</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bat"><table><tr><td class="code"><pre><span class="line"><span class="comment">@REM e.g.</span></span><br><span class="line"><span class="built_in">cd</span> /d <span class="variable">%USERPROFILE%</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">@REM  dir</span></span><br><span class="line">mklink /d &quot;.IntelliJIdea2019.<span class="number">2</span>&quot; &quot;D:/d/.IntelliJIdea2018.<span class="number">1</span>&quot;</span><br><span class="line">mklink /d &quot;.AndroidStudio3.<span class="number">5</span>&quot; &quot;D:/d/.AndroidStudio3.<span class="number">5</span>&quot;</span><br><span class="line">mklink /d &quot;.gradle&quot; &quot;D:/d/.gradle&quot;</span><br><span class="line">mklink /d &quot;.m2&quot; &quot;D:/d/.m2&quot;;</span><br><span class="line">mklink /d &quot;.ssh&quot; &quot;D:/d/.ssh&quot;;</span><br><span class="line">mklink /d &quot;.vim&quot; &quot;D:/d/.vim&quot;;</span><br><span class="line">mklink /d &quot;.vscode&quot; &quot;D:/d/.vscode&quot;</span><br><span class="line">mklink /d &quot;Navicat&quot; &quot;D:/d/Navicat&quot;</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">@REM file</span></span><br><span class="line">mklink &quot;.gitconfig&quot; &quot;D:/d/.gitconfig&quot;</span><br><span class="line">mklink &quot;.minttyrc&quot; &quot;D:/d/.minttyrc&quot;</span><br><span class="line">mklink &quot;.npmrc&quot; &quot;D:/d/.npmrc&quot;</span><br><span class="line">mklink &quot;.bashrc&quot; &quot;D:/d/.bashrc&quot;</span><br></pre></td></tr></table></figure>

<h2 id="如何删除-WINDOWS-BT（临时-windows-安装文件）"><a href="#如何删除-WINDOWS-BT（临时-windows-安装文件）" class="headerlink" title="如何删除$WINDOWS.~BT（临时 windows 安装文件）"></a><a href="https://jingyan.baidu.com/article/f0e83a25a691ae22e59101c1.html">如何删除$WINDOWS.~BT（临时 windows 安装文件）</a></h2><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">- C盘右键属性</span><br><span class="line">- 选择“常规”---“磁盘清理”</span><br><span class="line">- 在“磁盘清理”对话框里找到并点击“清理系统文件”</span><br><span class="line">- 程序对系统进行清理文件扫描，稍微耐心等待片刻。</span><br><span class="line">- 找到“临时Windows安装文件”，并打勾，在描述中可以看到这些文件是安装过程中留下的，可以安全删除</span><br><span class="line">- 点击确定，耐心等待清理完成即可</span><br></pre></td></tr></table></figure>

<p>如果上面方法不行，进入 pe 直接删除。</p>
<h2 id="关闭系统更新——Windows-10-1803-如何彻底禁用自动更新"><a href="#关闭系统更新——Windows-10-1803-如何彻底禁用自动更新" class="headerlink" title="关闭系统更新——Windows 10 1803 如何彻底禁用自动更新"></a>关闭系统更新——<a href="http://www.mmxf.net/archives/1479.html">Windows 10 1803 如何彻底禁用自动更新</a></h2><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">打开注册表编辑器，找到下面的键值：</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UsoSvc</span><br><span class="line"></span><br><span class="line">找到“Start”，将值修改为4</span><br></pre></td></tr></table></figure>

<h2 id="cmd-运行命令后，自动关闭-cmd-黑窗口"><a href="#cmd-运行命令后，自动关闭-cmd-黑窗口" class="headerlink" title="cmd 运行命令后，自动关闭 cmd 黑窗口"></a>cmd 运行命令后，自动关闭 cmd 黑窗口</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%1&quot;</span> == <span class="string">&quot;h&quot;</span> goto begin</span><br><span class="line">mshta vbscript:createobject(<span class="string">&quot;wscript.shell&quot;</span>).run(<span class="string">&quot;&quot;</span><span class="string">&quot;%~nx0&quot;</span><span class="string">&quot; h&quot;</span>,0)(window.close)&amp;&amp;<span class="built_in">exit</span></span><br><span class="line">:begin</span><br><span class="line">D:\c\Redis-x64-5.0.10\redis-server.exe</span><br></pre></td></tr></table></figure>

<h2 id="占用查询端口的-pid-查询"><a href="#占用查询端口的-pid-查询" class="headerlink" title="占用查询端口的 pid 查询"></a>占用查询端口的 pid 查询</h2><figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">netstat -ano<span class="string">|findstr &quot;</span><span class="number">9097</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="关闭对应-pid-管理员权限"><a href="#关闭对应-pid-管理员权限" class="headerlink" title="关闭对应 pid(管理员权限)"></a>关闭对应 pid(管理员权限)</h2><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">taskkill</span> -F -PID <span class="number">6832</span></span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/tianjun2012/article/details/79806760">windows10 下关闭端口占用_tianjun2012 的专栏-CSDN 博客</a></p>
]]></content>
      <tags>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows环境变量</title>
    <url>/windows/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/</url>
    <content><![CDATA[<h2 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h2><p>ANDROID_HOME=D:\c\android\sdk<br>ANDROID_NDK_ROOT=D:\c\android\ndk\android-ndk-r14<br>PATH=D:\c\android\studio\gradle\gradle-4.4\bin;D:\c\android\ndk\android-ndk-r14;%ANDROID_HOME%\platform-tools;%ANDROID_HOME%\tools;</p>
<h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><p>CLASSPATH=.;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar;<br>JAVA_HOME=D:\c\java\jdk1.8.0<br>PATH=%JAVA_HOME%\bin;%JAVA_HOME%\jre\bin;</p>
<h2 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h2><p>GOROOT=D:\c\go<br>GOPATH=D:\w\go<br>PATH=%GOROOT%\bin;%GOPATH%\bin;</p>
<h2 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h2><p>D:\c\python\Scripts;<br>D:\c\python;<br>D:\p\shortcut;<br>D:\c\nodejs;<br>D:\c\mingw64\bin;<br>D:\c\apache-maven-3.5.0\bin;<br>D:\c\Apache24\bin;<br>D:\c\git\bin;<br>D:\c\git;</p>
<h2 id="Paht-all"><a href="#Paht-all" class="headerlink" title="Paht-all"></a>Paht-all</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">%JAVA_HOME%\bin;%JAVA_HOME%\jre\bin;%SystemRoot%\system32;%SystemRoot%;%SystemRoot%\System32\Wbem;%SYSTEMROOT%\System32\WindowsPowerShell\v1.0\;D:\c\android\studio\gradle\gradle-4.4\bin;D:\c\android\ndk\android-ndk-r14;%ANDROID_HOME%\platform-tools;%ANDROID_HOME%\tools;%GOROOT%\bin;%GOPATH%\bin;D:\c\python\Scripts\;D:\c\python\;D:\p\shortcut;D:\c\nodejs;D:\c\mingw64\bin;D:\c\apache-maven-3.5.0\bin;D:\c\Apache24\bin;D:\c\git\bin;D:\c\git;D:\c\pgadmin\runtime;C:\p\TortoiseSVN\bin;D:\c\java\spring-2.0.5.RELEASE/bin;D:\c\git\mingw64\bin;D:\c\LoadRunner\strawberry-perl\perl\bin;D:\c\jmeter\apache-jmeter-5.0\bin</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>【Windows】系统优化</title>
    <url>/windows/%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<ul>
<li><a href="https://www.xia1ge.com/compattelrunner-exe.html">解决 Windows 10 的 CompatTelRunner.exe 占用磁盘高的方法 – 下 1 个好软件</a></li>
</ul>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 禁用以下服务 (win+r --&gt; services.msc)</span></span><br><span class="line">Diagnostic Policy Service</span><br><span class="line">Diagnostic Service Host</span><br></pre></td></tr></table></figure>

<p>2.右键点开”这台电脑”，点”管理”，点”服务和应用程序”点”服务”，在右边框里把”superfetch”、”windows search”、”windows search”、”HomeGroupProvider”的启动类型设置成”禁用”<br>3.from 知乎：通过注册表（regedit）定位并修改了 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UnistoreSvc 等类似项的 start 值为 4，unistack 服务就不会开机运行，空闲时的硬盘占用下来了。</p>
]]></content>
      <tags>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows系统安装</title>
    <url>/windows/%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><p>（以 win7 家庭版为例）</p>
<ul>
<li>购买获取产品密钥；</li>
<li>依据产品密钥获得 iso 系统镜像文件；<a href="https://www.microsoft.com/zh-cn/software-download/windows7">下载 Windows 7 光盘映像（ISO 文件）</a></li>
<li>制作 winPE；</li>
<li>硬盘格式化和分区；</li>
<li>安装系统；</li>
<li>再次输入产品密钥激活；</li>
</ul>
<h2 id="必备软件安装；"><a href="#必备软件安装；" class="headerlink" title="必备软件安装；"></a>必备软件安装；</h2><ul>
<li>7-zip 压缩工具</li>
<li>wps 办公软件</li>
<li>搜狗输入法（拼音 || 五笔）</li>
</ul>
<h2 id="制作-winPE"><a href="#制作-winPE" class="headerlink" title="制作 winPE"></a>制作 winPE</h2><ul>
<li>微 Pe： <a href="http://www.wepe.com.cn/">http://www.wepe.com.cn/</a></li>
<li>老毛桃： <a href="http://www.laomaotao.org/">http://www.laomaotao.org/</a></li>
<li>大白菜： <a href="http://www.bigbaicai.com/">http://www.bigbaicai.com/</a></li>
</ul>
<h2 id="雨林木风"><a href="#雨林木风" class="headerlink" title="雨林木风"></a>雨林木风</h2><ul>
<li>下载 iso 镜像（里面包含 GHO 和 EXE 文件）；</li>
<li>将 iso 镜像拷贝到制作好 PE 的 U 盘里；</li>
<li>启动 PE 后，装载 iso，双击盘符里的 EXE 文件；</li>
</ul>
<h2 id="镜像地址"><a href="#镜像地址" class="headerlink" title="镜像地址"></a>镜像地址</h2><p><a href="https://msdn.itellyou.cn/">https://msdn.itellyou.cn/</a></p>
]]></content>
      <tags>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows软件</title>
    <url>/windows/%E8%BD%AF%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="日常"><a href="#日常" class="headerlink" title="日常"></a>日常</h2><p><a href="https://autohotkey.com/">autohotkey</a><br><a href="https://www.voidtools.com/">everything</a><br><a href="https://github.com/shadowsocks">shadowsocks</a><br><a href="https://zh.snipaste.com/">snipaste</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># http://www.xeylon.com/docker/114.html</span></span><br><span class="line">docker run -d -p 5800:5800/tcp -p 5800:5800/udp jpacg/shadowsocksr -s 0.0.0.0 -p 5800 -k 密码 -m aes-256-cfb</span><br></pre></td></tr></table></figure>

<p><a href="https://tzrgaga.github.io/2017/04/12/forward-socks-by-privoxy/">privoxy-Windows 下使用 Privoxy 转换 socks5 代理为 Http 代理</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vi Privoxy/config.txt</span></span><br><span class="line"><span class="comment"># 底部加入一行：</span></span><br><span class="line">forward-socks5 / 0.0.0.0:1080 .</span><br></pre></td></tr></table></figure>

<p><a href="https://sourceforge.net/projects/qttabbar/files/">qttabbar</a><br>FreeCommander XE</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">过滤： *</span><br><span class="line">程序： D:\p\WinMerge\WinMergeU.exe</span><br></pre></td></tr></table></figure>

<p><a href="http://www.7-zip.org/">7-zip</a><br>chrome<br>金山词霸<br>xmind<br><a href="http://www.irfanview.com/">irfanview</a><br>virtualbox<br><a href="http://eyefoo.com/">eyefoo</a><br>wiz<br>wps<br>f.lux<br>ccleaner<br>tim<br>qqpcmgr<br>listary<br>ev 录屏<br>potplayer<br>ditto<br>v2ray</p>
<h2 id="编程"><a href="#编程" class="headerlink" title="编程"></a>编程</h2><p>cmder<br>git<br>android studio<br>idea<br>visual studio code<br>fiddler<br>mariaDB<br>hedisql<br>java<br>apache<br>go<br>nodejs<br>python<br>gvim<br>emacs<br>typora</p>
<h2 id="Windows-下搭建-FTP-服务器"><a href="#Windows-下搭建-FTP-服务器" class="headerlink" title="Windows 下搭建 FTP 服务器"></a>Windows 下搭建 FTP 服务器</h2><p><a href="https://blog.csdn.net/EXLsunshine/article/details/29181465">https://blog.csdn.net/EXLsunshine/article/details/29181465</a><br>注意关闭防火墙</p>
<h2 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h2><h3 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h3><p>win+数字： 将软件锁定到任务栏后，通过这个快捷键可以快速打开（切换）软件；</p>
<h3 id="Create-Windows-service-from-executable"><a href="#Create-Windows-service-from-executable" class="headerlink" title="Create Windows service from executable"></a><a href="https://stackoverflow.com/questions/3582108/create-windows-service-from-executable">Create Windows service from executable</a></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sc.exe create &lt;new_service_name&gt; binPath= <span class="string">&quot;&lt;path_to_the_service_executable&gt;&quot;</span></span><br><span class="line">sc.exe delete &lt;service name&gt;</span><br><span class="line"><span class="comment"># Use NSSM( the non-Sucking Service Manager ) to run a .BAT or any .EXE file as a service.</span></span><br><span class="line"><span class="comment"># http://nssm.cc/</span></span><br></pre></td></tr></table></figure>

<h3 id="bat2exe"><a href="#bat2exe" class="headerlink" title="bat2exe"></a>bat2exe</h3><ul>
<li><a href="https://sourceforge.net/projects/bat-to-exe/?source=typ_redirect">https://sourceforge.net/projects/bat-to-exe/?source=typ_redirect</a></li>
</ul>
<p>mobaxterm<br><a href="https://mobaxterm.mobatek.net/plugins.html">https://mobaxterm.mobatek.net/plugins.html</a></p>
<h2 id="NetSetMan-5-0-16-年老牌工具更新，快速切换网卡-IP-地址、网关、DNS-工具-Windows-小众软件"><a href="#NetSetMan-5-0-16-年老牌工具更新，快速切换网卡-IP-地址、网关、DNS-工具-Windows-小众软件" class="headerlink" title="NetSetMan 5.0 - 16 年老牌工具更新，快速切换网卡 IP 地址、网关、DNS 工具[Windows] - 小众软件"></a><a href="https://www.appinn.com/netsetman-5/">NetSetMan 5.0 - 16 年老牌工具更新，快速切换网卡 IP 地址、网关、DNS 工具[Windows] - 小众软件</a></h2><h2 id="stnkl-EverythingToolbar-Everything-integration-for-the-Windows-taskbar"><a href="#stnkl-EverythingToolbar-Everything-integration-for-the-Windows-taskbar" class="headerlink" title="stnkl/EverythingToolbar: Everything integration for the Windows taskbar."></a><a href="https://github.com/stnkl/EverythingToolbar">stnkl/EverythingToolbar: Everything integration for the Windows taskbar.</a></h2><h2 id="Microsoft-PowerToys-Microsoft-Docs"><a href="#Microsoft-PowerToys-Microsoft-Docs" class="headerlink" title="Microsoft PowerToys | Microsoft Docs"></a><a href="https://docs.microsoft.com/zh-cn/windows/powertoys/">Microsoft PowerToys | Microsoft Docs</a></h2><h2 id="wubiLex-WIN10-五笔助手-发现频道-小众软件官方论坛"><a href="#wubiLex-WIN10-五笔助手-发现频道-小众软件官方论坛" class="headerlink" title="wubiLex (WIN10 五笔助手) - 发现频道 - 小众软件官方论坛"></a><a href="https://meta.appinn.net/t/topic/15637">wubiLex (WIN10 五笔助手) - 发现频道 - 小众软件官方论坛</a></h2><h2 id="复制到系统剪切板"><a href="#复制到系统剪切板" class="headerlink" title="复制到系统剪切板"></a>复制到系统剪切板</h2><p><a href="https://stackoverflow.com/a/49536965">https://stackoverflow.com/a/49536965</a></p>
<blockquote>
<p>cat file | clip.exe</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取tag名称：dev_2110221510</span></span><br><span class="line">time=$(<span class="built_in">date</span> <span class="string">&quot;+%y%m%d%H%M&quot;</span>)</span><br><span class="line">t_tag=<span class="string">&quot;dev_<span class="variable">$&#123;time&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制tag到系统剪切板</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;t_tag&#125;</span> | clip.exe</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;TAG: <span class="variable">$&#123;t_tag&#125;</span> copied.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打标签</span></span><br><span class="line">git tag <span class="variable">$&#123;t_tag&#125;</span></span><br><span class="line">git push origin <span class="variable">$&#123;t_tag&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开Jenkins网页</span></span><br><span class="line">start http://jenkins.lyloou.com</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="typora"><a href="#typora" class="headerlink" title="typora"></a>typora</h2><p><a href="https://www.jianshu.com/p/d7bf3f9da6db">Typora + PicGo-Core + Custom Command 实现上传图片到图床 - 简书</a><br><a href="https://juejin.cn/post/6990295227915468831">PicGo 插件 - 掘金</a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;picBed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="string">&quot;github&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;uploader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;github&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;github&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;repo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lyloou/img&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;customUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;branch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;develop&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gitee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;repo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lyloou/image&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;branch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;master&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;customPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;customUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;picgoPlugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;picgo-plugin-autocopy&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;picgo-plugin-gitee-uploader&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;picgo-plugin-rename-file&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;picgo-plugin-github-plus&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;picgo-plugin-rename-file&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;origin&#125;_&#123;y&#125;&#123;m&#125;&#123;d&#125;&#123;h&#125;&#123;i&#125;&#123;s&#125;&#123;ms&#125;_&#123;rand:6&#125;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;picgo-plugin-gitee-uploader&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;lastSync&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-12-15 06:31:21&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="edge"><a href="#edge" class="headerlink" title="edge"></a>edge</h2><p><a href="https://bbs.ihei5.com/thread-1182663-1-1.html">怎么关闭 Microsoft edge 浏览器双指左右滑动前后翻页的手势？<em>电脑软硬件</em>爱黑武论坛</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">Overscroll <span class="built_in">history</span> navigation (<span class="built_in">disable</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows 问题修复</title>
    <url>/windows/%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D/</url>
    <content><![CDATA[<h2 id="修复移动硬盘”文件或目录损坏且无法读取”-小叶白龙博客"><a href="#修复移动硬盘”文件或目录损坏且无法读取”-小叶白龙博客" class="headerlink" title="修复移动硬盘”文件或目录损坏且无法读取”-小叶白龙博客"></a><a href="http://www.xiaoyebailong.com/index.php/2009/09/01/514.htm">修复移动硬盘”文件或目录损坏且无法读取”-小叶白龙博客</a></h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">chkdsk C: /f</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>【安全-算法】常见安全算法</title>
    <url>/%E5%AE%89%E5%85%A8/%E5%B8%B8%E8%A7%81%E5%AE%89%E5%85%A8%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h2 id="MD5（MD5-Message-Digest-Algorithm"><a href="#MD5（MD5-Message-Digest-Algorithm" class="headerlink" title="MD5（MD5 Message-Digest Algorithm)"></a>MD5（MD5 Message-Digest Algorithm)</h2><p>消息摘要算法</p>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul>
<li>不可逆</li>
<li>输入不室长，输出定长的128-bits（用32个16进制字符表示）</li>
</ul>
<h4 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h4><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/cbbfed12-d2a2-42d2-a5ad-26e6c72612fa_20211220152522726_3266a3.png" alt="img"></p>
<h4 id="使用场合"><a href="#使用场合" class="headerlink" title="使用场合"></a>使用场合</h4><p>用于各种程序语言中，以确保资料传递无误（摘要）。</p>
<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><ul>
<li><a href="https://zh.wikipedia.org/wiki/MD5">MD5 - 维基百科，自由的百科全书</a></li>
</ul>
<h2 id="SHA-Secure-Hash-Algorithm"><a href="#SHA-Secure-Hash-Algorithm" class="headerlink" title="SHA(Secure Hash Algorithm)"></a>SHA(Secure Hash Algorithm)</h2><p>安全散列算法</p>
<blockquote>
<p><a href="https://zh.wikipedia.org/wiki/SHA-3">SHA-3</a>：2015年正式发布，由于对MD5出现成功的破解，以及对SHA-0和SHA-1出现理论上破解的方法，<a href="https://zh.wikipedia.org/wiki/%E5%9C%8B%E5%AE%B6%E6%A8%99%E6%BA%96%E6%9A%A8%E6%8A%80%E8%A1%93%E7%A0%94%E7%A9%B6%E9%99%A2">NIST</a>感觉需要一个与之前算法不同的，可替换的加密散列算法，也就是现在的SHA-3。</p>
</blockquote>
<h4 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h4><ul>
<li>输出定长（具体模式长度不一样，SHA3-512、SHA3-256）</li>
<li>SHA2和SHA3目前还未被破解。</li>
</ul>
<h4 id="参考资料-1"><a href="#参考资料-1" class="headerlink" title="参考资料"></a>参考资料</h4><ul>
<li><a href="https://zh.wikipedia.org/wiki/SHA%E5%AE%B6%E6%97%8F">SHA家族 - 维基百科，自由的百科全书</a></li>
<li><a href="https://zh.wikipedia.org/wiki/SHA-3">SHA-3 - 维基百科，自由的百科全书</a></li>
</ul>
<h2 id="Base64-基底64，一种编码方式，非算法"><a href="#Base64-基底64，一种编码方式，非算法" class="headerlink" title="Base64(基底64，一种编码方式，非算法)"></a>Base64(基底64，一种编码方式，非算法)</h2><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>是一种基于64个可打印字符来表示二进制数据的表示方法。<br>字符有：[0-9、A-Z、a-z、+/]<br>还有类似其它的编码方式，如Base32。对比Base32，Base64有更多的字符用于编码，其编码后的长度要更短。还有Base58，用于比特币中，不使用易混淆的字符[不使用数字”0”，字母大写”O”，字母大写”I”，和字母小写”l”，以及”+”和”/“符号]<br>目的是：<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/91d85977-78d4-4a52-a925-b016099f1568_20211220152908396_57b035.png" alt="img"></p>
<p>可以编码，也可以解码。<br><strong>是一种编码方式，切记不要误用于加密、解密的场合（有DES、IDEA等对称加密算法）。</strong></p>
<h4 id="使用场合-1"><a href="#使用场合-1" class="headerlink" title="使用场合"></a>使用场合</h4><p>常用于在处理文本数据的场合，表示、传输、存储一些二进制数据，包括MIME的电子邮件及XML的一些复杂数据。<br>如：Base64编码图片、MIME内容、URL（用于传递参数）。<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/ddd8938c-0386-424d-b7b8-4c16b5889f7c_20211220152522708_ebc258.jpg" alt="img"><br><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/0bd15490-2c01-4cfc-aa2f-b0d0f1a80560_20211220152522780_cbb058.jpg" alt="img"></p>
<h4 id="参考资料-2"><a href="#参考资料-2" class="headerlink" title="参考资料"></a>参考资料</h4><ul>
<li><a href="https://zh.wikipedia.org/wiki/Base64">Base64 - 维基百科，自由的百科全书</a></li>
<li><a href="https://zh.wikipedia.org/wiki/Base58">Base58 - 维基百科，自由的百科全书</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/34937271">对称加密和Base64编码 - 知乎</a></li>
</ul>
<h2 id="DES-Data-Encryptioin-Standard"><a href="#DES-Data-Encryptioin-Standard" class="headerlink" title="DES(Data Encryptioin Standard)"></a>DES(Data Encryptioin Standard)</h2><p>数据加密标准，是一种对称加密算法。是由IBM公司研制的对称密码体制加密算法，密钥长64位，实事上是56位参与DES运算（其它的是校验位，8、16、24、32、60、48、56、64）</p>
<h4 id="特点-2"><a href="#特点-2" class="headerlink" title="特点"></a>特点</h4><p>分组比较短、密钥太短、运算速度慢<br>有极高的安全性（并非不可破解。用穷举的时间特别长。特殊的硬件并行计算几个小时）<br>加强版本：<a href="https://baike.baidu.com/item/3DES">3DES_百度百科</a>，即Triple Data Encryption Algorithm。相当于对每个数据块应用三次DES加密算法。</p>
<h4 id="参考资料-3"><a href="#参考资料-3" class="headerlink" title="参考资料"></a>参考资料</h4><ul>
<li><a href="https://baike.baidu.com/item/des%E7%AE%97%E6%B3%95/10306073">des算法_百度百科</a></li>
</ul>
<h2 id="IDEA-International-Data-Encryption-Algorithm"><a href="#IDEA-International-Data-Encryption-Algorithm" class="headerlink" title="IDEA(International Data Encryption Algorithm)"></a>IDEA(International Data Encryption Algorithm)</h2><p>国际数据加密算法，是从DES算法的基础上发展出来的。密钥长度为128位。</p>
<h4 id="特点-3"><a href="#特点-3" class="headerlink" title="特点"></a>特点</h4><ul>
<li>对比DES而言，更安全</li>
<li>是一种数据块加密算法</li>
<li>在美国之外发展（避开了美国法律上对加密技术的限制）</li>
</ul>
<h4 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h4><ul>
<li>PGP使用IDEA作为其分组加密算法；</li>
<li>SSL也将IDEA包含在SSLRef中；</li>
</ul>
<h4 id="参考资料-4"><a href="#参考资料-4" class="headerlink" title="参考资料"></a>参考资料</h4><ul>
<li><a href="https://baike.baidu.com/item/%E5%9B%BD%E9%99%85%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/11048972">国际数据加密算法_百度百科</a></li>
</ul>
<h2 id="AES-Advanced-Encryption-Standard"><a href="#AES-Advanced-Encryption-Standard" class="headerlink" title="AES(Advanced Encryption Standard)"></a>AES(Advanced Encryption Standard)</h2><p>高级加密标准，用来替代原先的DES，目前被广泛应用。<br>密钥长度可以是128位、192位或256位。</p>
<h4 id="应用场合"><a href="#应用场合" class="headerlink" title="应用场合"></a>应用场合</h4><p>SSL、IpSec、ATM、路由器、网络保密系统、卫星通信、移动通信。</p>
<h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><ul>
<li><a href="https://www.jianshu.com/p/1d5b95dca31d">AES加密技术：AES加密算法在信息安全中的应用 - 简书</a></li>
</ul>
<h2 id="RSA非对称加密算法"><a href="#RSA非对称加密算法" class="headerlink" title="RSA非对称加密算法"></a>RSA非对称加密算法</h2><p>RSA是由三个人名的首字母缩写而来。</p>
<h4 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h4><p>优点是，相对于对称加密，对称密钥需要协商密钥，非对称加密不需要协商，可以将公钥完全地公开。<br>缺点是，运算速度慢。</p>
<h4 id="与对称加密结合使用"><a href="#与对称加密结合使用" class="headerlink" title="与对称加密结合使用"></a>与对称加密结合使用</h4><p>在实际应用中，将对称和非对称结合使用。</p>
<ol>
<li>A和B先交换公钥；</li>
<li>A生成一个随机AES口令，通过B的公钥加密，并发送给B；</li>
<li>B接收信息后，通过自己的私钥解密得到AES口令；</li>
<li>双方用这个AES口令进行加密通信。</li>
</ol>
<h4 id="应用场合-1"><a href="#应用场合-1" class="headerlink" title="应用场合"></a>应用场合</h4><ul>
<li>https 加密链接</li>
<li>socket程序，结合运用 rsa + aes</li>
</ul>
<h4 id="参考资料-5"><a href="#参考资料-5" class="headerlink" title="参考资料"></a>参考资料</h4><ul>
<li><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1304227873816610">非对称加密算法 - 廖雪峰的官方网站</a></li>
<li><a href="https://0f9de7f3.wiz06.com/wapp/pages/view/share/s/0fDuvP3SO4QS2Hb3sP2Di0ai3NopV-1UR4d820U8CU0Eq8qJ">原文</a></li>
</ul>
]]></content>
      <tags>
        <tag>安全</tag>
      </tags>
  </entry>
  <entry>
    <title>Lua配置</title>
    <url>/lua/config/</url>
    <content><![CDATA[<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># c</span></span><br><span class="line"><span class="comment"># https://askubuntu.com/questions/194523/how-do-i-install-gnu-readline</span></span><br><span class="line">    sudo apt-get install libreadline6 libreadline6-dev</span><br><span class="line"></span><br><span class="line">curl -R -O http://www.lua.org/ftp/lua-5.3.5.tar.gz</span><br><span class="line">tar zxf lua-5.3.5.tar.gz</span><br><span class="line"><span class="built_in">cd</span> lua-5.3.5</span><br><span class="line">make linux <span class="built_in">test</span></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>lua</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】K选择问题</title>
    <url>/%E7%AE%97%E6%B3%95/K%E9%80%89%E6%8B%A9%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>K 选择问题：给出 N 个数，找出其中第 K 小的元素。</p>
<h2 id="方法-1"><a href="#方法-1" class="headerlink" title="方法 1"></a>方法 1</h2><p>暴力法：<br>时间复杂度：O(K x N)</p>
<h2 id="方法-2"><a href="#方法-2" class="headerlink" title="方法 2"></a>方法 2</h2><p>二分法：<br>时间复杂度：O(N)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * K选择问题：给出N个数，找出其中第K小的元素。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">K</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1 2 3 4 5 6 7 8 9</span></span><br><span class="line">        test(getList1());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;-----&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7 8 11 22 33 44 55 66 99</span></span><br><span class="line">        test(getList2());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;第%s小的元素是%s%n&quot;</span>, <span class="number">3</span>, getNumK(list, <span class="number">3</span>));</span><br><span class="line">        System.out.printf(<span class="string">&quot;第%s小的元素是%s%n&quot;</span>, <span class="number">2</span>, getNumK(list, <span class="number">2</span>));</span><br><span class="line">        System.out.printf(<span class="string">&quot;第%s小的元素是%s%n&quot;</span>, <span class="number">1</span>, getNumK(list, <span class="number">1</span>));</span><br><span class="line">        System.out.printf(<span class="string">&quot;第%s小的元素是%s%n&quot;</span>, <span class="number">5</span>, getNumK(list, <span class="number">5</span>));</span><br><span class="line">        System.out.printf(<span class="string">&quot;第%s小的元素是%s%n&quot;</span>, <span class="number">8</span>, getNumK(list, <span class="number">8</span>));</span><br><span class="line">        System.out.printf(<span class="string">&quot;第%s小的元素是%s%n&quot;</span>, <span class="number">9</span>, getNumK(list, <span class="number">9</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">getList1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(<span class="number">3</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">getList2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(<span class="number">33</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">22</span>, <span class="number">8</span>, <span class="number">99</span>, <span class="number">44</span>, <span class="number">55</span>, <span class="number">66</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 二分法：找一个枢轴，比枢轴小的放到s1，比枢轴大的放到s2，</span></span><br><span class="line"><span class="comment">     * 如果： k == s1.size+1，说明枢轴就是要找的元素（+1表示枢轴所在的位置）</span></span><br><span class="line"><span class="comment">     * 如果： k &lt; s1.size+1，说明要找的元素在s1中</span></span><br><span class="line"><span class="comment">     * 否则：要找的元素在 s2 中（注意要将枢轴元素加回到s2中，因为有可能正好是这个枢轴元素）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list 列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> k    第k小</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回第k小的元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer <span class="title function_">getNumK</span><span class="params">(List&lt;Integer&gt; list, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (list.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (list.size() &lt; k) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (list.size() == <span class="number">1</span> &amp;&amp; k == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> list.get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; s1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Integer&gt; s2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> list.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">a</span> <span class="operator">=</span> list.get(i);</span><br><span class="line">            <span class="keyword">if</span> (a &lt; p) &#123;</span><br><span class="line">                s1.add(a);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                s2.add(a);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (k == s1.size() + <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (k &lt; s1.size() + <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> getNumK(s1, k);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            s1.add(p);</span><br><span class="line">            <span class="keyword">return</span> getNumK(s2, k - s1.size());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//~ output:</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 第3小的元素是3</span></span><br><span class="line"><span class="comment"> 第2小的元素是2</span></span><br><span class="line"><span class="comment"> 第1小的元素是1</span></span><br><span class="line"><span class="comment"> 第5小的元素是5</span></span><br><span class="line"><span class="comment"> 第8小的元素是8</span></span><br><span class="line"><span class="comment"> 第9小的元素是9</span></span><br><span class="line"><span class="comment"> -----</span></span><br><span class="line"><span class="comment"> 第3小的元素是11</span></span><br><span class="line"><span class="comment"> 第2小的元素是8</span></span><br><span class="line"><span class="comment"> 第1小的元素是7</span></span><br><span class="line"><span class="comment"> 第5小的元素是33</span></span><br><span class="line"><span class="comment"> 第8小的元素是66</span></span><br><span class="line"><span class="comment"> 第9小的元素是99</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】机器人运动范围</title>
    <url>/%E7%AE%97%E6%B3%95/jz13-%E6%9C%BA%E5%99%A8%E4%BA%BA%E8%BF%90%E5%8A%A8%E8%8C%83%E5%9B%B4/</url>
    <content><![CDATA[<h2 id="剑指-Offer-第-13-题-机器人运动范围"><a href="#剑指-Offer-第-13-题-机器人运动范围" class="headerlink" title="剑指 Offer 第 13 题-机器人运动范围"></a>剑指 Offer 第 13 题-机器人运动范围</h2><p>地上有一个 rows 行和 cols 列的方格。坐标从 [0,0] 到 [rows-1,cols-1] 。一个机器人从坐标 [0,0] 的格子开始移动，每一次只能向左，右，上，下四个方向移动一格，但是不能进入行坐标和列坐标的数位之和大于 threshold 的格子。 例如，当 threshold 为 18 时，机器人能够进入方格 [35,37] ，因为 3+5+3+7 = 18。但是，它不能进入方格 [35,38] ，因为 3+5+3+8 = 19 。请问该机器人能够达到多少个格子？</p>
<h2 id="错误案例"><a href="#错误案例" class="headerlink" title="错误案例"></a>错误案例</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz13_1_wrong</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(movingCount(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(movingCount(<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(movingCount(<span class="number">10</span>, <span class="number">1</span>, <span class="number">100</span>));</span><br><span class="line">        System.out.println(movingCount(<span class="number">5</span>, <span class="number">10</span>, <span class="number">10</span>));</span><br><span class="line">        System.out.println(movingCount(<span class="number">15</span>, <span class="number">100</span>, <span class="number">100</span>));</span><br><span class="line">        System.out.println(movingCount(<span class="number">18</span>, <span class="number">36</span>, <span class="number">38</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 错误的解法：题目要求，每次只能向左、右、上、下移动。下面的代码没考虑这个，导致跨越的格也存在，会多算</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">movingCount</span><span class="params">(<span class="type">int</span> threshold, <span class="type">int</span> rows, <span class="type">int</span> cols)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (rows == <span class="number">0</span> || cols == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; rows; i++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果i本身就不满足，就不用向后走了</span></span><br><span class="line">            <span class="keyword">if</span> (!reachable(i, <span class="number">0</span>, threshold)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; cols; j++) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 如易j本身就不满足，就不用向后走了</span></span><br><span class="line">                <span class="keyword">if</span> (!reachable(<span class="number">0</span>, j, threshold)) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 根据 threshold，判断 (i,j) 是否可达</span></span><br><span class="line">                <span class="keyword">if</span> (reachable(i, j, threshold)) &#123;</span><br><span class="line">                    count++;</span><br><span class="line">                    System.out.printf(<span class="string">&quot;(%d,%d)%n&quot;</span>, i, j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">reachable</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> threshold)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> getSum(i) + getSum(j);</span><br><span class="line">        <span class="keyword">return</span> sum &lt;= threshold;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getSum</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (a &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            sum += a % <span class="number">10</span>;</span><br><span class="line">            a = a / <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="正确的-DFS-遍历"><a href="#正确的-DFS-遍历" class="headerlink" title="正确的 DFS 遍历"></a>正确的 DFS 遍历</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz13_2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_2</span>().movingCount(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_2</span>().movingCount(<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_2</span>().movingCount(<span class="number">10</span>, <span class="number">1</span>, <span class="number">100</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_2</span>().movingCount(<span class="number">5</span>, <span class="number">10</span>, <span class="number">10</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_2</span>().movingCount(<span class="number">18</span>, <span class="number">36</span>, <span class="number">38</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_2</span>().movingCount(<span class="number">15</span>, <span class="number">100</span>, <span class="number">100</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">movingCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * DFS 遍历</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">movingCount</span><span class="params">(<span class="type">int</span> threshold, <span class="type">int</span> rows, <span class="type">int</span> cols)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (rows == <span class="number">0</span> || cols == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        movingCount = <span class="number">0</span>;</span><br><span class="line">        <span class="type">boolean</span>[][] arr = <span class="keyword">new</span> <span class="title class_">boolean</span>[rows][cols];</span><br><span class="line">        dfs(arr, rows, cols, <span class="number">0</span>, <span class="number">0</span>, threshold);</span><br><span class="line">        <span class="keyword">return</span> movingCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模板：</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 检查下标</span></span><br><span class="line"><span class="comment">     * 检查是否被访问过，或者是否满足当前匹配条件</span></span><br><span class="line"><span class="comment">     * 检查是否满足返回结果条件</span></span><br><span class="line"><span class="comment">     * 标记</span></span><br><span class="line"><span class="comment">     * 进入下下一步递归</span></span><br><span class="line"><span class="comment">     * 回溯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">boolean</span>[][] arr, <span class="type">int</span> rows, <span class="type">int</span> cols, <span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> threshold)</span> &#123;</span><br><span class="line">        <span class="comment">// 检查下标</span></span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || j &lt; <span class="number">0</span> || i &gt;= rows || j &gt;= cols) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查是否被访问过</span></span><br><span class="line">        <span class="keyword">if</span> (arr[i][j]) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查是否满足条件</span></span><br><span class="line">        <span class="keyword">if</span> (!reachable(i, j, threshold)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        arr[i][j] = <span class="literal">true</span>;</span><br><span class="line">        movingCount++;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下一个</span></span><br><span class="line">        dfs(arr, rows, cols, i + <span class="number">1</span>, j, threshold); <span class="comment">// 右</span></span><br><span class="line">        dfs(arr, rows, cols, i, j + <span class="number">1</span>, threshold); <span class="comment">// 下</span></span><br><span class="line">        dfs(arr, rows, cols, i - <span class="number">1</span>, j, threshold); <span class="comment">// 左</span></span><br><span class="line">        dfs(arr, rows, cols, i, j - <span class="number">1</span>, threshold); <span class="comment">// 上</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">reachable</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> threshold)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> getSum(i) + getSum(j);</span><br><span class="line">        <span class="keyword">return</span> sum &lt;= threshold;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getSum</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (a &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            sum += a % <span class="number">10</span>;</span><br><span class="line">            a = a / <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="正确的-BFS-遍历"><a href="#正确的-BFS-遍历" class="headerlink" title="正确的 BFS 遍历"></a>正确的 BFS 遍历</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz13_3</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_3</span>().movingCount(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_3</span>().movingCount(<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_3</span>().movingCount(<span class="number">10</span>, <span class="number">1</span>, <span class="number">100</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_3</span>().movingCount(<span class="number">5</span>, <span class="number">10</span>, <span class="number">10</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_3</span>().movingCount(<span class="number">18</span>, <span class="number">36</span>, <span class="number">38</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_3</span>().movingCount(<span class="number">15</span>, <span class="number">100</span>, <span class="number">100</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用栈来实现</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">movingCount</span><span class="params">(<span class="type">int</span> threshold, <span class="type">int</span> rows, <span class="type">int</span> cols)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (rows == <span class="number">0</span> || cols == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">movingCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">boolean</span>[][] arr = <span class="keyword">new</span> <span class="title class_">boolean</span>[rows][cols];</span><br><span class="line"></span><br><span class="line">        Stack&lt;Pair&lt;Integer, Integer&gt;&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 第一个入栈</span></span><br><span class="line">        stack.push(<span class="keyword">new</span> <span class="title class_">Pair</span>&lt;&gt;(<span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// 出栈，标记</span></span><br><span class="line">            <span class="keyword">final</span> Pair&lt;Integer, Integer&gt; pop = stack.pop();</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">x</span> <span class="operator">=</span> pop.getKey();</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">y</span> <span class="operator">=</span> pop.getValue();</span><br><span class="line">            arr[x][y] = <span class="literal">true</span>;</span><br><span class="line">            movingCount++;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 并将周围入栈（检测边界和条件）</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 右</span></span><br><span class="line">            <span class="keyword">if</span> (border(x + <span class="number">1</span>, y, rows, cols) &amp;&amp; reachable(x + <span class="number">1</span>, y, threshold) &amp;&amp; !arr[x + <span class="number">1</span>][y]) &#123;</span><br><span class="line">                stack.push(<span class="keyword">new</span> <span class="title class_">Pair</span>&lt;&gt;(x + <span class="number">1</span>, y));</span><br><span class="line">                arr[x + <span class="number">1</span>][y] = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 下</span></span><br><span class="line">            <span class="keyword">if</span> (border(x, y + <span class="number">1</span>, rows, cols) &amp;&amp; reachable(x, y + <span class="number">1</span>, threshold) &amp;&amp; !arr[x][y + <span class="number">1</span>]) &#123;</span><br><span class="line">                stack.push(<span class="keyword">new</span> <span class="title class_">Pair</span>&lt;&gt;(x, y + <span class="number">1</span>));</span><br><span class="line">                arr[x][y + <span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 左</span></span><br><span class="line">            <span class="keyword">if</span> (border(x - <span class="number">1</span>, y, rows, cols) &amp;&amp; reachable(x - <span class="number">1</span>, y, threshold) &amp;&amp; !arr[x - <span class="number">1</span>][y]) &#123;</span><br><span class="line">                stack.push(<span class="keyword">new</span> <span class="title class_">Pair</span>&lt;&gt;(x - <span class="number">1</span>, y));</span><br><span class="line">                arr[x - <span class="number">1</span>][y] = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 上</span></span><br><span class="line">            <span class="keyword">if</span> (border(x, y - <span class="number">1</span>, rows, cols) &amp;&amp; reachable(x, y - <span class="number">1</span>, threshold) &amp;&amp; !arr[x][y - <span class="number">1</span>]) &#123;</span><br><span class="line">                stack.push(<span class="keyword">new</span> <span class="title class_">Pair</span>&lt;&gt;(x, y - <span class="number">1</span>));</span><br><span class="line">                arr[x][y - <span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> movingCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 检查边界</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">border</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> rows, <span class="type">int</span> cols)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> i &gt;= <span class="number">0</span> &amp;&amp; i &lt; rows &amp;&amp; j &gt;= <span class="number">0</span> &amp;&amp; j &lt; cols;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查是否可达</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">reachable</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> threshold)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> getSum(i) + getSum(j);</span><br><span class="line">        <span class="keyword">return</span> sum &lt;= threshold;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取数字自身之和</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getSum</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (a &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            sum += a % <span class="number">10</span>;</span><br><span class="line">            a = a / <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Pair</span>&lt;K, V&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> K key;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> V value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> K <span class="title function_">getKey</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> V <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Pair</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.key = key;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="正确的-BFS-遍历（优化）"><a href="#正确的-BFS-遍历（优化）" class="headerlink" title="正确的 BFS 遍历（优化）"></a>正确的 BFS 遍历（优化）</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz13_4</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_4</span>().movingCount(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_4</span>().movingCount(<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_4</span>().movingCount(<span class="number">10</span>, <span class="number">1</span>, <span class="number">100</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_4</span>().movingCount(<span class="number">5</span>, <span class="number">10</span>, <span class="number">10</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_4</span>().movingCount(<span class="number">18</span>, <span class="number">36</span>, <span class="number">38</span>));</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">Jz13_4</span>().movingCount(<span class="number">15</span>, <span class="number">100</span>, <span class="number">100</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// BFS遍历：用栈来实现</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">movingCount</span><span class="params">(<span class="type">int</span> threshold, <span class="type">int</span> rows, <span class="type">int</span> cols)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (rows == <span class="number">0</span> || cols == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">movingCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">boolean</span>[][] arr = <span class="keyword">new</span> <span class="title class_">boolean</span>[rows][cols];</span><br><span class="line"></span><br><span class="line">        Stack&lt;Pair&lt;Integer, Integer&gt;&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 将第一个入栈</span></span><br><span class="line">        stack.push(<span class="keyword">new</span> <span class="title class_">Pair</span>&lt;&gt;(<span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 方向组合，newX=dirs[i], newY=dirs[i+1]，分别对应【左（-1，0）、下（0，1）、右（1，0）、上（0，-1）】</span></span><br><span class="line">        <span class="type">int</span>[] dirs = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;-<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// 出栈，标记</span></span><br><span class="line">            <span class="keyword">final</span> Pair&lt;Integer, Integer&gt; pop = stack.pop();</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">x</span> <span class="operator">=</span> pop.getKey();</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">y</span> <span class="operator">=</span> pop.getValue();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置为true，表示访问过了，不可重复访问</span></span><br><span class="line">            arr[x][y] = <span class="literal">true</span>;</span><br><span class="line">            movingCount++;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 并将周围入栈（检测边界和条件）</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; dirs.length; i++) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">newX</span> <span class="operator">=</span> dirs[i];</span><br><span class="line">                <span class="type">int</span> <span class="variable">newY</span> <span class="operator">=</span> dirs[i + <span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span> (border(newX, newY, rows, cols) &amp;&amp; reachable(newX, newY, threshold) &amp;&amp; !arr[newX][newY]) &#123;</span><br><span class="line">                    stack.push(<span class="keyword">new</span> <span class="title class_">Pair</span>&lt;&gt;(newX, newY));</span><br><span class="line">                    arr[newX][newY] = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> movingCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查边界</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">border</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> rows, <span class="type">int</span> cols)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> i &gt;= <span class="number">0</span> &amp;&amp; i &lt; rows &amp;&amp; j &gt;= <span class="number">0</span> &amp;&amp; j &lt; cols;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查是否可达</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">reachable</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> threshold)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> getSum(i) + getSum(j);</span><br><span class="line">        <span class="keyword">return</span> sum &lt;= threshold;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取数字自身之和</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getSum</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (a &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            sum += a % <span class="number">10</span>;</span><br><span class="line">            a = a / <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Pair</span>&lt;K, V&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> K key;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> V value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> K <span class="title function_">getKey</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> V <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Pair</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.key = key;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】正则表达式匹配</title>
    <url>/%E7%AE%97%E6%B3%95/jz19-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D/</url>
    <content><![CDATA[<h2 id="剑指-Offer-第-19-题-正则表达式匹配"><a href="#剑指-Offer-第-19-题-正则表达式匹配" class="headerlink" title="剑指 Offer 第 19 题-正则表达式匹配"></a>剑指 Offer 第 19 题-正则表达式匹配</h2><p>请实现一个函数用来匹配包括’.’和’<em>‘的正则表达式。模式中的字符’.’表示任意一个字符，而’</em>‘表示它前面的字符可以出现任意次（包含 0 次）。 在本题中，匹配是指字符串的所有字符匹配整个模式。</p>
<p>例如，字符串”aaa”与模式”a.a”和”ab<em>ac</em>a”匹配，但是与”aa.a”和”ab*a”均不匹配</p>
<p>数据范围:</p>
<ul>
<li>1.str 可能为空，且只包含从 a-z 的小写字母。</li>
<li>2.pattern 可能为空，且只包含从 a-z 的小写字母以及字符 . 和 <em>，无连续的 ‘</em>‘。</li>
<li>3.1 &lt;= str.length &lt;= 20</li>
<li>4.1 &lt;= pattern.length &lt;= 30</li>
</ul>
<p>要求：空间复杂度 O(1)O(1)，时间复杂度 O(n)O(n)</p>
<h2 id="方法-1"><a href="#方法-1" class="headerlink" title="方法 1"></a>方法 1</h2><p>在原数组上，移动下标，合并边界</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 描述</span></span><br><span class="line"><span class="comment"> * 请实现一个函数用来匹配包括&#x27;.&#x27;和&#x27;*&#x27;的正则表达式。模式中的字符&#x27;.&#x27;表示任意一个字符，而&#x27;*&#x27;表示它前面的字符可以出现任意次（包含0次）。 在本题中，匹配是指字符串的所有字符匹配整个模式。例如，字符串&quot;aaa&quot;与模式&quot;a.a&quot;和&quot;ab*ac*a&quot;匹配，但是与&quot;aa.a&quot;和&quot;ab*a&quot;均不匹配</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 数据范围:</span></span><br><span class="line"><span class="comment"> * 1.str 可能为空，且只包含从 a-z 的小写字母。</span></span><br><span class="line"><span class="comment"> * 2.pattern 可能为空，且只包含从 a-z 的小写字母以及字符 . 和 *，无连续的 &#x27;*&#x27;。</span></span><br><span class="line"><span class="comment"> * 3.1 &lt;= str.length &lt;= 20</span></span><br><span class="line"><span class="comment"> * 4.1 &lt;= pattern.length &lt;= 30</span></span><br><span class="line"><span class="comment"> * 要求：空间复杂度 O(1)O(1)，时间复杂度 O(n)O(n)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lilou</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz19_1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Jz19_1</span> <span class="variable">jz19</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jz19_1</span>();</span><br><span class="line">        jz19.test(<span class="string">&quot;Test22&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;ab*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        jz19.test(<span class="string">&quot;Test01&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test02&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test03&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test04&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;c*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test05&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test06&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;a.&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test07&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test08&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test09&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;ab*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test10&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;ab*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test11&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test12&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="string">&quot;a*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test13&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test14&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test15&quot;</span>, <span class="string">&quot;ab&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test16&quot;</span>, <span class="string">&quot;ab&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test17&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;aa*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test18&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;aa.a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test19&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;a.a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test20&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;.a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test21&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;a*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test22&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;ab*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test23&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;ab*ac*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test24&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;ab*a*c*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test25&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test26&quot;</span>, <span class="string">&quot;aab&quot;</span>, <span class="string">&quot;c*a*b&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test27&quot;</span>, <span class="string">&quot;aaca&quot;</span>, <span class="string">&quot;ab*a*c*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test28&quot;</span>, <span class="string">&quot;aaba&quot;</span>, <span class="string">&quot;ab*a*c*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test29&quot;</span>, <span class="string">&quot;bbbba&quot;</span>, <span class="string">&quot;.*a*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test30&quot;</span>, <span class="string">&quot;bcbbabab&quot;</span>, <span class="string">&quot;.*a*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(String testName, String str, String pattern, <span class="type">boolean</span> expired)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (match(str, pattern) == expired) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s 结果不对\n&quot;</span>, testName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">match</span><span class="params">(String str, String pattern)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 串和模式为空的判断</span></span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span> &amp;&amp; pattern == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span> || pattern == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转换为char数组</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">char</span>[] strArr = str.toCharArray();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">char</span>[] patternArr = pattern.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">strIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">patternIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 进入递归</span></span><br><span class="line">        <span class="keyword">return</span> matchCore(strArr, strIndex, patternArr, patternIndex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">matchCore</span><span class="params">(<span class="type">char</span>[] strArr, <span class="type">int</span> strIndex, <span class="type">char</span>[] patternArr, <span class="type">int</span> patternIndex)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模式匹配到最后了，就可以决定串是否匹配</span></span><br><span class="line">        <span class="keyword">if</span> (isEnd(patternArr, patternIndex)) &#123;</span><br><span class="line">            <span class="keyword">return</span> isEnd(strArr, strIndex);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果串的第一个字符不存在，</span></span><br><span class="line">        <span class="comment">// 假如串是「aa」，模式是「aaa*」</span></span><br><span class="line">        <span class="comment">// 可以向下进行，判断模式串是不是「.*」或「a*」</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果串的第一个字符存在</span></span><br><span class="line">        <span class="comment">// 判断串的第一个字符是否和模式的第一个字符匹配</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">firstMatch</span> <span class="operator">=</span> !isEnd(strArr, strIndex) &amp;&amp; (</span><br><span class="line">                patternArr[patternIndex] == <span class="string">&#x27;.&#x27;</span> || patternArr[patternIndex] == strArr[strIndex]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断模式的第二个字符是不是「*」</span></span><br><span class="line">        <span class="keyword">if</span> ((patternIndex + <span class="number">1</span> &lt; patternArr.length) &amp;&amp; (patternArr[patternIndex + <span class="number">1</span>] == <span class="string">&#x27;*&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">// 模式串右移2位 或 字符串移动1</span></span><br><span class="line">            <span class="keyword">return</span> matchCore(strArr, strIndex, patternArr, patternIndex + <span class="number">2</span>) ||</span><br><span class="line">                    (firstMatch &amp;&amp; matchCore(strArr, strIndex + <span class="number">1</span>, patternArr, patternIndex));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> firstMatch &amp;&amp; matchCore(strArr, strIndex + <span class="number">1</span>, patternArr, patternIndex + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">char</span> <span class="variable">END</span> <span class="operator">=</span> <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isEnd</span><span class="params">(<span class="type">char</span>[] arr, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> END == indexArr(arr, index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">char</span> <span class="title function_">indexArr</span><span class="params">(<span class="type">char</span>[] arr, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; arr.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> arr[index];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> END;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="方法-2"><a href="#方法-2" class="headerlink" title="方法 2"></a>方法 2</h2><p>在原数组上，移动下标，列出详细的边界</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz19_2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Jz19_2</span> <span class="variable">jz19</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jz19_2</span>();</span><br><span class="line">        jz19.test(<span class="string">&quot;Test22&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;ab*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        jz19.test(<span class="string">&quot;Test01&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test02&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test03&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test04&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;c*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test05&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test06&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;a.&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test07&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test08&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test09&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;ab*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test10&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;ab*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test11&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test12&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="string">&quot;a*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test13&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test14&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test15&quot;</span>, <span class="string">&quot;ab&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test16&quot;</span>, <span class="string">&quot;ab&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test17&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;aa*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test18&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;aa.a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test19&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;a.a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test20&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;.a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test21&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;a*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test22&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;ab*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test23&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;ab*ac*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test24&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;ab*a*c*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test25&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test26&quot;</span>, <span class="string">&quot;aab&quot;</span>, <span class="string">&quot;c*a*b&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test27&quot;</span>, <span class="string">&quot;aaca&quot;</span>, <span class="string">&quot;ab*a*c*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test28&quot;</span>, <span class="string">&quot;aaba&quot;</span>, <span class="string">&quot;ab*a*c*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test29&quot;</span>, <span class="string">&quot;bbbba&quot;</span>, <span class="string">&quot;.*a*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test30&quot;</span>, <span class="string">&quot;bcbbabab&quot;</span>, <span class="string">&quot;.*a*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(String testName, String str, String pattern, <span class="type">boolean</span> expired)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (match(str, pattern) == expired) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s 结果不对\n&quot;</span>, testName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">match</span><span class="params">(String str, String pattern)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 串和模式为空的判断</span></span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span> &amp;&amp; pattern == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span> || pattern == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转换为char数组</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">char</span>[] strArr = str.toCharArray();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">char</span>[] patternArr = pattern.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">strIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">patternIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 进入递归</span></span><br><span class="line">        <span class="keyword">return</span> matchCore(strArr, strIndex, patternArr, patternIndex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">matchCore</span><span class="params">(<span class="type">char</span>[] strArr, <span class="type">int</span> strIndex, <span class="type">char</span>[] patternArr, <span class="type">int</span> patternIndex)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 串或模式边界的判断</span></span><br><span class="line">        <span class="comment">// 串和模式都匹配到最后了: (&quot;&quot;, &quot;&quot;)</span></span><br><span class="line">        <span class="keyword">if</span> (isEnd(strArr, strIndex) &amp;&amp; isEnd(patternArr, patternIndex)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 模式已经匹配到最后了，串还有: (&quot;a&quot;, &quot;&quot;)</span></span><br><span class="line">        <span class="keyword">if</span> (!isEnd(strArr, strIndex) &amp;&amp; isEnd(patternArr, patternIndex)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 串已经匹配到最后了，模式还有</span></span><br><span class="line">        <span class="keyword">if</span> (isEnd(strArr, strIndex) &amp;&amp; !isEnd(patternArr, patternIndex)) &#123;</span><br><span class="line">            <span class="comment">// 串已经匹配到最后了，模式还有情况1(&quot;&quot;, &quot;.*&quot;)</span></span><br><span class="line">            <span class="keyword">if</span> (!isEnd(patternArr, patternIndex + <span class="number">1</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> matchCore(strArr, strIndex, patternArr, patternIndex + <span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 串已经匹配到最后了，情况2 (&quot;&quot;, &quot;.&quot;)、(&quot;&quot;, &quot;a&quot;)、(&quot;&quot;, &quot;..&quot;)</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 模式和串都还有</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 提前校验一下 patternIndex+1</span></span><br><span class="line">        <span class="comment">// 4.1 下一个模式字符没有了（&quot;a&quot;, &quot;.&quot;）、（&quot;a&quot;, &quot;a&quot;）、（&quot;aa&quot;, &quot;a&quot;）</span></span><br><span class="line">        <span class="keyword">if</span> (isEnd(patternArr, patternIndex + <span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="comment">// 下一个串字符是否还有</span></span><br><span class="line">            <span class="keyword">if</span> (!isEnd(strArr, strIndex + <span class="number">1</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 比较当前的串和模式字符</span></span><br><span class="line">            <span class="keyword">return</span> patternArr[patternIndex] == <span class="string">&#x27;.&#x27;</span> || patternArr[patternIndex] == strArr[strIndex];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.2 pattern的第2个字符不为*</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">char</span> <span class="variable">secondPatternChar</span> <span class="operator">=</span> patternArr[patternIndex + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> ((secondPatternChar != <span class="string">&#x27;*&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">// 4.2.1 比较串和模式的第一个字符，第一个模式字符是「.」，或串和模式相等，则匹配下一个字符</span></span><br><span class="line">            <span class="keyword">if</span> (patternArr[patternIndex] == <span class="string">&#x27;.&#x27;</span> || patternArr[patternIndex] == strArr[strIndex]) &#123;</span><br><span class="line">                <span class="keyword">return</span> matchCore(strArr, strIndex + <span class="number">1</span>, patternArr, patternIndex + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 4.2.2 否则直接不匹配</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (patternArr[patternIndex] == <span class="string">&#x27;.&#x27;</span> || patternArr[patternIndex] == strArr[strIndex]) &#123;</span><br><span class="line">            <span class="comment">// 4.3 pattern的第2个字符为「*」，如：(aa, a*)</span></span><br><span class="line">            <span class="comment">// 模式串右移2位 或 字符串移动1</span></span><br><span class="line">            <span class="keyword">return</span> matchCore(strArr, strIndex, patternArr, patternIndex + <span class="number">2</span>) ||</span><br><span class="line">                    <span class="comment">// matchCore(strArr, strIndex + 1, patternArr, patternIndex + 2) ||</span></span><br><span class="line">                    matchCore(strArr, strIndex + <span class="number">1</span>, patternArr, patternIndex);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> matchCore(strArr, strIndex, patternArr, patternIndex + <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">char</span> <span class="variable">END</span> <span class="operator">=</span> <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isEnd</span><span class="params">(<span class="type">char</span>[] arr, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> END == indexArr(arr, index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">char</span> <span class="title function_">indexArr</span><span class="params">(<span class="type">char</span>[] arr, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; arr.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> arr[index];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> END;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="方法-3"><a href="#方法-3" class="headerlink" title="方法 3"></a>方法 3</h2><p>拆出新数组，合并边界</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz19_3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Jz19_3</span> <span class="variable">jz19</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jz19_3</span>();</span><br><span class="line">        jz19.test(<span class="string">&quot;Test22&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;ab*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        jz19.test(<span class="string">&quot;Test01&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test02&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test03&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test04&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;c*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test05&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test06&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;a.&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test07&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test08&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test09&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;ab*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test10&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;ab*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test11&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test12&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="string">&quot;a*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test13&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test14&quot;</span>, <span class="string">&quot;aa&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test15&quot;</span>, <span class="string">&quot;ab&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test16&quot;</span>, <span class="string">&quot;ab&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test17&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;aa*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test18&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;aa.a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test19&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;a.a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test20&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;.a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test21&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;a*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test22&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;ab*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test23&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;ab*ac*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test24&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;ab*a*c*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test25&quot;</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;.*&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test26&quot;</span>, <span class="string">&quot;aab&quot;</span>, <span class="string">&quot;c*a*b&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test27&quot;</span>, <span class="string">&quot;aaca&quot;</span>, <span class="string">&quot;ab*a*c*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test28&quot;</span>, <span class="string">&quot;aaba&quot;</span>, <span class="string">&quot;ab*a*c*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test29&quot;</span>, <span class="string">&quot;bbbba&quot;</span>, <span class="string">&quot;.*a*a&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        jz19.test(<span class="string">&quot;Test30&quot;</span>, <span class="string">&quot;bcbbabab&quot;</span>, <span class="string">&quot;.*a*a&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(String testName, String str, String pattern, <span class="type">boolean</span> expired)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (match(str, pattern) == expired) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s 结果不对\n&quot;</span>, testName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">match</span><span class="params">(String str, String pattern)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 串和模式为空的判断</span></span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span> &amp;&amp; pattern == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span> || pattern == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转换为char数组</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">char</span>[] strArr = str.toCharArray();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">char</span>[] patternArr = pattern.toCharArray();</span><br><span class="line">        <span class="comment">// 进入递归</span></span><br><span class="line">        <span class="keyword">return</span> matchCore(strArr, patternArr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">matchCore</span><span class="params">(<span class="type">char</span>[] strArr, <span class="type">char</span>[] patternArr)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模式到最后了，看串是否还有（没有则匹配，有则不匹配）</span></span><br><span class="line">        <span class="keyword">if</span> (isEmptyArr(patternArr)) &#123;</span><br><span class="line">            <span class="keyword">return</span> isEmptyArr(strArr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 串的第一个字符存在，且模式的第一个字符匹配串的第一个字符</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">firstMatch</span> <span class="operator">=</span> !isEmptyArr(strArr) &amp;&amp;</span><br><span class="line">                (patternArr[<span class="number">0</span>] == <span class="string">&#x27;.&#x27;</span> || patternArr[<span class="number">0</span>] == strArr[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模式串第2位为*</span></span><br><span class="line">        <span class="keyword">if</span> (patternArr.length &gt;= <span class="number">2</span> &amp;&amp; patternArr[<span class="number">1</span>] == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 不论第一个是否匹配，模式串后移2位</span></span><br><span class="line">            <span class="keyword">return</span> matchCore(strArr, subArr(<span class="number">2</span>, patternArr)) ||</span><br><span class="line">                    <span class="comment">// 或者，如果第一个匹配，串后移一位</span></span><br><span class="line">                    (firstMatch &amp;&amp; matchCore(subArr(<span class="number">1</span>, strArr), patternArr));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 其它情况，要求第一个匹配，且后面的也匹配</span></span><br><span class="line">        <span class="keyword">return</span> firstMatch &amp;&amp; matchCore(subArr(<span class="number">1</span>, strArr), subArr(<span class="number">1</span>, patternArr));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isEmptyArr</span><span class="params">(<span class="type">char</span>[] arr)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> arr == <span class="literal">null</span> || arr.length == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">char</span>[] subArr(<span class="type">int</span> start, <span class="type">char</span>[] arr) &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.copyOfRange(arr, start, arr.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】奇数位于偶数前面</title>
    <url>/%E7%AE%97%E6%B3%95/jz21-%E5%A5%87%E6%95%B0%E4%BD%8D%E4%BA%8E%E5%81%B6%E6%95%B0%E5%89%8D%E9%9D%A2/</url>
    <content><![CDATA[<h2 id="剑指-Offer-第-21-题-奇数位于偶数前面"><a href="#剑指-Offer-第-21-题-奇数位于偶数前面" class="headerlink" title="剑指 Offer 第 21 题-奇数位于偶数前面"></a>剑指 Offer 第 21 题-奇数位于偶数前面</h2><p><a href="https://www.nowcoder.com/practice/ef1f53ef31ca408cada5093c8780f44b">https://www.nowcoder.com/practice/ef1f53ef31ca408cada5093c8780f44b</a></p>
<p>描述</p>
<p>输入一个长度为 n 整数数组，数组里面不含有相同的元素，实现一个函数来调整该数组中数字的顺序，使得所有的奇数位于数组的前面部分，所有的偶数位于数组的后面部分，并保证奇数和奇数，偶数和偶数之间的相对位置不变。</p>
<p>数据范围：0 &lt;= n &lt;= 50000，数组中每个数的值 0 &lt;= val &lt;= 100000</p>
<p>要求：时间复杂度 O(n)O(n)，空间复杂度 O(n)O(n)</p>
<p>进阶：时间复杂度 O(n^2)O(n )，空间复杂度 O(1)O(1)</p>
<h2 id="方法-1-枚举法"><a href="#方法-1-枚举法" class="headerlink" title="方法 1 - 枚举法"></a>方法 1 - 枚举法</h2><p>创建一个新的数组，分两次遍历数组并添加到新数组中。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz21_1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Arrays.toString(reOrderArray(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;)));</span><br><span class="line">        System.out.println(Arrays.toString(reOrderArray(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">7</span>&#125;)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] reOrderArray(<span class="type">int</span>[] array) &#123;</span><br><span class="line">        <span class="type">int</span>[] result = <span class="keyword">new</span> <span class="title class_">int</span>[array.length];</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> odd : array) &#123;</span><br><span class="line">            <span class="keyword">if</span> (odd % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">                result[index++] = odd;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> even : array) &#123;</span><br><span class="line">            <span class="keyword">if</span> (even % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                result[index++] = even;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="方法-2-冒泡法"><a href="#方法-2-冒泡法" class="headerlink" title="方法 2 - 冒泡法"></a>方法 2 - 冒泡法</h2><p>找到下一个奇数位置，冒泡到前面来</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz21_2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Arrays.toString(reOrderArray(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">7</span>&#125;)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] reOrderArray(<span class="type">int</span>[] array) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 当前位置是否是奇数</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">odd</span> <span class="operator">=</span> array[i] % <span class="number">2</span> == <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 当前位置是奇数，进入下一轮</span></span><br><span class="line">            <span class="keyword">if</span> (odd) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 下一个奇数位置</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">nextOddIndex</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 当前是偶数</span></span><br><span class="line">            <span class="comment">// 找到下一个奇数位置</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; array.length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (array[j] % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">                    nextOddIndex = j;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果后面没有奇数了，可以直接退出了</span></span><br><span class="line">            <span class="keyword">if</span> (nextOddIndex == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> array;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 存在奇数，下一个奇数冒泡到当前偶数所在的位置</span></span><br><span class="line">            bubble(array, i, nextOddIndex);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bubble</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> currentIndex, <span class="type">int</span> nextOddIndex)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (currentIndex &lt; nextOddIndex) &#123;</span><br><span class="line">            swap(array, nextOddIndex - <span class="number">1</span>, nextOddIndex);</span><br><span class="line">            nextOddIndex = nextOddIndex - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> array[i];</span><br><span class="line">        array[i] = array[j];</span><br><span class="line">        array[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="策略化版本"><a href="#策略化版本" class="headerlink" title="策略化版本"></a>策略化版本</h2><p>输入一个长度为 n 整数数组，数组里面不含有相同的元素，实现一个函数来调整该数组中数字的顺序，使得所有的奇数位于数组的前面部分，所有的偶数位于数组的后面部分<br>（注意，区别于前面的版本，这里不需要保证奇数和奇数，偶数和偶数之间的相对位置不变。）</p>
<p>另外添加了其它的策略：偶数在前、能被 3 整除的在前。</p>
<p>这个做法，能够灵活适配新的类似的要求。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz21_3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;奇数排在前面&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.toString(reOrderArray(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">7</span>&#125;, Jz21_3::isOdd)));</span><br><span class="line">        System.out.println(Arrays.toString(reOrderArray(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;, Jz21_3::isOdd)));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;偶数排在前面&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.toString(reOrderArray(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">7</span>&#125;, Jz21_3::isEven)));</span><br><span class="line">        System.out.println(Arrays.toString(reOrderArray(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;, Jz21_3::isEven)));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;能被3整除的在前面&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.toString(reOrderArray(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">7</span>&#125;, Jz21_3::isThreeTime)));</span><br><span class="line">        System.out.println(Arrays.toString(reOrderArray(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;, Jz21_3::isThreeTime)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] reOrderArray(<span class="type">int</span>[] array, Predicate&lt;Integer&gt; predicate) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (array == <span class="literal">null</span> || array.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> array;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> array.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            <span class="keyword">while</span> (left &lt; right &amp;&amp; predicate.test(array[left])) &#123;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (left &lt; right &amp;&amp; !predicate.test(array[right])) &#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (left &lt; right) &#123;</span><br><span class="line">                swap(array, left, right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isOdd</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> i % <span class="number">2</span> == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isEven</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> i % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isThreeTime</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> i % <span class="number">3</span> == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> array[i];</span><br><span class="line">        array[i] = array[j];</span><br><span class="line"></span><br><span class="line">        array[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】链表中环的入口结点</title>
    <url>/%E7%AE%97%E6%B3%95/jz23-%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%8E%AF%E7%9A%84%E5%85%A5%E5%8F%A3%E7%BB%93%E7%82%B9/</url>
    <content><![CDATA[<h2 id="剑指-Offer-第-23-题-链表中环的入口结点"><a href="#剑指-Offer-第-23-题-链表中环的入口结点" class="headerlink" title="剑指 Offer 第 23 题-链表中环的入口结点"></a>剑指 Offer 第 23 题-链表中环的入口结点</h2><p>给一个长度为 n 链表，若其中包含环，请找出该链表的环的入口结点，否则，返回 null。<br><a href="https://www.nowcoder.com/practice/253d2c59ec3e4bc68da16833f79a38e4">https://www.nowcoder.com/practice/253d2c59ec3e4bc68da16833f79a38e4</a></p>
<h2 id="方法-1-快慢指针"><a href="#方法-1-快慢指针" class="headerlink" title="方法 1-快慢指针"></a>方法 1-快慢指针</h2><p>思路：</p>
<ol>
<li>确定是否有环：两个快慢指针相遇</li>
<li>确定环的个数：让指针从相遇的节点再回到这个节点，得到环个数 n</li>
<li>确定环入口节点：一个指针先走 n 步，接着和第二个指针同步向前，相遇的点就是入口节点</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz23</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Jz23</span> <span class="variable">jz23</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jz23</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ListNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ListNode</span> <span class="variable">node3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">3</span>);</span><br><span class="line">        root</span><br><span class="line">                .append(<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">2</span>))</span><br><span class="line">                .append(node3)</span><br><span class="line">                .append(<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">4</span>))</span><br><span class="line">                .append(<span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">5</span>))</span><br><span class="line">                .append(node3)</span><br><span class="line">        ;</span><br><span class="line">        System.out.println(jz23.EntryNodeOfLoop(root).val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">EntryNodeOfLoop</span><span class="params">(ListNode pHead)</span> &#123;</span><br><span class="line">        <span class="comment">// 确定是否有环：两个快慢指针相遇</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">meetNode</span> <span class="operator">=</span> getMeetNode(pHead);</span><br><span class="line">        <span class="keyword">if</span> (meetNode == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 确定环的个数：让指针从相遇的节点再回到这个节点，得到环个数n</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">loopCount</span> <span class="operator">=</span> getLoopCount(meetNode);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 确定环入口节点：一个指针先走n步，接着和第二个指针同步向前，相遇的点就是入口节点</span></span><br><span class="line">        <span class="keyword">return</span> getEntryNode(pHead, loopCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ListNode <span class="title function_">getEntryNode</span><span class="params">(ListNode pHead, <span class="type">int</span> loopCount)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> pHead;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> pHead;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 快指针先行loopCount步</span></span><br><span class="line">        <span class="keyword">while</span> (loopCount-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (fast != slow) &#123;</span><br><span class="line">            fast = fast.next;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fast;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getLoopCount</span><span class="params">(ListNode meetNode)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">moveNode</span> <span class="operator">=</span> meetNode.next;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (moveNode != meetNode) &#123;</span><br><span class="line">            moveNode = moveNode.next;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ListNode <span class="title function_">getMeetNode</span><span class="params">(ListNode pHead)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> pHead;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> pHead;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; slow != <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            fast = fast.next;</span><br><span class="line">            <span class="keyword">if</span> (fast != <span class="literal">null</span>) &#123;</span><br><span class="line">                fast = fast.next;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            slow = slow.next;</span><br><span class="line">            <span class="keyword">if</span> (fast != <span class="literal">null</span> &amp;&amp; fast == slow) &#123;</span><br><span class="line">                <span class="keyword">return</span> fast;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">        <span class="type">int</span> val;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">next</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ListNode</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.val = val;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ListNode <span class="title function_">append</span><span class="params">(ListNode next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="方法-2-hash-法"><a href="#方法-2-hash-法" class="headerlink" title="方法 2-hash 法"></a>方法 2-hash 法</h2><p>将值记录到 set 中，首次出现存在的值，对应的就是那个入口点</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">EntryNodeOfLoop</span><span class="params">(ListNode pHead)</span> &#123;</span><br><span class="line">    <span class="comment">// 将值记录到set中，首次出现存在的值，对应的就是那个入口点</span></span><br><span class="line">    Set&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (pHead != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (set.contains(pHead.val)) &#123;</span><br><span class="line">            <span class="keyword">return</span> pHead;</span><br><span class="line">        &#125;</span><br><span class="line">        set.add(pHead.val);</span><br><span class="line">        pHead = pHead.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】链表中倒数最后K个结点</title>
    <url>/%E7%AE%97%E6%B3%95/jz22-%E9%93%BE%E8%A1%A8%E4%B8%AD%E5%80%92%E6%95%B0%E6%9C%80%E5%90%8Ek%E4%B8%AA%E7%BB%93%E7%82%B9/</url>
    <content><![CDATA[<h2 id="剑指-Offer-第-22-题-链表中倒数最后-k-个结点"><a href="#剑指-Offer-第-22-题-链表中倒数最后-k-个结点" class="headerlink" title="剑指 Offer 第 22 题-链表中倒数最后 k 个结点"></a>剑指 Offer 第 22 题-链表中倒数最后 k 个结点</h2><p>输入一个长度为 n 的链表，设链表中的元素的值为 ai ，返回该链表中倒数第 k 个节点。<br>如果该链表长度小于 k，请返回一个长度为 0 的链表。</p>
<p><a href="https://www.nowcoder.com/practice/886370fe658f41b498d40fb34ae76ff9">https://www.nowcoder.com/practice/886370fe658f41b498d40fb34ae76ff9</a></p>
<h2 id="方法-1"><a href="#方法-1" class="headerlink" title="方法 1"></a>方法 1</h2><p>先找总个数，再取第 n-k+1 个节点</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">FindKthToTail</span><span class="params">(ListNode pHead, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">       <span class="comment">// 获取总个数n</span></span><br><span class="line">       <span class="comment">// 假设从1开始计数，则取的是第n-k+1个</span></span><br><span class="line"></span><br><span class="line">       <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       <span class="type">ListNode</span> <span class="variable">loopNode</span> <span class="operator">=</span> pHead;</span><br><span class="line">       <span class="keyword">while</span> (loopNode != <span class="literal">null</span>) &#123;</span><br><span class="line">           count++;</span><br><span class="line">           loopNode = loopNode.next;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (k &gt; count) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       loopNode = pHead;</span><br><span class="line">       <span class="keyword">while</span> (loopNode != <span class="literal">null</span>) &#123;</span><br><span class="line">           index++;</span><br><span class="line">           <span class="keyword">if</span> (count - k + <span class="number">1</span> == index) &#123;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           loopNode = loopNode.next;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// write code here</span></span><br><span class="line">       <span class="keyword">return</span> loopNode;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="方法-2"><a href="#方法-2" class="headerlink" title="方法 2"></a>方法 2</h2><p>两个指针法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">FindKthToTail</span><span class="params">(ListNode pHead, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="comment">// 两个指针，一个指针先行，当移动个数大于k个后，另一个指针才开始移动，一直到结束</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">firstNode</span> <span class="operator">=</span> pHead;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">secondNode</span> <span class="operator">=</span> pHead;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (firstNode != <span class="literal">null</span>) &#123;</span><br><span class="line">        right++;</span><br><span class="line">        <span class="keyword">if</span> (right &gt; k) &#123;</span><br><span class="line">            secondNode = secondNode.next;</span><br><span class="line">        &#125;</span><br><span class="line">        firstNode = firstNode.next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 总数个数不足k的情况</span></span><br><span class="line">    <span class="keyword">if</span> (right &lt; k) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第二个指针，即所要求的位置</span></span><br><span class="line">    <span class="keyword">return</span> secondNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="方法-3"><a href="#方法-3" class="headerlink" title="方法 3"></a>方法 3</h2><p>栈，思路是：是入栈，再从栈中数 k 个数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">FindKthToTail</span><span class="params">(ListNode pHead, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="comment">// 先入栈</span></span><br><span class="line">    Stack&lt;ListNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (pHead != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.push(pHead);</span><br><span class="line">        pHead = pHead.next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 再从栈中数k个数</span></span><br><span class="line">    <span class="keyword">if</span> (stack.size() &lt; k) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从栈中找第k个数</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span> (k-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        result = stack.pop();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】顺时针打印矩阵</title>
    <url>/%E7%AE%97%E6%B3%95/jz29-%E9%A1%BA%E6%97%B6%E9%92%88%E6%89%93%E5%8D%B0%E7%9F%A9%E9%98%B5/</url>
    <content><![CDATA[<h2 id="剑指-Offer-第-23-题-链表中环的入口结点"><a href="#剑指-Offer-第-23-题-链表中环的入口结点" class="headerlink" title="剑指 Offer 第 23 题-链表中环的入口结点"></a><a href="https://www.nowcoder.com/practice/9b4c81a02cd34f76be2659fa0d54342a">剑指 Offer 第 23 题-链表中环的入口结点</a></h2><p>描述: 输入一个矩阵，按照从外向里以顺时针的顺序依次打印出每一个数字，例如，如果输入如下 4 X 4 矩阵：</p>
<figure class="highlight inform7"><table><tr><td class="code"><pre><span class="line"><span class="comment">[<span class="comment">[1,2,3,4]</span>,</span></span><br><span class="line"><span class="comment"><span class="comment">[5,6,7,8]</span>,</span></span><br><span class="line"><span class="comment"><span class="comment">[9,10,11,12]</span>,</span></span><br><span class="line"><span class="comment"><span class="comment">[13,14,15,16]</span>]</span></span><br></pre></td></tr></table></figure>

<p>则依次打印出数字</p>
<p>[1,2,3,4,8,12,16,15,14,13,9,5,6,7,11,10]</p>
<p>数据范围:</p>
<p>0 &lt;= matrix.length &lt;= 100</p>
<p>0 &lt;= matrix[i].length &lt;= 100</p>
<p>例如：</p>
<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/jz29-%E9%A1%BA%E6%97%B6%E9%92%88%E6%89%93%E5%8D%B0%E7%9F%A9%E9%98%B5_20220121170748_2022-01-21-17-07-49.png" alt="jz29-顺时针打印矩阵_20220121170748_2022-01-21-17-07-49"></p>
<h2 id="方法-1"><a href="#方法-1" class="headerlink" title="方法 1"></a>方法 1</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz29_2</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Jz29_3_1</span> <span class="variable">jz</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jz29_3_1</span>();</span><br><span class="line">        System.out.println(jz.printMatrix(<span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;</span><br><span class="line">                &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>&#125;,</span><br><span class="line">                &#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>&#125;,</span><br><span class="line">                &#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        System.out.println(jz.printMatrix(<span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;</span><br><span class="line">                &#123;<span class="number">1</span>&#125;, &#123;<span class="number">2</span>&#125;, &#123;<span class="number">3</span>&#125;, &#123;<span class="number">4</span>&#125;, &#123;<span class="number">5</span>&#125;</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        System.out.println(jz.printMatrix(<span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;</span><br><span class="line">                &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        System.out.println(jz.printMatrix(<span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;</span><br><span class="line">                &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;,</span><br><span class="line">                &#123;<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;,</span><br><span class="line">                &#123;<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>&#125;,</span><br><span class="line">                &#123;<span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>&#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对于只有一行或只有一列时，会重复</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title function_">printMatrix</span><span class="params">(<span class="type">int</span>[][] matrix)</span> &#123;</span><br><span class="line">        <span class="comment">// 为空的情况</span></span><br><span class="line">        <span class="keyword">if</span> (matrix == <span class="literal">null</span> || matrix.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(matrix.length * matrix[<span class="number">0</span>].length);</span><br><span class="line">        <span class="type">int</span> <span class="variable">minX</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxX</span> <span class="operator">=</span> matrix.length - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">minY</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxY</span> <span class="operator">=</span> matrix[<span class="number">0</span>].length - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> x, y;</span><br><span class="line">        <span class="keyword">while</span> (minX &lt;= maxX &amp;&amp; minY &lt;= maxY) &#123;</span><br><span class="line">            <span class="comment">// 用两个标识来判断本轮是否有下移或左移</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">down</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">left</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 从左上角开始</span></span><br><span class="line">            <span class="comment">// 向右</span></span><br><span class="line">            <span class="keyword">for</span> (x = minX, y = minY; y &lt;= maxY; y++) &#123;</span><br><span class="line">                list.add(matrix[x][y]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 向下</span></span><br><span class="line">            <span class="keyword">for</span> (x = minX + <span class="number">1</span>, y = maxY; x &lt;= maxX; x++) &#123;</span><br><span class="line">                list.add(matrix[x][y]);</span><br><span class="line">                down = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 向左，左移之前确认是否有下移，防止重复</span></span><br><span class="line">            <span class="keyword">for</span> (x = maxX, y = maxY - <span class="number">1</span>; down &amp;&amp; y &gt;= minY; y--) &#123;</span><br><span class="line">                list.add(matrix[x][y]);</span><br><span class="line">                left = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 向上，上移之前确认是否有左移，防止重复</span></span><br><span class="line">            <span class="keyword">for</span> (x = maxX - <span class="number">1</span>, y = minY; left &amp;&amp; x &gt; minX; x--) &#123;</span><br><span class="line">                list.add(matrix[x][y]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 瘦身一圈</span></span><br><span class="line">            minX++;</span><br><span class="line">            maxX--;</span><br><span class="line">            minY++;</span><br><span class="line">            maxY--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="方法-2"><a href="#方法-2" class="headerlink" title="方法 2"></a>方法 2</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz29_4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Jz29_4</span> <span class="variable">jz</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jz29_4</span>();</span><br><span class="line">        System.out.println(jz.printMatrix(<span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;</span><br><span class="line">                &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>&#125;,</span><br><span class="line">                &#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>&#125;,</span><br><span class="line">                &#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        System.out.println(jz.printMatrix(<span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;</span><br><span class="line">                &#123;<span class="number">1</span>&#125;, &#123;<span class="number">2</span>&#125;, &#123;<span class="number">3</span>&#125;, &#123;<span class="number">4</span>&#125;, &#123;<span class="number">5</span>&#125;</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        System.out.println(jz.printMatrix(<span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;</span><br><span class="line">                &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        System.out.println(jz.printMatrix(<span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;</span><br><span class="line">                &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;,</span><br><span class="line">                &#123;<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;,</span><br><span class="line">                &#123;<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>&#125;,</span><br><span class="line">                &#123;<span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>&#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 起始点从左上角，沿对角线往中间靠</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title function_">printMatrix</span><span class="params">(<span class="type">int</span>[][] matrix)</span> &#123;</span><br><span class="line">        <span class="comment">// 为空的情况</span></span><br><span class="line">        <span class="keyword">if</span> (matrix == <span class="literal">null</span> || matrix.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(matrix.length * matrix[<span class="number">0</span>].length);</span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (matrix.length &gt; start * <span class="number">2</span> &amp;&amp; matrix[<span class="number">0</span>].length &gt; start * <span class="number">2</span>) &#123;</span><br><span class="line">            addToList(list, matrix, start);</span><br><span class="line">            start++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addToList</span><span class="params">(ArrayList&lt;Integer&gt; list, <span class="type">int</span>[][] matrix, <span class="type">int</span> start)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// max row index</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">maxX</span> <span class="operator">=</span> matrix.length - <span class="number">1</span> - start;</span><br><span class="line">        <span class="comment">// max column index</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">maxY</span> <span class="operator">=</span> matrix[<span class="number">0</span>].length - <span class="number">1</span> - start;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">down</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">left</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从左向右</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt;= maxY; ++i) &#123;</span><br><span class="line">            list.add(matrix[start][i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从上向下</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start + <span class="number">1</span>; i &lt;= maxX; i++) &#123;</span><br><span class="line">            list.add(matrix[i][maxY]);</span><br><span class="line">            down = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从右向左</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> maxY - <span class="number">1</span>; down &amp;&amp; i &gt;= start; i--) &#123;</span><br><span class="line">            list.add(matrix[maxX][i]);</span><br><span class="line">            left = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从下向上</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> maxX - <span class="number">1</span>; left &amp;&amp; i &gt; start + <span class="number">1</span>; i--) &#123;</span><br><span class="line">            list.add(matrix[i][start]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】从上到下打印二叉树</title>
    <url>/%E7%AE%97%E6%B3%95/jz32-%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91/</url>
    <content><![CDATA[<h2 id="剑指-Offer-第-32-题-从上到下打印二叉树"><a href="#剑指-Offer-第-32-题-从上到下打印二叉树" class="headerlink" title="剑指 Offer 第 32 题-从上到下打印二叉树"></a>剑指 Offer 第 32 题-从上到下打印二叉树</h2><p>描述</p>
<p>输入一个整数数组，判断该数组是不是某二叉搜索树的后序遍历的结果。如果是则返回 true ,否则返回 false 。假设输入的数组的任意两个数字都互不相同。<br>数据范围： 节点数量 0≤n≤1000 ，节点上的值满足 1≤val≤10^5，保证节点上的值各不相同</p>
<p>要求：空间复杂度 O(n) ，时间时间复杂度 O(n^2)</p>
<p>提示：</p>
<p>1.二叉搜索树是指父亲节点大于左子树中的全部节点，但是小于右子树中的全部节点的树。</p>
<p>2.该题我们约定空树不是二叉搜索树</p>
<p>3.后序遍历是指按照 “左子树-右子树-根节点” 的顺序遍历</p>
<p>4.参考下面的二叉搜索树，示例 1<br><img src="https://raw.githubusercontent.com/lyloou/img/develop/jz32-%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91_20220124175723_2022-01-24-17-57-24.png" alt="jz32-从上到下打印二叉树_20220124175723_2022-01-24-17-57-24"></p>
<h2 id="方法-1"><a href="#方法-1" class="headerlink" title="方法 1"></a>方法 1</h2><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/jz32-%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91_20220124175628_2022-01-24-17-56-29.png" alt="jz32-从上到下打印二叉树_20220124175628_2022-01-24-17-56-29"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从上往下</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lilou</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz32</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Jz32</span> <span class="variable">jz</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jz32</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node10</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">10</span>);</span><br><span class="line">        root.left = <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">6</span>);</span><br><span class="line">        root.right = node10;</span><br><span class="line">        node10.left = <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">1</span>);</span><br><span class="line">        node10.right = <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">2</span>);</span><br><span class="line">        System.out.println(jz.PrintFromTopToBottom(root));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ArrayList&lt;Integer&gt; <span class="title function_">PrintFromTopToBottom</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.offer(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">            list.add(node.val);</span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                queue.offer(node.left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                queue.offer(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">val</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">left</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">right</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">TreeNode</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.val = val;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="扩展-按层次打印"><a href="#扩展-按层次打印" class="headerlink" title="扩展-按层次打印"></a>扩展-按层次打印</h2><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/jz32-%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91_20220124175928_2022-01-24-17-59-28.png" alt="jz32-从上到下打印二叉树_20220124175928_2022-01-24-17-59-28"></p>
<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/jz32-%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91_20220124175801_2022-01-24-17-58-01.png" alt="jz32-从上到下打印二叉树_20220124175801_2022-01-24-17-58-01"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> algorithm.jzoffer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 按层次打印</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lilou</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz32_3</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Jz32_3</span> <span class="variable">jz</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jz32_3</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node10</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">6</span>);</span><br><span class="line">        root.left = node6;</span><br><span class="line">        root.right = node10;</span><br><span class="line">        node10.left = <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">1</span>);</span><br><span class="line">        node10.right = <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">2</span>);</span><br><span class="line">        node6.left = <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">7</span>);</span><br><span class="line">        node6.right = <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">11</span>);</span><br><span class="line"></span><br><span class="line">        jz.PrintFromTopToBottom(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">PrintFromTopToBottom</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.offer(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">toBePrint</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">nextLevel</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">            System.out.printf(<span class="string">&quot;%s\t&quot;</span>, node.val);</span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                queue.offer(node.left);</span><br><span class="line">                nextLevel++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                queue.offer(node.right);</span><br><span class="line">                nextLevel++;</span><br><span class="line">            &#125;</span><br><span class="line">            toBePrint--;</span><br><span class="line">            <span class="keyword">if</span> (toBePrint == <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println();</span><br><span class="line">                toBePrint = nextLevel;</span><br><span class="line">                nextLevel = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">val</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">left</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">right</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">TreeNode</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.val = val;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="扩展-按「之」字打印"><a href="#扩展-按「之」字打印" class="headerlink" title="扩展-按「之」字打印"></a>扩展-按「之」字打印</h2><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/jz32-%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91_20220124175912_2022-01-24-17-59-13.png" alt="jz32-从上到下打印二叉树_20220124175912_2022-01-24-17-59-13"><br><img src="https://raw.githubusercontent.com/lyloou/img/develop/jz32-%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91_20220124175849_2022-01-24-17-58-49.png" alt="jz32-从上到下打印二叉树_20220124175849_2022-01-24-17-58-49"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> algorithm.jzoffer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 按之字打印</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lilou</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Jz32_4</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Jz32_4</span> <span class="variable">jz</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jz32_4</span>();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">4</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">6</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">7</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node8</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node9</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">9</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node10</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node11</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">11</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node12</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">12</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node13</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">13</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node14</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">14</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node15</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">15</span>);</span><br><span class="line">        node1.left = node2;</span><br><span class="line">        node1.right = node3;</span><br><span class="line">        node2.left = node4;</span><br><span class="line">        node2.right = node5;</span><br><span class="line">        node3.left = node6;</span><br><span class="line">        node3.right = node7;</span><br><span class="line">        node4.left = node8;</span><br><span class="line">        node4.right = node9;</span><br><span class="line">        node5.left = node10;</span><br><span class="line">        node5.right = node11;</span><br><span class="line">        node6.left = node12;</span><br><span class="line">        node6.right = node13;</span><br><span class="line">        node7.left = node14;</span><br><span class="line">        node7.right = node15;</span><br><span class="line"></span><br><span class="line">        jz.PrintFromTopToBottom(node1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">PrintFromTopToBottom</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack1 = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        Stack&lt;TreeNode&gt; stack2 = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        stack1.push(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!stack1.isEmpty() || !stack2.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!stack1.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> stack1.pop();</span><br><span class="line">                System.out.printf(<span class="string">&quot;%s\t&quot;</span>, node.val);</span><br><span class="line">                <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                    stack2.push(node.left);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                    stack2.push(node.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 下一层</span></span><br><span class="line">            System.out.println();</span><br><span class="line">            <span class="keyword">while</span> (!stack2.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> stack2.pop();</span><br><span class="line">                System.out.printf(<span class="string">&quot;%s\t&quot;</span>, node.val);</span><br><span class="line">                <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                    stack1.push(node.right);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                    stack1.push(node.left);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">val</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">left</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">right</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">TreeNode</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.val = val;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】二分查找算法</title>
    <url>/%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h2 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 二分查找，从有序的数组中找到目标值</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinarySearch</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;找-1的下标：&quot;</span> + bSearch(arr, -<span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;找1的下标：&quot;</span> + bSearch(arr, <span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;找2的下标：&quot;</span> + bSearch(arr, <span class="number">2</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;找3的下标：&quot;</span> + bSearch(arr, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;找4的下标：&quot;</span> + bSearch(arr, <span class="number">4</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;找5的下标：&quot;</span> + bSearch(arr, <span class="number">5</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;找6的下标：&quot;</span> + bSearch(arr, <span class="number">6</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;找7的下标：&quot;</span> + bSearch(arr, <span class="number">7</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;找8的下标：&quot;</span> + bSearch(arr, <span class="number">8</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;找9的下标：&quot;</span> + bSearch(arr, <span class="number">9</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;找10的下标：&quot;</span> + bSearch(arr, <span class="number">10</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;从null中找1的下标：&quot;</span> + bSearch(<span class="literal">null</span>, <span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;从&#123;&#125;中找1的下标：&quot;</span> + bSearch(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;&#125;, <span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;从&#123;1&#125;找1的下标：&quot;</span> + bSearch(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>&#125;, <span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;从&#123;1&#125;找2的下标：&quot;</span> + bSearch(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>&#125;, <span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">bSearch</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr == <span class="literal">null</span> || arr.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">first</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">last</span> <span class="operator">=</span> arr.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (first &lt;= last) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 取中间值</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (first + last) &gt;&gt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (arr[mid] == target) &#123; <span class="comment">// 中间值正好是要找的目标值</span></span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[mid] &gt; target) &#123; <span class="comment">// 中间值大于目标值，在左边找</span></span><br><span class="line">                last = mid - <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 中间值小于目标值，在右边找</span></span><br><span class="line">                first = mid + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="comment">/* 输出：</span></span><br><span class="line"><span class="comment">找-1的下标：-1</span></span><br><span class="line"><span class="comment">找1的下标：0</span></span><br><span class="line"><span class="comment">找2的下标：1</span></span><br><span class="line"><span class="comment">找3的下标：2</span></span><br><span class="line"><span class="comment">找4的下标：3</span></span><br><span class="line"><span class="comment">找5的下标：4</span></span><br><span class="line"><span class="comment">找6的下标：5</span></span><br><span class="line"><span class="comment">找7的下标：6</span></span><br><span class="line"><span class="comment">找8的下标：7</span></span><br><span class="line"><span class="comment">找9的下标：8</span></span><br><span class="line"><span class="comment">找10的下标：-1</span></span><br><span class="line"><span class="comment">从null中找1的下标：-1</span></span><br><span class="line"><span class="comment">从&#123;&#125;中找1的下标：-1</span></span><br><span class="line"><span class="comment">从&#123;1&#125;找1的下标：0</span></span><br><span class="line"><span class="comment">从&#123;1&#125;找2的下标：-1</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h2 id="旋转数组的最小数字"><a href="#旋转数组的最小数字" class="headerlink" title="旋转数组的最小数字"></a>旋转数组的最小数字</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 有一个长度为 n 的非降序数组，比如[1,2,3,4,5]，将它进行旋转，即把一个数组最开始的若干个元素搬到数组的末尾，变成一个旋转数组，比如变成了[3,4,5,1,2]，或者[4,5,1,2,3]，</span></span><br><span class="line"><span class="comment"> * 这样的。请问，给定这样一个旋转数组，求数组中的最小值。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinaryExtendSearch</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;&#123;5, 6, 7, 8, 9, 1, 2, 3, 4&#125; 找最小值，应该是1：&quot;</span> + bExtendSearch(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;));</span><br><span class="line">        System.out.println(<span class="string">&quot;&#123;1, 2, 3, 4&#125;找最小值，应该是1：&quot;</span> + bExtendSearch(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;));</span><br><span class="line">        System.out.println(<span class="string">&quot;&#123;1, 0, 1, 1, 1&#125;找最小值，应该是0：&quot;</span> + bExtendSearch(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>&#125;));</span><br><span class="line">        System.out.println(<span class="string">&quot;&#123;1, 1, 1, 1, 1&#125;找最小值，应该是1：&quot;</span> + bExtendSearch(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>&#125;));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">bExtendSearch</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr == <span class="literal">null</span> || arr.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 取最右端数据为目标值</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">target</span> <span class="operator">=</span> arr[arr.length - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">first</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">last</span> <span class="operator">=</span> arr.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (first &lt; last) &#123;</span><br><span class="line">            <span class="comment">// 提前结束</span></span><br><span class="line">            <span class="keyword">if</span> (arr[first] &lt; arr[last]) &#123;</span><br><span class="line">                <span class="keyword">return</span> arr[first];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 取中值</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (first + last) &gt;&gt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果中间值大于目标值，最小值在右边</span></span><br><span class="line">            <span class="keyword">if</span> (arr[mid] &gt; target) &#123;</span><br><span class="line">                first = mid + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果中间值小于目标值，最小值在左边，目标值成为中间值</span></span><br><span class="line">            <span class="keyword">if</span> (arr[mid] &lt; target) &#123;</span><br><span class="line">                last = mid;</span><br><span class="line">                target = arr[mid];</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 其它情况，中间值==目标值</span></span><br><span class="line">            last--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> arr[first];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="comment">/*输出</span></span><br><span class="line"><span class="comment">&#123;5, 6, 7, 8, 9, 1, 2, 3, 4&#125; 找最小值，应该是1：1</span></span><br><span class="line"><span class="comment">&#123;1, 2, 3, 4&#125;找最小值，应该是1：1</span></span><br><span class="line"><span class="comment">&#123;1, 0, 1, 1, 1&#125;找最小值，应该是0：0</span></span><br><span class="line"><span class="comment">&#123;1, 1, 1, 1, 1&#125;找最小值，应该是1：1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】判断链表是否有环</title>
    <url>/%E7%AE%97%E6%B3%95/%E5%88%A4%E6%96%AD%E9%93%BE%E8%A1%A8%E6%98%AF%E5%90%A6%E6%9C%89%E7%8E%AF/</url>
    <content><![CDATA[<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断链表是否有环</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lilou</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021/6/2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Ring</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Integer id;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">        <span class="keyword">private</span> Node next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(Integer id, String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.id = id;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> id;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Node <span class="title function_">getNext</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNext</span><span class="params">(Node next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">n1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="number">1</span>, <span class="string">&quot;赵云&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">n2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="number">2</span>, <span class="string">&quot;关羽&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">n3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="number">3</span>, <span class="string">&quot;张飞&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">n4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="number">4</span>, <span class="string">&quot;刘备&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">n5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="number">5</span>, <span class="string">&quot;曹操&quot;</span>);</span><br><span class="line">        n1.setNext(n2);</span><br><span class="line">        n2.setNext(n3);</span><br><span class="line">        n3.setNext(n4);</span><br><span class="line">        n4.setNext(n5);</span><br><span class="line">        n5.setNext(n1);</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isRing</span> <span class="operator">=</span> isRing2(n1);</span><br><span class="line">        System.out.println(isRing);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 方法1：快慢指针</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> n1 节点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否有环</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isRing</span><span class="params">(Node n1)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n1 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 慢指针</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">slow</span> <span class="operator">=</span> n1;</span><br><span class="line">        <span class="comment">// 快指针，从下一个开始</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">fast</span> <span class="operator">=</span> n1.getNext();</span><br><span class="line">        <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.getNext() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fast == slow) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            slow = slow.getNext();</span><br><span class="line">            fast = fast.getNext().getNext();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 方法2：</span></span><br><span class="line"><span class="comment">     * 1个指针原地不动，</span></span><br><span class="line"><span class="comment">     * 1个指针一步一步向前搜索</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> n1 节点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否有环</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isRing2</span><span class="params">(Node n1)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n1 == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 原地不动</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">notMovePointer</span> <span class="operator">=</span> n1;</span><br><span class="line">        <span class="comment">// 步长为1，向前搜索</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">forwardPointer</span> <span class="operator">=</span> n1.getNext();</span><br><span class="line">        <span class="keyword">while</span> (forwardPointer != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (notMovePointer == forwardPointer) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            forwardPointer = forwardPointer.getNext();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】单链表重排序</title>
    <url>/%E7%AE%97%E6%B3%95/%E5%8D%95%E9%93%BE%E8%A1%A8%E9%87%8D%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 给定一个单链表 L：L0→L1→…→Ln-1→Ln ，</span></span><br><span class="line"><span class="comment"> * 将其重新排列后变为： L0→Ln→L1→Ln-1→L2→Ln-2→…</span></span><br><span class="line"><span class="comment"> * 你不能只是单纯的改变节点内部的值，而是需要实际的进行节点交换。</span></span><br><span class="line"><span class="comment"> * 示例 1:</span></span><br><span class="line"><span class="comment"> * 给定链表 1-&gt;2-&gt;3-&gt;4, 重新排列为 1-&gt;4-&gt;2-&gt;3.</span></span><br><span class="line"><span class="comment"> * 示例 2:</span></span><br><span class="line"><span class="comment"> * 给定链表 1-&gt;2-&gt;3-&gt;4-&gt;5, 重新排列为 1-&gt;5-&gt;2-&gt;4-&gt;3.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">firstNode</span> <span class="operator">=</span> createNode(<span class="number">4</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;origin:&quot;</span> + firstNode);</span><br><span class="line">        resortNode(firstNode);</span><br><span class="line">        System.out.println(<span class="string">&quot;resorted:&quot;</span> + firstNode);</span><br><span class="line"></span><br><span class="line">        firstNode = createNode(<span class="number">5</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;origin:&quot;</span> + firstNode);</span><br><span class="line">        resortNode(firstNode);</span><br><span class="line">        System.out.println(<span class="string">&quot;resorted:&quot;</span> + firstNode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">resortNode</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        List&lt;Node&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">            list.add(node);</span><br><span class="line">            node = node.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">head</span> <span class="operator">=</span> list.get(i);</span><br><span class="line">            <span class="type">Node</span> <span class="variable">tail</span> <span class="operator">=</span> list.get(list.size() - i - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (head == tail) &#123;</span><br><span class="line">                head.next = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (head.next == tail) &#123;</span><br><span class="line">                tail.next = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            tail.next = head.next;</span><br><span class="line">            head.next = tail;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Node <span class="title function_">createNode</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">tail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(num, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> num - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">            tail = <span class="keyword">new</span> <span class="title class_">Node</span>(i, tail);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tail;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> value, Node next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> value;</span><br><span class="line">        Node next;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> value + (next == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : (<span class="string">&quot;-&gt;&quot;</span> + next));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">origin:1-&gt;2-&gt;3-&gt;4</span></span><br><span class="line"><span class="comment">resorted:1-&gt;4-&gt;2-&gt;3</span></span><br><span class="line"><span class="comment">origin:1-&gt;2-&gt;3-&gt;4-&gt;5</span></span><br><span class="line"><span class="comment">resorted:1-&gt;5-&gt;2-&gt;4-&gt;3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>小明一家夜里过河问题</title>
    <url>/%E7%AE%97%E6%B3%95/%E5%B0%8F%E6%98%8E%E4%B8%80%E5%AE%B6%E5%A4%9C%E9%87%8C%E8%BF%87%E6%B2%B3/</url>
    <content><![CDATA[<p>问题：<br>小明一家要过桥，夜晚要用灯，小明 1 秒，弟弟 3 秒，爸爸 6 秒，妈妈 8 秒，爷爷 12 秒，他们只有 30 秒，如何过桥？</p>
<p>解题关键：<br>要想到，并不是每次都让小明参与过河（虽然小明的速度最快），这样最低得 33s。<br>可以让小明和弟弟一起先过去，小明回来，再让妈妈和爷爷一起过去，弟弟拿灯回来，小明和爸爸过去，小明回来，小明和弟弟一起过去</p>
<h1 id="参考答案"><a href="#参考答案" class="headerlink" title="参考答案"></a>参考答案</h1><blockquote>
<p>小明和弟弟过去，3 秒<br>小明回来，1 秒<br>小明和爸爸过去，6 秒<br>小弟弟回来，3 秒<br>妈妈和爷爷过去，12 秒<br>小明回来，1 秒<br>小明和弟弟过去，3 秒<br>3+1+6+3+12+1+3=29 秒<br>30 秒都用不了</p>
</blockquote>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="http://zhidao.baidu.com/question/71179812.html?qbl=relate_question_0">小明一家要过桥</a></li>
<li><a href="http://blog.csdn.net/ljiabin/article/details/7450222">更多智力题</a></li>
</ul>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】抽奖算法</title>
    <url>/%E7%AE%97%E6%B3%95/%E6%8A%BD%E5%A5%96%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h2 id="抽奖算法理论"><a href="#抽奖算法理论" class="headerlink" title="抽奖算法理论"></a>抽奖算法理论</h2><p>在一组奖品中，每个奖品有自己的概率，总概率为 <code>1.0</code>，也就是说在库存充足的情况下，必然能抽中其中的一个。</p>
<p>通过「谢谢参与」来作为无奖的奖品（也是一种奖品）。</p>
<p>需要注意的是：如果一组中所有的奖品，总概率之和不为 <code>1.0</code>，那么数值代表的概率就不是真实概率了，需要用所占比例来作为新的概率：<code>新概率值=奖品概率/总概率</code>。</p>
<p>举个例子：只有 A 和 B 两个奖品，A 概率是 <code>0.1</code>，B 概率是 <code>0.3</code>，那么总概率就是 0.4，A 的真实概率就是<code>0.1/0.4=0.25</code>，B 的真实概率是<code>0.3/0.4=0.75</code>，真实的总概率依然为<code>1</code>。</p>
<p>所以如果想要配置的奖品概率正好是抽奖时的概率值，那么就需要为这一组奖品列表的总概率配置成<code>1.0</code>；</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>首先定义一个有概率的奖品基类，所有继承这个基类的子类，都可以用调用 <code>LotteryTool.draw</code> 算法（draw 中的参数类型使用了java泛型）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 奖品基类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseAward</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 抽中这个奖品的概率</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Double probability;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接着是具体的奖品类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 奖品实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Award</span> <span class="keyword">extends</span> <span class="title class_">BaseAward</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="keyword">private</span> Integer stock;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Award</span><span class="params">(Integer id, String name, Double price, Double probability, Integer stock)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">        <span class="built_in">this</span>.stock = stock;</span><br><span class="line">        setProbability(probability);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看看抽奖的工具类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.RandomUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽奖工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LotteryTool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 抽奖方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> awardList 奖品列表，这些是备选的奖品（一定有库存的）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;       具体奖品类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回一个抽中的奖品</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T <span class="keyword">extends</span> <span class="title class_">BaseAward</span>&gt; T <span class="title function_">draw</span><span class="params">(List&lt;T&gt; awardList)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (CollUtil.isEmpty(awardList)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取总概率，当奖品总概率正好为1时，奖品的 probability 就是真实的概率，否则会按新的比例作为概率</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">sumProbability</span> <span class="operator">=</span> awardList.stream()</span><br><span class="line">                .map(BaseAward::getProbability)</span><br><span class="line">                .reduce(<span class="number">0.0</span>, Double::sum);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 一共会尝试 awardList.size() 次，确保能返回一个奖品</span></span><br><span class="line">        <span class="keyword">for</span> (T t : awardList) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 使用随机值，左闭右开（包含0，不包含1）</span></span><br><span class="line">            <span class="keyword">if</span> (t.getProbability() &gt; RandomUtil.randomDouble(<span class="number">0.0</span>, <span class="number">1.0</span>) * sumProbability) &#123;</span><br><span class="line">                <span class="keyword">return</span> t;</span><br><span class="line">            &#125;</span><br><span class="line">            sumProbability = sumProbability - t.getProbability();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 其它情况，会到这里（理论上，一定到不了这里的。）</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后来个测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 测试</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 奖品列表，库存一共36</span></span><br><span class="line">        <span class="keyword">final</span> List&lt;Award&gt; awardList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        awardList.add(<span class="keyword">new</span> <span class="title class_">Award</span>(<span class="number">1</span>, <span class="string">&quot;苹果手机&quot;</span>, <span class="number">7000.0</span>, <span class="number">0.05</span>, <span class="number">1</span>));</span><br><span class="line">        awardList.add(<span class="keyword">new</span> <span class="title class_">Award</span>(<span class="number">2</span>, <span class="string">&quot;5元金币&quot;</span>, <span class="number">5.0</span>, <span class="number">0.1</span>, <span class="number">5</span>));</span><br><span class="line">        awardList.add(<span class="keyword">new</span> <span class="title class_">Award</span>(<span class="number">3</span>, <span class="string">&quot;15元天堂雨伞&quot;</span>, <span class="number">15.0</span>, <span class="number">0.25</span>, <span class="number">10</span>));</span><br><span class="line">        awardList.add(<span class="keyword">new</span> <span class="title class_">Award</span>(<span class="number">4</span>, <span class="string">&quot;谢谢参与&quot;</span>, <span class="number">0.0</span>, <span class="number">0.6</span>, <span class="number">20</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;开始抽奖:&quot;</span>);</span><br><span class="line">        <span class="comment">// 抽奖50次</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">            String msg;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Award</span> <span class="variable">draw</span> <span class="operator">=</span> LotteryTool.draw(awardList);</span><br><span class="line">            <span class="keyword">if</span> (draw == <span class="literal">null</span>) &#123;</span><br><span class="line">                msg = <span class="string">&quot;奖品抽完了，下次早点来吧~&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                msg = StrUtil.format(<span class="string">&quot;抽到了价值「&#123;&#125;」的奖品「&#123;&#125;」&quot;</span>, draw.getPrice(), draw.getName());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 抽到奖品了，需要减库存，库存不足了，要从列表中剔除</span></span><br><span class="line">                draw.setStock(draw.getStock() - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (draw.getStock() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    awardList.remove(draw);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println(StrUtil.format(<span class="string">&quot;第&#123;&#125;次抽奖，结果为：&#123;&#125;&quot;</span>, i+<span class="number">1</span>, msg));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;抽奖结束.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*output~</span></span><br><span class="line"><span class="comment">开始抽奖:</span></span><br><span class="line"><span class="comment">第1次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第2次抽奖，结果为：抽到了价值「5.0」的奖品「5元金币」</span></span><br><span class="line"><span class="comment">第3次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第4次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第5次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第6次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第7次抽奖，结果为：抽到了价值「15.0」的奖品「15元天堂雨伞」</span></span><br><span class="line"><span class="comment">第8次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第9次抽奖，结果为：抽到了价值「15.0」的奖品「15元天堂雨伞」</span></span><br><span class="line"><span class="comment">第10次抽奖，结果为：抽到了价值「5.0」的奖品「5元金币」</span></span><br><span class="line"><span class="comment">第11次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第12次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第13次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第14次抽奖，结果为：抽到了价值「15.0」的奖品「15元天堂雨伞」</span></span><br><span class="line"><span class="comment">第15次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第16次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第17次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第18次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第19次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第20次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第21次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第22次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第23次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第24次抽奖，结果为：抽到了价值「15.0」的奖品「15元天堂雨伞」</span></span><br><span class="line"><span class="comment">第25次抽奖，结果为：抽到了价值「15.0」的奖品「15元天堂雨伞」</span></span><br><span class="line"><span class="comment">第26次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第27次抽奖，结果为：抽到了价值「0.0」的奖品「谢谢参与」</span></span><br><span class="line"><span class="comment">第28次抽奖，结果为：抽到了价值「15.0」的奖品「15元天堂雨伞」</span></span><br><span class="line"><span class="comment">第29次抽奖，结果为：抽到了价值「15.0」的奖品「15元天堂雨伞」</span></span><br><span class="line"><span class="comment">第30次抽奖，结果为：抽到了价值「5.0」的奖品「5元金币」</span></span><br><span class="line"><span class="comment">第31次抽奖，结果为：抽到了价值「15.0」的奖品「15元天堂雨伞」</span></span><br><span class="line"><span class="comment">第32次抽奖，结果为：抽到了价值「15.0」的奖品「15元天堂雨伞」</span></span><br><span class="line"><span class="comment">第33次抽奖，结果为：抽到了价值「5.0」的奖品「5元金币」</span></span><br><span class="line"><span class="comment">第34次抽奖，结果为：抽到了价值「15.0」的奖品「15元天堂雨伞」</span></span><br><span class="line"><span class="comment">第35次抽奖，结果为：抽到了价值「5.0」的奖品「5元金币」</span></span><br><span class="line"><span class="comment">第36次抽奖，结果为：抽到了价值「7000.0」的奖品「苹果手机」</span></span><br><span class="line"><span class="comment">第37次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">第38次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">第39次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">第40次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">第41次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">第42次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">第43次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">第44次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">第45次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">第46次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">第47次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">第48次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">第49次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">第50次抽奖，结果为：奖品抽完了，下次早点来吧~</span></span><br><span class="line"><span class="comment">抽奖结束.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Process finished with exit code 0</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://www.jianshu.com/p/e91504b00a0b">一个经典的指定概率的抽奖算法 - 简书</a></li>
</ul>
<p>「<a href="https://lyloou.com/%E7%AE%97%E6%B3%95/%E6%8A%BD%E5%A5%96%E7%AE%97%E6%B3%95/">阅读原文</a>」</p>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】排序算法</title>
    <url>/%E7%AE%97%E6%B3%95/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h1 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h1><p>两两比较，较小的往上冒，较大的往下沉。（对相邻的两个元素依次比较和调整）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        printArray(arr);</span><br><span class="line">        bubbleSort(arr);</span><br><span class="line">        printArray(arr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> arr[] = &#123; <span class="number">3</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bubbleSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> arr.length;</span><br><span class="line">        <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// 之所以 len-1-i, 是因为len-1-i之后的元素已经排序完成</span></span><br><span class="line">            <span class="comment">// （每循环一次，就能将一个最大值沉底）</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; len - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (arr[j] &gt; arr[j + <span class="number">1</span>]) &#123;</span><br><span class="line">                    swap(arr, j, j + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || j &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> arr.length;</span><br><span class="line">        <span class="keyword">if</span> (i == j || i &gt;= len || j &gt;= len) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> arr[i];</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        arr[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printArray</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> a : arr) &#123;</span><br><span class="line">            sb.append(a).append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> sb.substring(<span class="number">0</span>, sb.length() - <span class="number">1</span>).toString();</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">/* Output:</span></span><br><span class="line"><span class="comment">3,8,7,2,1,5,6,9,0</span></span><br><span class="line"><span class="comment">0,1,2,3,5,6,7,8,9</span></span><br><span class="line"><span class="comment">*/</span><span class="comment">// ~</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="http://blog.csdn.net/qy1387/article/details/7752973">Java常用排序算法/程序员必须掌握的8大排序算法</a></li>
</ul>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】数字只出现一次或两次</title>
    <url>/%E7%AE%97%E6%B3%95/%E6%95%B0%E5%AD%97%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1/</url>
    <content><![CDATA[<h2 id="判断数组中的所有的数字是否只出现一次。"><a href="#判断数组中的所有的数字是否只出现一次。" class="headerlink" title="判断数组中的所有的数字是否只出现一次。"></a>判断数组中的所有的数字是否只出现一次。</h2><p>给定一个数组 array，判断数组 array 中是否所有的数字只出现一次。<br>例如，<code>arr = &#123;1, 2, 3&#125;</code>，输出 <code>YES</code>。<br>又如，<code>arr = &#123;1, 2, 1&#125;</code>，输出 <code>NO</code>。<br>约束时间复杂度为 O(n)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span>[] data1 = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span>[] data2 = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line">        System.out.println(getOnlyOnceStatus1(data1));</span><br><span class="line">        System.out.println(getOnlyOnceStatus1(data2));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过set来存储，比较数量</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data 数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getOnlyOnceStatus1</span><span class="params">(<span class="type">int</span>[] data)</span> &#123;</span><br><span class="line"></span><br><span class="line">        Set&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(data.length);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> datum : data) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!result.add(datum)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;NO&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result.size() == data.length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;YES&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;NO&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">YES</span></span><br><span class="line"><span class="comment">NO</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="找出数组中只出现一次的数字，其它数字都出现了两次"><a href="#找出数组中只出现一次的数字，其它数字都出现了两次" class="headerlink" title="找出数组中只出现一次的数字，其它数字都出现了两次"></a>找出数组中只出现一次的数字，其它数字都出现了两次</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span>[] data1 = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">4</span>&#125;;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span>[] data2 = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line">        System.out.println(xorIntArray(data1));</span><br><span class="line">        System.out.println(xorIntArray(data2));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异或操作</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data 数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer <span class="title function_">xorIntArray</span><span class="params">(<span class="type">int</span>[] data)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (data == <span class="literal">null</span> || data.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (data.length == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> data[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> data[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">            result ^= data[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>数据结构-树</title>
    <url>/%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91/</url>
    <content><![CDATA[<h2 id="二叉查找树"><a href="#二叉查找树" class="headerlink" title="二叉查找树"></a>二叉查找树</h2><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91-1-BST_20211215185025493_b2fc35.png" alt="数据结构-树-1-BST"></p>
<h2 id="平衡树"><a href="#平衡树" class="headerlink" title="平衡树"></a>平衡树</h2><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91_%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91-2-AVL_2021-12-16-09-23-23.png" alt="数据结构-树_数据结构-树-2-AVL_2021-12-16-09-23-23"></p>
<h2 id="红黑树"><a href="#红黑树" class="headerlink" title="红黑树"></a>红黑树</h2><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91_%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91-3-RBTree_2021-12-16-09-23-46.png" alt="数据结构-树_数据结构-树-3-RBTree_2021-12-16-09-23-46"></p>
<h2 id="平衡多路查找树"><a href="#平衡多路查找树" class="headerlink" title="平衡多路查找树"></a>平衡多路查找树</h2><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91-4-B-Tree_20211215185054559_400b95.png" alt="数据结构-树-4-B-Tree"></p>
<h2 id="B-树"><a href="#B-树" class="headerlink" title="B+树"></a>B+树</h2><p><img src="https://raw.githubusercontent.com/lyloou/img/develop/img/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%A0%91-5-B%2BTree_20211215185101793_088b18.png" alt="数据结构-树-5-B+Tree"></p>
<h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><p>导图地址：【金山文档】 数据结构-树 <a href="https://kdocs.cn/l/se9RNa0rOTyq">https://kdocs.cn/l/se9RNa0rOTyq</a></p>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>数据结构</title>
    <url>/%E7%AE%97%E6%B3%95/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><p><strong>定义</strong>：</p>
<ul>
<li>数据结构是相互之间存在一种或多种特定关系的数据元素的集合</li>
</ul>
<p><strong>分类</strong>：</p>
<ul>
<li><img src="https://github.com/lyloou/img/raw/develop/z/20190729111056.png"></li>
</ul>
<h2 id="数据结构和算法的关系"><a href="#数据结构和算法的关系" class="headerlink" title="数据结构和算法的关系"></a>数据结构和算法的关系</h2><p>数据结构就是一组数据的存储结构，<br>算法就是操作数据的一组方法。</p>
<p>数据结构和算法是相辅相成的。<br>数据结构是为算法服务的，算法要作用在特定的数据结构之上。</p>
<h2 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h2><p>得到算法的时间复杂度，并不是简单的数有多少个循环；因为，循环的步数是可能很少的或者很多的。<br>循环的时间复杂度等于循环体的复杂度乘以该循环运行的次数。</p>
<p>如下图：</p>
<ul>
<li><img src="https://github.com/lyloou/img/raw/develop/z/20190729102735.png"></li>
</ul>
<p>常见时间复杂度</p>
<ul>
<li><img src="https://github.com/lyloou/img/raw/develop/z/20190729103929.png"></li>
</ul>
<p>最坏情况运行时间是一种保证，那就是运行时间将不会再坏了。在应用中，这是一种最重要的需求<br>通常，除非特别指定 我们提到的运行时间都是最坏情况的运行时间</p>
<h2 id="推导大-O-阶："><a href="#推导大-O-阶：" class="headerlink" title="推导大 O 阶："></a>推导大 O 阶：</h2><p><img src="https://github.com/lyloou/img/raw/develop/z/20190708102115.png"></p>
<h2 id="单链表结构与顺序存储结构优缺点"><a href="#单链表结构与顺序存储结构优缺点" class="headerlink" title="单链表结构与顺序存储结构优缺点"></a>单链表结构与顺序存储结构优缺点</h2><p><img src="https://github.com/lyloou/img/raw/develop/z/20190729113227.png"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li>《大话数据结构》</li>
</ul>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>【算法】遍历根到所有叶子节点的路径</title>
    <url>/%E7%AE%97%E6%B3%95/%E9%81%8D%E5%8E%86%E6%A0%B9%E5%88%B0%E6%89%80%E6%9C%89%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9%E7%9A%84%E8%B7%AF%E5%BE%84/</url>
    <content><![CDATA[<h2 id="遍历根到所有叶子节点的路径"><a href="#遍历根到所有叶子节点的路径" class="headerlink" title="遍历根到所有叶子节点的路径"></a>遍历根到所有叶子节点的路径</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lyloou.tool.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * **** 示例1 ****</span></span><br><span class="line"><span class="comment">         1</span></span><br><span class="line"><span class="comment">    2          3</span></span><br><span class="line"><span class="comment">  4   5      6   7</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> 输出如下：</span></span><br><span class="line"><span class="comment"> 1 2 4</span></span><br><span class="line"><span class="comment"> 1 2 5</span></span><br><span class="line"><span class="comment"> 1 3 6</span></span><br><span class="line"><span class="comment"> 1 3 7</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * **** 示例2 ****</span></span><br><span class="line"><span class="comment">       1</span></span><br><span class="line"><span class="comment">  2        3</span></span><br><span class="line"><span class="comment">     5</span></span><br><span class="line"><span class="comment">  a = TreeNode(1)</span></span><br><span class="line"><span class="comment">  b = TreeNode(2)</span></span><br><span class="line"><span class="comment">  c = TreeNode(3)</span></span><br><span class="line"><span class="comment">  d = TreeNode(5)</span></span><br><span class="line"><span class="comment">  a.left = b</span></span><br><span class="line"><span class="comment">  a.right =  c</span></span><br><span class="line"><span class="comment">  b.right = d</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> 输出如下：</span></span><br><span class="line"><span class="comment"> [&#x27;1-&gt;2-&gt;5&#x27;, &#x27;1-&gt;3&#x27;]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        test1();</span><br><span class="line">        test2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">5</span>);</span><br><span class="line">        a.left = b;</span><br><span class="line">        a.right = c;</span><br><span class="line">        b.right = d;</span><br><span class="line">        System.out.println(binaryTreePaths(a));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">a1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">a2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">a3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">a4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">4</span>);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">a5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">5</span>);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">a6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">6</span>);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">a7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">7</span>);</span><br><span class="line">        a1.left = a2;</span><br><span class="line">        a1.right = a3;</span><br><span class="line">        a2.left = a4;</span><br><span class="line">        a2.right = a5;</span><br><span class="line">        a3.left = a6;</span><br><span class="line">        a3.right = a7;</span><br><span class="line">        System.out.println(binaryTreePaths(a1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> root the root of the binary tree</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> all root-to-leaf paths</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">binaryTreePaths</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 有几个叶子节点，就有几条路径</span></span><br><span class="line">        <span class="keyword">if</span> (isLeaf(root)) &#123;</span><br><span class="line">            List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            list.add(root.val + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取左子树的列表，循环向元素前面追加当前值</span></span><br><span class="line">        <span class="keyword">final</span> List&lt;String&gt; leftList = binaryTreePaths(root.left);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; leftList.size(); i++) &#123;</span><br><span class="line">            leftList.set(i, root.val + <span class="string">&quot;-&gt;&quot;</span> + leftList.get(i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取右子树的列表，循环向元素前面追加当前值</span></span><br><span class="line">        <span class="keyword">final</span> List&lt;String&gt; rightList = binaryTreePaths(root.right);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; rightList.size(); i++) &#123;</span><br><span class="line">            rightList.set(i, root.val + <span class="string">&quot;-&gt;&quot;</span> + rightList.get(i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 拼接成一个列表返回</span></span><br><span class="line">        List&lt;String&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(leftList.size() + rightList.size());</span><br><span class="line">        result.addAll(leftList);</span><br><span class="line">        result.addAll(rightList);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断node是否为叶子节点</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node 节点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 为叶子节点，</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isLeaf</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> node.left == <span class="literal">null</span> &amp;&amp; node.right == <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> val;</span><br><span class="line">        <span class="keyword">public</span> TreeNode left, right;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">TreeNode</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.val = val;</span><br><span class="line">            <span class="built_in">this</span>.left = <span class="built_in">this</span>.right = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2><p><img src="http://cdn.lyloou.com/img/all-to-leaf-path-2021-05-25-00-35-39.png" alt="all-to-leaf-path-2021-05-25-00-35-39"></p>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>Justauth源码学习</title>
    <url>/%E8%AF%BB%E6%BA%90%E7%A0%81/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h2 id="JustAuth-简介"><a href="#JustAuth-简介" class="headerlink" title="JustAuth 简介"></a>JustAuth 简介</h2><blockquote>
<p>🏆Gitee 最有价值开源项目 🚀💯 小而全而美的第三方登录开源组件。目前已支持 Github、Gitee、微博、钉钉、百度、Coding、腾讯云开发者平台、OSChina、支付宝、QQ、微信、淘宝、Google、Facebook、抖音、领英、小米、微软、今日头条、Teambition、StackOverflow、Pinterest、人人、华为、企业微信、酷家乐、Gitlab、美团、饿了么、推特、飞书、京东、阿里云、喜马拉雅、Amazon、Slack 和 Line 等第三方平台的授权登录。 Login, so easy!<br>网址：<a href="https://github.com/justauth/JustAuth">justauth/JustAuth</a></p>
</blockquote>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">1.1.  Roles</span><br><span class="line"></span><br><span class="line">   OAuth defines four roles:</span><br><span class="line"></span><br><span class="line">   resource owner</span><br><span class="line">      An entity capable of granting access to a protected resource.</span><br><span class="line">      <span class="keyword">When</span> the resource owner is a person, it is referred to as an</span><br><span class="line">      end-user.</span><br><span class="line"></span><br><span class="line">   resource server</span><br><span class="line">      The server hosting the protected resources, capable of accepting</span><br><span class="line">      and responding to protected resource requests using access tokens.</span><br><span class="line"></span><br><span class="line">   client</span><br><span class="line">      An application making protected resource requests on behalf of the</span><br><span class="line">      resource owner and with its authorization.  The term <span class="string">&quot;client&quot;</span> does</span><br><span class="line">      not imply any particular implementation characteristics (e.g.,</span><br><span class="line">      whether the application executes on a server, a desktop, or other</span><br><span class="line">      devices).</span><br><span class="line"></span><br><span class="line">   authorization server</span><br><span class="line">      The server issuing access tokens to the client after successfully</span><br><span class="line">      authenticating the resource owner and obtaining authorization.</span><br><span class="line"></span><br><span class="line">   The interaction between the authorization server and resource server</span><br><span class="line">   is beyond the scope of this specification.  The authorization server</span><br><span class="line">   may be the same server as the resource server or a separate entity.</span><br><span class="line">   A single authorization server may issue access tokens accepted by</span><br><span class="line">   multiple resource servers.</span><br><span class="line"></span><br><span class="line">1.2.  Protocol Flow</span><br><span class="line"></span><br><span class="line">     +--------+                               +---------------+</span><br><span class="line">     |<span class="string">        </span>|<span class="string">--(A)- Authorization Request -&gt;</span>|<span class="string">   Resource    </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">                               </span>|<span class="string">     Owner     </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">&lt;-(B)-- Authorization Grant ---</span>|<span class="string">               </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string">     </span>|<span class="string">        </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string">     </span>|<span class="string">        </span>|<span class="string">--(C)-- Authorization Grant --&gt;</span>|<span class="string"> Authorization </span>|</span><br><span class="line">     |<span class="string"> Client </span>|<span class="string">                               </span>|<span class="string">     Server    </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">&lt;-(D)----- Access Token -------</span>|<span class="string">               </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string">     </span>|<span class="string">        </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string">     </span>|<span class="string">        </span>|<span class="string">--(E)----- Access Token ------&gt;</span>|<span class="string">    Resource   </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">                               </span>|<span class="string">     Server    </span>|</span><br><span class="line">     |<span class="string">        </span>|<span class="string">&lt;-(F)--- Protected Resource ---</span>|<span class="string">               </span>|</span><br><span class="line">     +--------+                               +---------------+</span><br><span class="line"></span><br><span class="line">                     Figure 1: Abstract Protocol Flow</span><br><span class="line"></span><br><span class="line">   The abstract OAuth 2.0 flow illustrated in Figure 1 describes the</span><br><span class="line">   interaction between the four roles and includes the following steps:</span><br><span class="line"></span><br><span class="line">   (A)  The client requests authorization from the resource owner.  The</span><br><span class="line">        authorization request can be made directly to the resource owner</span><br><span class="line">        (as shown), or preferably indirectly via the authorization</span><br><span class="line">        server as an intermediary.</span><br><span class="line">		用户打开客户端以后，客户端要求用户给予授权。</span><br><span class="line">   (B)  The client receives an authorization grant, which is a</span><br><span class="line">        credential representing the resource owner&#x27;s authorization,</span><br><span class="line">        expressed using one of four grant types defined in this</span><br><span class="line">        specification or using an extension grant type.  The</span><br><span class="line">        authorization grant type depends on the method used by the</span><br><span class="line">        client to request authorization and the types supported by the</span><br><span class="line">        authorization server.</span><br><span class="line">		用户同意给予客户端授权。</span><br><span class="line"></span><br><span class="line">   (C)  The client requests an access token by authenticating with the</span><br><span class="line">        authorization server and presenting the authorization grant.</span><br><span class="line">		客户端使用上一步获得的授权，向认证服务器申请令牌。</span><br><span class="line">   (D)  The authorization server authenticates the client and validates</span><br><span class="line">        the authorization grant, and if valid, issues an access token.</span><br><span class="line">		认证服务器对客户端进行认证以后，确认无误，同意发放令牌</span><br><span class="line"></span><br><span class="line">   (E)  The client requests the protected resource from the resource</span><br><span class="line">        server and authenticates by presenting the access token.</span><br><span class="line">		客户端使用令牌，向资源服务器申请获取资源。</span><br><span class="line">   (F)  The resource server validates the access token, and if valid,</span><br><span class="line">        serves the request.</span><br><span class="line">		资源服务器确认令牌无误，同意向客户端开放资源。</span><br><span class="line">https://datatracker.ietf.org/doc/html/rfc6749<span class="comment">#section-1.2</span></span><br></pre></td></tr></table></figure>

<p><img src="http://cdn.lyloou.com/img/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0-2021-06-29-17-22-17.png" alt="justauth源码学习-2021-06-29-17-22-17"></p>
<h2 id="从以下几个问题来看代码"><a href="#从以下几个问题来看代码" class="headerlink" title="从以下几个问题来看代码"></a>从以下几个问题来看代码</h2><h4 id="Q-如何集成多家的？"><a href="#Q-如何集成多家的？" class="headerlink" title="Q: 如何集成多家的？"></a>Q: 如何集成多家的？</h4><p>这一块，主要是工厂模式和模板模式的应用。</p>
<p>工厂模式</p>
<figure class="highlight leaf"><table><tr><td class="code"><pre><span class="line">AuthRequestFactory<span class="function"><span class="keyword">#</span><span class="title">get</span><span class="params">(<span class="variable">String</span> <span class="variable">source</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>模板模式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AuthDefaultRequest</span> <span class="keyword">implements</span> <span class="title class_">AuthRequest</span>&#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">abstract</span> AuthToken <span class="title function_">getAccessToken</span><span class="params">(AuthCallback var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> AuthUser <span class="title function_">getUserInfo</span><span class="params">(AuthToken var1)</span>;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://cdn.lyloou.com/img/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0-2021-06-29-17-10-59.png" alt="justauth源码学习-2021-06-29-17-10-59"></p>
<p><strong>针对授权、获取用户信息等操作，由具体的 source 类来实现</strong><br>因为都是基于 OAuth2 来实现的，所以都有 authorize 地址、accessToken 地址、userInfo 地址 等概念</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthSource</span> &#123;</span><br><span class="line">    String <span class="title function_">authorize</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">accessToken</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">userInfo</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">revoke</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AuthException</span>(AuthResponseStatus.UNSUPPORTED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">refresh</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AuthException</span>(AuthResponseStatus.UNSUPPORTED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span> <span class="keyword">instanceof</span> Enum ? String.valueOf(<span class="built_in">this</span>) : <span class="built_in">this</span>.getClass().getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">AuthDefaultSource</span> <span class="keyword">implements</span> <span class="title class_">AuthSource</span> &#123;</span><br><span class="line">    GITHUB &#123;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">authorize</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://github.com/login/oauth/authorize&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">accessToken</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://github.com/login/oauth/access_token&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">userInfo</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://api.github.com/user&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    WEIBO &#123;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">authorize</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://api.weibo.com/oauth2/authorize&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">accessToken</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://api.weibo.com/oauth2/access_token&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">userInfo</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://api.weibo.com/2/users/show.json&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">revoke</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://api.weibo.com/oauth2/revokeoauth2&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>多家配置</strong><br>JustAuthProperties，其 type 是 map 类型的，可以自定义任意多个的 source。</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">justauth:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">type:</span></span><br><span class="line">    <span class="attr">QQ:</span></span><br><span class="line">      <span class="attr">client-id:</span> <span class="number">10</span><span class="string">**********6</span></span><br><span class="line">      <span class="attr">client-secret:</span> <span class="string">1f7d08**********5b7**********29e</span></span><br><span class="line">      <span class="attr">redirect-uri:</span> <span class="string">http://x.lyloou.com/oauth/qq/callback</span></span><br><span class="line">      <span class="attr">union-id:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">WEIBO:</span></span><br><span class="line">      <span class="attr">client-id:</span> <span class="number">10</span><span class="string">**********6</span></span><br><span class="line">      <span class="attr">client-secret:</span> <span class="string">1f7d08**********5b7**********29e</span></span><br><span class="line">      <span class="attr">redirect-uri:</span> <span class="string">http://x.lyloou.com/oauth/weibo/callback</span></span><br></pre></td></tr></table></figure>

<h4 id="Q-State-缓存如何实现？"><a href="#Q-State-缓存如何实现？" class="headerlink" title="Q: State 缓存如何实现？"></a>Q: State 缓存如何实现？</h4><p><code>state</code> 是 用来保持授权会话流程完整性，防止 CSRF 攻击的安全的随机的参数，由开发者生成</p>
<p><strong>自动配置</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// justauth-spring-boot-starter JustAuthStateCacheConfiguration</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(&#123;AuthStateCache.class&#125;)</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty(</span></span><br><span class="line"><span class="meta">        name = &#123;&quot;justauth.cache.type&quot;&#125;,</span></span><br><span class="line"><span class="meta">        havingValue = &quot;default&quot;,</span></span><br><span class="line"><span class="meta">        matchIfMissing = true  // 默认</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Default</span> &#123;</span><br><span class="line">        Default() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> AuthStateCache <span class="title function_">authStateCache</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> AuthDefaultStateCache.INSTANCE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            JustAuthStateCacheConfiguration.log.debug(<span class="string">&quot;JustAuth 使用 默认缓存存储 state 数据&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>配置</strong></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">justauth:</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">default</span></span><br><span class="line"><span class="string">```</span></span><br><span class="line"></span><br><span class="line"><span class="string">**实现**</span></span><br><span class="line"></span><br><span class="line"><span class="string">**清理**</span></span><br><span class="line"></span><br><span class="line"><span class="string">通过</span> <span class="string">ScheduledThreadPoolExecutor</span> <span class="string">每隔</span> <span class="string">AuthCacheConfig.timeout</span> <span class="string">来定时清理</span> <span class="string">CacheState</span></span><br><span class="line"></span><br><span class="line"><span class="string">```java</span></span><br><span class="line"><span class="string">public</span> <span class="string">void</span> <span class="string">schedulePrune(long</span> <span class="string">delay)</span> &#123;</span><br><span class="line">	<span class="string">AuthCacheScheduler.INSTANCE.schedule(this::pruneCache</span>, <span class="string">delay);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">public</span> <span class="string">enum</span> <span class="string">AuthCacheScheduler</span> &#123;</span><br><span class="line">    <span class="string">INSTANCE;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">private</span> <span class="string">AtomicInteger</span> <span class="string">cacheTaskNumber</span> <span class="string">=</span> <span class="string">new</span> <span class="string">AtomicInteger(1);</span></span><br><span class="line">    <span class="string">private</span> <span class="string">ScheduledExecutorService</span> <span class="string">scheduler;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">private</span> <span class="string">AuthCacheScheduler()</span> &#123;</span><br><span class="line">        <span class="string">this.create();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">private</span> <span class="string">void</span> <span class="string">create()</span> &#123;</span><br><span class="line">        <span class="string">this.shutdown();</span></span><br><span class="line">        <span class="string">this.scheduler</span> <span class="string">=</span> <span class="string">new</span> <span class="string">ScheduledThreadPoolExecutor(10</span>, <span class="string">(r)</span> <span class="string">-&gt;</span> &#123;</span><br><span class="line">            <span class="string">return</span> <span class="string">new</span> <span class="string">Thread(r</span>, <span class="string">String.format(&quot;JustAuth-Task-%s&quot;</span>, <span class="string">this.cacheTaskNumber.getAndIncrement()));</span></span><br><span class="line">        &#125;<span class="string">);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">public</span> <span class="string">void</span> <span class="string">shutdown()</span> &#123;</span><br><span class="line">        <span class="string">if</span> <span class="string">(null</span> <span class="type">!=</span> <span class="string">this.scheduler)</span> &#123;</span><br><span class="line">            <span class="string">this.scheduler.shutdown();</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">public</span> <span class="string">void</span> <span class="string">schedule(Runnable</span> <span class="string">task</span>, <span class="string">long</span> <span class="string">delay)</span> &#123;</span><br><span class="line">        <span class="string">this.scheduler.scheduleAtFixedRate(task</span>, <span class="string">delay</span>, <span class="string">delay</span>, <span class="string">TimeUnit.MILLISECONDS);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Q-如何做到适配自有的-OAuth-服务？"><a href="#Q-如何做到适配自有的-OAuth-服务？" class="headerlink" title="Q: 如何做到适配自有的 OAuth 服务？"></a>Q: 如何做到适配自有的 OAuth 服务？</h4><p>和上面其他平台的一样，可以自定义来适配新的平台。</p>
<ol>
<li><p>继承 AuthSource，加入 authorize、accessToken、userInfo 地址</p>
</li>
<li><p>实现 AuthDefaultRequest，重写几个基本的 oauth 服务接口：getAccessToken、getUserInfo、authorize。</p>
</li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">AuthRequest</span> <span class="variable">authRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AuthMyGitlabRequest</span>(AuthConfig.builder()</span><br><span class="line">    .clientId(<span class="string">&quot;63398e403231d4aa7e856cf5413620d536a876cb94e8d10ced0d3191b5d1d246&quot;</span>)</span><br><span class="line">    .clientSecret(<span class="string">&quot;65b0eba68fff019e682e6755882a24dfdbf0a61be55de119cb8970320186c8eb&quot;</span>)</span><br><span class="line">    .redirectUri(<span class="string">&quot;http://127.0.0.1:8443/oauth/callback/mygitlab&quot;</span>)</span><br><span class="line">    .build())</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="Q-如何支持自定义-Scope？"><a href="#Q-如何支持自定义-Scope？" class="headerlink" title="Q: 如何支持自定义 Scope？"></a>Q: 如何支持自定义 Scope？</h4><p><a href="https://justauth.wiki/features/customize-scopes.html#%E8%87%AA%E5%AE%9A%E4%B9%89-scope-%E6%8E%A5%E5%85%A5-google-%E5%B9%B3%E5%8F%B0">自定义-scope-接入-google-平台</a></p>
<p><code>scope</code> 简单来说，就是申请得到某个（某些）范围的资源，超过此范围的资源限制访问。</p>
<blockquote>
<p>Scope is a mechanism in OAuth 2.0 to limit an application’s access to a user’s account. An application can request one or more scopes, this information is then presented to the user in the consent screen, and the access token issued to the application will be limited to the scopes granted.</p>
<p>—— 以上内容节选自<a href="https://oauth.net/">oauth.net</a><a href="https://oauth.net/"> (opens new window)</a></p>
</blockquote>
<p>提供 AuthScope 统一接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 各个平台 scope 类的统一接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yadong.zhang (yadong.zhang0415(a)gmail.com)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.15.7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AuthScope</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取字符串 &#123;<span class="doctag">@code</span> scope&#125;，对应为各平台实际使用的 &#123;<span class="doctag">@code</span> scope&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getScope</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断当前 &#123;<span class="doctag">@code</span> scope&#125; 是否为各平台默认启用的</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isDefault</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>各个平台实现此接口，如 google</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Google 平台 OAuth 授权范围</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yadong.zhang (yadong.zhang0415(a)gmail.com)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">AuthGoogleScope</span> <span class="keyword">implements</span> <span class="title class_">AuthScope</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> scope&#125; 含义，以&#123;<span class="doctag">@code</span> description&#125; 为准</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    USER_OPENID(<span class="string">&quot;openid&quot;</span>, <span class="string">&quot;Associate you with your personal info on Google&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">    USER_EMAIL(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;View your email address&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">    USER_PROFILE(<span class="string">&quot;profile&quot;</span>, <span class="string">&quot;View your basic profile info&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">    USER_PHONENUMBERS_READ(<span class="string">&quot;https://www.googleapis.com/auth/user.phonenumbers.read&quot;</span>, <span class="string">&quot;View your phone numbers&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">    USER_ORGANIZATION_READ(<span class="string">&quot;https://www.googleapis.com/auth/user.organization.read&quot;</span>, <span class="string">&quot;See your education, work history and org info&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">    USER_GENDER_READ(<span class="string">&quot;https://www.googleapis.com/auth/user.gender.read&quot;</span>, <span class="string">&quot;See your gender&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">    USER_EMAILS_READ(<span class="string">&quot;https://www.googleapis.com/auth/user.emails.read&quot;</span>, <span class="string">&quot;View your email addresses&quot;</span>, <span class="literal">false</span>),</span><br><span class="line"></span><br><span class="line">    USER_BIRTHDAY_READ(<span class="string">&quot;https://www.googleapis.com/auth/user.birthday.read&quot;</span>, <span class="string">&quot;View your complete date of birth&quot;</span>, <span class="literal">false</span>)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结合流程图来说，（A）这里需要将 scope 带过去，进入授权页面。</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">+--------+                               +---------------+</span><br><span class="line">|<span class="string">        </span>|<span class="string">--(A)- Authorization Request -&gt;</span>|<span class="string">   Resource    </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               </span>|<span class="string">     Owner     </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">&lt;-(B)-- Authorization Grant ---</span>|<span class="string">               </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string"></span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string"></span>|<span class="string">        </span>|<span class="string">--(C)-- Authorization Grant --&gt;</span>|<span class="string"> Authorization </span>|</span><br><span class="line">|<span class="string"> Client </span>|<span class="string">                               </span>|<span class="string">     Server    </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">&lt;-(D)----- Access Token -------</span>|<span class="string">               </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string"></span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               +---------------+</span></span><br><span class="line"><span class="string"></span>|<span class="string">        </span>|<span class="string">--(E)----- Access Token ------&gt;</span>|<span class="string">    Resource   </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">                               </span>|<span class="string">     Server    </span>|</span><br><span class="line">|<span class="string">        </span>|<span class="string">&lt;-(F)--- Protected Resource ---</span>|<span class="string">               </span>|</span><br><span class="line">+--------+</span><br></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//</span>accounts.google.com<span class="regexp">/o/</span>oauth2<span class="regexp">/v2/</span>auth?response_type=code&amp;client_id=<span class="number">553817080137</span>-d1pe3asc115tfgo74l8me92dhg4ro9k1.apps.googleusercontent.com&amp;redirect_uri=http:<span class="regexp">//</span>x.lyloou.com<span class="regexp">/oauth/g</span>oogle/callback&amp;state=e829a5725ce69cf1ed7918337caba839&amp;access_type=offline&amp;scope=openid email profile&amp;prompt=select_account</span><br></pre></td></tr></table></figure>

<p>授权页面的链接是通过 <code>AuthDefaultRequest.authorize</code> 来拼接得到的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// AuthDefaultRequest.java</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回带&#123;<span class="doctag">@code</span> state&#125;参数的授权url，授权回调时会带上这个&#123;<span class="doctag">@code</span> state&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> state state 验证授权流程的参数，可以防止csrf</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回授权地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.9.3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">authorize</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UrlBuilder.fromBaseUrl(<span class="built_in">super</span>.authorize(state))</span><br><span class="line">            .queryParam(<span class="string">&quot;access_type&quot;</span>, <span class="string">&quot;offline&quot;</span>)</span><br><span class="line">            .queryParam(<span class="string">&quot;scope&quot;</span>, <span class="built_in">this</span>.getScopes(<span class="string">&quot; &quot;</span>, <span class="literal">false</span>, AuthScopeUtils.getDefaultScopes(AuthGoogleScope.values())))</span><br><span class="line">            .queryParam(<span class="string">&quot;prompt&quot;</span>,<span class="string">&quot;select_account&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取以 &#123;<span class="doctag">@code</span> separator&#125;分割过后的 scope 信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> separator     多个 &#123;<span class="doctag">@code</span> scope&#125; 间的分隔符</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> encode        是否 encode 编码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> defaultScopes 默认的 scope， 当客户端没有配置 &#123;<span class="doctag">@code</span> scopes&#125; 时启用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.16.7</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> String <span class="title function_">getScopes</span><span class="params">(String separator, <span class="type">boolean</span> encode, List&lt;String&gt; defaultScopes)</span> &#123;</span><br><span class="line">        List&lt;String&gt; scopes = config.getScopes();</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == scopes || scopes.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> == defaultScopes || defaultScopes.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            scopes = defaultScopes;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == separator) &#123;</span><br><span class="line">            <span class="comment">// 默认为空格</span></span><br><span class="line">            separator = <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">scopeStr</span> <span class="operator">=</span> String.join(separator, scopes);</span><br><span class="line">        <span class="keyword">return</span> encode ? UrlUtil.urlEncode(scopeStr) : scopeStr;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>getScopes</code> 这里的逻辑是，如果没有传入 scope 参数，那么就使用默认的 scope 参数，即<code>openid email profile</code>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">USER_OPENID(<span class="string">&quot;openid&quot;</span>, <span class="string">&quot;Associate you with your personal info on Google&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">USER_EMAIL(<span class="string">&quot;email&quot;</span>, <span class="string">&quot;View your email address&quot;</span>, <span class="literal">true</span>),</span><br><span class="line">USER_PROFILE(<span class="string">&quot;profile&quot;</span>, <span class="string">&quot;View your basic profile info&quot;</span>, <span class="literal">true</span>),</span><br></pre></td></tr></table></figure>

<p>插曲：如果你把 email 和 profile 取消掉，获取到用户信息时会发现少了 email,profile 这些信息</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// scope=openid</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;113911973270419053931&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://lh3.googleusercontent.com/a-/AOh14GgncI8eYK_uG119BDclub5LNGDn57G_GI4OLZeOBA=s96-c&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;blog&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;company&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UNKNOWN&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GOOGLE&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;accessToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ya29.a0ARrdaM-dddddd-MPjpVj6xJAJP0zZFb396tpmi6BkS_Uom1G7DGTvSaWdJwwOzCXC5Bus-xQjq9JdGfNKWylhl029LMtuyZVT7lKzquGvUFePmellmRoY2Or6RgjS-TwKHzSviQoqEFBcYlQ&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;expireIn&quot;</span><span class="punctuation">:</span> <span class="number">3592</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;refreshToken&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;refreshTokenExpireIn&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;openId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;accessCode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;unionId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;scope&quot;</span><span class="punctuation">:</span> <span class="string">&quot;openid&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tokenType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bearer&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;idToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJSUzI1NiIsImtpZCI6ImI2ZjhkNTVkYTUzNGVhOTFjYjJjYjAwZTFhZjRlOGUwY2RlY2E5M2QiLCJ0eXAiOiJKV1QifQ.dddddd.yYUcU9VMwrF3vGXfmR4bsJDeQSjl_msow9eCARiV8HYIyjWDyZUM0ihOqxQzunWUT0W3nRVWxFw4oeN9bhZxIU9jBpW600eJRyDZ6BgJs0QEmC4sjJ4rWPp_P6OFo6b4HEM9Cl5i4ix-cJV18-4BxWhM6WbuC09F3a5RVvp7YGzYhMDRK4fecDpy-7q5wFZws3oYOrjCK5rVu4lioLMTJHCV-THbWImZTrEiuiLxw6onvKwhDa2FfLGbO3tei0EoVTvxJJwi18K-5TzcNySb8yBA-NYTXmlLZ9iWb7NNa7IXqKI1qt0VYm7xUUY4r3G14tZKU6JKkuz07RVx-4zxMw&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;macAlgorithm&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;macKey&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;oauthToken&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;oauthTokenSecret&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;screenName&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;oauthCallbackConfirmed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rawUserInfo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ddd&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://lh3.googleusercontent.com/a-/AOh14GgncI8eYK_uG119BDclub5LNGDn57G_GI4OLZeOBA=s96-c&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// scope=openid email profile</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;113911973270419053931&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lyloou6@gmail.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Lou&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://lh3.googleusercontent.com/a-/AOh14GgncI8eYK_uG119BDclub5LNGDn57G_GI4OLZeOBA=s96-c&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;blog&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;company&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zh-CN&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lyloou6@gmail.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UNKNOWN&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GOOGLE&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;accessToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ya29.dd-dddd-eplbTCCWb55DHRZeAGDqDvk5RADufWREONGgKhdtCLa3yWKp4TxTJsyPi2EXYhgmMqV4yVV-NX6swbc38hMXKKGzsTnW4UVaiSOklQ-C1B_af&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;expireIn&quot;</span><span class="punctuation">:</span> <span class="number">3599</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;refreshToken&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;refreshTokenExpireIn&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;openId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;accessCode&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;unionId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;scope&quot;</span><span class="punctuation">:</span> <span class="string">&quot;openid https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tokenType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bearer&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;idToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dddddddddd&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;macAlgorithm&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;macKey&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;oauthToken&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;oauthTokenSecret&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;screenName&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;oauthCallbackConfirmed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rawUserInfo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;113911973270419053931&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;email_verified&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Lou&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;given_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Lou&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;locale&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zh-CN&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://lh3.googleusercontent.com/a-/AOh14GgncI8eYK_uG119BDclub5LNGDn57G_GI4OLZeOBA=s96-c&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lyloou6@gmail.com&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/lyloou/img/develop/justauth%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0-2021-07-02-10-50-48.png" alt="justauth源码学习-2021-07-02-10-50-48"><br>后面获取用户信息，带上 accessToken 来就可以获取了。</p>
<h4 id="Q-http-工具如何解耦，可以将选择权交给开发者？"><a href="#Q-http-工具如何解耦，可以将选择权交给开发者？" class="headerlink" title="Q: http 工具如何解耦，可以将选择权交给开发者？"></a>Q: http 工具如何解耦，可以将选择权交给开发者？</h4><p>作者引入了自己实现的 <code>simple-http</code> 工具包 <a href="https://github.com/xkcoding/simple-http">xkcoding/simple-http: 抽取一个简单 HTTP 的通用接口，底层实现根据具体引入依赖指定。</a></p>
<p>从 <code>AuthGithubRequest#getUserInfo</code> 开始</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> AuthUser <span class="title function_">getUserInfo</span><span class="params">(AuthToken authToken)</span> &#123;</span><br><span class="line">    <span class="type">HttpHeader</span> <span class="variable">header</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeader</span>();</span><br><span class="line">    header.add(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;token &quot;</span> + authToken.getAccessToken());</span><br><span class="line">    <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> (<span class="keyword">new</span> <span class="title class_">HttpUtils</span>(<span class="built_in">this</span>.config.getHttpConfig())).get(UrlBuilder.fromBaseUrl(<span class="built_in">this</span>.source.userInfo()).build(), (Map)<span class="literal">null</span>, header, <span class="literal">false</span>);</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">object</span> <span class="operator">=</span> JSONObject.parseObject(response);</span><br><span class="line">    <span class="built_in">this</span>.checkResponse(object.containsKey(<span class="string">&quot;error&quot;</span>), object.getString(<span class="string">&quot;error_description&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> AuthUser.builder().rawUserInfo(object).uuid(object.getString(<span class="string">&quot;id&quot;</span>)).username(object.getString(<span class="string">&quot;login&quot;</span>)).avatar(object.getString(<span class="string">&quot;avatar_url&quot;</span>)).blog(object.getString(<span class="string">&quot;blog&quot;</span>)).nickname(object.getString(<span class="string">&quot;name&quot;</span>)).company(object.getString(<span class="string">&quot;company&quot;</span>)).location(object.getString(<span class="string">&quot;location&quot;</span>)).email(object.getString(<span class="string">&quot;email&quot;</span>)).remark(object.getString(<span class="string">&quot;bio&quot;</span>)).gender(AuthUserGender.UNKNOWN).token(authToken).source(<span class="built_in">this</span>.source.toString()).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里实例化了一个 HttpUtils 工具类 <code>new HttpUtils(this.config.getHttpConfig())</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HttpUtils</span><span class="params">(HttpConfig config)</span> &#123;</span><br><span class="line">        HttpUtil.setConfig(config);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpUtil</span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConfig</span><span class="params">(HttpConfig httpConfig)</span> &#123;</span><br><span class="line">		checkHttpNotNull(proxy);</span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">null</span> == httpConfig) &#123;</span><br><span class="line">			httpConfig = HttpConfig.builder().timeout(Constants.DEFAULT_TIMEOUT).build();</span><br><span class="line">		&#125;</span><br><span class="line">		proxy.setHttpConfig(httpConfig);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkHttpNotNull</span><span class="params">(Http proxy)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">null</span> == proxy) &#123;</span><br><span class="line">			selectHttpProxy();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到 <code>selectHttpProxy()</code>这里是关键，通过 <code>ClassUtil.isPresent</code>的方式（即<code>Class.forName</code>）来确定 class 是否可以被加载，从上到下，如果可以被加载，就作为 http 的具体代理。（所以引入了相关的 http 依赖，<code>HttpUtils</code> 就可以直接拿来使用了）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpUtil</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> AbstractHttp proxy;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">selectHttpProxy</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">AbstractHttp</span> <span class="variable">defaultProxy</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">		<span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> HttpUtil.class.getClassLoader();</span><br><span class="line">		<span class="comment">// 基于 java 11 HttpClient</span></span><br><span class="line">		<span class="keyword">if</span> (ClassUtil.isPresent(<span class="string">&quot;java.net.http.HttpClient&quot;</span>, classLoader)) &#123;</span><br><span class="line">			defaultProxy = getHttpProxy(com.xkcoding.http.support.java11.HttpClientImpl.class);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 基于 okhttp3</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">null</span> == defaultProxy &amp;&amp; ClassUtil.isPresent(<span class="string">&quot;okhttp3.OkHttpClient&quot;</span>, classLoader)) &#123;</span><br><span class="line">			defaultProxy = getHttpProxy(com.xkcoding.http.support.okhttp3.OkHttp3Impl.class);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 基于 httpclient</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">null</span> == defaultProxy &amp;&amp; ClassUtil.isPresent(<span class="string">&quot;org.apache.http.impl.client.HttpClients&quot;</span>, classLoader)) &#123;</span><br><span class="line">			defaultProxy = getHttpProxy(com.xkcoding.http.support.httpclient.HttpClientImpl.class);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 基于 hutool</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">null</span> == defaultProxy &amp;&amp; ClassUtil.isPresent(<span class="string">&quot;cn.hutool.http.HttpRequest&quot;</span>, classLoader)) &#123;</span><br><span class="line">			defaultProxy = getHttpProxy(com.xkcoding.http.support.hutool.HutoolImpl.class);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (defaultProxy == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SimpleHttpException</span>(<span class="string">&quot;Has no HttpImpl defined in environment!&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		proxy = defaultProxy;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如下图，是 <code>simpleHttp</code> 默认支持的 Http 工具。</p>
<p><img src="http://cdn.lyloou.com/img/20210625112103.png" alt="image-20210625112056585"></p>
<p>也可以自己继承 <code>AbstractHttp</code>，然后调用 <code>HttpUtil#setHttp(AbstractHttp http)</code> 方法来接入自己实现的 http 工具。</p>
<p>所有实现 AbstractHttp 和 Http 的类，需要自己实现 一系列的<code>get</code>、 <code>post</code> 方法（即封装）。运行时通过面向对象中的多态来决定具体的实现者。</p>
]]></content>
      <tags>
        <tag>java</tag>
        <tag>源码</tag>
      </tags>
  </entry>
  <entry>
    <title>【网络】Vpc专有网络</title>
    <url>/%E7%BD%91%E7%BB%9C/vpc/</url>
    <content><![CDATA[<p><a href="https://developer.aliyun.com/article/58516">阿里云网络系列之经典网络和专有网络-阿里云开发者社区</a><br><a href="https://coolshell.me/articles/public-network-working-tutorial.html">科普一下公有云的网络 – 酷 壳 – CoolShell 3F</a></p>
]]></content>
      <tags>
        <tag>网络</tag>
      </tags>
  </entry>
  <entry>
    <title>七层模型</title>
    <url>/%E7%BD%91%E7%BB%9C/%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B/</url>
    <content><![CDATA[<p><a href="http://www.ha97.com/3215.html">OSI 七层与 TCP/IP 五层网络架构详解</a></p>
<table>
<thead>
<tr>
<th>字母</th>
<th>英文含义</th>
<th>中文含义</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>Application</td>
<td>应用层</td>
</tr>
<tr>
<td>P</td>
<td>Presentation</td>
<td>表示层</td>
</tr>
<tr>
<td>S</td>
<td>Session</td>
<td>会话层</td>
</tr>
<tr>
<td>T</td>
<td>Transport</td>
<td>传输层</td>
</tr>
<tr>
<td>N</td>
<td>Network</td>
<td>网络层</td>
</tr>
<tr>
<td>D</td>
<td>Data Link</td>
<td>数据链路层</td>
</tr>
<tr>
<td>P</td>
<td>Physical</td>
<td>物理层</td>
</tr>
</tbody></table>
<ul>
<li>七层模型简单记忆：<code>PDNTSPA</code></li>
<li>五层模型简单记忆：<code>PDNTA</code></li>
</ul>
<p><a href="http://www.ha97.com/3215.html">OSI 七层与 TCP/IP 五层网络架构详解</a></p>
<p><strong>OSI 和 TCP/IP 是很基础但又非常重要的网络基础知识，理解得透彻对运维工程师来说非常有帮助。今天偶又复习了一下：</strong></p>
<p><strong>（1）</strong>OSI<strong>七层模型</strong></p>
<p>OSI 中的层 功能 TCP/IP 协议族<br>应用层 文件传输，电子邮件，文件服务，虚拟终端 TFTP，HTTP，SNMP，FTP，SMTP，DNS，Telnet<br>表示层 数据格式化，代码转换，数据加密 没有协议<br>会话层 解除或建立与别的接点的联系 没有协议<br>传输层 提供端对端的接口 TCP，UDP<br>网络层 为数据包选择路由 IP，ICMP，RIP，OSPF，BGP，IGMP<br>数据链路层 传输有地址的帧以及错误检测功能 SLIP，CSLIP，PPP，ARP，RARP，MTU<br>物理层 以二进制数据形式在物理媒体上传输数据 ISO2110，IEEE802，IEEE802.2</p>
<p><img src="http://www.ha97.com/wp-content/uploads/image/2010/09/162558wtA.jpg" alt="img"></p>
<p><img src="http://www.ha97.com/wp-content/uploads/image/2010/09/162603uh3.gif" alt="img"></p>
<p><strong>（2）TCP/IP 五层模型的协议</strong></p>
<p>应用层<br>传输层<br>网络层<br>数据链路层<br>物理层</p>
<p>物理层：中继器、集线器、还有我们通常说的双绞线也工作在物理层<br>数据链路层：网桥（现已很少使用）、以太网交换机（二层交换机）、网卡（其实网卡是一半工作在物理层、一半工作在数据链路层）<br>网络层：路由器、三层交换机<br>传输层：四层交换机、也有工作在四层的路由器</p>
<p><img src="http://www.ha97.com/wp-content/uploads/image/2010/09/162606nhq.jpg" alt="img"></p>
<p><strong>二、TCP/UDP 协议</strong></p>
<p>TCP (Transmission Control Protocol)和 UDP(User Datagram Protocol)协议属于传输层协议。其中 TCP 提供 IP 环境下的数据可靠传输，它提供的服务包括数据流传送、可靠性、有效流控、全双工操作和多路复 用。通过面向连接、端到端和可靠的数据包发送。通俗说，它是事先为所发送的数据开辟出连接好的通道，然后再进行数据发送；而 UDP 则不为 IP 提供可靠性、 流控或差错恢复功能。一般来说，TCP 对应的是可靠性要求高的应用，而 UDP 对应的则是可靠性要求低、传输经济的应用。TCP 支持的应用协议主要 有：Telnet、FTP、SMTP 等；UDP 支持的应用层协议主要有：NFS（网络文件系统）、SNMP（简单网络管理协议）、DNS（主域名称系 统）、TFTP（通用文件传输协议）等.<br>TCP/IP 协议与低层的数据链路层和物理层无关，这也是 TCP/IP 的重要特点</p>
<p><strong>三、OSI 的基本概念</strong><br>OSI 是 Open System Interconnect 的缩写，意为开放式系统互联。<br><strong>OSI</strong>七层参考模型的各个层次的划分遵循下列原则：<br>** 1、同一层中的各网络节点都有相同的层次结构，具有同样的功能。<br>2、同一节点内相邻层之间通过接口（可以是逻辑接口）进行通信。<br>3、七层结构中的每一层使用下一层提供的服务，并且向其上层提供服务。<br>4、不同节点的同等层按照协议实现对等层之间的通信。</p>
<p>第一层：物理层（PhysicalLayer)，<br>规定通信设备的机械的、电气的、功能的和过程的特性，用以建立、维护和拆除物理链路连接。具体地讲，机械 特性规定了网络连接时所需接插件的规格尺寸、引脚数量和排列情况等；电气特性规定了在物理连接上传输 bit 流时线路上信号电平的大小、阻抗匹配、传输速率 距离限制等；功能特性是指对各个信号先分配确切的信号含义，即定义了 DTE 和 DCE 之间各个线路的功能；规程特性定义了利用信号线进行 bit 流传输的一组 操作规程，是指在物理连接的建立、维护、交换信息是，DTE 和 DCE 双放在各电路上的动作系列。在这一层，数据的单位称为比特（bit）。属于物理层定义的典型规范代表包括：EIA/TIA RS-232、EIA/TIA RS-449、V.35、RJ-45 等。</p>
<p>第二层：数据链路层（DataLinkLayer):<br>在物理层提供比特流服务的基础上，建立相邻结点之间的数据链路，通过差错控制提供数据帧（Frame）在信道上无差错的传输，并进行各电路上的动作系列。数据链路层在不可靠的物理介质上提供可靠的传输。该层的作用包括：物理地址寻址、数据的成帧、流量控制、数据的检错、重发等。在这一层，数据的单位称为帧（frame）。数据链路层协议的代表包括：SDLC、HDLC、PPP、STP、帧中继等。</p>
<p>第三层是网络层<br>在 计算机网络中进行通信的两个计算机之间可能会经过很多个数据链路，也可能还要经过很多通信子网。网络层的任务就是选择合适的网间路由和交换结点， 确保数据及时传送。网络层将数据链路层提供的帧组成数据包，包中封装有网络层包头，其中含有逻辑地址信息- -源站点和目的站点地址的网络地址。如 果你在谈论一个 IP 地址，那么你是在处理第 3 层的问题，这是“数据包”问题，而不是第 2 层的“帧”。IP 是第 3 层问题的一部分，此外还有一些路由协议和地 址解析协议（ARP）。有关路由的一切事情都在这第 3 层处理。地址解析和路由是 3 层的重要目的。网络层还可以实现拥塞控制、网际互连等功能。在这一层，数据的单位称为数据包（packet）。网络层协议的代表包括：IP、IPX、RIP、OSPF 等。</p>
<p>第 四层是处理信息的传输层<br>第 4 层的数据单元也称作数据包（packets）。但是，当你谈论 TCP 等具体的协议时又有特殊的叫法，TCP 的数据单元称为段 （segments）而 UDP 协议的数据单元称为“数据报（datagrams）”。这个层负责获取全部信息，因此，它必须跟踪数据单元碎片、乱序到达的 数据包和其它在传输过程中可能发生的危险。第 4 层为上层提供端到端（最终用户到最终用户）的透明的、可靠的数据传输服务。所为透明的传输是指在通信过程中 传输层对上层屏蔽了通信传输系统的具体细节。传输层协议的代表包括：TCP、UDP、SPX 等。</p>
<p>第五层是会话层<br>这一层也可以称为会晤层或对话层，在会话层及以上的高层次中，数据传送的单位不再另外命名，而是统称为报文。会话层不参与具体的传输，它提供包括访问验证和会话管理在内的建立和维护应用之间通信的机制。如服务器验证用户登录便是由会话层完成的。</p>
<p>第六层是表示层<br>这一层主要解决拥护信息的语法表示问题。它将欲交换的数据从适合于某一用户的抽象语法，转换为适合于 OSI 系统内部使用的传送语法。即提供格式化的表示和转换数据服务。数据的压缩和解压缩， 加密和解密等工作都由表示层负责。</p>
<p>第七层应用层<br>应用层为操作系统或网络应用程序提供访问网络服务的接口。应用层协议的代表包括：Telnet、FTP、HTTP、SNMP 等。</p>
<p><strong>除了层的数量之外，开放式系统互联（OSI）模型与TCP/IP协议有什么区别？</strong></p>
<p>开放式系统互联模型是一个参考标准，解释协议相互之间应该如何相互作用。TCP/IP 协议是美国国防部发明的，是让互联网成为了目前这个样子的标准之一。开放式系统互联模型中没有清楚地描绘 TCP/IP 协议，但是在解释 TCP/IP 协议时很容易想到开放式系统互联模型。两者的主要区别如下：</p>
<p>TCP/IP 协议中的应用层处理开放式系统互联模型中的第五层、第六层和第七层的功能。</p>
<p>TCP/IP 协议中的传输层并不能总是保证在传输层可靠地传输数据包，而开放式系统互联模型可以做到。TCP/IP 协议还提供一项名为 UDP（用户数据报协议）的选择。UDP 不能保证可靠的数据包传输。</p>
<p><strong>TCP/UDP协议</strong></p>
<p>TCP(Transmission Control Protocol)和 UDP(User Datagram Protocol)协议属于传输层协议。其中 TCP 提供 IP 环境下的数据可靠传输，它提供的服务包括数据流传送、可靠性、有效流控、全双工操作和多路复用。通过面向连接、端到端和可靠的数据包发送。通俗说，它是事先为所发送的数据开辟出连接好的通道，然后再进行数据发送；而 UDP 则不为 IP 提供可靠性、流控或差错恢复功能。一般来说，TCP 对应的是可靠性要求高的应用，而 UDP 对应的则是可靠性要求低、传输经济的应用。</p>
<p>TCP 支持的应用协议主要有：Telnet、FTP、SMTP 等；UDP 支持的应用层协议主要有：NFS（网络文件系统）、SNMP（简单网络管理协议）、DNS（主域名称系统）、TFTP（通用文件传输协议）等。</p>
<p>TCP/IP 协议与低层的数据链路层和物理层无关，这也是 TCP/IP 的重要特点。</p>
<p>OSI 是 Open System Interconnect 的缩写，意为开放式系统互联。</p>
]]></content>
      <tags>
        <tag>网络</tag>
      </tags>
  </entry>
  <entry>
    <title>Awk</title>
    <url>/shell/awk_sed/awk/</url>
    <content><![CDATA[<p>$(whereis go | awk -F: ‘{print $2}’)</p>
<ul>
<li><p><a href="http://mingxinglai.com/cn/2012/12/Why-I-like-AWK/">为什么我特别喜欢Awk | 赖明星</a></p>
</li>
<li><p><a href="https://gregable.com/2010/09/why-you-should-know-just-little-awk.html">Why you should learn just a little Awk - An Awk tutorial by Example - Gregable</a></p>
</li>
<li><p><a href="https://github.com/mylxsw/growing-up/blob/master/doc/%E4%B8%89%E5%8D%81%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9AAWK.md">growing-up/三十分钟学会AWK.md at master · mylxsw/growing-up</a></p>
</li>
</ul>
<ul>
<li><a href="https://github.com/wuzhouhui/awk">https://github.com/wuzhouhui/awk</a></li>
<li><a href="https://github.com/yeyouqun/GAWK-MT">https://github.com/yeyouqun/GAWK-MT</a></li>
</ul>
]]></content>
      <tags>
        <tag>linux</tag>
        <tag>shell</tag>
        <tag>awk</tag>
      </tags>
  </entry>
  <entry>
    <title>Sed</title>
    <url>/shell/awk_sed/sed/</url>
    <content><![CDATA[<ul>
<li><p><a href="https://stackoverflow.com/questions/27721209/how-do-i-replace-all-dot-in-string-to-underscore">how-do-i-replace-all-dot-in-string-to-underscore</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> a.b.c.d | sed <span class="string">&#x27;s/\./_/g&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p><a href="https://github.com/mylxsw/growing-up/blob/master/doc/%E4%B8%89%E5%8D%81%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9ASED.md">growing-up/三十分钟学会SED.md at master · mylxsw/growing-up</a></p>
</li>
</ul>
]]></content>
      <tags>
        <tag>linux</tag>
        <tag>shell</tag>
        <tag>sed</tag>
      </tags>
  </entry>
</search>
