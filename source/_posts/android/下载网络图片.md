---
title: android下载网络图片
date: 2017-08-27 17:16:15
toc: true
comments: true
tags:
- android
---

## 下载网络图片
    ```java
    // 第一步：根据流得到bitmap
    // 方案1
    Bitmap bitmap = Glide.with(applicationContext)
            .load(url)
            .asBitmap()
            .into(Target.SIZE_ORIGINAL, Target.SIZE_ORIGINAL)
            .get();
    // 方案2
    Bitmap bitmap = BitmapFactory.decodeStream(new URL(url).openStream());
    
    // 压缩图片
    // bitmap = Bitmap.createScaledBitmap(bitmap, 120, 120, true);
    
    // 第二步：保存成文件
    // 保存图片
    File imgDir = new File(getDiskCacheDir(applicationContext), "image_caches");
    if (!imgDir.exists()) {
        imgDir.mkdirs();
    }
    File imgFile = new File(imgDir, fileName);
    fileOutputStream = new FileOutputStream(imgFile);
    Bitmap.CompressFormat compressFormat = Bitmap.CompressFormat.PNG;
    bitmap.compress(compressFormat, 100, fileOutputStream);
    fileOutputStream.flush();
    
    ```

## Glide预加载图片
```java
public static void preloadImage(Context context, AdZone adZone) {
    for (AdZone.Item item : adZone.getItems()) {
        new Thread(() -> {
            try {
                Glide.with(context.getApplicationContext())
                        .load(item.getPic())
                        .downloadOnly(Target.SIZE_ORIGINAL, Target.SIZE_ORIGINAL)
                        .get();
            } catch (InterruptedException e) {
                e.printStackTrace();
            } catch (ExecutionException e) {
                e.printStackTrace();
            }
        }).start();
    }
}
```

```java
Glide.with(getApplicationContext())
    .load(pic)
    .diskCacheStrategy(DiskCacheStrategy.ALL)
    .into(new GlideDrawableImageViewTarget(ivWelcome) {
        @Override
        protected void setResource(GlideDrawable resource) {
            // https://github.com/bumptech/glide/issues/275
            super.setResource(resource);

            ivWelcome.setOnClickListener(v -> {
                sendAdZoneItemBroadcast(item);
            });
            ivWelcome.setVisibility(View.VISIBLE);

            // set countDown
            toCountDown();
        }

        @Override
        public void onLoadFailed(Exception e, Drawable errorDrawable) {
            super.onLoadFailed(e, errorDrawable);
        }
    });
```
- [Glide下载图片和缓存图片](https://blog.csdn.net/qq_30740239/article/details/53466426)
- [java - Preload multiple images with Glide - Stack Overflow](https://stackoverflow.com/questions/37964187/preload-multiple-images-with-glide)