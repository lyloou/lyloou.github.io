---
title: 文件处理
date: 2020-06-08 12:08:48
toc: true
comments: true
tags:
  - spring
---

## 返回图片思路 1

[Spring MVC: How to return image in @ResponseBody? - Stack Overflow](https://stackoverflow.com/questions/5690228/spring-mvc-how-to-return-image-in-responsebody)

```java
@ResponseBody
@RequestMapping(value = "/photo2", method = RequestMethod.GET, produces = MediaType.IMAGE_JPEG_VALUE)
public byte[] testphoto() throws IOException {
    InputStream in = servletContext.getResourceAsStream("/images/no_image.jpg");
    return IOUtils.toByteArray(in);
}
```

```JS
// JavaScript
export function getcaptcha(params) {
  return request({
    url: '/api/user/getcaptcha',
    method: 'get',
    responseType: 'blob',
    params,
  });
}
```

## 返回图片思路 2

将图片作为 base64 字符串返回，前端渲染 base64 即可。

```java
// 引入 hutool 的验证码功能
@Override
public String getCaptcha(String captchaKey) {
    LineCaptcha lineCaptcha = CaptchaUtil.createLineCaptcha(160, 80);
    String captchaCode = lineCaptcha.getCode();
    codeCache.set(captchaKey, captchaCode, Duration.ofMinutes(5).getSeconds());
    return lineCaptcha.getImageBase64Data();
}
```

## spring 异步处理上传的文件时，自动删除问题

- [上传文件异步处理注意事项 - SegmentFault 思否](https://segmentfault.com/a/1190000038544706)
- [Spring async file upload and processing - Stack Overflow](https://stackoverflow.com/questions/36565597/spring-async-file-upload-and-processing)
