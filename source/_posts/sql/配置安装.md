---
title: sql配置和安装
date: 2016/10/10 20:29
toc: true
comments: true
tags:
  - sql
---

## linux 安装 mariadb

- 打开 https://downloads.mariadb.org/mariadb/repositories/

- 查看自己的版本号，选择对应的 version

```sh
lsb_release -a
```

- 添加源

```sh
sudo apt-get install software-properties-common
sudo apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xF1656F24C74CD1D8
sudo add-apt-repository 'deb [arch=amd64,arm64,ppc64el] http://mirrors.neusoft.edu.cn/mariadb/repo/10.4/ubuntu bionic main'
```

- 更新和安装

```sh
sudo apt update
sudo apt install mariadb-server
```

- 查看安装状态

```sh
systemctl status mariadb
```

- 查看 mysql version

```sh
mysql -V
```

https://linuxize.com/post/how-to-install-mariadb-on-ubuntu-18-04/

## uninstall mariadb

```sh
apt-get remove --purge mysql*
apt-get remove --purge mysql
apt-get remove --purge mariadb
apt-get remove --purge mariadb*
apt-get --purge remove mariadb-server
apt-get --purge remove python-software-properties
```

## 重置密码

[How to reset a MySQL root password | Linuxize](https://linuxize.com/post/how-to-reset-a-mysql-root-password/)

```sql
systemctl stop mysql

sudo mysqld_safe --skip-grant-tables &

mysql -u root

FLUSH PRIVILEGES;
ALTER USER 'root'@'localhost' IDENTIFIED BY 'MY_NEW_PASSWORD';
-- SET PASSWORD FOR 'root'@'localhost' = PASSWORD('MY_NEW_PASSWORD');
FLUSH PRIVILEGES;

-- restart
mysqladmin -u root -p shutdown
sudo systemctl start mariadb

-- login again
mysql -u root -p
```

### 外网登录常见问题

Q: ERROR 2003 (HY000): Can't connect to MySQL server on (111 "Connection refused")
A: [mysql 远程连接数据库报 111 错误 - ssj901217 的博客 - CSDN 博客](https://blog.csdn.net/ssj901217/article/details/74490803)

```
vi /etc/mysql/my.cnf
找到
[mysqld]
bind-address            = 127.0.0.1
注释掉bind-address
重启 mysql, systemctl restart mysql;
```

Q: ERROR 1130 (HY000): Host is not allowed to connect to this MariaDB server
A: [解决 MySQL ERROR 1130 (HY000): Host 'XXXX' is not allowed to connect to this MySQL server - HJULKK 的专栏 - CSDN 博客](https://blog.csdn.net/HJULKK/article/details/52563044)

```sql
mysql -u root -p
use mysql;
update user set host = '%' where user = 'root';
flush privileges;
select host, user from user;
quit
-- 步骤2：重启mysql,
systemctl restart mysql;
```

Q: [mysql - ERROR 1698 (28000): Access denied for user 'root'@'localhost' - Stack Overflow](https://stackoverflow.com/questions/39281594/error-1698-28000-access-denied-for-user-rootlocalhost)
A: see below code

```sql
sudo service mysql restart
sudo mysql # logs in automatically into MariaDB
use mysql;
update user set plugin='' where user='your_user_name';
flush privileges;
exit;
sudo service mysql restart # restarts the mysql service
```

## linux 安装 mysql

```sh
sudo apt-get update
sudo apt-get install mysql-server
sudo mysql_secure_installation
```

https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-ubuntu-16-04?comment=53320
If it occurs error because of broken MySQL package on Ubuntu 16.04. Just do this trick

```sh
# Purge all MySQL packages
sudo apt purge mysql*
sudo rm -rf /var/lib/mysql
sudo rm -rf /etc/mysql

# Reinstall MySQL
sudo apt install mysql-server mysql-client
```

## 默认配置

- 端口：3306

## 其它软件

- mycli

## 参考资料：

- [How To Install MySQL on Ubuntu 16.04](error 1045 access denied for user using password no)
- https://stackoverflow.com/questions/10299148/mysql-error-1045-28000-access-denied-for-user-billlocalhost-using-passw
