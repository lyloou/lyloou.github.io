---
title: 【sql】常见问题列表
date: 2019-07-26 13:59:33
toc: true
comments: true
tags:
  - sql
  - mysql
---

## 死锁

解决思路就是：避免同时操作数据；

- [Mysql 并发时经典常见的死锁原因及解决方法 - 泽锦 - 博客园](https://www.cnblogs.com/zejin2008/p/5262751.html)

首先我们执行
`show engine innodb status\G;`
查看死锁情况，也可以
`mysql -u root -p --execute="show engine innodb status \G"> c:/mysql.log`
把死锁信息输出到本地磁盘，查看起来比较方便
[mysql 死锁分析 - 那片天空！那片海！ - CSDN 博客](https://blog.csdn.net/weixin_38250126/article/details/70053222)

**例如：**

通过定位死锁的数据库： `show engine \G`，发现一个统计任务、一个改价任务，同时修改同一个端口的内容，导致死锁。

解决方法：将两个任务的时间错开，改价的为每分钟的 0 秒触发；统计的为每两分钟的 30 秒触发；

## 日志文件被删除后，无法正常启动

通过`systemctl status mariadb.service`来查看缺少什么文件，创建对应的即可，
如果是权限问题，把外层的文件夹修改下权限 `/var/log/mysql`。
然后重启： `systemctl restart mariadb.service`

## Authentication plugin 'caching_sha2_password' cannot be loaded

```
use mysql;
ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '12345678';
select Host,user,plugin,Authentication_string from user;
```

[完美解决 ERROR2059(HY000):Authenticationplugincaching*sha2_passwordcannotbeloaded 问题*小洋人最 happy 的专栏-CSDN 博客\_error2059](https://blog.csdn.net/u010358168/article/details/81253744)

## 不可重复读和幻读的区别

- 脏读：读取未提交的数据；
- 不可重复读（update）：前后多次读取，数据内容不一致；
- 幻读（insert、delete）：前后多次读取，数据总量不一致；

* [快速理解脏读、不可重复读、幻读和 MVCC - 云+社区 - 腾讯云](https://cloud.tencent.com/developer/article/1450773)
  (1) 不可重复读是读取了其他事务更改的数据，针对 update 操作
  解决：使用行级锁，锁定该行，事务 A 多次读取操作完成后才释放该锁，这个时候才允许其他事务更改刚才的数据。
  (2) 幻读是读取了其他事务新增的数据，针对 insert 和 delete 操作
  解决：使用表级锁，锁定整张表，事务 A 多次读取数据总量之后才释放该锁，这个时候才允许其他事务新增数据。

#### SELECT IN(子查询)太慢问题

```sql
explain SELECT * FROM third_video_iqiyi WHERE  v_id in (SELECT v_id FROM third_video_iqiyi WHERE v_id < 10);
```

![常见问题_20220608185021_2022-06-08-18-50-22](https://raw.githubusercontent.com/lyloou/img/develop/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98_20220608185021_2022-06-08-18-50-22.png)
在表的整体数据量大的情况下，上面的 sql 基本无法执行。
- [生产慢查询记录：MySQL IN 子查询导致的慢查询_北亮bl的博客-CSDN博客](https://blog.csdn.net/youbl/article/details/113696590)
![常见问题_20220608185524_2022-06-08-18-55-24](https://raw.githubusercontent.com/lyloou/img/develop/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98_20220608185524_2022-06-08-18-55-24.png)

- [深入理解MySql子查询IN的执行和优化 - wuxiwei - 博客园](https://www.cnblogs.com/wxw16/p/6105624.html)

- [MySQL子查询慢现象的解决](https://www.365seal.com/y/AZvgXQL3Va.html)
![常见问题_20220608185226_2022-06-08-18-52-27](https://raw.githubusercontent.com/lyloou/img/develop/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98_20220608185226_2022-06-08-18-52-27.png)


优化方案

```sql
explain SELECT * FROM third_video_iqiyi a ,(SELECT v_id FROM third_video_iqiyi WHERE v_id < 10) b WHERE a.v_id = b.v_id;
```

![常见问题_20220608184956_2022-06-08-18-49-57](https://raw.githubusercontent.com/lyloou/img/develop/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98_20220608184956_2022-06-08-18-49-57.png)
